var A1=Object.defineProperty,S1=Object.defineProperties,T1=Object.getOwnPropertyDescriptors,Of=Object.getOwnPropertySymbols,P1=Object.prototype.hasOwnProperty,j1=Object.prototype.propertyIsEnumerable,nu=(n,e,t)=>e in n?A1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,pe=(n,e)=>{for(var t in e||(e={}))P1.call(e,t)&&nu(n,t,e[t]);if(Of)for(var t of Of(e))j1.call(e,t)&&nu(n,t,e[t]);return n},It=(n,e)=>S1(n,T1(e)),C1=(n,e,t)=>(nu(n,typeof e!="symbol"?e+"":e,t),t),eg=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},zn=(n,e,t)=>(eg(n,e,"read from private field"),t?t.call(n):e.get(n)),uo=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},rl=(n,e,t,r)=>(eg(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),z=(n,e,t)=>new Promise((r,i)=>{var o=c=>{try{a(t.next(c))}catch(l){i(l)}},s=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(o,s);a((t=t.apply(n,e)).next())});const er=Object.create(null);er.open="0";er.close="1";er.ping="2";er.pong="3";er.message="4";er.upgrade="5";er.noop="6";const Ys=Object.create(null);Object.keys(er).forEach(n=>{Ys[er[n]]=n});const R1={type:"error",data:"parser error"},I1=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",N1=typeof ArrayBuffer=="function",B1=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,tg=({type:n,data:e},t,r)=>I1&&e instanceof Blob?t?r(e):Af(e,r):N1&&(e instanceof ArrayBuffer||B1(e))?t?r(e):Af(new Blob([e]),r):r(er[n]+(e||"")),Af=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)},Sf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",xo=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let n=0;n<Sf.length;n++)xo[Sf.charCodeAt(n)]=n;const L1=n=>{let e=n.length*.75,t=n.length,r,i=0,o,s,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const l=new ArrayBuffer(e),u=new Uint8Array(l);for(r=0;r<t;r+=4)o=xo[n.charCodeAt(r)],s=xo[n.charCodeAt(r+1)],a=xo[n.charCodeAt(r+2)],c=xo[n.charCodeAt(r+3)],u[i++]=o<<2|s>>4,u[i++]=(s&15)<<4|a>>2,u[i++]=(a&3)<<6|c&63;return l},D1=typeof ArrayBuffer=="function",ng=(n,e)=>{if(typeof n!="string")return{type:"message",data:rg(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:U1(n.substring(1),e)}:Ys[t]?n.length>1?{type:Ys[t],data:n.substring(1)}:{type:Ys[t]}:R1},U1=(n,e)=>{if(D1){const t=L1(n);return rg(t,e)}else return{base64:!0,data:n}},rg=(n,e)=>{switch(e){case"blob":return n instanceof ArrayBuffer?new Blob([n]):n;case"arraybuffer":default:return n}},ig=String.fromCharCode(30),q1=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((o,s)=>{tg(o,!1,a=>{r[s]=a,++i===t&&e(r.join(ig))})})},V1=(n,e)=>{const t=n.split(ig),r=[];for(let i=0;i<t.length;i++){const o=ng(t[i],e);if(r.push(o),o.type==="error")break}return r},og=4;function lt(n){if(n)return M1(n)}function M1(n){for(var e in lt.prototype)n[e]=lt.prototype[e];return n}lt.prototype.on=lt.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};lt.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};lt.prototype.off=lt.prototype.removeListener=lt.prototype.removeAllListeners=lt.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};lt.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};lt.prototype.emitReserved=lt.prototype.emit;lt.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};lt.prototype.hasListeners=function(n){return!!this.listeners(n).length};const xn=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function sg(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const F1=xn.setTimeout,W1=xn.clearTimeout;function Qa(n,e){e.useNativeTimers?(n.setTimeoutFn=F1.bind(xn),n.clearTimeoutFn=W1.bind(xn)):(n.setTimeoutFn=xn.setTimeout.bind(xn),n.clearTimeoutFn=xn.clearTimeout.bind(xn))}const z1=1.33;function K1(n){return typeof n=="string"?H1(n):Math.ceil((n.byteLength||n.size)*z1)}function H1(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}class J1 extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class ag extends lt{constructor(e){super(),this.writable=!1,Qa(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new J1(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=ng(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const cg="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ru=64,Y1={};let Tf=0,Os=0,Pf;function jf(n){let e="";do e=cg[n%ru]+e,n=Math.floor(n/ru);while(n>0);return e}function lg(){const n=jf(+new Date);return n!==Pf?(Tf=0,Pf=n):n+"."+jf(Tf++)}for(;Os<ru;Os++)Y1[cg[Os]]=Os;function ug(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function G1(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let o=t[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}let hg=!1;try{hg=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(n){}const X1=hg;function dg(n){const e=n.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||X1))return new XMLHttpRequest}catch(t){}if(!e)try{return new xn[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function Q1(){}const Z1=function(){return new dg({xdomain:!1}).responseType!=null}();class ek extends ag{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=Z1&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};V1(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,q1(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=lg()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=ug(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new Xn(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class Xn extends lt{constructor(e,t){super(),Qa(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=sg(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new dg(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch(r){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{t.setRequestHeader("Accept","*/*")}catch(r){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document!="undefined"&&(this.index=Xn.requestsCount++,Xn.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=Q1,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete Xn.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Xn.requestsCount=0;Xn.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Cf);else if(typeof addEventListener=="function"){const n="onpagehide"in xn?"pagehide":"unload";addEventListener(n,Cf,!1)}}function Cf(){for(let n in Xn.requests)Xn.requests.hasOwnProperty(n)&&Xn.requests[n].abort()}const fg=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,e)=>e(n,0))(),As=xn.WebSocket||xn.MozWebSocket,Rf=!0,tk="arraybuffer",If=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class nk extends ag{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=If?{}:sg(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Rf&&!If?t?new As(e,t):new As(e):new As(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||tk,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;tg(r,this.supportsBinary,o=>{try{Rf&&this.ws.send(o)}catch(s){}i&&fg(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=lg()),this.supportsBinary||(e.b64=1);const i=ug(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!As}}const rk={websocket:nk,polling:ek},ik=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ok=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function iu(n){const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=ik.exec(n||""),o={},s=14;for(;s--;)o[ok[s]]=i[s]||"";return t!=-1&&r!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=sk(o,o.path),o.queryKey=ak(o,o.query),o}function sk(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function ak(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(t[i]=o)}),t}class Dr extends lt{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=iu(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=iu(t.host).host),Qa(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=G1(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=og,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new rk[e](r)}open(){let e;if(this.opts.rememberUpgrade&&Dr.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),r=!1;Dr.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Dr.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const y=new Error("probe error");y.transport=t.name,this.emitReserved("upgradeError",y)}}))};function o(){r||(r=!0,u(),t.close(),t=null)}const s=h=>{const y=new Error("probe error: "+h);y.transport=t.name,o(),this.emitReserved("upgradeError",y)};function a(){s("transport closed")}function c(){s("socket closed")}function l(h){t&&h.name!==t.name&&o()}const u=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};t.once("open",i),t.once("error",s),t.once("close",a),this.once("close",c),this.once("upgrading",l),t.open()}onOpen(){if(this.readyState="open",Dr.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=K1(r)),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:e,data:t,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){Dr.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}Dr.protocol=og;function ck(n,e="",t){let r=n;t=t||typeof location!="undefined"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t!="undefined"?n=t.protocol+"//"+n:n="https://"+n),r=iu(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}const lk=typeof ArrayBuffer=="function",uk=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,pg=Object.prototype.toString,hk=typeof Blob=="function"||typeof Blob!="undefined"&&pg.call(Blob)==="[object BlobConstructor]",dk=typeof File=="function"||typeof File!="undefined"&&pg.call(File)==="[object FileConstructor]";function $h(n){return lk&&(n instanceof ArrayBuffer||uk(n))||hk&&n instanceof Blob||dk&&n instanceof File}function Gs(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Gs(n[t]))return!0;return!1}if($h(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Gs(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&Gs(n[t]))return!0;return!1}function fk(n){const e=[],t=n.data,r=n;return r.data=ou(t,e),r.attachments=e.length,{packet:r,buffers:e}}function ou(n,e){if(!n)return n;if($h(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=ou(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=ou(n[r],e));return t}return n}function pk(n,e){return n.data=su(n.data,e),delete n.attachments,n}function su(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=su(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=su(n[t],e));return n}const yk=5;var Re;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(Re||(Re={}));class gk{constructor(e){this.replacer=e}encode(e){return(e.type===Re.EVENT||e.type===Re.ACK)&&Gs(e)?this.encodeAsBinary({type:e.type===Re.EVENT?Re.BINARY_EVENT:Re.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Re.BINARY_EVENT||e.type===Re.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=fk(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}class Oh extends lt{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Re.BINARY_EVENT;r||t.type===Re.BINARY_ACK?(t.type=r?Re.EVENT:Re.ACK,this.reconstructor=new mk(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if($h(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(Re[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===Re.BINARY_EVENT||r.type===Re.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const s=e.substring(o,t);if(s!=Number(s)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(o,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const o=t+1;for(;++t;){const s=e.charAt(t);if(s==null||Number(s)!=s){--t;break}if(t===e.length)break}r.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(Oh.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Re.CONNECT:return typeof t=="object";case Re.DISCONNECT:return t===void 0;case Re.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case Re.EVENT:case Re.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case Re.ACK:case Re.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class mk{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=pk(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const vk=Object.freeze(Object.defineProperty({__proto__:null,protocol:yk,get PacketType(){return Re},Encoder:gk,Decoder:Oh},Symbol.toStringTag,{value:"Module"}));function Rn(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const bk=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class yg extends lt{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Rn(e,"open",this.onopen.bind(this)),Rn(e,"packet",this.onpacket.bind(this)),Rn(e,"error",this.onerror.bind(this)),Rn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(bk.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Re.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,s=t.pop();this._registerAckCallback(o,s),r.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...s)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...s])}}emitWithAck(e,...t){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,o)=>{t.push((s,a)=>r?s?o(s):i(a):i(s)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...o)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Re.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Re.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Re.EVENT:case Re.BINARY_EVENT:this.onevent(e);break;case Re.ACK:case Re.BINARY_ACK:this.onack(e);break;case Re.DISCONNECT:this.ondisconnect();break;case Re.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:Re.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Re.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Gi(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Gi.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};Gi.prototype.reset=function(){this.attempts=0};Gi.prototype.setMin=function(n){this.ms=n};Gi.prototype.setMax=function(n){this.max=n};Gi.prototype.setJitter=function(n){this.jitter=n};class au extends lt{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Qa(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Gi({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||vk;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Dr(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Rn(t,"open",function(){r.onopen(),e&&e()}),o=Rn(t,"error",s=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",s),e?e(s):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const s=this._timeout;s===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Rn(e,"ping",this.onping.bind(this)),Rn(e,"data",this.ondata.bind(this)),Rn(e,"error",this.onerror.bind(this)),Rn(e,"close",this.onclose.bind(this)),Rn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){fg(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new yg(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ho={};function Xs(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=ck(n,e.path||"/socket.io"),r=t.source,i=t.id,o=t.path,s=ho[i]&&o in ho[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let c;return a?c=new au(r,e):(ho[i]||(ho[i]=new au(r,e)),c=ho[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(Xs,{Manager:au,Socket:yg,io:Xs,connect:Xs});const wk={init:({API_KEY:n,HOST_SERVER:e,CURRENT:t,ENV:r,API_VERSION:i})=>{var o,s;let a={};const c=localStorage.getItem("accessToken");try{const l={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return c&&(l.Authorization="Bearer "+c),a.auth=Xs(e.AUTH,{extraHeaders:l}),(o=a==null?void 0:a.auth)==null||o.on("connect",()=>{var u,h,y,d,f;r==="dev"&&console.log("Swyger Auth Client JS is connected with Swyger Server!!!");let p=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");p.uid&&(u=a.auth)!=null&&u.id&&(r==="dev"&&console.log("The socket device id is: ",(h=a.auth)==null?void 0:h.id),(d=a==null?void 0:a.auth)==null||d.emit((i==null?void 0:i.AUTH)+"/user/join",{socketId:(y=a.auth)==null?void 0:y.id,currentUserId:p.uid}),(f=a==null?void 0:a.auth)==null||f.on((i==null?void 0:i.AUTH)+"/user/status",v=>{if(p.status!=="online"){let w;v.from===p.uid&&(w=v==null?void 0:v.value),w!=null&&w.status&&(r==="dev"&&console.log("user is online: ",w),p.status=w.status,localStorage.setItem("userInfo",JSON.stringify(p)))}}))}),(s=a==null?void 0:a.auth)==null||s.on("disconnect",u=>{r==="dev"&&console.log("The device is disconnected from Auth server!");let h=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");h.uid&&h.status!=="offline"&&(h.status="offline",localStorage.setItem("userInfo",JSON.stringify(h)))}),a}catch(l){}}};function cu(n){this.message=n}cu.prototype=new Error,cu.prototype.name="InvalidCharacterError";var Nf=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new cu("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,o=0,s="";r=e.charAt(o++);~r&&(t=i%4?64*t+r:r,i++%4)?s+=String.fromCharCode(255&t>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return s};function kk(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(Nf(t).replace(/(.)/g,function(r,i){var o=i.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(e)}catch(t){return Nf(e)}}function Ia(n){this.message=n}function xk(n,e){if(typeof n!="string")throw new Ia("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(kk(n.split(".")[t]))}catch(r){throw new Ia("Invalid token specified: "+r.message)}}Ia.prototype=new Error,Ia.prototype.name="InvalidTokenError";function gg(n,e){return function(){return n.apply(e,arguments)}}const{toString:Ek}=Object.prototype,{getPrototypeOf:Ah}=Object,Za=(n=>e=>{const t=Ek.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),rr=n=>(n=n.toLowerCase(),e=>Za(e)===n),ec=n=>e=>typeof e===n,{isArray:Xi}=Array,No=ec("undefined");function _k(n){return n!==null&&!No(n)&&n.constructor!==null&&!No(n.constructor)&&$n(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const mg=rr("ArrayBuffer");function $k(n){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&mg(n.buffer),e}const Ok=ec("string"),$n=ec("function"),vg=ec("number"),tc=n=>n!==null&&typeof n=="object",Ak=n=>n===!0||n===!1,Qs=n=>{if(Za(n)!=="object")return!1;const e=Ah(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Sk=rr("Date"),Tk=rr("File"),Pk=rr("Blob"),jk=rr("FileList"),Ck=n=>tc(n)&&$n(n.pipe),Rk=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||$n(n.append)&&((e=Za(n))==="formdata"||e==="object"&&$n(n.toString)&&n.toString()==="[object FormData]"))},Ik=rr("URLSearchParams"),Nk=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function os(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n=="undefined")return;let r,i;if(typeof n!="object"&&(n=[n]),Xi(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const o=t?Object.getOwnPropertyNames(n):Object.keys(n),s=o.length;let a;for(r=0;r<s;r++)a=o[r],e.call(null,n[a],a,n)}}function bg(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const wg=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),kg=n=>!No(n)&&n!==wg;function lu(){const{caseless:n}=kg(this)&&this||{},e={},t=(r,i)=>{const o=n&&bg(e,i)||i;Qs(e[o])&&Qs(r)?e[o]=lu(e[o],r):Qs(r)?e[o]=lu({},r):Xi(r)?e[o]=r.slice():e[o]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&os(arguments[r],t);return e}const Bk=(n,e,t,{allOwnKeys:r}={})=>(os(e,(i,o)=>{t&&$n(i)?n[o]=gg(i,t):n[o]=i},{allOwnKeys:r}),n),Lk=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Dk=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},Uk=(n,e,t,r)=>{let i,o,s;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),o=i.length;o-- >0;)s=i[o],(!r||r(s,n,e))&&!a[s]&&(e[s]=n[s],a[s]=!0);n=t!==!1&&Ah(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},qk=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},Vk=n=>{if(!n)return null;if(Xi(n))return n;let e=n.length;if(!vg(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},Mk=(n=>e=>n&&e instanceof n)(typeof Uint8Array!="undefined"&&Ah(Uint8Array)),Fk=(n,e)=>{const t=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=t.next())&&!r.done;){const i=r.value;e.call(n,i[0],i[1])}},Wk=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},zk=rr("HTMLFormElement"),Kk=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),Bf=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Hk=rr("RegExp"),xg=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};os(t,(i,o)=>{e(i,o,n)!==!1&&(r[o]=i)}),Object.defineProperties(n,r)},Jk=n=>{xg(n,(e,t)=>{if($n(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if($n(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Yk=(n,e)=>{const t={},r=i=>{i.forEach(o=>{t[o]=!0})};return Xi(n)?r(n):r(String(n).split(e)),t},Gk=()=>{},Xk=(n,e)=>(n=+n,Number.isFinite(n)?n:e),il="abcdefghijklmnopqrstuvwxyz",Lf="0123456789",Eg={DIGIT:Lf,ALPHA:il,ALPHA_DIGIT:il+il.toUpperCase()+Lf},Qk=(n=16,e=Eg.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function Zk(n){return!!(n&&$n(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const ex=n=>{const e=new Array(10),t=(r,i)=>{if(tc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const o=Xi(r)?[]:{};return os(r,(s,a)=>{const c=t(s,i+1);!No(c)&&(o[a]=c)}),e[i]=void 0,o}}return r};return t(n,0)},tx=rr("AsyncFunction"),nx=n=>n&&(tc(n)||$n(n))&&$n(n.then)&&$n(n.catch),X={isArray:Xi,isArrayBuffer:mg,isBuffer:_k,isFormData:Rk,isArrayBufferView:$k,isString:Ok,isNumber:vg,isBoolean:Ak,isObject:tc,isPlainObject:Qs,isUndefined:No,isDate:Sk,isFile:Tk,isBlob:Pk,isRegExp:Hk,isFunction:$n,isStream:Ck,isURLSearchParams:Ik,isTypedArray:Mk,isFileList:jk,forEach:os,merge:lu,extend:Bk,trim:Nk,stripBOM:Lk,inherits:Dk,toFlatObject:Uk,kindOf:Za,kindOfTest:rr,endsWith:qk,toArray:Vk,forEachEntry:Fk,matchAll:Wk,isHTMLForm:zk,hasOwnProperty:Bf,hasOwnProp:Bf,reduceDescriptors:xg,freezeMethods:Jk,toObjectSet:Yk,toCamelCase:Kk,noop:Gk,toFiniteNumber:Xk,findKey:bg,global:wg,isContextDefined:kg,ALPHABET:Eg,generateString:Qk,isSpecCompliantForm:Zk,toJSONObject:ex,isAsyncFn:tx,isThenable:nx};function Ue(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}X.inherits(Ue,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:X.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const _g=Ue.prototype,$g={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{$g[n]={value:n}});Object.defineProperties(Ue,$g);Object.defineProperty(_g,"isAxiosError",{value:!0});Ue.from=(n,e,t,r,i,o)=>{const s=Object.create(_g);return X.toFlatObject(n,s,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),Ue.call(s,n.message,e,t,r,i),s.cause=n,s.name=n.name,o&&Object.assign(s,o),s};const rx=null;function uu(n){return X.isPlainObject(n)||X.isArray(n)}function Og(n){return X.endsWith(n,"[]")?n.slice(0,-2):n}function Df(n,e,t){return n?n.concat(e).map(function(r,i){return r=Og(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function ix(n){return X.isArray(n)&&!n.some(uu)}const ox=X.toFlatObject(X,{},null,function(n){return/^is[A-Z]/.test(n)});function nc(n,e,t){if(!X.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=X.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(d,f){return!X.isUndefined(f[d])});const r=t.metaTokens,i=t.visitor||l,o=t.dots,s=t.indexes,a=(t.Blob||typeof Blob!="undefined"&&Blob)&&X.isSpecCompliantForm(e);if(!X.isFunction(i))throw new TypeError("visitor must be a function");function c(d){if(d===null)return"";if(X.isDate(d))return d.toISOString();if(!a&&X.isBlob(d))throw new Ue("Blob is not supported. Use a Buffer instead.");return X.isArrayBuffer(d)||X.isTypedArray(d)?a&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function l(d,f,p){let v=d;if(d&&!p&&typeof d=="object"){if(X.endsWith(f,"{}"))f=r?f:f.slice(0,-2),d=JSON.stringify(d);else if(X.isArray(d)&&ix(d)||(X.isFileList(d)||X.endsWith(f,"[]"))&&(v=X.toArray(d)))return f=Og(f),v.forEach(function(w,S){!(X.isUndefined(w)||w===null)&&e.append(s===!0?Df([f],S,o):s===null?f:f+"[]",c(w))}),!1}return uu(d)?!0:(e.append(Df(p,f,o),c(d)),!1)}const u=[],h=Object.assign(ox,{defaultVisitor:l,convertValue:c,isVisitable:uu});function y(d,f){if(!X.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+f.join("."));u.push(d),X.forEach(d,function(p,v){(!(X.isUndefined(p)||p===null)&&i.call(e,p,X.isString(v)?v.trim():v,f,h))===!0&&y(p,f?f.concat(v):[v])}),u.pop()}}if(!X.isObject(n))throw new TypeError("data must be an object");return y(n),e}function Uf(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Sh(n,e){this._pairs=[],n&&nc(n,this,e)}const Ag=Sh.prototype;Ag.append=function(n,e){this._pairs.push([n,e])};Ag.toString=function(n){const e=n?function(t){return n.call(this,t,Uf)}:Uf;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};function sx(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Sg(n,e,t){if(!e)return n;const r=t&&t.encode||sx,i=t&&t.serialize;let o;if(i?o=i(e,t):o=X.isURLSearchParams(e)?e.toString():new Sh(e,t).toString(r),o){const s=n.indexOf("#");s!==-1&&(n=n.slice(0,s)),n+=(n.indexOf("?")===-1?"?":"&")+o}return n}class ax{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){X.forEach(this.handlers,function(t){t!==null&&e(t)})}}const qf=ax,Tg={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},cx=typeof URLSearchParams!="undefined"?URLSearchParams:Sh,lx=typeof FormData!="undefined"?FormData:null,ux=typeof Blob!="undefined"?Blob:null,hx=(()=>{let n;return typeof navigator!="undefined"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),dx=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Jn={isBrowser:!0,classes:{URLSearchParams:cx,FormData:lx,Blob:ux},isStandardBrowserEnv:hx,isStandardBrowserWebWorkerEnv:dx,protocols:["http","https","file","blob","url","data"]};function fx(n,e){return nc(n,new Jn.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,o){return Jn.isNode&&X.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function px(n){return X.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function yx(n){const e={},t=Object.keys(n);let r;const i=t.length;let o;for(r=0;r<i;r++)o=t[r],e[o]=n[o];return e}function Pg(n){function e(t,r,i,o){let s=t[o++];const a=Number.isFinite(+s),c=o>=t.length;return s=!s&&X.isArray(i)?i.length:s,c?(X.hasOwnProp(i,s)?i[s]=[i[s],r]:i[s]=r,!a):((!i[s]||!X.isObject(i[s]))&&(i[s]=[]),e(t,r,i[s],o)&&X.isArray(i[s])&&(i[s]=yx(i[s])),!a)}if(X.isFormData(n)&&X.isFunction(n.entries)){const t={};return X.forEachEntry(n,(r,i)=>{e(px(r),i,t,0)}),t}return null}const gx={"Content-Type":void 0};function mx(n,e,t){if(X.isString(n))try{return(e||JSON.parse)(n),X.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const rc={transitional:Tg,adapter:["xhr","http"],transformRequest:[function(n,e){const t=e.getContentType()||"",r=t.indexOf("application/json")>-1,i=X.isObject(n);if(i&&X.isHTMLForm(n)&&(n=new FormData(n)),X.isFormData(n))return r&&r?JSON.stringify(Pg(n)):n;if(X.isArrayBuffer(n)||X.isBuffer(n)||X.isStream(n)||X.isFile(n)||X.isBlob(n))return n;if(X.isArrayBufferView(n))return n.buffer;if(X.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let o;if(i){if(t.indexOf("application/x-www-form-urlencoded")>-1)return fx(n,this.formSerializer).toString();if((o=X.isFileList(n))||t.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return nc(o?{"files[]":n}:n,s&&new s,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),mx(n)):n}],transformResponse:[function(n){const e=this.transitional||rc.transitional,t=e&&e.forcedJSONParsing,r=this.responseType==="json";if(n&&X.isString(n)&&(t&&!this.responseType||r)){const i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(n)}catch(o){if(i)throw o.name==="SyntaxError"?Ue.from(o,Ue.ERR_BAD_RESPONSE,this,null,this.response):o}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Jn.classes.FormData,Blob:Jn.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};X.forEach(["delete","get","head"],function(n){rc.headers[n]={}});X.forEach(["post","put","patch"],function(n){rc.headers[n]=X.merge(gx)});const Th=rc,vx=X.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),bx=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),r=o.substring(i+1).trim(),!(!t||e[t]&&vx[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},Vf=Symbol("internals");function fo(n){return n&&String(n).trim().toLowerCase()}function Zs(n){return n===!1||n==null?n:X.isArray(n)?n.map(Zs):String(n)}function wx(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const kx=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function ol(n,e,t,r,i){if(X.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!X.isString(e)){if(X.isString(r))return e.indexOf(r)!==-1;if(X.isRegExp(r))return r.test(e)}}function xx(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function Ex(n,e){const t=X.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,o,s){return this[r].call(this,e,i,o,s)},configurable:!0})})}class ic{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function o(a,c,l){const u=fo(c);if(!u)throw new Error("header name must be a non-empty string");const h=X.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||c]=Zs(a))}const s=(a,c)=>X.forEach(a,(l,u)=>o(l,u,c));return X.isPlainObject(e)||e instanceof this.constructor?s(e,t):X.isString(e)&&(e=e.trim())&&!kx(e)?s(bx(e),t):e!=null&&o(t,e,r),this}get(e,t){if(e=fo(e),e){const r=X.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return wx(i);if(X.isFunction(t))return t.call(this,i,r);if(X.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=fo(e),e){const r=X.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||ol(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function o(s){if(s=fo(s),s){const a=X.findKey(r,s);a&&(!t||ol(r,r[a],a,t))&&(delete r[a],i=!0)}}return X.isArray(e)?e.forEach(o):o(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const o=t[r];(!e||ol(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){const t=this,r={};return X.forEach(this,(i,o)=>{const s=X.findKey(r,o);if(s){t[s]=Zs(i),delete t[o];return}const a=e?xx(o):String(o).trim();a!==o&&delete t[o],t[a]=Zs(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return X.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&X.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const t=(this[Vf]=this[Vf]={accessors:{}}).accessors,r=this.prototype;function i(o){const s=fo(o);t[s]||(Ex(r,o),t[s]=!0)}return X.isArray(e)?e.forEach(i):i(e),this}}ic.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);X.freezeMethods(ic.prototype);X.freezeMethods(ic);const fr=ic;function sl(n,e){const t=this||Th,r=e||t,i=fr.from(r.headers);let o=r.data;return X.forEach(n,function(s){o=s.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function jg(n){return!!(n&&n.__CANCEL__)}function ss(n,e,t){Ue.call(this,n==null?"canceled":n,Ue.ERR_CANCELED,e,t),this.name="CanceledError"}X.inherits(ss,Ue,{__CANCEL__:!0});function _x(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Ue("Request failed with status code "+t.status,[Ue.ERR_BAD_REQUEST,Ue.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const $x=Jn.isStandardBrowserEnv?function(){return{write:function(n,e,t,r,i,o){const s=[];s.push(n+"="+encodeURIComponent(e)),X.isNumber(t)&&s.push("expires="+new Date(t).toGMTString()),X.isString(r)&&s.push("path="+r),X.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read:function(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function Ox(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Ax(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}function Cg(n,e){return n&&!Ox(e)?Ax(n,e):e}const Sx=Jn.isStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let t;function r(i){let o=i;return n&&(e.setAttribute("href",o),o=e.href),e.setAttribute("href",o),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return t=r(window.location.href),function(i){const o=X.isString(i)?r(i):i;return o.protocol===t.protocol&&o.host===t.host}}():function(){return function(){return!0}}();function Tx(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Px(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,o=0,s;return e=e!==void 0?e:1e3,function(a){const c=Date.now(),l=r[o];s||(s=c),t[i]=a,r[i]=c;let u=o,h=0;for(;u!==i;)h+=t[u++],u=u%n;if(i=(i+1)%n,i===o&&(o=(o+1)%n),c-s<e)return;const y=l&&c-l;return y?Math.round(h*1e3/y):void 0}}function Mf(n,e){let t=0;const r=Px(50,250);return i=>{const o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-t,c=r(a),l=o<=s;t=o;const u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&l?(s-o)/c:void 0,event:i};u[e?"download":"upload"]=!0,n(u)}}const jx=typeof XMLHttpRequest!="undefined",Cx=jx&&function(n){return new Promise(function(e,t){let r=n.data;const i=fr.from(n.headers).normalize(),o=n.responseType;let s;function a(){n.cancelToken&&n.cancelToken.unsubscribe(s),n.signal&&n.signal.removeEventListener("abort",s)}X.isFormData(r)&&(Jn.isStandardBrowserEnv||Jn.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(n.auth){const y=n.auth.username||"",d=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";i.set("Authorization","Basic "+btoa(y+":"+d))}const l=Cg(n.baseURL,n.url);c.open(n.method.toUpperCase(),Sg(l,n.params,n.paramsSerializer),!0),c.timeout=n.timeout;function u(){if(!c)return;const y=fr.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),d={data:!o||o==="text"||o==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:y,config:n,request:c};_x(function(f){e(f),a()},function(f){t(f),a()},d),c=null}if("onloadend"in c?c.onloadend=u:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(u)},c.onabort=function(){!c||(t(new Ue("Request aborted",Ue.ECONNABORTED,n,c)),c=null)},c.onerror=function(){t(new Ue("Network Error",Ue.ERR_NETWORK,n,c)),c=null},c.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const d=n.transitional||Tg;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),t(new Ue(y,d.clarifyTimeoutError?Ue.ETIMEDOUT:Ue.ECONNABORTED,n,c)),c=null},Jn.isStandardBrowserEnv){const y=(n.withCredentials||Sx(l))&&n.xsrfCookieName&&$x.read(n.xsrfCookieName);y&&i.set(n.xsrfHeaderName,y)}r===void 0&&i.setContentType(null),"setRequestHeader"in c&&X.forEach(i.toJSON(),function(y,d){c.setRequestHeader(d,y)}),X.isUndefined(n.withCredentials)||(c.withCredentials=!!n.withCredentials),o&&o!=="json"&&(c.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&c.addEventListener("progress",Mf(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",Mf(n.onUploadProgress)),(n.cancelToken||n.signal)&&(s=y=>{!c||(t(!y||y.type?new ss(null,n,c):y),c.abort(),c=null)},n.cancelToken&&n.cancelToken.subscribe(s),n.signal&&(n.signal.aborted?s():n.signal.addEventListener("abort",s)));const h=Tx(l);if(h&&Jn.protocols.indexOf(h)===-1){t(new Ue("Unsupported protocol "+h+":",Ue.ERR_BAD_REQUEST,n));return}c.send(r||null)})},ea={http:rx,xhr:Cx};X.forEach(ea,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch(t){}Object.defineProperty(n,"adapterName",{value:e})}});const Rx={getAdapter:n=>{n=X.isArray(n)?n:[n];const{length:e}=n;let t,r;for(let i=0;i<e&&(t=n[i],!(r=X.isString(t)?ea[t.toLowerCase()]:t));i++);if(!r)throw r===!1?new Ue(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(X.hasOwnProp(ea,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!X.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:ea};function al(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new ss(null,n)}function Ff(n){return al(n),n.headers=fr.from(n.headers),n.data=sl.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Rx.getAdapter(n.adapter||Th.adapter)(n).then(function(e){return al(n),e.data=sl.call(n,n.transformResponse,e),e.headers=fr.from(e.headers),e},function(e){return jg(e)||(al(n),e&&e.response&&(e.response.data=sl.call(n,n.transformResponse,e.response),e.response.headers=fr.from(e.response.headers))),Promise.reject(e)})}const Wf=n=>n instanceof fr?n.toJSON():n;function Vi(n,e){e=e||{};const t={};function r(l,u,h){return X.isPlainObject(l)&&X.isPlainObject(u)?X.merge.call({caseless:h},l,u):X.isPlainObject(u)?X.merge({},u):X.isArray(u)?u.slice():u}function i(l,u,h){if(X.isUndefined(u)){if(!X.isUndefined(l))return r(void 0,l,h)}else return r(l,u,h)}function o(l,u){if(!X.isUndefined(u))return r(void 0,u)}function s(l,u){if(X.isUndefined(u)){if(!X.isUndefined(l))return r(void 0,l)}else return r(void 0,u)}function a(l,u,h){if(h in e)return r(l,u);if(h in n)return r(void 0,l)}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(l,u)=>i(Wf(l),Wf(u),!0)};return X.forEach(Object.keys(Object.assign({},n,e)),function(l){const u=c[l]||i,h=u(n[l],e[l],l);X.isUndefined(h)&&u!==a||(t[l]=h)}),t}const Rg="1.4.0",Ph={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Ph[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const zf={};Ph.transitional=function(n,e,t){function r(i,o){return"[Axios v"+Rg+"] Transitional option '"+i+"'"+o+(t?". "+t:"")}return(i,o,s)=>{if(n===!1)throw new Ue(r(o," has been removed"+(e?" in "+e:"")),Ue.ERR_DEPRECATED);return e&&!zf[o]&&(zf[o]=!0,console.warn(r(o," has been deprecated since v"+e+" and will be removed in the near future"))),n?n(i,o,s):!0}};function Ix(n,e,t){if(typeof n!="object")throw new Ue("options must be an object",Ue.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const o=r[i],s=e[o];if(s){const a=n[o],c=a===void 0||s(a,o,n);if(c!==!0)throw new Ue("option "+o+" must be "+c,Ue.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ue("Unknown option "+o,Ue.ERR_BAD_OPTION)}}const hu={assertOptions:Ix,validators:Ph},$r=hu.validators;class Na{constructor(e){this.defaults=e,this.interceptors={request:new qf,response:new qf}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Vi(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:o}=t;r!==void 0&&hu.assertOptions(r,{silentJSONParsing:$r.transitional($r.boolean),forcedJSONParsing:$r.transitional($r.boolean),clarifyTimeoutError:$r.transitional($r.boolean)},!1),i!=null&&(X.isFunction(i)?t.paramsSerializer={serialize:i}:hu.assertOptions(i,{encode:$r.function,serialize:$r.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s;s=o&&X.merge(o.common,o[t.method]),s&&X.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),t.headers=fr.concat(s,o);const a=[];let c=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(t)===!1||(c=c&&f.synchronous,a.unshift(f.fulfilled,f.rejected))});const l=[];this.interceptors.response.forEach(function(f){l.push(f.fulfilled,f.rejected)});let u,h=0,y;if(!c){const f=[Ff.bind(this),void 0];for(f.unshift.apply(f,a),f.push.apply(f,l),y=f.length,u=Promise.resolve(t);h<y;)u=u.then(f[h++],f[h++]);return u}y=a.length;let d=t;for(h=0;h<y;){const f=a[h++],p=a[h++];try{d=f(d)}catch(v){p.call(this,v);break}}try{u=Ff.call(this,d)}catch(f){return Promise.reject(f)}for(h=0,y=l.length;h<y;)u=u.then(l[h++],l[h++]);return u}getUri(e){e=Vi(this.defaults,e);const t=Cg(e.baseURL,e.url);return Sg(t,e.params,e.paramsSerializer)}}X.forEach(["delete","get","head","options"],function(n){Na.prototype[n]=function(e,t){return this.request(Vi(t||{},{method:n,url:e,data:(t||{}).data}))}});X.forEach(["post","put","patch"],function(n){function e(t){return function(r,i,o){return this.request(Vi(o||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Na.prototype[n]=e(),Na.prototype[n+"Form"]=e(!0)});const ta=Na;class jh{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](i);r._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(a=>{r.subscribe(a),o=a}).then(i);return s.cancel=function(){r.unsubscribe(o)},s},e(function(i,o,s){r.reason||(r.reason=new ss(i,o,s),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new jh(function(t){e=t}),cancel:e}}}const Nx=jh;function Bx(n){return function(e){return n.apply(null,e)}}function Lx(n){return X.isObject(n)&&n.isAxiosError===!0}const du={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(du).forEach(([n,e])=>{du[e]=n});const Dx=du;function Ig(n){const e=new ta(n),t=gg(ta.prototype.request,e);return X.extend(t,ta.prototype,e,{allOwnKeys:!0}),X.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return Ig(Vi(n,r))},t}const vt=Ig(Th);vt.Axios=ta;vt.CanceledError=ss;vt.CancelToken=Nx;vt.isCancel=jg;vt.VERSION=Rg;vt.toFormData=nc;vt.AxiosError=Ue;vt.Cancel=vt.CanceledError;vt.all=function(n){return Promise.all(n)};vt.spread=Bx;vt.isAxiosError=Lx;vt.mergeConfig=Vi;vt.AxiosHeaders=fr;vt.formToJSON=n=>Pg(X.isHTMLForm(n)?new FormData(n):n);vt.HttpStatusCode=Dx;vt.default=vt;const Ux=vt,Kf={init:({API_KEY:n})=>(...e)=>z(void 0,[...e],function*(t="post",r="/",i={},o={}){var s,a,c,l;const u=localStorage.getItem("accessToken");let h={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};u&&(h.Authorization="Bearer "+u);const y=r;o!=null&&o.headers&&(h=Object.assign(...h,...o.headers),delete o.headers);const d=Object.assign({mode:"cors",method:t,url:y,data:i,headers:h},o);let f={};try{const p=yield Ux(d);f.data=((s=p==null?void 0:p.data)==null?void 0:s.data)||(p==null?void 0:p.data),p!=null&&p.error&&(f.error=p.error),f.data||(f.data={})}catch(p){f.error=((c=(a=p.response)==null?void 0:a.data)==null?void 0:c.error)||((l=p.response)==null?void 0:l.error),f.error||(f.error={})}return f})};let Ss;const qx=new Uint8Array(16);function Vx(){if(!Ss&&(Ss=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ss))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ss(qx)}const jt=[];for(let n=0;n<256;++n)jt.push((n+256).toString(16).slice(1));function Mx(n,e=0){return(jt[n[e+0]]+jt[n[e+1]]+jt[n[e+2]]+jt[n[e+3]]+"-"+jt[n[e+4]]+jt[n[e+5]]+"-"+jt[n[e+6]]+jt[n[e+7]]+"-"+jt[n[e+8]]+jt[n[e+9]]+"-"+jt[n[e+10]]+jt[n[e+11]]+jt[n[e+12]]+jt[n[e+13]]+jt[n[e+14]]+jt[n[e+15]]).toLowerCase()}const Fx=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Hf={randomUUID:Fx};function Wx(n,e,t){if(Hf.randomUUID&&!e&&!n)return Hf.randomUUID();n=n||{};const r=n.random||(n.rng||Vx)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return Mx(r)}var zx={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function o(c,l,u,h,y){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new i(u,h||c,y),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],d]:c._events[f].push(d):(c._events[f]=d,c._eventsCount++),c}function s(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],l,u;if(this._eventsCount===0)return c;for(u in l=this._events)e.call(l,u)&&c.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},a.prototype.listeners=function(c){var l=t?t+c:c,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,y=u.length,d=new Array(y);h<y;h++)d[h]=u[h].fn;return d},a.prototype.listenerCount=function(c){var l=t?t+c:c,u=this._events[l];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,l,u,h,y,d){var f=t?t+c:c;if(!this._events[f])return!1;var p=this._events[f],v=arguments.length,w,S;if(p.fn){switch(p.once&&this.removeListener(c,p.fn,void 0,!0),v){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,l),!0;case 3:return p.fn.call(p.context,l,u),!0;case 4:return p.fn.call(p.context,l,u,h),!0;case 5:return p.fn.call(p.context,l,u,h,y),!0;case 6:return p.fn.call(p.context,l,u,h,y,d),!0}for(S=1,w=new Array(v-1);S<v;S++)w[S-1]=arguments[S];p.fn.apply(p.context,w)}else{var R=p.length,j;for(S=0;S<R;S++)switch(p[S].once&&this.removeListener(c,p[S].fn,void 0,!0),v){case 1:p[S].fn.call(p[S].context);break;case 2:p[S].fn.call(p[S].context,l);break;case 3:p[S].fn.call(p[S].context,l,u);break;case 4:p[S].fn.call(p[S].context,l,u,h);break;default:if(!w)for(j=1,w=new Array(v-1);j<v;j++)w[j-1]=arguments[j];p[S].fn.apply(p[S].context,w)}}return!0},a.prototype.on=function(c,l,u){return o(this,c,l,u,!1)},a.prototype.once=function(c,l,u){return o(this,c,l,u,!0)},a.prototype.removeListener=function(c,l,u,h){var y=t?t+c:c;if(!this._events[y])return this;if(!l)return s(this,y),this;var d=this._events[y];if(d.fn)d.fn===l&&(!h||d.once)&&(!u||d.context===u)&&s(this,y);else{for(var f=0,p=[],v=d.length;f<v;f++)(d[f].fn!==l||h&&!d[f].once||u&&d[f].context!==u)&&p.push(d[f]);p.length?this._events[y]=p.length===1?p[0]:p:s(this,y)}return this},a.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&s(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(zx);function cl(n,e){try{n(e)}catch(t){console.error("Error in subscription callback",t)}}const Or=Symbol("subscriptions"),Ar=Symbol("oneTimeEvents");class Mi{constructor(){this[Or]=[],this[Ar]=new Map}on(e,t){return this[Ar].has(e)?cl(t,this[Ar].get(e)):(this[Or].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[Or]=this[Or].filter(r=>r.event!==e||t&&r.callback!==t),this}once(e,t){return new Promise(r=>{const i=o=>{r(o),t==null||t(o)};this[Ar].has(e)?cl(i,this[Ar].get(e)):this[Or].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[Ar].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let r=0;r<this[Or].length;r++){const i=this[Or][r];i.event===e&&(cl(i.callback,t),i.once&&(this[Or].splice(r,1),r--))}return this}emitOnce(e,t){if(this[Ar].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[Ar].set(e,t),this.off(e),this}pipe(e,t){this.on(e,r=>{t.emit(e,r)})}pipeOnce(e,t){this.once(e,r=>{t.emitOnce(e,r)})}}function Sr(n){return n=n.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),n.length===0?[]:n.split("/").map(e=>e.startsWith("[")?parseInt(e.slice(1,-1)):e)}class H{static get(e){return new H(e)}static getChildPath(e,t){return H.get(e).child(t).path}static getPathKeys(e){return Sr(e)}constructor(e){typeof e=="string"?this.keys=Sr(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,r,i)=>i===0?`${r}`:typeof r=="string"?`${t}/${r}`:`${t}[${r}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new H(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=Sr(e);t.forEach(r=>{if(typeof r=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(r))throw new Error(`Invalid child key "${r}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(r.length>128)throw new Error(`child key "${r}" for path "${this.path}" is too long. Max key length is 128`);if(r.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new H(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const r=Sr(e),i=Sr(t);let o=0;const s={get length(){return o}};return r.forEach((a,c)=>{const l=i[c];if(a==="*")s[o++]=l;else if(typeof a=="string"&&a[0]==="$"){s[o++]=l,s[a]=l;const u=a.slice(1);typeof s[u]=="undefined"&&(s[u]=l)}}),s}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const r=Sr(e),i=Sr(t),o=r.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let s="";return o.forEach(a=>{typeof a=="number"?s+=`[${a}]`:(s.length>0&&(s+="/"),s+=a)}),s}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const r=Sr(e);let i=0;return r.reduce((o,s)=>typeof s=="string"&&(s==="*"||s.startsWith("$"))?H.getChildPath(o,t[i++]):H.getChildPath(o,s),"")}equals(e){const t=e instanceof H?e:new H(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isAncestorOf(e){const t=e instanceof H?e:new H(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isDescendantOf(e){const t=e instanceof H?e:new H(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((r,i)=>{const o=this.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isOnTrailOf(e){const t=e instanceof H?e:new H(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((r,i)=>{if(i>=t.keys.length)return!0;const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isChildOf(e){const t=e instanceof H?e:new H(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof H?e:new H(e);return t.path===""?!1:this.equals(t.parent)}}function ll(n,e,t=!1){if(!n.exists())return null;let r=t?n.previous():n.val();return typeof e=="number"?r[e]:(H.getPathKeys(e).every(i=>(r=r[i],typeof r!="undefined")),r||null)}function ul(n){if(!n.exists())return[];const e=n.val();return e instanceof Array?new Array(e.length).map((t,r)=>r):typeof e=="object"?Object.keys(e):[]}class Ze{exists(){return!1}constructor(e,t,r=!1,i,o){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>r?!1:t!==null&&typeof t!="undefined",this.context=()=>o||{}}static for(e,t){return new Ze(e,t)}child(e){const t=ll(this,e,!1),r=ll(this,e,!0);return new Ze(this.ref.child(e),t,!1,r)}hasChild(e){return ll(this,e)!==null}hasChildren(){return ul(this).length>0}numChildren(){return ul(this).length}forEach(e){const t=this.val(),r=this.previous();return ul(this).every(i=>{const o=new Ze(this.ref.child(i),t[i],!1,r[i]);return e(o)})}get key(){return this.ref.key}}class na extends Ze{constructor(e,t,r){super(e,t,!1,void 0,r),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(t=>{const r=t.target.reduce((o,s)=>o.child(s),this.ref),i=new Ze(r,t.val,!1,t.prev);return e(i)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],r=t.target.reduce((i,o)=>i.child(o),this.ref);return new Ze(r,t.val,!1,t.prev)}}class Ng{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,r)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return r(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:r})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const r=this._internal.activatePromises.shift();e?(r.callback&&r.callback(!0),r.resolve&&r.resolve()):(r.callback&&r.callback(!1,t),r.reject&&r.reject(t))}}}class Kx{constructor(e,t,r){this.publish=e,this.start=t,this.cancel=r}}class Hx{constructor(e){const t=[];let r,i;const o="stopped (no more subscribers)";this.subscribe=(h,y)=>{if(typeof h!="function")throw new TypeError("callback must be a function");if(i===o)throw new Error("stream can't be used anymore because all subscribers were stopped");const d={callback:h,activationCallback:function(f,p){y==null||y(f,p),this.subscription._setActivationState(f,p)},subscription:new Ng(function(){return t.splice(t.indexOf(this),1),s()})};return t.push(d),typeof i!="undefined"&&(i===!0?(y==null||y(!0),d.subscription._setActivationState(!0)):typeof i=="string"&&(y==null||y(!1,i),d.subscription._setActivationState(!1,i))),d.subscription};const s=()=>{let h;return t.length===0&&(h=r==null?void 0:r(),i=o),Promise.resolve(h)};this.unsubscribe=h=>{(h?t.filter(y=>y.callback===h):t).forEach(y=>{const d=t.indexOf(y);t.splice(d,1)}),s()},this.stop=()=>{t.splice(0),s()};const a=h=>(t.forEach(y=>{try{y.callback(h)}catch(d){console.error(`Error running subscriber callback: ${d.message}`)}}),t.length===0&&s(),t.length>0),c=h=>{i=!0,r=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!0)})},l=h=>{i=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!1,h||new Error("unknown reason"))}),t.splice(0)},u=new Kx(a,c,l);e(u)}}function Ch(n,e){const t="000000000"+n;return t.substr(t.length-e)}const Jx=typeof window=="object"?window:self,Yx=Object.keys(Jx).length;var Jf,Yf;const Gx=(Yf=(Jf=navigator.mimeTypes)==null?void 0:Jf.length)!=null?Yf:0,Xx=Ch((Gx+navigator.userAgent.length).toString(36)+Yx.toString(36),4);function Qx(){return Xx}let po=0;const Rh=4,Ba=36,Bg=Math.pow(Ba,Rh);function Gf(){return Ch((Math.random()*Bg<<0).toString(Ba),Rh)}function Zx(){return po=po<Bg?po:0,po++,po-1}function eE(n=0){const e="c",t=(new Date().getTime()+n).toString(Ba),r=Ch(Zx().toString(Ba),Rh),i=Qx(),o=Gf()+Gf();return e+t+r+i+o}let Xf=0;class Nt{static set timeBias(e){typeof e=="number"&&(Xf=e)}static generate(){return eE(Xf).slice(1)}}class et{constructor(e){this.path=e}}const bn={nextTick(n){setTimeout(n,0)}};class La{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function tE(n){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,n),new Array(...e)}function nE(n){if((Array.isArray(n)?n.length:n.byteLength)!==8)throw new TypeError("must be 8 bytes");const e=new Uint8Array(n);return new DataView(e.buffer).getFloat64(0)}const Ur={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function rE(n){if(typeof n!="bigint")throw new Error("number must be a bigint");const e=[],t=n<Ur.zero;do{const r=Number(n&Ur.ff);e.push(r),n=n>>Ur.eight}while(n!==(t?-Ur.one:Ur.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function iE(n){const e=n[0]>=128;let t=Ur.zero;for(let r of n)e&&(r=~r&255),t=(t<<Ur.eight)+BigInt(r);return e&&(t=-(t+Ur.one)),t}function oE(n){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(n);if(typeof Buffer=="function"){const e=Buffer.from(n,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r>128){if((r&55296)===55296){const i=n.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const o=r&1023,s=i&1023;r=65536|o<<10|s}if(r<2048){const i=192|r>>6&31,o=128|r&63;e.push(i,o)}else if(r<65536){const i=224|r>>12&15,o=128|r>>6&63,s=128|r&63;e.push(i,o,s)}else if(r<2097152){const i=240|r>>18&7,o=128|r>>12&63,s=128|r>>6&63,a=128|r&63;e.push(i,o,s,a)}else throw new Error(`Cannot convert character ${n.charAt(t)} (code ${r}) to utf-8`)}else e.push(r<128?r:63)}return new Uint8Array(e)}}function Lg(n){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(n instanceof Uint8Array)return e.decode(n);const t=Uint8Array.from(n);return e.decode(t)}else if(typeof Buffer=="function"){if(n instanceof Array&&(n=Uint8Array.from(n)),!(n instanceof Buffer)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(n instanceof Buffer))throw new Error("Unsupported buffer argument");return n.toString("utf-8")}else{if(!(n instanceof Uint8Array)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(n instanceof Buffer||n instanceof Array||n instanceof Uint8Array){let e="";for(let t=0;t<n.length;t++){let r=n[t];if(r>128)if((r&240)===240){const i=r,o=n[t+1],s=n[t+2],a=n[t+3];r=(i&7)<<18|(o&63)<<12|(s&63)<<6|a&63,t+=3}else if((r&224)===224){const i=r,o=n[t+1],s=n[t+2];r=(i&15)<<12|(o&63)<<6|s&63,t+=2}else if((r&192)===192){const i=r,o=n[t+1];r=(i&31)<<6|o&63,t++}else throw new Error("invalid utf-8 data");if(r>=65536){r^=65536;const i=55296|r>>10,o=56320|r&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(o)}else e+=String.fromCharCode(r)}return e}else throw new Error("Unsupported buffer argument")}}function sE(n,e){const t=new n.constructor(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Bn(n,e){var t;if(((t=n==null?void 0:n.constructor)==null?void 0:t.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${n.ref.path}")`);const r=s=>(s!==null&&typeof s=="object"&&typeof s.constructor=="function"&&typeof s.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(s.constructor.name)&&(s=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)),s);if(n=r(n),typeof n!="object"||n===null||n instanceof Date||n instanceof ArrayBuffer||n instanceof et||n instanceof RegExp)return n;const i=s=>{if(e.indexOf(s)>=0)throw new ReferenceError("object contains a circular reference");return s=r(s),s===null||s instanceof Date||s instanceof ArrayBuffer||s instanceof et||s instanceof RegExp||typeof s=="object"&&(e.push(s),s=Bn(s,e),e.pop()),s};typeof e=="undefined"&&(e=[n]);const o=n instanceof Array?[]:n instanceof La?new La:{};return Object.keys(n).forEach(s=>{const a=n[s];typeof a!="function"&&(o[s]=i(a))}),o}const Wr=n=>typeof n=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(n.constructor.name);function Da(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="object"||typeof e=="object"){if(n===null||e===null)return!1;if(n instanceof et||e instanceof et)return n instanceof et&&e instanceof et&&n.path===e.path;if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime();if(n instanceof Array||e instanceof Array)return n instanceof Array&&e instanceof Array&&n.length===e.length&&n.every((i,o)=>Da(n[o],e[o]));if(Wr(n)||Wr(e)){if(!Wr(n)||!Wr(e)||n.byteLength===e.byteLength)return!1;const i=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((s,a)=>o[a]===s)}const t=Object.keys(n),r=Object.keys(e);return t.length===r.length&&t.every(i=>r.includes(i))&&t.every(i=>Da(n[i],e[i]))}return!1}class Dg{constructor(e,t,r){this.added=e,this.removed=t,this.changed=r}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(r=>r.key===e);return t?t.change:"identical"}}function Ih(n,e,t=!1){const r=[void 0,null];if(n===e)return"identical";if(r.indexOf(n)>=0&&r.indexOf(e)<0)return"added";if(r.indexOf(n)<0&&r.indexOf(e)>=0)return"removed";if(typeof n!=typeof e)return"changed";if(Wr(n)||Wr(e)){if(!Wr(n)||!Wr(e))return"changed";const i=n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===o.byteLength&&i.every((s,a)=>o[a]===s)?"identical":"changed"}else{if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime()?"identical":"changed";if(n instanceof et||e instanceof et)return n instanceof et&&e instanceof et&&n.path===e.path?"identical":"changed";if(typeof n=="object"){const i=n instanceof Array,o=h=>{let y=Object.keys(h).filter(d=>!r.includes(h[d]));return i&&(y=y.map(d=>parseInt(d))),y},s=o(n),a=o(e),c=s.filter(h=>!a.includes(h)),l=a.filter(h=>!s.includes(h)),u=a.reduce((h,y)=>{if(s.includes(y)){const d=n[y],f=e[y],p=Ih(d,f);p!=="identical"&&h.push({key:y,change:p})}return h},[]);return l.length===0&&c.length===0&&u.length===0?"identical":new Dg(l,c,t?u.sort((h,y)=>h.key<y.key?-1:1):u)}}return"changed"}function Ug(n,e,t=!1){const r=(o,s,a,c)=>{switch(s){case"identical":return[];case"changed":return[{target:o,prev:a,val:c}];case"added":return[{target:o,prev:null,val:c}];case"removed":return[{target:o,prev:a,val:null}];default:{let l=[];return s.added.forEach(u=>l.push({target:o.concat(u),prev:null,val:c[u]})),s.removed.forEach(u=>l.push({target:o.concat(u),prev:a[u],val:null})),s.changed.forEach(u=>{const h=r(o.concat(u.key),u.change,a[u.key],c[u.key]);l=l.concat(h)}),l}}},i=Ih(n,e,t);return r([],i,n,e)}function aE(n,e,t){return e=e===null?null:e[n],typeof e=="undefined"&&(e=null),t=t===null?null:t[n],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function cE(n){bn.nextTick(n)}function qg(){var n;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(n=function(){return this}())!=null?n:Function("return this")()}const Vg=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:tE,bytesToNumber:nE,bigintToBytes:rE,bytesToBigint:iE,encodeString:oE,decodeString:Lg,concatTypedArrays:sE,cloneObject:Bn,valuesAreEqual:Da,ObjectDifferences:Dg,compareValues:Ih,getMutations:Ug,getChildValues:aE,defer:cE,getGlobalObject:qg},Symbol.toStringTag,{value:"Module"})),lE="modulepreload",uE=function(n){return"/"+n},Qf={},hE=function(n,e,t){if(!e||e.length===0)return n();const r=document.getElementsByTagName("link");return Promise.all(e.map(i=>{if(i=uE(i),i in Qf)return;Qf[i]=!0;const o=i.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(t)for(let c=r.length-1;c>=0;c--){const l=r[c];if(l.href===i&&(!o||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${s}`))return;const a=document.createElement("link");if(a.rel=o?"stylesheet":lE,o||(a.as="script",a.crossOrigin=""),a.href=i,document.head.appendChild(a),o)return new Promise((c,l)=>{a.addEventListener("load",c),a.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>n())};let Mg=!1,Hr;z(void 0,null,function*(){const n=qg();if(typeof n.Observable!="undefined"){Hr=n.Observable;return}try{const{Observable:e}=yield hE(()=>Promise.resolve().then(()=>lA),void 0);Hr=e}catch(e){Hr=Bh}});function Nh(){if(Hr===Bh&&!Mg&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),Hr)return Hr;throw new Error("RxJS Observable could not be loaded. ")}function dE(n){n==="shim"?(Hr=Bh,Mg=!0):Hr=n}class Bh{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const t={next:r=>{this._subscribers.forEach(i=>{try{i(r)}catch(o){console.error("Error in subscriber callback:",o)}})}};this._cleanup=this._create(t),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class un extends Array{static areEqual(e,t){return e.length===t.length&&e.every((r,i)=>t[i]===r)}static isAncestor(e,t){return e.length<t.length&&e.every((r,i)=>t[i]===r)}static isDescendant(e,t){return e.length>t.length&&t.every((r,i)=>e[i]===r)}}const si=Symbol("isProxy");class fE{static create(e,t){return z(this,null,function*(){var r;e=new Un(e.db,e.path);let i,o=!1,s=t==null?void 0:t.cursor,a;const c=Nt.generate(),l=[],u=new Mi;u.on("cursor",g=>s=g),u.on("error",g=>{console.error(g.message,g.details)});const h=(g,b)=>{if(g.length===0)return i=b,!0;let m=i;const x=g.slice();for(;x.length>1;){const k=x.shift();if(!(k in m))return!1;m=m[k]}const O=x.shift();return b===null?m instanceof Array?m.splice(O,1):delete m[O]:m[O]=b,!0},y=()=>z(this,null,function*(){!o||(yield E())}),d=e.on("mutations",{syncFallback:y}).subscribe(g=>z(this,null,function*(){var b;if(!o)return;const m=g.context(),x=((b=m.acebase_proxy)==null?void 0:b.id)!==c;!x||(g.val(!1).every(O=>{if(!h(O.target,O.val))return!1;const k=O.target.reduce((_,A)=>_.child(A),e),$=new Ze(k,O.val,!1,O.prev,g.context());return u.emit("mutation",{snapshot:$,isRemote:x}),!0})?(u.emit("cursor",m.acebase_cursor),P.emit("mutations",{origin:"remote",snap:g})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield E()))}));let f=Promise.resolve();const p=[],v=[],w=()=>z(this,null,function*(){const g=[];for(let b=0,m=p[0];b<p.length;b++,m=p[b])v.find(x=>un.areEqual(x.target,m.target)||un.isAncestor(x.target,m.target))||(p.splice(b,1),b--,g.push(m));g.length!==0&&(g.forEach(b=>{b.value=Bn(yn(i,b.target))}),bn.nextTick(()=>{const b={acebase_proxy:{id:c,source:"update"}};g.forEach(x=>{const O=x.target.reduce(($,_)=>$.child(_),e),k=new Ze(O,x.value,!1,x.previous,b);u.emit("mutation",{snapshot:k,isRemote:!1})});const m=new na(e,g.map(x=>({target:x.target,val:x.value,prev:x.previous})),b);P.emit("mutations",{origin:"local",snap:m})}),f=g.reduce((b,m,x,O)=>(O.some(k=>un.isAncestor(k.target,m.target))||b.push(m),b),[]).reduce((b,m)=>{const x=m.target;if(x.length===0)b.push({ref:e,target:x,value:i,type:"set",previous:m.previous});else{const O=x.slice(0,-1),k=x.slice(-1)[0],$=O.reduce((C,L)=>C.child(L),e),_=b.find(C=>C.ref.path===$.path),A=yn(i,x),T=m.previous;_?(_.value[k]=A,_.previous[k]=T):b.push({ref:$,target:O,value:{[k]:A},type:"update",previous:{[k]:T}})}return b},[]).reduce((b,m)=>z(this,null,function*(){const x={acebase_proxy:{id:c,source:m.type}};yield b,yield m.ref.context(x)[m.type](m.value).catch(O=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:O});const k={acebase_proxy:{id:c,source:"update-rollback"}},$=[];if(m.type==="set"){hl(i,m.target,m.previous);const A=new Ze(m.ref,m.previous,!1,m.value,k);u.emit("mutation",{snapshot:A,isRemote:!1}),$.push({target:m.target,val:m.previous,prev:m.value})}else Object.keys(m.previous).forEach(A=>{hl(i,m.target.concat(A),m.previous[A]);const T=new Ze(m.ref.child(A),m.previous[A],!1,m.value[A],k);u.emit("mutation",{snapshot:T,isRemote:!1}),$.push({target:m.target.concat(A),val:m.previous[A],prev:m.value[A]})});$.forEach(A=>{const T=A.target.reduce((L,V)=>L.child(V),e),C=new Ze(T,A.val,!1,A.prev,k);u.emit("mutation",{snapshot:C,isRemote:!1})});const _=new na(m.ref,$,k);P.emit("mutations",{origin:"local",snap:_})}),m.ref.cursor&&u.emit("cursor",m.ref.cursor)}),f),yield f)});let S=!1;const R=[],j=()=>{let g;const b=new Promise(m=>g=m);return R.push({resolve:g}),b};let N=null;const D=()=>{N||(N=setTimeout(()=>z(this,null,function*(){S=!0,N=null,yield w(),S=!1,R.splice(0).forEach(g=>g.resolve())}),0))},q=g=>{p.find(b=>un.areEqual(b.target,g))||p.push({target:g,previous:Bn(yn(i,g))}),D()},P=new Mi,I=(g,b)=>{const m=k=>k!==null&&typeof k=="object",x=k=>z(this,null,function*(){var $;const{snap:_,origin:A}=k,T=_.context(),C=(($=T.acebase_proxy)==null?void 0:$.id)===c;if(k.origin==="remote"&&C){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const L=_.val(!1).filter(ie=>ie.target.slice(0,g.length).every((ee,fe)=>g[fe]===ee));if(L.length===0)return;let V,K;const G=L.find(ie=>ie.target.length<=g.length);if(G){const ie=g.slice(G.target.length);V=ie.reduce((ee,fe)=>!m(ee)||!(fe in ee)?null:ee[fe],G.val),K=ie.reduce((ee,fe)=>!m(ee)||!(fe in ee)?null:ee[fe],G.prev)}else{const ie=yn(i,g);V=Bn(ie),K=Bn(V),L.forEach(ee=>{const fe=ee.target.slice(g.length);for(let de=0,ne=V,ce=K;de<fe.length;de++){const Me=de+1===fe.length,ve=fe[de];Me?(ne[ve]=ee.val,ne[ve]===null&&delete ne[ve],ce[ve]=ee.prev,ce[ve]===null&&delete ce[ve]):(ne=ne[ve]=ve in ne?ne[ve]:{},ce=ce[ve]=ve in ce?ce[ve]:{})}})}bn.nextTick(()=>{let ie=!0;try{ie=b(Object.freeze(V),Object.freeze(K),!C,T)!==!1}catch(ee){u.emit("error",{source:A==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:ee})}ie===!1&&O()})});P.on("mutations",x);const O=()=>{P.off("mutations",x),l.splice(l.findIndex(k=>k.stop===O),1)};return l.push({target:g,stop:O}),{stop:O}},B=(g,b,m)=>{if(g==="write")return q(b);if(g==="onChange")return I(b,m.callback);if(g==="subscribe"||g==="observe"){const x=k=>{const $=yn(i,b);k.next($);const _=I(b,A=>{k.next(A)});return function(){_.stop()}};if(g==="subscribe")return x;const O=Nh();return new O(x)}else if(g==="transaction")return v.some(x=>un.areEqual(b,x.target)||un.isAncestor(b,x.target)||un.isDescendant(b,x.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(x=>z(this,null,function*(){p.some(k=>un.areEqual(b,k.target)||un.isAncestor(b,k.target))&&(S||D(),yield j());const O={target:b,status:"started",transaction:null};v.push(O),O.transaction={get status(){return O.status},get completed(){return O.status!=="started"},get mutations(){return p.filter(k=>un.areEqual(O.target,k.target)||un.isAncestor(O.target,k.target))},get hasMutations(){return this.mutations.length>0},commit(){return z(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${O.status}')`);O.status="finished",v.splice(v.indexOf(O),1),S&&(yield j()),D(),yield j()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${O.status}')`);O.status="canceled";const k=[];for(let $=0;$<p.length;$++){const _=p[$];(un.areEqual(O.target,_.target)||un.isAncestor(O.target,_.target))&&(p.splice($,1),$--,k.push(_))}k.reverse().forEach($=>{$.target.length===0?i=$.previous:hl(i,$.target,$.previous)}),v.splice(v.indexOf(O),1)}},x(O.transaction)}))},U=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(U.context().acebase_origin!=="cache"&&u.emit("cursor",(r=e.cursor)!=null?r:null),o=!0,i=U.val(),i===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){i=t.defaultValue;const g={acebase_proxy:{id:c,source:"default"}};yield e.context(g).set(i)}a=Fg({root:{ref:e,get cache(){return i}},target:[],id:c,flag:B});const M=()=>{if(a===null)throw new Error("Proxy was destroyed")},E=()=>z(this,null,function*(){M(),p.splice(0);const g=yield e.get({allow_cache:!1}),b=i,m=g.val();i=m;const x=Ug(b,m);if(x.length===0)return;const O=g.context();O.acebase_proxy={id:c,source:"reload"},x.forEach($=>{const _=fu(e,$.target),A=new Ze(_,$.val,$.val===null,$.prev,O);u.emit("mutation",{snapshot:A,isRemote:!0})});const k=new na(e,x,O);P.emit("mutations",{origin:"local",snap:k})});return{destroy(){return z(this,null,function*(){yield f;const g=[d.stop(),...l.map(b=>b.stop())];yield Promise.all(g),["cursor","mutation","error"].forEach(b=>u.off(b)),i=null,a=null})},stop(){this.destroy()},get value(){return M(),a},get hasValue(){return M(),i!==null},set value(g){M(),g!==null&&typeof g=="object"&&g[si]&&(g=g.valueOf()),q([]),i=g},get ref(){return e},get cursor(){return s},reload:E,onMutation(g){M(),u.off("mutation"),u.on("mutation",({snapshot:b,isRemote:m})=>{try{g(b,m)}catch(x){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:x})}})},onError(g){M(),u.off("error"),u.on("error",b=>{try{g(b)}catch(m){console.error(`Error in dataproxy onError callback: ${m.message}`)}})},on(g,b){u.on(g,b)},off(g,b){u.off(g,b)}}})}}function yn(n,e){let t=n;for(const r of e)t=typeof t=="object"&&t!==null&&r in t?t[r]:null;return t}function hl(n,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const r=e.slice(0,-1).reduce((o,s)=>o[s],n),i=e.slice(-1)[0];t===null||typeof t=="undefined"?r instanceof Array?r.splice(i,1):delete r[i]:r[i]=t}function fu(n,e){const t=H.get(n.path).childPath(e);return new Un(n.db,t)}function Fg(n){const e=fu(n.root.ref,n.target),t=[],r={get(o,s,a){if(o=yn(n.root.cache,n.target),typeof s=="symbol")if(s.toString()===Symbol.iterator.toString())s="values";else return s.toString()===si.toString()?!0:Reflect.get(o,s,a);if(s==="valueOf")return function(){return o};if(o===null||typeof o!="object")throw new Error(`Cannot read property "${s}" of ${o}. Value of path "/${e.path}" is not an object (anymore)`);o instanceof Array&&typeof s=="string"&&/^[0-9]+$/.test(s)&&(s=parseInt(s));const c=o[s];if(c===null){delete o[s];return}const l=t.find(d=>d.prop===s);if(l){if(l.typeof===typeof c)return l.value;t.splice(t.indexOf(l),1)}const u=d=>{const f=o[d],p=t.find(w=>w.prop===d);if(p){if(p.typeof===typeof f)return p.value;t.splice(t.indexOf(p),1)}if(typeof f!="object")return f;const v=Fg({root:n.root,target:n.target.concat(d),id:n.id,flag:n.flag});return t.push({typeof:typeof f,prop:d,value:v}),v},h=d=>d!==null&&typeof d=="object"&&d[si]?d.getTarget():d;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof et||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const y=o instanceof Array;if(s==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return s==="push"?function(d){const f=e.push();return n.flag("write",n.target.concat(f.key)),o[f.key]=d,f.key}:s==="getTarget"?function(d=!0){return d&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),o}:s==="getRef"?function(){return fu(n.root.ref,n.target)}:s==="forEach"?function(d){const f=Object.keys(o);let p=!1;for(let v=0;!p&&v<f.length;v++){const w=f[v],S=u(w);p=d(S,w,v)===!1}}:["values","entries","keys"].includes(s)?function*(){const d=Object.keys(o);for(const f of d)if(s==="keys")yield f;else{const p=u(f);s==="entries"?yield[f,p]:yield p}}:s==="toArray"?function(d){const f=Object.keys(o).map(p=>u(p));return d&&f.sort(d),f}:s==="onChanged"?function(d){return n.flag("onChange",n.target,{callback:d})}:s==="subscribe"?function(){return n.flag("subscribe",n.target)}:s==="getObservable"?function(){return n.flag("observe",n.target)}:s==="getOrderedCollection"?function(d,f){return new pE(this,d,f)}:s==="startTransaction"?function(){return n.flag("transaction",n.target)}:s==="remove"&&!y?function(){if(n.target.length===0)throw new Error("Can't remove proxy root value");const d=yn(n.root.cache,n.target.slice(0,-1)),f=n.target.slice(-1)[0];n.flag("write",n.target),delete d[f]}:void 0;if(typeof c=="function"){if(y){const d=p=>(n.flag("write",n.target),p()),f=p=>p.map(v=>(v=h(v),pu(v),v));if(s==="push")return function(...p){return p=f(p),d(()=>o.push(...p))};if(s==="pop")return function(){return d(()=>o.pop())};if(s==="splice")return function(p,v,...w){return w=f(w),d(()=>o.splice(p,v,...w))};if(s==="shift")return function(){return d(()=>o.shift())};if(s==="unshift")return function(...p){return p=f(p),d(()=>o.unshift(...p))};if(s==="sort")return function(p){return d(()=>o.sort(p))};if(s==="reverse")return function(){return d(()=>o.reverse())};if(["indexOf","lastIndexOf"].includes(s))return function(p,v){return p!==null&&typeof p=="object"&&p[si]&&(p=p.getTarget(!1)),o[s](p,v)};if(["forEach","every","some","filter","map"].includes(s))return function(p){return o[s]((v,w)=>p(u(w),w,i))};if(["reduce","reduceRight"].includes(s))return function(p,v){return o[s]((w,S,R)=>p(w,u(R),R,i),v)};if(["find","findIndex"].includes(s))return function(p){let v=o[s]((w,S)=>p(u(S),S,i));if(s==="find"&&v){const w=o.indexOf(v);v=u(w)}return v};if(["values","entries","keys"].includes(s))return function*(){for(let p=0;p<o.length;p++)if(s==="keys")yield p;else{const v=u(p);s==="entries"?yield[p,v]:yield v}}}return c}return u(s)},set(o,s,a,c){if(o=yn(n.root.cache,n.target),typeof s=="symbol")return Reflect.set(o,s,a,c);if(o===null||typeof o!="object")throw new Error(`Cannot set property "${s}" of ${o}. Value of path "/${e.path}" is not an object`);if(o instanceof Array&&typeof s=="string"){if(!/^[0-9]+$/.test(s))throw new Error(`Cannot set property "${s}" on array value of path "/${e.path}"`);s=parseInt(s)}return a!==null&&(typeof a=="object"&&(a[si]&&(a=a.valueOf()),a=Bn(a)),Da(a,o[s]))||(n.target.some(l=>typeof l=="number")?n.flag("write",n.target.slice(0,n.target.findIndex(l=>typeof l=="number"))):o instanceof Array?n.flag("write",n.target):n.flag("write",n.target.concat(s)),a===null?delete o[s]:(pu(a),o[s]=a)),!0},deleteProperty(o,s){if(o=yn(n.root.cache,n.target),o===null)throw new Error(`Cannot delete property ${s.toString()} of null`);return typeof s=="symbol"?Reflect.deleteProperty(o,s):(s in o&&(n.flag("write",n.target.concat(s)),delete o[s]),!0)},ownKeys(o){return o=yn(n.root.cache,n.target),Reflect.ownKeys(o)},has(o,s){return o=yn(n.root.cache,n.target),Reflect.has(o,s)},getOwnPropertyDescriptor(o,s){o=yn(n.root.cache,n.target);const a=Reflect.getOwnPropertyDescriptor(o,s);return a&&(a.configurable=!0),a},getPrototypeOf(o){return o=yn(n.root.cache,n.target),Reflect.getPrototypeOf(o)}},i=new Proxy({},r);return i}function pu(n){typeof n=="object"&&Object.keys(n).forEach(e=>{const t=n[e];t===null||typeof t=="undefined"?delete n[e]:typeof t=="object"&&pu(t)})}function ra(n){if(typeof n!="object"||!n[si])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return n}class pE{constructor(e,t="order",r=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=r,typeof e!="object"||!e[si])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(i=>typeof e[i]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(i=>typeof e[i][t]=="number")){const i=Object.keys(e);for(let o=0;o<i.length;o++){const s=e[i[o]];s[t]=o*r}}}getObservable(){return ra(this.collection).getObservable()}getArrayObservable(){const e=Nh();return new e(t=>{const r=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){r.unsubscribe()}})}getArray(){return ra(this.collection).toArray((e,t)=>e[this.orderProperty]-t[this.orderProperty])}add(e,t,r){const i=this.getArray();let o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(let c=0;c<i.length;c++){const l=i[c][this.orderProperty];o=Math.min(l,o),s=Math.max(l,s)}let a;if(typeof r=="number"){if(a=Object.keys(this.collection).find(c=>this.collection[c]===e),!a)throw new Error("item not found in collection");if(r===t)return{key:a,index:t};if(Math.abs(r-t)===1){const c=i[t],l=c[this.orderProperty];return c[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=l,{key:a,index:t}}else i.splice(r,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:s+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:o-this.orderIncrement;else{const c=i.map(u=>u[this.orderProperty]),l=c[t]-c[t-1];if(l>1)e[this.orderProperty]=c[t]-Math.floor(l/2);else{i.splice(t,0,e);for(let u=0;u<i.length;u++)i[u][this.orderProperty]=u*this.orderIncrement}}return{key:typeof a=="string"?a:ra(this.collection).push(e),index:t}}delete(e){const t=this.getArray()[e];if(!t)throw new Error(`Item at index ${e} not found`);const r=Object.keys(this.collection).find(i=>this.collection[i]===t);if(!r)throw new Error("Cannot find target object to delete");return this.collection[r]=null,{key:r,index:e}}move(e,t){const r=this.getArray();return this.add(r[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let r=0;r<t.length;r++)t[r][this.orderProperty]=r*this.orderIncrement}}class Wg{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class yE extends Wg{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const $e=Symbol("private");class Un{constructor(e,t,r){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const i=H.get(t).key,o=[];this[$e]={get path(){return t},get key(){return i},get callbacks(){return o},vars:r||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const r=this[$e].context;if(typeof e=="object"){const i=e?t?r||{}:e:{};return e&&Object.keys(e).forEach(o=>{i[o]=e[o]}),this[$e].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),r;throw new Error("Invalid context argument")}}get cursor(){return this[$e].cursor}set cursor(e){var t;this[$e].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[$e].path}get key(){const e=this[$e].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[$e].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=H.fillVariables2(this.path,this.vars),t=H.get(e);return t.parentPath===null?null:new Un(this.db,t.parentPath).context(this[$e].context)}get vars(){return this[$e].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=H.fillVariables2(this.path,this.vars),r=H.getChildPath(t,e);return new Un(this.db,r).context(this[$e].context)}set(e,t){return z(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.set(this.path,e,{context:this[$e].context});if(this.cursor=r,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}update(e,t){return z(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.update(this.path,e,{context:this[$e].context});this.cursor=r}if(typeof t=="function")try{t(null,this)}catch(r){console.error("Error in onComplete callback:",r)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}transaction(e){return z(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const r=o=>{o=this.db.types.deserialize(this.path,o);const s=new Ze(this,o);let a;try{a=e(s)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,r,{context:this[$e].context});if(this.cursor=i,t)throw t;return this})}on(e,t,r){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const o=new Hx(c=>{i=c}),s={event:e,stream:o,userCallback:typeof t=="function"&&t,ourCallback:(c,l,u,h,y)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${l}"`,c);return}const d=this.db.ref(l);d[$e].vars=H.extractVariables(this.path,l);let f;if(e.startsWith("notify_"))f=d.context(y||{});else{const p={previous:this.db.types.deserialize(l,h),current:this.db.types.deserialize(l,u)};if(e==="child_removed")f=new Ze(d,p.previous,!0,p.previous,y);else if(e==="mutations")f=new na(d,p.current,y);else{const v=e==="mutated"&&p.current===null;f=new Ze(d,p.current,v,p.previous,y)}}i.publish(f),y!=null&&y.acebase_cursor&&(this.cursor=y.acebase_cursor)}};this[$e].callbacks.push(s);const a=()=>{typeof t=="function"&&o.subscribe(t,(y,d)=>{y||r&&r(d)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const l=y=>{const d=this[$e].callbacks;d.splice(d.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${y.message}`),i.cancel(y.message)},u=this.db.api.subscribe(this.path,e,s.ourCallback,{newOnly:c.newOnly,cancelCallback:l,syncFallback:c.syncFallback}),h=()=>{const y=this[$e].callbacks;return y.splice(y.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback)};if(u instanceof Promise?u.then(()=>{i.start(h)}).catch(l):i.start(h),!c.newOnly){if(e==="value")this.get(y=>{i.publish(y)});else if(e==="child_added")this.get(y=>{const d=y.val();d===null||typeof d!="object"||Object.keys(d).forEach(f=>{const p=new Ze(this.child(f),d[f]);i.publish(p)})});else if(e==="notify_child_added"){let y=0;const d=()=>z(this,null,function*(){const f=yield this.db.api.reflect(this.path,"children",{limit:100,skip:y});f.list.forEach(p=>{const v=this.child(p.key);i.publish(v)}),f.more&&(y+=100,d())});d()}}};return this.db.isReady?a():this.db.ready(a),o}off(e,t){const r=this[$e].callbacks.filter(i=>(!e||i.event===e)&&(!t||i.userCallback===t));return r.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),r.forEach(i=>{i.stream.stop()}),this}get(e,t){if(!this.db.isReady){const o=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const o=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw o;return Promise.reject(o)}const r=new Wg(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,r).then(o=>{var s;"context"in o&&"value"in o||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),o={value:o,context:{}});const a=this.db.types.deserialize(this.path,o.value),c=new Ze(this,a,void 0,void 0,o.context);return(s=o.context)!=null&&s.acebase_cursor&&(this.cursor=o.context.acebase_cursor),c});if(t){i.then(t).catch(o=>{console.error("Uncaught error:",o)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(r=>{const i=o=>{this.off(e,i),r(o)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const o=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw o;return Promise.reject(o)}const r=Nt.generate(),i=this.child(r);return i[$e].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return z(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return z(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new zg(this)}count(){return z(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return z(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(e){return z(this,arguments,function*(t,r={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof t=="function"?t:t.write.bind(t);return this.db.api.export(this.path,i,r)})}import(e){return z(this,arguments,function*(t,r={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,t,r)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),fE.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=Nh();return new t(r=>{let i,o=!1,s=this.get(e).then(c=>{o=!0,i=c.val(),r.next(i)});const a=c=>{if(!o){s=s.then(()=>a(c));return}const l=c.ref.path;if(l===this.path)return i=c.val(),r.next(i);const u=H.getPathKeys(l).slice(H.getPathKeys(this.path).length);let h=i;for(;u.length>1;){const f=u.shift();f in h||(h[f]=typeof u[0]=="number"?[]:{}),h=h[f]}const y=u.shift(),d=c.val();d===null?h instanceof Array&&typeof y=="number"?h.splice(y,1):delete h[y]:h[y]=d,r.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return z(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),o={canceled:!1,total:i.list.length,processed:0};for(let s=0;s<i.list.length;s++){const a=i.list[s].key,c=yield this.child(a).get(r);if(o.processed++,!!c.exists()&&(yield t(c))===!1){o.canceled=!0;break}}return o})}getMutations(e){return z(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:r})})}getChanges(e){return z(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:r})})}}class zg{constructor(e){this.ref=e,this[$e]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,r){if((t==="in"||t==="!in")&&(!(r instanceof Array)||r.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(r instanceof Array)||r.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(r instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[$e].filters.push({key:e,op:t,compare:r}),this}where(e,t,r){return this.filter(e,t,r)}take(e){return this[$e].take=e,this}skip(e){return this[$e].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[$e].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const o=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const r=new yE(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});r.allow_cache=r.cache_mode!=="bypass",r.eventHandler=o=>{if(!this[$e].events[o.name])return!1;const s=this[$e].events[o.name];if(typeof s!="object"||s.length===0)return!1;if(["add","change","remove"].includes(o.name)){const a={name:o.name,ref:new Un(this.ref.db,o.path)};if(r.snapshots&&o.name!=="remove"){const c=i.types.deserialize(o.path,o.value);a.snapshot=new Ze(a.ref,c,!1)}o=a}s.forEach(a=>{var c,l;try{a(o)}catch(u){this.ref.db.debug.error(`Error executing "${o.name}" event handler of realtime query on path "${this.ref.path}": ${(l=(c=u==null?void 0:u.stack)!=null?c:u==null?void 0:u.message)!=null?l:u}`)}})},r.monitor={add:!1,change:!1,remove:!1},this[$e].events&&(this[$e].events.add&&this[$e].events.add.length>0&&(r.monitor.add=!0),this[$e].events.change&&this[$e].events.change.length>0&&(r.monitor.change=!0),this[$e].events.remove&&this[$e].events.remove.length>0&&(r.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[$e],r).catch(o=>{throw new Error(o)}).then(o=>{const{stop:s}=o;let{results:a,context:c}=o;if(this.stop=()=>z(this,null,function*(){yield s()}),"results"in o&&"context"in o||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=o,c={}),r.snapshots){const l=a.map(u=>{const h=i.types.deserialize(u.path,u.val);return new Ze(i.ref(u.path),h,!1,void 0,c)});return oc.from(l)}else{const l=a.map(u=>i.ref(u));return Lh.from(l)}}).then(o=>(t&&t(o),o))}stop(){return z(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return z(this,null,function*(){return(yield this.find()).length})}exists(){return z(this,null,function*(){const e=this[$e].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return z(this,null,function*(){const t=yield this.find(),r=t.reduce((a,c)=>{const l=a[c.parent.path];return l?l.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,o=Object.keys(r).map(a=>z(this,null,function*(){const c=t.reduce((u,h)=>(u[h.key]=null,u),{}),l=i.ref(a);try{return yield l.update(c),{ref:l,success:!0}}catch(u){return{ref:l,success:!1,error:u}}})),s=yield Promise.all(o);return e&&e(s),s})}on(e,t){return this[$e].events[e]||(this[$e].events[e]=[]),this[$e].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[$e].events={},this;if(!this[$e].events[e])return this;if(typeof t=="undefined")return delete this[$e].events[e],this;const r=this[$e].events[e].indexOf(t);return~r?(this[$e].events[e].splice(r,1),this):this}forEach(e,t){return z(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),o={canceled:!1,total:i.length,processed:0};for(let s=0;s<i.length;s++){const a=yield i[s].get(r);if(o.processed++,!!a.exists()&&(yield t(a))===!1){o.canceled=!0;break}}return o})}}class oc extends Array{static from(e){const t=new oc(e.length);return e.forEach((r,i)=>t[i]=r),t}getValues(){return this.map(e=>e.val())}}class Lh extends Array{static from(e){const t=new Lh(e.length);return e.forEach((r,i)=>t[i]=r),t}getPaths(){return this.map(e=>e.path)}}function gE(n,e){e=e.replace(/^\/|\/$/g,"");const t=H.getPathKeys(e),r=Object.keys(n).find(i=>{const o=H.getPathKeys(i);return o.length!==t.length?!1:o.every((s,a)=>s==="*"||typeof s=="string"&&s[0]==="$"?!0:s===t[a])});return n[r]}function mE(n,e){const t=H.get(e).parentPath;if(t!==null)return gE(n,t)}function vE(n,e){e=e.replace(/^\/|\/$/g,"");const t=H.get(e).parentPath,r=t?H.getPathKeys(t):[];return Object.keys(n).reduce((i,o)=>{const s=H.getPathKeys(o);if(s.length<r.length)return i;let a=!0;if(r.length===0&&t!==null?a=s.length===1&&(s[0]==="*"||typeof s[0]=="string"&&s[0][0]==="$"):s.every((c,l)=>l>=r.length?!1:c==="*"||typeof c=="string"&&c[0]==="$"||c===r[l]?!0:(a=!1,!1)),a){const c=n[o];i.push({path:o,type:c})}return i},[])}function Zf(n,e,t,r,i){if(r===null||typeof r!="object")return r;const o=H.getPathKeys(t),s=vE(e,t),a=[];return s.sort((c,l)=>H.getPathKeys(c.path).length>H.getPathKeys(l.path).length?-1:1),s.forEach(c=>{const l=H.getPathKeys(c.path);l.push("*");const u=l.slice(o.length);if(u.length===0){const y=H.extractVariables(c.path,t),d=new Un(n,t,y);if(i==="serialize")r=c.type.serialize(r,d);else if(i==="deserialize"){const f=new Ze(d,r);r=c.type.deserialize(f)}return}const h=(y,d,f)=>{if(r===null||typeof r!="object")return r;const p=f[0];let v=[];if(p==="*"||typeof p=="string"&&p[0]==="$")d instanceof Array?v=d.map((w,S)=>({key:S,val:w})):v=Object.keys(d).map(w=>({key:w,val:d[w]}));else{const w=d[p];typeof w=="object"&&v.push({key:p,val:w})}v.forEach(w=>{const S=H.getChildPath(y,w.key),R=H.extractVariables(c.path,S),j=new Un(n,S,R);if(f.length===1){if(i==="serialize")a.push({parent:d,key:w.key,original:d[w.key]}),d[w.key]=c.type.serialize(w.val,j);else if(i==="deserialize"){const N=new Ze(j,w.val);d[w.key]=c.type.deserialize(N)}}else h(S,w.val,f.slice(1))})};h(t,r,u)}),i==="serialize"&&(r=Bn(r),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),r}const Pi=Symbol("mappings");class Kg{constructor(e){this.db=e,this[Pi]={}}get mappings(){return this[Pi]}map(e){return mE(this[Pi],e)}bind(e,t,r={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof r.serializer!="undefined"){if(typeof r.serializer=="string")if(typeof t.prototype[r.serializer]=="function")r.serializer=t.prototype[r.serializer];else throw new TypeError(`${t.name}.prototype.${r.serializer} is not a function, cannot use it as serializer`);else if(typeof r.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof r.creator=="undefined")typeof t.create=="function"&&(r.creator=t.create);else if(typeof r.creator=="string")if(typeof t[r.creator]=="function")r.creator=t[r.creator];else throw new TypeError(`${t.name}.${r.creator} is not a function, cannot use it as creator`);else if(typeof r.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[Pi][e]={db:this.db,type:t,creator:r.creator,serializer:r.serializer,deserialize(i){let o;return this.creator?o=this.creator.call(this.type,i):o=new this.type(i),o},serialize(i,o){return this.serializer?i=this.serializer.call(i,o,i):i&&typeof i.serialize=="function"&&(i=i.serialize(o,i)),i}}}serialize(e,t){return Zf(this.db,this[Pi],e,t,"serialize")}deserialize(e,t){return Zf(this.db,this[Pi],e,t,"deserialize")}}const Ts=()=>{};class Hg{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Ts,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Ts,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):Ts,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):Ts,this.write=r=>{const i=typeof bn!="undefined"&&bn.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";r&&i?r.split(`
`).forEach(o=>console.log(o)):console.log(r)}}}const ep={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},tp={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},np={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},Ps={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var _t;(function(n){n.reset="reset",n.bold="bold",n.dim="dim",n.italic="italic",n.underline="underline",n.inverse="inverse",n.hidden="hidden",n.strikethrough="strikethrough",n.black="black",n.red="red",n.green="green",n.yellow="yellow",n.blue="blue",n.magenta="magenta",n.cyan="cyan",n.grey="grey",n.bgBlack="bgBlack",n.bgRed="bgRed",n.bgGreen="bgGreen",n.bgYellow="bgYellow",n.bgBlue="bgBlue",n.bgMagenta="bgMagenta",n.bgCyan="bgCyan",n.bgWhite="bgWhite",n.bgGrey="bgGrey"})(_t||(_t={}));function Jg(){if(typeof bn=="undefined"||!bn.stdout||!bn.env||!bn.platform||bn.platform==="browser")return!1;if(bn.platform==="win32")return!0;const n=bn.env;return n.COLORTERM?!0:n.TERM==="dumb"?!1:n.CI||n.TEAMCITY_VERSION?!!n.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(n.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(n.TERM))}let Yg=Jg();function bE(n){Yg=Jg()&&n}function wE(n,e){if(!Yg)return n;const t=[],r=[],i=a=>{a===_t.reset?t.push(Ps.all):a in ep?(t.push(ep[a]),r.push(Ps[a])):a in tp?(t.push(tp[a]),r.push(Ps.color)):a in np&&(t.push(np[a]),r.push(Ps.background))};e instanceof Array?e.forEach(i):i(e);const o=t.map(a=>"\x1B["+a+"m").join(""),s=r.map(a=>"\x1B["+a+"m").join("");return n.split(`
`).map(a=>o+a+s).join(`
`)}String.prototype.colorize=function(n){return wE(this,n)};class Gg{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class kE extends Mi{constructor(e,t={}){super(),this._ready=!1,t=new Gg(t),this.name=e,this.debug=new Hg(t.logLevel,`[${e}]`),bE(t.logColors);const r=[_t.magenta,_t.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,o=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(r)),o&&this.debug.write(o.colorize(_t.magenta))),this.types=new Kg(this),this.once("ready",()=>{this._ready=!0})}ready(e){return z(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){dE(e)}ref(e){return new Un(this,e)}get root(){return this.ref("")}query(e){const t=new Un(this,e);return new zg(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,r)=>this.api.createIndex(e,t,r),delete:e=>z(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,r=!1)=>this.api.setSchema(e,t,r),all:()=>this.api.getSchemas(),check:(e,t,r)=>this.api.validateSchema(e,t,r)}}}class st extends Error{constructor(e){super(`${e} is not implemented`)}}class xE extends Mi{constructor(){super()}stats(e){throw new st("stats")}subscribe(e,t,r,i){throw new st("subscribe")}unsubscribe(e,t,r){throw new st("unsubscribe")}update(e,t,r){throw new st("update")}set(e,t,r){throw new st("set")}get(e,t){throw new st("get")}transaction(e,t,r){throw new st("transaction")}exists(e){throw new st("exists")}query(e,t,r){throw new st("query")}reflect(e,t,r){throw new st("reflect")}export(e,t,r){throw new st("export")}import(e,t,r){throw new st("import")}createIndex(e,t,r){throw new st("createIndex")}getIndexes(){throw new st("getIndexes")}deleteIndex(e){throw new st("deleteIndex")}setSchema(e,t,r){throw new st("setSchema")}getSchema(e){throw new st("getSchema")}getSchemas(){throw new st("getSchemas")}validateSchema(e,t,r){throw new st("validateSchema")}getMutations(e){throw new st("getMutations")}getChanges(e){throw new st("getChanges")}}function rp(n,e,t){const r=[0,0,0,0,0];for(let i=0;i<e;i+=4){let o=((n[i]*256+n[i+1])*256+n[i+2])*256+n[i+3];if(!o)t.push("z");else{for(let s=0;s<5;r[s++]=o%85+33,o=Math.floor(o/85));t.push(String.fromCharCode(r[4],r[3],r[2],r[1],r[0]))}}}function EE(n){const e=n,t=[],r=e.length%4,i=e.length-r;if(rp(e,i,t),r){const s=new Uint8Array(4);s.set(e.slice(i),0),rp(s,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,r+1))}let o=t.join("");return o="<~"+o+"~>",o}const ur={encode:function(n){return n instanceof ArrayBuffer&&(n=new Uint8Array(n,0,n.byteLength)),EE(n)},decode:function(n){if(!n.startsWith("<~")||!n.endsWith("~>"))throw new Error("Invalid input string");n=n.substr(2,n.length-4);const e=n.length,t=[],r=[0,0,0,0,0];let i,o,s,a;for(let l=0;l<e;++l){if(n.charAt(l)=="z"){t.push(0,0,0,0);continue}for(let u=0;u<5;++u)r[u]=n.charCodeAt(l+u)-33;if(a=e-l,a<5){for(let u=a;u<4;r[++u]=0);r[a]=85}i=(((r[0]*85+r[1])*85+r[2])*85+r[3])*85+r[4],o=i&255,i>>>=8,s=i&255,i>>>=8,t.push(i>>>8,i&255,s,o);for(let u=a;u<5;++u,t.pop());l+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},_E=n=>{if(n.map===null||typeof n.map=="undefined"){if(typeof n.val=="undefined")throw new Error("serialized value must have a val property");return n.val}const e=(t,r)=>t==="date"?new Date(r):t==="binary"?ur.decode(r):t==="reference"?new et(r):t==="regexp"?new RegExp(r.pattern,r.flags):t==="array"?new La(r):t==="bigint"?BigInt(r):r;return typeof n.map=="string"?e(n.map,n.val):(Object.keys(n.map).forEach(t=>{const r=n.map[t],i=H.getPathKeys(t);let o=n,s="val",a=n.val;i.forEach(c=>{s=c,o=a,a=a[s]}),o[s]=e(r,a)}),n.val)},Xg=n=>{var e;if(n===null||typeof n!="object"||n instanceof Date||n instanceof ArrayBuffer||n instanceof et||n instanceof RegExp){const o=Xg({value:n});return{map:(e=o.map)==null?void 0:e.value,val:o.val.value}}n=Bn(n);const t=(o,s,a)=>{o instanceof La&&(s[a]="array"),Object.keys(o).forEach(c=>{const l=o[c],u=a.length===0?c:`${a}/${c}`;typeof l=="bigint"?(o[c]=l.toString(),s[u]="bigint"):l instanceof Date?(o[c]=l.toISOString(),s[u]="date"):l instanceof ArrayBuffer?(o[c]=ur.encode(l),s[u]="binary"):l instanceof et?(o[c]=l.path,s[u]="reference"):l instanceof RegExp?(o[c]={pattern:l.source,flags:l.flags},s[u]="regexp"):typeof l=="object"&&l!==null&&t(l,s,u)})},r={};t(n,r,"");const i={val:n};return Object.keys(r).length>0&&(i.map=r),i},ip=n=>n>0?Date.now()+n*1e3:1/0;class $E{get size(){return this.cache.size}constructor(e){var t;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const r=setInterval(()=>{this.cleanUp()},60*1e3);(t=r.unref)==null||t.call(r)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=ip(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?Bn(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let r=null;const i=Date.now();for(const[o,s]of this.cache.entries()){if(s.expires<=i){this.cache.delete(o),r=null;break}(!r||s.accessed<r.accessed)&&(r={key:o,accessed:s.accessed})}r!==null&&this.cache.delete(r.key)}this.cache.set(e,{value:this.options.cloneValues?Bn(t):t,added:Date.now(),accessed:Date.now(),expires:ip(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,r)=>{t.expires<=e&&this.cache.delete(r)})}}function OE(n){let e=0;function t(){let a;for(;a=n[e],[" ","\r",`
`,"	"].includes(a);)e++}function r(a){if(n[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${n[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=n[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${n.slice(e,e+10)}..`);return n[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),r(":"),a}function o(){t();let a={typeOf:"any"},c,l="";for(;c=n[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)l+=c,e++;if(l.length===0)if(n[e]==="*")r("*"),a.typeOf="any";else if(["'",'"',"`"].includes(n[e])){a.typeOf="string",a.value="";const u=n[e];for(r(u);c=n[e],c&&c!==u;)a.value+=c,e++;r(u)}else if(n[e]>="0"&&n[e]<="9"){a.typeOf="number";let u="";for(;c=n[e],c==="."||c==="n"||c>="0"&&c<="9";)u+=c,e++;u.endsWith("n")?a.value=BigInt(u):u.includes(".")?a.value=parseFloat(u):a.value=parseInt(u)}else if(n[e]==="{"){for(r("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const u=i(),h=s();if(a.children.push({name:u.name,optional:u.optional,wildcard:u.wildcard,types:h}),t(),(n[e]===";"||n[e]===",")&&(r(n[e]),t()),n[e]==="}")break}r("}")}else if(n[e]==="/"){r("/");let u="",h="";for(;c=n[e],c!=="/"||u.endsWith("\\");)u+=c,e++;for(r("/");c=n[e],["g","i","m","s","u","y","d"].includes(c);)h+=c,e++;a.typeOf="string",a.matches=new RegExp(u,h)}else throw new Error(`Expected a type definition at position ${e}, found character '${n[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(l))a.typeOf=l.toLowerCase();else if(l==="Object"||l==="object")a.typeOf="object",a.instanceOf=Object;else if(l==="Date")a.typeOf="object",a.instanceOf=Date;else if(l==="Binary"||l==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(l==="any")a.typeOf="any";else if(l==="null")a.typeOf="object",a.value=null;else if(l==="Array")r("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=s(),r(">");else if(["true","false"].includes(l))a.typeOf="boolean",a.value=l==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();n[e]==="[";)r("["),r("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function s(){t();const a=[o()];for(;n[e]==="|";)r("|"),a.push(o()),t();return a}return o()}function AE(n,e,t,r){const i=e.find(h=>h.name==="*"||h.name[0]==="$")?[]:Object.keys(t).filter(h=>![null,void 0].includes(t[h])&&!e.find(y=>y.name===h));if(i.length>0)return{ok:!1,reason:`Object at path "${n}" cannot have propert${i.length===1?"y":"ies"} ${i.map(h=>`"${h}"`).join(", ")}`};function o(h){const y=![null,void 0].includes(t[h.name]);return!h.optional&&(r?t[h.name]===null:!y)?{ok:!1,reason:`Property at path "${n}/${h.name}" is not optional`}:y&&h.types.length===1?Bo(`${n}/${h.name}`,h.types[0],t[h.name],!1):y&&!h.types.some(d=>Bo(`${n}/${h.name}`,d,t[h.name],!1).ok)?{ok:!1,reason:`Property at path "${n}/${h.name}" does not match any of ${h.types.length} allowed types`}:{ok:!0}}const s=e.filter(h=>!h.wildcard),a=s.find(h=>!o(h).ok);if(a)return{ok:!1,reason:o(a).reason};const c=e.find(h=>h.wildcard);if(!c)return{ok:!0};const l=Object.keys(t).filter(h=>!s.find(y=>y.name===h));let u={ok:!0};for(let h=0;h<l.length&&u.ok;h++){const y=l[h];u=o({name:y,types:c.types,optional:!0,wildcard:!0})}return u}function Bo(n,e,t,r,i){const o={ok:!0};if(e.typeOf==="any")return o;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`};if(!e.children)return o;const s=i[0];let a=e.children.find(l=>l.name===s);if(a||(a=e.children.find(l=>l.name==="*"||l.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${n}" cannot have property "${s}"`};if(a.optional&&t===null&&i.length===1)return o;let c;return a.types.some(l=>{const u=typeof s=="number"?`${n}[${s}]`:`${n}/${s}`;return c=Bo(u,l,t,r,i.slice(1)),c.ok}),c}return t===null?o:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${n}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${n}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${n}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(s=>e.genericTypes.some(a=>Bo(n,a,s,!1).ok))?{ok:!1,reason:`every array value of path "${n}" must match one of the specified types`}:e.typeOf==="object"&&e.children?AE(n,e.children,t,r):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${n}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:o}function SE(n){switch(n){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${n.name}`)}}class TE{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const r=i=>"{"+Object.keys(i).map(o=>{let s=i[o];if(s===void 0)s="undefined";else if(s instanceof RegExp)s=`/${s.source}/${s.flags}`;else if(typeof s=="object")s=r(s);else if(typeof s=="function")s=SE(s);else if(!["string","number","boolean","bigint"].includes(typeof s))throw new Error(`Type definition for key "${o}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${o}:${s}`}).join(",")+"}";this.text=r(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=OE(this.text)}check(e,t,r,i){const o=Bo(e,this.type,t,r,i);return!o.ok&&this.handling.warnOnly&&(o.warning=`${r?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${o.reason}`,o.ok=!0,this.handling.warnCallback(o.warning)),o}}class Gt{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class dl extends Gt{}class yu extends Gt{}class op extends Gt{}class PE extends Gt{}class sp extends Gt{}class jE extends Gt{}const CE={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},oe=CE;function RE(n){switch(n){case oe.ARRAY:return"array";case oe.BINARY:return"binary";case oe.BOOLEAN:return"boolean";case oe.DATETIME:return"date";case oe.NUMBER:return"number";case oe.OBJECT:return"object";case oe.REFERENCE:return"reference";case oe.STRING:return"string";case oe.BIGINT:return"bigint"}}class Qg{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=H.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return RE(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function Wt(n,e){if(!n)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const IE=120,zt={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class Zg{constructor(e,t=IE){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Nt.generate()}_allowLock(e,t,r){const i=this._locks.find(o=>o.tid!==t&&o.state===zt.LOCKED&&(r||o.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(r){console.error("Unhandled promise rejection:",r)}}_processLockQueue(){if(this._quit){const e=new Error("Quitting");this._locks.filter(t=>t.state===zt.PENDING).forEach(t=>this._rejectLock(t,e)),this._locks.length===0&&this._quit()}this._locks.filter(e=>e.state===zt.PENDING).sort((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.requested-t.requested).forEach(e=>{const t=this._allowLock(e.path,e.tid,e.forWriting);e.waitingFor=t.conflict||null,t.allow&&this.lock(e).then(e.resolve).catch(r=>this._rejectLock(e,r))})}lock(e,t){return z(this,arguments,function*(r,i,o=!0,s="",a={withPriority:!1,noTimeout:!1}){let c,l;if(r instanceof fl)c=r,l=!0;else{if(this._locks.findIndex(u=>u.tid===i&&u.state===zt.EXPIRED)>=0)throw new Error(`lock on tid ${i} has expired, not allowed to continue`);if(this._quit&&!a.withPriority)throw new Error("Quitting");{c=new fl(this,r,i,o,a.withPriority===!0),c.comment=s,this._locks.push(c);const u=this._allowLock(r,i,o);c.waitingFor=u.conflict||null,l=u.allow}}if(l){if(c.state=zt.LOCKED,typeof c.granted!="number"&&(c.granted=Date.now(),a.noTimeout!==!0)){c.expires=Date.now()+this.timeout;let u=0;const h=()=>{if(c.state===zt.LOCKED){if(u++,u<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${u}]`),c.timeout=setTimeout(h,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=zt.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(h,this.timeout/4)}return c}else return Wt(c.state===zt.PENDING),new Promise((u,h)=>{c.resolve=u,c.reject=h})})}unlock(e,t,r=!0){let i,o;if(e instanceof fl)i=e,o=this._locks.indexOf(i);else{const s=e;o=this._locks.findIndex(a=>a.id===s),i=this._locks[o]}if(o<0){const s=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(s)}return i.state=zt.DONE,clearTimeout(i.timeout),this._locks.splice(o,1),r&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,r){return this._allowLock(e,t,r).allow}}let NE=0;class fl{static get LOCK_STATE(){return zt}constructor(e,t,r,i,o=!1){this.locker=e,this.path=t,this.tid=r,this.forWriting=i,this.priority=o,this.state=zt.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++NE,this.history=[]}release(e){return z(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return z(this,null,function*(){const e=H.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const t=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return t.history=this.history,t.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),t}})}}class Dh extends Error{}class gu extends Error{}class BE extends Error{constructor(e){super(`Exiting: ${e}`)}}class LE extends Mi{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,r=e.name){super(),this.storage=e,this.id=t,this.dbname=r,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new Zg(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(a=>a.callback===i.callback))return;const o=this.ourSubscriptions.some(a=>a.event===i.event&&a.path===i.path);if(this.ourSubscriptions.push(i),o)return;const s={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(s)}),e.on("unsubscribe",i=>{const o=this.remoteSubscriptions.find(s=>s.callback===i.callback);if(o){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(o),1);return}this.ourSubscriptions.filter(s=>s.path===i.path&&(!i.event||s.event===i.event)&&(!i.callback||s.callback===i.callback)).forEach(s=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(s),1);const a={type:"unsubscribe",from:this.id,data:{path:s.path,event:s.event}};this.sendMessage(a)})})}exit(e=0){return z(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(!this._exiting&&(this.peers.find(r=>r.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t)){const r={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(r),this.ourSubscriptions.forEach(i=>{const o={type:"subscribe",from:this.id,to:e,data:{path:i.path,event:i.event}};this.sendMessage(o)})}}removePeer(e,t=!1){if(this._exiting)return;const r=this.peers.find(i=>i.id===e);if(!r){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(r),1),this.remoteSubscriptions.filter(i=>i.for===e).forEach(i=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(i),1),this.storage.subscriptions.remove(i.path,i.event,i.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const r=(i,o,s,a,c)=>{const l={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:o,val:s,previous:a,context:c}};this.sendMessage(l)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:r}),this.storage.subscriptions.add(t.path,t.event,r)}cancelRemoteSubscription(e,t){const r=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!r||this.storage.subscriptions.remove(t.path,t.event,r.callback)}handleMessage(e){return z(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,r=t.data.context||{};r.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(i=>i.event===t.event&&i.path===t.path).forEach(i=>{i.callback(null,t.data.path,t.data.val,t.data.previous,r)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,r={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(i=>{var o;return((o=i.lock)==null?void 0:o.id)===t.data.id}).lock.release()}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const o=this._locks.find(s=>{var a;return((a=s.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield o.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);o.lock=i,r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("Result of unknown request received");t.ok?r.resolve(t.data):r.reject(new Error(t.reason))}}})}lock(e){return z(this,null,function*(){if(this._exiting&&!this._locks.find(r=>r.tid===e.tid&&r.granted))throw new BE("new transaction lock denied because the IPC peer is exiting");const t=r=>{this._locks.splice(this._locks.indexOf(r),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);r.tid=i.tid,r.granted=!0;const o=s=>({get id(){return s.id},get tid(){return s.tid},get path(){return s.path},get forWriting(){return s.forWriting},get expires(){return s.expires},get comment(){return s.comment},get state(){return s.state},release:()=>z(this,null,function*(){yield s.release(),t(r)}),moveToParent:()=>z(this,null,function*(){const a=yield s.moveToParent();return r.lock=o(a),r.lock})});return r.lock=o(i),r.lock}else{const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=c=>(r.granted=!0,r.tid=c.tid,r.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:zt.LOCKED,expires:c.expires,comment:c.comment,release:()=>z(this,null,function*(){const l={type:"unlock-request",id:Nt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id}};yield this.request(l),r.lock.state=zt.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${r.lock.id} (tid ${r.lock.tid}, ${r.lock.comment}, "/${r.lock.path}", ${r.lock.forWriting?"write":"read"})`),t(r)}),moveToParent:()=>z(this,null,function*(){const l={type:"move-lock-request",id:Nt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id,move_to:"parent"}};let u;try{u=yield this.request(l)}catch(h){throw r.lock.state=zt.DONE,t(r),h}return r.lock=i(u),r.lock})},r.lock),o={type:"lock-request",id:Nt.generate(),from:this.id,to:this.masterPeerId,data:e};let s,a;try{s=yield this.request(o)}catch(c){a=c,s=null}if(a)throw t(r),a;return i(s)}})}request(e){return z(this,null,function*(){let t,r;const i=new Promise((o,s)=>{t=a=>{this._requests.delete(e.id),o(a)},r=a=>{this._requests.delete(e.id),s(a)}});return this._requests.set(e.id,{resolve:t,reject:r,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Nt.generate(),data:e};return this.request(t).catch(r=>{throw this.storage.debug.error(r),r})}replyRequest(e,t){const r={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(r)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class DE extends LE{constructor(e){if(super(e,Nt.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const r=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:o=>{const s=Nt.generate(),a=`acebase:${e.name}:${this.id}:${s}`,c=JSON.stringify(Xg(o));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(o){r[0]=o},set onmessageerror(o){i()},close(){i()},addEventListener(o,s){o!=="message"&&i(),r.push(s)},removeEventListener(o,s){const a=r.indexOf(s);a>=1&&r.splice(a,1)},dispatchEvent(o){return r.forEach(s=>{try{s&&s(o)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",o=>{const[s,a,c,l]=o.key.split(":");if(s!=="acebase"||a!==e.name||c===this.id||o.newValue===null)return;const u=_E(JSON.parse(o.newValue));this.channel.dispatchEvent({data:u})})}this.channel.addEventListener("message",r=>z(this,null,function*(){const i=r.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const o=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=o.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const s=this._locks.splice(0);yield Promise.all(s.filter(a=>a.granted).map(a=>z(this,null,function*(){let c,l;a.lock.release=()=>new Promise(h=>c=h),a.lock.moveToParent=()=>new Promise(h=>l=h);const u=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(l){const h=yield u.moveToParent();l(h)}c&&(yield u.release(),c())}))),yield Promise.all(s.filter(a=>!a.granted).map(a=>z(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class Eo{static get hasFileSystem(){return!1}static get fs(){return null}}class Uh extends Gt{}class em extends Gt{}class UE extends Gt{}class qE extends Gt{}function VE(n,e,t,r){return z(this,null,function*(){if(!n.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:o,indexes:s,storage:a}=n,c=r&&r.rebuild===!0,l=r&&r.type||"normal";let u=r&&r.include||[];typeof u=="string"&&(u=[u]);const h=s.find(d=>d.path===e&&d.key===t&&d.type===l&&d.includeKeys.length===u.length&&d.includeKeys.every((f,p)=>u[p]===f));if(h&&r.config&&(h.config=r.config),h&&c!==!0)return o.log(`Index on "/${e}/*/${t}" already exists`.colorize(_t.inverse)),h;if(!i.isMaster){const d=yield i.sendRequest({type:"index.create",path:e,key:t,options:r});if(d.ok)return a.indexes.add(d.fileName);throw new Error(d.reason)}yield Eo.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(d=>{if(d.code!=="EEXIST")throw d});const y=h||(()=>{const{include:d,caseSensitive:f,textLocale:p,textLocaleKey:v}=r,w={include:d,caseSensitive:f,textLocale:p,textLocaleKey:v};switch(l){case"array":return new qE(a,e,t,pe({},w));case"fulltext":return new em(a,e,t,It(pe({},w),{config:r.config}));case"geo":return new UE(a,e,t,pe({},w));default:return new Uh(a,e,t,pe({},w))}})();h||s.push(y);try{yield y.build()}catch(d){throw n.debug.error(`Index build on "/${e}/*/${t}" failed: ${d.message} (code: ${d.code})`.colorize(_t.red)),h||s.splice(s.indexOf(y),1),d}return i.sendNotification({type:"index.created",fileName:y.fileName,path:e,key:t,options:r}),y})}const{compareValues:js,getChildValues:ei,encodeString:ap,defer:ME}=Vg,mu=["value","child_added","child_changed","child_removed","mutated","mutations"];mu.push(...mu.map(n=>`notify_${n}`));const FE=()=>{};class WE extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class qh{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class zE extends Mi{createTid(){return Nt.generate()}constructor(e,t,r){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return Eo==null?void 0:Eo.hasFileSystem},create:(o,s,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return VE(c,o,s,a)},get:(o,s=null)=>{if(o.includes("$")){const a=H.getPathKeys(o).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);o=new H(a).path}return this._indexes.filter(a=>a.path===o&&(s===null||s===a.key))},getAll:(o,s={parentPaths:!0,childPaths:!0})=>{const a=H.getPathKeys(o);return this._indexes.filter(c=>{const l=H.getPathKeys(c.path+"/*");return s.parentPaths&&l.every((u,h)=>u==="*"||a[h]===u)&&[c.key].concat(...c.includeKeys).includes(a[l.length])?!0:l.length<a.length||!s.childPaths&&l.length!==a.length?!1:a.every((u,h)=>[u,"*"].includes(l[h]))})},list:()=>this._indexes.slice(),load:()=>z(this,null,function*(){if(this._indexes.splice(0),!Eo.hasFileSystem)return;let o=[];try{o=yield Eo.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const s=[];o.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",l=/^\[[a-z]+\]-/.test(a);if(!c&&!l||c&&a.startsWith(`[${this.settings.type}]-`)){const u=this.indexes.add(a);s.push(u)}}),yield Promise.all(s)}),add:o=>z(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(s)return s;if(this._annoucedIndexes.has(o))return yield this._annoucedIndexes.get(o);try{const a=Uh.readFromFile(this,o);this._annoucedIndexes.set(o,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(o),c}catch(a){return this.debug.error(a),null}}),delete:o=>z(this,null,function*(){const s=yield this.indexes.remove(o);yield s.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:s.fileName,path:s.path,keys:s.key})}),remove:o=>z(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(!s)throw new Error(`Index ${o} not found`);return this._indexes.splice(this._indexes.indexOf(s),1),s}),close:()=>z(this,null,function*(){const o=this.indexes.list().map(s=>s.close().catch(a=>this.debug.error(a)));yield Promise.all(o)})},this._eventSubscriptions={},this.subscriptions={add:(o,s,a)=>{if(mu.indexOf(s)<0)throw new TypeError(`Invalid event type "${s}"`);let c=this._eventSubscriptions[o];c||(c=this._eventSubscriptions[o]=[]),c.push({created:Date.now(),type:s,callback:a}),this.emit("subscribe",{path:o,event:s,callback:a})},remove:(o,s,a)=>{const c=this._eventSubscriptions[o];if(!c)return;const l=()=>c.findIndex(h=>(s?h.type===s:!0)&&(a?h.callback===a:!0));let u;for(;(u=l())>=0;)c.splice(u,1);this.emit("unsubscribe",{path:o,event:s,callback:a})},hasValueSubscribersForPath(o){return!!this.getValueSubscribersForPath(o)},getValueSubscribersForPath:o=>{const s=new H(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.equals(c)||s.isDescendantOf(c)){const l=this._eventSubscriptions[c],u=H.fillVariables(c,o);l.filter(h=>!h.type.startsWith("notify_")).forEach(h=>{let y=null;if(h.type==="value")y=u;else if(["mutated","mutations"].includes(h.type)&&s.isDescendantOf(u))y=o;else if(h.type==="child_changed"&&o!==u){const d=H.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=H.getChildPath(u,d)}else if(["child_added","child_removed"].includes(h.type)&&s.isChildOf(u)){const d=H.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=H.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},getAllSubscribersForPath:o=>{const s=H.get(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.isOnTrailOf(c)){const l=this._eventSubscriptions[c],u=H.fillVariables(c,o);l.forEach(h=>{let y=null;if(h.type==="value"||h.type==="notify_value")y=u;else if(["child_changed","notify_child_changed"].includes(h.type)){const d=o===u||s.isAncestorOf(u)?"*":H.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=H.getChildPath(u,d)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(h.type))y=o;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(h.type)&&(s.isChildOf(u)||o===u||s.isAncestorOf(u))){const d=o===u||s.isAncestorOf(u)?"*":H.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=H.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u&&d.subscriptionPath===c)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},trigger:(o,s,a,c,l,u)=>{(this._eventSubscriptions[s]||[]).filter(h=>h.type===o).forEach(h=>{h.callback(null,a,l,c,u)})}},this.debug=new Hg(r.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof Gt){const o={ipcName:i,server:t.ipc instanceof Gt?t.ipc:null};this.ipc=new Gt(this,o)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const o=Object.assign({dbname:i},t.ipc);this.ipc=new Gt(this,o)}else this.ipc=new DE(this,i);this.ipc.once("exit",o=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(o,s,a,c)=>this.ipc.lock({path:o,tid:s,write:a,comment:c})},this._lastTid=0}close(){return z(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:ap(e).length<this.settings.maxInlineValueSize;if(e instanceof et)return e.path.length>this.settings.maxInlineValueSize?!1:ap(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,r){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let r=e,i=!1;const o=t?[]:this.subscriptions.getAllSubscribersForPath(e),s=t?[]:this.subscriptions.getValueSubscribersForPath(e);s.length>0&&(i=!0,r=s.map(l=>({path:l.dataPath,keys:H.getPathKeys(l.dataPath)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0)[0].path,s.filter(l=>l.dataPath===r).every(l=>l.type==="mutated"||l.type.startsWith("notify_"))&&(i=!1),r=H.fillVariables(r,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(l=>({index:l,keys:H.getPathKeys(l.path)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0).map(l=>l.index),c=[];if(a.length>0){a.sort((h,y)=>(typeof h._pathKeys=="undefined"&&(h._pathKeys=H.getPathKeys(h.path)),typeof y._pathKeys=="undefined"&&(y._pathKeys=H.getPathKeys(y.path)),h._pathKeys.length<y._pathKeys.length?-1:h._pathKeys.length>y._pathKeys.length?1:0));const l=a[0],u=l.path===e?e:H.fillVariables(`${l.path}/*`,e);u.length<r.length&&(r=u,a.filter(h=>h.path===l.path).forEach(h=>{[h.key].concat(h.includeKeys).forEach(y=>!c.includes(y)&&c.push(y))}))}return{topEventPath:r,eventSubscriptions:o,valueSubscribers:s,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(e,t){return z(this,arguments,function*(r,i,o={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(o=o||{},!o.tid&&!o.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");o.merge=o.merge===!0;const s=this.validateSchema(r,i,{updates:o.merge});if(!s.ok)throw new WE(s.reason);const a=o.tid,c=o.transaction;let l=null;const u=o.impact?o.impact:this.getUpdateImpact(r,o.suppress_events),{topEventPath:h,eventSubscriptions:y,hasValueSubscribers:d,indexes:f}=u;let{keysFilter:p}=u;const v=()=>{if(typeof o._customWriteFunction=="function")return o._customWriteFunction();if(l){const E=H.getPathKeys(r),g=H.getPathKeys(h),b=E.slice(g.length);let m=l;for(;b.length>0&&m!==null;){const x=b.shift();m=typeof m=="object"&&x in m?m[x]:null}o.currentValue=m}return this._writeNode(r,i,o)},w=this.settings.transactions&&this.settings.transactions.log===!0;if(y.length===0&&f.length===0&&!w)return v();if(!d&&o.merge===!0&&p.length===0&&(p=Object.keys(i),h!==r)){const E=r.slice(h.length);p=p.map(g=>`${E}/${g}`)}const S=yield this.getNodeInfo(h,{transaction:c,tid:a});let R=null;if(S.exists){const E={transaction:c,tid:a};p.length>0&&(E.include=p),h===""&&typeof E.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),R=(yield this.getNode(h,E)).value}l=R;const j=(yield v())||{};let N,D;if(r===h)o.merge?l===null?N=i instanceof Array?[]:{}:(N=l instanceof Array?[]:{},Object.keys(l).forEach(E=>{N[E]=l[E]})):N=i,D=N;else{const E=r.slice(h.length).replace(/^\//,""),g=H.getPathKeys(E);for(l===null?N=typeof g[0]=="number"?[]:{}:(N=l instanceof Array?[]:{},Object.keys(l).forEach(b=>{N[b]=l[b]})),D=N;g.length>0;){const b=g.shift();if(!o.merge&&g.length===0)D[b]=i;else{const m=D[b],x=typeof b=="number"?[...m]:pe({},m);D[b]=x}D=D[b]}}o.merge&&Object.keys(i).forEach(E=>{D[E]=i[E]});const q=js(l,N);if(q==="identical")return j.mutations=[],j;function P(E){if(E===null||typeof E!="object")return E;Object.keys(E).forEach(g=>{const b=E[g];b===null&&(delete E[g],E instanceof Array&&E.length--),typeof b=="object"&&P(b)})}P(N);const I=[];f.map(E=>({index:E,keys:H.getPathKeys(E.path)})).sort((E,g)=>E.keys.length<g.keys.length?1:E.keys.length>g.keys.length?-1:0).forEach(({index:E})=>{const g=H.getPathKeys(h),b=H.getPathKeys(E.path+"/*"),m=b.slice(g.length),x=l,O=N;if(m.length===0){Wt(g.length===b.length,"check logic");const $=this.ipc.isMaster?E.handleRecordUpdate(h,x,O):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:h,oldValue:x,newValue:O});I.push($);return}const k=($,_,A)=>{if(_===null&&A===null)return[];const T=H.getPathKeys($),C=H.getPathKeys(E.path+"/*"),L=C.slice(T.length);if(L.length===0)return Wt(T.length===C.length,"check logic"),[{path:$,oldValue:_,newValue:A}];let V=[],K="";for(;L.length>0;){const G=L.shift();if(typeof G=="string"&&(G==="*"||G.startsWith("$"))){const ie=_===null?[]:Object.keys(_);A!==null&&Object.keys(A).forEach(ee=>{ie.indexOf(ee)<0&&ie.push(ee)}),ie.forEach(ee=>{const fe=H.getChildPath(K,ee),de=ei(ee,_,A),ne=H.getChildPath($,fe),ce=k(ne,de.oldValue,de.newValue);V=V.concat(ce)});break}else{const ie=ei(G,_,A);if(_=ie.oldValue,A=ie.newValue,_===null&&A===null)break;K=H.getChildPath(K,G)}}return V};k(h,x,O).forEach($=>{const _=this.ipc.isMaster?E.handleRecordUpdate($.path,$.oldValue,$.newValue):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:$.path,oldValue:$.oldValue,newValue:$.newValue});I.push(_)})});const B=(E,g,b,m=[])=>{let x=!0,O=E.type;if(O.startsWith("notify_")&&(O=O.slice(7)),O==="mutated"||(O==="child_changed"&&(g===null||b===null)?x=!1:O==="value"||O==="child_changed"?x=js(g,b)!=="identical":O==="child_added"?x=g===null&&b!==null:O==="child_removed"&&(x=g!==null&&b===null),!x))return;const k=H.getPathKeys(E.dataPath);m.forEach(_=>{const A=k.indexOf(_.name);Wt(A>=0,`Variable "${_.name}" not found in subscription dataPath "${E.dataPath}"`),k[A]=_.value});const $=k.reduce((_,A)=>H.getChildPath(_,A),"");this.subscriptions.trigger(E.type,E.subscriptionPath,$,g,b,o.context)},U=(E,g,b,m)=>{const x=[],O=m||js(g,b);return O==="identical"||(typeof O=="string"?x.push({path:E,oldValue:g,newValue:b}):(O.changed.forEach(k=>{const $=H.getChildPath(E,k.key),_=ei(k.key,g,b),A=U($,_.oldValue,_.newValue,k.change);x.push(...A)}),O.added.forEach(k=>{const $=H.getChildPath(E,k);x.push({path:$,oldValue:null,newValue:b[k]})}),g instanceof Array&&b instanceof Array&&O.removed.sort((k,$)=>k<$?1:-1),O.removed.forEach(k=>{const $=H.getChildPath(E,k);x.push({path:$,oldValue:g[k],newValue:null})}))),x};w&&this.settings.type!=="transaction"&&(j.mutations=(()=>{const E=r.slice(h.length).replace(/^\//,""),g=H.getPathKeys(E);let b=l,m=N;for(;g.length>0;){const O=g.shift();({oldValue:b,newValue:m}=ei(O,b,m))}const x=js(b,m);return U(r,b,m,x).map(O=>({target:H.getPathKeys(O.path.slice(r.length)),prev:O.oldValue,val:O.newValue}))})());const M=()=>{y.filter(E=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(E.type)).map(E=>{const g=H.getPathKeys(E.dataPath);return{sub:E,keys:g}}).sort((E,g)=>E.keys.length<g.keys.length?1:E.keys.length>g.keys.length?-1:0).forEach(({sub:E})=>{const g=(b,m,x,O=[])=>{const k=E.dataPath.slice(b.length).replace(/^\//,""),$=H.getPathKeys(k);for(;$.length>0;){const _=$.shift();if(typeof _=="string"&&(_==="*"||_[0]==="$")){const A=m===null?[]:Object.keys(m).map(T=>m instanceof Array?parseInt(T):T);x!==null&&Object.keys(x).forEach(T=>{const C=x instanceof Array?parseInt(T):T;!A.includes(C)&&A.push(T)}),A.forEach(T=>{const C=ei(T,m,x),L=O.concat({name:_,value:T});$.length===0?B(E,C.oldValue,C.newValue,L):g(H.getChildPath(b,_),C.oldValue,C.newValue,L)});return}else{b=H.getChildPath(b,_);const A=ei(_,m,x);m=A.oldValue,x=A.newValue}}B(E,m,x,O)};if(E.type.startsWith("notify_")&&H.get(E.eventPath).isAncestorOf(h)){const b=H.get(E.eventPath).isParentOf(h);(E.type==="notify_value"||E.type==="notify_child_changed"&&(!b||!["added","removed"].includes(q))||E.type==="notify_child_removed"&&q==="removed"&&b||E.type==="notify_child_added"&&q==="added"&&b)&&this.subscriptions.trigger(E.type,E.subscriptionPath,E.dataPath,null,null,o.context)}else g(h,l,N)}),y.filter(E=>["mutated","mutations","notify_mutated","notify_mutations"].includes(E.type)).forEach(E=>{let g=h;const b=E.eventPath.slice(g.length).replace(/^\//,""),m=H.getPathKeys(b);let x=l,O=N;for(;m.length>0;){const _=m.shift();g=H.getChildPath(g,_);const A=ei(_,x,O);x=A.oldValue,O=A.newValue}const k=U(g,x,O);if(k.length===0)return;const $=E.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(E.type))k.forEach((_,A)=>{const T=o.context,C=$?null:_.oldValue,L=$?null:_.newValue;this.subscriptions.trigger(E.type,E.subscriptionPath,_.path,C,L,T)});else if(["mutations","notify_mutations"].includes(E.type)){const _=$?null:k.map(A=>({target:H.getPathKeys(A.path.slice(E.subscriptionPath.length)),prev:A.oldValue,val:A.newValue}));this.subscriptions.trigger(E.type,E.subscriptionPath,E.subscriptionPath,null,_,o.context)}})};return o.waitForIndexUpdates===!1&&I.splice(0),yield Promise.all(I),ME(M),j})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(e){return z(this,arguments,function*(t,r={}){return(yield this.getNode(t,r)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,r){throw new Error("This method must be implemented by subclass")}updateNode(e,t,r){throw new Error("This method must be implemented by subclass")}transactNode(e,t){return z(this,arguments,function*(r,i,o={no_lock:!1,suppress_events:!1,context:null}){const s=o&&o.no_lock===!0,a=this.createTid(),c=s?{tid:a,release:FE}:yield this.nodeLocker.lock(r,a,!0,"transactNode");try{let l=!1;const u=()=>{l=!0};s&&this.subscriptions.add(r,"notify_value",u);const h=yield this.getNode(r,{tid:a}),y=h.revision;let d;try{d=i(h.value),d instanceof Promise&&(d=yield d.catch(f=>{this.debug.error(`Error in transaction callback: ${f.message}`)}))}catch(f){this.debug.error(`Error in transaction callback: ${f.message}`)}if(typeof d=="undefined")return;if(s&&this.subscriptions.remove(r,"notify_value",u),l)throw new gu("Node changed");return yield this.setNode(r,d,{assert_revision:y,tid:c.tid,suppress_events:o.suppress_events,context:o.context})}catch(l){if(l instanceof gu)return console.warn(`node value changed, running again. Error: ${l.message}`),this.transactNode(r,i,o);throw l}finally{c.release()}})}matchNode(e,t,r){return z(this,null,function*(){var i;const o=(i=r==null?void 0:r.tid)!=null?i:Nt.generate(),s=(c,l)=>z(this,null,function*(){if(l.length===0)return Promise.resolve(!0);const u=l.reduce((f,p)=>{let v=p.key;return typeof v=="string"&&v.includes("/")&&(v=v.slice(0,v.indexOf("/"))),f.indexOf(v)<0&&f.push(v),f},[]),h=u.slice();let y=!0;const d=[];try{return yield this.getChildren(c,{tid:o,keyFilter:u}).next(f=>{var p;const v=(p=f.key)!=null?p:f.index;h.includes(v)&&h.splice(h.indexOf(f.key),1);const w=l.filter(R=>R.key===v).map(R=>({op:R.op,compare:R.compare})),S=w.length>0?a(f,w):{isMatch:!0,promises:[]};if(y=S.isMatch,y){d.push(...S.promises);const R=l.filter(j=>typeof j.key=="string"&&j.key.startsWith(`${typeof v=="number"?`[${v}]`:v}/`)).map(j=>({key:j.key.slice(j.key.indexOf("/")+1),op:j.op,compare:j.compare}));if(R.length>0){const j=H.getChildPath(c,f.key),N=s(j,R).then(D=>({isMatch:D}));d.push(N)}}if(!y||h.length===0)return!1}),y&&(y=(yield Promise.all(d)).every(f=>f.isMatch)),y?(y=h.every(f=>{const p=new Qg(It(pe(pe({},typeof f=="number"&&{index:f}),typeof f=="string"&&{key:f}),{exists:!1})),v=l.filter(S=>typeof S.key=="string"&&S.key.startsWith(`${typeof f=="number"?`[${f}]`:f}/`)).map(S=>({op:S.op,compare:S.compare}));if(v.length>0&&!a(p,v).isMatch)return!1;const w=l.filter(S=>S.key===f).map(S=>({op:S.op,compare:S.compare}));return w.length===0?!0:a(p,w).isMatch}),y):!1}catch(f){throw this.debug.error(`Error matching on "${c}": `,f),f}}),a=(c,l)=>{const u=[];return{isMatch:l.every(h=>{let y=!0;if(h.op==="!exists"||h.op==="=="&&(typeof h.compare=="undefined"||h.compare===null))y=!c.exists;else if(h.op==="exists"||h.op==="!="&&(typeof h.compare=="undefined"||h.compare===null))y=c.exists;else if((h.op==="contains"||h.op==="!contains")&&h.compare instanceof Array&&h.compare.length===0)y=!0;else if(!c.exists)y=!1;else if(c.address)if(c.valueType===oe.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.op==="has"?"exists":"!exists",f=s(c.path,[{key:h.compare,op:d}]).then(p=>({key:c.key,isMatch:p}));u.push(f),y=!0}else if(c.valueType===oe.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=this.getNode(c.path,{tid:o}).then(({value:f})=>{const p=h.op==="contains"?h.compare instanceof Array?h.compare.every(v=>f.includes(v)):f.includes(h.compare):h.compare instanceof Array?!h.compare.some(v=>f.includes(v)):!f.includes(h.compare);return{key:c.key,isMatch:p}});u.push(d),y=!0}else if(c.valueType===oe.STRING){const d=this.getNode(c.path,{tid:o}).then(f=>({key:c.key,isMatch:this.test(f.value,h.op,h.compare)}));u.push(d),y=!0}else y=!1;else if(c.type===oe.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.compare in c.value;y=d&&h.op==="has"||!d&&h.op==="!has"}else if(c.type===oe.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=c.value.indexOf(h.compare)>=0;y=d&&h.op==="contains"||!d&&h.op==="!contains"}else{let d=this.test(c.value,h.op,h.compare);d instanceof Promise&&(u.push(d),d=!0),y=d}return y}),promises:u}};return s(e,t)})}test(e,t,r){if(t==="<")return e<r;if(t==="<=")return e<=r;if(t==="==")return e===r;if(t==="!=")return e!==r;if(t===">")return e>r;if(t===">=")return e>=r;if(t==="in")return r.indexOf(e)>=0;if(t==="!in")return r.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+r.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",o=new RegExp(i,"i").test(e.toString());return t==="like"?o:!o}if(t==="matches")return r.test(e.toString());if(t==="!matches")return!r.test(e.toString());if(t==="between")return e>=r[0]&&e<=r[1];if(t==="!between")return e<r[0]||e>r[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&r in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(r);return t==="contains"?i:!i}return!1}exportNode(e,t){return z(this,arguments,function*(r,i,o={format:"json",type_safe:!0}){if((o==null?void 0:o.format)!=="json")throw new Error("Only json output is currently supported");const s=typeof i!="function"?i.write.bind(i):i,a=(f,p)=>{const v=w=>w.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,S=>`\\u${S.charCodeAt(0).toString(16).padStart(4,"0")}`);return f===oe.DATETIME?(p=`"${p.toISOString()}"`,o.type_safe&&(p=`{".type":"date",".val":${p}}`)):f===oe.STRING?p=`"${v(p)}"`:f===oe.ARRAY?p="[]":f===oe.OBJECT?p="{}":f===oe.BINARY?(p=`"${v(ur.encode(p))}"`,o.type_safe&&(p=`{".type":"binary",".val":${p}}`)):f===oe.REFERENCE?(p=`"${p.path}"`,o.type_safe&&(p=`{".type":"reference",".val":${p}}`)):f===oe.BIGINT&&(p=`"${p}"`,o.type_safe&&(p=`{".type":"bigint",".val":${p}}`)),p};let c="",l="";const u=yield this.getNodeInfo(r);if(u.exists)if(u.type===oe.OBJECT)c="{",l="}";else if(u.type===oe.ARRAY)c="[",l="]";else{const f=yield this.getNode(r),p=a(u.type,f.value);return s(p)}else return s("null");if(c){const f=s(c);f instanceof Promise&&(yield f)}let h="",y=0;const d=[];if(yield this.getChildren(r).next(f=>{f.address?d.push(f):(y++>0&&(h+=","),typeof f.key=="string"&&(h+=`"${f.key}":`),h+=a(f.type,f.value))}),h){const f=s(h);f instanceof Promise&&(yield f)}for(;d.length>0;){const f=d.shift();let p=y++>0?",":"";const v=typeof f.index=="number"?f.index:f.key;if(typeof v=="string"&&(p+=`"${v}":`),p){const w=s(p);w instanceof Promise&&(yield w)}yield this.exportNode(H.getChildPath(r,v),s,o)}if(l){const f=s(l);f instanceof Promise&&(yield f)}})}importNode(e,t){return z(this,arguments,function*(r,i,o={format:"json",method:"set"}){const s={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},a=(P=!1)=>z(this,null,function*(){let I=yield i(262144);if(I===null)throw s.data?new Error(`Unexpected EOF at index ${s.offset+s.data.length}`):new Error("Unable to read data from stream");typeof I=="object"&&(I=Lg(I)),P?s.data+=I:(s.offset+=s.data.length,s.data=I,s.index=0)}),c=P=>z(this,null,function*(){let I="";return s.index+P>=s.data.length&&(I=s.data.slice(s.index),P-=I.length,yield a()),I+=s.data.slice(s.index,s.index+P),s.index+=P,I}),l=P=>z(this,null,function*(){if(s.index+P>s.data.length&&(yield a(!0)),s.index+P>s.data.length)throw new Error("Not enough data available from stream")}),u=P=>z(this,null,function*(){const I=yield c(P.length);if(I!==P)throw new Error(`Unexpected character "${I[0]}" at index ${s.offset+s.index}, expected "${P}"`)}),h=()=>z(this,null,function*(){const P=[" ","	","\r",`
`];for(;s.index>=s.data.length&&(yield a()),P.includes(s.data[s.index]);)s.index++}),y=P=>z(this,null,function*(){yield l(P);const I=s.index;return s.data.slice(I,I+P)}),d=()=>z(this,null,function*(){yield h();const P=yield y(1);switch(P){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(P==="-"||P>="0"&&P<="9")return"number";throw new Error(`Unknown value at index ${s.offset+s.index}`)}}}),f=()=>z(this,null,function*(){yield u('"');let P="",I=s.index;for(;s.data[I]!=='"'||s.data[I-1]==="\\";)I++,I>=s.data.length&&(P+=s.data.slice(s.index),yield a(),I=0);return P+=s.data.slice(s.index,I),s.index=I+1,S(P)}),p=()=>z(this,null,function*(){throw s.data[s.index]==="t"?yield u("true"):s.data[s.index]==="f"&&(yield u("false")),new Error(`Expected true or false at index ${s.offset+s.index}`)}),v=()=>z(this,null,function*(){let P="",I=s.index;const B=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;B.includes(s.data[I]);)I++,I>=s.data.length&&(P+=s.data.slice(s.index),yield a(),I=0);return P+=s.data.slice(s.index,I),s.index=I,P.endsWith("n")?BigInt(P.slice(0,-1)):P.includes(".")?parseFloat(P):parseInt(P)}),w=()=>z(this,null,function*(){yield h();const P=yield d(),I=yield(()=>{switch(P){case"string":return f();case"object":return{};case"array":return[];case"number":return v();case"null":return null;case"undefined":return;case"boolean":return p()}})();return{type:P,value:I}}),S=P=>P.replace(/\\n/g,`
`).replace(/\\"/g,'"'),R=(P,I)=>{const B=I[".type"];let U=I[".val"];switch(B){case"Date":case"date":{U=new Date(U);break}case"Buffer":case"binary":{if(U=S(U),U.startsWith("<~"))U=ur.decode(U);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${P}"`);break}case"PathReference":case"reference":{U=new et(U);break}case"bigint":{U=BigInt(U);break}default:throw new Error(`Import error: Unsupported type "${B}" for value at path "/${P}"`)}return U},j={acebase_import_id:Nt.generate()},N={suppress_events:o.suppress_events,context:j},D=P=>z(this,null,function*(){if(yield u("{"),yield h(),(yield y(1))==="}")return s.index++,this.setNode(P.path,{},N);let I=0,B={},U=!1;const M=()=>z(this,null,function*(){let g;U?Object.keys(B).length>0&&(g=this.updateNode(P.path,B,N)):(U=!0,g=this.setNode(P.path,B,N)),B={},g&&(yield g)}),E=[];for(;;){yield h();const g=yield f();yield h(),yield u(":"),yield h();const{value:b,type:m}=yield w();if(B[g]=b,I++,["object","array"].includes(m)&&(E.push(M()),m==="object"?yield D(P.child(g)):yield q(P.child(g))),yield h(),(yield y(1))==="}"){s.index++;break}yield u(",")}if(I===2&&".type"in B&&".val"in B){const g=R(P.path,B);return this.setNode(P.path,g,N)}E.push(M()),yield Promise.all(E)}),q=P=>z(this,null,function*(){if(yield u("["),yield h(),(yield y(1))==="]")return s.index++,this.setNode(P.path,[],N);let I=!1,B=[],U={};const M=()=>z(this,null,function*(){let m;I?Object.keys(U).length>0&&(m=this.updateNode(P.path,U,N),U={}):(I=!0,m=this.setNode(P.path,B,N),B=null),m&&(yield m)}),E=(m,x)=>{I?U[x]=m:B.push(m)},g=[];let b=0;for(;;){yield h();const{value:m,type:x}=yield w();if(E(m,b),["object","array"].includes(x)&&(g.push(M()),x==="object"?yield D(P.child(b)):yield q(P.child(b))),yield h(),(yield y(1))==="]"){s.index++;break}yield u(","),b++}g.push(M()),yield Promise.all(g)});return(()=>z(this,null,function*(){const{value:P,type:I}=yield w();if(["object","array"].includes(I)){const B=H.get(r);I==="object"?yield D(B):yield q(B)}else yield this.setNode(r,P,N)}))()})}setSchema(e,t,r=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const s=this._schemas.findIndex(a=>a.path===e);s>=0&&this._schemas.splice(s,1);return}const i=new TE(t,{warnOnly:r,warnCallback:s=>this.debug.warn(s)}),o=this._schemas.find(s=>s.path===e);o?o.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((s,a)=>{const c=H.getPathKeys(s.path),l=H.getPathKeys(a.path);return c.length===l.length?0:c.length<l.length?-1:1}))}getSchema(e){const t=this._schemas.find(r=>r.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,r={updates:!1}){let i={ok:!0};const o=H.get(e);return this._schemas.filter(s=>o.isOnTrailOf(s.path)).every(s=>{if(o.isDescendantOf(s.path)){const u=H.fillVariables(s.path,e),h=o.keys.slice(H.getPathKeys(s.path).length);return i=s.schema.check(u,t,r.updates,h),i.ok}const a=H.getPathKeys(s.path).slice(o.keys.length);if(r.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=r.updates===!0&&a.length===0,l=(u,h,y)=>{if(y.length===0)return s.schema.check(u,h,c);if(h===null)return{ok:!0};const d=y[0];if(typeof d=="string"&&(d==="*"||d[0]==="$")){if(h===null||typeof h!="object")return{ok:!0};let f;return Object.keys(h).every(p=>{const v=H.getChildPath(u,p),w=h[p];return f=l(v,w,y.slice(1)),f.ok}),f}else{const f=H.getChildPath(u,d),p=h[d];return l(f,p,y.slice(1))}};return i=l(e,t,a),i.ok}),i}}class Lo{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return H}}class cp{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:KE}=Vg;class Vh{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Nt.generate()}getChildCount(e){return z(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return z(this,null,function*(){const t=new Map;return yield Promise.all(e.map(r=>this.get(r).then(i=>t.set(r,i)))),t})}setMultiple(e){return z(this,null,function*(){yield Promise.all(e.map(({path:t,node:r})=>this.set(t,r)))})}removeMultiple(e){return z(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return z(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return z(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(Lo.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class Do extends qh{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,r=t?new Zg(console,this.lockTimeout):null;this.getTransaction=i=>z(this,[i],function*({path:o,write:s}){const a=yield e.getTransaction({path:o,write:s});Wt(typeof a.id=="string","transaction id not set");const c=a.rollback,l=a.commit;return a.commit=()=>z(this,null,function*(){const u=yield l.call(a);return t&&(yield a._lock.release("commit")),u}),a.rollback=u=>z(this,null,function*(){const h=yield c.call(a,u);return t&&(yield a._lock.release("rollback")),h}),t&&(a._lock=yield r.lock(o,a.id,s,`${this.name}::getTransaction`)),a})}}class pl extends Qg{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class HE extends zE{constructor(e,t,r){super(e,t,r),this._customImplementation=t,this._init()}_init(){return z(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize(_t.dim)),this.debug.log("- Type: CustomStorage".colorize(_t.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize(_t.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize(_t.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize(_t.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,r){const i=s=>{if(s===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof s))return s;if(s instanceof Date)return{type:oe.DATETIME,value:s.getTime()};if(s instanceof et)return{type:oe.REFERENCE,value:s.path};if(s instanceof ArrayBuffer)return{type:oe.BINARY,value:ur.encode(s)};if(typeof s=="object")return Wt(Object.keys(s).length===0,"child object stored in parent can only be empty"),s},o="Caller should have pre-processed the value by converting it to a string";if(t.type===oe.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${o}`);const s={};for(let a=0;a<t.value.length;a++)s[a]=t.value[a];t.value=s}if(t.type===oe.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${o}`),t.value=ur.encode(t.value)),t.type===oe.REFERENCE&&t.value instanceof et&&(console.warn(`Unprocessed path reference. ${o}`),t.value=t.value.path),[oe.OBJECT,oe.ARRAY].includes(t.type)){const s=t.value;t.value={},Object.keys(s).forEach(a=>{t.value[a]=i(s[a])})}return r.transaction.set(e,t)}_processReadNodeValue(e){const t=r=>{if(r.type===oe.BINARY)return ur.decode(r.value);if(r.type===oe.DATETIME)return new Date(r.value);if(r.type===oe.REFERENCE)return new et(r.value);throw new Error(`Unhandled child value type ${r.type}`)};switch(e.type){case oe.ARRAY:case oe.OBJECT:{const r=e.value;Object.keys(r).forEach(i=>{const o=r[i];typeof o=="object"&&"type"in o&&(r[i]=t(o))}),e.value=r;break}case oe.BINARY:{e.value=ur.decode(e.value);break}case oe.REFERENCE:{e.value=new et(e.value);break}case oe.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return z(this,null,function*(){const r=yield t.transaction.get(e);return r===null?null:(typeof r!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(r),r)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=oe.STRING;else if(typeof e=="number")t=oe.NUMBER;else if(typeof e=="boolean")t=oe.BOOLEAN;else if(e instanceof Array)t=oe.ARRAY;else if(typeof e=="object")if("type"in e){const r=e;t=r.type,e=r.value,t===oe.DATETIME?e=new Date(e):t===oe.REFERENCE&&(e=new et(e))}else t=oe.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,r){return z(this,null,function*(){if(!r.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof r.diff=="undefined"&&typeof r.currentValue!="undefined"){const f=KE(r.currentValue,t);r.merge&&typeof f=="object"&&(f.removed=f.removed.filter(p=>t[p]===null)),r.diff=f}if(r.diff==="identical")return;const i=r.transaction,o=r.currentValue===null?null:yield this._readNode(e,{transaction:i});if(r.merge&&o){if(o.type===oe.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(f=>isNaN(parseInt(f))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&o.type!==oe.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const s=r.revision||Nt.generate(),a={type:o&&o.type===oe.ARRAY?oe.ARRAY:oe.OBJECT,value:{}},c={};if(t instanceof Array){a.type=oe.ARRAY;const f={};for(let p=0;p<t.length;p++)f[p]=t[p];t=f}else t instanceof et?(a.type=oe.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=oe.BINARY,a.value=ur.encode(t)):typeof t=="string"&&(a.type=oe.STRING,a.value=t);const l=o?[oe.OBJECT,oe.ARRAY].includes(o.type):!1,u=[oe.OBJECT,oe.ARRAY].includes(a.type),h={current:[],new:[]};let y=null;l&&(y=o.value,h.current=Object.keys(y),u&&(a.value=y)),u&&(r.merge||Object.keys(a.value).forEach(f=>{f in t||(t[f]=null)}),Object.keys(t).forEach(f=>{const p=t[f];if(delete a.value[f],p!==null){if(typeof p=="undefined")if(this.settings.removeVoidProperties===!0){delete t[f];return}else throw new Error(`Property "${f}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(p)?a.value[f]=p:c[f]=p}}));const d=a.type===oe.ARRAY;if(o){if(this.debug.log(`Node "/${e}" is being ${r.merge?"updated":"overwritten"}`.colorize(_t.cyan)),l||u){const p=H.get(e),v=[];let w=!1;const S=I=>(w=!0,!i.production&&!p.isParentOf(I)&&this.throwImplementationError(`"${I}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),R=I=>{w||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const B=H.get(I).key;return v.push(B.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},S,R),h.current=h.current.concat(v),u&&(r&&r.merge&&(h.new=h.current.slice()),Object.keys(t).forEach(I=>{h.new.includes(I)||h.new.push(I)}));const j={insert:h.new.filter(I=>!h.current.includes(I)),update:[],delete:r&&r.merge?Object.keys(t).filter(I=>t[I]===null):h.current.filter(I=>!h.new.includes(I))};if(j.update=h.new.filter(I=>h.current.includes(I)&&!j.delete.includes(I)),d&&r.merge&&(j.insert.length>0||j.delete.length>0)&&!j.update.concat(j.insert).every((I,B,U)=>U.includes(B.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const N=Object.keys(c).map(I=>{const B=d?parseInt(I):I,U=typeof r.diff=="object"?r.diff.forChild(B):void 0;if(U==="identical")return;const M=p.childPath(B),E=c[B],g=typeof r.currentValue=="undefined"?void 0:r.currentValue!==null&&typeof r.currentValue=="object"&&B in r.currentValue?r.currentValue[B]:null;return this._writeNode(M,E,{transaction:i,revision:s,merge:!1,currentValue:g,diff:U})}),D=u?v.filter(I=>I in a.value):[],q=j.delete.concat(D).map(I=>{const B=d?parseInt(I):I,U=p.childPath(B);return this._deleteNode(U,{transaction:i})}),P=N.concat(q);yield Promise.all(P)}const f=this._storeNode(e,{type:a.type,value:a.value,revision:o.revision,revision_nr:o.revision_nr+1,created:o.created,modified:Date.now()},{transaction:i});if(f instanceof Promise)return yield f}else{if(this.debug.log(`Node "/${e}" is being created`.colorize(_t.cyan)),d&&!Object.keys(a.value).concat(Object.keys(c)).every((v,w,S)=>S.includes(w.toString())))throw new Error("Cannot store arrays with missing entries");const f=Object.keys(c).map(v=>{const w=d?parseInt(v):v,S=H.getChildPath(e,w),R=c[w];return this._writeNode(S,R,{transaction:i,revision:s,merge:!1,currentValue:null})}),p=this._storeNode(e,{type:a.type,value:a.value,revision:s,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});p instanceof Promise&&f.push(p),yield Promise.all(f)}})}_deleteNode(e,t){return z(this,null,function*(){const r=H.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize(_t.cyan));const i=[e];let o=!1;const s=l=>(o=!0,!c.production&&!r.isAncestorOf(l)&&this.throwImplementationError(`"${l}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=l=>(o||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(l),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},s,a),this.debug.log(`Nodes ${i.map(l=>`"/${l}"`).join(",")} are being deleted`.colorize(_t.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let r;const i={next(s){return r=s,o()}},o=()=>z(this,null,function*(){const s=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>z(this,null,function*(){const c=yield this._readNode(e,{transaction:s});if(!c)throw new Dh(`Node "/${e}" does not exist`);if(![oe.OBJECT,oe.ARRAY].includes(c.type))return;const l=c.type===oe.ARRAY,u=c.value;let h=Object.keys(u).map(v=>l?parseInt(v):v);t.keyFilter&&(h=h.filter(v=>t.keyFilter.includes(v)));const y=H.get(e);if(h.length>0&&h.every(v=>{const w=this._getTypeFromStoredValue(u[v]),S=new pl({path:y.childPath(v),key:l?null:v,index:l?v:null,type:w.type,address:null,exists:!0,value:w.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=r(S)===!1,!a}),a)return;let d=!1;const f=v=>{if(d=!0,!s.production&&!y.isParentOf(v)&&this.throwImplementationError(`"${v}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const w=H.get(v).key;return t.keyFilter.includes(w)}return!0},p=(v,w)=>{d||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const S=H.get(v).key,R=new pl({path:v,type:w.type,key:l?null:S,index:l?S:null,address:new cp(v),exists:!0,value:null,revision:w.revision,revision_nr:w.revision_nr,created:new Date(w.created),modified:new Date(w.modified)});return a=r(R)===!1,!a};yield s.childrenOf(e,{metadata:!0,value:!1},f,p)}))(),t.transaction||(yield s.commit()),a}catch(a){throw t.transaction||(yield s.rollback(a)),a}});return i}getNode(e,t){return z(this,null,function*(){t=t||{};const r=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>z(this,null,function*(){const o=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,s=H.get(e),a=yield this._readNode(e,{transaction:r});if(!a){if(e==="")return{value:null};const R=yield r.moveToParentPath(s.parentPath);Wt(R===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const j=yield this._readNode(s.parentPath,{transaction:r});if(j&&[oe.OBJECT,oe.ARRAY].includes(j.type)&&s.key in j.value){const N=this._getTypeFromStoredValue(j.value[s.key]);return{revision:j.revision,revision_nr:j.revision_nr,created:j.created,modified:j.modified,type:N.type,value:N.value}}return{value:null}}const c=a.type===oe.ARRAY,l=R=>{const j=N=>/^[0-9]+$/.test(N);return R.map(N=>H.get(c&&j(N)?`[${N}]`:N))},u=t.include?l(t.include):[],h=t.exclude?l(t.exclude):[],y=(R,j)=>{if([oe.OBJECT,oe.ARRAY].includes(j.type)&&u.length>0){const N=H.getPathKeys(R).slice(s.keys.length),D=new H(N),q=[],P=u.filter(B=>B.isDescendantOf(D));if(P.length>0){const B=j.type===oe.ARRAY;q.push(...Object.keys(j.value).map(U=>B?+U:U));for(const U of P){const M=U.keys[N.length];if(typeof M=="string"&&(M==="*"||M.startsWith("$"))){q.splice(0);break}const E=q.indexOf(M);E>=0&&q.splice(E,1)}}const I=u.some(B=>B.isChildOf(D));if(h.some(B=>B.isChildOf(D))&&!I){const B=h.filter(U=>U.isChildOf(D));for(let U=0;U<q.length;U++)B.find(M=>M.equals(q[U]))||(q.splice(U,1),U--)}for(const B of q)delete j.value[B]}};y(e,a);let d=!1;const f=(R,j)=>{if(d=!0,!r.production&&!s.isAncestorOf(R)&&this.throwImplementationError(`"${R}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!o)return!0;const N=H.getPathKeys(R).slice(s.keys.length),D=new H(N);let q=(u.length>0?u.some(P=>D.isOnTrailOf(P)):!0)&&(h.length>0?!h.some(P=>P.equals(D)||P.isAncestorOf(D)):!0);return q&&t.child_objects===!1&&(s.isParentOf(R)&&[oe.OBJECT,oe.ARRAY].includes(j?j.type:-1)||H.getPathKeys(R).length>s.pathKeys.length+1)&&(q=!1),q},p=[],v=(R,j)=>{if(d||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[oe.OBJECT,oe.ARRAY].includes(j.type))return!0;y(R,j),this._processReadNodeValue(j);const N=j;return N.path=R,p.push(N),!0};yield r.descendantsOf(e,{metadata:!0,value:!0},f,v),this.debug.log(`Read node "/${e}" and ${o?"(filtered) ":""}descendants from ${p.length+1} records`.colorize(_t.magenta));const w=a,S=R=>{const j=[];return Object.keys(R).forEach(N=>{const D=parseInt(N);j[D]=R[D]}),j};if(a.type===oe.ARRAY&&(w.value=S(w.value)),a.type===oe.OBJECT||a.type===oe.ARRAY){const R=H.getPathKeys(e),j=a.value;for(let N=0;N<p.length;N++){const D=p[N],q=H.getPathKeys(D.path).slice(R.length);let P=j;for(let I=0;I<q.length;I++){Wt(typeof P=="object","parent must be an object/array to have children!!");const B=q[I],U=I===q.length-1,M=U?D.type:typeof q[I+1]=="number"?oe.ARRAY:oe.OBJECT;let E;U?(E=D.value,M===oe.ARRAY&&(E=S(E))):E=M===oe.OBJECT?{}:[],B in P?typeof P[B]==typeof E&&[oe.OBJECT,oe.ARRAY].includes(M)?Object.keys(E).forEach(g=>{g in P[B]&&this.throwImplementationError(`Custom storage merge error: child key "${g}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),P[B][g]=E[g]}):this.debug.error(`The value stored in node "${D.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:P,key:B,nodeType:M,nodeValue:E}):P[B]=E,P=P[B]}}}else p.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(w.value).forEach(R=>{typeof w.value[R]=="object"&&w.value[R].constructor===Object&&(Wt(Object.keys(w.value[R]).length===0),delete w.value[R])}),t.include,t.exclude){const R=(j,N)=>{if(typeof j!="object")return;const D=N[0];D==="*"?Object.keys(j).forEach(q=>{R(j[q],N.slice(1))}):N.length>1?D in j&&R(j[D],N.slice(1)):delete j[D]};t.exclude.forEach(j=>{const N=H.getPathKeys(j);R(w.value,N)})}return w}))();return t.transaction||(yield r.commit()),i}catch(i){throw t.transaction||(yield r.rollback(i)),i}})}getNodeInfo(e){return z(this,arguments,function*(t,r={}){r=r||{};const i=H.get(t),o=r.transaction||(yield this._customImplementation.getTransaction({path:t,write:!1}));try{const s=yield this._readNode(t,{transaction:o}),a=new pl({path:t,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:s?s.type:0,exists:s!==null,address:s?new cp(t):null,created:s?new Date(s.created):null,modified:s?new Date(s.modified):null,revision:s?s.revision:null,revision_nr:s?s.revision_nr:null});if(!s&&t!==""){const c=yield o.moveToParentPath(i.parentPath);Wt(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${t}"`);const l=yield this._readNode(i.parentPath,{transaction:o});l&&[oe.OBJECT,oe.ARRAY].includes(l.type)&&i.key in l.value?(a.exists=!0,a.value=l.value[i.key],a.address=null,a.type=l.type,a.created=new Date(l.created),a.modified=new Date(l.modified),a.revision=l.revision,a.revision_nr=l.revision_nr):a.address=null}return r.include_child_count&&(a.childCount=0,[oe.OBJECT,oe.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=s.value?Object.keys(s.value).length:0,a.childCount+=yield o.getChildCount(t))),r.transaction||(yield o.commit()),a}catch(s){throw r.transaction||(yield o.rollback(s)),s}})}setNode(e,t){return z(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const s=H.get(r),a=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{if(r===""){if(i===null||typeof i!="object"||i instanceof Array||i instanceof ArrayBuffer||"buffer"in i&&i.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${i}`);yield this._writeNodeWithTracking("",i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context})}else if(typeof o.assert_revision!="undefined"){const c=yield this.getNodeInfo(r,{transaction:a});if(c.revision!==o.assert_revision)throw new gu(`revision '${c.revision}' does not match requested revision '${o.assert_revision}'`);if(c.address&&c.address.path===r&&i!==null&&!this.valueFitsInline(i))yield this._writeNodeWithTracking(r,i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context});else{const l=yield a.moveToParentPath(s.parentPath);Wt(l===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(s.parentPath,{[s.key]:i},{merge:!0,transaction:a,suppress_events:o.suppress_events,context:o.context})}}else{const c=yield a.moveToParentPath(s.parentPath);Wt(c===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(s.parentPath,{[s.key]:i},{transaction:a,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield a.commit())}catch(c){throw o.transaction||(yield a.rollback(c)),c}})}updateNode(e,t){return z(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof i!="object")throw new Error("invalid updates argument");if(Object.keys(i).length===0)return;const s=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{const a=yield this.getNodeInfo(r,{transaction:s}),c=H.get(r);if(a.exists&&a.address&&a.address.path===r)yield this._writeNodeWithTracking(r,i,{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context});else if(a.exists){const l=H.get(r),u=yield s.moveToParentPath(l.parentPath);Wt(u===l.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(l.parentPath,{[l.key]:i},{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context})}else{const l=yield s.moveToParentPath(c.parentPath);Wt(l===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(c.parentPath,{[c.key]:i},{transaction:s,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield s.commit())}catch(a){throw o.transaction||(yield s.rollback(a)),a}})}}class JE{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return z(this,null,function*(){var r,i;try{this.running++;const o=yield e();if(this.results[t]=o,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(r=this.doneCallback)==null||r.call(this,this.results);else if(this.scheduled.length>0){const s=this.scheduled.shift();this.execute(s.task,s.index)}}catch(o){this.done=!0,(i=this.errorCallback)==null||i.call(this,o)}})}add(e){var t;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const r=this.added++;((t=this.options)==null?void 0:t.wait)!==!0&&this.running<this.limit?this.execute(e,r):this.scheduled.push({task:e,index:r})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return z(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const YE=()=>{};function tm(n,e,t){return z(this,arguments,function*(r,i,o,s={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:YE}){var a,c,l,u,h,y;typeof s!="object"&&(s={}),typeof s.snapshots=="undefined"&&(s.snapshots=!1);const d={};(a=r.storage.settings.transactions)!=null&&a.log&&(d.acebase_cursor=Nt.generate());const f=o.filters.map(E=>pe({},E)),p=o.order.map(E=>pe({},E)),v=E=>{E.sort((g,b)=>{const m=x=>{const O=p[x],k=H.getPathKeys(typeof O.key=="number"?`[${O.key}]`:O.key),$=k.reduce((A,T)=>A!==null&&typeof A=="object"&&T in A?A[T]:null,g.val),_=k.reduce((A,T)=>A!==null&&typeof A=="object"&&T in A?A[T]:null,b.val);return $===null?_===null?0:O.ascending?-1:1:_===null?O.ascending?1:-1:$==_?x<p.length-1?m(x+1):g.path<b.path?-1:1:$<_?O.ascending?-1:1:O.ascending?1:-1};return m(0)})},w=(E,g)=>z(this,null,function*(){if(E.length===0)return[];const b=50,m=new JE(b),x=[];return E.forEach(({path:O},k)=>m.add(()=>z(this,null,function*(){const $=(yield r.storage.getNode(O,g)).value;if($===null){r.storage.debug.warn(`Indexed result "/${O}" does not have a record!`);return}const _={path:O,val:$};M.sorted?x[k]=_:(x.push(_),!M.skipped&&x.length>o.skip+Math.abs(o.take)&&(v(x),x.pop()))}))),yield m.finish(),x}),S=H.get(i),R=S.keys.some(E=>E==="*"||E.toString().startsWith("$")),j=r.storage.indexes.get(i),N=[];let D=()=>z(this,null,function*(){});if(R){const E=S.keys.filter(m=>typeof m=="string"&&m.startsWith("$")),g=E.length>0&&E.every(m=>o.filters.some(x=>x.key===m&&["==","in"].includes(x.op))),b=typeof s.monitor=="object"&&[(c=s.monitor)==null?void 0:c.add,(l=s.monitor)==null?void 0:l.change,(u=s.monitor)==null?void 0:u.remove].some(m=>m===!0);if(g&&!b){const m=[];for(const A of E){const T=o.filters.filter(L=>L.key===A).reduce((L,V)=>{if(V.op==="=="&&L.push(V.compare),V.op==="in"){if(!(V.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");L.push(...V.compare)}return L},[]),C=m.splice(0);T.forEach(L=>{C.length===0?m.push({[A]:L}):m.push(...C.map(V=>It(pe({},V),{[A]:L})))})}const x=o.filters.filter(A=>!E.includes(A.key)),O=m.map(A=>H.get(H.getPathKeys(i).map(T=>{var C;return(C=A[T])!=null?C:T})).path),k=o.order.length>0,$=O.map(A=>{var T;return tm(r,A,{filters:x,take:0,skip:0,order:[]},{snapshots:k,cache_mode:s.cache_mode,include:[...(T=s.include)!=null?T:[],...o.order.map(C=>C.key)],exclude:s.exclude})});let _=(yield Promise.all($)).reduce((A,T)=>(A.push(...T.results),A),[]);if(k&&v(_),o.skip>0&&_.splice(0,o.skip),o.take>0&&_.splice(o.take),s.snapshots&&(!k||((h=s.include)==null?void 0:h.length)>0||((y=s.exclude)==null?void 0:y.length)>0||!s.child_objects)){const{include:A,exclude:T,child_objects:C}=s;_=yield w(_,{include:A,exclude:T,child_objects:C})}return{results:_,context:null,stop:D}}else if(j.length===0){const m=new Error(`Query on wildcard path "/${i}" requires an index`);return Promise.reject(m)}if(f.length===0){const m=j.filter(x=>x.type==="normal")[0];f.push({key:m.key,op:"!=",compare:null})}}f.forEach(E=>{if(E.index)return;const g=j.filter(b=>b.key===E.key).filter(b=>b.validOperators.includes(E.op));if(g.length>=1){const b=f.filter(k=>k!==E).map(k=>k.key),m=p.map(k=>k.key).filter(k=>k!==E.key),x=g.map(k=>{const $=k.includeKeys.concat(k.key),_=$.filter(L=>b.includes(L)),A=$.filter(L=>m.includes(L)),T=_.concat(A.filter(L=>!_.includes(L))),C={filters:_.length,sorting:A.length*(o.take!==0?A.length:1),both:T.length*T.length,get total(){return this.filters+this.sorting+this.both}};return{index:k,points:C.total,filterKeys:_,sortKeys:A}});x.sort((k,$)=>k.points>$.points?-1:1);const O=x[0];E.index=O.index,O.filterKeys.forEach(k=>{f.filter($=>$!==E&&$.key===k).forEach($=>{!Uh.validOperators.includes($.op)||($.indexUsage="filter",$.index=O.index)})}),O.sortKeys.forEach(k=>{p.filter($=>$.key===k).forEach($=>{$.index=O.index})})}E.index&&N.push({index:E.index,description:E.index.description})}),p.length>0&&o.take!==0&&f.length===0&&p.forEach(E=>{E.index||(E.index=j.filter(g=>g.key===E.key).find(g=>g.type==="normal"))});const q=N.map(E=>E.description).join(", ");N.length>0&&r.storage.debug.log(`Using indexes for query: ${q}`);const P=f.filter(E=>!E.index),I=/^[a-z]+:/i;if(P.some(E=>I.test(E.op))){const E=P.find(b=>I.test(b.op)),g=new Error(`query contains operator "${E.op}" which requires a special index that was not found on path "${i}", key "${E.key}"`);return Promise.reject(g)}const B=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let E=0;E<P.length;E++){const g=P[E];if(!B.includes(g.op))return Promise.reject(new Error(`query contains unknown filter operator "${g.op}" on path "${i}", key "${g.key}"`))}if(R&&P.length>0){const E=P.reduce((b,m)=>(b.indexOf(m.key)<0&&b.push(m.key),b),[]).map(b=>`"${b}"`),g=new Error(`This wildcard path query on "/${i}" requires index(es) on key(s): ${E.join(", ")}. Create the index(es) and retry`);return Promise.reject(g)}const U=[];f.forEach(E=>{if(E.index&&E.indexUsage!=="filter"){let g=E.index.query(E.op,E.compare).then(m=>(s.eventHandler&&s.eventHandler({name:"stats",type:"index_query",source:E.index.description,stats:m.stats}),m.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"index_query",source:E.index.description,hints:m.hints}),m));const b=f.filter(m=>m.index===E.index&&m.indexUsage==="filter");b.length>0&&(g=g.then(m=>(b.forEach(x=>{const{key:O,op:k,index:$}=x;let{compare:_}=x;typeof _=="string"&&!$.caseSensitive&&(_=_.toLocaleLowerCase($.textLocale)),m=m.filterMetadata(O,k,_)}),m))),U.push(g)}});const M={filtered:f.length===0,skipped:o.skip===0,taken:o.take===0,sorted:p.length===0,preDataLoaded:!1,dataLoaded:!1};if(f.length===0&&o.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${i}"`),o.take=100),p.length>0&&p[0].index){const E=p[0].index,g=o.take<0?!p[0].ascending:p[0].ascending;if(f.length===0&&p.slice(1).every(b=>E.allMetadataKeys.includes(b.key))){r.storage.debug.log(`Using index for sorting: ${E.description}`);const b=p.slice(1).map(x=>(x.index=E,{key:x.key,ascending:x.ascending})),m=E.take(o.skip,Math.abs(o.take),{ascending:g,metadataSort:b}).then(x=>(s.eventHandler&&s.eventHandler({name:"stats",type:"sort_index_take",source:E.description,stats:x.stats}),x.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"sort_index_take",source:E.description,hints:x.hints}),x));U.push(m),M.skipped=!0,M.taken=!0,M.sorted=!0}}return Promise.all(U).then(E=>z(this,null,function*(){let g=[];if(E.length===1){const _=E[0];g=_.map(A=>{const T={key:A.key,path:A.path,val:{[_.filterKey]:A.value}};return A.metadata&&Object.assign(T.val,A.metadata),T}),M.filtered=!0}else if(E.length>1){E.sort((T,C)=>T.length<C.length?-1:1);const _=E[0],A=E.slice(1);g=_.reduce((T,C)=>{const L={key:C.key,path:C.path,val:{[_.filterKey]:C.value}};return A.every(V=>V.findIndex(K=>K.path===C.path)>=0)&&(C.metadata&&Object.assign(L.val,C.metadata),A.forEach(V=>{const K=V.find(G=>G.path===L.path);L.val[V.filterKey]=K.value,K.metadata&&Object.assign(L.val,K.metadata)}),T.push(L)),T},[]),M.filtered=!0}if(R||U.length>0&&P.length===0){if(p.length===0||p.every(_=>_.index)){if(M.preDataLoaded=!0,!M.sorted&&p.length>0&&v(g),M.sorted=!0,!M.skipped&&o.skip>0&&(g=o.take<0?g.slice(0,-o.skip):g.slice(o.skip)),!M.taken&&o.take!==0&&(g=o.take<0?g.slice(o.take):g.slice(0,o.take)),M.skipped=!0,M.taken=!0,!s.snapshots)return g;const _={include:s.include,exclude:s.exclude,child_objects:s.child_objects};return w(g,_).then(A=>(M.dataLoaded=!0,A))}if(s.snapshots||!M.sorted){const _=p.length>0,A=_?{include:p.map(T=>T.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects};return w(g,A).then(T=>(p.length>0&&v(T),M.sorted=!0,o.skip>0&&(T=o.take<0?T.slice(0,-o.skip):T.slice(o.skip)),o.take!==0&&(T=o.take<0?T.slice(o.take):T.slice(0,o.take)),M.skipped=!0,M.taken=!0,s.snapshots&&_?w(T,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}):T))}else return g}let b;g.length>0&&(b=g.map(_=>_.key));let m=[],x=!1;const O=p.length>0,k=O?{include:p.map(_=>_.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects},$={promises:[],add(_){if(this.promises.push(_),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then(A=>{})}};try{yield r.storage.getChildren(i,{keyFilter:b,async:!0}).next(_=>{if(_.type!==oe.OBJECT||!_.address)return;if(x)return!1;const A=()=>z(this,null,function*(){if(!(yield r.storage.matchNode(_.address.path,P)))return;const C=_.address.path;let L;if(s.snapshots||p.length>0){const V=yield r.storage.getNode(C,k);L={path:C,val:V.value}}else L={path:C};m.push(L),o.take!==0&&m.length>Math.abs(o.take)+o.skip&&(p.length>0?v(m):o.take>0&&(x=!0),m.pop())}),T=$.add(A());if(T instanceof Promise)return T})}catch(_){return _ instanceof Dh||r.storage.debug.warn(`Error getting child stream: ${_}`),[]}return yield Promise.all($.promises),M.preDataLoaded=O,M.dataLoaded=!O,p.length>0&&v(m),M.sorted=!0,o.skip>0&&(m=o.take<0?m.slice(0,-o.skip):m.slice(o.skip)),M.skipped=!0,o.take!==0&&(m=o.take<0?m.slice(o.take):m.slice(0,o.take)),M.taken=!0,M.dataLoaded||(m=yield w(m,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}),M.dataLoaded=!0),m})).then(E=>{if(!M.sorted&&p.length>0&&v(E),s.snapshots||(E=E.map(g=>g.path)),!M.skipped&&o.skip>0&&(E=o.take<0?E.slice(0,-o.skip):E.slice(o.skip)),!M.taken&&o.take!==0&&(E=o.take<0?E.slice(o.take):E.slice(0,o.take)),s.monitor===!0&&(s.monitor={add:!0,change:!0,remove:!0}),typeof s.monitor=="object"&&(s.monitor.add||s.monitor.change||s.monitor.remove)){const g=s.monitor,b=s.snapshots?E.map(T=>T.path):E.slice(),m=r.db.ref(i),x=T=>{const C=b.indexOf(T);C<0||b.splice(C,1)},O=T=>{b.includes(T)||b.push(T)},k=()=>{r.unsubscribe(m.path,"child_changed",$),r.unsubscribe(m.path,"child_added",_),r.unsubscribe(m.path,"notify_child_removed",A)};D=()=>z(this,null,function*(){k()});const $=(T,C,L,V)=>z(this,null,function*(){const K=b.includes(C);let G=!0;const ie=[];f.forEach(ne=>!ie.includes(ne.key)&&ie.push(ne.key));const ee=[];typeof V=="object"&&Object.keys(V).forEach(ne=>!ee.includes(ne)&&ee.push(ne)),typeof L=="object"&&Object.keys(L).forEach(ne=>!ee.includes(ne)&&ee.push(ne));const fe=[];let de=ee.every(ne=>ie.includes(ne)?f.filter(ce=>ce.key===ne).every(ce=>{var Me;return((Me=ce.index)==null?void 0:Me.textLocaleKey)&&!ee.includes(ce.index.textLocaleKey)?(fe.push(ce.index.textLocaleKey),!0):B.includes(ce.op)?r.storage.test(L[ne],ce.op,ce.compare):ce.index.test(L,ce.op,ce.compare)}):!0);if(de&&(fe.push(...ie.filter(ne=>!ee.includes(ne))),!K&&fe.length>0)){const ne=f.filter(ve=>fe.includes(ve.key)),ce=ne.filter(ve=>B.includes(ve.op)),Me=ne.filter(ve=>!B.includes(ve.op));if(ce.length>0&&(de=yield r.storage.matchNode(C,ce)),de&&Me.length>0){const ve=Me.reduce((Ce,Xe)=>(Ce.includes(Xe.key)||Ce.push(Xe.key),Xe.index instanceof em&&Xe.index.config.localeKey&&!Ce.includes(Xe.index.config.localeKey)&&Ce.push(Xe.index.config.localeKey),Ce),[]),Vt=yield r.storage.getNode(C,{include:ve});if(Vt.value===null)return!1;de=Me.every(Ce=>Ce.index.test(Vt.value,Ce.op,Ce.compare))}}if(de){if(K||O(C),s.snapshots){const ne={include:s.include,exclude:s.exclude,child_objects:s.child_objects};L=(yield r.storage.getNode(C,ne)).value}K&&g.change?G=s.eventHandler({name:"change",path:C,value:L})!==!1:!K&&g.add&&(G=s.eventHandler({name:"add",path:C,value:L})!==!1)}else K&&(x(C),g.remove&&(G=s.eventHandler({name:"remove",path:C,value:V})!==!1));G===!1&&k()}),_=(T,C,L)=>{const V=f.every(G=>B.includes(G.op)?r.storage.test(L[G.key],G.op,G.compare):G.index.test(L,G.op,G.compare));let K=!0;V&&(O(C),g.add&&(K=s.eventHandler({name:"add",path:C,value:s.snapshots?L:null})!==!1)),K===!1&&k()},A=(T,C,L,V)=>{let K=!0;x(C),g.remove&&(K=s.eventHandler({name:"remove",path:C,value:s.snapshots?V:null})!==!1),K===!1&&k()};(s.monitor.add||s.monitor.change||s.monitor.remove)&&r.subscribe(m.path,"child_changed",$),s.monitor.remove&&r.subscribe(m.path,"notify_child_removed",A),s.monitor.add&&r.subscribe(m.path,"child_added",_)}return{results:E,context:d,stop:D}})})}class GE extends xE{constructor(e="default",t,r){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(op&&t.settings.storage instanceof op)this.storage=new PE(e,t.settings.storage,i);else if(sp&&t.settings.storage instanceof sp)this.storage=new jE(e,t.settings.storage,i);else if(Do&&t.settings.storage instanceof Do)this.storage=new HE(e,t.settings.storage,i);else{const o=t.settings.storage instanceof dl?t.settings.storage:new dl(t.settings.storage);this.storage=new yu(e,o,i)}else this.storage=new yu(e,new dl,i);this.storage.on("ready",r)}stats(e){return z(this,null,function*(){return this.storage.stats})}subscribe(e,t,r){this.storage.subscriptions.add(e,t,r)}unsubscribe(e,t,r){this.storage.subscriptions.remove(e,t,r)}set(e,t){return z(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.setNode(r,i,{suppress_events:o.suppress_events,context:o.context});return pe({},s&&{cursor:s})})}update(e,t){return z(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.updateNode(r,i,{suppress_events:o.suppress_events,context:o.context});return pe({},s&&{cursor:s})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return z(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const r=yield this.storage.getNode(e,t);return{value:r.value,context:{acebase_cursor:r.cursor},cursor:r.cursor}})}transaction(e,t){return z(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.transactNode(r,i,{suppress_events:o.suppress_events,context:o.context});return pe({},s&&{cursor:s})})}exists(e){return z(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(e,t){return z(this,arguments,function*(r,i,o={snapshots:!1}){return yield tm(this,r,i,o)})}createIndex(e,t,r){return this.storage.indexes.create(e,t,r)}getIndexes(){return z(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return z(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,r){return z(this,null,function*(){r=r||{};const i=(o,s=50,a=0,c=null)=>z(this,null,function*(){typeof s=="string"&&(s=parseInt(s)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const l=[];let u=0,h=!1,y=!1;return yield this.storage.getChildren(o).next(d=>{if(h)return y=!0,!1;u++,(c!==null?d.key>c:a===0||u>a)&&l.push(pe({key:typeof d.key=="string"?d.key:d.index,type:d.valueTypeName,value:d.value},typeof d.address=="object"&&"pageNr"in d.address&&{address:{pageNr:d.address.pageNr,recordNr:d.address.recordNr}})),h=s>0&&l.length===s}).catch(d=>{if(!(d instanceof Dh))throw d}),{more:y,list:l}});switch(t){case"children":return yield i(e,r.limit,r.skip,r.from);case"info":{const o={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},s=yield this.storage.getNodeInfo(e,{include_child_count:r.child_count===!0});o.key=typeof s.key!="undefined"?s.key:s.index,o.exists=s.exists,o.type=s.exists?s.valueTypeName:void 0,o.value=s.value,o.address=typeof s.address=="object"&&"pageNr"in s.address?{pageNr:s.address.pageNr,recordNr:s.address.recordNr}:void 0;const a=s.exists&&s.address&&[oe.OBJECT,oe.ARRAY].includes(s.type);return r.child_count===!0?o.children={count:a?s.childCount:0}:typeof r.child_limit=="number"&&r.child_limit>0&&a&&(o.children=yield i(e,r.child_limit,r.child_skip,r.child_from)),o}}})}export(e,t,r={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,r)}import(e,t,r={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,r)}setSchema(e,t,r=!1){return z(this,null,function*(){return this.storage.setSchema(e,t,r)})}getSchema(e){return z(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return z(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,r){return z(this,null,function*(){return this.storage.validateSchema(e,t,{updates:r})})}getMutations(e){return z(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return z(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class XE extends qh{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class QE extends Vh{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return z(this,null,function*(){})}rollback(e){return z(this,null,function*(){})}get(e){return z(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return z(this,null,function*(){const r=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),r)})}remove(e){return z(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,r,i){return z(this,null,function*(){const o=Lo.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isParentOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}descendantsOf(e,t,r,i){return z(this,null,function*(){const o=Lo.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isAncestorOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function ZE(n,e={}){const t=new XE(e),r=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new Do({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return z(this,null,function*(){})},getTransaction(s){return z(this,null,function*(){const a={debug:!0,dbname:n,localStorage:r};return new QE(a,s)})}}),o=new as(n,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return o.settings.ipcEvents=t.multipleTabs===!0,o}class e_ extends qh{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class nm extends Gg{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class t_ extends kE{constructor(e,t={}){const r=new nm(t);super(e,r),this.recovery={repairNode:(o,s)=>z(this,null,function*(){if(yield this.ready(),this.api.storage instanceof yu)yield this.api.storage.repairNode(o,s);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:o=>z(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(o)})};const i={db:this,settings:r};this.api=new GE(e,i,()=>{this.emit("ready")})}close(){return z(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(r){t.setLevel(r)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(r){e.eventsEnabled=r}}}static WithLocalStorage(e,t={}){return ZE(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function lp(n){return new Promise((e,t)=>{n.onsuccess=r=>e(n.result||null),n.onerror=t})}class n_ extends Vh{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,r=pe({},e);return delete r.value,{metadata:r,value:t}}commit(){return z(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(r=>r.path)});const t=this._createTransaction(!0);try{yield new Promise((r,i)=>{let o=!1,s=0;const a=l=>{o=!0,i(l)},c=()=>{++s===e.length&&r()};e.forEach((l,u)=>{if(o)return;let h,y;const d=l.path;if(l.action==="set"){const{metadata:p,value:v}=this._splitMetadata(l.node),w={path:d,metadata:p};h=t.objectStore("nodes").put(w),y=t.objectStore("content").put(v,d),this.context.cache.set(d,l.node)}else l.action==="remove"?(h=t.objectStore("content").delete(d),y=t.objectStore("nodes").delete(d),this.context.cache.set(d,null)):a(new Error(`Unknown pending operation "${l.action}" on path "${d}" `));let f=0;h.onsuccess=y.onsuccess=()=>{++f===2&&c()},h.onerror=y.onerror=a})}),t.commit&&t.commit()}catch(r){throw console.error(r),t.abort&&t.abort(),r}})}rollback(e){return z(this,null,function*(){this._pending=[]})}get(e){return z(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),r=lp(t.objectStore("nodes").get(e)),i=lp(t.objectStore("content").get(e));try{const o=yield Promise.all([r,i]);t.commit&&t.commit();const s=o[0];if(!s)return this.context.cache.set(e,null),null;const a=s.metadata;return a.value=o[1],this.context.cache.set(e,a),a}catch(o){throw console.error("IndexedDB get error",o),t.abort&&t.abort(),o}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return z(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,r,i){return this._getChildrenOf(e,It(pe({},t),{descendants:!1}),r,i)}descendantsOf(e,t,r,i){return this._getChildrenOf(e,It(pe({},t),{descendants:!0}),r,i)}_getChildrenOf(e,t,r,i){return new Promise((o,s)=>{const a=Lo.PathInfo.get(e),c=this._createTransaction(!1),l=c.objectStore("nodes"),u=IDBKeyRange.lowerBound(e,!0),h=t.metadata?l.openCursor(u):l.openKeyCursor(u);h.onerror=y=>{var d;(d=c.abort)==null||d.call(c),s(y)},h.onsuccess=y=>z(this,null,function*(){var d,f,p;const v=(f=(d=h.result)==null?void 0:d.key)!=null?f:null;let w=!0;if(v===null)w=!1;else if(!a.isAncestorOf(v))w=!1;else if(t.descendants||a.isParentOf(v)){let S;if(t.metadata&&(S=h.result.value.metadata),r(v,S)){if(t.value)if(this.context.cache.has(v)){const R=this.context.cache.get(v);S.value=R.value}else{const R=c.objectStore("content").get(v);S.value=yield new Promise((j,N)=>{R.onerror=D=>{j(null)},R.onsuccess=D=>{j(R.result)}}),this.context.cache.set(v,S.value===null?null:S)}w=i(v,S)}}if(w)try{h.result.continue()}catch(S){w=!1}w||((p=c.commit)==null||p.call(c),o())})})}}function r_(n,e={}){const t=new e_(e),r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${n}.acebase`,1);r.onupgradeneeded=u=>{const h=r.result;h.createObjectStore("nodes",{keyPath:"path"}),h.createObjectStore("content")};let i;const o=new Promise((u,h)=>{r.onsuccess=y=>{i=r.result,u()},r.onerror=y=>{h(y)}}),s=new $E(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),a=new Do({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return o},getTransaction(u){return z(this,null,function*(){yield o;const h={debug:!1,db:i,cache:s,ipc:l};return new n_(h,u)})}}),c=new as(n,{logLevel:t.logLevel,storage:a,sponsor:t.sponsor}),l=c.api.storage.ipc;return c.settings.ipcEvents=t.multipleTabs===!0,l.on("notification",u=>z(this,null,function*(){const h=u.data;if(typeof h=="object"&&h.action==="cache.invalidate")for(const y of h.paths)s.remove(y)})),c}const i_=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class as extends t_{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(i_);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return r_(e,t)}}const o_={AceBase:as,AceBaseLocalSettings:nm,DataReference:Un,DataSnapshot:Ze,EventSubscription:Ng,PathReference:et,TypeMappings:Kg,CustomStorageSettings:Do,CustomStorageTransaction:Vh,CustomStorageHelpers:Lo,ID:Nt,proxyAccess:ra,DataSnapshotsArray:oc};window.acebase=o_;window.AceBase=as;let s_=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),yl=(()=>"/ps"+s_()+"/pe")();const Cs={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},Rs={user:{base:"/user",device:{remove:"/user/device-remove",list:"/user/device-list"}},users:{base:"/users",device:{list:"/users/device-list"}}},jn={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+yl+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+yl+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+yl+"/get-one",users:{base:"/users"}};var _o,ia,vu,Ri,$o;class a_{constructor(e={}){uo(this,_o,!0),uo(this,ia,void 0),uo(this,vu,void 0),uo(this,Ri,void 0),uo(this,$o,void 0),C1(this,"init",r=>{var i;let{ENV:o,HOST_SERVER:s,API_VERSION:a}=zn(this,Ri);const c=(v={})=>{let w={};return v&&Object.keys(v).length>0&&(w.data=v),w};let l=(v,w)=>z(this,null,function*(){var S,R,j,N,D,q,P,I;if(((S=v==null?void 0:v.error)==null?void 0:S.token)&&zn(this,_o)){if(rl(this,_o,!1),localStorage.getItem("refreshToken")){o==="dev"&&console.log("Token expired or not found: ",(R=v.error)==null?void 0:R.token," Trying to request a new refresh token");let B=yield(N=(j=this==null?void 0:this.init(r))==null?void 0:j.auth())==null?void 0:N.req(jn.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(B!=null&&B.error)return o==="dev"&&console.log("Refresh token expired or not found: ",B),zn(this,ia)&&(window.top.location.href=zn(this,ia)),B;if(B!=null&&B.data&&(o==="dev"&&console.log("We got a new refresh token ,",B==null?void 0:B.data),(D=B==null?void 0:B.data)!=null&&D.token&&localStorage.setItem("accessToken",(q=B==null?void 0:B.data)==null?void 0:q.token),(P=B==null?void 0:B.data)!=null&&P.refreshToken&&localStorage.setItem("refreshToken",(I=B==null?void 0:B.data)==null?void 0:I.refreshToken),o==="dev"&&console.log("Trying to restart your request..."),typeof w=="function"))return yield w()}}else return v}),u=Kf.init(zn(this,Ri)),h=(v="",w={},S={},R={},j)=>{v=v.trim(),v.charAt(v.length-1)==="/"&&(v=v.slice(0,-1));let N=(()=>z(this,null,function*(){let D=()=>z(this,null,function*(){return yield u("post",s.AUTH+a.AUTH+jn.base+v,c(w))}),q=yield D();return zn(this,_o)&&(q=yield l(q,()=>z(this,null,function*(){return yield D()}))),typeof j=="function"&&j(It(pe({},R),{value:q})),q}))();return It(pe({},R),{val:()=>N})},y=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),d=({value:v,node:w},S)=>{var R,j,N,D;let q=v;if((R=q==null?void 0:q.data)!=null&&R.data){let P=(j=q==null?void 0:q.data)==null?void 0:j.data,I=(N=q==null?void 0:q.data)==null?void 0:N.refreshToken,B=(D=q==null?void 0:q.data)==null?void 0:D.token;B&&localStorage.setItem("accessToken",B),I&&localStorage.setItem("refreshToken",I),P&&localStorage.setItem("userInfo",JSON.stringify(P))}typeof S=="function"&&S(It(pe({},w),{value:q}))},f=(v,w)=>{typeof v=="function"&&(w==null||w.on("connect",v))},p=(v,w)=>{var S;let R="%"+v,j=(S=this.init(r))==null?void 0:S.auth();return{$connected:zn(this,vu),private:(N=y())=>j.event(v+N),child:N=>j.event(v+N),push:(N,D)=>{let q=j.event(v);return w==null||w.emit(R,N),typeof D=="function"&&(q==null||q.onValue(D)),pe(pe({},q),j)},onValue:N=>{let D=j.event(v);return w==null||w.on(R,q=>{typeof N=="function"&&N(It(pe(pe({},D),j),{value:q}))}),pe(pe({},D),j)},onAnyValue:N=>(w==null||w.onAny((D,q)=>{let P=j.event(D);typeof N=="function"&&N(D,pe(pe({value:q},P),j))}),pe({},j))}};return{activity:()=>{let v=this.init(r);return{onStart:w=>(typeof w=="function"&&document.addEventListener("DOMContentLoaded",w),pe(pe({},v),v.activity())),onCreate:w=>(typeof w=="function"&&(window.onload=w),pe(pe({},v),v.activity())),onPause:w=>(window.addEventListener("beforeunload",function(S){typeof w=="function"&&w(),S.returnValue="onbeforeunload"}),pe(pe({},v),v.activity())),onResume:()=>pe(pe({},v),v.activity()),onLeave:w=>(typeof w=="function"&&(window.onunload=w),pe(pe({},v),v.activity()))}},socket:{auth:(i=r==null?void 0:r.socket)==null?void 0:i.auth},$randomUID:()=>Wx(),$randomId:()=>y(),$axios:Kf,$online:navigator==null?void 0:navigator.onLine,auth:()=>{var v;return{$io:(v=r==null?void 0:r.socket)==null?void 0:v.auth,connected:()=>{var w,S;return(S=(w=r==null?void 0:r.socket)==null?void 0:w.auth)==null?void 0:S.connected},event:w=>{var S;return p(w,(S=r==null?void 0:r.socket)==null?void 0:S.auth)},ready:w=>{var S;return f(w,(S=r==null?void 0:r.socket)==null?void 0:S.auth)},$currentUserId:(()=>{let w=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return w.uid?w.uid:!1})(),$status:(()=>{let w=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(w.status)return w.status})(),status:(...w)=>{var S,R,j,N;let D,q,P=this.init(r);if(delete P.auth().login,delete P.auth().register,w.length===1)typeof w[0]=="string"?D=w[0]:typeof w[0]=="function"&&(q=w[0]);else if(w.length>=2){const[B,U]=w;typeof B=="string"&&(D=B),q=U}let I=(R=(S=r==null?void 0:r.socket)==null?void 0:S.auth)==null?void 0:R.id;if(I){if(!D){let B=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");B.uid&&(D=B.uid)}D&&I&&((N=(j=r==null?void 0:r.socket)==null?void 0:j.auth)==null||N.on((a==null?void 0:a.AUTH)+Cs.user.status,B=>{o==="dev"&&console.log("The user with id: ",D," is disconnected/connected: ",B==null?void 0:B.value),typeof q=="function"&&q(pe({value:B},P))}))}return pe({},P)},device:{connected:(...w)=>{var S,R,j,N;let D=this.init(r);delete D.auth().login,delete D.auth().register;let q,P;if(w.length===1)typeof w[0]=="string"?q=w[0]:typeof w[0]=="function"&&(P=w[0]);else if(w.length>=2){const[B,U]=w;typeof B=="string"&&(q=B),P=U}let I=(R=(S=r==null?void 0:r.socket)==null?void 0:S.auth)==null?void 0:R.id;if(I){if(!q){let B=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");B.uid&&(q=B.uid)}q&&I&&((N=(j=r==null?void 0:r.socket)==null?void 0:j.auth)==null||N.on((a==null?void 0:a.AUTH)+Cs.user.device.connected,B=>{o==="dev"&&console.log("The user with id: ",q," has this device connected: ",B==null?void 0:B.value),typeof P=="function"&&P(It(pe(pe({},D.auth().device),D),{value:B}))}))}return pe(pe({},D.auth().device),D)},disconnected:(...w)=>{var S,R,j,N;let D=this.init(r);delete D.auth().login,delete D.auth().register;let q,P;if(w.length===1)typeof w[0]=="string"?q=w[0]:typeof w[0]=="function"&&(P=w[0]);else if(w.length>=2){const[B,U]=w;typeof B=="string"&&(q=B),P=U}let I=(R=(S=r==null?void 0:r.socket)==null?void 0:S.auth)==null?void 0:R.id;if(I){if(!q){let B=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");B.uid&&(q=B.uid)}q&&I&&((N=(j=r==null?void 0:r.socket)==null?void 0:j.auth)==null||N.on((a==null?void 0:a.AUTH)+Cs.user.device.disconnected,B=>{o==="dev"&&console.log("The user with id: ",q," has this device connected: ",B==null?void 0:B.value),typeof P=="function"&&P(It(pe(pe({},D.auth().device),D),{value:B}))}))}return pe(pe({},D.auth().device),D)},remove:(...w)=>{var S,R,j,N,D,q;let P=this.init(r);delete P.auth().login,delete P.auth().register;let I,B;if(w.length===1)typeof w[0]=="string"?I=w[0]:typeof w[0]=="function"&&(B=w[0]);else if(w.length>=2){const[E,g]=w;(typeof E=="string"||Array.isArray(E))&&(I=E),B=g}let U=(R=(S=r==null?void 0:r.socket)==null?void 0:S.auth)==null?void 0:R.id,M=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return I&&M.uid&&U&&((N=(j=r==null?void 0:r.socket)==null?void 0:j.auth)==null||N.emit((a==null?void 0:a.AUTH)+Rs.user.device.remove,{socketId:U,userId:I,currentUserId:M.uid}),(q=(D=r==null?void 0:r.socket)==null?void 0:D.auth)==null||q.on((a==null?void 0:a.AUTH)+Cs.user.device.removed,E=>{o==="dev"&&console.log("The user with id: ",I," has this device connected: ",E==null?void 0:E.value),typeof B=="function"&&B(It(pe(pe({},P.auth().device),P),{value:E}))})),pe(pe({},P.auth().device),P)},list:(...w)=>{var S,R,j,N;let D=this.init(r);delete D.auth().login,delete D.auth().register;let q=Rs.users.device.list,P,I;if(w.length===1)typeof w[0]=="string"?P=w[0]:typeof w[0]=="function"&&(I=w[0]);else if(w.length>=2){const[M,E]=w;typeof M=="string"&&(P=M,q=Rs.user.device.list),I=E}let B=(R=(S=r==null?void 0:r.socket)==null?void 0:S.auth)==null?void 0:R.id,U=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return B&&U.uid&&(P||(q=Rs.user.device.list,P=U.uid),P&&B&&((j=r==null?void 0:r.socket.auth)==null||j.emit((a==null?void 0:a.AUTH)+q,{socketId:B,userId:P,currenUserId:U.uid}),(N=r==null?void 0:r.socket.auth)==null||N.on((a==null?void 0:a.AUTH)+q+"/",M=>{o==="dev"&&console.log("The user with id: ",P," has these devices connected: ",res==null?void 0:res.value),typeof I=="function"&&I(It(pe(pe({},D.auth().device),D),{value:M}))}))),pe(pe({},D.auth().device),D)}},req:(w,S,R)=>{let j=this.init(r);delete j.auth().login,delete j.auth().register;let N=pe(pe({},j),j.auth());return h(w+jn.req,S,null,N,R)},$user:(()=>{let w=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(w.uid)return w})(),user:(...w)=>{let S,R;w.length>1?(typeof w[0]=="string"&&(S=w[0]),typeof w[1]=="function"&&(R=w[1])):w.length===1&&(typeof w[0]=="string"&&(S=w[0]),typeof w[0]=="function"&&(R=w[0]));let j=this.init(r);delete j.auth().login,delete j.auth().register;let N=pe(pe({},j),j.auth());if(!S||typeof S!="string"){let D=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}"),q=localStorage.getItem("accessToken"),P=(()=>{var I;try{let B=xk(q);return(Date==null?void 0:Date.parse((I=new Date((B==null?void 0:B.exp)*1e3))==null?void 0:I.toString()))>Date.now()}catch(B){return!1}})();return D.uid&&P?(typeof R=="function"&&R(It(pe({},N),{value:D})),It(pe({},N),{val:()=>D})):h(jn.user,{},null,null,({value:I})=>{var B;let U=I;U!=null&&U.data&&(U={data:(B=U==null?void 0:U.data)==null?void 0:B.data},U.data&&localStorage.setItem("userInfo",JSON.stringify(U.data))),typeof R=="function"&&R(It(pe({},N),{value:U}))})}else return h(jn.user,{uid:S},null,null,({value:D})=>{var q;let P=D;P!=null&&P.data&&(P={data:(q=P==null?void 0:P.data)==null?void 0:q.data}),typeof R=="function"&&R(It(pe({},N),{value:P}))})},verifyEmailCode:(w,S)=>{let R=this.init(r);return delete R.auth().login,delete R.auth().register,h(jn.verify_email_code,w,null,null,({value:j})=>{d({value:j,node:R},S)})},verifyTokenCode:(w,S)=>{let R=this.init(r);return delete R.auth().login,delete R.auth().register,h(jn.verify_token_code,w,null,null,({value:j})=>{d({value:j,node:R},S)})},verifyPassCode:(w,S)=>{let R=this.init(r);return delete R.auth().login,delete R.auth().register,h(jn.verify_pass_code,w,null,null,({value:j})=>{d({value:j,node:R},S)})},login:(w,S)=>{let R=this.init(r);return delete R.auth().login,delete R.auth().register,h(jn.login,w,null,null,({value:j})=>{d({value:j,node:R},S)})},loginWithToken:(w,S)=>{let R=this.init(r);return delete R.auth().login,delete R.auth().register,localStorage.setItem("userInfo","{}"),localStorage.setItem("accessToken",""),localStorage.setItem("refreshToken",w),this.init(r).auth.user(null,S)},logout:w=>{let S=this.init(r);return localStorage.removeItem("refreshToken"),localStorage.removeItem("userInfo"),localStorage.removeItem("accessToken"),(()=>z(this,null,function*(){var R,j,N,D,q,P;yield(N=(j=(R=zn(this,$o))==null?void 0:R.ref("/database"))==null?void 0:j.remove())==null?void 0:N.catch(I=>{}),yield(P=(q=(D=zn(this,$o))==null?void 0:D.ref("/transaction"))==null?void 0:q.remove())==null?void 0:P.catch(I=>{})}))().then(R=>{}).catch(R=>{}),typeof w=="function"&&w(pe(pe({},S),S.auth())),pe(pe({},S),S.auth())},register:(w,S)=>{let R=this.init(r);return delete R.auth().login,delete R.auth().register,h(jn.register,w,null,null,({value:j})=>{d({value:j,node:R},S)})},forgotPassword:(w,S)=>h(jn.forgotPassword,w,null,null,S),users:()=>{let w=this.init(r);return delete w.auth().login,delete w.auth().register,w.ref("/users")},tokens:()=>{let w=this.init(r);return delete w.auth().login,delete w.auth().register,w.ref("/tokens")}}}}}),rl(this,Ri,e);let{OFFLINE_DB_NAME:t}=zn(this,Ri);rl(this,$o,as.WithIndexedDB((t==null?void 0:t.AUTH)||"swyger_auth"))}}_o=new WeakMap,ia=new WeakMap,vu=new WeakMap,Ri=new WeakMap,$o=new WeakMap;const c_={init:n=>{try{return(e={})=>new a_(n).init(e)}catch(e){return{}}}};let l_={init:n=>{var e,t,r;return{OFFLINE_DB_NAME:{AUTH:((e=n==null?void 0:n.OFFLINE_DB_NAME)==null?void 0:e.AUTH)||"swyger_auth"},ENV:(n==null?void 0:n.ENV)||"prod",HOST_SERVER:{AUTH:((t=n==null?void 0:n.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100"},API_VERSION:{AUTH:((r=n==null?void 0:n.API_VERSION)==null?void 0:r.AUTH)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(n==null?void 0:n.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(n==null?void 0:n.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const u_={init:n=>{let e=l_.init(n);const t=wk.init(e),r={socket:{auth:t==null?void 0:t.auth,database:t==null?void 0:t.database,storage:t==null?void 0:t.storage}};return c_.init(e)(r)}};var bu=function(n,e){return bu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},bu(n,e)};function yt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");bu(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function h_(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(r.next(u))}catch(h){s(h)}}function c(u){try{l(r.throw(u))}catch(h){s(h)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function Mh(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Zt(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fe(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return o}function We(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}function Di(n){return this instanceof Di?(this.v=n,this):new Di(n)}function d_(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(y){r[y]&&(i[y]=function(d){return new Promise(function(f,p){o.push([y,d,f,p])>1||a(y,d)})})}function a(y,d){try{c(r[y](d))}catch(f){h(o[0][3],f)}}function c(y){y.value instanceof Di?Promise.resolve(y.value.v).then(l,u):h(o[0][2],y)}function l(y){a("next",y)}function u(y){a("throw",y)}function h(y,d){y(d),o.shift(),o.length&&a(o[0][0],o[0][1])}}function f_(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Zt=="function"?Zt(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=n[o]&&function(s){return new Promise(function(a,c){s=n[o](s),i(a,c,s.done,s.value)})}}function i(o,s,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},s)}}function Se(n){return typeof n=="function"}function yi(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var oa=yi(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,r){return r+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function gr(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var sn=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=Zt(s),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(p){e={error:p}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this);var u=this.initialTeardown;if(Se(u))try{u()}catch(p){o=p instanceof oa?p.errors:[p]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var y=Zt(h),d=y.next();!d.done;d=y.next()){var f=d.value;try{up(f)}catch(p){o=o!=null?o:[],p instanceof oa?o=We(We([],Fe(o)),Fe(p.errors)):o.push(p)}}}catch(p){r={error:p}}finally{try{d&&!d.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}}if(o)throw new oa(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)up(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&gr(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&gr(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),rm=sn.EMPTY;function im(n){return n instanceof sn||n&&"closed"in n&&Se(n.remove)&&Se(n.add)&&Se(n.unsubscribe)}function up(n){Se(n)?n():n.unsubscribe()}var Gr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Fh={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=Fh.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,We([n,e],Fe(t))):setTimeout.apply(void 0,We([n,e],Fe(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function om(n){Fh.setTimeout(function(){var e=Gr.onUnhandledError;if(e)e(n);else throw n})}function dt(){}var p_=function(){return Wh("C",void 0,void 0)}();function y_(n){return Wh("E",void 0,n)}function g_(n){return Wh("N",n,void 0)}function Wh(n,e,t){return{kind:n,value:e,error:t}}var ai=null;function sa(n){if(Gr.useDeprecatedSynchronousErrorHandling){var e=!ai;if(e&&(ai={errorThrown:!1,error:null}),n(),e){var t=ai,r=t.errorThrown,i=t.error;if(ai=null,r)throw i}}else n()}function m_(n){Gr.useDeprecatedSynchronousErrorHandling&&ai&&(ai.errorThrown=!0,ai.error=n)}var sc=function(n){yt(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,im(t)&&t.add(r)):r.destination=k_,r}return e.create=function(t,r,i){return new Fi(t,r,i)},e.prototype.next=function(t){this.isStopped?ml(g_(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?ml(y_(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?ml(p_,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(sn),v_=Function.prototype.bind;function gl(n,e){return v_.call(n,e)}var b_=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){Is(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){Is(r)}else Is(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Is(t)}},n}(),Fi=function(n){yt(e,n);function e(t,r,i){var o=n.call(this)||this,s;if(Se(t)||!t)s={next:t!=null?t:void 0,error:r!=null?r:void 0,complete:i!=null?i:void 0};else{var a;o&&Gr.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return o.unsubscribe()},s={next:t.next&&gl(t.next,a),error:t.error&&gl(t.error,a),complete:t.complete&&gl(t.complete,a)}):s=t}return o.destination=new b_(s),o}return e}(sc);function Is(n){Gr.useDeprecatedSynchronousErrorHandling?m_(n):om(n)}function w_(n){throw n}function ml(n,e){var t=Gr.onStoppedNotification;t&&Fh.setTimeout(function(){return t(n,e)})}var k_={closed:!0,next:dt,error:w_,complete:dt},ac=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function At(n){return n}function zh(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return sm(n)}function sm(n){return n.length===0?At:n.length===1?n[0]:function(e){return n.reduce(function(t,r){return r(t)},e)}}var Be=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,o=E_(e)?e:new Fi(e,t,r);return sa(function(){var s=i,a=s.operator,c=s.source;o.add(a?a.call(o,c):c?i._subscribe(o):i._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=hp(t),new t(function(i,o){var s=new Fi({next:function(a){try{e(a)}catch(c){o(c),s.unsubscribe()}},error:o,complete:i});r.subscribe(s)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[ac]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return sm(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=hp(e),new e(function(r,i){var o;t.subscribe(function(s){return o=s},function(s){return i(s)},function(){return r(o)})})},n.create=function(e){return new n(e)},n}();function hp(n){var e;return(e=n!=null?n:Gr.Promise)!==null&&e!==void 0?e:Promise}function x_(n){return n&&Se(n.next)&&Se(n.error)&&Se(n.complete)}function E_(n){return n&&n instanceof sc||x_(n)&&im(n)}function am(n){return Se(n==null?void 0:n.lift)}function ye(n){return function(e){if(am(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function le(n,e,t,r,i){return new Kh(n,e,t,r,i)}var Kh=function(n){yt(e,n);function e(t,r,i,o,s,a){var c=n.call(this,t)||this;return c.onFinalize=s,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:n.prototype._next,c._error=o?function(l){try{o(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=i?function(){try{i()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(sc);function cm(){return ye(function(n,e){var t=null;n._refCount++;var r=le(e,void 0,void 0,void 0,function(){if(!n||n._refCount<=0||0<--n._refCount){t=null;return}var i=n._connection,o=t;t=null,i&&(!o||i===o)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var cc=function(n){yt(e,n);function e(t,r){var i=n.call(this)||this;return i.source=t,i.subjectFactory=r,i._subject=null,i._refCount=0,i._connection=null,am(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,r=this._connection;if(!r){r=this._connection=new sn;var i=this.getSubject();r.add(this.source.subscribe(le(i,void 0,function(){t._teardown(),i.complete()},function(o){t._teardown(),i.error(o)},function(){return t._teardown()}))),r.closed&&(this._connection=null,r=sn.EMPTY)}return r},e.prototype.refCount=function(){return cm()(this)},e}(Be),lm={now:function(){return(lm.delegate||performance).now()},delegate:void 0},Uo={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,r=e(function(i){t=void 0,n(i)});return new sn(function(){return t==null?void 0:t(r)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Uo.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,We([],Fe(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return cancelAnimationFrame.apply(void 0,We([],Fe(n)))},delegate:void 0};function __(n){return n?um(n):$_}function um(n){return new Be(function(e){var t=n||lm,r=t.now(),i=0,o=function(){e.closed||(i=Uo.requestAnimationFrame(function(s){i=0;var a=t.now();e.next({timestamp:n?a:s,elapsed:a-r}),o()}))};return o(),function(){i&&Uo.cancelAnimationFrame(i)}})}var $_=um(),hm=yi(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),bt=function(n){yt(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new dp(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new hm},e.prototype.next=function(t){var r=this;sa(function(){var i,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=Zt(r.currentObservers),a=s.next();!a.done;a=s.next()){var c=a.value;c.next(t)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;sa(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;sa(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?rm:(this.currentObservers=null,a.push(t),new sn(function(){r.currentObservers=null,gr(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r.thrownError,s=r.isStopped;i?t.error(o):s&&t.complete()},e.prototype.asObservable=function(){var t=new Be;return t.source=this,t},e.create=function(t,r){return new dp(t,r)},e}(Be),dp=function(n){yt(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:rm},e}(bt),dm=function(n){yt(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,o=t._value;if(r)throw i;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(bt),lc={now:function(){return(lc.delegate||Date).now()},delegate:void 0},Hh=function(n){yt(e,n);function e(t,r,i){t===void 0&&(t=1/0),r===void 0&&(r=1/0),i===void 0&&(i=lc);var o=n.call(this)||this;return o._bufferSize=t,o._windowTime=r,o._timestampProvider=i,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=r===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,r),o}return e.prototype.next=function(t){var r=this,i=r.isStopped,o=r._buffer,s=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(o.push(t),!s&&o.push(a.now()+c)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),i=this,o=i._infiniteTimeWindow,s=i._buffer,a=s.slice(),c=0;c<a.length&&!t.closed;c+=o?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,i=t._timestampProvider,o=t._buffer,s=t._infiniteTimeWindow,a=(s?1:2)*r;if(r<1/0&&a<o.length&&o.splice(0,o.length-a),!s){for(var c=i.now(),l=0,u=1;u<o.length&&o[u]<=c;u+=2)l=u;l&&o.splice(0,l+1)}},e}(bt),Jh=function(n){yt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r._hasValue,s=r._value,a=r.thrownError,c=r.isStopped,l=r._isComplete;i?t.error(a):(c||l)&&(o&&t.next(s),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,r=t._hasValue,i=t._value,o=t._isComplete;o||(this._isComplete=!0,r&&n.prototype.next.call(this,i),n.prototype.complete.call(this))},e}(bt),O_=function(n){yt(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(sn),wu={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=wu.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,We([n,e],Fe(t))):setInterval.apply(void 0,We([n,e],Fe(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},cs=function(n){yt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(s,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),wu.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&wu.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,o;try{this.work(t)}catch(s){i=!0,o=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,gr(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(O_),A_=1,vl,ku={};function fp(n){return n in ku?(delete ku[n],!0):!1}var fm={setImmediate:function(n){var e=A_++;return ku[e]=!0,vl||(vl=Promise.resolve()),vl.then(function(){return fp(e)&&n()}),e},clearImmediate:function(n){fp(n)}},S_=fm.setImmediate,T_=fm.clearImmediate,xu={setImmediate:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=xu.delegate;return((t==null?void 0:t.setImmediate)||S_).apply(void 0,We([],Fe(n)))},clearImmediate:function(n){return T_(n)},delegate:void 0},P_=function(n){yt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=xu.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(xu.clearImmediate(r),t._scheduled===r&&(t._scheduled=void 0))},e}(cs),Eu=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=lc.now,n}(),ls=function(n){yt(e,n);function e(t,r){r===void 0&&(r=Eu.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e}(Eu),j_=function(n){yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(ls),pm=new j_(P_),C_=pm,Sn=new ls(cs),Yh=Sn,R_=function(n){yt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.schedule=function(t,r){return r===void 0&&(r=0),r>0?n.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,r){return r>0||this.closed?n.prototype.execute.call(this,t,r):this._execute(t,r)},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.flush(this),0)},e}(cs),I_=function(n){yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(ls),ym=new I_(R_),N_=ym,B_=function(n){yt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=Uo.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(Uo.cancelAnimationFrame(r),t._scheduled=void 0)},e}(cs),L_=function(n){yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(ls),gm=new L_(B_),D_=gm,U_=function(n){yt(e,n);function e(t,r){t===void 0&&(t=mm),r===void 0&&(r=1/0);var i=n.call(this,t,function(){return i.frame})||this;return i.maxFrames=r,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,r=t.actions,i=t.maxFrames,o,s;(s=r[0])&&s.delay<=i&&(r.shift(),this.frame=s.delay,!(o=s.execute(s.state,s.delay))););if(o){for(;s=r.shift();)s.unsubscribe();throw o}},e.frameTimeFactor=10,e}(ls),mm=function(n){yt(e,n);function e(t,r,i){i===void 0&&(i=t.index+=1);var o=n.call(this,t,r)||this;return o.scheduler=t,o.work=r,o.index=i,o.active=!0,o.index=t.index=i,o}return e.prototype.schedule=function(t,r){if(r===void 0&&(r=0),Number.isFinite(r)){if(!this.id)return n.prototype.schedule.call(this,t,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,r)}else return sn.EMPTY},e.prototype.requestAsyncId=function(t,r,i){i===void 0&&(i=0),this.delay=t.frame+i;var o=t.actions;return o.push(this),o.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,r,i){},e.prototype._execute=function(t,r){if(this.active===!0)return n.prototype._execute.call(this,t,r)},e.sortActions=function(t,r){return t.delay===r.delay?t.index===r.index?0:t.index>r.index?1:-1:t.delay>r.delay?1:-1},e}(cs),ir=new Be(function(n){return n.complete()});function q_(n){return n?V_(n):ir}function V_(n){return new Be(function(e){return n.schedule(function(){return e.complete()})})}function uc(n){return n&&Se(n.schedule)}function Gh(n){return n[n.length-1]}function us(n){return Se(Gh(n))?n.pop():void 0}function br(n){return uc(Gh(n))?n.pop():void 0}function vm(n,e){return typeof Gh(n)=="number"?n.pop():e}var Xh=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function bm(n){return Se(n==null?void 0:n.then)}function wm(n){return Se(n[ac])}function km(n){return Symbol.asyncIterator&&Se(n==null?void 0:n[Symbol.asyncIterator])}function xm(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function M_(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Em=M_();function _m(n){return Se(n==null?void 0:n[Em])}function $m(n){return d_(this,arguments,function(){var e,t,r,i;return Mh(this,function(o){switch(o.label){case 0:e=n.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Di(e.read())];case 3:return t=o.sent(),r=t.value,i=t.done,i?[4,Di(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Di(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Om(n){return Se(n==null?void 0:n.getReader)}function ke(n){if(n instanceof Be)return n;if(n!=null){if(wm(n))return F_(n);if(Xh(n))return W_(n);if(bm(n))return z_(n);if(km(n))return Am(n);if(_m(n))return K_(n);if(Om(n))return H_(n)}throw xm(n)}function F_(n){return new Be(function(e){var t=n[ac]();if(Se(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function W_(n){return new Be(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function z_(n){return new Be(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,om)})}function K_(n){return new Be(function(e){var t,r;try{for(var i=Zt(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function Am(n){return new Be(function(e){J_(n,e).catch(function(t){return e.error(t)})})}function H_(n){return Am($m(n))}function J_(n,e){var t,r,i,o;return h_(this,void 0,void 0,function(){var s,a;return Mh(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=f_(n),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(s=r.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function en(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(o),!i)return o}function hc(n,e){return e===void 0&&(e=0),ye(function(t,r){t.subscribe(le(r,function(i){return en(r,n,function(){return r.next(i)},e)},function(){return en(r,n,function(){return r.complete()},e)},function(i){return en(r,n,function(){return r.error(i)},e)}))})}function dc(n,e){return e===void 0&&(e=0),ye(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function Y_(n,e){return ke(n).pipe(dc(e),hc(e))}function G_(n,e){return ke(n).pipe(dc(e),hc(e))}function X_(n,e){return new Be(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function Sm(n,e){return new Be(function(t){var r;return en(t,e,function(){r=n[Em](),en(t,e,function(){var i,o,s;try{i=r.next(),o=i.value,s=i.done}catch(a){t.error(a);return}s?t.complete():t.next(o)},0,!0)}),function(){return Se(r==null?void 0:r.return)&&r.return()}})}function Tm(n,e){if(!n)throw new Error("Iterable cannot be null");return new Be(function(t){en(t,e,function(){var r=n[Symbol.asyncIterator]();en(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function Q_(n,e){return Tm($m(n),e)}function Pm(n,e){if(n!=null){if(wm(n))return Y_(n,e);if(Xh(n))return X_(n,e);if(bm(n))return G_(n,e);if(km(n))return Tm(n,e);if(_m(n))return Sm(n,e);if(Om(n))return Q_(n,e)}throw xm(n)}function wr(n,e){return e?Pm(n,e):ke(n)}function Qh(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=br(n);return wr(n,t)}function jm(n,e){var t=Se(n)?n:function(){return n},r=function(i){return i.error(t())};return new Be(e?function(i){return e.schedule(r,0,i)}:r)}var _u;(function(n){n.NEXT="N",n.ERROR="E",n.COMPLETE="C"})(_u||(_u={}));var aa=function(){function n(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue=e==="N"}return n.prototype.observe=function(e){return Cm(this,e)},n.prototype.do=function(e,t,r){var i=this,o=i.kind,s=i.value,a=i.error;return o==="N"?e==null?void 0:e(s):o==="E"?t==null?void 0:t(a):r==null?void 0:r()},n.prototype.accept=function(e,t,r){var i;return Se((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,r)},n.prototype.toObservable=function(){var e=this,t=e.kind,r=e.value,i=e.error,o=t==="N"?Qh(r):t==="E"?jm(function(){return i}):t==="C"?ir:0;if(!o)throw new TypeError("Unexpected notification kind "+t);return o},n.createNext=function(e){return new n("N",e)},n.createError=function(e){return new n("E",void 0,e)},n.createComplete=function(){return n.completeNotification},n.completeNotification=new n("C"),n}();function Cm(n,e){var t,r,i,o=n,s=o.kind,a=o.value,c=o.error;if(typeof s!="string")throw new TypeError('Invalid notification, missing "kind"');s==="N"?(t=e.next)===null||t===void 0||t.call(e,a):s==="E"?(r=e.error)===null||r===void 0||r.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function Z_(n){return!!n&&(n instanceof Be||Se(n.lift)&&Se(n.subscribe))}var gi=yi(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function e$(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=!1,s;n.subscribe({next:function(a){s=a,o=!0},error:i,complete:function(){o?r(s):t?r(e.defaultValue):i(new gi)}})})}function t$(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=new Fi({next:function(s){r(s),o.unsubscribe()},error:i,complete:function(){t?r(e.defaultValue):i(new gi)}});n.subscribe(o)})}var $u=yi(function(n){return function(){n(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),Rm=yi(function(n){return function(e){n(this),this.name="NotFoundError",this.message=e}}),Im=yi(function(n){return function(e){n(this),this.name="SequenceError",this.message=e}});function Zh(n){return n instanceof Date&&!isNaN(n)}var Nm=yi(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function Bm(n,e){var t=Zh(n)?{first:n}:typeof n=="number"?{each:n}:n,r=t.first,i=t.each,o=t.with,s=o===void 0?n$:o,a=t.scheduler,c=a===void 0?e!=null?e:Sn:a,l=t.meta,u=l===void 0?null:l;if(r==null&&i==null)throw new TypeError("No timeout provided.");return ye(function(h,y){var d,f,p=null,v=0,w=function(S){f=en(y,c,function(){try{d.unsubscribe(),ke(s({meta:u,lastValue:p,seen:v})).subscribe(y)}catch(R){y.error(R)}},S)};d=h.subscribe(le(y,function(S){f==null||f.unsubscribe(),v++,y.next(p=S),i>0&&w(i)},void 0,void 0,function(){f!=null&&f.closed||f==null||f.unsubscribe(),p=null})),!v&&w(r!=null?typeof r=="number"?r:+r-c.now():i)})}function n$(n){throw new Nm(n)}function mi(n,e){return ye(function(t,r){var i=0;t.subscribe(le(r,function(o){r.next(n.call(e,o,i++))}))})}var r$=Array.isArray;function i$(n,e){return r$(e)?n.apply(void 0,We([],Fe(e))):n(e)}function vi(n){return mi(function(e){return i$(n,e)})}function Ua(n,e,t,r){if(t)if(uc(t))r=t;else return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return Ua(n,e,r).apply(this,i).pipe(vi(t))};return r?function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return Ua(n,e).apply(this,i).pipe(dc(r),hc(r))}:function(){for(var i=this,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var a=new Jh,c=!0;return new Be(function(l){var u=a.subscribe(l);if(c){c=!1;var h=!1,y=!1;e.apply(i,We(We([],Fe(o)),[function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];if(n){var p=d.shift();if(p!=null){a.error(p);return}}a.next(1<d.length?d:d[0]),y=!0,h&&a.complete()}])),y&&a.complete(),h=!0}return u})}}function o$(n,e,t){return Ua(!1,n,e,t)}function s$(n,e,t){return Ua(!0,n,e,t)}var a$=Array.isArray,c$=Object.getPrototypeOf,l$=Object.prototype,u$=Object.keys;function Lm(n){if(n.length===1){var e=n[0];if(a$(e))return{args:e,keys:null};if(h$(e)){var t=u$(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function h$(n){return n&&typeof n=="object"&&c$(n)===l$}function Dm(n,e){return n.reduce(function(t,r,i){return t[r]=e[i],t},{})}function Um(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=br(n),r=us(n),i=Lm(n),o=i.args,s=i.keys;if(o.length===0)return wr([],t);var a=new Be(qm(o,t,s?function(c){return Dm(s,c)}:At));return r?a.pipe(vi(r)):a}function qm(n,e,t){return t===void 0&&(t=At),function(r){pp(e,function(){for(var i=n.length,o=new Array(i),s=i,a=i,c=function(u){pp(e,function(){var h=wr(n[u],e),y=!1;h.subscribe(le(r,function(d){o[u]=d,y||(y=!0,a--),a||r.next(t(o.slice()))},function(){--s||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function pp(n,e,t){n?en(t,n,e):e()}function ed(n,e,t,r,i,o,s,a){var c=[],l=0,u=0,h=!1,y=function(){h&&!c.length&&!l&&e.complete()},d=function(p){return l<r?f(p):c.push(p)},f=function(p){o&&e.next(p),l++;var v=!1;ke(t(p,u++)).subscribe(le(e,function(w){i==null||i(w),o?d(w):e.next(w)},function(){v=!0},void 0,function(){if(v)try{l--;for(var w=function(){var S=c.shift();s?en(e,s,function(){return f(S)}):f(S)};c.length&&l<r;)w();y()}catch(S){e.error(S)}}))};return n.subscribe(le(e,d,function(){h=!0,y()})),function(){a==null||a()}}function qn(n,e,t){return t===void 0&&(t=1/0),Se(e)?qn(function(r,i){return mi(function(o,s){return e(r,o,i,s)})(ke(n(r,i)))},t):(typeof e=="number"&&(t=e),ye(function(r,i){return ed(r,i,n,t)}))}function fc(n){return n===void 0&&(n=1/0),qn(At,n)}function td(){return fc(1)}function qo(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return td()(wr(n,br(n)))}function pc(n){return new Be(function(e){ke(n()).subscribe(e)})}var d$={connector:function(){return new bt},resetOnDisconnect:!0};function f$(n,e){e===void 0&&(e=d$);var t=null,r=e.connector,i=e.resetOnDisconnect,o=i===void 0?!0:i,s=r(),a=new Be(function(c){return s.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=pc(function(){return n}).subscribe(s),o&&t.add(function(){return s=r()})),t},a}function p$(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=us(n),r=Lm(n),i=r.args,o=r.keys,s=new Be(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),u=c,h=c,y=function(f){var p=!1;ke(i[f]).subscribe(le(a,function(v){p||(p=!0,h--),l[f]=v},function(){return u--},void 0,function(){(!u||!p)&&(h||a.next(o?Dm(o,l):l),a.complete())}))},d=0;d<c;d++)y(d)});return t?s.pipe(vi(t)):s}var y$=["addListener","removeListener"],g$=["addEventListener","removeEventListener"],m$=["on","off"];function Ou(n,e,t,r){if(Se(t)&&(r=t,t=void 0),r)return Ou(n,e,t).pipe(vi(r));var i=Fe(w$(n)?g$.map(function(a){return function(c){return n[a](e,c,t)}}):v$(n)?y$.map(yp(n,e)):b$(n)?m$.map(yp(n,e)):[],2),o=i[0],s=i[1];if(!o&&Xh(n))return qn(function(a){return Ou(a,e,t)})(ke(n));if(!o)throw new TypeError("Invalid event target");return new Be(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return o(c),function(){return s(c)}})}function yp(n,e){return function(t){return function(r){return n[t](e,r)}}}function v$(n){return Se(n.addListener)&&Se(n.removeListener)}function b$(n){return Se(n.on)&&Se(n.off)}function w$(n){return Se(n.addEventListener)&&Se(n.removeEventListener)}function Vm(n,e,t){return t?Vm(n,e).pipe(vi(t)):new Be(function(r){var i=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return r.next(s.length===1?s[0]:s)},o=n(i);return Se(e)?function(){return e(i,o)}:void 0})}function k$(n,e,t,r,i){var o,s,a,c;arguments.length===1?(o=n,c=o.initialState,e=o.condition,t=o.iterate,s=o.resultSelector,a=s===void 0?At:s,i=o.scheduler):(c=n,!r||uc(r)?(a=At,i=r):a=r);function l(){var u;return Mh(this,function(h){switch(h.label){case 0:u=c,h.label=1;case 1:return!e||e(u)?[4,a(u)]:[3,4];case 2:h.sent(),h.label=3;case 3:return u=t(u),[3,1];case 4:return[2]}})}return pc(i?function(){return Sm(l(),i)}:l)}function x$(n,e,t){return pc(function(){return n()?e:t})}function bi(n,e,t){n===void 0&&(n=0),t===void 0&&(t=Yh);var r=-1;return e!=null&&(uc(e)?t=e:r=e),new Be(function(i){var o=Zh(n)?+n-t.now():n;o<0&&(o=0);var s=0;return t.schedule(function(){i.closed||(i.next(s++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function Mm(n,e){return n===void 0&&(n=0),e===void 0&&(e=Sn),n<0&&(n=0),bi(n,n,e)}function E$(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=br(n),r=vm(n,1/0),i=n;return i.length?i.length===1?ke(i[0]):fc(r)(wr(i,t)):ir}var Fm=new Be(dt);function _$(){return Fm}var $$=Array.isArray;function Qi(n){return n.length===1&&$$(n[0])?n[0]:n}function Wm(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Qi(n);return new Be(function(r){var i=0,o=function(){if(i<t.length){var s=void 0;try{s=ke(t[i++])}catch(c){o();return}var a=new Kh(r,void 0,dt,dt);s.subscribe(a),a.add(o)}else r.complete()};o()})}function O$(n,e){return wr(Object.entries(n),e)}function A$(n,e){return function(t,r){return!n.call(e,t,r)}}function di(n,e){return ye(function(t,r){var i=0;t.subscribe(le(r,function(o){return n.call(e,o,i++)&&r.next(o)}))})}function S$(n,e,t){return[di(e,t)(ke(n)),di(A$(e,t))(ke(n))]}function T$(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=Qi(n),n.length===1?ke(n[0]):new Be(zm(n))}function zm(n){return function(e){for(var t=[],r=function(o){t.push(ke(n[o]).subscribe(le(e,function(s){if(t){for(var a=0;a<t.length;a++)a!==o&&t[a].unsubscribe();t=null}e.next(s)})))},i=0;t&&!e.closed&&i<n.length;i++)r(i)}}function P$(n,e,t){if(e==null&&(e=n,n=0),e<=0)return ir;var r=e+n;return new Be(t?function(i){var o=n;return t.schedule(function(){o<r?(i.next(o++),this.schedule()):i.complete()})}:function(i){for(var o=n;o<r&&!i.closed;)i.next(o++);i.complete()})}function j$(n,e){return new Be(function(t){var r=n(),i=e(r),o=i?ke(i):ir;return o.subscribe(t),function(){r&&r.unsubscribe()}})}function nd(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=us(n),r=Qi(n);return r.length?new Be(function(i){var o=r.map(function(){return[]}),s=r.map(function(){return!1});i.add(function(){o=s=null});for(var a=function(l){ke(r[l]).subscribe(le(i,function(u){if(o[l].push(u),o.every(function(y){return y.length})){var h=o.map(function(y){return y.shift()});i.next(t?t.apply(void 0,We([],Fe(h))):h),o.some(function(y,d){return!y.length&&s[d]})&&i.complete()}},function(){s[l]=!0,!o[l].length&&i.complete()}))},c=0;!i.closed&&c<r.length;c++)a(c);return function(){o=s=null}}):ir}function Km(n){return ye(function(e,t){var r=!1,i=null,o=null,s=!1,a=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var l=i;i=null,t.next(l)}s&&t.complete()},c=function(){o=null,s&&t.complete()};e.subscribe(le(t,function(l){r=!0,i=l,o||ke(n(l)).subscribe(o=le(t,a,c))},function(){s=!0,(!r||!o||o.closed)&&t.complete()}))})}function C$(n,e){return e===void 0&&(e=Sn),Km(function(){return bi(n,e)})}function R$(n){return ye(function(e,t){var r=[];return e.subscribe(le(t,function(i){return r.push(i)},function(){t.next(r),t.complete()})),ke(n).subscribe(le(t,function(){var i=r;r=[],t.next(i)},dt)),function(){r=null}})}function I$(n,e){return e===void 0&&(e=null),e=e!=null?e:n,ye(function(t,r){var i=[],o=0;t.subscribe(le(r,function(s){var a,c,l,u,h=null;o++%e===0&&i.push([]);try{for(var y=Zt(i),d=y.next();!d.done;d=y.next()){var f=d.value;f.push(s),n<=f.length&&(h=h!=null?h:[],h.push(f))}}catch(w){a={error:w}}finally{try{d&&!d.done&&(c=y.return)&&c.call(y)}finally{if(a)throw a.error}}if(h)try{for(var p=Zt(h),v=p.next();!v.done;v=p.next()){var f=v.value;gr(i,f),r.next(f)}}catch(w){l={error:w}}finally{try{v&&!v.done&&(u=p.return)&&u.call(p)}finally{if(l)throw l.error}}},function(){var s,a;try{for(var c=Zt(i),l=c.next();!l.done;l=c.next()){var u=l.value;r.next(u)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}r.complete()},void 0,function(){i=null}))})}function N$(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=br(r))!==null&&e!==void 0?e:Sn,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return ye(function(c,l){var u=[],h=!1,y=function(p){var v=p.buffer,w=p.subs;w.unsubscribe(),gr(u,p),l.next(v),h&&d()},d=function(){if(u){var p=new sn;l.add(p);var v=[],w={buffer:v,subs:p};u.push(w),en(p,o,function(){return y(w)},n)}};s!==null&&s>=0?en(l,o,d,s,!0):h=!0,d();var f=le(l,function(p){var v,w,S=u.slice();try{for(var R=Zt(S),j=R.next();!j.done;j=R.next()){var N=j.value,D=N.buffer;D.push(p),a<=D.length&&y(N)}}catch(q){v={error:q}}finally{try{j&&!j.done&&(w=R.return)&&w.call(R)}finally{if(v)throw v.error}}},function(){for(;u!=null&&u.length;)l.next(u.shift().buffer);f==null||f.unsubscribe(),l.complete(),l.unsubscribe()},void 0,function(){return u=null});c.subscribe(f)})}function B$(n,e){return ye(function(t,r){var i=[];ke(n).subscribe(le(r,function(o){var s=[];i.push(s);var a=new sn,c=function(){gr(i,s),r.next(s),a.unsubscribe()};a.add(ke(e(o)).subscribe(le(r,c,dt)))},dt)),t.subscribe(le(r,function(o){var s,a;try{for(var c=Zt(i),l=c.next();!l.done;l=c.next()){var u=l.value;u.push(o)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}},function(){for(;i.length>0;)r.next(i.shift());r.complete()}))})}function L$(n){return ye(function(e,t){var r=null,i=null,o=function(){i==null||i.unsubscribe();var s=r;r=[],s&&t.next(s),ke(n()).subscribe(i=le(t,o,dt))};o(),e.subscribe(le(t,function(s){return r==null?void 0:r.push(s)},function(){r&&t.next(r),t.complete()},void 0,function(){return r=i=null}))})}function Hm(n){return ye(function(e,t){var r=null,i=!1,o;r=e.subscribe(le(t,void 0,void 0,function(s){o=ke(n(s,Hm(n)(e))),r?(r.unsubscribe(),r=null,o.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,o.subscribe(t))})}function Jm(n,e,t,r,i){return function(o,s){var a=t,c=e,l=0;o.subscribe(le(s,function(u){var h=l++;c=a?n(c,u,h):(a=!0,u),r&&s.next(c)},i&&function(){a&&s.next(c),s.complete()}))}}function hs(n,e){return ye(Jm(n,e,arguments.length>=2,!1,!0))}var D$=function(n,e){return n.push(e),n};function Ym(){return ye(function(n,e){hs(D$,[])(n).subscribe(e)})}function Gm(n,e){return zh(Ym(),qn(function(t){return n(t)}),e?vi(e):At)}function Xm(n){return Gm(Um,n)}var U$=Xm;function Qm(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=us(n);return t?zh(Qm.apply(void 0,We([],Fe(n))),vi(t)):ye(function(r,i){qm(We([r],Fe(Qi(n))))(i)})}function q$(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Qm.apply(void 0,We([],Fe(n)))}function Au(n,e){return Se(e)?qn(n,e,1):qn(n,1)}function V$(n,e){return Se(e)?Au(function(){return n},e):Au(function(){return n})}function M$(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=br(n);return ye(function(r,i){td()(wr(We([r],Fe(n)),t)).subscribe(i)})}function F$(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return M$.apply(void 0,We([],Fe(n)))}function W$(n){return new Be(function(e){return n.subscribe(e)})}var z$={connector:function(){return new bt}};function rd(n,e){e===void 0&&(e=z$);var t=e.connector;return ye(function(r,i){var o=t();ke(n(W$(o))).subscribe(i),i.add(r.subscribe(o))})}function K$(n){return hs(function(e,t,r){return!n||n(t,r)?e+1:e},0)}function H$(n){return ye(function(e,t){var r=!1,i=null,o=null,s=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var a=i;i=null,t.next(a)}};e.subscribe(le(t,function(a){o==null||o.unsubscribe(),r=!0,i=a,o=le(t,s,dt),ke(n(a)).subscribe(o)},function(){s(),t.complete()},void 0,function(){i=o=null}))})}function J$(n,e){return e===void 0&&(e=Sn),ye(function(t,r){var i=null,o=null,s=null,a=function(){if(i){i.unsubscribe(),i=null;var l=o;o=null,r.next(l)}};function c(){var l=s+n,u=e.now();if(u<l){i=this.schedule(void 0,l-u),r.add(i);return}a()}t.subscribe(le(r,function(l){o=l,s=e.now(),i||(i=e.schedule(c,n),r.add(i))},function(){a(),r.complete()},void 0,function(){o=i=null}))})}function yc(n){return ye(function(e,t){var r=!1;e.subscribe(le(t,function(i){r=!0,t.next(i)},function(){r||t.next(n),t.complete()}))})}function Vo(n){return n<=0?function(){return ir}:ye(function(e,t){var r=0;e.subscribe(le(t,function(i){++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function Zm(){return ye(function(n,e){n.subscribe(le(e,dt))})}function ev(n){return mi(function(){return n})}function id(n,e){return e?function(t){return qo(e.pipe(Vo(1),Zm()),t.pipe(id(n)))}:qn(function(t,r){return ke(n(t,r)).pipe(Vo(1),ev(t))})}function Y$(n,e){e===void 0&&(e=Sn);var t=bi(n,e);return id(function(){return t})}function G$(){return ye(function(n,e){n.subscribe(le(e,function(t){return Cm(t,e)}))})}function X$(n,e){return ye(function(t,r){var i=new Set;t.subscribe(le(r,function(o){var s=n?n(o):o;i.has(s)||(i.add(s),r.next(o))})),e&&ke(e).subscribe(le(r,function(){return i.clear()},dt))})}function tv(n,e){return e===void 0&&(e=At),n=n!=null?n:Q$,ye(function(t,r){var i,o=!0;t.subscribe(le(r,function(s){var a=e(s);(o||!n(i,a))&&(o=!1,i=a,r.next(s))}))})}function Q$(n,e){return n===e}function Z$(n,e){return tv(function(t,r){return e?e(t[n],r[n]):t[n]===r[n]})}function gc(n){return n===void 0&&(n=eO),ye(function(e,t){var r=!1;e.subscribe(le(t,function(i){r=!0,t.next(i)},function(){return r?t.complete():t.error(n())}))})}function eO(){return new gi}function tO(n,e){if(n<0)throw new $u;var t=arguments.length>=2;return function(r){return r.pipe(di(function(i,o){return o===n}),Vo(1),t?yc(e):gc(function(){return new $u}))}}function nO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(t){return qo(t,Qh.apply(void 0,We([],Fe(n))))}}function rO(n,e){return ye(function(t,r){var i=0;t.subscribe(le(r,function(o){n.call(e,o,i++,t)||(r.next(!1),r.complete())},function(){r.next(!0),r.complete()}))})}function od(n,e){return e?function(t){return t.pipe(od(function(r,i){return ke(n(r,i)).pipe(mi(function(o,s){return e(r,o,i,s)}))}))}:ye(function(t,r){var i=0,o=null,s=!1;t.subscribe(le(r,function(a){o||(o=le(r,void 0,function(){o=null,s&&r.complete()}),ke(n(a,i++)).subscribe(o))},function(){s=!0,!o&&r.complete()}))})}function nv(){return od(At)}var iO=nv;function oO(n,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,ye(function(r,i){return ed(r,i,n,e,void 0,!0,t)})}function sO(n){return ye(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function aO(n,e){return ye(rv(n,e,"value"))}function rv(n,e,t){var r=t==="index";return function(i,o){var s=0;i.subscribe(le(o,function(a){var c=s++;n.call(e,a,c,i)&&(o.next(r?c:a),o.complete())},function(){o.next(r?-1:void 0),o.complete()}))}}function cO(n,e){return ye(rv(n,e,"index"))}function lO(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?di(function(i,o){return n(i,o,r)}):At,Vo(1),t?yc(e):gc(function(){return new gi}))}}function uO(n,e,t,r){return ye(function(i,o){var s;!e||typeof e=="function"?s=e:(t=e.duration,s=e.element,r=e.connector);var a=new Map,c=function(f){a.forEach(f),f(o)},l=function(f){return c(function(p){return p.error(f)})},u=0,h=!1,y=new Kh(o,function(f){try{var p=n(f),v=a.get(p);if(!v){a.set(p,v=r?r():new bt);var w=d(p,v);if(o.next(w),t){var S=le(v,function(){v.complete(),S==null||S.unsubscribe()},void 0,void 0,function(){return a.delete(p)});y.add(ke(t(w)).subscribe(S))}}v.next(s?s(f):f)}catch(R){l(R)}},function(){return c(function(f){return f.complete()})},l,function(){return a.clear()},function(){return h=!0,u===0});i.subscribe(y);function d(f,p){var v=new Be(function(w){u++;var S=p.subscribe(w);return function(){S.unsubscribe(),--u===0&&h&&y.unsubscribe()}});return v.key=f,v}})}function hO(){return ye(function(n,e){n.subscribe(le(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function iv(n){return n<=0?function(){return ir}:ye(function(e,t){var r=[];e.subscribe(le(t,function(i){r.push(i),n<r.length&&r.shift()},function(){var i,o;try{for(var s=Zt(r),a=s.next();!a.done;a=s.next()){var c=a.value;t.next(c)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}t.complete()},void 0,function(){r=null}))})}function dO(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?di(function(i,o){return n(i,o,r)}):At,iv(1),t?yc(e):gc(function(){return new gi}))}}function fO(){return ye(function(n,e){n.subscribe(le(e,function(t){e.next(aa.createNext(t))},function(){e.next(aa.createComplete()),e.complete()},function(t){e.next(aa.createError(t)),e.complete()}))})}function pO(n){return hs(Se(n)?function(e,t){return n(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var yO=qn;function gO(n,e,t){return t===void 0&&(t=1/0),Se(e)?qn(function(){return n},e,t):(typeof e=="number"&&(t=e),qn(function(){return n},t))}function mO(n,e,t){return t===void 0&&(t=1/0),ye(function(r,i){var o=e;return ed(r,i,function(s,a){return n(o,s,a)},t,function(s){o=s},!1,void 0,function(){return o=null})})}function vO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=br(n),r=vm(n,1/0);return n=Qi(n),ye(function(i,o){fc(r)(wr(We([i],Fe(n)),t)).subscribe(o)})}function bO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return vO.apply(void 0,We([],Fe(n)))}function wO(n){return hs(Se(n)?function(e,t){return n(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function sd(n,e){var t=Se(n)?n:function(){return n};return Se(e)?rd(e,{connector:t}):function(r){return new cc(r,t)}}function kO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Qi(n);return function(r){return Wm.apply(void 0,We([r],Fe(t)))}}function xO(){return ye(function(n,e){var t,r=!1;n.subscribe(le(e,function(i){var o=t;t=i,r&&e.next([o,i]),r=!0}))})}function EO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.length;if(t===0)throw new Error("list of properties cannot be empty.");return mi(function(r){for(var i=r,o=0;o<t;o++){var s=i==null?void 0:i[n[o]];if(typeof s!="undefined")i=s;else return}return i})}function _O(n){return n?function(e){return rd(n)(e)}:function(e){return sd(new bt)(e)}}function $O(n){return function(e){var t=new dm(n);return new cc(e,function(){return t})}}function OO(){return function(n){var e=new Jh;return new cc(n,function(){return e})}}function AO(n,e,t,r){t&&!Se(t)&&(r=t);var i=Se(t)?t:void 0;return function(o){return sd(new Hh(n,e,r),i)(o)}}function SO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.length?ye(function(t,r){zm(We([t],Fe(n)))(r)}):At}function TO(n){var e,t=1/0,r;return n!=null&&(typeof n=="object"?(e=n.count,t=e===void 0?1/0:e,r=n.delay):t=n),t<=0?function(){return ir}:ye(function(i,o){var s=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,r!=null){var u=typeof r=="number"?bi(r):ke(r(s)),h=le(o,function(){h.unsubscribe(),l()});u.subscribe(h)}else l()},l=function(){var u=!1;a=i.subscribe(le(o,void 0,function(){++s<t?a?c():u=!0:o.complete()})),u&&c()};l()})}function PO(n){return ye(function(e,t){var r,i=!1,o,s=!1,a=!1,c=function(){return a&&s&&(t.complete(),!0)},l=function(){return o||(o=new bt,ke(n(o)).subscribe(le(t,function(){r?u():i=!0},function(){s=!0,c()}))),o},u=function(){a=!1,r=e.subscribe(le(t,void 0,function(){a=!0,!c()&&l().next()})),i&&(r.unsubscribe(),r=null,i=!1,u())};u()})}function jO(n){n===void 0&&(n=1/0);var e;n&&typeof n=="object"?e=n:e={count:n};var t=e.count,r=t===void 0?1/0:t,i=e.delay,o=e.resetOnSuccess,s=o===void 0?!1:o;return r<=0?At:ye(function(a,c){var l=0,u,h=function(){var y=!1;u=a.subscribe(le(c,function(d){s&&(l=0),c.next(d)},void 0,function(d){if(l++<r){var f=function(){u?(u.unsubscribe(),u=null,h()):y=!0};if(i!=null){var p=typeof i=="number"?bi(i):ke(i(d,l)),v=le(c,function(){v.unsubscribe(),f()},function(){c.complete()});p.subscribe(v)}else f()}else c.error(d)})),y&&(u.unsubscribe(),u=null,h())};h()})}function CO(n){return ye(function(e,t){var r,i=!1,o,s=function(){r=e.subscribe(le(t,void 0,void 0,function(a){o||(o=new bt,ke(n(o)).subscribe(le(t,function(){return r?s():i=!0}))),o&&o.next(a)})),i&&(r.unsubscribe(),r=null,i=!1,s())};s()})}function ov(n){return ye(function(e,t){var r=!1,i=null;e.subscribe(le(t,function(o){r=!0,i=o})),ke(n).subscribe(le(t,function(){if(r){r=!1;var o=i;i=null,t.next(o)}},dt))})}function RO(n,e){return e===void 0&&(e=Sn),ov(Mm(n,e))}function IO(n,e){return ye(Jm(n,e,arguments.length>=2,!0))}function NO(n,e){return e===void 0&&(e=function(t,r){return t===r}),ye(function(t,r){var i=gp(),o=gp(),s=function(c){r.next(c),r.complete()},a=function(c,l){var u=le(r,function(h){var y=l.buffer,d=l.complete;y.length===0?d?s(!1):c.buffer.push(h):!e(h,y.shift())&&s(!1)},function(){c.complete=!0;var h=l.complete,y=l.buffer;h&&s(y.length===0),u==null||u.unsubscribe()});return u};t.subscribe(a(i,o)),ke(n).subscribe(a(o,i))})}function gp(){return{buffer:[],complete:!1}}function sv(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new bt}:e,r=n.resetOnError,i=r===void 0?!0:r,o=n.resetOnComplete,s=o===void 0?!0:o,a=n.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,h,y,d=0,f=!1,p=!1,v=function(){h==null||h.unsubscribe(),h=void 0},w=function(){v(),u=y=void 0,f=p=!1},S=function(){var R=u;w(),R==null||R.unsubscribe()};return ye(function(R,j){d++,!p&&!f&&v();var N=y=y!=null?y:t();j.add(function(){d--,d===0&&!p&&!f&&(h=bl(S,c))}),N.subscribe(j),!u&&d>0&&(u=new Fi({next:function(D){return N.next(D)},error:function(D){p=!0,v(),h=bl(w,i,D),N.error(D)},complete:function(){f=!0,v(),h=bl(w,s),N.complete()}}),ke(R).subscribe(u))})(l)}}function bl(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];if(e===!0){n();return}if(e!==!1){var i=new Fi({next:function(){i.unsubscribe(),n()}});return ke(e.apply(void 0,We([],Fe(t)))).subscribe(i)}}function BO(n,e,t){var r,i,o,s,a=!1;return n&&typeof n=="object"?(r=n.bufferSize,s=r===void 0?1/0:r,i=n.windowTime,e=i===void 0?1/0:i,o=n.refCount,a=o===void 0?!1:o,t=n.scheduler):s=n!=null?n:1/0,sv({connector:function(){return new Hh(s,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function LO(n){return ye(function(e,t){var r=!1,i,o=!1,s=0;e.subscribe(le(t,function(a){o=!0,(!n||n(a,s++,e))&&(r&&t.error(new Im("Too many matching values")),r=!0,i=a)},function(){r?(t.next(i),t.complete()):t.error(o?new Rm("No matching values"):new gi)}))})}function DO(n){return di(function(e,t){return n<=t})}function UO(n){return n<=0?At:ye(function(e,t){var r=new Array(n),i=0;return e.subscribe(le(t,function(o){var s=i++;if(s<n)r[s]=o;else{var a=s%n,c=r[a];r[a]=o,t.next(c)}})),function(){r=null}})}function qO(n){return ye(function(e,t){var r=!1,i=le(t,function(){i==null||i.unsubscribe(),r=!0},dt);ke(n).subscribe(i),e.subscribe(le(t,function(o){return r&&t.next(o)}))})}function VO(n){return ye(function(e,t){var r=!1,i=0;e.subscribe(le(t,function(o){return(r||(r=!n(o,i++)))&&t.next(o)}))})}function MO(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=br(n);return ye(function(r,i){(t?qo(n,r,t):qo(n,r)).subscribe(i)})}function Mo(n,e){return ye(function(t,r){var i=null,o=0,s=!1,a=function(){return s&&!i&&r.complete()};t.subscribe(le(r,function(c){i==null||i.unsubscribe();var l=0,u=o++;ke(n(c,u)).subscribe(i=le(r,function(h){return r.next(e?e(c,h,u,l++):h)},function(){i=null,a()}))},function(){s=!0,a()}))})}function FO(){return Mo(At)}function WO(n,e){return Se(e)?Mo(function(){return n},e):Mo(function(){return n})}function zO(n,e){return ye(function(t,r){var i=e;return Mo(function(o,s){return n(i,o,s)},function(o,s){return i=s,s})(t).subscribe(r),function(){i=null}})}function KO(n){return ye(function(e,t){ke(n).subscribe(le(t,function(){return t.complete()},dt)),!t.closed&&e.subscribe(t)})}function HO(n,e){return e===void 0&&(e=!1),ye(function(t,r){var i=0;t.subscribe(le(r,function(o){var s=n(o,i++);(s||e)&&r.next(o),!s&&r.complete()}))})}function JO(n,e,t){var r=Se(n)||e||t?{next:n,error:e,complete:t}:n;return r?ye(function(i,o){var s;(s=r.subscribe)===null||s===void 0||s.call(r);var a=!0;i.subscribe(le(o,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),o.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),o.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),o.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):At}function av(n,e){return ye(function(t,r){var i=e!=null?e:{},o=i.leading,s=o===void 0?!0:o,a=i.trailing,c=a===void 0?!1:a,l=!1,u=null,h=null,y=!1,d=function(){h==null||h.unsubscribe(),h=null,c&&(v(),y&&r.complete())},f=function(){h=null,y&&r.complete()},p=function(w){return h=ke(n(w)).subscribe(le(r,d,f))},v=function(){if(l){l=!1;var w=u;u=null,r.next(w),!y&&p(w)}};t.subscribe(le(r,function(w){l=!0,u=w,!(h&&!h.closed)&&(s?v():p(w))},function(){y=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function YO(n,e,t){e===void 0&&(e=Sn);var r=bi(n,e);return av(function(){return r},t)}function GO(n){return n===void 0&&(n=Sn),ye(function(e,t){var r=n.now();e.subscribe(le(t,function(i){var o=n.now(),s=o-r;r=o,t.next(new XO(i,s))}))})}var XO=function(){function n(e,t){this.value=e,this.interval=t}return n}();function QO(n,e,t){var r,i,o;if(t=t!=null?t:Yh,Zh(n)?r=n:typeof n=="number"&&(i=n),e)o=function(){return e};else throw new TypeError("No observable provided to switch to");if(r==null&&i==null)throw new TypeError("No timeout provided.");return Bm({first:r,each:i,scheduler:t,with:o})}function ZO(n){return n===void 0&&(n=lc),mi(function(e){return{value:e,timestamp:n.now()}})}function eA(n){return ye(function(e,t){var r=new bt;t.next(r.asObservable());var i=function(o){r.error(o),t.error(o)};return e.subscribe(le(t,function(o){return r==null?void 0:r.next(o)},function(){r.complete(),t.complete()},i)),ke(n).subscribe(le(t,function(){r.complete(),t.next(r=new bt)},dt,i)),function(){r==null||r.unsubscribe(),r=null}})}function tA(n,e){e===void 0&&(e=0);var t=e>0?e:n;return ye(function(r,i){var o=[new bt],s=[],a=0;i.next(o[0].asObservable()),r.subscribe(le(i,function(c){var l,u;try{for(var h=Zt(o),y=h.next();!y.done;y=h.next()){var d=y.value;d.next(c)}}catch(v){l={error:v}}finally{try{y&&!y.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}var f=a-n+1;if(f>=0&&f%t===0&&o.shift().complete(),++a%t===0){var p=new bt;o.push(p),i.next(p.asObservable())}},function(){for(;o.length>0;)o.shift().complete();i.complete()},function(c){for(;o.length>0;)o.shift().error(c);i.error(c)},function(){s=null,o=null}))})}function nA(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=br(r))!==null&&e!==void 0?e:Sn,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return ye(function(c,l){var u=[],h=!1,y=function(v){var w=v.window,S=v.subs;w.complete(),S.unsubscribe(),gr(u,v),h&&d()},d=function(){if(u){var v=new sn;l.add(v);var w=new bt,S={window:w,subs:v,seen:0};u.push(S),l.next(w.asObservable()),en(v,o,function(){return y(S)},n)}};s!==null&&s>=0?en(l,o,d,s,!0):h=!0,d();var f=function(v){return u.slice().forEach(v)},p=function(v){f(function(w){var S=w.window;return v(S)}),v(l),l.unsubscribe()};return c.subscribe(le(l,function(v){f(function(w){w.window.next(v),a<=++w.seen&&y(w)})},function(){return p(function(v){return v.complete()})},function(v){return p(function(w){return w.error(v)})})),function(){u=null}})}function rA(n,e){return ye(function(t,r){var i=[],o=function(s){for(;0<i.length;)i.shift().error(s);r.error(s)};ke(n).subscribe(le(r,function(s){var a=new bt;i.push(a);var c=new sn,l=function(){gr(i,a),a.complete(),c.unsubscribe()},u;try{u=ke(e(s))}catch(h){o(h);return}r.next(a.asObservable()),c.add(u.subscribe(le(r,l,dt,o)))},dt)),t.subscribe(le(r,function(s){var a,c,l=i.slice();try{for(var u=Zt(l),h=u.next();!h.done;h=u.next()){var y=h.value;y.next(s)}}catch(d){a={error:d}}finally{try{h&&!h.done&&(c=u.return)&&c.call(u)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();r.complete()},o,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function iA(n){return ye(function(e,t){var r,i,o=function(a){r.error(a),t.error(a)},s=function(){i==null||i.unsubscribe(),r==null||r.complete(),r=new bt,t.next(r.asObservable());var a;try{a=ke(n())}catch(c){o(c);return}a.subscribe(i=le(t,s,s,o))};s(),e.subscribe(le(t,function(a){return r.next(a)},function(){r.complete(),t.complete()},o,function(){i==null||i.unsubscribe(),r=null}))})}function oA(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=us(n);return ye(function(r,i){for(var o=n.length,s=new Array(o),a=n.map(function(){return!1}),c=!1,l=function(h){ke(n[h]).subscribe(le(i,function(y){s[h]=y,!c&&!a[h]&&(a[h]=!0,(c=a.every(At))&&(a=null))},dt))},u=0;u<o;u++)l(u);r.subscribe(le(i,function(h){if(c){var y=We([h],Fe(s));i.next(t?t.apply(void 0,We([],Fe(y))):y)}}))})}function sA(n){return Gm(nd,n)}function aA(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return ye(function(t,r){nd.apply(void 0,We([t],Fe(n))).subscribe(r)})}function cA(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return aA.apply(void 0,We([],Fe(n)))}const lA=Object.freeze(Object.defineProperty({__proto__:null,Observable:Be,ConnectableObservable:cc,observable:ac,animationFrames:__,Subject:bt,BehaviorSubject:dm,ReplaySubject:Hh,AsyncSubject:Jh,asap:C_,asapScheduler:pm,async:Yh,asyncScheduler:Sn,queue:N_,queueScheduler:ym,animationFrame:D_,animationFrameScheduler:gm,VirtualTimeScheduler:U_,VirtualAction:mm,Scheduler:Eu,Subscription:sn,Subscriber:sc,Notification:aa,get NotificationKind(){return _u},pipe:zh,noop:dt,identity:At,isObservable:Z_,lastValueFrom:e$,firstValueFrom:t$,ArgumentOutOfRangeError:$u,EmptyError:gi,NotFoundError:Rm,ObjectUnsubscribedError:hm,SequenceError:Im,TimeoutError:Nm,UnsubscriptionError:oa,bindCallback:o$,bindNodeCallback:s$,combineLatest:Um,concat:qo,connectable:f$,defer:pc,empty:q_,forkJoin:p$,from:wr,fromEvent:Ou,fromEventPattern:Vm,generate:k$,iif:x$,interval:Mm,merge:E$,never:_$,of:Qh,onErrorResumeNext:Wm,pairs:O$,partition:S$,race:T$,range:P$,throwError:jm,timer:bi,using:j$,zip:nd,scheduled:Pm,EMPTY:ir,NEVER:Fm,config:Gr,audit:Km,auditTime:C$,buffer:R$,bufferCount:I$,bufferTime:N$,bufferToggle:B$,bufferWhen:L$,catchError:Hm,combineAll:U$,combineLatestAll:Xm,combineLatestWith:q$,concatAll:td,concatMap:Au,concatMapTo:V$,concatWith:F$,connect:rd,count:K$,debounce:H$,debounceTime:J$,defaultIfEmpty:yc,delay:Y$,delayWhen:id,dematerialize:G$,distinct:X$,distinctUntilChanged:tv,distinctUntilKeyChanged:Z$,elementAt:tO,endWith:nO,every:rO,exhaust:iO,exhaustAll:nv,exhaustMap:od,expand:oO,filter:di,finalize:sO,find:aO,findIndex:cO,first:lO,groupBy:uO,ignoreElements:Zm,isEmpty:hO,last:dO,map:mi,mapTo:ev,materialize:fO,max:pO,mergeAll:fc,flatMap:yO,mergeMap:qn,mergeMapTo:gO,mergeScan:mO,mergeWith:bO,min:wO,multicast:sd,observeOn:hc,onErrorResumeNextWith:kO,pairwise:xO,pluck:EO,publish:_O,publishBehavior:$O,publishLast:OO,publishReplay:AO,raceWith:SO,reduce:hs,repeat:TO,repeatWhen:PO,retry:jO,retryWhen:CO,refCount:cm,sample:ov,sampleTime:RO,scan:IO,sequenceEqual:NO,share:sv,shareReplay:BO,single:LO,skip:DO,skipLast:UO,skipUntil:qO,skipWhile:VO,startWith:MO,subscribeOn:dc,switchAll:FO,switchMap:Mo,switchMapTo:WO,switchScan:zO,take:Vo,takeLast:iv,takeUntil:KO,takeWhile:HO,tap:JO,throttle:av,throttleTime:YO,throwIfEmpty:gc,timeInterval:GO,timeout:Bm,timeoutWith:QO,timestamp:ZO,toArray:Ym,window:eA,windowCount:tA,windowTime:nA,windowToggle:rA,windowWhen:iA,withLatestFrom:oA,zipAll:sA,zipWith:cA},Symbol.toStringTag,{value:"Module"}));var uA=Object.defineProperty,hA=Object.defineProperties,dA=Object.getOwnPropertyDescriptors,mp=Object.getOwnPropertySymbols,fA=Object.prototype.hasOwnProperty,pA=Object.prototype.propertyIsEnumerable,Su=(n,e,t)=>e in n?uA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,re=(n,e)=>{for(var t in e||(e={}))fA.call(e,t)&&Su(n,t,e[t]);if(mp)for(var t of mp(e))pA.call(e,t)&&Su(n,t,e[t]);return n},Qe=(n,e)=>hA(n,dA(e)),yA=(n,e,t)=>(Su(n,typeof e!="symbol"?e+"":e,t),t),cv=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},_e=(n,e,t)=>(cv(n,e,"read from private field"),t?t.call(n):e.get(n)),lr=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},Kn=(n,e,t,r)=>(cv(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),F=(n,e,t)=>new Promise((r,i)=>{var o=c=>{try{a(t.next(c))}catch(l){i(l)}},s=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(o,s);a((t=t.apply(n,e)).next())});const tr=Object.create(null);tr.open="0";tr.close="1";tr.ping="2";tr.pong="3";tr.message="4";tr.upgrade="5";tr.noop="6";const ca=Object.create(null);Object.keys(tr).forEach(n=>{ca[tr[n]]=n});const gA={type:"error",data:"parser error"},mA=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",vA=typeof ArrayBuffer=="function",bA=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,lv=({type:n,data:e},t,r)=>mA&&e instanceof Blob?t?r(e):vp(e,r):vA&&(e instanceof ArrayBuffer||bA(e))?t?r(e):vp(new Blob([e]),r):r(tr[n]+(e||"")),vp=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)},bp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Oo=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let n=0;n<bp.length;n++)Oo[bp.charCodeAt(n)]=n;const wA=n=>{let e=n.length*.75,t=n.length,r,i=0,o,s,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const l=new ArrayBuffer(e),u=new Uint8Array(l);for(r=0;r<t;r+=4)o=Oo[n.charCodeAt(r)],s=Oo[n.charCodeAt(r+1)],a=Oo[n.charCodeAt(r+2)],c=Oo[n.charCodeAt(r+3)],u[i++]=o<<2|s>>4,u[i++]=(s&15)<<4|a>>2,u[i++]=(a&3)<<6|c&63;return l},kA=typeof ArrayBuffer=="function",uv=(n,e)=>{if(typeof n!="string")return{type:"message",data:hv(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:xA(n.substring(1),e)}:ca[t]?n.length>1?{type:ca[t],data:n.substring(1)}:{type:ca[t]}:gA},xA=(n,e)=>{if(kA){const t=wA(n);return hv(t,e)}else return{base64:!0,data:n}},hv=(n,e)=>{switch(e){case"blob":return n instanceof ArrayBuffer?new Blob([n]):n;case"arraybuffer":default:return n}},dv=String.fromCharCode(30),EA=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((o,s)=>{lv(o,!1,a=>{r[s]=a,++i===t&&e(r.join(dv))})})},_A=(n,e)=>{const t=n.split(dv),r=[];for(let i=0;i<t.length;i++){const o=uv(t[i],e);if(r.push(o),o.type==="error")break}return r},fv=4;function ut(n){if(n)return $A(n)}function $A(n){for(var e in ut.prototype)n[e]=ut.prototype[e];return n}ut.prototype.on=ut.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};ut.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};ut.prototype.off=ut.prototype.removeListener=ut.prototype.removeAllListeners=ut.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};ut.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};ut.prototype.emitReserved=ut.prototype.emit;ut.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};ut.prototype.hasListeners=function(n){return!!this.listeners(n).length};const En=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function pv(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const OA=En.setTimeout,AA=En.clearTimeout;function mc(n,e){e.useNativeTimers?(n.setTimeoutFn=OA.bind(En),n.clearTimeoutFn=AA.bind(En)):(n.setTimeoutFn=En.setTimeout.bind(En),n.clearTimeoutFn=En.clearTimeout.bind(En))}const SA=1.33;function TA(n){return typeof n=="string"?PA(n):Math.ceil((n.byteLength||n.size)*SA)}function PA(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}class jA extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class yv extends ut{constructor(e){super(),this.writable=!1,mc(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new jA(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=uv(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const gv="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Tu=64,CA={};let wp=0,Ns=0,kp;function xp(n){let e="";do e=gv[n%Tu]+e,n=Math.floor(n/Tu);while(n>0);return e}function mv(){const n=xp(+new Date);return n!==kp?(wp=0,kp=n):n+"."+xp(wp++)}for(;Ns<Tu;Ns++)CA[gv[Ns]]=Ns;function vv(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function RA(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let o=t[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}let bv=!1;try{bv=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(n){}const IA=bv;function wv(n){const e=n.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||IA))return new XMLHttpRequest}catch(t){}if(!e)try{return new En[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function NA(){}const BA=function(){return new wv({xdomain:!1}).responseType!=null}();class LA extends yv{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=BA&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};_A(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,EA(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=mv()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=vv(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new Qn(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class Qn extends ut{constructor(e,t){super(),mc(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=pv(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new wv(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch(r){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{t.setRequestHeader("Accept","*/*")}catch(r){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document!="undefined"&&(this.index=Qn.requestsCount++,Qn.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=NA,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete Qn.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Qn.requestsCount=0;Qn.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Ep);else if(typeof addEventListener=="function"){const n="onpagehide"in En?"pagehide":"unload";addEventListener(n,Ep,!1)}}function Ep(){for(let n in Qn.requests)Qn.requests.hasOwnProperty(n)&&Qn.requests[n].abort()}const kv=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,e)=>e(n,0))(),Bs=En.WebSocket||En.MozWebSocket,_p=!0,DA="arraybuffer",$p=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class UA extends yv{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=$p?{}:pv(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=_p&&!$p?t?new Bs(e,t):new Bs(e):new Bs(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||DA,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;lv(r,this.supportsBinary,o=>{try{_p&&this.ws.send(o)}catch(s){}i&&kv(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=mv()),this.supportsBinary||(e.b64=1);const i=vv(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!Bs}}const qA={websocket:UA,polling:LA},VA=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,MA=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Pu(n){const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=VA.exec(n||""),o={},s=14;for(;s--;)o[MA[s]]=i[s]||"";return t!=-1&&r!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=FA(o,o.path),o.queryKey=WA(o,o.query),o}function FA(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function WA(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(t[i]=o)}),t}class qr extends ut{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=Pu(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Pu(t.host).host),mc(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=RA(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=fv,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new qA[e](r)}open(){let e;if(this.opts.rememberUpgrade&&qr.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),r=!1;qr.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;qr.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const y=new Error("probe error");y.transport=t.name,this.emitReserved("upgradeError",y)}}))};function o(){r||(r=!0,u(),t.close(),t=null)}const s=h=>{const y=new Error("probe error: "+h);y.transport=t.name,o(),this.emitReserved("upgradeError",y)};function a(){s("transport closed")}function c(){s("socket closed")}function l(h){t&&h.name!==t.name&&o()}const u=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};t.once("open",i),t.once("error",s),t.once("close",a),this.once("close",c),this.once("upgrading",l),t.open()}onOpen(){if(this.readyState="open",qr.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=TA(r)),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:e,data:t,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){qr.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}qr.protocol=fv;function zA(n,e="",t){let r=n;t=t||typeof location!="undefined"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t!="undefined"?n=t.protocol+"//"+n:n="https://"+n),r=Pu(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}const KA=typeof ArrayBuffer=="function",HA=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,xv=Object.prototype.toString,JA=typeof Blob=="function"||typeof Blob!="undefined"&&xv.call(Blob)==="[object BlobConstructor]",YA=typeof File=="function"||typeof File!="undefined"&&xv.call(File)==="[object FileConstructor]";function ad(n){return KA&&(n instanceof ArrayBuffer||HA(n))||JA&&n instanceof Blob||YA&&n instanceof File}function la(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(la(n[t]))return!0;return!1}if(ad(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return la(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&la(n[t]))return!0;return!1}function GA(n){const e=[],t=n.data,r=n;return r.data=ju(t,e),r.attachments=e.length,{packet:r,buffers:e}}function ju(n,e){if(!n)return n;if(ad(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=ju(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=ju(n[r],e));return t}return n}function XA(n,e){return n.data=Cu(n.data,e),delete n.attachments,n}function Cu(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=Cu(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=Cu(n[t],e));return n}const QA=5;var Ie;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(Ie||(Ie={}));class ZA{constructor(e){this.replacer=e}encode(e){return(e.type===Ie.EVENT||e.type===Ie.ACK)&&la(e)?this.encodeAsBinary({type:e.type===Ie.EVENT?Ie.BINARY_EVENT:Ie.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Ie.BINARY_EVENT||e.type===Ie.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=GA(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}class cd extends ut{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Ie.BINARY_EVENT;r||t.type===Ie.BINARY_ACK?(t.type=r?Ie.EVENT:Ie.ACK,this.reconstructor=new eS(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(ad(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(Ie[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===Ie.BINARY_EVENT||r.type===Ie.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const s=e.substring(o,t);if(s!=Number(s)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(o,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const o=t+1;for(;++t;){const s=e.charAt(t);if(s==null||Number(s)!=s){--t;break}if(t===e.length)break}r.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(cd.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Ie.CONNECT:return typeof t=="object";case Ie.DISCONNECT:return t===void 0;case Ie.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case Ie.EVENT:case Ie.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case Ie.ACK:case Ie.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class eS{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=XA(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const tS=Object.freeze(Object.defineProperty({__proto__:null,protocol:QA,get PacketType(){return Ie},Encoder:ZA,Decoder:cd},Symbol.toStringTag,{value:"Module"}));function In(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const nS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ev extends ut{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[In(e,"open",this.onopen.bind(this)),In(e,"packet",this.onpacket.bind(this)),In(e,"error",this.onerror.bind(this)),In(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(nS.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Ie.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,s=t.pop();this._registerAckCallback(o,s),r.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...s)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...s])}}emitWithAck(e,...t){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,o)=>{t.push((s,a)=>r?s?o(s):i(a):i(s)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...o)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Ie.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Ie.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Ie.EVENT:case Ie.BINARY_EVENT:this.onevent(e);break;case Ie.ACK:case Ie.BINARY_ACK:this.onack(e);break;case Ie.DISCONNECT:this.ondisconnect();break;case Ie.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:Ie.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Ie.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Zi(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Zi.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};Zi.prototype.reset=function(){this.attempts=0};Zi.prototype.setMin=function(n){this.ms=n};Zi.prototype.setMax=function(n){this.max=n};Zi.prototype.setJitter=function(n){this.jitter=n};class Ru extends ut{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,mc(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Zi({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||tS;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new qr(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=In(t,"open",function(){r.onopen(),e&&e()}),o=In(t,"error",s=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",s),e?e(s):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const s=this._timeout;s===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(In(e,"ping",this.onping.bind(this)),In(e,"data",this.ondata.bind(this)),In(e,"error",this.onerror.bind(this)),In(e,"close",this.onclose.bind(this)),In(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){kv(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Ev(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const yo={};function ua(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=zA(n,e.path||"/socket.io"),r=t.source,i=t.id,o=t.path,s=yo[i]&&o in yo[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let c;return a?c=new Ru(r,e):(yo[i]||(yo[i]=new Ru(r,e)),c=yo[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(ua,{Manager:Ru,Socket:Ev,io:ua,connect:ua});const rS={init:({API_KEY:n,HOST_SERVER:e,CURRENT:t,ENV:r,API_VERSION:i})=>{var o,s;let a={};const c=localStorage.getItem("accessToken");try{const l={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return c&&(l.Authorization="Bearer "+c),a.database=ua(e.DATABASE,{extraHeaders:l}),(o=a==null?void 0:a.database)==null||o.on("connect",()=>{r==="dev"&&console.log("Swyger Database Client JS is connected with Swyger Server!!!")}),(s=a==null?void 0:a.database)==null||s.on("disconnect",u=>{r==="dev"&&console.log("The device is disconnected from Database server!")}),a}catch(l){}}};function Iu(n){this.message=n}Iu.prototype=new Error,Iu.prototype.name="InvalidCharacterError";var Op=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new Iu("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,o=0,s="";r=e.charAt(o++);~r&&(t=i%4?64*t+r:r,i++%4)?s+=String.fromCharCode(255&t>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return s};function iS(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(Op(t).replace(/(.)/g,function(r,i){var o=i.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(e)}catch(t){return Op(e)}}function qa(n){this.message=n}function oS(n,e){if(typeof n!="string")throw new qa("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(iS(n.split(".")[t]))}catch(r){throw new qa("Invalid token specified: "+r.message)}}qa.prototype=new Error,qa.prototype.name="InvalidTokenError";function _v(n,e){return function(){return n.apply(e,arguments)}}const{toString:sS}=Object.prototype,{getPrototypeOf:ld}=Object,vc=(n=>e=>{const t=sS.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),or=n=>(n=n.toLowerCase(),e=>vc(e)===n),bc=n=>e=>typeof e===n,{isArray:eo}=Array,Fo=bc("undefined");function aS(n){return n!==null&&!Fo(n)&&n.constructor!==null&&!Fo(n.constructor)&&On(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const $v=or("ArrayBuffer");function cS(n){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&$v(n.buffer),e}const lS=bc("string"),On=bc("function"),Ov=bc("number"),wc=n=>n!==null&&typeof n=="object",uS=n=>n===!0||n===!1,ha=n=>{if(vc(n)!=="object")return!1;const e=ld(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},hS=or("Date"),dS=or("File"),fS=or("Blob"),pS=or("FileList"),yS=n=>wc(n)&&On(n.pipe),gS=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||On(n.append)&&((e=vc(n))==="formdata"||e==="object"&&On(n.toString)&&n.toString()==="[object FormData]"))},mS=or("URLSearchParams"),vS=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ds(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n=="undefined")return;let r,i;if(typeof n!="object"&&(n=[n]),eo(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const o=t?Object.getOwnPropertyNames(n):Object.keys(n),s=o.length;let a;for(r=0;r<s;r++)a=o[r],e.call(null,n[a],a,n)}}function Av(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const Sv=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),Tv=n=>!Fo(n)&&n!==Sv;function Nu(){const{caseless:n}=Tv(this)&&this||{},e={},t=(r,i)=>{const o=n&&Av(e,i)||i;ha(e[o])&&ha(r)?e[o]=Nu(e[o],r):ha(r)?e[o]=Nu({},r):eo(r)?e[o]=r.slice():e[o]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&ds(arguments[r],t);return e}const bS=(n,e,t,{allOwnKeys:r}={})=>(ds(e,(i,o)=>{t&&On(i)?n[o]=_v(i,t):n[o]=i},{allOwnKeys:r}),n),wS=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),kS=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},xS=(n,e,t,r)=>{let i,o,s;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),o=i.length;o-- >0;)s=i[o],(!r||r(s,n,e))&&!a[s]&&(e[s]=n[s],a[s]=!0);n=t!==!1&&ld(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},ES=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},_S=n=>{if(!n)return null;if(eo(n))return n;let e=n.length;if(!Ov(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},$S=(n=>e=>n&&e instanceof n)(typeof Uint8Array!="undefined"&&ld(Uint8Array)),OS=(n,e)=>{const t=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=t.next())&&!r.done;){const i=r.value;e.call(n,i[0],i[1])}},AS=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},SS=or("HTMLFormElement"),TS=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),Ap=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),PS=or("RegExp"),Pv=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};ds(t,(i,o)=>{e(i,o,n)!==!1&&(r[o]=i)}),Object.defineProperties(n,r)},jS=n=>{Pv(n,(e,t)=>{if(On(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(On(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},CS=(n,e)=>{const t={},r=i=>{i.forEach(o=>{t[o]=!0})};return eo(n)?r(n):r(String(n).split(e)),t},RS=()=>{},IS=(n,e)=>(n=+n,Number.isFinite(n)?n:e),wl="abcdefghijklmnopqrstuvwxyz",Sp="0123456789",jv={DIGIT:Sp,ALPHA:wl,ALPHA_DIGIT:wl+wl.toUpperCase()+Sp},NS=(n=16,e=jv.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function BS(n){return!!(n&&On(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const LS=n=>{const e=new Array(10),t=(r,i)=>{if(wc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const o=eo(r)?[]:{};return ds(r,(s,a)=>{const c=t(s,i+1);!Fo(c)&&(o[a]=c)}),e[i]=void 0,o}}return r};return t(n,0)},DS=or("AsyncFunction"),US=n=>n&&(wc(n)||On(n))&&On(n.then)&&On(n.catch),Q={isArray:eo,isArrayBuffer:$v,isBuffer:aS,isFormData:gS,isArrayBufferView:cS,isString:lS,isNumber:Ov,isBoolean:uS,isObject:wc,isPlainObject:ha,isUndefined:Fo,isDate:hS,isFile:dS,isBlob:fS,isRegExp:PS,isFunction:On,isStream:yS,isURLSearchParams:mS,isTypedArray:$S,isFileList:pS,forEach:ds,merge:Nu,extend:bS,trim:vS,stripBOM:wS,inherits:kS,toFlatObject:xS,kindOf:vc,kindOfTest:or,endsWith:ES,toArray:_S,forEachEntry:OS,matchAll:AS,isHTMLForm:SS,hasOwnProperty:Ap,hasOwnProp:Ap,reduceDescriptors:Pv,freezeMethods:jS,toObjectSet:CS,toCamelCase:TS,noop:RS,toFiniteNumber:IS,findKey:Av,global:Sv,isContextDefined:Tv,ALPHABET:jv,generateString:NS,isSpecCompliantForm:BS,toJSONObject:LS,isAsyncFn:DS,isThenable:US};function qe(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}Q.inherits(qe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Q.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Cv=qe.prototype,Rv={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Rv[n]={value:n}});Object.defineProperties(qe,Rv);Object.defineProperty(Cv,"isAxiosError",{value:!0});qe.from=(n,e,t,r,i,o)=>{const s=Object.create(Cv);return Q.toFlatObject(n,s,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),qe.call(s,n.message,e,t,r,i),s.cause=n,s.name=n.name,o&&Object.assign(s,o),s};const qS=null;function Bu(n){return Q.isPlainObject(n)||Q.isArray(n)}function Iv(n){return Q.endsWith(n,"[]")?n.slice(0,-2):n}function Tp(n,e,t){return n?n.concat(e).map(function(r,i){return r=Iv(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function VS(n){return Q.isArray(n)&&!n.some(Bu)}const MS=Q.toFlatObject(Q,{},null,function(n){return/^is[A-Z]/.test(n)});function kc(n,e,t){if(!Q.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=Q.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(d,f){return!Q.isUndefined(f[d])});const r=t.metaTokens,i=t.visitor||l,o=t.dots,s=t.indexes,a=(t.Blob||typeof Blob!="undefined"&&Blob)&&Q.isSpecCompliantForm(e);if(!Q.isFunction(i))throw new TypeError("visitor must be a function");function c(d){if(d===null)return"";if(Q.isDate(d))return d.toISOString();if(!a&&Q.isBlob(d))throw new qe("Blob is not supported. Use a Buffer instead.");return Q.isArrayBuffer(d)||Q.isTypedArray(d)?a&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function l(d,f,p){let v=d;if(d&&!p&&typeof d=="object"){if(Q.endsWith(f,"{}"))f=r?f:f.slice(0,-2),d=JSON.stringify(d);else if(Q.isArray(d)&&VS(d)||(Q.isFileList(d)||Q.endsWith(f,"[]"))&&(v=Q.toArray(d)))return f=Iv(f),v.forEach(function(w,S){!(Q.isUndefined(w)||w===null)&&e.append(s===!0?Tp([f],S,o):s===null?f:f+"[]",c(w))}),!1}return Bu(d)?!0:(e.append(Tp(p,f,o),c(d)),!1)}const u=[],h=Object.assign(MS,{defaultVisitor:l,convertValue:c,isVisitable:Bu});function y(d,f){if(!Q.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+f.join("."));u.push(d),Q.forEach(d,function(p,v){(!(Q.isUndefined(p)||p===null)&&i.call(e,p,Q.isString(v)?v.trim():v,f,h))===!0&&y(p,f?f.concat(v):[v])}),u.pop()}}if(!Q.isObject(n))throw new TypeError("data must be an object");return y(n),e}function Pp(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function ud(n,e){this._pairs=[],n&&kc(n,this,e)}const Nv=ud.prototype;Nv.append=function(n,e){this._pairs.push([n,e])};Nv.toString=function(n){const e=n?function(t){return n.call(this,t,Pp)}:Pp;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};function FS(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Bv(n,e,t){if(!e)return n;const r=t&&t.encode||FS,i=t&&t.serialize;let o;if(i?o=i(e,t):o=Q.isURLSearchParams(e)?e.toString():new ud(e,t).toString(r),o){const s=n.indexOf("#");s!==-1&&(n=n.slice(0,s)),n+=(n.indexOf("?")===-1?"?":"&")+o}return n}class WS{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Q.forEach(this.handlers,function(t){t!==null&&e(t)})}}const jp=WS,Lv={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},zS=typeof URLSearchParams!="undefined"?URLSearchParams:ud,KS=typeof FormData!="undefined"?FormData:null,HS=typeof Blob!="undefined"?Blob:null,JS=(()=>{let n;return typeof navigator!="undefined"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),YS=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Yn={isBrowser:!0,classes:{URLSearchParams:zS,FormData:KS,Blob:HS},isStandardBrowserEnv:JS,isStandardBrowserWebWorkerEnv:YS,protocols:["http","https","file","blob","url","data"]};function GS(n,e){return kc(n,new Yn.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,o){return Yn.isNode&&Q.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function XS(n){return Q.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function QS(n){const e={},t=Object.keys(n);let r;const i=t.length;let o;for(r=0;r<i;r++)o=t[r],e[o]=n[o];return e}function Dv(n){function e(t,r,i,o){let s=t[o++];const a=Number.isFinite(+s),c=o>=t.length;return s=!s&&Q.isArray(i)?i.length:s,c?(Q.hasOwnProp(i,s)?i[s]=[i[s],r]:i[s]=r,!a):((!i[s]||!Q.isObject(i[s]))&&(i[s]=[]),e(t,r,i[s],o)&&Q.isArray(i[s])&&(i[s]=QS(i[s])),!a)}if(Q.isFormData(n)&&Q.isFunction(n.entries)){const t={};return Q.forEachEntry(n,(r,i)=>{e(XS(r),i,t,0)}),t}return null}const ZS={"Content-Type":void 0};function eT(n,e,t){if(Q.isString(n))try{return(e||JSON.parse)(n),Q.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const xc={transitional:Lv,adapter:["xhr","http"],transformRequest:[function(n,e){const t=e.getContentType()||"",r=t.indexOf("application/json")>-1,i=Q.isObject(n);if(i&&Q.isHTMLForm(n)&&(n=new FormData(n)),Q.isFormData(n))return r&&r?JSON.stringify(Dv(n)):n;if(Q.isArrayBuffer(n)||Q.isBuffer(n)||Q.isStream(n)||Q.isFile(n)||Q.isBlob(n))return n;if(Q.isArrayBufferView(n))return n.buffer;if(Q.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let o;if(i){if(t.indexOf("application/x-www-form-urlencoded")>-1)return GS(n,this.formSerializer).toString();if((o=Q.isFileList(n))||t.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return kc(o?{"files[]":n}:n,s&&new s,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),eT(n)):n}],transformResponse:[function(n){const e=this.transitional||xc.transitional,t=e&&e.forcedJSONParsing,r=this.responseType==="json";if(n&&Q.isString(n)&&(t&&!this.responseType||r)){const i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(n)}catch(o){if(i)throw o.name==="SyntaxError"?qe.from(o,qe.ERR_BAD_RESPONSE,this,null,this.response):o}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Yn.classes.FormData,Blob:Yn.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Q.forEach(["delete","get","head"],function(n){xc.headers[n]={}});Q.forEach(["post","put","patch"],function(n){xc.headers[n]=Q.merge(ZS)});const hd=xc,tT=Q.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),nT=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),r=o.substring(i+1).trim(),!(!t||e[t]&&tT[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},Cp=Symbol("internals");function go(n){return n&&String(n).trim().toLowerCase()}function da(n){return n===!1||n==null?n:Q.isArray(n)?n.map(da):String(n)}function rT(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const iT=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function kl(n,e,t,r,i){if(Q.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!Q.isString(e)){if(Q.isString(r))return e.indexOf(r)!==-1;if(Q.isRegExp(r))return r.test(e)}}function oT(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function sT(n,e){const t=Q.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,o,s){return this[r].call(this,e,i,o,s)},configurable:!0})})}class Ec{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function o(a,c,l){const u=go(c);if(!u)throw new Error("header name must be a non-empty string");const h=Q.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||c]=da(a))}const s=(a,c)=>Q.forEach(a,(l,u)=>o(l,u,c));return Q.isPlainObject(e)||e instanceof this.constructor?s(e,t):Q.isString(e)&&(e=e.trim())&&!iT(e)?s(nT(e),t):e!=null&&o(t,e,r),this}get(e,t){if(e=go(e),e){const r=Q.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return rT(i);if(Q.isFunction(t))return t.call(this,i,r);if(Q.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=go(e),e){const r=Q.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||kl(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function o(s){if(s=go(s),s){const a=Q.findKey(r,s);a&&(!t||kl(r,r[a],a,t))&&(delete r[a],i=!0)}}return Q.isArray(e)?e.forEach(o):o(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const o=t[r];(!e||kl(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){const t=this,r={};return Q.forEach(this,(i,o)=>{const s=Q.findKey(r,o);if(s){t[s]=da(i),delete t[o];return}const a=e?oT(o):String(o).trim();a!==o&&delete t[o],t[a]=da(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Q.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&Q.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const t=(this[Cp]=this[Cp]={accessors:{}}).accessors,r=this.prototype;function i(o){const s=go(o);t[s]||(sT(r,o),t[s]=!0)}return Q.isArray(e)?e.forEach(i):i(e),this}}Ec.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Q.freezeMethods(Ec.prototype);Q.freezeMethods(Ec);const pr=Ec;function xl(n,e){const t=this||hd,r=e||t,i=pr.from(r.headers);let o=r.data;return Q.forEach(n,function(s){o=s.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function Uv(n){return!!(n&&n.__CANCEL__)}function fs(n,e,t){qe.call(this,n==null?"canceled":n,qe.ERR_CANCELED,e,t),this.name="CanceledError"}Q.inherits(fs,qe,{__CANCEL__:!0});function aT(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new qe("Request failed with status code "+t.status,[qe.ERR_BAD_REQUEST,qe.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const cT=Yn.isStandardBrowserEnv?function(){return{write:function(n,e,t,r,i,o){const s=[];s.push(n+"="+encodeURIComponent(e)),Q.isNumber(t)&&s.push("expires="+new Date(t).toGMTString()),Q.isString(r)&&s.push("path="+r),Q.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read:function(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function lT(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function uT(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}function qv(n,e){return n&&!lT(e)?uT(n,e):e}const hT=Yn.isStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let t;function r(i){let o=i;return n&&(e.setAttribute("href",o),o=e.href),e.setAttribute("href",o),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return t=r(window.location.href),function(i){const o=Q.isString(i)?r(i):i;return o.protocol===t.protocol&&o.host===t.host}}():function(){return function(){return!0}}();function dT(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function fT(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,o=0,s;return e=e!==void 0?e:1e3,function(a){const c=Date.now(),l=r[o];s||(s=c),t[i]=a,r[i]=c;let u=o,h=0;for(;u!==i;)h+=t[u++],u=u%n;if(i=(i+1)%n,i===o&&(o=(o+1)%n),c-s<e)return;const y=l&&c-l;return y?Math.round(h*1e3/y):void 0}}function Rp(n,e){let t=0;const r=fT(50,250);return i=>{const o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-t,c=r(a),l=o<=s;t=o;const u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&l?(s-o)/c:void 0,event:i};u[e?"download":"upload"]=!0,n(u)}}const pT=typeof XMLHttpRequest!="undefined",yT=pT&&function(n){return new Promise(function(e,t){let r=n.data;const i=pr.from(n.headers).normalize(),o=n.responseType;let s;function a(){n.cancelToken&&n.cancelToken.unsubscribe(s),n.signal&&n.signal.removeEventListener("abort",s)}Q.isFormData(r)&&(Yn.isStandardBrowserEnv||Yn.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(n.auth){const y=n.auth.username||"",d=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";i.set("Authorization","Basic "+btoa(y+":"+d))}const l=qv(n.baseURL,n.url);c.open(n.method.toUpperCase(),Bv(l,n.params,n.paramsSerializer),!0),c.timeout=n.timeout;function u(){if(!c)return;const y=pr.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),d={data:!o||o==="text"||o==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:y,config:n,request:c};aT(function(f){e(f),a()},function(f){t(f),a()},d),c=null}if("onloadend"in c?c.onloadend=u:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(u)},c.onabort=function(){!c||(t(new qe("Request aborted",qe.ECONNABORTED,n,c)),c=null)},c.onerror=function(){t(new qe("Network Error",qe.ERR_NETWORK,n,c)),c=null},c.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const d=n.transitional||Lv;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),t(new qe(y,d.clarifyTimeoutError?qe.ETIMEDOUT:qe.ECONNABORTED,n,c)),c=null},Yn.isStandardBrowserEnv){const y=(n.withCredentials||hT(l))&&n.xsrfCookieName&&cT.read(n.xsrfCookieName);y&&i.set(n.xsrfHeaderName,y)}r===void 0&&i.setContentType(null),"setRequestHeader"in c&&Q.forEach(i.toJSON(),function(y,d){c.setRequestHeader(d,y)}),Q.isUndefined(n.withCredentials)||(c.withCredentials=!!n.withCredentials),o&&o!=="json"&&(c.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&c.addEventListener("progress",Rp(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",Rp(n.onUploadProgress)),(n.cancelToken||n.signal)&&(s=y=>{!c||(t(!y||y.type?new fs(null,n,c):y),c.abort(),c=null)},n.cancelToken&&n.cancelToken.subscribe(s),n.signal&&(n.signal.aborted?s():n.signal.addEventListener("abort",s)));const h=dT(l);if(h&&Yn.protocols.indexOf(h)===-1){t(new qe("Unsupported protocol "+h+":",qe.ERR_BAD_REQUEST,n));return}c.send(r||null)})},fa={http:qS,xhr:yT};Q.forEach(fa,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch(t){}Object.defineProperty(n,"adapterName",{value:e})}});const gT={getAdapter:n=>{n=Q.isArray(n)?n:[n];const{length:e}=n;let t,r;for(let i=0;i<e&&(t=n[i],!(r=Q.isString(t)?fa[t.toLowerCase()]:t));i++);if(!r)throw r===!1?new qe(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(Q.hasOwnProp(fa,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!Q.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:fa};function El(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new fs(null,n)}function Ip(n){return El(n),n.headers=pr.from(n.headers),n.data=xl.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),gT.getAdapter(n.adapter||hd.adapter)(n).then(function(e){return El(n),e.data=xl.call(n,n.transformResponse,e),e.headers=pr.from(e.headers),e},function(e){return Uv(e)||(El(n),e&&e.response&&(e.response.data=xl.call(n,n.transformResponse,e.response),e.response.headers=pr.from(e.response.headers))),Promise.reject(e)})}const Np=n=>n instanceof pr?n.toJSON():n;function Wi(n,e){e=e||{};const t={};function r(l,u,h){return Q.isPlainObject(l)&&Q.isPlainObject(u)?Q.merge.call({caseless:h},l,u):Q.isPlainObject(u)?Q.merge({},u):Q.isArray(u)?u.slice():u}function i(l,u,h){if(Q.isUndefined(u)){if(!Q.isUndefined(l))return r(void 0,l,h)}else return r(l,u,h)}function o(l,u){if(!Q.isUndefined(u))return r(void 0,u)}function s(l,u){if(Q.isUndefined(u)){if(!Q.isUndefined(l))return r(void 0,l)}else return r(void 0,u)}function a(l,u,h){if(h in e)return r(l,u);if(h in n)return r(void 0,l)}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(l,u)=>i(Np(l),Np(u),!0)};return Q.forEach(Object.keys(Object.assign({},n,e)),function(l){const u=c[l]||i,h=u(n[l],e[l],l);Q.isUndefined(h)&&u!==a||(t[l]=h)}),t}const Vv="1.4.0",dd={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{dd[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const Bp={};dd.transitional=function(n,e,t){function r(i,o){return"[Axios v"+Vv+"] Transitional option '"+i+"'"+o+(t?". "+t:"")}return(i,o,s)=>{if(n===!1)throw new qe(r(o," has been removed"+(e?" in "+e:"")),qe.ERR_DEPRECATED);return e&&!Bp[o]&&(Bp[o]=!0,console.warn(r(o," has been deprecated since v"+e+" and will be removed in the near future"))),n?n(i,o,s):!0}};function mT(n,e,t){if(typeof n!="object")throw new qe("options must be an object",qe.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const o=r[i],s=e[o];if(s){const a=n[o],c=a===void 0||s(a,o,n);if(c!==!0)throw new qe("option "+o+" must be "+c,qe.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new qe("Unknown option "+o,qe.ERR_BAD_OPTION)}}const Lu={assertOptions:mT,validators:dd},Tr=Lu.validators;class Va{constructor(e){this.defaults=e,this.interceptors={request:new jp,response:new jp}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Wi(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:o}=t;r!==void 0&&Lu.assertOptions(r,{silentJSONParsing:Tr.transitional(Tr.boolean),forcedJSONParsing:Tr.transitional(Tr.boolean),clarifyTimeoutError:Tr.transitional(Tr.boolean)},!1),i!=null&&(Q.isFunction(i)?t.paramsSerializer={serialize:i}:Lu.assertOptions(i,{encode:Tr.function,serialize:Tr.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s;s=o&&Q.merge(o.common,o[t.method]),s&&Q.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),t.headers=pr.concat(s,o);const a=[];let c=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(t)===!1||(c=c&&f.synchronous,a.unshift(f.fulfilled,f.rejected))});const l=[];this.interceptors.response.forEach(function(f){l.push(f.fulfilled,f.rejected)});let u,h=0,y;if(!c){const f=[Ip.bind(this),void 0];for(f.unshift.apply(f,a),f.push.apply(f,l),y=f.length,u=Promise.resolve(t);h<y;)u=u.then(f[h++],f[h++]);return u}y=a.length;let d=t;for(h=0;h<y;){const f=a[h++],p=a[h++];try{d=f(d)}catch(v){p.call(this,v);break}}try{u=Ip.call(this,d)}catch(f){return Promise.reject(f)}for(h=0,y=l.length;h<y;)u=u.then(l[h++],l[h++]);return u}getUri(e){e=Wi(this.defaults,e);const t=qv(e.baseURL,e.url);return Bv(t,e.params,e.paramsSerializer)}}Q.forEach(["delete","get","head","options"],function(n){Va.prototype[n]=function(e,t){return this.request(Wi(t||{},{method:n,url:e,data:(t||{}).data}))}});Q.forEach(["post","put","patch"],function(n){function e(t){return function(r,i,o){return this.request(Wi(o||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Va.prototype[n]=e(),Va.prototype[n+"Form"]=e(!0)});const pa=Va;class fd{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](i);r._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(a=>{r.subscribe(a),o=a}).then(i);return s.cancel=function(){r.unsubscribe(o)},s},e(function(i,o,s){r.reason||(r.reason=new fs(i,o,s),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new fd(function(t){e=t}),cancel:e}}}const vT=fd;function bT(n){return function(e){return n.apply(null,e)}}function wT(n){return Q.isObject(n)&&n.isAxiosError===!0}const Du={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Du).forEach(([n,e])=>{Du[e]=n});const kT=Du;function Mv(n){const e=new pa(n),t=_v(pa.prototype.request,e);return Q.extend(t,pa.prototype,e,{allOwnKeys:!0}),Q.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return Mv(Wi(n,r))},t}const wt=Mv(hd);wt.Axios=pa;wt.CanceledError=fs;wt.CancelToken=vT;wt.isCancel=Uv;wt.VERSION=Vv;wt.toFormData=kc;wt.AxiosError=qe;wt.Cancel=wt.CanceledError;wt.all=function(n){return Promise.all(n)};wt.spread=bT;wt.isAxiosError=wT;wt.mergeConfig=Wi;wt.AxiosHeaders=pr;wt.formToJSON=n=>Dv(Q.isHTMLForm(n)?new FormData(n):n);wt.HttpStatusCode=kT;wt.default=wt;const xT=wt,Lp={init:({API_KEY:n})=>(...e)=>F(void 0,[...e],function*(t="post",r="/",i={},o={}){var s,a,c,l;const u=localStorage.getItem("accessToken");let h={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};u&&(h.Authorization="Bearer "+u);const y=r;o!=null&&o.headers&&(h=Object.assign(...h,...o.headers),delete o.headers);const d=Object.assign({mode:"cors",method:t,url:y,data:i,headers:h},o);let f={};try{const p=yield xT(d);f.data=((s=p==null?void 0:p.data)==null?void 0:s.data)||(p==null?void 0:p.data),p!=null&&p.error&&(f.error=p.error),f.data||(f.data={})}catch(p){f.error=((c=(a=p.response)==null?void 0:a.data)==null?void 0:c.error)||((l=p.response)==null?void 0:l.error),f.error||(f.error={})}return f})};let Ls;const ET=new Uint8Array(16);function _T(){if(!Ls&&(Ls=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ls))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ls(ET)}const Ct=[];for(let n=0;n<256;++n)Ct.push((n+256).toString(16).slice(1));function $T(n,e=0){return(Ct[n[e+0]]+Ct[n[e+1]]+Ct[n[e+2]]+Ct[n[e+3]]+"-"+Ct[n[e+4]]+Ct[n[e+5]]+"-"+Ct[n[e+6]]+Ct[n[e+7]]+"-"+Ct[n[e+8]]+Ct[n[e+9]]+"-"+Ct[n[e+10]]+Ct[n[e+11]]+Ct[n[e+12]]+Ct[n[e+13]]+Ct[n[e+14]]+Ct[n[e+15]]).toLowerCase()}const OT=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Dp={randomUUID:OT};function _l(n,e,t){if(Dp.randomUUID&&!e&&!n)return Dp.randomUUID();n=n||{};const r=n.random||(n.rng||_T)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return $T(r)}var Fv={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function o(c,l,u,h,y){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new i(u,h||c,y),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],d]:c._events[f].push(d):(c._events[f]=d,c._eventsCount++),c}function s(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],l,u;if(this._eventsCount===0)return c;for(u in l=this._events)e.call(l,u)&&c.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},a.prototype.listeners=function(c){var l=t?t+c:c,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,y=u.length,d=new Array(y);h<y;h++)d[h]=u[h].fn;return d},a.prototype.listenerCount=function(c){var l=t?t+c:c,u=this._events[l];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,l,u,h,y,d){var f=t?t+c:c;if(!this._events[f])return!1;var p=this._events[f],v=arguments.length,w,S;if(p.fn){switch(p.once&&this.removeListener(c,p.fn,void 0,!0),v){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,l),!0;case 3:return p.fn.call(p.context,l,u),!0;case 4:return p.fn.call(p.context,l,u,h),!0;case 5:return p.fn.call(p.context,l,u,h,y),!0;case 6:return p.fn.call(p.context,l,u,h,y,d),!0}for(S=1,w=new Array(v-1);S<v;S++)w[S-1]=arguments[S];p.fn.apply(p.context,w)}else{var R=p.length,j;for(S=0;S<R;S++)switch(p[S].once&&this.removeListener(c,p[S].fn,void 0,!0),v){case 1:p[S].fn.call(p[S].context);break;case 2:p[S].fn.call(p[S].context,l);break;case 3:p[S].fn.call(p[S].context,l,u);break;case 4:p[S].fn.call(p[S].context,l,u,h);break;default:if(!w)for(j=1,w=new Array(v-1);j<v;j++)w[j-1]=arguments[j];p[S].fn.apply(p[S].context,w)}}return!0},a.prototype.on=function(c,l,u){return o(this,c,l,u,!1)},a.prototype.once=function(c,l,u){return o(this,c,l,u,!0)},a.prototype.removeListener=function(c,l,u,h){var y=t?t+c:c;if(!this._events[y])return this;if(!l)return s(this,y),this;var d=this._events[y];if(d.fn)d.fn===l&&(!h||d.once)&&(!u||d.context===u)&&s(this,y);else{for(var f=0,p=[],v=d.length;f<v;f++)(d[f].fn!==l||h&&!d[f].once||u&&d[f].context!==u)&&p.push(d[f]);p.length?this._events[y]=p.length===1?p[0]:p:s(this,y)}return this},a.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&s(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(Fv);const AT=Fv.exports;var ST={exports:{}};(function(n,e){(function(t){var r=this,i=Object.prototype.hasOwnProperty,o=function(c){for(var l=new Array(c.length),u=c.length,h=u-1;u--;)l[h-u]=c[u];return l},s=function(){var c=Array.prototype.slice.call(arguments);return c.length==2?s.find.apply(this,c):s.transform.apply(this,c)};s.find=function(c,l){return s.get(l,c)},s.memoizePath=!0;var a={};s.get=function(c,l,u){if(c===t||c===null||l===t||l===null)return u;var h;for(typeof l=="string"?s.memoizePath?a[l]?h=a[l].slice(0):(h=l.split(".").reverse(),a[l]=h.slice(0)):h=l.split(".").reverse():Array.isArray(l)&&(h=o(l));h.length&&(c=c[h.pop()])!==t&&c!==null;);return c===null&&h.length&&(c=t),c===t?u:c},s.exists=function(c,l){return s.get(c,l)!==t},s.set=function(c,l,u,h){var y=Array.isArray(l)?l:l.split("."),d=c,f,p=y.length;if(typeof d!="object")throw new Error("Parent is not an object.");for(var v=0;v<p;v++)if(f=y[v],(!i.call(d,f)||d[f]===t||(typeof d[f]!="object"||d[f]===null)&&h&&h.force===!0)&&(d[f]={}),v==p-1)d[f]=u;else{if(typeof d[f]!="object"||d[f]===null)throw new Error('Target key "'+f+'" is not suitable for a nested value. (It is in use as non-object. Set `force` to `true` to override.)');d=d[f]}d[f]=u},s.default=function(c,l,u){s.get(c,l)===t&&s.set(c,l,u)},s.transform=function(c,l){if(Array.isArray(c))return c.map(function(j){return s.transform(j,l)});l=l||{},l.delimiter=l.delimiter||".";var u,h,y,d,f={},p,v=Object.keys(c),w=v.length,S;for(S=0;S<w;S++)if(p=v[S],p.indexOf(l.delimiter)!==-1){u=p.split(l.delimiter),h=u.length,d=f;for(var R=0;R<h&&(y=u[R],R!=h-1&&!d.hasOwnProperty(y)&&(d[y]={}),R==h-1&&(d[y]=c[p]),d=d[y],d!==null);R++);}else f[p]=c[p];return f},s.flatten=function(c,l){typeof l=="undefined"&&(l=".");var u={},h,y;for(var d in c)if(i.call(c,d))if(h=c[d],Object.prototype.toString.call(h)==="[object Object]"){y=s.flatten(h,l);for(var f in y)u[d+l+f]=y[f]}else u[d]=h;return u},s.paths=function(c,l){var u=[],h,y;if(l=l||[],typeof c=="object")for(y in c)h=c[y],typeof h=="object"&&h!==null?u=u.concat(s.paths(h,l.concat([y]))):u.push(l.concat(y).join("."));else throw new Error("Paths was called with non-object argument.");return u},n.exports?n.exports=s:(r.Dottie=s,r.Dot=s,typeof t=="function"&&t([],function(){return s}))})()})(ST);function $l(n,e){try{n(e)}catch(t){console.error("Error in subscription callback",t)}}const Pr=Symbol("subscriptions"),jr=Symbol("oneTimeEvents");class zi{constructor(){this[Pr]=[],this[jr]=new Map}on(e,t){return this[jr].has(e)?$l(t,this[jr].get(e)):(this[Pr].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[Pr]=this[Pr].filter(r=>r.event!==e||t&&r.callback!==t),this}once(e,t){return new Promise(r=>{const i=o=>{r(o),t==null||t(o)};this[jr].has(e)?$l(i,this[jr].get(e)):this[Pr].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[jr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let r=0;r<this[Pr].length;r++){const i=this[Pr][r];i.event===e&&($l(i.callback,t),i.once&&(this[Pr].splice(r,1),r--))}return this}emitOnce(e,t){if(this[jr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[jr].set(e,t),this.off(e),this}pipe(e,t){this.on(e,r=>{t.emit(e,r)})}pipeOnce(e,t){this.once(e,r=>{t.emitOnce(e,r)})}}function Cr(n){return n=n.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),n.length===0?[]:n.split("/").map(e=>e.startsWith("[")?parseInt(e.slice(1,-1)):e)}class J{static get(e){return new J(e)}static getChildPath(e,t){return J.get(e).child(t).path}static getPathKeys(e){return Cr(e)}constructor(e){typeof e=="string"?this.keys=Cr(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,r,i)=>i===0?`${r}`:typeof r=="string"?`${t}/${r}`:`${t}[${r}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new J(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=Cr(e);t.forEach(r=>{if(typeof r=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(r))throw new Error(`Invalid child key "${r}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(r.length>128)throw new Error(`child key "${r}" for path "${this.path}" is too long. Max key length is 128`);if(r.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new J(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const r=Cr(e),i=Cr(t);let o=0;const s={get length(){return o}};return r.forEach((a,c)=>{const l=i[c];if(a==="*")s[o++]=l;else if(typeof a=="string"&&a[0]==="$"){s[o++]=l,s[a]=l;const u=a.slice(1);typeof s[u]=="undefined"&&(s[u]=l)}}),s}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const r=Cr(e),i=Cr(t),o=r.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let s="";return o.forEach(a=>{typeof a=="number"?s+=`[${a}]`:(s.length>0&&(s+="/"),s+=a)}),s}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const r=Cr(e);let i=0;return r.reduce((o,s)=>typeof s=="string"&&(s==="*"||s.startsWith("$"))?J.getChildPath(o,t[i++]):J.getChildPath(o,s),"")}equals(e){const t=e instanceof J?e:new J(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isAncestorOf(e){const t=e instanceof J?e:new J(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isDescendantOf(e){const t=e instanceof J?e:new J(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((r,i)=>{const o=this.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isOnTrailOf(e){const t=e instanceof J?e:new J(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((r,i)=>{if(i>=t.keys.length)return!0;const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isChildOf(e){const t=e instanceof J?e:new J(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof J?e:new J(e);return t.path===""?!1:this.equals(t.parent)}}function Ol(n,e,t=!1){if(!n.exists())return null;let r=t?n.previous():n.val();return typeof e=="number"?r[e]:(J.getPathKeys(e).every(i=>(r=r[i],typeof r!="undefined")),r||null)}function Al(n){if(!n.exists())return[];const e=n.val();return e instanceof Array?new Array(e.length).map((t,r)=>r):typeof e=="object"?Object.keys(e):[]}class tt{exists(){return!1}constructor(e,t,r=!1,i,o){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>r?!1:t!==null&&typeof t!="undefined",this.context=()=>o||{}}static for(e,t){return new tt(e,t)}child(e){const t=Ol(this,e,!1),r=Ol(this,e,!0);return new tt(this.ref.child(e),t,!1,r)}hasChild(e){return Ol(this,e)!==null}hasChildren(){return Al(this).length>0}numChildren(){return Al(this).length}forEach(e){const t=this.val(),r=this.previous();return Al(this).every(i=>{const o=new tt(this.ref.child(i),t[i],!1,r[i]);return e(o)})}get key(){return this.ref.key}}class ya extends tt{constructor(e,t,r){super(e,t,!1,void 0,r),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(t=>{const r=t.target.reduce((o,s)=>o.child(s),this.ref),i=new tt(r,t.val,!1,t.prev);return e(i)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],r=t.target.reduce((i,o)=>i.child(o),this.ref);return new tt(r,t.val,!1,t.prev)}}class Wv{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,r)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return r(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:r})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const r=this._internal.activatePromises.shift();e?(r.callback&&r.callback(!0),r.resolve&&r.resolve()):(r.callback&&r.callback(!1,t),r.reject&&r.reject(t))}}}class TT{constructor(e,t,r){this.publish=e,this.start=t,this.cancel=r}}class PT{constructor(e){const t=[];let r,i;const o="stopped (no more subscribers)";this.subscribe=(h,y)=>{if(typeof h!="function")throw new TypeError("callback must be a function");if(i===o)throw new Error("stream can't be used anymore because all subscribers were stopped");const d={callback:h,activationCallback:function(f,p){y==null||y(f,p),this.subscription._setActivationState(f,p)},subscription:new Wv(function(){return t.splice(t.indexOf(this),1),s()})};return t.push(d),typeof i!="undefined"&&(i===!0?(y==null||y(!0),d.subscription._setActivationState(!0)):typeof i=="string"&&(y==null||y(!1,i),d.subscription._setActivationState(!1,i))),d.subscription};const s=()=>{let h;return t.length===0&&(h=r==null?void 0:r(),i=o),Promise.resolve(h)};this.unsubscribe=h=>{(h?t.filter(y=>y.callback===h):t).forEach(y=>{const d=t.indexOf(y);t.splice(d,1)}),s()},this.stop=()=>{t.splice(0),s()};const a=h=>(t.forEach(y=>{try{y.callback(h)}catch(d){console.error(`Error running subscriber callback: ${d.message}`)}}),t.length===0&&s(),t.length>0),c=h=>{i=!0,r=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!0)})},l=h=>{i=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!1,h||new Error("unknown reason"))}),t.splice(0)},u=new TT(a,c,l);e(u)}}function pd(n,e){const t="000000000"+n;return t.substr(t.length-e)}const jT=typeof window=="object"?window:self,CT=Object.keys(jT).length;var Up,qp;const RT=(qp=(Up=navigator.mimeTypes)==null?void 0:Up.length)!=null?qp:0,IT=pd((RT+navigator.userAgent.length).toString(36)+CT.toString(36),4);function NT(){return IT}let mo=0;const yd=4,Ma=36,zv=Math.pow(Ma,yd);function Vp(){return pd((Math.random()*zv<<0).toString(Ma),yd)}function BT(){return mo=mo<zv?mo:0,mo++,mo-1}function LT(n=0){const e="c",t=(new Date().getTime()+n).toString(Ma),r=pd(BT().toString(Ma),yd),i=NT(),o=Vp()+Vp();return e+t+r+i+o}let Mp=0;class Bt{static set timeBias(e){typeof e=="number"&&(Mp=e)}static generate(){return LT(Mp).slice(1)}}class nt{constructor(e){this.path=e}}const wn={nextTick(n){setTimeout(n,0)}};class Fa{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function DT(n){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,n),new Array(...e)}function UT(n){if((Array.isArray(n)?n.length:n.byteLength)!==8)throw new TypeError("must be 8 bytes");const e=new Uint8Array(n);return new DataView(e.buffer).getFloat64(0)}const Vr={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function qT(n){if(typeof n!="bigint")throw new Error("number must be a bigint");const e=[],t=n<Vr.zero;do{const r=Number(n&Vr.ff);e.push(r),n=n>>Vr.eight}while(n!==(t?-Vr.one:Vr.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function VT(n){const e=n[0]>=128;let t=Vr.zero;for(let r of n)e&&(r=~r&255),t=(t<<Vr.eight)+BigInt(r);return e&&(t=-(t+Vr.one)),t}function MT(n){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(n);if(typeof Buffer=="function"){const e=Buffer.from(n,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r>128){if((r&55296)===55296){const i=n.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const o=r&1023,s=i&1023;r=65536|o<<10|s}if(r<2048){const i=192|r>>6&31,o=128|r&63;e.push(i,o)}else if(r<65536){const i=224|r>>12&15,o=128|r>>6&63,s=128|r&63;e.push(i,o,s)}else if(r<2097152){const i=240|r>>18&7,o=128|r>>12&63,s=128|r>>6&63,a=128|r&63;e.push(i,o,s,a)}else throw new Error(`Cannot convert character ${n.charAt(t)} (code ${r}) to utf-8`)}else e.push(r<128?r:63)}return new Uint8Array(e)}}function Kv(n){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(n instanceof Uint8Array)return e.decode(n);const t=Uint8Array.from(n);return e.decode(t)}else if(typeof Buffer=="function"){if(n instanceof Array&&(n=Uint8Array.from(n)),!(n instanceof Buffer)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(n instanceof Buffer))throw new Error("Unsupported buffer argument");return n.toString("utf-8")}else{if(!(n instanceof Uint8Array)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(n instanceof Buffer||n instanceof Array||n instanceof Uint8Array){let e="";for(let t=0;t<n.length;t++){let r=n[t];if(r>128)if((r&240)===240){const i=r,o=n[t+1],s=n[t+2],a=n[t+3];r=(i&7)<<18|(o&63)<<12|(s&63)<<6|a&63,t+=3}else if((r&224)===224){const i=r,o=n[t+1],s=n[t+2];r=(i&15)<<12|(o&63)<<6|s&63,t+=2}else if((r&192)===192){const i=r,o=n[t+1];r=(i&31)<<6|o&63,t++}else throw new Error("invalid utf-8 data");if(r>=65536){r^=65536;const i=55296|r>>10,o=56320|r&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(o)}else e+=String.fromCharCode(r)}return e}else throw new Error("Unsupported buffer argument")}}function FT(n,e){const t=new n.constructor(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Ln(n,e){var t;if(((t=n==null?void 0:n.constructor)==null?void 0:t.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${n.ref.path}")`);const r=s=>(s!==null&&typeof s=="object"&&typeof s.constructor=="function"&&typeof s.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(s.constructor.name)&&(s=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)),s);if(n=r(n),typeof n!="object"||n===null||n instanceof Date||n instanceof ArrayBuffer||n instanceof nt||n instanceof RegExp)return n;const i=s=>{if(e.indexOf(s)>=0)throw new ReferenceError("object contains a circular reference");return s=r(s),s===null||s instanceof Date||s instanceof ArrayBuffer||s instanceof nt||s instanceof RegExp||typeof s=="object"&&(e.push(s),s=Ln(s,e),e.pop()),s};typeof e=="undefined"&&(e=[n]);const o=n instanceof Array?[]:n instanceof Fa?new Fa:{};return Object.keys(n).forEach(s=>{const a=n[s];typeof a!="function"&&(o[s]=i(a))}),o}const zr=n=>typeof n=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(n.constructor.name);function Wa(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="object"||typeof e=="object"){if(n===null||e===null)return!1;if(n instanceof nt||e instanceof nt)return n instanceof nt&&e instanceof nt&&n.path===e.path;if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime();if(n instanceof Array||e instanceof Array)return n instanceof Array&&e instanceof Array&&n.length===e.length&&n.every((i,o)=>Wa(n[o],e[o]));if(zr(n)||zr(e)){if(!zr(n)||!zr(e)||n.byteLength===e.byteLength)return!1;const i=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((s,a)=>o[a]===s)}const t=Object.keys(n),r=Object.keys(e);return t.length===r.length&&t.every(i=>r.includes(i))&&t.every(i=>Wa(n[i],e[i]))}return!1}class Hv{constructor(e,t,r){this.added=e,this.removed=t,this.changed=r}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(r=>r.key===e);return t?t.change:"identical"}}function gd(n,e,t=!1){const r=[void 0,null];if(n===e)return"identical";if(r.indexOf(n)>=0&&r.indexOf(e)<0)return"added";if(r.indexOf(n)<0&&r.indexOf(e)>=0)return"removed";if(typeof n!=typeof e)return"changed";if(zr(n)||zr(e)){if(!zr(n)||!zr(e))return"changed";const i=n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===o.byteLength&&i.every((s,a)=>o[a]===s)?"identical":"changed"}else{if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime()?"identical":"changed";if(n instanceof nt||e instanceof nt)return n instanceof nt&&e instanceof nt&&n.path===e.path?"identical":"changed";if(typeof n=="object"){const i=n instanceof Array,o=h=>{let y=Object.keys(h).filter(d=>!r.includes(h[d]));return i&&(y=y.map(d=>parseInt(d))),y},s=o(n),a=o(e),c=s.filter(h=>!a.includes(h)),l=a.filter(h=>!s.includes(h)),u=a.reduce((h,y)=>{if(s.includes(y)){const d=n[y],f=e[y],p=gd(d,f);p!=="identical"&&h.push({key:y,change:p})}return h},[]);return l.length===0&&c.length===0&&u.length===0?"identical":new Hv(l,c,t?u.sort((h,y)=>h.key<y.key?-1:1):u)}}return"changed"}function Jv(n,e,t=!1){const r=(o,s,a,c)=>{switch(s){case"identical":return[];case"changed":return[{target:o,prev:a,val:c}];case"added":return[{target:o,prev:null,val:c}];case"removed":return[{target:o,prev:a,val:null}];default:{let l=[];return s.added.forEach(u=>l.push({target:o.concat(u),prev:null,val:c[u]})),s.removed.forEach(u=>l.push({target:o.concat(u),prev:a[u],val:null})),s.changed.forEach(u=>{const h=r(o.concat(u.key),u.change,a[u.key],c[u.key]);l=l.concat(h)}),l}}},i=gd(n,e,t);return r([],i,n,e)}function WT(n,e,t){return e=e===null?null:e[n],typeof e=="undefined"&&(e=null),t=t===null?null:t[n],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function zT(n){wn.nextTick(n)}function Yv(){var n;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(n=function(){return this}())!=null?n:Function("return this")()}const Gv=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:DT,bytesToNumber:UT,bigintToBytes:qT,bytesToBigint:VT,encodeString:MT,decodeString:Kv,concatTypedArrays:FT,cloneObject:Ln,valuesAreEqual:Wa,ObjectDifferences:Hv,compareValues:gd,getMutations:Jv,getChildValues:WT,defer:zT,getGlobalObject:Yv},Symbol.toStringTag,{value:"Module"})),KT="modulepreload",HT=function(n){return"/"+n},Fp={},JT=function(n,e,t){if(!e||e.length===0)return n();const r=document.getElementsByTagName("link");return Promise.all(e.map(i=>{if(i=HT(i),i in Fp)return;Fp[i]=!0;const o=i.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(t)for(let c=r.length-1;c>=0;c--){const l=r[c];if(l.href===i&&(!o||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${s}`))return;const a=document.createElement("link");if(a.rel=o?"stylesheet":KT,o||(a.as="script",a.crossOrigin=""),a.href=i,document.head.appendChild(a),o)return new Promise((c,l)=>{a.addEventListener("load",c),a.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>n())};let Xv=!1,Jr;F(void 0,null,function*(){const n=Yv();if(typeof n.Observable!="undefined"){Jr=n.Observable;return}try{const{Observable:e}=yield JT(()=>Promise.resolve().then(()=>KR),void 0);Jr=e}catch(e){Jr=vd}});function md(){if(Jr===vd&&!Xv&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),Jr)return Jr;throw new Error("RxJS Observable could not be loaded. ")}function YT(n){n==="shim"?(Jr=vd,Xv=!0):Jr=n}class vd{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const t={next:r=>{this._subscribers.forEach(i=>{try{i(r)}catch(o){console.error("Error in subscriber callback:",o)}})}};this._cleanup=this._create(t),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class hn extends Array{static areEqual(e,t){return e.length===t.length&&e.every((r,i)=>t[i]===r)}static isAncestor(e,t){return e.length<t.length&&e.every((r,i)=>t[i]===r)}static isDescendant(e,t){return e.length>t.length&&t.every((r,i)=>e[i]===r)}}const ci=Symbol("isProxy");class GT{static create(e,t){return F(this,null,function*(){var r;e=new Vn(e.db,e.path);let i,o=!1,s=t==null?void 0:t.cursor,a;const c=Bt.generate(),l=[],u=new zi;u.on("cursor",g=>s=g),u.on("error",g=>{console.error(g.message,g.details)});const h=(g,b)=>{if(g.length===0)return i=b,!0;let m=i;const x=g.slice();for(;x.length>1;){const k=x.shift();if(!(k in m))return!1;m=m[k]}const O=x.shift();return b===null?m instanceof Array?m.splice(O,1):delete m[O]:m[O]=b,!0},y=()=>F(this,null,function*(){!o||(yield E())}),d=e.on("mutations",{syncFallback:y}).subscribe(g=>F(this,null,function*(){var b;if(!o)return;const m=g.context(),x=((b=m.acebase_proxy)==null?void 0:b.id)!==c;!x||(g.val(!1).every(O=>{if(!h(O.target,O.val))return!1;const k=O.target.reduce((_,A)=>_.child(A),e),$=new tt(k,O.val,!1,O.prev,g.context());return u.emit("mutation",{snapshot:$,isRemote:x}),!0})?(u.emit("cursor",m.acebase_cursor),P.emit("mutations",{origin:"remote",snap:g})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield E()))}));let f=Promise.resolve();const p=[],v=[],w=()=>F(this,null,function*(){const g=[];for(let b=0,m=p[0];b<p.length;b++,m=p[b])v.find(x=>hn.areEqual(x.target,m.target)||hn.isAncestor(x.target,m.target))||(p.splice(b,1),b--,g.push(m));g.length!==0&&(g.forEach(b=>{b.value=Ln(gn(i,b.target))}),wn.nextTick(()=>{const b={acebase_proxy:{id:c,source:"update"}};g.forEach(x=>{const O=x.target.reduce(($,_)=>$.child(_),e),k=new tt(O,x.value,!1,x.previous,b);u.emit("mutation",{snapshot:k,isRemote:!1})});const m=new ya(e,g.map(x=>({target:x.target,val:x.value,prev:x.previous})),b);P.emit("mutations",{origin:"local",snap:m})}),f=g.reduce((b,m,x,O)=>(O.some(k=>hn.isAncestor(k.target,m.target))||b.push(m),b),[]).reduce((b,m)=>{const x=m.target;if(x.length===0)b.push({ref:e,target:x,value:i,type:"set",previous:m.previous});else{const O=x.slice(0,-1),k=x.slice(-1)[0],$=O.reduce((C,L)=>C.child(L),e),_=b.find(C=>C.ref.path===$.path),A=gn(i,x),T=m.previous;_?(_.value[k]=A,_.previous[k]=T):b.push({ref:$,target:O,value:{[k]:A},type:"update",previous:{[k]:T}})}return b},[]).reduce((b,m)=>F(this,null,function*(){const x={acebase_proxy:{id:c,source:m.type}};yield b,yield m.ref.context(x)[m.type](m.value).catch(O=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:O});const k={acebase_proxy:{id:c,source:"update-rollback"}},$=[];if(m.type==="set"){Sl(i,m.target,m.previous);const A=new tt(m.ref,m.previous,!1,m.value,k);u.emit("mutation",{snapshot:A,isRemote:!1}),$.push({target:m.target,val:m.previous,prev:m.value})}else Object.keys(m.previous).forEach(A=>{Sl(i,m.target.concat(A),m.previous[A]);const T=new tt(m.ref.child(A),m.previous[A],!1,m.value[A],k);u.emit("mutation",{snapshot:T,isRemote:!1}),$.push({target:m.target.concat(A),val:m.previous[A],prev:m.value[A]})});$.forEach(A=>{const T=A.target.reduce((L,V)=>L.child(V),e),C=new tt(T,A.val,!1,A.prev,k);u.emit("mutation",{snapshot:C,isRemote:!1})});const _=new ya(m.ref,$,k);P.emit("mutations",{origin:"local",snap:_})}),m.ref.cursor&&u.emit("cursor",m.ref.cursor)}),f),yield f)});let S=!1;const R=[],j=()=>{let g;const b=new Promise(m=>g=m);return R.push({resolve:g}),b};let N=null;const D=()=>{N||(N=setTimeout(()=>F(this,null,function*(){S=!0,N=null,yield w(),S=!1,R.splice(0).forEach(g=>g.resolve())}),0))},q=g=>{p.find(b=>hn.areEqual(b.target,g))||p.push({target:g,previous:Ln(gn(i,g))}),D()},P=new zi,I=(g,b)=>{const m=k=>k!==null&&typeof k=="object",x=k=>F(this,null,function*(){var $;const{snap:_,origin:A}=k,T=_.context(),C=(($=T.acebase_proxy)==null?void 0:$.id)===c;if(k.origin==="remote"&&C){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const L=_.val(!1).filter(ie=>ie.target.slice(0,g.length).every((ee,fe)=>g[fe]===ee));if(L.length===0)return;let V,K;const G=L.find(ie=>ie.target.length<=g.length);if(G){const ie=g.slice(G.target.length);V=ie.reduce((ee,fe)=>!m(ee)||!(fe in ee)?null:ee[fe],G.val),K=ie.reduce((ee,fe)=>!m(ee)||!(fe in ee)?null:ee[fe],G.prev)}else{const ie=gn(i,g);V=Ln(ie),K=Ln(V),L.forEach(ee=>{const fe=ee.target.slice(g.length);for(let de=0,ne=V,ce=K;de<fe.length;de++){const Me=de+1===fe.length,ve=fe[de];Me?(ne[ve]=ee.val,ne[ve]===null&&delete ne[ve],ce[ve]=ee.prev,ce[ve]===null&&delete ce[ve]):(ne=ne[ve]=ve in ne?ne[ve]:{},ce=ce[ve]=ve in ce?ce[ve]:{})}})}wn.nextTick(()=>{let ie=!0;try{ie=b(Object.freeze(V),Object.freeze(K),!C,T)!==!1}catch(ee){u.emit("error",{source:A==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:ee})}ie===!1&&O()})});P.on("mutations",x);const O=()=>{P.off("mutations",x),l.splice(l.findIndex(k=>k.stop===O),1)};return l.push({target:g,stop:O}),{stop:O}},B=(g,b,m)=>{if(g==="write")return q(b);if(g==="onChange")return I(b,m.callback);if(g==="subscribe"||g==="observe"){const x=k=>{const $=gn(i,b);k.next($);const _=I(b,A=>{k.next(A)});return function(){_.stop()}};if(g==="subscribe")return x;const O=md();return new O(x)}else if(g==="transaction")return v.some(x=>hn.areEqual(b,x.target)||hn.isAncestor(b,x.target)||hn.isDescendant(b,x.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(x=>F(this,null,function*(){p.some(k=>hn.areEqual(b,k.target)||hn.isAncestor(b,k.target))&&(S||D(),yield j());const O={target:b,status:"started",transaction:null};v.push(O),O.transaction={get status(){return O.status},get completed(){return O.status!=="started"},get mutations(){return p.filter(k=>hn.areEqual(O.target,k.target)||hn.isAncestor(O.target,k.target))},get hasMutations(){return this.mutations.length>0},commit(){return F(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${O.status}')`);O.status="finished",v.splice(v.indexOf(O),1),S&&(yield j()),D(),yield j()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${O.status}')`);O.status="canceled";const k=[];for(let $=0;$<p.length;$++){const _=p[$];(hn.areEqual(O.target,_.target)||hn.isAncestor(O.target,_.target))&&(p.splice($,1),$--,k.push(_))}k.reverse().forEach($=>{$.target.length===0?i=$.previous:Sl(i,$.target,$.previous)}),v.splice(v.indexOf(O),1)}},x(O.transaction)}))},U=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(U.context().acebase_origin!=="cache"&&u.emit("cursor",(r=e.cursor)!=null?r:null),o=!0,i=U.val(),i===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){i=t.defaultValue;const g={acebase_proxy:{id:c,source:"default"}};yield e.context(g).set(i)}a=Qv({root:{ref:e,get cache(){return i}},target:[],id:c,flag:B});const M=()=>{if(a===null)throw new Error("Proxy was destroyed")},E=()=>F(this,null,function*(){M(),p.splice(0);const g=yield e.get({allow_cache:!1}),b=i,m=g.val();i=m;const x=Jv(b,m);if(x.length===0)return;const O=g.context();O.acebase_proxy={id:c,source:"reload"},x.forEach($=>{const _=Uu(e,$.target),A=new tt(_,$.val,$.val===null,$.prev,O);u.emit("mutation",{snapshot:A,isRemote:!0})});const k=new ya(e,x,O);P.emit("mutations",{origin:"local",snap:k})});return{destroy(){return F(this,null,function*(){yield f;const g=[d.stop(),...l.map(b=>b.stop())];yield Promise.all(g),["cursor","mutation","error"].forEach(b=>u.off(b)),i=null,a=null})},stop(){this.destroy()},get value(){return M(),a},get hasValue(){return M(),i!==null},set value(g){M(),g!==null&&typeof g=="object"&&g[ci]&&(g=g.valueOf()),q([]),i=g},get ref(){return e},get cursor(){return s},reload:E,onMutation(g){M(),u.off("mutation"),u.on("mutation",({snapshot:b,isRemote:m})=>{try{g(b,m)}catch(x){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:x})}})},onError(g){M(),u.off("error"),u.on("error",b=>{try{g(b)}catch(m){console.error(`Error in dataproxy onError callback: ${m.message}`)}})},on(g,b){u.on(g,b)},off(g,b){u.off(g,b)}}})}}function gn(n,e){let t=n;for(const r of e)t=typeof t=="object"&&t!==null&&r in t?t[r]:null;return t}function Sl(n,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const r=e.slice(0,-1).reduce((o,s)=>o[s],n),i=e.slice(-1)[0];t===null||typeof t=="undefined"?r instanceof Array?r.splice(i,1):delete r[i]:r[i]=t}function Uu(n,e){const t=J.get(n.path).childPath(e);return new Vn(n.db,t)}function Qv(n){const e=Uu(n.root.ref,n.target),t=[],r={get(o,s,a){if(o=gn(n.root.cache,n.target),typeof s=="symbol")if(s.toString()===Symbol.iterator.toString())s="values";else return s.toString()===ci.toString()?!0:Reflect.get(o,s,a);if(s==="valueOf")return function(){return o};if(o===null||typeof o!="object")throw new Error(`Cannot read property "${s}" of ${o}. Value of path "/${e.path}" is not an object (anymore)`);o instanceof Array&&typeof s=="string"&&/^[0-9]+$/.test(s)&&(s=parseInt(s));const c=o[s];if(c===null){delete o[s];return}const l=t.find(d=>d.prop===s);if(l){if(l.typeof===typeof c)return l.value;t.splice(t.indexOf(l),1)}const u=d=>{const f=o[d],p=t.find(w=>w.prop===d);if(p){if(p.typeof===typeof f)return p.value;t.splice(t.indexOf(p),1)}if(typeof f!="object")return f;const v=Qv({root:n.root,target:n.target.concat(d),id:n.id,flag:n.flag});return t.push({typeof:typeof f,prop:d,value:v}),v},h=d=>d!==null&&typeof d=="object"&&d[ci]?d.getTarget():d;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof nt||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const y=o instanceof Array;if(s==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return s==="push"?function(d){const f=e.push();return n.flag("write",n.target.concat(f.key)),o[f.key]=d,f.key}:s==="getTarget"?function(d=!0){return d&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),o}:s==="getRef"?function(){return Uu(n.root.ref,n.target)}:s==="forEach"?function(d){const f=Object.keys(o);let p=!1;for(let v=0;!p&&v<f.length;v++){const w=f[v],S=u(w);p=d(S,w,v)===!1}}:["values","entries","keys"].includes(s)?function*(){const d=Object.keys(o);for(const f of d)if(s==="keys")yield f;else{const p=u(f);s==="entries"?yield[f,p]:yield p}}:s==="toArray"?function(d){const f=Object.keys(o).map(p=>u(p));return d&&f.sort(d),f}:s==="onChanged"?function(d){return n.flag("onChange",n.target,{callback:d})}:s==="subscribe"?function(){return n.flag("subscribe",n.target)}:s==="getObservable"?function(){return n.flag("observe",n.target)}:s==="getOrderedCollection"?function(d,f){return new XT(this,d,f)}:s==="startTransaction"?function(){return n.flag("transaction",n.target)}:s==="remove"&&!y?function(){if(n.target.length===0)throw new Error("Can't remove proxy root value");const d=gn(n.root.cache,n.target.slice(0,-1)),f=n.target.slice(-1)[0];n.flag("write",n.target),delete d[f]}:void 0;if(typeof c=="function"){if(y){const d=p=>(n.flag("write",n.target),p()),f=p=>p.map(v=>(v=h(v),qu(v),v));if(s==="push")return function(...p){return p=f(p),d(()=>o.push(...p))};if(s==="pop")return function(){return d(()=>o.pop())};if(s==="splice")return function(p,v,...w){return w=f(w),d(()=>o.splice(p,v,...w))};if(s==="shift")return function(){return d(()=>o.shift())};if(s==="unshift")return function(...p){return p=f(p),d(()=>o.unshift(...p))};if(s==="sort")return function(p){return d(()=>o.sort(p))};if(s==="reverse")return function(){return d(()=>o.reverse())};if(["indexOf","lastIndexOf"].includes(s))return function(p,v){return p!==null&&typeof p=="object"&&p[ci]&&(p=p.getTarget(!1)),o[s](p,v)};if(["forEach","every","some","filter","map"].includes(s))return function(p){return o[s]((v,w)=>p(u(w),w,i))};if(["reduce","reduceRight"].includes(s))return function(p,v){return o[s]((w,S,R)=>p(w,u(R),R,i),v)};if(["find","findIndex"].includes(s))return function(p){let v=o[s]((w,S)=>p(u(S),S,i));if(s==="find"&&v){const w=o.indexOf(v);v=u(w)}return v};if(["values","entries","keys"].includes(s))return function*(){for(let p=0;p<o.length;p++)if(s==="keys")yield p;else{const v=u(p);s==="entries"?yield[p,v]:yield v}}}return c}return u(s)},set(o,s,a,c){if(o=gn(n.root.cache,n.target),typeof s=="symbol")return Reflect.set(o,s,a,c);if(o===null||typeof o!="object")throw new Error(`Cannot set property "${s}" of ${o}. Value of path "/${e.path}" is not an object`);if(o instanceof Array&&typeof s=="string"){if(!/^[0-9]+$/.test(s))throw new Error(`Cannot set property "${s}" on array value of path "/${e.path}"`);s=parseInt(s)}return a!==null&&(typeof a=="object"&&(a[ci]&&(a=a.valueOf()),a=Ln(a)),Wa(a,o[s]))||(n.target.some(l=>typeof l=="number")?n.flag("write",n.target.slice(0,n.target.findIndex(l=>typeof l=="number"))):o instanceof Array?n.flag("write",n.target):n.flag("write",n.target.concat(s)),a===null?delete o[s]:(qu(a),o[s]=a)),!0},deleteProperty(o,s){if(o=gn(n.root.cache,n.target),o===null)throw new Error(`Cannot delete property ${s.toString()} of null`);return typeof s=="symbol"?Reflect.deleteProperty(o,s):(s in o&&(n.flag("write",n.target.concat(s)),delete o[s]),!0)},ownKeys(o){return o=gn(n.root.cache,n.target),Reflect.ownKeys(o)},has(o,s){return o=gn(n.root.cache,n.target),Reflect.has(o,s)},getOwnPropertyDescriptor(o,s){o=gn(n.root.cache,n.target);const a=Reflect.getOwnPropertyDescriptor(o,s);return a&&(a.configurable=!0),a},getPrototypeOf(o){return o=gn(n.root.cache,n.target),Reflect.getPrototypeOf(o)}},i=new Proxy({},r);return i}function qu(n){typeof n=="object"&&Object.keys(n).forEach(e=>{const t=n[e];t===null||typeof t=="undefined"?delete n[e]:typeof t=="object"&&qu(t)})}function ga(n){if(typeof n!="object"||!n[ci])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return n}class XT{constructor(e,t="order",r=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=r,typeof e!="object"||!e[ci])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(i=>typeof e[i]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(i=>typeof e[i][t]=="number")){const i=Object.keys(e);for(let o=0;o<i.length;o++){const s=e[i[o]];s[t]=o*r}}}getObservable(){return ga(this.collection).getObservable()}getArrayObservable(){const e=md();return new e(t=>{const r=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){r.unsubscribe()}})}getArray(){return ga(this.collection).toArray((e,t)=>e[this.orderProperty]-t[this.orderProperty])}add(e,t,r){const i=this.getArray();let o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(let c=0;c<i.length;c++){const l=i[c][this.orderProperty];o=Math.min(l,o),s=Math.max(l,s)}let a;if(typeof r=="number"){if(a=Object.keys(this.collection).find(c=>this.collection[c]===e),!a)throw new Error("item not found in collection");if(r===t)return{key:a,index:t};if(Math.abs(r-t)===1){const c=i[t],l=c[this.orderProperty];return c[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=l,{key:a,index:t}}else i.splice(r,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:s+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:o-this.orderIncrement;else{const c=i.map(u=>u[this.orderProperty]),l=c[t]-c[t-1];if(l>1)e[this.orderProperty]=c[t]-Math.floor(l/2);else{i.splice(t,0,e);for(let u=0;u<i.length;u++)i[u][this.orderProperty]=u*this.orderIncrement}}return{key:typeof a=="string"?a:ga(this.collection).push(e),index:t}}delete(e){const t=this.getArray()[e];if(!t)throw new Error(`Item at index ${e} not found`);const r=Object.keys(this.collection).find(i=>this.collection[i]===t);if(!r)throw new Error("Cannot find target object to delete");return this.collection[r]=null,{key:r,index:e}}move(e,t){const r=this.getArray();return this.add(r[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let r=0;r<t.length;r++)t[r][this.orderProperty]=r*this.orderIncrement}}class Zv{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class QT extends Zv{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const Oe=Symbol("private");class Vn{constructor(e,t,r){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const i=J.get(t).key,o=[];this[Oe]={get path(){return t},get key(){return i},get callbacks(){return o},vars:r||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const r=this[Oe].context;if(typeof e=="object"){const i=e?t?r||{}:e:{};return e&&Object.keys(e).forEach(o=>{i[o]=e[o]}),this[Oe].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),r;throw new Error("Invalid context argument")}}get cursor(){return this[Oe].cursor}set cursor(e){var t;this[Oe].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[Oe].path}get key(){const e=this[Oe].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[Oe].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=J.fillVariables2(this.path,this.vars),t=J.get(e);return t.parentPath===null?null:new Vn(this.db,t.parentPath).context(this[Oe].context)}get vars(){return this[Oe].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=J.fillVariables2(this.path,this.vars),r=J.getChildPath(t,e);return new Vn(this.db,r).context(this[Oe].context)}set(e,t){return F(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.set(this.path,e,{context:this[Oe].context});if(this.cursor=r,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}update(e,t){return F(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.update(this.path,e,{context:this[Oe].context});this.cursor=r}if(typeof t=="function")try{t(null,this)}catch(r){console.error("Error in onComplete callback:",r)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}transaction(e){return F(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const r=o=>{o=this.db.types.deserialize(this.path,o);const s=new tt(this,o);let a;try{a=e(s)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,r,{context:this[Oe].context});if(this.cursor=i,t)throw t;return this})}on(e,t,r){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const o=new PT(c=>{i=c}),s={event:e,stream:o,userCallback:typeof t=="function"&&t,ourCallback:(c,l,u,h,y)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${l}"`,c);return}const d=this.db.ref(l);d[Oe].vars=J.extractVariables(this.path,l);let f;if(e.startsWith("notify_"))f=d.context(y||{});else{const p={previous:this.db.types.deserialize(l,h),current:this.db.types.deserialize(l,u)};if(e==="child_removed")f=new tt(d,p.previous,!0,p.previous,y);else if(e==="mutations")f=new ya(d,p.current,y);else{const v=e==="mutated"&&p.current===null;f=new tt(d,p.current,v,p.previous,y)}}i.publish(f),y!=null&&y.acebase_cursor&&(this.cursor=y.acebase_cursor)}};this[Oe].callbacks.push(s);const a=()=>{typeof t=="function"&&o.subscribe(t,(y,d)=>{y||r&&r(d)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const l=y=>{const d=this[Oe].callbacks;d.splice(d.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${y.message}`),i.cancel(y.message)},u=this.db.api.subscribe(this.path,e,s.ourCallback,{newOnly:c.newOnly,cancelCallback:l,syncFallback:c.syncFallback}),h=()=>{const y=this[Oe].callbacks;return y.splice(y.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback)};if(u instanceof Promise?u.then(()=>{i.start(h)}).catch(l):i.start(h),!c.newOnly){if(e==="value")this.get(y=>{i.publish(y)});else if(e==="child_added")this.get(y=>{const d=y.val();d===null||typeof d!="object"||Object.keys(d).forEach(f=>{const p=new tt(this.child(f),d[f]);i.publish(p)})});else if(e==="notify_child_added"){let y=0;const d=()=>F(this,null,function*(){const f=yield this.db.api.reflect(this.path,"children",{limit:100,skip:y});f.list.forEach(p=>{const v=this.child(p.key);i.publish(v)}),f.more&&(y+=100,d())});d()}}};return this.db.isReady?a():this.db.ready(a),o}off(e,t){const r=this[Oe].callbacks.filter(i=>(!e||i.event===e)&&(!t||i.userCallback===t));return r.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),r.forEach(i=>{i.stream.stop()}),this}get(e,t){if(!this.db.isReady){const o=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const o=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw o;return Promise.reject(o)}const r=new Zv(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,r).then(o=>{var s;"context"in o&&"value"in o||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),o={value:o,context:{}});const a=this.db.types.deserialize(this.path,o.value),c=new tt(this,a,void 0,void 0,o.context);return(s=o.context)!=null&&s.acebase_cursor&&(this.cursor=o.context.acebase_cursor),c});if(t){i.then(t).catch(o=>{console.error("Uncaught error:",o)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(r=>{const i=o=>{this.off(e,i),r(o)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const o=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw o;return Promise.reject(o)}const r=Bt.generate(),i=this.child(r);return i[Oe].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return F(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return F(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new eb(this)}count(){return F(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return F(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(e){return F(this,arguments,function*(t,r={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof t=="function"?t:t.write.bind(t);return this.db.api.export(this.path,i,r)})}import(e){return F(this,arguments,function*(t,r={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,t,r)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),GT.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=md();return new t(r=>{let i,o=!1,s=this.get(e).then(c=>{o=!0,i=c.val(),r.next(i)});const a=c=>{if(!o){s=s.then(()=>a(c));return}const l=c.ref.path;if(l===this.path)return i=c.val(),r.next(i);const u=J.getPathKeys(l).slice(J.getPathKeys(this.path).length);let h=i;for(;u.length>1;){const f=u.shift();f in h||(h[f]=typeof u[0]=="number"?[]:{}),h=h[f]}const y=u.shift(),d=c.val();d===null?h instanceof Array&&typeof y=="number"?h.splice(y,1):delete h[y]:h[y]=d,r.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return F(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),o={canceled:!1,total:i.list.length,processed:0};for(let s=0;s<i.list.length;s++){const a=i.list[s].key,c=yield this.child(a).get(r);if(o.processed++,!!c.exists()&&(yield t(c))===!1){o.canceled=!0;break}}return o})}getMutations(e){return F(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:r})})}getChanges(e){return F(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:r})})}}class eb{constructor(e){this.ref=e,this[Oe]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,r){if((t==="in"||t==="!in")&&(!(r instanceof Array)||r.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(r instanceof Array)||r.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(r instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[Oe].filters.push({key:e,op:t,compare:r}),this}where(e,t,r){return this.filter(e,t,r)}take(e){return this[Oe].take=e,this}skip(e){return this[Oe].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[Oe].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const o=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const r=new QT(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});r.allow_cache=r.cache_mode!=="bypass",r.eventHandler=o=>{if(!this[Oe].events[o.name])return!1;const s=this[Oe].events[o.name];if(typeof s!="object"||s.length===0)return!1;if(["add","change","remove"].includes(o.name)){const a={name:o.name,ref:new Vn(this.ref.db,o.path)};if(r.snapshots&&o.name!=="remove"){const c=i.types.deserialize(o.path,o.value);a.snapshot=new tt(a.ref,c,!1)}o=a}s.forEach(a=>{var c,l;try{a(o)}catch(u){this.ref.db.debug.error(`Error executing "${o.name}" event handler of realtime query on path "${this.ref.path}": ${(l=(c=u==null?void 0:u.stack)!=null?c:u==null?void 0:u.message)!=null?l:u}`)}})},r.monitor={add:!1,change:!1,remove:!1},this[Oe].events&&(this[Oe].events.add&&this[Oe].events.add.length>0&&(r.monitor.add=!0),this[Oe].events.change&&this[Oe].events.change.length>0&&(r.monitor.change=!0),this[Oe].events.remove&&this[Oe].events.remove.length>0&&(r.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[Oe],r).catch(o=>{throw new Error(o)}).then(o=>{const{stop:s}=o;let{results:a,context:c}=o;if(this.stop=()=>F(this,null,function*(){yield s()}),"results"in o&&"context"in o||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=o,c={}),r.snapshots){const l=a.map(u=>{const h=i.types.deserialize(u.path,u.val);return new tt(i.ref(u.path),h,!1,void 0,c)});return _c.from(l)}else{const l=a.map(u=>i.ref(u));return bd.from(l)}}).then(o=>(t&&t(o),o))}stop(){return F(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return F(this,null,function*(){return(yield this.find()).length})}exists(){return F(this,null,function*(){const e=this[Oe].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return F(this,null,function*(){const t=yield this.find(),r=t.reduce((a,c)=>{const l=a[c.parent.path];return l?l.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,o=Object.keys(r).map(a=>F(this,null,function*(){const c=t.reduce((u,h)=>(u[h.key]=null,u),{}),l=i.ref(a);try{return yield l.update(c),{ref:l,success:!0}}catch(u){return{ref:l,success:!1,error:u}}})),s=yield Promise.all(o);return e&&e(s),s})}on(e,t){return this[Oe].events[e]||(this[Oe].events[e]=[]),this[Oe].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[Oe].events={},this;if(!this[Oe].events[e])return this;if(typeof t=="undefined")return delete this[Oe].events[e],this;const r=this[Oe].events[e].indexOf(t);return~r?(this[Oe].events[e].splice(r,1),this):this}forEach(e,t){return F(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),o={canceled:!1,total:i.length,processed:0};for(let s=0;s<i.length;s++){const a=yield i[s].get(r);if(o.processed++,!!a.exists()&&(yield t(a))===!1){o.canceled=!0;break}}return o})}}class _c extends Array{static from(e){const t=new _c(e.length);return e.forEach((r,i)=>t[i]=r),t}getValues(){return this.map(e=>e.val())}}class bd extends Array{static from(e){const t=new bd(e.length);return e.forEach((r,i)=>t[i]=r),t}getPaths(){return this.map(e=>e.path)}}function ZT(n,e){e=e.replace(/^\/|\/$/g,"");const t=J.getPathKeys(e),r=Object.keys(n).find(i=>{const o=J.getPathKeys(i);return o.length!==t.length?!1:o.every((s,a)=>s==="*"||typeof s=="string"&&s[0]==="$"?!0:s===t[a])});return n[r]}function eP(n,e){const t=J.get(e).parentPath;if(t!==null)return ZT(n,t)}function tP(n,e){e=e.replace(/^\/|\/$/g,"");const t=J.get(e).parentPath,r=t?J.getPathKeys(t):[];return Object.keys(n).reduce((i,o)=>{const s=J.getPathKeys(o);if(s.length<r.length)return i;let a=!0;if(r.length===0&&t!==null?a=s.length===1&&(s[0]==="*"||typeof s[0]=="string"&&s[0][0]==="$"):s.every((c,l)=>l>=r.length?!1:c==="*"||typeof c=="string"&&c[0]==="$"||c===r[l]?!0:(a=!1,!1)),a){const c=n[o];i.push({path:o,type:c})}return i},[])}function Wp(n,e,t,r,i){if(r===null||typeof r!="object")return r;const o=J.getPathKeys(t),s=tP(e,t),a=[];return s.sort((c,l)=>J.getPathKeys(c.path).length>J.getPathKeys(l.path).length?-1:1),s.forEach(c=>{const l=J.getPathKeys(c.path);l.push("*");const u=l.slice(o.length);if(u.length===0){const y=J.extractVariables(c.path,t),d=new Vn(n,t,y);if(i==="serialize")r=c.type.serialize(r,d);else if(i==="deserialize"){const f=new tt(d,r);r=c.type.deserialize(f)}return}const h=(y,d,f)=>{if(r===null||typeof r!="object")return r;const p=f[0];let v=[];if(p==="*"||typeof p=="string"&&p[0]==="$")d instanceof Array?v=d.map((w,S)=>({key:S,val:w})):v=Object.keys(d).map(w=>({key:w,val:d[w]}));else{const w=d[p];typeof w=="object"&&v.push({key:p,val:w})}v.forEach(w=>{const S=J.getChildPath(y,w.key),R=J.extractVariables(c.path,S),j=new Vn(n,S,R);if(f.length===1){if(i==="serialize")a.push({parent:d,key:w.key,original:d[w.key]}),d[w.key]=c.type.serialize(w.val,j);else if(i==="deserialize"){const N=new tt(j,w.val);d[w.key]=c.type.deserialize(N)}}else h(S,w.val,f.slice(1))})};h(t,r,u)}),i==="serialize"&&(r=Ln(r),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),r}const ji=Symbol("mappings");class tb{constructor(e){this.db=e,this[ji]={}}get mappings(){return this[ji]}map(e){return eP(this[ji],e)}bind(e,t,r={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof r.serializer!="undefined"){if(typeof r.serializer=="string")if(typeof t.prototype[r.serializer]=="function")r.serializer=t.prototype[r.serializer];else throw new TypeError(`${t.name}.prototype.${r.serializer} is not a function, cannot use it as serializer`);else if(typeof r.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof r.creator=="undefined")typeof t.create=="function"&&(r.creator=t.create);else if(typeof r.creator=="string")if(typeof t[r.creator]=="function")r.creator=t[r.creator];else throw new TypeError(`${t.name}.${r.creator} is not a function, cannot use it as creator`);else if(typeof r.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[ji][e]={db:this.db,type:t,creator:r.creator,serializer:r.serializer,deserialize(i){let o;return this.creator?o=this.creator.call(this.type,i):o=new this.type(i),o},serialize(i,o){return this.serializer?i=this.serializer.call(i,o,i):i&&typeof i.serialize=="function"&&(i=i.serialize(o,i)),i}}}serialize(e,t){return Wp(this.db,this[ji],e,t,"serialize")}deserialize(e,t){return Wp(this.db,this[ji],e,t,"deserialize")}}const Ds=()=>{};class nb{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Ds,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Ds,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):Ds,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):Ds,this.write=r=>{const i=typeof wn!="undefined"&&wn.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";r&&i?r.split(`
`).forEach(o=>console.log(o)):console.log(r)}}}const zp={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},Kp={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},Hp={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},Us={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var $t;(function(n){n.reset="reset",n.bold="bold",n.dim="dim",n.italic="italic",n.underline="underline",n.inverse="inverse",n.hidden="hidden",n.strikethrough="strikethrough",n.black="black",n.red="red",n.green="green",n.yellow="yellow",n.blue="blue",n.magenta="magenta",n.cyan="cyan",n.grey="grey",n.bgBlack="bgBlack",n.bgRed="bgRed",n.bgGreen="bgGreen",n.bgYellow="bgYellow",n.bgBlue="bgBlue",n.bgMagenta="bgMagenta",n.bgCyan="bgCyan",n.bgWhite="bgWhite",n.bgGrey="bgGrey"})($t||($t={}));function rb(){if(typeof wn=="undefined"||!wn.stdout||!wn.env||!wn.platform||wn.platform==="browser")return!1;if(wn.platform==="win32")return!0;const n=wn.env;return n.COLORTERM?!0:n.TERM==="dumb"?!1:n.CI||n.TEAMCITY_VERSION?!!n.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(n.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(n.TERM))}let ib=rb();function nP(n){ib=rb()&&n}function rP(n,e){if(!ib)return n;const t=[],r=[],i=a=>{a===$t.reset?t.push(Us.all):a in zp?(t.push(zp[a]),r.push(Us[a])):a in Kp?(t.push(Kp[a]),r.push(Us.color)):a in Hp&&(t.push(Hp[a]),r.push(Us.background))};e instanceof Array?e.forEach(i):i(e);const o=t.map(a=>"\x1B["+a+"m").join(""),s=r.map(a=>"\x1B["+a+"m").join("");return n.split(`
`).map(a=>o+a+s).join(`
`)}String.prototype.colorize=function(n){return rP(this,n)};class ob{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class iP extends zi{constructor(e,t={}){super(),this._ready=!1,t=new ob(t),this.name=e,this.debug=new nb(t.logLevel,`[${e}]`),nP(t.logColors);const r=[$t.magenta,$t.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,o=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(r)),o&&this.debug.write(o.colorize($t.magenta))),this.types=new tb(this),this.once("ready",()=>{this._ready=!0})}ready(e){return F(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){YT(e)}ref(e){return new Vn(this,e)}get root(){return this.ref("")}query(e){const t=new Vn(this,e);return new eb(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,r)=>this.api.createIndex(e,t,r),delete:e=>F(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,r=!1)=>this.api.setSchema(e,t,r),all:()=>this.api.getSchemas(),check:(e,t,r)=>this.api.validateSchema(e,t,r)}}}class at extends Error{constructor(e){super(`${e} is not implemented`)}}class oP extends zi{constructor(){super()}stats(e){throw new at("stats")}subscribe(e,t,r,i){throw new at("subscribe")}unsubscribe(e,t,r){throw new at("unsubscribe")}update(e,t,r){throw new at("update")}set(e,t,r){throw new at("set")}get(e,t){throw new at("get")}transaction(e,t,r){throw new at("transaction")}exists(e){throw new at("exists")}query(e,t,r){throw new at("query")}reflect(e,t,r){throw new at("reflect")}export(e,t,r){throw new at("export")}import(e,t,r){throw new at("import")}createIndex(e,t,r){throw new at("createIndex")}getIndexes(){throw new at("getIndexes")}deleteIndex(e){throw new at("deleteIndex")}setSchema(e,t,r){throw new at("setSchema")}getSchema(e){throw new at("getSchema")}getSchemas(){throw new at("getSchemas")}validateSchema(e,t,r){throw new at("validateSchema")}getMutations(e){throw new at("getMutations")}getChanges(e){throw new at("getChanges")}}function Jp(n,e,t){const r=[0,0,0,0,0];for(let i=0;i<e;i+=4){let o=((n[i]*256+n[i+1])*256+n[i+2])*256+n[i+3];if(!o)t.push("z");else{for(let s=0;s<5;r[s++]=o%85+33,o=Math.floor(o/85));t.push(String.fromCharCode(r[4],r[3],r[2],r[1],r[0]))}}}function sP(n){const e=n,t=[],r=e.length%4,i=e.length-r;if(Jp(e,i,t),r){const s=new Uint8Array(4);s.set(e.slice(i),0),Jp(s,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,r+1))}let o=t.join("");return o="<~"+o+"~>",o}const hr={encode:function(n){return n instanceof ArrayBuffer&&(n=new Uint8Array(n,0,n.byteLength)),sP(n)},decode:function(n){if(!n.startsWith("<~")||!n.endsWith("~>"))throw new Error("Invalid input string");n=n.substr(2,n.length-4);const e=n.length,t=[],r=[0,0,0,0,0];let i,o,s,a;for(let l=0;l<e;++l){if(n.charAt(l)=="z"){t.push(0,0,0,0);continue}for(let u=0;u<5;++u)r[u]=n.charCodeAt(l+u)-33;if(a=e-l,a<5){for(let u=a;u<4;r[++u]=0);r[a]=85}i=(((r[0]*85+r[1])*85+r[2])*85+r[3])*85+r[4],o=i&255,i>>>=8,s=i&255,i>>>=8,t.push(i>>>8,i&255,s,o);for(let u=a;u<5;++u,t.pop());l+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},aP=n=>{if(n.map===null||typeof n.map=="undefined"){if(typeof n.val=="undefined")throw new Error("serialized value must have a val property");return n.val}const e=(t,r)=>t==="date"?new Date(r):t==="binary"?hr.decode(r):t==="reference"?new nt(r):t==="regexp"?new RegExp(r.pattern,r.flags):t==="array"?new Fa(r):t==="bigint"?BigInt(r):r;return typeof n.map=="string"?e(n.map,n.val):(Object.keys(n.map).forEach(t=>{const r=n.map[t],i=J.getPathKeys(t);let o=n,s="val",a=n.val;i.forEach(c=>{s=c,o=a,a=a[s]}),o[s]=e(r,a)}),n.val)},sb=n=>{var e;if(n===null||typeof n!="object"||n instanceof Date||n instanceof ArrayBuffer||n instanceof nt||n instanceof RegExp){const o=sb({value:n});return{map:(e=o.map)==null?void 0:e.value,val:o.val.value}}n=Ln(n);const t=(o,s,a)=>{o instanceof Fa&&(s[a]="array"),Object.keys(o).forEach(c=>{const l=o[c],u=a.length===0?c:`${a}/${c}`;typeof l=="bigint"?(o[c]=l.toString(),s[u]="bigint"):l instanceof Date?(o[c]=l.toISOString(),s[u]="date"):l instanceof ArrayBuffer?(o[c]=hr.encode(l),s[u]="binary"):l instanceof nt?(o[c]=l.path,s[u]="reference"):l instanceof RegExp?(o[c]={pattern:l.source,flags:l.flags},s[u]="regexp"):typeof l=="object"&&l!==null&&t(l,s,u)})},r={};t(n,r,"");const i={val:n};return Object.keys(r).length>0&&(i.map=r),i},Yp=n=>n>0?Date.now()+n*1e3:1/0;class cP{get size(){return this.cache.size}constructor(e){var t;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const r=setInterval(()=>{this.cleanUp()},60*1e3);(t=r.unref)==null||t.call(r)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=Yp(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?Ln(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let r=null;const i=Date.now();for(const[o,s]of this.cache.entries()){if(s.expires<=i){this.cache.delete(o),r=null;break}(!r||s.accessed<r.accessed)&&(r={key:o,accessed:s.accessed})}r!==null&&this.cache.delete(r.key)}this.cache.set(e,{value:this.options.cloneValues?Ln(t):t,added:Date.now(),accessed:Date.now(),expires:Yp(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,r)=>{t.expires<=e&&this.cache.delete(r)})}}function lP(n){let e=0;function t(){let a;for(;a=n[e],[" ","\r",`
`,"	"].includes(a);)e++}function r(a){if(n[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${n[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=n[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${n.slice(e,e+10)}..`);return n[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),r(":"),a}function o(){t();let a={typeOf:"any"},c,l="";for(;c=n[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)l+=c,e++;if(l.length===0)if(n[e]==="*")r("*"),a.typeOf="any";else if(["'",'"',"`"].includes(n[e])){a.typeOf="string",a.value="";const u=n[e];for(r(u);c=n[e],c&&c!==u;)a.value+=c,e++;r(u)}else if(n[e]>="0"&&n[e]<="9"){a.typeOf="number";let u="";for(;c=n[e],c==="."||c==="n"||c>="0"&&c<="9";)u+=c,e++;u.endsWith("n")?a.value=BigInt(u):u.includes(".")?a.value=parseFloat(u):a.value=parseInt(u)}else if(n[e]==="{"){for(r("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const u=i(),h=s();if(a.children.push({name:u.name,optional:u.optional,wildcard:u.wildcard,types:h}),t(),(n[e]===";"||n[e]===",")&&(r(n[e]),t()),n[e]==="}")break}r("}")}else if(n[e]==="/"){r("/");let u="",h="";for(;c=n[e],c!=="/"||u.endsWith("\\");)u+=c,e++;for(r("/");c=n[e],["g","i","m","s","u","y","d"].includes(c);)h+=c,e++;a.typeOf="string",a.matches=new RegExp(u,h)}else throw new Error(`Expected a type definition at position ${e}, found character '${n[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(l))a.typeOf=l.toLowerCase();else if(l==="Object"||l==="object")a.typeOf="object",a.instanceOf=Object;else if(l==="Date")a.typeOf="object",a.instanceOf=Date;else if(l==="Binary"||l==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(l==="any")a.typeOf="any";else if(l==="null")a.typeOf="object",a.value=null;else if(l==="Array")r("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=s(),r(">");else if(["true","false"].includes(l))a.typeOf="boolean",a.value=l==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();n[e]==="[";)r("["),r("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function s(){t();const a=[o()];for(;n[e]==="|";)r("|"),a.push(o()),t();return a}return o()}function uP(n,e,t,r){const i=e.find(h=>h.name==="*"||h.name[0]==="$")?[]:Object.keys(t).filter(h=>![null,void 0].includes(t[h])&&!e.find(y=>y.name===h));if(i.length>0)return{ok:!1,reason:`Object at path "${n}" cannot have propert${i.length===1?"y":"ies"} ${i.map(h=>`"${h}"`).join(", ")}`};function o(h){const y=![null,void 0].includes(t[h.name]);return!h.optional&&(r?t[h.name]===null:!y)?{ok:!1,reason:`Property at path "${n}/${h.name}" is not optional`}:y&&h.types.length===1?Wo(`${n}/${h.name}`,h.types[0],t[h.name],!1):y&&!h.types.some(d=>Wo(`${n}/${h.name}`,d,t[h.name],!1).ok)?{ok:!1,reason:`Property at path "${n}/${h.name}" does not match any of ${h.types.length} allowed types`}:{ok:!0}}const s=e.filter(h=>!h.wildcard),a=s.find(h=>!o(h).ok);if(a)return{ok:!1,reason:o(a).reason};const c=e.find(h=>h.wildcard);if(!c)return{ok:!0};const l=Object.keys(t).filter(h=>!s.find(y=>y.name===h));let u={ok:!0};for(let h=0;h<l.length&&u.ok;h++){const y=l[h];u=o({name:y,types:c.types,optional:!0,wildcard:!0})}return u}function Wo(n,e,t,r,i){const o={ok:!0};if(e.typeOf==="any")return o;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`};if(!e.children)return o;const s=i[0];let a=e.children.find(l=>l.name===s);if(a||(a=e.children.find(l=>l.name==="*"||l.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${n}" cannot have property "${s}"`};if(a.optional&&t===null&&i.length===1)return o;let c;return a.types.some(l=>{const u=typeof s=="number"?`${n}[${s}]`:`${n}/${s}`;return c=Wo(u,l,t,r,i.slice(1)),c.ok}),c}return t===null?o:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${n}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${n}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${n}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(s=>e.genericTypes.some(a=>Wo(n,a,s,!1).ok))?{ok:!1,reason:`every array value of path "${n}" must match one of the specified types`}:e.typeOf==="object"&&e.children?uP(n,e.children,t,r):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${n}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:o}function hP(n){switch(n){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${n.name}`)}}class dP{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const r=i=>"{"+Object.keys(i).map(o=>{let s=i[o];if(s===void 0)s="undefined";else if(s instanceof RegExp)s=`/${s.source}/${s.flags}`;else if(typeof s=="object")s=r(s);else if(typeof s=="function")s=hP(s);else if(!["string","number","boolean","bigint"].includes(typeof s))throw new Error(`Type definition for key "${o}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${o}:${s}`}).join(",")+"}";this.text=r(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=lP(this.text)}check(e,t,r,i){const o=Wo(e,this.type,t,r,i);return!o.ok&&this.handling.warnOnly&&(o.warning=`${r?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${o.reason}`,o.ok=!0,this.handling.warnCallback(o.warning)),o}}class Xt{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class Tl extends Xt{}class Vu extends Xt{}class Gp extends Xt{}class fP extends Xt{}class Xp extends Xt{}class pP extends Xt{}const yP={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},se=yP;function gP(n){switch(n){case se.ARRAY:return"array";case se.BINARY:return"binary";case se.BOOLEAN:return"boolean";case se.DATETIME:return"date";case se.NUMBER:return"number";case se.OBJECT:return"object";case se.REFERENCE:return"reference";case se.STRING:return"string";case se.BIGINT:return"bigint"}}class ab{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=J.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return gP(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function Kt(n,e){if(!n)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const mP=120,Ht={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class cb{constructor(e,t=mP){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Bt.generate()}_allowLock(e,t,r){const i=this._locks.find(o=>o.tid!==t&&o.state===Ht.LOCKED&&(r||o.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(r){console.error("Unhandled promise rejection:",r)}}_processLockQueue(){if(this._quit){const e=new Error("Quitting");this._locks.filter(t=>t.state===Ht.PENDING).forEach(t=>this._rejectLock(t,e)),this._locks.length===0&&this._quit()}this._locks.filter(e=>e.state===Ht.PENDING).sort((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.requested-t.requested).forEach(e=>{const t=this._allowLock(e.path,e.tid,e.forWriting);e.waitingFor=t.conflict||null,t.allow&&this.lock(e).then(e.resolve).catch(r=>this._rejectLock(e,r))})}lock(e,t){return F(this,arguments,function*(r,i,o=!0,s="",a={withPriority:!1,noTimeout:!1}){let c,l;if(r instanceof Pl)c=r,l=!0;else{if(this._locks.findIndex(u=>u.tid===i&&u.state===Ht.EXPIRED)>=0)throw new Error(`lock on tid ${i} has expired, not allowed to continue`);if(this._quit&&!a.withPriority)throw new Error("Quitting");{c=new Pl(this,r,i,o,a.withPriority===!0),c.comment=s,this._locks.push(c);const u=this._allowLock(r,i,o);c.waitingFor=u.conflict||null,l=u.allow}}if(l){if(c.state=Ht.LOCKED,typeof c.granted!="number"&&(c.granted=Date.now(),a.noTimeout!==!0)){c.expires=Date.now()+this.timeout;let u=0;const h=()=>{if(c.state===Ht.LOCKED){if(u++,u<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${u}]`),c.timeout=setTimeout(h,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=Ht.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(h,this.timeout/4)}return c}else return Kt(c.state===Ht.PENDING),new Promise((u,h)=>{c.resolve=u,c.reject=h})})}unlock(e,t,r=!0){let i,o;if(e instanceof Pl)i=e,o=this._locks.indexOf(i);else{const s=e;o=this._locks.findIndex(a=>a.id===s),i=this._locks[o]}if(o<0){const s=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(s)}return i.state=Ht.DONE,clearTimeout(i.timeout),this._locks.splice(o,1),r&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,r){return this._allowLock(e,t,r).allow}}let vP=0;class Pl{static get LOCK_STATE(){return Ht}constructor(e,t,r,i,o=!1){this.locker=e,this.path=t,this.tid=r,this.forWriting=i,this.priority=o,this.state=Ht.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++vP,this.history=[]}release(e){return F(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return F(this,null,function*(){const e=J.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const t=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return t.history=this.history,t.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),t}})}}class wd extends Error{}class Mu extends Error{}class bP extends Error{constructor(e){super(`Exiting: ${e}`)}}class wP extends zi{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,r=e.name){super(),this.storage=e,this.id=t,this.dbname=r,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new cb(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(a=>a.callback===i.callback))return;const o=this.ourSubscriptions.some(a=>a.event===i.event&&a.path===i.path);if(this.ourSubscriptions.push(i),o)return;const s={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(s)}),e.on("unsubscribe",i=>{const o=this.remoteSubscriptions.find(s=>s.callback===i.callback);if(o){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(o),1);return}this.ourSubscriptions.filter(s=>s.path===i.path&&(!i.event||s.event===i.event)&&(!i.callback||s.callback===i.callback)).forEach(s=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(s),1);const a={type:"unsubscribe",from:this.id,data:{path:s.path,event:s.event}};this.sendMessage(a)})})}exit(e=0){return F(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(!this._exiting&&(this.peers.find(r=>r.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t)){const r={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(r),this.ourSubscriptions.forEach(i=>{const o={type:"subscribe",from:this.id,to:e,data:{path:i.path,event:i.event}};this.sendMessage(o)})}}removePeer(e,t=!1){if(this._exiting)return;const r=this.peers.find(i=>i.id===e);if(!r){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(r),1),this.remoteSubscriptions.filter(i=>i.for===e).forEach(i=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(i),1),this.storage.subscriptions.remove(i.path,i.event,i.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const r=(i,o,s,a,c)=>{const l={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:o,val:s,previous:a,context:c}};this.sendMessage(l)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:r}),this.storage.subscriptions.add(t.path,t.event,r)}cancelRemoteSubscription(e,t){const r=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!r||this.storage.subscriptions.remove(t.path,t.event,r.callback)}handleMessage(e){return F(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,r=t.data.context||{};r.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(i=>i.event===t.event&&i.path===t.path).forEach(i=>{i.callback(null,t.data.path,t.data.val,t.data.previous,r)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,r={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(i=>{var o;return((o=i.lock)==null?void 0:o.id)===t.data.id}).lock.release()}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const o=this._locks.find(s=>{var a;return((a=s.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield o.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);o.lock=i,r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("Result of unknown request received");t.ok?r.resolve(t.data):r.reject(new Error(t.reason))}}})}lock(e){return F(this,null,function*(){if(this._exiting&&!this._locks.find(r=>r.tid===e.tid&&r.granted))throw new bP("new transaction lock denied because the IPC peer is exiting");const t=r=>{this._locks.splice(this._locks.indexOf(r),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);r.tid=i.tid,r.granted=!0;const o=s=>({get id(){return s.id},get tid(){return s.tid},get path(){return s.path},get forWriting(){return s.forWriting},get expires(){return s.expires},get comment(){return s.comment},get state(){return s.state},release:()=>F(this,null,function*(){yield s.release(),t(r)}),moveToParent:()=>F(this,null,function*(){const a=yield s.moveToParent();return r.lock=o(a),r.lock})});return r.lock=o(i),r.lock}else{const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=c=>(r.granted=!0,r.tid=c.tid,r.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:Ht.LOCKED,expires:c.expires,comment:c.comment,release:()=>F(this,null,function*(){const l={type:"unlock-request",id:Bt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id}};yield this.request(l),r.lock.state=Ht.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${r.lock.id} (tid ${r.lock.tid}, ${r.lock.comment}, "/${r.lock.path}", ${r.lock.forWriting?"write":"read"})`),t(r)}),moveToParent:()=>F(this,null,function*(){const l={type:"move-lock-request",id:Bt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id,move_to:"parent"}};let u;try{u=yield this.request(l)}catch(h){throw r.lock.state=Ht.DONE,t(r),h}return r.lock=i(u),r.lock})},r.lock),o={type:"lock-request",id:Bt.generate(),from:this.id,to:this.masterPeerId,data:e};let s,a;try{s=yield this.request(o)}catch(c){a=c,s=null}if(a)throw t(r),a;return i(s)}})}request(e){return F(this,null,function*(){let t,r;const i=new Promise((o,s)=>{t=a=>{this._requests.delete(e.id),o(a)},r=a=>{this._requests.delete(e.id),s(a)}});return this._requests.set(e.id,{resolve:t,reject:r,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Bt.generate(),data:e};return this.request(t).catch(r=>{throw this.storage.debug.error(r),r})}replyRequest(e,t){const r={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(r)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class kP extends wP{constructor(e){if(super(e,Bt.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const r=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:o=>{const s=Bt.generate(),a=`acebase:${e.name}:${this.id}:${s}`,c=JSON.stringify(sb(o));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(o){r[0]=o},set onmessageerror(o){i()},close(){i()},addEventListener(o,s){o!=="message"&&i(),r.push(s)},removeEventListener(o,s){const a=r.indexOf(s);a>=1&&r.splice(a,1)},dispatchEvent(o){return r.forEach(s=>{try{s&&s(o)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",o=>{const[s,a,c,l]=o.key.split(":");if(s!=="acebase"||a!==e.name||c===this.id||o.newValue===null)return;const u=aP(JSON.parse(o.newValue));this.channel.dispatchEvent({data:u})})}this.channel.addEventListener("message",r=>F(this,null,function*(){const i=r.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const o=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=o.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const s=this._locks.splice(0);yield Promise.all(s.filter(a=>a.granted).map(a=>F(this,null,function*(){let c,l;a.lock.release=()=>new Promise(h=>c=h),a.lock.moveToParent=()=>new Promise(h=>l=h);const u=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(l){const h=yield u.moveToParent();l(h)}c&&(yield u.release(),c())}))),yield Promise.all(s.filter(a=>!a.granted).map(a=>F(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class Ao{static get hasFileSystem(){return!1}static get fs(){return null}}class kd extends Xt{}class lb extends Xt{}class xP extends Xt{}class EP extends Xt{}function _P(n,e,t,r){return F(this,null,function*(){if(!n.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:o,indexes:s,storage:a}=n,c=r&&r.rebuild===!0,l=r&&r.type||"normal";let u=r&&r.include||[];typeof u=="string"&&(u=[u]);const h=s.find(d=>d.path===e&&d.key===t&&d.type===l&&d.includeKeys.length===u.length&&d.includeKeys.every((f,p)=>u[p]===f));if(h&&r.config&&(h.config=r.config),h&&c!==!0)return o.log(`Index on "/${e}/*/${t}" already exists`.colorize($t.inverse)),h;if(!i.isMaster){const d=yield i.sendRequest({type:"index.create",path:e,key:t,options:r});if(d.ok)return a.indexes.add(d.fileName);throw new Error(d.reason)}yield Ao.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(d=>{if(d.code!=="EEXIST")throw d});const y=h||(()=>{const{include:d,caseSensitive:f,textLocale:p,textLocaleKey:v}=r,w={include:d,caseSensitive:f,textLocale:p,textLocaleKey:v};switch(l){case"array":return new EP(a,e,t,re({},w));case"fulltext":return new lb(a,e,t,Qe(re({},w),{config:r.config}));case"geo":return new xP(a,e,t,re({},w));default:return new kd(a,e,t,re({},w))}})();h||s.push(y);try{yield y.build()}catch(d){throw n.debug.error(`Index build on "/${e}/*/${t}" failed: ${d.message} (code: ${d.code})`.colorize($t.red)),h||s.splice(s.indexOf(y),1),d}return i.sendNotification({type:"index.created",fileName:y.fileName,path:e,key:t,options:r}),y})}const{compareValues:qs,getChildValues:ti,encodeString:Qp,defer:$P}=Gv,Fu=["value","child_added","child_changed","child_removed","mutated","mutations"];Fu.push(...Fu.map(n=>`notify_${n}`));const OP=()=>{};class AP extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class xd{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class SP extends zi{createTid(){return Bt.generate()}constructor(e,t,r){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return Ao==null?void 0:Ao.hasFileSystem},create:(o,s,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return _P(c,o,s,a)},get:(o,s=null)=>{if(o.includes("$")){const a=J.getPathKeys(o).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);o=new J(a).path}return this._indexes.filter(a=>a.path===o&&(s===null||s===a.key))},getAll:(o,s={parentPaths:!0,childPaths:!0})=>{const a=J.getPathKeys(o);return this._indexes.filter(c=>{const l=J.getPathKeys(c.path+"/*");return s.parentPaths&&l.every((u,h)=>u==="*"||a[h]===u)&&[c.key].concat(...c.includeKeys).includes(a[l.length])?!0:l.length<a.length||!s.childPaths&&l.length!==a.length?!1:a.every((u,h)=>[u,"*"].includes(l[h]))})},list:()=>this._indexes.slice(),load:()=>F(this,null,function*(){if(this._indexes.splice(0),!Ao.hasFileSystem)return;let o=[];try{o=yield Ao.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const s=[];o.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",l=/^\[[a-z]+\]-/.test(a);if(!c&&!l||c&&a.startsWith(`[${this.settings.type}]-`)){const u=this.indexes.add(a);s.push(u)}}),yield Promise.all(s)}),add:o=>F(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(s)return s;if(this._annoucedIndexes.has(o))return yield this._annoucedIndexes.get(o);try{const a=kd.readFromFile(this,o);this._annoucedIndexes.set(o,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(o),c}catch(a){return this.debug.error(a),null}}),delete:o=>F(this,null,function*(){const s=yield this.indexes.remove(o);yield s.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:s.fileName,path:s.path,keys:s.key})}),remove:o=>F(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(!s)throw new Error(`Index ${o} not found`);return this._indexes.splice(this._indexes.indexOf(s),1),s}),close:()=>F(this,null,function*(){const o=this.indexes.list().map(s=>s.close().catch(a=>this.debug.error(a)));yield Promise.all(o)})},this._eventSubscriptions={},this.subscriptions={add:(o,s,a)=>{if(Fu.indexOf(s)<0)throw new TypeError(`Invalid event type "${s}"`);let c=this._eventSubscriptions[o];c||(c=this._eventSubscriptions[o]=[]),c.push({created:Date.now(),type:s,callback:a}),this.emit("subscribe",{path:o,event:s,callback:a})},remove:(o,s,a)=>{const c=this._eventSubscriptions[o];if(!c)return;const l=()=>c.findIndex(h=>(s?h.type===s:!0)&&(a?h.callback===a:!0));let u;for(;(u=l())>=0;)c.splice(u,1);this.emit("unsubscribe",{path:o,event:s,callback:a})},hasValueSubscribersForPath(o){return!!this.getValueSubscribersForPath(o)},getValueSubscribersForPath:o=>{const s=new J(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.equals(c)||s.isDescendantOf(c)){const l=this._eventSubscriptions[c],u=J.fillVariables(c,o);l.filter(h=>!h.type.startsWith("notify_")).forEach(h=>{let y=null;if(h.type==="value")y=u;else if(["mutated","mutations"].includes(h.type)&&s.isDescendantOf(u))y=o;else if(h.type==="child_changed"&&o!==u){const d=J.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=J.getChildPath(u,d)}else if(["child_added","child_removed"].includes(h.type)&&s.isChildOf(u)){const d=J.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=J.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},getAllSubscribersForPath:o=>{const s=J.get(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.isOnTrailOf(c)){const l=this._eventSubscriptions[c],u=J.fillVariables(c,o);l.forEach(h=>{let y=null;if(h.type==="value"||h.type==="notify_value")y=u;else if(["child_changed","notify_child_changed"].includes(h.type)){const d=o===u||s.isAncestorOf(u)?"*":J.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=J.getChildPath(u,d)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(h.type))y=o;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(h.type)&&(s.isChildOf(u)||o===u||s.isAncestorOf(u))){const d=o===u||s.isAncestorOf(u)?"*":J.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=J.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u&&d.subscriptionPath===c)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},trigger:(o,s,a,c,l,u)=>{(this._eventSubscriptions[s]||[]).filter(h=>h.type===o).forEach(h=>{h.callback(null,a,l,c,u)})}},this.debug=new nb(r.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof Xt){const o={ipcName:i,server:t.ipc instanceof Xt?t.ipc:null};this.ipc=new Xt(this,o)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const o=Object.assign({dbname:i},t.ipc);this.ipc=new Xt(this,o)}else this.ipc=new kP(this,i);this.ipc.once("exit",o=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(o,s,a,c)=>this.ipc.lock({path:o,tid:s,write:a,comment:c})},this._lastTid=0}close(){return F(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:Qp(e).length<this.settings.maxInlineValueSize;if(e instanceof nt)return e.path.length>this.settings.maxInlineValueSize?!1:Qp(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,r){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let r=e,i=!1;const o=t?[]:this.subscriptions.getAllSubscribersForPath(e),s=t?[]:this.subscriptions.getValueSubscribersForPath(e);s.length>0&&(i=!0,r=s.map(l=>({path:l.dataPath,keys:J.getPathKeys(l.dataPath)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0)[0].path,s.filter(l=>l.dataPath===r).every(l=>l.type==="mutated"||l.type.startsWith("notify_"))&&(i=!1),r=J.fillVariables(r,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(l=>({index:l,keys:J.getPathKeys(l.path)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0).map(l=>l.index),c=[];if(a.length>0){a.sort((h,y)=>(typeof h._pathKeys=="undefined"&&(h._pathKeys=J.getPathKeys(h.path)),typeof y._pathKeys=="undefined"&&(y._pathKeys=J.getPathKeys(y.path)),h._pathKeys.length<y._pathKeys.length?-1:h._pathKeys.length>y._pathKeys.length?1:0));const l=a[0],u=l.path===e?e:J.fillVariables(`${l.path}/*`,e);u.length<r.length&&(r=u,a.filter(h=>h.path===l.path).forEach(h=>{[h.key].concat(h.includeKeys).forEach(y=>!c.includes(y)&&c.push(y))}))}return{topEventPath:r,eventSubscriptions:o,valueSubscribers:s,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(e,t){return F(this,arguments,function*(r,i,o={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(o=o||{},!o.tid&&!o.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");o.merge=o.merge===!0;const s=this.validateSchema(r,i,{updates:o.merge});if(!s.ok)throw new AP(s.reason);const a=o.tid,c=o.transaction;let l=null;const u=o.impact?o.impact:this.getUpdateImpact(r,o.suppress_events),{topEventPath:h,eventSubscriptions:y,hasValueSubscribers:d,indexes:f}=u;let{keysFilter:p}=u;const v=()=>{if(typeof o._customWriteFunction=="function")return o._customWriteFunction();if(l){const E=J.getPathKeys(r),g=J.getPathKeys(h),b=E.slice(g.length);let m=l;for(;b.length>0&&m!==null;){const x=b.shift();m=typeof m=="object"&&x in m?m[x]:null}o.currentValue=m}return this._writeNode(r,i,o)},w=this.settings.transactions&&this.settings.transactions.log===!0;if(y.length===0&&f.length===0&&!w)return v();if(!d&&o.merge===!0&&p.length===0&&(p=Object.keys(i),h!==r)){const E=r.slice(h.length);p=p.map(g=>`${E}/${g}`)}const S=yield this.getNodeInfo(h,{transaction:c,tid:a});let R=null;if(S.exists){const E={transaction:c,tid:a};p.length>0&&(E.include=p),h===""&&typeof E.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),R=(yield this.getNode(h,E)).value}l=R;const j=(yield v())||{};let N,D;if(r===h)o.merge?l===null?N=i instanceof Array?[]:{}:(N=l instanceof Array?[]:{},Object.keys(l).forEach(E=>{N[E]=l[E]})):N=i,D=N;else{const E=r.slice(h.length).replace(/^\//,""),g=J.getPathKeys(E);for(l===null?N=typeof g[0]=="number"?[]:{}:(N=l instanceof Array?[]:{},Object.keys(l).forEach(b=>{N[b]=l[b]})),D=N;g.length>0;){const b=g.shift();if(!o.merge&&g.length===0)D[b]=i;else{const m=D[b],x=typeof b=="number"?[...m]:re({},m);D[b]=x}D=D[b]}}o.merge&&Object.keys(i).forEach(E=>{D[E]=i[E]});const q=qs(l,N);if(q==="identical")return j.mutations=[],j;function P(E){if(E===null||typeof E!="object")return E;Object.keys(E).forEach(g=>{const b=E[g];b===null&&(delete E[g],E instanceof Array&&E.length--),typeof b=="object"&&P(b)})}P(N);const I=[];f.map(E=>({index:E,keys:J.getPathKeys(E.path)})).sort((E,g)=>E.keys.length<g.keys.length?1:E.keys.length>g.keys.length?-1:0).forEach(({index:E})=>{const g=J.getPathKeys(h),b=J.getPathKeys(E.path+"/*"),m=b.slice(g.length),x=l,O=N;if(m.length===0){Kt(g.length===b.length,"check logic");const $=this.ipc.isMaster?E.handleRecordUpdate(h,x,O):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:h,oldValue:x,newValue:O});I.push($);return}const k=($,_,A)=>{if(_===null&&A===null)return[];const T=J.getPathKeys($),C=J.getPathKeys(E.path+"/*"),L=C.slice(T.length);if(L.length===0)return Kt(T.length===C.length,"check logic"),[{path:$,oldValue:_,newValue:A}];let V=[],K="";for(;L.length>0;){const G=L.shift();if(typeof G=="string"&&(G==="*"||G.startsWith("$"))){const ie=_===null?[]:Object.keys(_);A!==null&&Object.keys(A).forEach(ee=>{ie.indexOf(ee)<0&&ie.push(ee)}),ie.forEach(ee=>{const fe=J.getChildPath(K,ee),de=ti(ee,_,A),ne=J.getChildPath($,fe),ce=k(ne,de.oldValue,de.newValue);V=V.concat(ce)});break}else{const ie=ti(G,_,A);if(_=ie.oldValue,A=ie.newValue,_===null&&A===null)break;K=J.getChildPath(K,G)}}return V};k(h,x,O).forEach($=>{const _=this.ipc.isMaster?E.handleRecordUpdate($.path,$.oldValue,$.newValue):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:$.path,oldValue:$.oldValue,newValue:$.newValue});I.push(_)})});const B=(E,g,b,m=[])=>{let x=!0,O=E.type;if(O.startsWith("notify_")&&(O=O.slice(7)),O==="mutated"||(O==="child_changed"&&(g===null||b===null)?x=!1:O==="value"||O==="child_changed"?x=qs(g,b)!=="identical":O==="child_added"?x=g===null&&b!==null:O==="child_removed"&&(x=g!==null&&b===null),!x))return;const k=J.getPathKeys(E.dataPath);m.forEach(_=>{const A=k.indexOf(_.name);Kt(A>=0,`Variable "${_.name}" not found in subscription dataPath "${E.dataPath}"`),k[A]=_.value});const $=k.reduce((_,A)=>J.getChildPath(_,A),"");this.subscriptions.trigger(E.type,E.subscriptionPath,$,g,b,o.context)},U=(E,g,b,m)=>{const x=[],O=m||qs(g,b);return O==="identical"||(typeof O=="string"?x.push({path:E,oldValue:g,newValue:b}):(O.changed.forEach(k=>{const $=J.getChildPath(E,k.key),_=ti(k.key,g,b),A=U($,_.oldValue,_.newValue,k.change);x.push(...A)}),O.added.forEach(k=>{const $=J.getChildPath(E,k);x.push({path:$,oldValue:null,newValue:b[k]})}),g instanceof Array&&b instanceof Array&&O.removed.sort((k,$)=>k<$?1:-1),O.removed.forEach(k=>{const $=J.getChildPath(E,k);x.push({path:$,oldValue:g[k],newValue:null})}))),x};w&&this.settings.type!=="transaction"&&(j.mutations=(()=>{const E=r.slice(h.length).replace(/^\//,""),g=J.getPathKeys(E);let b=l,m=N;for(;g.length>0;){const O=g.shift();({oldValue:b,newValue:m}=ti(O,b,m))}const x=qs(b,m);return U(r,b,m,x).map(O=>({target:J.getPathKeys(O.path.slice(r.length)),prev:O.oldValue,val:O.newValue}))})());const M=()=>{y.filter(E=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(E.type)).map(E=>{const g=J.getPathKeys(E.dataPath);return{sub:E,keys:g}}).sort((E,g)=>E.keys.length<g.keys.length?1:E.keys.length>g.keys.length?-1:0).forEach(({sub:E})=>{const g=(b,m,x,O=[])=>{const k=E.dataPath.slice(b.length).replace(/^\//,""),$=J.getPathKeys(k);for(;$.length>0;){const _=$.shift();if(typeof _=="string"&&(_==="*"||_[0]==="$")){const A=m===null?[]:Object.keys(m).map(T=>m instanceof Array?parseInt(T):T);x!==null&&Object.keys(x).forEach(T=>{const C=x instanceof Array?parseInt(T):T;!A.includes(C)&&A.push(T)}),A.forEach(T=>{const C=ti(T,m,x),L=O.concat({name:_,value:T});$.length===0?B(E,C.oldValue,C.newValue,L):g(J.getChildPath(b,_),C.oldValue,C.newValue,L)});return}else{b=J.getChildPath(b,_);const A=ti(_,m,x);m=A.oldValue,x=A.newValue}}B(E,m,x,O)};if(E.type.startsWith("notify_")&&J.get(E.eventPath).isAncestorOf(h)){const b=J.get(E.eventPath).isParentOf(h);(E.type==="notify_value"||E.type==="notify_child_changed"&&(!b||!["added","removed"].includes(q))||E.type==="notify_child_removed"&&q==="removed"&&b||E.type==="notify_child_added"&&q==="added"&&b)&&this.subscriptions.trigger(E.type,E.subscriptionPath,E.dataPath,null,null,o.context)}else g(h,l,N)}),y.filter(E=>["mutated","mutations","notify_mutated","notify_mutations"].includes(E.type)).forEach(E=>{let g=h;const b=E.eventPath.slice(g.length).replace(/^\//,""),m=J.getPathKeys(b);let x=l,O=N;for(;m.length>0;){const _=m.shift();g=J.getChildPath(g,_);const A=ti(_,x,O);x=A.oldValue,O=A.newValue}const k=U(g,x,O);if(k.length===0)return;const $=E.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(E.type))k.forEach((_,A)=>{const T=o.context,C=$?null:_.oldValue,L=$?null:_.newValue;this.subscriptions.trigger(E.type,E.subscriptionPath,_.path,C,L,T)});else if(["mutations","notify_mutations"].includes(E.type)){const _=$?null:k.map(A=>({target:J.getPathKeys(A.path.slice(E.subscriptionPath.length)),prev:A.oldValue,val:A.newValue}));this.subscriptions.trigger(E.type,E.subscriptionPath,E.subscriptionPath,null,_,o.context)}})};return o.waitForIndexUpdates===!1&&I.splice(0),yield Promise.all(I),$P(M),j})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(e){return F(this,arguments,function*(t,r={}){return(yield this.getNode(t,r)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,r){throw new Error("This method must be implemented by subclass")}updateNode(e,t,r){throw new Error("This method must be implemented by subclass")}transactNode(e,t){return F(this,arguments,function*(r,i,o={no_lock:!1,suppress_events:!1,context:null}){const s=o&&o.no_lock===!0,a=this.createTid(),c=s?{tid:a,release:OP}:yield this.nodeLocker.lock(r,a,!0,"transactNode");try{let l=!1;const u=()=>{l=!0};s&&this.subscriptions.add(r,"notify_value",u);const h=yield this.getNode(r,{tid:a}),y=h.revision;let d;try{d=i(h.value),d instanceof Promise&&(d=yield d.catch(f=>{this.debug.error(`Error in transaction callback: ${f.message}`)}))}catch(f){this.debug.error(`Error in transaction callback: ${f.message}`)}if(typeof d=="undefined")return;if(s&&this.subscriptions.remove(r,"notify_value",u),l)throw new Mu("Node changed");return yield this.setNode(r,d,{assert_revision:y,tid:c.tid,suppress_events:o.suppress_events,context:o.context})}catch(l){if(l instanceof Mu)return console.warn(`node value changed, running again. Error: ${l.message}`),this.transactNode(r,i,o);throw l}finally{c.release()}})}matchNode(e,t,r){return F(this,null,function*(){var i;const o=(i=r==null?void 0:r.tid)!=null?i:Bt.generate(),s=(c,l)=>F(this,null,function*(){if(l.length===0)return Promise.resolve(!0);const u=l.reduce((f,p)=>{let v=p.key;return typeof v=="string"&&v.includes("/")&&(v=v.slice(0,v.indexOf("/"))),f.indexOf(v)<0&&f.push(v),f},[]),h=u.slice();let y=!0;const d=[];try{return yield this.getChildren(c,{tid:o,keyFilter:u}).next(f=>{var p;const v=(p=f.key)!=null?p:f.index;h.includes(v)&&h.splice(h.indexOf(f.key),1);const w=l.filter(R=>R.key===v).map(R=>({op:R.op,compare:R.compare})),S=w.length>0?a(f,w):{isMatch:!0,promises:[]};if(y=S.isMatch,y){d.push(...S.promises);const R=l.filter(j=>typeof j.key=="string"&&j.key.startsWith(`${typeof v=="number"?`[${v}]`:v}/`)).map(j=>({key:j.key.slice(j.key.indexOf("/")+1),op:j.op,compare:j.compare}));if(R.length>0){const j=J.getChildPath(c,f.key),N=s(j,R).then(D=>({isMatch:D}));d.push(N)}}if(!y||h.length===0)return!1}),y&&(y=(yield Promise.all(d)).every(f=>f.isMatch)),y?(y=h.every(f=>{const p=new ab(Qe(re(re({},typeof f=="number"&&{index:f}),typeof f=="string"&&{key:f}),{exists:!1})),v=l.filter(S=>typeof S.key=="string"&&S.key.startsWith(`${typeof f=="number"?`[${f}]`:f}/`)).map(S=>({op:S.op,compare:S.compare}));if(v.length>0&&!a(p,v).isMatch)return!1;const w=l.filter(S=>S.key===f).map(S=>({op:S.op,compare:S.compare}));return w.length===0?!0:a(p,w).isMatch}),y):!1}catch(f){throw this.debug.error(`Error matching on "${c}": `,f),f}}),a=(c,l)=>{const u=[];return{isMatch:l.every(h=>{let y=!0;if(h.op==="!exists"||h.op==="=="&&(typeof h.compare=="undefined"||h.compare===null))y=!c.exists;else if(h.op==="exists"||h.op==="!="&&(typeof h.compare=="undefined"||h.compare===null))y=c.exists;else if((h.op==="contains"||h.op==="!contains")&&h.compare instanceof Array&&h.compare.length===0)y=!0;else if(!c.exists)y=!1;else if(c.address)if(c.valueType===se.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.op==="has"?"exists":"!exists",f=s(c.path,[{key:h.compare,op:d}]).then(p=>({key:c.key,isMatch:p}));u.push(f),y=!0}else if(c.valueType===se.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=this.getNode(c.path,{tid:o}).then(({value:f})=>{const p=h.op==="contains"?h.compare instanceof Array?h.compare.every(v=>f.includes(v)):f.includes(h.compare):h.compare instanceof Array?!h.compare.some(v=>f.includes(v)):!f.includes(h.compare);return{key:c.key,isMatch:p}});u.push(d),y=!0}else if(c.valueType===se.STRING){const d=this.getNode(c.path,{tid:o}).then(f=>({key:c.key,isMatch:this.test(f.value,h.op,h.compare)}));u.push(d),y=!0}else y=!1;else if(c.type===se.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.compare in c.value;y=d&&h.op==="has"||!d&&h.op==="!has"}else if(c.type===se.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=c.value.indexOf(h.compare)>=0;y=d&&h.op==="contains"||!d&&h.op==="!contains"}else{let d=this.test(c.value,h.op,h.compare);d instanceof Promise&&(u.push(d),d=!0),y=d}return y}),promises:u}};return s(e,t)})}test(e,t,r){if(t==="<")return e<r;if(t==="<=")return e<=r;if(t==="==")return e===r;if(t==="!=")return e!==r;if(t===">")return e>r;if(t===">=")return e>=r;if(t==="in")return r.indexOf(e)>=0;if(t==="!in")return r.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+r.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",o=new RegExp(i,"i").test(e.toString());return t==="like"?o:!o}if(t==="matches")return r.test(e.toString());if(t==="!matches")return!r.test(e.toString());if(t==="between")return e>=r[0]&&e<=r[1];if(t==="!between")return e<r[0]||e>r[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&r in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(r);return t==="contains"?i:!i}return!1}exportNode(e,t){return F(this,arguments,function*(r,i,o={format:"json",type_safe:!0}){if((o==null?void 0:o.format)!=="json")throw new Error("Only json output is currently supported");const s=typeof i!="function"?i.write.bind(i):i,a=(f,p)=>{const v=w=>w.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,S=>`\\u${S.charCodeAt(0).toString(16).padStart(4,"0")}`);return f===se.DATETIME?(p=`"${p.toISOString()}"`,o.type_safe&&(p=`{".type":"date",".val":${p}}`)):f===se.STRING?p=`"${v(p)}"`:f===se.ARRAY?p="[]":f===se.OBJECT?p="{}":f===se.BINARY?(p=`"${v(hr.encode(p))}"`,o.type_safe&&(p=`{".type":"binary",".val":${p}}`)):f===se.REFERENCE?(p=`"${p.path}"`,o.type_safe&&(p=`{".type":"reference",".val":${p}}`)):f===se.BIGINT&&(p=`"${p}"`,o.type_safe&&(p=`{".type":"bigint",".val":${p}}`)),p};let c="",l="";const u=yield this.getNodeInfo(r);if(u.exists)if(u.type===se.OBJECT)c="{",l="}";else if(u.type===se.ARRAY)c="[",l="]";else{const f=yield this.getNode(r),p=a(u.type,f.value);return s(p)}else return s("null");if(c){const f=s(c);f instanceof Promise&&(yield f)}let h="",y=0;const d=[];if(yield this.getChildren(r).next(f=>{f.address?d.push(f):(y++>0&&(h+=","),typeof f.key=="string"&&(h+=`"${f.key}":`),h+=a(f.type,f.value))}),h){const f=s(h);f instanceof Promise&&(yield f)}for(;d.length>0;){const f=d.shift();let p=y++>0?",":"";const v=typeof f.index=="number"?f.index:f.key;if(typeof v=="string"&&(p+=`"${v}":`),p){const w=s(p);w instanceof Promise&&(yield w)}yield this.exportNode(J.getChildPath(r,v),s,o)}if(l){const f=s(l);f instanceof Promise&&(yield f)}})}importNode(e,t){return F(this,arguments,function*(r,i,o={format:"json",method:"set"}){const s={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},a=(P=!1)=>F(this,null,function*(){let I=yield i(262144);if(I===null)throw s.data?new Error(`Unexpected EOF at index ${s.offset+s.data.length}`):new Error("Unable to read data from stream");typeof I=="object"&&(I=Kv(I)),P?s.data+=I:(s.offset+=s.data.length,s.data=I,s.index=0)}),c=P=>F(this,null,function*(){let I="";return s.index+P>=s.data.length&&(I=s.data.slice(s.index),P-=I.length,yield a()),I+=s.data.slice(s.index,s.index+P),s.index+=P,I}),l=P=>F(this,null,function*(){if(s.index+P>s.data.length&&(yield a(!0)),s.index+P>s.data.length)throw new Error("Not enough data available from stream")}),u=P=>F(this,null,function*(){const I=yield c(P.length);if(I!==P)throw new Error(`Unexpected character "${I[0]}" at index ${s.offset+s.index}, expected "${P}"`)}),h=()=>F(this,null,function*(){const P=[" ","	","\r",`
`];for(;s.index>=s.data.length&&(yield a()),P.includes(s.data[s.index]);)s.index++}),y=P=>F(this,null,function*(){yield l(P);const I=s.index;return s.data.slice(I,I+P)}),d=()=>F(this,null,function*(){yield h();const P=yield y(1);switch(P){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(P==="-"||P>="0"&&P<="9")return"number";throw new Error(`Unknown value at index ${s.offset+s.index}`)}}}),f=()=>F(this,null,function*(){yield u('"');let P="",I=s.index;for(;s.data[I]!=='"'||s.data[I-1]==="\\";)I++,I>=s.data.length&&(P+=s.data.slice(s.index),yield a(),I=0);return P+=s.data.slice(s.index,I),s.index=I+1,S(P)}),p=()=>F(this,null,function*(){throw s.data[s.index]==="t"?yield u("true"):s.data[s.index]==="f"&&(yield u("false")),new Error(`Expected true or false at index ${s.offset+s.index}`)}),v=()=>F(this,null,function*(){let P="",I=s.index;const B=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;B.includes(s.data[I]);)I++,I>=s.data.length&&(P+=s.data.slice(s.index),yield a(),I=0);return P+=s.data.slice(s.index,I),s.index=I,P.endsWith("n")?BigInt(P.slice(0,-1)):P.includes(".")?parseFloat(P):parseInt(P)}),w=()=>F(this,null,function*(){yield h();const P=yield d(),I=yield(()=>{switch(P){case"string":return f();case"object":return{};case"array":return[];case"number":return v();case"null":return null;case"undefined":return;case"boolean":return p()}})();return{type:P,value:I}}),S=P=>P.replace(/\\n/g,`
`).replace(/\\"/g,'"'),R=(P,I)=>{const B=I[".type"];let U=I[".val"];switch(B){case"Date":case"date":{U=new Date(U);break}case"Buffer":case"binary":{if(U=S(U),U.startsWith("<~"))U=hr.decode(U);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${P}"`);break}case"PathReference":case"reference":{U=new nt(U);break}case"bigint":{U=BigInt(U);break}default:throw new Error(`Import error: Unsupported type "${B}" for value at path "/${P}"`)}return U},j={acebase_import_id:Bt.generate()},N={suppress_events:o.suppress_events,context:j},D=P=>F(this,null,function*(){if(yield u("{"),yield h(),(yield y(1))==="}")return s.index++,this.setNode(P.path,{},N);let I=0,B={},U=!1;const M=()=>F(this,null,function*(){let g;U?Object.keys(B).length>0&&(g=this.updateNode(P.path,B,N)):(U=!0,g=this.setNode(P.path,B,N)),B={},g&&(yield g)}),E=[];for(;;){yield h();const g=yield f();yield h(),yield u(":"),yield h();const{value:b,type:m}=yield w();if(B[g]=b,I++,["object","array"].includes(m)&&(E.push(M()),m==="object"?yield D(P.child(g)):yield q(P.child(g))),yield h(),(yield y(1))==="}"){s.index++;break}yield u(",")}if(I===2&&".type"in B&&".val"in B){const g=R(P.path,B);return this.setNode(P.path,g,N)}E.push(M()),yield Promise.all(E)}),q=P=>F(this,null,function*(){if(yield u("["),yield h(),(yield y(1))==="]")return s.index++,this.setNode(P.path,[],N);let I=!1,B=[],U={};const M=()=>F(this,null,function*(){let m;I?Object.keys(U).length>0&&(m=this.updateNode(P.path,U,N),U={}):(I=!0,m=this.setNode(P.path,B,N),B=null),m&&(yield m)}),E=(m,x)=>{I?U[x]=m:B.push(m)},g=[];let b=0;for(;;){yield h();const{value:m,type:x}=yield w();if(E(m,b),["object","array"].includes(x)&&(g.push(M()),x==="object"?yield D(P.child(b)):yield q(P.child(b))),yield h(),(yield y(1))==="]"){s.index++;break}yield u(","),b++}g.push(M()),yield Promise.all(g)});return(()=>F(this,null,function*(){const{value:P,type:I}=yield w();if(["object","array"].includes(I)){const B=J.get(r);I==="object"?yield D(B):yield q(B)}else yield this.setNode(r,P,N)}))()})}setSchema(e,t,r=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const s=this._schemas.findIndex(a=>a.path===e);s>=0&&this._schemas.splice(s,1);return}const i=new dP(t,{warnOnly:r,warnCallback:s=>this.debug.warn(s)}),o=this._schemas.find(s=>s.path===e);o?o.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((s,a)=>{const c=J.getPathKeys(s.path),l=J.getPathKeys(a.path);return c.length===l.length?0:c.length<l.length?-1:1}))}getSchema(e){const t=this._schemas.find(r=>r.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,r={updates:!1}){let i={ok:!0};const o=J.get(e);return this._schemas.filter(s=>o.isOnTrailOf(s.path)).every(s=>{if(o.isDescendantOf(s.path)){const u=J.fillVariables(s.path,e),h=o.keys.slice(J.getPathKeys(s.path).length);return i=s.schema.check(u,t,r.updates,h),i.ok}const a=J.getPathKeys(s.path).slice(o.keys.length);if(r.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=r.updates===!0&&a.length===0,l=(u,h,y)=>{if(y.length===0)return s.schema.check(u,h,c);if(h===null)return{ok:!0};const d=y[0];if(typeof d=="string"&&(d==="*"||d[0]==="$")){if(h===null||typeof h!="object")return{ok:!0};let f;return Object.keys(h).every(p=>{const v=J.getChildPath(u,p),w=h[p];return f=l(v,w,y.slice(1)),f.ok}),f}else{const f=J.getChildPath(u,d),p=h[d];return l(f,p,y.slice(1))}};return i=l(e,t,a),i.ok}),i}}class zo{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return J}}class Zp{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:TP}=Gv;class Ed{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Bt.generate()}getChildCount(e){return F(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return F(this,null,function*(){const t=new Map;return yield Promise.all(e.map(r=>this.get(r).then(i=>t.set(r,i)))),t})}setMultiple(e){return F(this,null,function*(){yield Promise.all(e.map(({path:t,node:r})=>this.set(t,r)))})}removeMultiple(e){return F(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return F(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return F(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(zo.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class Ko extends xd{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,r=t?new cb(console,this.lockTimeout):null;this.getTransaction=i=>F(this,[i],function*({path:o,write:s}){const a=yield e.getTransaction({path:o,write:s});Kt(typeof a.id=="string","transaction id not set");const c=a.rollback,l=a.commit;return a.commit=()=>F(this,null,function*(){const u=yield l.call(a);return t&&(yield a._lock.release("commit")),u}),a.rollback=u=>F(this,null,function*(){const h=yield c.call(a,u);return t&&(yield a._lock.release("rollback")),h}),t&&(a._lock=yield r.lock(o,a.id,s,`${this.name}::getTransaction`)),a})}}class jl extends ab{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class PP extends SP{constructor(e,t,r){super(e,t,r),this._customImplementation=t,this._init()}_init(){return F(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize($t.dim)),this.debug.log("- Type: CustomStorage".colorize($t.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize($t.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize($t.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize($t.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,r){const i=s=>{if(s===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof s))return s;if(s instanceof Date)return{type:se.DATETIME,value:s.getTime()};if(s instanceof nt)return{type:se.REFERENCE,value:s.path};if(s instanceof ArrayBuffer)return{type:se.BINARY,value:hr.encode(s)};if(typeof s=="object")return Kt(Object.keys(s).length===0,"child object stored in parent can only be empty"),s},o="Caller should have pre-processed the value by converting it to a string";if(t.type===se.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${o}`);const s={};for(let a=0;a<t.value.length;a++)s[a]=t.value[a];t.value=s}if(t.type===se.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${o}`),t.value=hr.encode(t.value)),t.type===se.REFERENCE&&t.value instanceof nt&&(console.warn(`Unprocessed path reference. ${o}`),t.value=t.value.path),[se.OBJECT,se.ARRAY].includes(t.type)){const s=t.value;t.value={},Object.keys(s).forEach(a=>{t.value[a]=i(s[a])})}return r.transaction.set(e,t)}_processReadNodeValue(e){const t=r=>{if(r.type===se.BINARY)return hr.decode(r.value);if(r.type===se.DATETIME)return new Date(r.value);if(r.type===se.REFERENCE)return new nt(r.value);throw new Error(`Unhandled child value type ${r.type}`)};switch(e.type){case se.ARRAY:case se.OBJECT:{const r=e.value;Object.keys(r).forEach(i=>{const o=r[i];typeof o=="object"&&"type"in o&&(r[i]=t(o))}),e.value=r;break}case se.BINARY:{e.value=hr.decode(e.value);break}case se.REFERENCE:{e.value=new nt(e.value);break}case se.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return F(this,null,function*(){const r=yield t.transaction.get(e);return r===null?null:(typeof r!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(r),r)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=se.STRING;else if(typeof e=="number")t=se.NUMBER;else if(typeof e=="boolean")t=se.BOOLEAN;else if(e instanceof Array)t=se.ARRAY;else if(typeof e=="object")if("type"in e){const r=e;t=r.type,e=r.value,t===se.DATETIME?e=new Date(e):t===se.REFERENCE&&(e=new nt(e))}else t=se.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,r){return F(this,null,function*(){if(!r.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof r.diff=="undefined"&&typeof r.currentValue!="undefined"){const f=TP(r.currentValue,t);r.merge&&typeof f=="object"&&(f.removed=f.removed.filter(p=>t[p]===null)),r.diff=f}if(r.diff==="identical")return;const i=r.transaction,o=r.currentValue===null?null:yield this._readNode(e,{transaction:i});if(r.merge&&o){if(o.type===se.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(f=>isNaN(parseInt(f))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&o.type!==se.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const s=r.revision||Bt.generate(),a={type:o&&o.type===se.ARRAY?se.ARRAY:se.OBJECT,value:{}},c={};if(t instanceof Array){a.type=se.ARRAY;const f={};for(let p=0;p<t.length;p++)f[p]=t[p];t=f}else t instanceof nt?(a.type=se.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=se.BINARY,a.value=hr.encode(t)):typeof t=="string"&&(a.type=se.STRING,a.value=t);const l=o?[se.OBJECT,se.ARRAY].includes(o.type):!1,u=[se.OBJECT,se.ARRAY].includes(a.type),h={current:[],new:[]};let y=null;l&&(y=o.value,h.current=Object.keys(y),u&&(a.value=y)),u&&(r.merge||Object.keys(a.value).forEach(f=>{f in t||(t[f]=null)}),Object.keys(t).forEach(f=>{const p=t[f];if(delete a.value[f],p!==null){if(typeof p=="undefined")if(this.settings.removeVoidProperties===!0){delete t[f];return}else throw new Error(`Property "${f}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(p)?a.value[f]=p:c[f]=p}}));const d=a.type===se.ARRAY;if(o){if(this.debug.log(`Node "/${e}" is being ${r.merge?"updated":"overwritten"}`.colorize($t.cyan)),l||u){const p=J.get(e),v=[];let w=!1;const S=I=>(w=!0,!i.production&&!p.isParentOf(I)&&this.throwImplementationError(`"${I}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),R=I=>{w||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const B=J.get(I).key;return v.push(B.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},S,R),h.current=h.current.concat(v),u&&(r&&r.merge&&(h.new=h.current.slice()),Object.keys(t).forEach(I=>{h.new.includes(I)||h.new.push(I)}));const j={insert:h.new.filter(I=>!h.current.includes(I)),update:[],delete:r&&r.merge?Object.keys(t).filter(I=>t[I]===null):h.current.filter(I=>!h.new.includes(I))};if(j.update=h.new.filter(I=>h.current.includes(I)&&!j.delete.includes(I)),d&&r.merge&&(j.insert.length>0||j.delete.length>0)&&!j.update.concat(j.insert).every((I,B,U)=>U.includes(B.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const N=Object.keys(c).map(I=>{const B=d?parseInt(I):I,U=typeof r.diff=="object"?r.diff.forChild(B):void 0;if(U==="identical")return;const M=p.childPath(B),E=c[B],g=typeof r.currentValue=="undefined"?void 0:r.currentValue!==null&&typeof r.currentValue=="object"&&B in r.currentValue?r.currentValue[B]:null;return this._writeNode(M,E,{transaction:i,revision:s,merge:!1,currentValue:g,diff:U})}),D=u?v.filter(I=>I in a.value):[],q=j.delete.concat(D).map(I=>{const B=d?parseInt(I):I,U=p.childPath(B);return this._deleteNode(U,{transaction:i})}),P=N.concat(q);yield Promise.all(P)}const f=this._storeNode(e,{type:a.type,value:a.value,revision:o.revision,revision_nr:o.revision_nr+1,created:o.created,modified:Date.now()},{transaction:i});if(f instanceof Promise)return yield f}else{if(this.debug.log(`Node "/${e}" is being created`.colorize($t.cyan)),d&&!Object.keys(a.value).concat(Object.keys(c)).every((v,w,S)=>S.includes(w.toString())))throw new Error("Cannot store arrays with missing entries");const f=Object.keys(c).map(v=>{const w=d?parseInt(v):v,S=J.getChildPath(e,w),R=c[w];return this._writeNode(S,R,{transaction:i,revision:s,merge:!1,currentValue:null})}),p=this._storeNode(e,{type:a.type,value:a.value,revision:s,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});p instanceof Promise&&f.push(p),yield Promise.all(f)}})}_deleteNode(e,t){return F(this,null,function*(){const r=J.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize($t.cyan));const i=[e];let o=!1;const s=l=>(o=!0,!c.production&&!r.isAncestorOf(l)&&this.throwImplementationError(`"${l}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=l=>(o||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(l),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},s,a),this.debug.log(`Nodes ${i.map(l=>`"/${l}"`).join(",")} are being deleted`.colorize($t.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let r;const i={next(s){return r=s,o()}},o=()=>F(this,null,function*(){const s=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>F(this,null,function*(){const c=yield this._readNode(e,{transaction:s});if(!c)throw new wd(`Node "/${e}" does not exist`);if(![se.OBJECT,se.ARRAY].includes(c.type))return;const l=c.type===se.ARRAY,u=c.value;let h=Object.keys(u).map(v=>l?parseInt(v):v);t.keyFilter&&(h=h.filter(v=>t.keyFilter.includes(v)));const y=J.get(e);if(h.length>0&&h.every(v=>{const w=this._getTypeFromStoredValue(u[v]),S=new jl({path:y.childPath(v),key:l?null:v,index:l?v:null,type:w.type,address:null,exists:!0,value:w.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=r(S)===!1,!a}),a)return;let d=!1;const f=v=>{if(d=!0,!s.production&&!y.isParentOf(v)&&this.throwImplementationError(`"${v}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const w=J.get(v).key;return t.keyFilter.includes(w)}return!0},p=(v,w)=>{d||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const S=J.get(v).key,R=new jl({path:v,type:w.type,key:l?null:S,index:l?S:null,address:new Zp(v),exists:!0,value:null,revision:w.revision,revision_nr:w.revision_nr,created:new Date(w.created),modified:new Date(w.modified)});return a=r(R)===!1,!a};yield s.childrenOf(e,{metadata:!0,value:!1},f,p)}))(),t.transaction||(yield s.commit()),a}catch(a){throw t.transaction||(yield s.rollback(a)),a}});return i}getNode(e,t){return F(this,null,function*(){t=t||{};const r=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>F(this,null,function*(){const o=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,s=J.get(e),a=yield this._readNode(e,{transaction:r});if(!a){if(e==="")return{value:null};const R=yield r.moveToParentPath(s.parentPath);Kt(R===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const j=yield this._readNode(s.parentPath,{transaction:r});if(j&&[se.OBJECT,se.ARRAY].includes(j.type)&&s.key in j.value){const N=this._getTypeFromStoredValue(j.value[s.key]);return{revision:j.revision,revision_nr:j.revision_nr,created:j.created,modified:j.modified,type:N.type,value:N.value}}return{value:null}}const c=a.type===se.ARRAY,l=R=>{const j=N=>/^[0-9]+$/.test(N);return R.map(N=>J.get(c&&j(N)?`[${N}]`:N))},u=t.include?l(t.include):[],h=t.exclude?l(t.exclude):[],y=(R,j)=>{if([se.OBJECT,se.ARRAY].includes(j.type)&&u.length>0){const N=J.getPathKeys(R).slice(s.keys.length),D=new J(N),q=[],P=u.filter(B=>B.isDescendantOf(D));if(P.length>0){const B=j.type===se.ARRAY;q.push(...Object.keys(j.value).map(U=>B?+U:U));for(const U of P){const M=U.keys[N.length];if(typeof M=="string"&&(M==="*"||M.startsWith("$"))){q.splice(0);break}const E=q.indexOf(M);E>=0&&q.splice(E,1)}}const I=u.some(B=>B.isChildOf(D));if(h.some(B=>B.isChildOf(D))&&!I){const B=h.filter(U=>U.isChildOf(D));for(let U=0;U<q.length;U++)B.find(M=>M.equals(q[U]))||(q.splice(U,1),U--)}for(const B of q)delete j.value[B]}};y(e,a);let d=!1;const f=(R,j)=>{if(d=!0,!r.production&&!s.isAncestorOf(R)&&this.throwImplementationError(`"${R}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!o)return!0;const N=J.getPathKeys(R).slice(s.keys.length),D=new J(N);let q=(u.length>0?u.some(P=>D.isOnTrailOf(P)):!0)&&(h.length>0?!h.some(P=>P.equals(D)||P.isAncestorOf(D)):!0);return q&&t.child_objects===!1&&(s.isParentOf(R)&&[se.OBJECT,se.ARRAY].includes(j?j.type:-1)||J.getPathKeys(R).length>s.pathKeys.length+1)&&(q=!1),q},p=[],v=(R,j)=>{if(d||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[se.OBJECT,se.ARRAY].includes(j.type))return!0;y(R,j),this._processReadNodeValue(j);const N=j;return N.path=R,p.push(N),!0};yield r.descendantsOf(e,{metadata:!0,value:!0},f,v),this.debug.log(`Read node "/${e}" and ${o?"(filtered) ":""}descendants from ${p.length+1} records`.colorize($t.magenta));const w=a,S=R=>{const j=[];return Object.keys(R).forEach(N=>{const D=parseInt(N);j[D]=R[D]}),j};if(a.type===se.ARRAY&&(w.value=S(w.value)),a.type===se.OBJECT||a.type===se.ARRAY){const R=J.getPathKeys(e),j=a.value;for(let N=0;N<p.length;N++){const D=p[N],q=J.getPathKeys(D.path).slice(R.length);let P=j;for(let I=0;I<q.length;I++){Kt(typeof P=="object","parent must be an object/array to have children!!");const B=q[I],U=I===q.length-1,M=U?D.type:typeof q[I+1]=="number"?se.ARRAY:se.OBJECT;let E;U?(E=D.value,M===se.ARRAY&&(E=S(E))):E=M===se.OBJECT?{}:[],B in P?typeof P[B]==typeof E&&[se.OBJECT,se.ARRAY].includes(M)?Object.keys(E).forEach(g=>{g in P[B]&&this.throwImplementationError(`Custom storage merge error: child key "${g}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),P[B][g]=E[g]}):this.debug.error(`The value stored in node "${D.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:P,key:B,nodeType:M,nodeValue:E}):P[B]=E,P=P[B]}}}else p.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(w.value).forEach(R=>{typeof w.value[R]=="object"&&w.value[R].constructor===Object&&(Kt(Object.keys(w.value[R]).length===0),delete w.value[R])}),t.include,t.exclude){const R=(j,N)=>{if(typeof j!="object")return;const D=N[0];D==="*"?Object.keys(j).forEach(q=>{R(j[q],N.slice(1))}):N.length>1?D in j&&R(j[D],N.slice(1)):delete j[D]};t.exclude.forEach(j=>{const N=J.getPathKeys(j);R(w.value,N)})}return w}))();return t.transaction||(yield r.commit()),i}catch(i){throw t.transaction||(yield r.rollback(i)),i}})}getNodeInfo(e){return F(this,arguments,function*(t,r={}){r=r||{};const i=J.get(t),o=r.transaction||(yield this._customImplementation.getTransaction({path:t,write:!1}));try{const s=yield this._readNode(t,{transaction:o}),a=new jl({path:t,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:s?s.type:0,exists:s!==null,address:s?new Zp(t):null,created:s?new Date(s.created):null,modified:s?new Date(s.modified):null,revision:s?s.revision:null,revision_nr:s?s.revision_nr:null});if(!s&&t!==""){const c=yield o.moveToParentPath(i.parentPath);Kt(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${t}"`);const l=yield this._readNode(i.parentPath,{transaction:o});l&&[se.OBJECT,se.ARRAY].includes(l.type)&&i.key in l.value?(a.exists=!0,a.value=l.value[i.key],a.address=null,a.type=l.type,a.created=new Date(l.created),a.modified=new Date(l.modified),a.revision=l.revision,a.revision_nr=l.revision_nr):a.address=null}return r.include_child_count&&(a.childCount=0,[se.OBJECT,se.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=s.value?Object.keys(s.value).length:0,a.childCount+=yield o.getChildCount(t))),r.transaction||(yield o.commit()),a}catch(s){throw r.transaction||(yield o.rollback(s)),s}})}setNode(e,t){return F(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const s=J.get(r),a=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{if(r===""){if(i===null||typeof i!="object"||i instanceof Array||i instanceof ArrayBuffer||"buffer"in i&&i.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${i}`);yield this._writeNodeWithTracking("",i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context})}else if(typeof o.assert_revision!="undefined"){const c=yield this.getNodeInfo(r,{transaction:a});if(c.revision!==o.assert_revision)throw new Mu(`revision '${c.revision}' does not match requested revision '${o.assert_revision}'`);if(c.address&&c.address.path===r&&i!==null&&!this.valueFitsInline(i))yield this._writeNodeWithTracking(r,i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context});else{const l=yield a.moveToParentPath(s.parentPath);Kt(l===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(s.parentPath,{[s.key]:i},{merge:!0,transaction:a,suppress_events:o.suppress_events,context:o.context})}}else{const c=yield a.moveToParentPath(s.parentPath);Kt(c===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(s.parentPath,{[s.key]:i},{transaction:a,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield a.commit())}catch(c){throw o.transaction||(yield a.rollback(c)),c}})}updateNode(e,t){return F(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof i!="object")throw new Error("invalid updates argument");if(Object.keys(i).length===0)return;const s=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{const a=yield this.getNodeInfo(r,{transaction:s}),c=J.get(r);if(a.exists&&a.address&&a.address.path===r)yield this._writeNodeWithTracking(r,i,{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context});else if(a.exists){const l=J.get(r),u=yield s.moveToParentPath(l.parentPath);Kt(u===l.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(l.parentPath,{[l.key]:i},{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context})}else{const l=yield s.moveToParentPath(c.parentPath);Kt(l===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(c.parentPath,{[c.key]:i},{transaction:s,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield s.commit())}catch(a){throw o.transaction||(yield s.rollback(a)),a}})}}class jP{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return F(this,null,function*(){var r,i;try{this.running++;const o=yield e();if(this.results[t]=o,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(r=this.doneCallback)==null||r.call(this,this.results);else if(this.scheduled.length>0){const s=this.scheduled.shift();this.execute(s.task,s.index)}}catch(o){this.done=!0,(i=this.errorCallback)==null||i.call(this,o)}})}add(e){var t;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const r=this.added++;((t=this.options)==null?void 0:t.wait)!==!0&&this.running<this.limit?this.execute(e,r):this.scheduled.push({task:e,index:r})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return F(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const CP=()=>{};function ub(n,e,t){return F(this,arguments,function*(r,i,o,s={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:CP}){var a,c,l,u,h,y;typeof s!="object"&&(s={}),typeof s.snapshots=="undefined"&&(s.snapshots=!1);const d={};(a=r.storage.settings.transactions)!=null&&a.log&&(d.acebase_cursor=Bt.generate());const f=o.filters.map(E=>re({},E)),p=o.order.map(E=>re({},E)),v=E=>{E.sort((g,b)=>{const m=x=>{const O=p[x],k=J.getPathKeys(typeof O.key=="number"?`[${O.key}]`:O.key),$=k.reduce((A,T)=>A!==null&&typeof A=="object"&&T in A?A[T]:null,g.val),_=k.reduce((A,T)=>A!==null&&typeof A=="object"&&T in A?A[T]:null,b.val);return $===null?_===null?0:O.ascending?-1:1:_===null?O.ascending?1:-1:$==_?x<p.length-1?m(x+1):g.path<b.path?-1:1:$<_?O.ascending?-1:1:O.ascending?1:-1};return m(0)})},w=(E,g)=>F(this,null,function*(){if(E.length===0)return[];const b=50,m=new jP(b),x=[];return E.forEach(({path:O},k)=>m.add(()=>F(this,null,function*(){const $=(yield r.storage.getNode(O,g)).value;if($===null){r.storage.debug.warn(`Indexed result "/${O}" does not have a record!`);return}const _={path:O,val:$};M.sorted?x[k]=_:(x.push(_),!M.skipped&&x.length>o.skip+Math.abs(o.take)&&(v(x),x.pop()))}))),yield m.finish(),x}),S=J.get(i),R=S.keys.some(E=>E==="*"||E.toString().startsWith("$")),j=r.storage.indexes.get(i),N=[];let D=()=>F(this,null,function*(){});if(R){const E=S.keys.filter(m=>typeof m=="string"&&m.startsWith("$")),g=E.length>0&&E.every(m=>o.filters.some(x=>x.key===m&&["==","in"].includes(x.op))),b=typeof s.monitor=="object"&&[(c=s.monitor)==null?void 0:c.add,(l=s.monitor)==null?void 0:l.change,(u=s.monitor)==null?void 0:u.remove].some(m=>m===!0);if(g&&!b){const m=[];for(const A of E){const T=o.filters.filter(L=>L.key===A).reduce((L,V)=>{if(V.op==="=="&&L.push(V.compare),V.op==="in"){if(!(V.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");L.push(...V.compare)}return L},[]),C=m.splice(0);T.forEach(L=>{C.length===0?m.push({[A]:L}):m.push(...C.map(V=>Qe(re({},V),{[A]:L})))})}const x=o.filters.filter(A=>!E.includes(A.key)),O=m.map(A=>J.get(J.getPathKeys(i).map(T=>{var C;return(C=A[T])!=null?C:T})).path),k=o.order.length>0,$=O.map(A=>{var T;return ub(r,A,{filters:x,take:0,skip:0,order:[]},{snapshots:k,cache_mode:s.cache_mode,include:[...(T=s.include)!=null?T:[],...o.order.map(C=>C.key)],exclude:s.exclude})});let _=(yield Promise.all($)).reduce((A,T)=>(A.push(...T.results),A),[]);if(k&&v(_),o.skip>0&&_.splice(0,o.skip),o.take>0&&_.splice(o.take),s.snapshots&&(!k||((h=s.include)==null?void 0:h.length)>0||((y=s.exclude)==null?void 0:y.length)>0||!s.child_objects)){const{include:A,exclude:T,child_objects:C}=s;_=yield w(_,{include:A,exclude:T,child_objects:C})}return{results:_,context:null,stop:D}}else if(j.length===0){const m=new Error(`Query on wildcard path "/${i}" requires an index`);return Promise.reject(m)}if(f.length===0){const m=j.filter(x=>x.type==="normal")[0];f.push({key:m.key,op:"!=",compare:null})}}f.forEach(E=>{if(E.index)return;const g=j.filter(b=>b.key===E.key).filter(b=>b.validOperators.includes(E.op));if(g.length>=1){const b=f.filter(k=>k!==E).map(k=>k.key),m=p.map(k=>k.key).filter(k=>k!==E.key),x=g.map(k=>{const $=k.includeKeys.concat(k.key),_=$.filter(L=>b.includes(L)),A=$.filter(L=>m.includes(L)),T=_.concat(A.filter(L=>!_.includes(L))),C={filters:_.length,sorting:A.length*(o.take!==0?A.length:1),both:T.length*T.length,get total(){return this.filters+this.sorting+this.both}};return{index:k,points:C.total,filterKeys:_,sortKeys:A}});x.sort((k,$)=>k.points>$.points?-1:1);const O=x[0];E.index=O.index,O.filterKeys.forEach(k=>{f.filter($=>$!==E&&$.key===k).forEach($=>{!kd.validOperators.includes($.op)||($.indexUsage="filter",$.index=O.index)})}),O.sortKeys.forEach(k=>{p.filter($=>$.key===k).forEach($=>{$.index=O.index})})}E.index&&N.push({index:E.index,description:E.index.description})}),p.length>0&&o.take!==0&&f.length===0&&p.forEach(E=>{E.index||(E.index=j.filter(g=>g.key===E.key).find(g=>g.type==="normal"))});const q=N.map(E=>E.description).join(", ");N.length>0&&r.storage.debug.log(`Using indexes for query: ${q}`);const P=f.filter(E=>!E.index),I=/^[a-z]+:/i;if(P.some(E=>I.test(E.op))){const E=P.find(b=>I.test(b.op)),g=new Error(`query contains operator "${E.op}" which requires a special index that was not found on path "${i}", key "${E.key}"`);return Promise.reject(g)}const B=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let E=0;E<P.length;E++){const g=P[E];if(!B.includes(g.op))return Promise.reject(new Error(`query contains unknown filter operator "${g.op}" on path "${i}", key "${g.key}"`))}if(R&&P.length>0){const E=P.reduce((b,m)=>(b.indexOf(m.key)<0&&b.push(m.key),b),[]).map(b=>`"${b}"`),g=new Error(`This wildcard path query on "/${i}" requires index(es) on key(s): ${E.join(", ")}. Create the index(es) and retry`);return Promise.reject(g)}const U=[];f.forEach(E=>{if(E.index&&E.indexUsage!=="filter"){let g=E.index.query(E.op,E.compare).then(m=>(s.eventHandler&&s.eventHandler({name:"stats",type:"index_query",source:E.index.description,stats:m.stats}),m.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"index_query",source:E.index.description,hints:m.hints}),m));const b=f.filter(m=>m.index===E.index&&m.indexUsage==="filter");b.length>0&&(g=g.then(m=>(b.forEach(x=>{const{key:O,op:k,index:$}=x;let{compare:_}=x;typeof _=="string"&&!$.caseSensitive&&(_=_.toLocaleLowerCase($.textLocale)),m=m.filterMetadata(O,k,_)}),m))),U.push(g)}});const M={filtered:f.length===0,skipped:o.skip===0,taken:o.take===0,sorted:p.length===0,preDataLoaded:!1,dataLoaded:!1};if(f.length===0&&o.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${i}"`),o.take=100),p.length>0&&p[0].index){const E=p[0].index,g=o.take<0?!p[0].ascending:p[0].ascending;if(f.length===0&&p.slice(1).every(b=>E.allMetadataKeys.includes(b.key))){r.storage.debug.log(`Using index for sorting: ${E.description}`);const b=p.slice(1).map(x=>(x.index=E,{key:x.key,ascending:x.ascending})),m=E.take(o.skip,Math.abs(o.take),{ascending:g,metadataSort:b}).then(x=>(s.eventHandler&&s.eventHandler({name:"stats",type:"sort_index_take",source:E.description,stats:x.stats}),x.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"sort_index_take",source:E.description,hints:x.hints}),x));U.push(m),M.skipped=!0,M.taken=!0,M.sorted=!0}}return Promise.all(U).then(E=>F(this,null,function*(){let g=[];if(E.length===1){const _=E[0];g=_.map(A=>{const T={key:A.key,path:A.path,val:{[_.filterKey]:A.value}};return A.metadata&&Object.assign(T.val,A.metadata),T}),M.filtered=!0}else if(E.length>1){E.sort((T,C)=>T.length<C.length?-1:1);const _=E[0],A=E.slice(1);g=_.reduce((T,C)=>{const L={key:C.key,path:C.path,val:{[_.filterKey]:C.value}};return A.every(V=>V.findIndex(K=>K.path===C.path)>=0)&&(C.metadata&&Object.assign(L.val,C.metadata),A.forEach(V=>{const K=V.find(G=>G.path===L.path);L.val[V.filterKey]=K.value,K.metadata&&Object.assign(L.val,K.metadata)}),T.push(L)),T},[]),M.filtered=!0}if(R||U.length>0&&P.length===0){if(p.length===0||p.every(_=>_.index)){if(M.preDataLoaded=!0,!M.sorted&&p.length>0&&v(g),M.sorted=!0,!M.skipped&&o.skip>0&&(g=o.take<0?g.slice(0,-o.skip):g.slice(o.skip)),!M.taken&&o.take!==0&&(g=o.take<0?g.slice(o.take):g.slice(0,o.take)),M.skipped=!0,M.taken=!0,!s.snapshots)return g;const _={include:s.include,exclude:s.exclude,child_objects:s.child_objects};return w(g,_).then(A=>(M.dataLoaded=!0,A))}if(s.snapshots||!M.sorted){const _=p.length>0,A=_?{include:p.map(T=>T.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects};return w(g,A).then(T=>(p.length>0&&v(T),M.sorted=!0,o.skip>0&&(T=o.take<0?T.slice(0,-o.skip):T.slice(o.skip)),o.take!==0&&(T=o.take<0?T.slice(o.take):T.slice(0,o.take)),M.skipped=!0,M.taken=!0,s.snapshots&&_?w(T,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}):T))}else return g}let b;g.length>0&&(b=g.map(_=>_.key));let m=[],x=!1;const O=p.length>0,k=O?{include:p.map(_=>_.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects},$={promises:[],add(_){if(this.promises.push(_),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then(A=>{})}};try{yield r.storage.getChildren(i,{keyFilter:b,async:!0}).next(_=>{if(_.type!==se.OBJECT||!_.address)return;if(x)return!1;const A=()=>F(this,null,function*(){if(!(yield r.storage.matchNode(_.address.path,P)))return;const C=_.address.path;let L;if(s.snapshots||p.length>0){const V=yield r.storage.getNode(C,k);L={path:C,val:V.value}}else L={path:C};m.push(L),o.take!==0&&m.length>Math.abs(o.take)+o.skip&&(p.length>0?v(m):o.take>0&&(x=!0),m.pop())}),T=$.add(A());if(T instanceof Promise)return T})}catch(_){return _ instanceof wd||r.storage.debug.warn(`Error getting child stream: ${_}`),[]}return yield Promise.all($.promises),M.preDataLoaded=O,M.dataLoaded=!O,p.length>0&&v(m),M.sorted=!0,o.skip>0&&(m=o.take<0?m.slice(0,-o.skip):m.slice(o.skip)),M.skipped=!0,o.take!==0&&(m=o.take<0?m.slice(o.take):m.slice(0,o.take)),M.taken=!0,M.dataLoaded||(m=yield w(m,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}),M.dataLoaded=!0),m})).then(E=>{if(!M.sorted&&p.length>0&&v(E),s.snapshots||(E=E.map(g=>g.path)),!M.skipped&&o.skip>0&&(E=o.take<0?E.slice(0,-o.skip):E.slice(o.skip)),!M.taken&&o.take!==0&&(E=o.take<0?E.slice(o.take):E.slice(0,o.take)),s.monitor===!0&&(s.monitor={add:!0,change:!0,remove:!0}),typeof s.monitor=="object"&&(s.monitor.add||s.monitor.change||s.monitor.remove)){const g=s.monitor,b=s.snapshots?E.map(T=>T.path):E.slice(),m=r.db.ref(i),x=T=>{const C=b.indexOf(T);C<0||b.splice(C,1)},O=T=>{b.includes(T)||b.push(T)},k=()=>{r.unsubscribe(m.path,"child_changed",$),r.unsubscribe(m.path,"child_added",_),r.unsubscribe(m.path,"notify_child_removed",A)};D=()=>F(this,null,function*(){k()});const $=(T,C,L,V)=>F(this,null,function*(){const K=b.includes(C);let G=!0;const ie=[];f.forEach(ne=>!ie.includes(ne.key)&&ie.push(ne.key));const ee=[];typeof V=="object"&&Object.keys(V).forEach(ne=>!ee.includes(ne)&&ee.push(ne)),typeof L=="object"&&Object.keys(L).forEach(ne=>!ee.includes(ne)&&ee.push(ne));const fe=[];let de=ee.every(ne=>ie.includes(ne)?f.filter(ce=>ce.key===ne).every(ce=>{var Me;return((Me=ce.index)==null?void 0:Me.textLocaleKey)&&!ee.includes(ce.index.textLocaleKey)?(fe.push(ce.index.textLocaleKey),!0):B.includes(ce.op)?r.storage.test(L[ne],ce.op,ce.compare):ce.index.test(L,ce.op,ce.compare)}):!0);if(de&&(fe.push(...ie.filter(ne=>!ee.includes(ne))),!K&&fe.length>0)){const ne=f.filter(ve=>fe.includes(ve.key)),ce=ne.filter(ve=>B.includes(ve.op)),Me=ne.filter(ve=>!B.includes(ve.op));if(ce.length>0&&(de=yield r.storage.matchNode(C,ce)),de&&Me.length>0){const ve=Me.reduce((Ce,Xe)=>(Ce.includes(Xe.key)||Ce.push(Xe.key),Xe.index instanceof lb&&Xe.index.config.localeKey&&!Ce.includes(Xe.index.config.localeKey)&&Ce.push(Xe.index.config.localeKey),Ce),[]),Vt=yield r.storage.getNode(C,{include:ve});if(Vt.value===null)return!1;de=Me.every(Ce=>Ce.index.test(Vt.value,Ce.op,Ce.compare))}}if(de){if(K||O(C),s.snapshots){const ne={include:s.include,exclude:s.exclude,child_objects:s.child_objects};L=(yield r.storage.getNode(C,ne)).value}K&&g.change?G=s.eventHandler({name:"change",path:C,value:L})!==!1:!K&&g.add&&(G=s.eventHandler({name:"add",path:C,value:L})!==!1)}else K&&(x(C),g.remove&&(G=s.eventHandler({name:"remove",path:C,value:V})!==!1));G===!1&&k()}),_=(T,C,L)=>{const V=f.every(G=>B.includes(G.op)?r.storage.test(L[G.key],G.op,G.compare):G.index.test(L,G.op,G.compare));let K=!0;V&&(O(C),g.add&&(K=s.eventHandler({name:"add",path:C,value:s.snapshots?L:null})!==!1)),K===!1&&k()},A=(T,C,L,V)=>{let K=!0;x(C),g.remove&&(K=s.eventHandler({name:"remove",path:C,value:s.snapshots?V:null})!==!1),K===!1&&k()};(s.monitor.add||s.monitor.change||s.monitor.remove)&&r.subscribe(m.path,"child_changed",$),s.monitor.remove&&r.subscribe(m.path,"notify_child_removed",A),s.monitor.add&&r.subscribe(m.path,"child_added",_)}return{results:E,context:d,stop:D}})})}class RP extends oP{constructor(e="default",t,r){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(Gp&&t.settings.storage instanceof Gp)this.storage=new fP(e,t.settings.storage,i);else if(Xp&&t.settings.storage instanceof Xp)this.storage=new pP(e,t.settings.storage,i);else if(Ko&&t.settings.storage instanceof Ko)this.storage=new PP(e,t.settings.storage,i);else{const o=t.settings.storage instanceof Tl?t.settings.storage:new Tl(t.settings.storage);this.storage=new Vu(e,o,i)}else this.storage=new Vu(e,new Tl,i);this.storage.on("ready",r)}stats(e){return F(this,null,function*(){return this.storage.stats})}subscribe(e,t,r){this.storage.subscriptions.add(e,t,r)}unsubscribe(e,t,r){this.storage.subscriptions.remove(e,t,r)}set(e,t){return F(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.setNode(r,i,{suppress_events:o.suppress_events,context:o.context});return re({},s&&{cursor:s})})}update(e,t){return F(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.updateNode(r,i,{suppress_events:o.suppress_events,context:o.context});return re({},s&&{cursor:s})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return F(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const r=yield this.storage.getNode(e,t);return{value:r.value,context:{acebase_cursor:r.cursor},cursor:r.cursor}})}transaction(e,t){return F(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.transactNode(r,i,{suppress_events:o.suppress_events,context:o.context});return re({},s&&{cursor:s})})}exists(e){return F(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(e,t){return F(this,arguments,function*(r,i,o={snapshots:!1}){return yield ub(this,r,i,o)})}createIndex(e,t,r){return this.storage.indexes.create(e,t,r)}getIndexes(){return F(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return F(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,r){return F(this,null,function*(){r=r||{};const i=(o,s=50,a=0,c=null)=>F(this,null,function*(){typeof s=="string"&&(s=parseInt(s)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const l=[];let u=0,h=!1,y=!1;return yield this.storage.getChildren(o).next(d=>{if(h)return y=!0,!1;u++,(c!==null?d.key>c:a===0||u>a)&&l.push(re({key:typeof d.key=="string"?d.key:d.index,type:d.valueTypeName,value:d.value},typeof d.address=="object"&&"pageNr"in d.address&&{address:{pageNr:d.address.pageNr,recordNr:d.address.recordNr}})),h=s>0&&l.length===s}).catch(d=>{if(!(d instanceof wd))throw d}),{more:y,list:l}});switch(t){case"children":return yield i(e,r.limit,r.skip,r.from);case"info":{const o={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},s=yield this.storage.getNodeInfo(e,{include_child_count:r.child_count===!0});o.key=typeof s.key!="undefined"?s.key:s.index,o.exists=s.exists,o.type=s.exists?s.valueTypeName:void 0,o.value=s.value,o.address=typeof s.address=="object"&&"pageNr"in s.address?{pageNr:s.address.pageNr,recordNr:s.address.recordNr}:void 0;const a=s.exists&&s.address&&[se.OBJECT,se.ARRAY].includes(s.type);return r.child_count===!0?o.children={count:a?s.childCount:0}:typeof r.child_limit=="number"&&r.child_limit>0&&a&&(o.children=yield i(e,r.child_limit,r.child_skip,r.child_from)),o}}})}export(e,t,r={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,r)}import(e,t,r={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,r)}setSchema(e,t,r=!1){return F(this,null,function*(){return this.storage.setSchema(e,t,r)})}getSchema(e){return F(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return F(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,r){return F(this,null,function*(){return this.storage.validateSchema(e,t,{updates:r})})}getMutations(e){return F(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return F(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class IP extends xd{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class NP extends Ed{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return F(this,null,function*(){})}rollback(e){return F(this,null,function*(){})}get(e){return F(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return F(this,null,function*(){const r=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),r)})}remove(e){return F(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,r,i){return F(this,null,function*(){const o=zo.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isParentOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}descendantsOf(e,t,r,i){return F(this,null,function*(){const o=zo.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isAncestorOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function BP(n,e={}){const t=new IP(e),r=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new Ko({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return F(this,null,function*(){})},getTransaction(s){return F(this,null,function*(){const a={debug:!0,dbname:n,localStorage:r};return new NP(a,s)})}}),o=new ps(n,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return o.settings.ipcEvents=t.multipleTabs===!0,o}class LP extends xd{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class hb extends ob{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class DP extends iP{constructor(e,t={}){const r=new hb(t);super(e,r),this.recovery={repairNode:(o,s)=>F(this,null,function*(){if(yield this.ready(),this.api.storage instanceof Vu)yield this.api.storage.repairNode(o,s);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:o=>F(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(o)})};const i={db:this,settings:r};this.api=new RP(e,i,()=>{this.emit("ready")})}close(){return F(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(r){t.setLevel(r)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(r){e.eventsEnabled=r}}}static WithLocalStorage(e,t={}){return BP(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function ey(n){return new Promise((e,t)=>{n.onsuccess=r=>e(n.result||null),n.onerror=t})}class UP extends Ed{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,r=re({},e);return delete r.value,{metadata:r,value:t}}commit(){return F(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(r=>r.path)});const t=this._createTransaction(!0);try{yield new Promise((r,i)=>{let o=!1,s=0;const a=l=>{o=!0,i(l)},c=()=>{++s===e.length&&r()};e.forEach((l,u)=>{if(o)return;let h,y;const d=l.path;if(l.action==="set"){const{metadata:p,value:v}=this._splitMetadata(l.node),w={path:d,metadata:p};h=t.objectStore("nodes").put(w),y=t.objectStore("content").put(v,d),this.context.cache.set(d,l.node)}else l.action==="remove"?(h=t.objectStore("content").delete(d),y=t.objectStore("nodes").delete(d),this.context.cache.set(d,null)):a(new Error(`Unknown pending operation "${l.action}" on path "${d}" `));let f=0;h.onsuccess=y.onsuccess=()=>{++f===2&&c()},h.onerror=y.onerror=a})}),t.commit&&t.commit()}catch(r){throw console.error(r),t.abort&&t.abort(),r}})}rollback(e){return F(this,null,function*(){this._pending=[]})}get(e){return F(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),r=ey(t.objectStore("nodes").get(e)),i=ey(t.objectStore("content").get(e));try{const o=yield Promise.all([r,i]);t.commit&&t.commit();const s=o[0];if(!s)return this.context.cache.set(e,null),null;const a=s.metadata;return a.value=o[1],this.context.cache.set(e,a),a}catch(o){throw console.error("IndexedDB get error",o),t.abort&&t.abort(),o}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return F(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,r,i){return this._getChildrenOf(e,Qe(re({},t),{descendants:!1}),r,i)}descendantsOf(e,t,r,i){return this._getChildrenOf(e,Qe(re({},t),{descendants:!0}),r,i)}_getChildrenOf(e,t,r,i){return new Promise((o,s)=>{const a=zo.PathInfo.get(e),c=this._createTransaction(!1),l=c.objectStore("nodes"),u=IDBKeyRange.lowerBound(e,!0),h=t.metadata?l.openCursor(u):l.openKeyCursor(u);h.onerror=y=>{var d;(d=c.abort)==null||d.call(c),s(y)},h.onsuccess=y=>F(this,null,function*(){var d,f,p;const v=(f=(d=h.result)==null?void 0:d.key)!=null?f:null;let w=!0;if(v===null)w=!1;else if(!a.isAncestorOf(v))w=!1;else if(t.descendants||a.isParentOf(v)){let S;if(t.metadata&&(S=h.result.value.metadata),r(v,S)){if(t.value)if(this.context.cache.has(v)){const R=this.context.cache.get(v);S.value=R.value}else{const R=c.objectStore("content").get(v);S.value=yield new Promise((j,N)=>{R.onerror=D=>{j(null)},R.onsuccess=D=>{j(R.result)}}),this.context.cache.set(v,S.value===null?null:S)}w=i(v,S)}}if(w)try{h.result.continue()}catch(S){w=!1}w||((p=c.commit)==null||p.call(c),o())})})}}function qP(n,e={}){const t=new LP(e),r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${n}.acebase`,1);r.onupgradeneeded=u=>{const h=r.result;h.createObjectStore("nodes",{keyPath:"path"}),h.createObjectStore("content")};let i;const o=new Promise((u,h)=>{r.onsuccess=y=>{i=r.result,u()},r.onerror=y=>{h(y)}}),s=new cP(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),a=new Ko({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return o},getTransaction(u){return F(this,null,function*(){yield o;const h={debug:!1,db:i,cache:s,ipc:l};return new UP(h,u)})}}),c=new ps(n,{logLevel:t.logLevel,storage:a,sponsor:t.sponsor}),l=c.api.storage.ipc;return c.settings.ipcEvents=t.multipleTabs===!0,l.on("notification",u=>F(this,null,function*(){const h=u.data;if(typeof h=="object"&&h.action==="cache.invalidate")for(const y of h.paths)s.remove(y)})),c}const VP=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class ps extends DP{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(VP);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return qP(e,t)}}const MP={AceBase:ps,AceBaseLocalSettings:hb,DataReference:Vn,DataSnapshot:tt,EventSubscription:Wv,PathReference:nt,TypeMappings:tb,CustomStorageSettings:Ko,CustomStorageTransaction:Ed,CustomStorageHelpers:zo,ID:Bt,proxyAccess:ga,DataSnapshotsArray:_c};window.acebase=MP;window.AceBase=ps;let FP=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),Cl=(()=>"/ps"+FP()+"/pe")();const vn={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},dn={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},Rl={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+Cl+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+Cl+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+Cl+"/get-one",users:{base:"/users"}},ty={base:"/data"};var So,ri,Ii,To,ma,Hn,Dt,Ni,Ut;class WP{constructor(e={}){lr(this,So,"/on"),lr(this,ri,!0),lr(this,Ii,void 0),lr(this,To,void 0),lr(this,ma,new AT),lr(this,Hn,void 0),lr(this,Dt,void 0),lr(this,Ni,void 0),lr(this,Ut,void 0),yA(this,"init",o=>{var s,a,c,l,u;let{ENV:h,HOST_SERVER:y,API_VERSION:d}=_e(this,Ni),f=()=>F(this,null,function*(){var g,b,m,x,O,k,$,_,A,T,C,L;let V="/transaction",K="/database",G=yield(m=(b=(g=_e(this,Ut))==null?void 0:g.ref(V))==null?void 0:b.get())==null?void 0:m.catch(ee=>{}),ie=yield(k=(O=(x=_e(this,Ut))==null?void 0:x.ref(K))==null?void 0:O.get())==null?void 0:k.catch(ee=>{});if(G.exists()){G=G.val();let ee=Object.keys(G);if((ee==null?void 0:ee.length)>0){for(let fe in ee){let de=G[fe];(de==null?void 0:de.path)&&(de==null?void 0:de.method)&&(de==null?void 0:de.value)&&(yield this.init(o).database().ref(de==null?void 0:de.path).req(de==null?void 0:de.method,de==null?void 0:de.path,de==null?void 0:de.value).val())}ie.exists()&&(yield(A=(_=($=_e(this,Ut))==null?void 0:$.ref(K))==null?void 0:_.remove())==null?void 0:A.catch(fe=>{})),yield(L=(C=(T=_e(this,Ut))==null?void 0:T.ref(V))==null?void 0:C.remove())==null?void 0:L.catch(fe=>{})}}});(a=(s=o==null?void 0:o.socket)==null?void 0:s.database)==null||a.on("connect",()=>{Kn(this,Dt,!0),f()}),(l=(c=o==null?void 0:o.socket)==null?void 0:c.database)==null||l.on("disconnect",()=>{Kn(this,Dt,!1)});const p=(g={})=>{let b={};return g&&Object.keys(g).length>0&&(b.data=g),b};let v=(g,b)=>F(this,null,function*(){var m,x,O,k,$,_,A,T;if(((m=g==null?void 0:g.error)==null?void 0:m.token)&&_e(this,ri)){if(Kn(this,ri,!1),localStorage.getItem("refreshToken")){h==="dev"&&console.log("Token expired or not found: ",(x=g.error)==null?void 0:x.token," Trying to request a new refresh token");let C=yield(k=(O=this==null?void 0:this.init(o))==null?void 0:O.auth())==null?void 0:k.req(Rl.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(C!=null&&C.error)return h==="dev"&&console.log("Refresh token expired or not found: ",C),_e(this,Ii)&&(window.top.location.href=_e(this,Ii)),C;if(C!=null&&C.data&&(h==="dev"&&console.log("We got a new refresh token ,",C==null?void 0:C.data),($=C==null?void 0:C.data)!=null&&$.token&&localStorage.setItem("accessToken",(_=C==null?void 0:C.data)==null?void 0:_.token),(A=C==null?void 0:C.data)!=null&&A.refreshToken&&localStorage.setItem("refreshToken",(T=C==null?void 0:C.data)==null?void 0:T.refreshToken),h==="dev"&&console.log("Trying to restart your request..."),typeof b=="function"))return yield b()}}else return g});const w=(g,b,m,x=()=>{})=>{const O=_e(this,So);let k=b.version+O+b.base+m;k=k.replace(/\/\//g,"/"),h==="dev"&&console.log("socket listen local path: ",k),g==null||g.on(k,x)},S=(g,b=()=>{})=>{var m;const x=_e(this,So);let O=(d==null?void 0:d.DATABASE)+x+g;O=O.replace(/\/\//g,"/"),h==="dev"&&console.log("emitter listen local path: ",O),(m=_e(this,ma))==null||m.on(O,b)};let R=(g,b,m,x)=>(_e(this,To)&&(x=x+_e(this,To)),{req:O=>(w(g,b,x+dn.req,k=>{var $,_,A;(!((_=($=k==null?void 0:k.error)==null?void 0:$.error)!=null&&_.token)&&!((A=k==null?void 0:k.error)!=null&&A.token)||(k==null?void 0:k.data))&&typeof O=="function"&&O(Qe(re({},m),{value:k}))}),m),create:O=>(w(g,b,x+dn.create,k=>{var $,_,A;(!((_=($=k==null?void 0:k.error)==null?void 0:$.error)!=null&&_.token)&&!((A=k==null?void 0:k.error)!=null&&A.token)||(k==null?void 0:k.data))&&typeof O=="function"&&O(Qe(re({},m),{value:k}))}),m),find:O=>(w(g,b,x+dn.find,k=>{var $,_,A;(!((_=($=k==null?void 0:k.error)==null?void 0:$.error)!=null&&_.token)&&!((A=k==null?void 0:k.error)!=null&&A.token)||(k==null?void 0:k.data))&&typeof O=="function"&&O(Qe(re({},m),{value:k}))}),m),get:O=>(w(g,b,x+dn.get,k=>{var $,_,A;(!((_=($=k==null?void 0:k.error)==null?void 0:$.error)!=null&&_.token)&&!((A=k==null?void 0:k.error)!=null&&A.token)||(k==null?void 0:k.data))&&typeof O=="function"&&O(Qe(re({},m),{value:k}))}),m),query:O=>(w(g,b,x+dn.query,k=>{var $,_,A;(!((_=($=k==null?void 0:k.error)==null?void 0:$.error)!=null&&_.token)&&!((A=k==null?void 0:k.error)!=null&&A.token)||(k==null?void 0:k.data))&&typeof O=="function"&&O(Qe(re({},m),{value:k}))}),m),update:O=>(w(g,b,x+dn.update,k=>{var $,_,A;(!((_=($=k==null?void 0:k.error)==null?void 0:$.error)!=null&&_.token)&&!((A=k==null?void 0:k.error)!=null&&A.token)||(k==null?void 0:k.data))&&typeof O=="function"&&O(Qe(re({},m),{value:k}))}),m),delete:O=>(w(g,b,x+dn.delete,k=>{var $,_,A;(!((_=($=k==null?void 0:k.error)==null?void 0:$.error)!=null&&_.token)&&!((A=k==null?void 0:k.error)!=null&&A.token)||(k==null?void 0:k.data))&&typeof O=="function"&&O(Qe(re({},m),{value:k}))}),m)}),j=(g,b)=>({create:m=>(S(g+dn.create,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Qe(re({},b),{value:x}))}),b),find:m=>(S(g+dn.find,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Qe(re({},b),{value:x}))}),b),get:m=>(S(g+dn.get,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Qe(re({},b),{value:x}))}),b),query:m=>(S(g+dn.query,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Qe(re({},b),{value:x}))}),b),update:m=>(S(g+dn.update,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Qe(re({},b),{value:x}))}),b),delete:m=>(S(g+dn.delete,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Qe(re({},b),{value:x}))}),b)}),N=Lp.init(_e(this,Ni)),D=(g="",b={},m={},x={},O)=>{g=g.trim(),g.charAt(g.length-1)==="/"&&(g=g.slice(0,-1));let k=(()=>F(this,null,function*(){let $=()=>F(this,null,function*(){return yield N("post",y.AUTH+d.AUTH+Rl.base+g,p(b))}),_=yield $();return _e(this,ri)&&(_=yield v(_,()=>F(this,null,function*(){return yield $()}))),typeof O=="function"&&O(Qe(re({},x),{value:_})),_}))();return Qe(re({},x),{val:()=>k})},q=(g,b,m,x={},O={},k)=>{let $=(()=>F(this,null,function*(){let _=()=>F(this,null,function*(){return yield N(g,b,p(m),x)}),A=yield _();return _e(this,ri)&&(A=yield v(A,()=>F(this,null,function*(){return yield _()}))),typeof k=="function"&&k(Qe(re({},O),{value:A})),A}))();return Qe(re({},O),{val:()=>$})},P=g=>{let b={},m,[x={},,,]=g;if(g.length===1&&typeof x=="function"&&(m=g[0],x={}),g.length===2&&(typeof g[1]=="object"?b=g[1]:typeof g[1]=="function"&&(m=g[1])),g.length>=3){let[,O,k]=g;typeof O=="object"&&(b=O),m=k}return{data:x,onRequest:b,callback:m}},I=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),B=(g,b,m={},x,O)=>{b=b.replace(/\/\//g,"/");let k=(()=>F(this,null,function*(){var $,_,A,T,C,L,V,K,G,ie,ee,fe,de,ne,ce,Me,ve,Vt,Ce,Xe,oo,so,ao;let co="/transaction",we,lo,ot={error:{message:"We could not execute the "+g+" method for path: "+b}};switch(g){case"create":yield(A=(_=($=_e(this,Ut))==null?void 0:$.ref(b))==null?void 0:_.set(m))==null?void 0:A.catch(Ye=>ot);break;case"update":yield(L=(C=(T=_e(this,Ut))==null?void 0:T.ref(b))==null?void 0:C.update(m))==null?void 0:L.catch(Ye=>ot);break;case"query":let je=(V=_e(this,Ut))==null?void 0:V.query(b);Array.isArray(m==null?void 0:m.where)&&(yield Promise.all(m==null?void 0:m.where.map(Ye=>F(this,null,function*(){return yield new Promise(ln=>{je==null||je.filter(...Ye),ln()})})))),m!=null&&m.take&&(je==null||je.take(m==null?void 0:m.take)),m!=null&&m.skip&&(je==null||je.take(m==null?void 0:m.skip)),m!=null&&m.order&&Array.isArray(m==null?void 0:m.order)&&(yield Promise.all(m==null?void 0:m.order.map(Ye=>F(this,null,function*(){return yield new Promise(ln=>{je==null||je.sort(...Ye),ln()})})))),lo=yield je==null?void 0:je.count(),we=yield(K=je==null?void 0:je.get(re({},m==null?void 0:m.$option)))==null?void 0:K.catch(Ye=>ot);break;case"delete":we=yield(ee=(ie=(G=_e(this,Ut))==null?void 0:G.ref(b))==null?void 0:ie.get())==null?void 0:ee.catch(Ye=>ot),yield(ne=(de=(fe=_e(this,Ut))==null?void 0:fe.ref(b))==null?void 0:de.remove())==null?void 0:ne.catch(Ye=>ot);break}if(g!=="delete"&&g!=="query"&&(we=yield(ve=(Me=(ce=_e(this,Ut))==null?void 0:ce.ref(b))==null?void 0:Me.get(re({},m==null?void 0:m.$option)))==null?void 0:ve.catch(je=>ot)),g==="query"?we.exists()?(we=we==null?void 0:we.getValues(),we={data:we,max:lo,take:m==null?void 0:m.take,skip:m==null?void 0:m.skip}):we=re({},ot):we.exists()?(we=we==null?void 0:we.val(),we={data:we}):we=re({},ot),_e(this,Hn)&&x.auth().$currentUserId&&!_e(this,Dt)&&["create","delete","update"].includes(g)&&we!=null&&we.data){let je=yield(Xe=(Ce=(Vt=_e(this,Ut))==null?void 0:Vt.ref(co))==null?void 0:Ce.get())==null?void 0:Xe.catch(nl=>ot);je.exists()?je=je.val():je={};let Ye,ln=Object.keys(je);switch(ln.length>0?Ye=ln.length+1:Ye=0,g){case"create":g="post";break;case"update":g="put";break;case"delete":g="delete";break}g!=="get"&&(yield(ao=(so=(oo=_e(this,Ut))==null?void 0:oo.ref(co+"/"+Ye))==null?void 0:so.set({path:b,method:g,uid:Ye,value:we.data}))==null?void 0:ao.catch(nl=>ot))}const tl=_e(this,So);let Zr=(d==null?void 0:d.DATABASE)+tl+b+"/"+g;return Zr=Zr.replace(/\/\//g,"/"),_e(this,ma).emit(Zr,we),typeof O=="function"&&O(Qe(re({},x),{value:we})),we}))();return Qe(re({},x),{val:()=>k})},U=(g,b)=>{typeof g=="function"&&(b==null||b.on("connect",g))},M=(g,b)=>{var m;let x="%"+g,O=(m=this.init(o))==null?void 0:m.database();return{private:(k=I())=>O.event(g+k),child:k=>O.event(g+k),push:(k,$)=>{let _=O.event(g);return b==null||b.emit(x,k),typeof $=="function"&&(_==null||_.onValue($)),re(re({},_),O)},onValue:k=>{let $=O.event(g);return b==null||b.on(x,_=>{typeof k=="function"&&k(Qe(re(re({},$),O),{value:_}))}),re(re({},$),O)},onAnyValue:k=>(b==null||b.onAny(($,_)=>{let A=O.event($);typeof k=="function"&&k($,re(re({value:_},A),O))}),re({},O))}},E=(g,b,m)=>Qe(re({},g),{$io:m,connected:()=>m==null?void 0:m.connected,event:x=>M(x,m),ready:x=>U(x,m),ref:(x="")=>g.ref(x,b,m)});return{$connected:_e(this,Dt),activity:()=>{let g=this.init(o);return{onStart:b=>(typeof b=="function"&&document.addEventListener("DOMContentLoaded",b),re(re({},g),g.activity())),onCreate:b=>(typeof b=="function"&&(window.onload=b),re(re({},g),g.activity())),onPause:b=>(window.addEventListener("beforeunload",function(m){typeof b=="function"&&b(),m.returnValue="onbeforeunload"}),re(re({},g),g.activity())),onResume:()=>re(re({},g),g.activity()),onLeave:b=>(typeof b=="function"&&(window.onunload=b),re(re({},g),g.activity()))}},socket:{database:(u=o==null?void 0:o.socket)==null?void 0:u.database},$randomUID:()=>_l(),$randomId:()=>I(),$axios:Lp,local:(g={})=>{const b=this.init(o);return delete b.local,delete b.auth().register,delete b.auth().login,{database:(m="/database")=>({ref:(x="/database")=>{let O=this.init(o);return delete O.auth().login,delete O.auth().register,x=x.trim(),x=x.replace(/\/\//g,"/"),m=m+"/"+x,m=m.replace(/\/\//g,"/"),x.charAt(x.length-1)==="/"&&(x=x.slice(0,-1)),{child:(k="")=>{var $,_;return k=k.trim(),k=k.replace(/\/\//g,"/"),k.charAt(k.length-1)==="/"&&(k=k.slice(0,-1)),k.charAt(0)!=="/"&&(k="/"+k),(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x+k)},push:(...k)=>{var $,_;let A=_l();return!k.length>0?{getKey:()=>A}:(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x+"/"+A).create(k)},create:(...k)=>{var $,_;let A=re(re({},(_=($=O.local(g))==null?void 0:$.database())==null?void 0:_.ref(x)),O),{data:T,callback:C}=P(k);return B(g,"create",m,T,A)},get:(...k)=>{var $,_;let A=re(re({},(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x)),O),{data:T,callback:C}=P(k);return B("get",m,T,A,C)},find:(...k)=>{var $,_;let A=re(re({},(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x)),O),{data:T,callback:C}=P(k);return B("get",m,T,A,C)},query:()=>{},update:(...k)=>{var $,_;let A=re(re({},(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x)),O),{data:T,callback:C}=P(k);return B("update",m,T,A,C)},delete:(...k)=>{var $,_;let A=re(re({},(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x)),O),{data:T,callback:C}=P(k);return B("delete",m,T,A,C)},on:()=>{var k,$;let _=re(re({},($=(k=O.local())==null?void 0:k.database())==null?void 0:$.ref(x)),O);return j(x,_)},onValue:k=>{var $,_,A,T,C,L,V;let K=re(re({},(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x)),O),G=(T=(A=O.local())==null?void 0:A.database())==null?void 0:T.ref(x);return(C=G==null?void 0:G.on())==null||C.create(k),(L=G==null?void 0:G.on())==null||L.update(k),(V=G==null?void 0:G.on())==null||V.delete(k),K}}}}),cache:(m="/cache")=>{var x;let O=this.init(o);return delete O.auth().login,delete O.auth().register,(x=O.local())==null?void 0:x.database(m)},storage:()=>({})}},database:()=>{var g,b,m;const x=this.init(o);return delete x.database,delete x.auth().register,delete x.auth().login,(g=o==null?void 0:o.socket)==null||g.database.on("connect",()=>{Kn(this,Dt,!0),f()}),(b=o==null?void 0:o.socket)==null||b.database.on("disconnect",()=>{Kn(this,Dt,!1)}),E(x,{host:y.DATABASE,version:d.DATABASE,base:ty.base},(m=o==null?void 0:o.socket)==null?void 0:m.database)},cron:g=>{},task:g=>{},$online:navigator==null?void 0:navigator.onLine,auth:()=>({req:(g,b,m)=>{let x=this.init(o);delete x.auth().login,delete x.auth().register;let O=re(re({},x),x.auth());return D(g+Rl.req,b,null,O,m)}}),syncDatabase:(g=!0)=>{const b=this.init(o);return Kn(this,Hn,typeof g=="boolean"?g:!0),b.database()},ref:(g="",b={host:y.DATABASE,version:d.DATABASE,base:ty.base},m=(O=>(O=o==null?void 0:o.socket)==null?void 0:O.database)(),x=!0)=>{g=g.trim(),g=g.replace(/\/\//g,"/"),g.charAt(0)==="/"&&g.length<=1&&(g="/root"),g.charAt(g.length-1)==="/"&&(g=g.slice(0,-1));const O=b.host+b.version+b.base+g;let k=this.init(o);return delete k.auth().login,delete k.auth().register,Kn(this,ri,x),{push:(...$)=>{let _=_l();return!$.length>0?{getKey:()=>_}:k.ref(g+"/"+_,b,m).create($)},private:($=I())=>k.ref(g+"/ps"+$+"/pe",b,m),setAuthAccess:($=!0,_=_e(this,Ii))=>(Kn(this,Ii,_),k.ref(g,b,m,$)),req:(...$)=>{let _=re(re({},k.ref(g,b,m)),k);if($.length>=2){let[A="post",T={},C={},L]=$;if(typeof A=="string"&&["post","put","delete","get"].includes(A)){let V=vn.req;return q(A,O+V,T,C,_,L)}return _}else{let A=$.filter(T=>typeof T=="function");if(A.length>0)A=A[0],typeof A=="function"&&A(_);else return _}},child:($="")=>($=$.trim(),$=$.replace(/\/\//g,"/"),$.charAt($.length-1)==="/"&&($=$.slice(0,-1)),$.charAt(0)!=="/"&&($="/"+$),k.ref(g+$,b,m)),set:(...$)=>{var _;return(_=k.ref(g,b,m))==null?void 0:_.create(...$)},create:(...$)=>{var _,A,T;let C=re(re({},k.ref(g,b,m)),k);if(k.auth().$currentUserId&&(b==null?void 0:b.host)===(y==null?void 0:y.DATABASE)&&_e(this,Hn)&&!_e(this,Dt))return(T=(A=(_=k.local())==null?void 0:_.database())==null?void 0:A.ref(g))==null?void 0:T.create(...$);{let{data:L,onRequest:V,callback:K}=P($),G=vn.create.one;return Array!=null&&Array.isArray(L)&&(G=vn.create.many),q("post",O+G,L,V,C,K)}},find:(...$)=>{var _,A,T,C;if(console.log("Database connected: ",_e(this,Dt)),k.auth().$currentUserId&&(b==null?void 0:b.host)===(y==null?void 0:y.DATABASE)&&_e(this,Hn)&&!_e(this,Dt))return(T=(A=(_=k.local())==null?void 0:_.database())==null?void 0:A.ref(g))==null?void 0:T.find(...$);{let L=re(re({},k.ref(g,b,m)),k),{data:V,onRequest:K,callback:G}=P($),ie=vn.find.one;return(((C=Object.keys(V))==null?void 0:C.length)<=0||V.order||V.where||V.$option||V.skip||V.take)&&(ie=vn.find.many),q("post",O+ie,V,K,L,G)}},get:(...$)=>{var _,A,T,C;if(k.auth().$currentUserId&&(b==null?void 0:b.host)===(y==null?void 0:y.DATABASE)&&_e(this,Hn)&&!_e(this,Dt))return(T=(A=(_=k.local())==null?void 0:_.database())==null?void 0:A.ref(g))==null?void 0:T.get(...$);{let L=re(re({},k.ref(g,b,m)),k),{data:V,onRequest:K,callback:G}=P($),ie=vn.get.one;return(((C=Object.keys(V))==null?void 0:C.length)<=0||V.order||V.where||V.$option||V.skip||V.take)&&(ie=vn.get.many),q("get",O+ie+"?query="+JSON.stringify(p(V)),null,K,L,G)}},query:(...$)=>{var _,A,T;if(k.auth().$currentUserId&&(b==null?void 0:b.host)===(y==null?void 0:y.DATABASE)&&_e(this,Hn)&&!_e(this,Dt))return(T=(A=(_=k.local())==null?void 0:_.database())==null?void 0:A.ref(g))==null?void 0:T.query(...$);{let C=re(re({},k.ref(g,b,m)),k),{data:L,onRequest:V,callback:K}=P($);return(!L||L==="")&&(L={take:15},!_e(this,To)&&!L.order&&(L.order={uid:"ASC"})),q("get",O+vn.get.many+"?query="+JSON.stringify(p(L)),null,V,C,K)}},update:(...$)=>{var _,A,T;if(k.auth().$currentUserId&&(b==null?void 0:b.host)===(y==null?void 0:y.DATABASE)&&_e(this,Hn)&&!_e(this,Dt))return(T=(A=(_=k.local())==null?void 0:_.database())==null?void 0:A.ref(g))==null?void 0:T.update(...$);{let C=re(re({},k.ref(g,b,m)),k),{data:L,onRequest:V,callback:K}=P($),G=vn.update.one;return Array.isArray(L)&&(G=vn.find.many),q("put",O+G,L,V,C,K)}},delete:(...$)=>{var _,A,T;if(k.auth().$currentUserId&&(b==null?void 0:b.host)===(y==null?void 0:y.DATABASE)&&_e(this,Hn)&&!_e(this,Dt))return(T=(A=(_=k.local())==null?void 0:_.database())==null?void 0:A.ref(g))==null?void 0:T.delete(...$);{let C=re(re({},k.ref(g,b,m)),k),{data:L,onRequest:V,callback:K}=P($),G=vn.delete.one;return(Array.isArray(L)||L.where)&&(G=vn.delete.many),q("delete",O+G,L,V,C,K)}},on:()=>{let $=re(re({},k.ref(g,b,m)),k);return R(m,b,$,g)},onValue:$=>{var _,A,T;let C=re(re({},k.ref(g,b,m)),k),L=k.ref(g,b,m);return(_=L==null?void 0:L.on())==null||_.create($),(A=L==null?void 0:L.on())==null||A.update($),(T=L==null?void 0:L.on())==null||T.delete($),C}}}}}),Kn(this,Ni,e);let{ENV:t,OFFLINE_DB_NAME:r}=_e(this,Ni);Kn(this,Ut,ps.WithIndexedDB((r==null?void 0:r.DATABASE)||"swyger_database"));let i=()=>F(this,null,function*(){try{let o,s=localStorage.getItem("accessToken");if((()=>{var a;try{o=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let c=oS(s);return(Date==null?void 0:Date.parse((a=new Date((c==null?void 0:c.exp)*1e3))==null?void 0:a.toString()))<Date.now()}catch(c){return!1}})()&&o.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(a){}}catch(o){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}So=new WeakMap,ri=new WeakMap,Ii=new WeakMap,To=new WeakMap,ma=new WeakMap,Hn=new WeakMap,Dt=new WeakMap,Ni=new WeakMap,Ut=new WeakMap;const zP={init:n=>{try{return(e={})=>new WP(n).init(e)}catch(e){return{}}}};let KP={init:n=>{var e,t,r,i,o;return{OFFLINE_DB_NAME:{DATABASE:((e=n==null?void 0:n.OFFLINE_DB_NAME)==null?void 0:e.DATABASE)||"swyger_database"},ENV:(n==null?void 0:n.ENV)||"prod",HOST_SERVER:{AUTH:((t=n==null?void 0:n.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100",DATABASE:((r=n==null?void 0:n.HOST_SERVER)==null?void 0:r.DATABASE)||"http://localhost:4400"},API_VERSION:{AUTH:((i=n==null?void 0:n.API_VERSION)==null?void 0:i.AUTH)||"/api/v1",DATABASE:((o=n==null?void 0:n.API_VERSION)==null?void 0:o.DATABASE)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(n==null?void 0:n.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(n==null?void 0:n.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const HP={init:n=>{let e=KP.init(n);const t=rS.init(e),r={socket:{database:t==null?void 0:t.database}};return zP.init(e)(r)}};var Wu=function(n,e){return Wu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},Wu(n,e)};function gt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Wu(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function JP(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(r.next(u))}catch(h){s(h)}}function c(u){try{l(r.throw(u))}catch(h){s(h)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function _d(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function tn(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ze(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return o}function Ke(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}function Ui(n){return this instanceof Ui?(this.v=n,this):new Ui(n)}function YP(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(y){r[y]&&(i[y]=function(d){return new Promise(function(f,p){o.push([y,d,f,p])>1||a(y,d)})})}function a(y,d){try{c(r[y](d))}catch(f){h(o[0][3],f)}}function c(y){y.value instanceof Ui?Promise.resolve(y.value.v).then(l,u):h(o[0][2],y)}function l(y){a("next",y)}function u(y){a("throw",y)}function h(y,d){y(d),o.shift(),o.length&&a(o[0][0],o[0][1])}}function GP(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof tn=="function"?tn(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=n[o]&&function(s){return new Promise(function(a,c){s=n[o](s),i(a,c,s.done,s.value)})}}function i(o,s,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},s)}}function Te(n){return typeof n=="function"}function wi(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var va=wi(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,r){return r+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function mr(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var an=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=tn(s),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(p){e={error:p}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this);var u=this.initialTeardown;if(Te(u))try{u()}catch(p){o=p instanceof va?p.errors:[p]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var y=tn(h),d=y.next();!d.done;d=y.next()){var f=d.value;try{ny(f)}catch(p){o=o!=null?o:[],p instanceof va?o=Ke(Ke([],ze(o)),ze(p.errors)):o.push(p)}}}catch(p){r={error:p}}finally{try{d&&!d.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}}if(o)throw new va(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)ny(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&mr(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&mr(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),db=an.EMPTY;function fb(n){return n instanceof an||n&&"closed"in n&&Te(n.remove)&&Te(n.add)&&Te(n.unsubscribe)}function ny(n){Te(n)?n():n.unsubscribe()}var Xr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},$d={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=$d.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,Ke([n,e],ze(t))):setTimeout.apply(void 0,Ke([n,e],ze(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function pb(n){$d.setTimeout(function(){var e=Xr.onUnhandledError;if(e)e(n);else throw n})}function ft(){}var XP=function(){return Od("C",void 0,void 0)}();function QP(n){return Od("E",void 0,n)}function ZP(n){return Od("N",n,void 0)}function Od(n,e,t){return{kind:n,value:e,error:t}}var li=null;function ba(n){if(Xr.useDeprecatedSynchronousErrorHandling){var e=!li;if(e&&(li={errorThrown:!1,error:null}),n(),e){var t=li,r=t.errorThrown,i=t.error;if(li=null,r)throw i}}else n()}function ej(n){Xr.useDeprecatedSynchronousErrorHandling&&li&&(li.errorThrown=!0,li.error=n)}var $c=function(n){gt(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,fb(t)&&t.add(r)):r.destination=ij,r}return e.create=function(t,r,i){return new Ki(t,r,i)},e.prototype.next=function(t){this.isStopped?Nl(ZP(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?Nl(QP(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?Nl(XP,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(an),tj=Function.prototype.bind;function Il(n,e){return tj.call(n,e)}var nj=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){Vs(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){Vs(r)}else Vs(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Vs(t)}},n}(),Ki=function(n){gt(e,n);function e(t,r,i){var o=n.call(this)||this,s;if(Te(t)||!t)s={next:t!=null?t:void 0,error:r!=null?r:void 0,complete:i!=null?i:void 0};else{var a;o&&Xr.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return o.unsubscribe()},s={next:t.next&&Il(t.next,a),error:t.error&&Il(t.error,a),complete:t.complete&&Il(t.complete,a)}):s=t}return o.destination=new nj(s),o}return e}($c);function Vs(n){Xr.useDeprecatedSynchronousErrorHandling?ej(n):pb(n)}function rj(n){throw n}function Nl(n,e){var t=Xr.onStoppedNotification;t&&$d.setTimeout(function(){return t(n,e)})}var ij={closed:!0,next:ft,error:rj,complete:ft},Oc=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function St(n){return n}function Ad(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return yb(n)}function yb(n){return n.length===0?St:n.length===1?n[0]:function(e){return n.reduce(function(t,r){return r(t)},e)}}var Le=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,o=sj(e)?e:new Ki(e,t,r);return ba(function(){var s=i,a=s.operator,c=s.source;o.add(a?a.call(o,c):c?i._subscribe(o):i._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=ry(t),new t(function(i,o){var s=new Ki({next:function(a){try{e(a)}catch(c){o(c),s.unsubscribe()}},error:o,complete:i});r.subscribe(s)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[Oc]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return yb(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=ry(e),new e(function(r,i){var o;t.subscribe(function(s){return o=s},function(s){return i(s)},function(){return r(o)})})},n.create=function(e){return new n(e)},n}();function ry(n){var e;return(e=n!=null?n:Xr.Promise)!==null&&e!==void 0?e:Promise}function oj(n){return n&&Te(n.next)&&Te(n.error)&&Te(n.complete)}function sj(n){return n&&n instanceof $c||oj(n)&&fb(n)}function gb(n){return Te(n==null?void 0:n.lift)}function ge(n){return function(e){if(gb(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ue(n,e,t,r,i){return new Sd(n,e,t,r,i)}var Sd=function(n){gt(e,n);function e(t,r,i,o,s,a){var c=n.call(this,t)||this;return c.onFinalize=s,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:n.prototype._next,c._error=o?function(l){try{o(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=i?function(){try{i()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}($c);function mb(){return ge(function(n,e){var t=null;n._refCount++;var r=ue(e,void 0,void 0,void 0,function(){if(!n||n._refCount<=0||0<--n._refCount){t=null;return}var i=n._connection,o=t;t=null,i&&(!o||i===o)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var Ac=function(n){gt(e,n);function e(t,r){var i=n.call(this)||this;return i.source=t,i.subjectFactory=r,i._subject=null,i._refCount=0,i._connection=null,gb(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,r=this._connection;if(!r){r=this._connection=new an;var i=this.getSubject();r.add(this.source.subscribe(ue(i,void 0,function(){t._teardown(),i.complete()},function(o){t._teardown(),i.error(o)},function(){return t._teardown()}))),r.closed&&(this._connection=null,r=an.EMPTY)}return r},e.prototype.refCount=function(){return mb()(this)},e}(Le),vb={now:function(){return(vb.delegate||performance).now()},delegate:void 0},Ho={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,r=e(function(i){t=void 0,n(i)});return new an(function(){return t==null?void 0:t(r)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Ho.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,Ke([],ze(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return cancelAnimationFrame.apply(void 0,Ke([],ze(n)))},delegate:void 0};function aj(n){return n?bb(n):cj}function bb(n){return new Le(function(e){var t=n||vb,r=t.now(),i=0,o=function(){e.closed||(i=Ho.requestAnimationFrame(function(s){i=0;var a=t.now();e.next({timestamp:n?a:s,elapsed:a-r}),o()}))};return o(),function(){i&&Ho.cancelAnimationFrame(i)}})}var cj=bb(),wb=wi(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),kt=function(n){gt(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new iy(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new wb},e.prototype.next=function(t){var r=this;ba(function(){var i,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=tn(r.currentObservers),a=s.next();!a.done;a=s.next()){var c=a.value;c.next(t)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;ba(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;ba(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?db:(this.currentObservers=null,a.push(t),new an(function(){r.currentObservers=null,mr(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r.thrownError,s=r.isStopped;i?t.error(o):s&&t.complete()},e.prototype.asObservable=function(){var t=new Le;return t.source=this,t},e.create=function(t,r){return new iy(t,r)},e}(Le),iy=function(n){gt(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:db},e}(kt),kb=function(n){gt(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,o=t._value;if(r)throw i;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(kt),Sc={now:function(){return(Sc.delegate||Date).now()},delegate:void 0},Td=function(n){gt(e,n);function e(t,r,i){t===void 0&&(t=1/0),r===void 0&&(r=1/0),i===void 0&&(i=Sc);var o=n.call(this)||this;return o._bufferSize=t,o._windowTime=r,o._timestampProvider=i,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=r===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,r),o}return e.prototype.next=function(t){var r=this,i=r.isStopped,o=r._buffer,s=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(o.push(t),!s&&o.push(a.now()+c)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),i=this,o=i._infiniteTimeWindow,s=i._buffer,a=s.slice(),c=0;c<a.length&&!t.closed;c+=o?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,i=t._timestampProvider,o=t._buffer,s=t._infiniteTimeWindow,a=(s?1:2)*r;if(r<1/0&&a<o.length&&o.splice(0,o.length-a),!s){for(var c=i.now(),l=0,u=1;u<o.length&&o[u]<=c;u+=2)l=u;l&&o.splice(0,l+1)}},e}(kt),Pd=function(n){gt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r._hasValue,s=r._value,a=r.thrownError,c=r.isStopped,l=r._isComplete;i?t.error(a):(c||l)&&(o&&t.next(s),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,r=t._hasValue,i=t._value,o=t._isComplete;o||(this._isComplete=!0,r&&n.prototype.next.call(this,i),n.prototype.complete.call(this))},e}(kt),lj=function(n){gt(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(an),zu={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=zu.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,Ke([n,e],ze(t))):setInterval.apply(void 0,Ke([n,e],ze(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},ys=function(n){gt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(s,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),zu.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&zu.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,o;try{this.work(t)}catch(s){i=!0,o=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,mr(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(lj),uj=1,Bl,Ku={};function oy(n){return n in Ku?(delete Ku[n],!0):!1}var xb={setImmediate:function(n){var e=uj++;return Ku[e]=!0,Bl||(Bl=Promise.resolve()),Bl.then(function(){return oy(e)&&n()}),e},clearImmediate:function(n){oy(n)}},hj=xb.setImmediate,dj=xb.clearImmediate,Hu={setImmediate:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Hu.delegate;return((t==null?void 0:t.setImmediate)||hj).apply(void 0,Ke([],ze(n)))},clearImmediate:function(n){return dj(n)},delegate:void 0},fj=function(n){gt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=Hu.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(Hu.clearImmediate(r),t._scheduled===r&&(t._scheduled=void 0))},e}(ys),Ju=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=Sc.now,n}(),gs=function(n){gt(e,n);function e(t,r){r===void 0&&(r=Ju.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e}(Ju),pj=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(gs),Eb=new pj(fj),yj=Eb,Tn=new gs(ys),jd=Tn,gj=function(n){gt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.schedule=function(t,r){return r===void 0&&(r=0),r>0?n.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,r){return r>0||this.closed?n.prototype.execute.call(this,t,r):this._execute(t,r)},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.flush(this),0)},e}(ys),mj=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(gs),_b=new mj(gj),vj=_b,bj=function(n){gt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=Ho.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(Ho.cancelAnimationFrame(r),t._scheduled=void 0)},e}(ys),wj=function(n){gt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(gs),$b=new wj(bj),kj=$b,xj=function(n){gt(e,n);function e(t,r){t===void 0&&(t=Ob),r===void 0&&(r=1/0);var i=n.call(this,t,function(){return i.frame})||this;return i.maxFrames=r,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,r=t.actions,i=t.maxFrames,o,s;(s=r[0])&&s.delay<=i&&(r.shift(),this.frame=s.delay,!(o=s.execute(s.state,s.delay))););if(o){for(;s=r.shift();)s.unsubscribe();throw o}},e.frameTimeFactor=10,e}(gs),Ob=function(n){gt(e,n);function e(t,r,i){i===void 0&&(i=t.index+=1);var o=n.call(this,t,r)||this;return o.scheduler=t,o.work=r,o.index=i,o.active=!0,o.index=t.index=i,o}return e.prototype.schedule=function(t,r){if(r===void 0&&(r=0),Number.isFinite(r)){if(!this.id)return n.prototype.schedule.call(this,t,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,r)}else return an.EMPTY},e.prototype.requestAsyncId=function(t,r,i){i===void 0&&(i=0),this.delay=t.frame+i;var o=t.actions;return o.push(this),o.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,r,i){},e.prototype._execute=function(t,r){if(this.active===!0)return n.prototype._execute.call(this,t,r)},e.sortActions=function(t,r){return t.delay===r.delay?t.index===r.index?0:t.index>r.index?1:-1:t.delay>r.delay?1:-1},e}(ys),sr=new Le(function(n){return n.complete()});function Ej(n){return n?_j(n):sr}function _j(n){return new Le(function(e){return n.schedule(function(){return e.complete()})})}function Tc(n){return n&&Te(n.schedule)}function Cd(n){return n[n.length-1]}function ms(n){return Te(Cd(n))?n.pop():void 0}function kr(n){return Tc(Cd(n))?n.pop():void 0}function Ab(n,e){return typeof Cd(n)=="number"?n.pop():e}var Rd=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function Sb(n){return Te(n==null?void 0:n.then)}function Tb(n){return Te(n[Oc])}function Pb(n){return Symbol.asyncIterator&&Te(n==null?void 0:n[Symbol.asyncIterator])}function jb(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function $j(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Cb=$j();function Rb(n){return Te(n==null?void 0:n[Cb])}function Ib(n){return YP(this,arguments,function(){var e,t,r,i;return _d(this,function(o){switch(o.label){case 0:e=n.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Ui(e.read())];case 3:return t=o.sent(),r=t.value,i=t.done,i?[4,Ui(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Ui(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Nb(n){return Te(n==null?void 0:n.getReader)}function xe(n){if(n instanceof Le)return n;if(n!=null){if(Tb(n))return Oj(n);if(Rd(n))return Aj(n);if(Sb(n))return Sj(n);if(Pb(n))return Bb(n);if(Rb(n))return Tj(n);if(Nb(n))return Pj(n)}throw jb(n)}function Oj(n){return new Le(function(e){var t=n[Oc]();if(Te(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Aj(n){return new Le(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function Sj(n){return new Le(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,pb)})}function Tj(n){return new Le(function(e){var t,r;try{for(var i=tn(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function Bb(n){return new Le(function(e){jj(n,e).catch(function(t){return e.error(t)})})}function Pj(n){return Bb(Ib(n))}function jj(n,e){var t,r,i,o;return JP(this,void 0,void 0,function(){var s,a;return _d(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=GP(n),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(s=r.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function nn(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(o),!i)return o}function Pc(n,e){return e===void 0&&(e=0),ge(function(t,r){t.subscribe(ue(r,function(i){return nn(r,n,function(){return r.next(i)},e)},function(){return nn(r,n,function(){return r.complete()},e)},function(i){return nn(r,n,function(){return r.error(i)},e)}))})}function jc(n,e){return e===void 0&&(e=0),ge(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function Cj(n,e){return xe(n).pipe(jc(e),Pc(e))}function Rj(n,e){return xe(n).pipe(jc(e),Pc(e))}function Ij(n,e){return new Le(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function Lb(n,e){return new Le(function(t){var r;return nn(t,e,function(){r=n[Cb](),nn(t,e,function(){var i,o,s;try{i=r.next(),o=i.value,s=i.done}catch(a){t.error(a);return}s?t.complete():t.next(o)},0,!0)}),function(){return Te(r==null?void 0:r.return)&&r.return()}})}function Db(n,e){if(!n)throw new Error("Iterable cannot be null");return new Le(function(t){nn(t,e,function(){var r=n[Symbol.asyncIterator]();nn(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function Nj(n,e){return Db(Ib(n),e)}function Ub(n,e){if(n!=null){if(Tb(n))return Cj(n,e);if(Rd(n))return Ij(n,e);if(Sb(n))return Rj(n,e);if(Pb(n))return Db(n,e);if(Rb(n))return Lb(n,e);if(Nb(n))return Nj(n,e)}throw jb(n)}function xr(n,e){return e?Ub(n,e):xe(n)}function Id(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=kr(n);return xr(n,t)}function qb(n,e){var t=Te(n)?n:function(){return n},r=function(i){return i.error(t())};return new Le(e?function(i){return e.schedule(r,0,i)}:r)}var Yu;(function(n){n.NEXT="N",n.ERROR="E",n.COMPLETE="C"})(Yu||(Yu={}));var wa=function(){function n(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue=e==="N"}return n.prototype.observe=function(e){return Vb(this,e)},n.prototype.do=function(e,t,r){var i=this,o=i.kind,s=i.value,a=i.error;return o==="N"?e==null?void 0:e(s):o==="E"?t==null?void 0:t(a):r==null?void 0:r()},n.prototype.accept=function(e,t,r){var i;return Te((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,r)},n.prototype.toObservable=function(){var e=this,t=e.kind,r=e.value,i=e.error,o=t==="N"?Id(r):t==="E"?qb(function(){return i}):t==="C"?sr:0;if(!o)throw new TypeError("Unexpected notification kind "+t);return o},n.createNext=function(e){return new n("N",e)},n.createError=function(e){return new n("E",void 0,e)},n.createComplete=function(){return n.completeNotification},n.completeNotification=new n("C"),n}();function Vb(n,e){var t,r,i,o=n,s=o.kind,a=o.value,c=o.error;if(typeof s!="string")throw new TypeError('Invalid notification, missing "kind"');s==="N"?(t=e.next)===null||t===void 0||t.call(e,a):s==="E"?(r=e.error)===null||r===void 0||r.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function Bj(n){return!!n&&(n instanceof Le||Te(n.lift)&&Te(n.subscribe))}var ki=wi(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function Lj(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=!1,s;n.subscribe({next:function(a){s=a,o=!0},error:i,complete:function(){o?r(s):t?r(e.defaultValue):i(new ki)}})})}function Dj(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=new Ki({next:function(s){r(s),o.unsubscribe()},error:i,complete:function(){t?r(e.defaultValue):i(new ki)}});n.subscribe(o)})}var Gu=wi(function(n){return function(){n(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),Mb=wi(function(n){return function(e){n(this),this.name="NotFoundError",this.message=e}}),Fb=wi(function(n){return function(e){n(this),this.name="SequenceError",this.message=e}});function Nd(n){return n instanceof Date&&!isNaN(n)}var Wb=wi(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function zb(n,e){var t=Nd(n)?{first:n}:typeof n=="number"?{each:n}:n,r=t.first,i=t.each,o=t.with,s=o===void 0?Uj:o,a=t.scheduler,c=a===void 0?e!=null?e:Tn:a,l=t.meta,u=l===void 0?null:l;if(r==null&&i==null)throw new TypeError("No timeout provided.");return ge(function(h,y){var d,f,p=null,v=0,w=function(S){f=nn(y,c,function(){try{d.unsubscribe(),xe(s({meta:u,lastValue:p,seen:v})).subscribe(y)}catch(R){y.error(R)}},S)};d=h.subscribe(ue(y,function(S){f==null||f.unsubscribe(),v++,y.next(p=S),i>0&&w(i)},void 0,void 0,function(){f!=null&&f.closed||f==null||f.unsubscribe(),p=null})),!v&&w(r!=null?typeof r=="number"?r:+r-c.now():i)})}function Uj(n){throw new Wb(n)}function xi(n,e){return ge(function(t,r){var i=0;t.subscribe(ue(r,function(o){r.next(n.call(e,o,i++))}))})}var qj=Array.isArray;function Vj(n,e){return qj(e)?n.apply(void 0,Ke([],ze(e))):n(e)}function Ei(n){return xi(function(e){return Vj(n,e)})}function za(n,e,t,r){if(t)if(Tc(t))r=t;else return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return za(n,e,r).apply(this,i).pipe(Ei(t))};return r?function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return za(n,e).apply(this,i).pipe(jc(r),Pc(r))}:function(){for(var i=this,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var a=new Pd,c=!0;return new Le(function(l){var u=a.subscribe(l);if(c){c=!1;var h=!1,y=!1;e.apply(i,Ke(Ke([],ze(o)),[function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];if(n){var p=d.shift();if(p!=null){a.error(p);return}}a.next(1<d.length?d:d[0]),y=!0,h&&a.complete()}])),y&&a.complete(),h=!0}return u})}}function Mj(n,e,t){return za(!1,n,e,t)}function Fj(n,e,t){return za(!0,n,e,t)}var Wj=Array.isArray,zj=Object.getPrototypeOf,Kj=Object.prototype,Hj=Object.keys;function Kb(n){if(n.length===1){var e=n[0];if(Wj(e))return{args:e,keys:null};if(Jj(e)){var t=Hj(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function Jj(n){return n&&typeof n=="object"&&zj(n)===Kj}function Hb(n,e){return n.reduce(function(t,r,i){return t[r]=e[i],t},{})}function Jb(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=kr(n),r=ms(n),i=Kb(n),o=i.args,s=i.keys;if(o.length===0)return xr([],t);var a=new Le(Yb(o,t,s?function(c){return Hb(s,c)}:St));return r?a.pipe(Ei(r)):a}function Yb(n,e,t){return t===void 0&&(t=St),function(r){sy(e,function(){for(var i=n.length,o=new Array(i),s=i,a=i,c=function(u){sy(e,function(){var h=xr(n[u],e),y=!1;h.subscribe(ue(r,function(d){o[u]=d,y||(y=!0,a--),a||r.next(t(o.slice()))},function(){--s||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function sy(n,e,t){n?nn(t,n,e):e()}function Bd(n,e,t,r,i,o,s,a){var c=[],l=0,u=0,h=!1,y=function(){h&&!c.length&&!l&&e.complete()},d=function(p){return l<r?f(p):c.push(p)},f=function(p){o&&e.next(p),l++;var v=!1;xe(t(p,u++)).subscribe(ue(e,function(w){i==null||i(w),o?d(w):e.next(w)},function(){v=!0},void 0,function(){if(v)try{l--;for(var w=function(){var S=c.shift();s?nn(e,s,function(){return f(S)}):f(S)};c.length&&l<r;)w();y()}catch(S){e.error(S)}}))};return n.subscribe(ue(e,d,function(){h=!0,y()})),function(){a==null||a()}}function Mn(n,e,t){return t===void 0&&(t=1/0),Te(e)?Mn(function(r,i){return xi(function(o,s){return e(r,o,i,s)})(xe(n(r,i)))},t):(typeof e=="number"&&(t=e),ge(function(r,i){return Bd(r,i,n,t)}))}function Cc(n){return n===void 0&&(n=1/0),Mn(St,n)}function Ld(){return Cc(1)}function Jo(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Ld()(xr(n,kr(n)))}function Rc(n){return new Le(function(e){xe(n()).subscribe(e)})}var Yj={connector:function(){return new kt},resetOnDisconnect:!0};function Gj(n,e){e===void 0&&(e=Yj);var t=null,r=e.connector,i=e.resetOnDisconnect,o=i===void 0?!0:i,s=r(),a=new Le(function(c){return s.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=Rc(function(){return n}).subscribe(s),o&&t.add(function(){return s=r()})),t},a}function Xj(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ms(n),r=Kb(n),i=r.args,o=r.keys,s=new Le(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),u=c,h=c,y=function(f){var p=!1;xe(i[f]).subscribe(ue(a,function(v){p||(p=!0,h--),l[f]=v},function(){return u--},void 0,function(){(!u||!p)&&(h||a.next(o?Hb(o,l):l),a.complete())}))},d=0;d<c;d++)y(d)});return t?s.pipe(Ei(t)):s}var Qj=["addListener","removeListener"],Zj=["addEventListener","removeEventListener"],eC=["on","off"];function Xu(n,e,t,r){if(Te(t)&&(r=t,t=void 0),r)return Xu(n,e,t).pipe(Ei(r));var i=ze(rC(n)?Zj.map(function(a){return function(c){return n[a](e,c,t)}}):tC(n)?Qj.map(ay(n,e)):nC(n)?eC.map(ay(n,e)):[],2),o=i[0],s=i[1];if(!o&&Rd(n))return Mn(function(a){return Xu(a,e,t)})(xe(n));if(!o)throw new TypeError("Invalid event target");return new Le(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return o(c),function(){return s(c)}})}function ay(n,e){return function(t){return function(r){return n[t](e,r)}}}function tC(n){return Te(n.addListener)&&Te(n.removeListener)}function nC(n){return Te(n.on)&&Te(n.off)}function rC(n){return Te(n.addEventListener)&&Te(n.removeEventListener)}function Gb(n,e,t){return t?Gb(n,e).pipe(Ei(t)):new Le(function(r){var i=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return r.next(s.length===1?s[0]:s)},o=n(i);return Te(e)?function(){return e(i,o)}:void 0})}function iC(n,e,t,r,i){var o,s,a,c;arguments.length===1?(o=n,c=o.initialState,e=o.condition,t=o.iterate,s=o.resultSelector,a=s===void 0?St:s,i=o.scheduler):(c=n,!r||Tc(r)?(a=St,i=r):a=r);function l(){var u;return _d(this,function(h){switch(h.label){case 0:u=c,h.label=1;case 1:return!e||e(u)?[4,a(u)]:[3,4];case 2:h.sent(),h.label=3;case 3:return u=t(u),[3,1];case 4:return[2]}})}return Rc(i?function(){return Lb(l(),i)}:l)}function oC(n,e,t){return Rc(function(){return n()?e:t})}function _i(n,e,t){n===void 0&&(n=0),t===void 0&&(t=jd);var r=-1;return e!=null&&(Tc(e)?t=e:r=e),new Le(function(i){var o=Nd(n)?+n-t.now():n;o<0&&(o=0);var s=0;return t.schedule(function(){i.closed||(i.next(s++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function Xb(n,e){return n===void 0&&(n=0),e===void 0&&(e=Tn),n<0&&(n=0),_i(n,n,e)}function sC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=kr(n),r=Ab(n,1/0),i=n;return i.length?i.length===1?xe(i[0]):Cc(r)(xr(i,t)):sr}var Qb=new Le(ft);function aC(){return Qb}var cC=Array.isArray;function to(n){return n.length===1&&cC(n[0])?n[0]:n}function Zb(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=to(n);return new Le(function(r){var i=0,o=function(){if(i<t.length){var s=void 0;try{s=xe(t[i++])}catch(c){o();return}var a=new Sd(r,void 0,ft,ft);s.subscribe(a),a.add(o)}else r.complete()};o()})}function lC(n,e){return xr(Object.entries(n),e)}function uC(n,e){return function(t,r){return!n.call(e,t,r)}}function fi(n,e){return ge(function(t,r){var i=0;t.subscribe(ue(r,function(o){return n.call(e,o,i++)&&r.next(o)}))})}function hC(n,e,t){return[fi(e,t)(xe(n)),fi(uC(e,t))(xe(n))]}function dC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=to(n),n.length===1?xe(n[0]):new Le(e0(n))}function e0(n){return function(e){for(var t=[],r=function(o){t.push(xe(n[o]).subscribe(ue(e,function(s){if(t){for(var a=0;a<t.length;a++)a!==o&&t[a].unsubscribe();t=null}e.next(s)})))},i=0;t&&!e.closed&&i<n.length;i++)r(i)}}function fC(n,e,t){if(e==null&&(e=n,n=0),e<=0)return sr;var r=e+n;return new Le(t?function(i){var o=n;return t.schedule(function(){o<r?(i.next(o++),this.schedule()):i.complete()})}:function(i){for(var o=n;o<r&&!i.closed;)i.next(o++);i.complete()})}function pC(n,e){return new Le(function(t){var r=n(),i=e(r),o=i?xe(i):sr;return o.subscribe(t),function(){r&&r.unsubscribe()}})}function Dd(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ms(n),r=to(n);return r.length?new Le(function(i){var o=r.map(function(){return[]}),s=r.map(function(){return!1});i.add(function(){o=s=null});for(var a=function(l){xe(r[l]).subscribe(ue(i,function(u){if(o[l].push(u),o.every(function(y){return y.length})){var h=o.map(function(y){return y.shift()});i.next(t?t.apply(void 0,Ke([],ze(h))):h),o.some(function(y,d){return!y.length&&s[d]})&&i.complete()}},function(){s[l]=!0,!o[l].length&&i.complete()}))},c=0;!i.closed&&c<r.length;c++)a(c);return function(){o=s=null}}):sr}function t0(n){return ge(function(e,t){var r=!1,i=null,o=null,s=!1,a=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var l=i;i=null,t.next(l)}s&&t.complete()},c=function(){o=null,s&&t.complete()};e.subscribe(ue(t,function(l){r=!0,i=l,o||xe(n(l)).subscribe(o=ue(t,a,c))},function(){s=!0,(!r||!o||o.closed)&&t.complete()}))})}function yC(n,e){return e===void 0&&(e=Tn),t0(function(){return _i(n,e)})}function gC(n){return ge(function(e,t){var r=[];return e.subscribe(ue(t,function(i){return r.push(i)},function(){t.next(r),t.complete()})),xe(n).subscribe(ue(t,function(){var i=r;r=[],t.next(i)},ft)),function(){r=null}})}function mC(n,e){return e===void 0&&(e=null),e=e!=null?e:n,ge(function(t,r){var i=[],o=0;t.subscribe(ue(r,function(s){var a,c,l,u,h=null;o++%e===0&&i.push([]);try{for(var y=tn(i),d=y.next();!d.done;d=y.next()){var f=d.value;f.push(s),n<=f.length&&(h=h!=null?h:[],h.push(f))}}catch(w){a={error:w}}finally{try{d&&!d.done&&(c=y.return)&&c.call(y)}finally{if(a)throw a.error}}if(h)try{for(var p=tn(h),v=p.next();!v.done;v=p.next()){var f=v.value;mr(i,f),r.next(f)}}catch(w){l={error:w}}finally{try{v&&!v.done&&(u=p.return)&&u.call(p)}finally{if(l)throw l.error}}},function(){var s,a;try{for(var c=tn(i),l=c.next();!l.done;l=c.next()){var u=l.value;r.next(u)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}r.complete()},void 0,function(){i=null}))})}function vC(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=kr(r))!==null&&e!==void 0?e:Tn,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return ge(function(c,l){var u=[],h=!1,y=function(p){var v=p.buffer,w=p.subs;w.unsubscribe(),mr(u,p),l.next(v),h&&d()},d=function(){if(u){var p=new an;l.add(p);var v=[],w={buffer:v,subs:p};u.push(w),nn(p,o,function(){return y(w)},n)}};s!==null&&s>=0?nn(l,o,d,s,!0):h=!0,d();var f=ue(l,function(p){var v,w,S=u.slice();try{for(var R=tn(S),j=R.next();!j.done;j=R.next()){var N=j.value,D=N.buffer;D.push(p),a<=D.length&&y(N)}}catch(q){v={error:q}}finally{try{j&&!j.done&&(w=R.return)&&w.call(R)}finally{if(v)throw v.error}}},function(){for(;u!=null&&u.length;)l.next(u.shift().buffer);f==null||f.unsubscribe(),l.complete(),l.unsubscribe()},void 0,function(){return u=null});c.subscribe(f)})}function bC(n,e){return ge(function(t,r){var i=[];xe(n).subscribe(ue(r,function(o){var s=[];i.push(s);var a=new an,c=function(){mr(i,s),r.next(s),a.unsubscribe()};a.add(xe(e(o)).subscribe(ue(r,c,ft)))},ft)),t.subscribe(ue(r,function(o){var s,a;try{for(var c=tn(i),l=c.next();!l.done;l=c.next()){var u=l.value;u.push(o)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}},function(){for(;i.length>0;)r.next(i.shift());r.complete()}))})}function wC(n){return ge(function(e,t){var r=null,i=null,o=function(){i==null||i.unsubscribe();var s=r;r=[],s&&t.next(s),xe(n()).subscribe(i=ue(t,o,ft))};o(),e.subscribe(ue(t,function(s){return r==null?void 0:r.push(s)},function(){r&&t.next(r),t.complete()},void 0,function(){return r=i=null}))})}function n0(n){return ge(function(e,t){var r=null,i=!1,o;r=e.subscribe(ue(t,void 0,void 0,function(s){o=xe(n(s,n0(n)(e))),r?(r.unsubscribe(),r=null,o.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,o.subscribe(t))})}function r0(n,e,t,r,i){return function(o,s){var a=t,c=e,l=0;o.subscribe(ue(s,function(u){var h=l++;c=a?n(c,u,h):(a=!0,u),r&&s.next(c)},i&&function(){a&&s.next(c),s.complete()}))}}function vs(n,e){return ge(r0(n,e,arguments.length>=2,!1,!0))}var kC=function(n,e){return n.push(e),n};function i0(){return ge(function(n,e){vs(kC,[])(n).subscribe(e)})}function o0(n,e){return Ad(i0(),Mn(function(t){return n(t)}),e?Ei(e):St)}function s0(n){return o0(Jb,n)}var xC=s0;function a0(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ms(n);return t?Ad(a0.apply(void 0,Ke([],ze(n))),Ei(t)):ge(function(r,i){Yb(Ke([r],ze(to(n))))(i)})}function EC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return a0.apply(void 0,Ke([],ze(n)))}function Qu(n,e){return Te(e)?Mn(n,e,1):Mn(n,1)}function _C(n,e){return Te(e)?Qu(function(){return n},e):Qu(function(){return n})}function $C(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=kr(n);return ge(function(r,i){Ld()(xr(Ke([r],ze(n)),t)).subscribe(i)})}function OC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return $C.apply(void 0,Ke([],ze(n)))}function AC(n){return new Le(function(e){return n.subscribe(e)})}var SC={connector:function(){return new kt}};function Ud(n,e){e===void 0&&(e=SC);var t=e.connector;return ge(function(r,i){var o=t();xe(n(AC(o))).subscribe(i),i.add(r.subscribe(o))})}function TC(n){return vs(function(e,t,r){return!n||n(t,r)?e+1:e},0)}function PC(n){return ge(function(e,t){var r=!1,i=null,o=null,s=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var a=i;i=null,t.next(a)}};e.subscribe(ue(t,function(a){o==null||o.unsubscribe(),r=!0,i=a,o=ue(t,s,ft),xe(n(a)).subscribe(o)},function(){s(),t.complete()},void 0,function(){i=o=null}))})}function jC(n,e){return e===void 0&&(e=Tn),ge(function(t,r){var i=null,o=null,s=null,a=function(){if(i){i.unsubscribe(),i=null;var l=o;o=null,r.next(l)}};function c(){var l=s+n,u=e.now();if(u<l){i=this.schedule(void 0,l-u),r.add(i);return}a()}t.subscribe(ue(r,function(l){o=l,s=e.now(),i||(i=e.schedule(c,n),r.add(i))},function(){a(),r.complete()},void 0,function(){o=i=null}))})}function Ic(n){return ge(function(e,t){var r=!1;e.subscribe(ue(t,function(i){r=!0,t.next(i)},function(){r||t.next(n),t.complete()}))})}function Yo(n){return n<=0?function(){return sr}:ge(function(e,t){var r=0;e.subscribe(ue(t,function(i){++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function c0(){return ge(function(n,e){n.subscribe(ue(e,ft))})}function l0(n){return xi(function(){return n})}function qd(n,e){return e?function(t){return Jo(e.pipe(Yo(1),c0()),t.pipe(qd(n)))}:Mn(function(t,r){return xe(n(t,r)).pipe(Yo(1),l0(t))})}function CC(n,e){e===void 0&&(e=Tn);var t=_i(n,e);return qd(function(){return t})}function RC(){return ge(function(n,e){n.subscribe(ue(e,function(t){return Vb(t,e)}))})}function IC(n,e){return ge(function(t,r){var i=new Set;t.subscribe(ue(r,function(o){var s=n?n(o):o;i.has(s)||(i.add(s),r.next(o))})),e&&xe(e).subscribe(ue(r,function(){return i.clear()},ft))})}function u0(n,e){return e===void 0&&(e=St),n=n!=null?n:NC,ge(function(t,r){var i,o=!0;t.subscribe(ue(r,function(s){var a=e(s);(o||!n(i,a))&&(o=!1,i=a,r.next(s))}))})}function NC(n,e){return n===e}function BC(n,e){return u0(function(t,r){return e?e(t[n],r[n]):t[n]===r[n]})}function Nc(n){return n===void 0&&(n=LC),ge(function(e,t){var r=!1;e.subscribe(ue(t,function(i){r=!0,t.next(i)},function(){return r?t.complete():t.error(n())}))})}function LC(){return new ki}function DC(n,e){if(n<0)throw new Gu;var t=arguments.length>=2;return function(r){return r.pipe(fi(function(i,o){return o===n}),Yo(1),t?Ic(e):Nc(function(){return new Gu}))}}function UC(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(t){return Jo(t,Id.apply(void 0,Ke([],ze(n))))}}function qC(n,e){return ge(function(t,r){var i=0;t.subscribe(ue(r,function(o){n.call(e,o,i++,t)||(r.next(!1),r.complete())},function(){r.next(!0),r.complete()}))})}function Vd(n,e){return e?function(t){return t.pipe(Vd(function(r,i){return xe(n(r,i)).pipe(xi(function(o,s){return e(r,o,i,s)}))}))}:ge(function(t,r){var i=0,o=null,s=!1;t.subscribe(ue(r,function(a){o||(o=ue(r,void 0,function(){o=null,s&&r.complete()}),xe(n(a,i++)).subscribe(o))},function(){s=!0,!o&&r.complete()}))})}function h0(){return Vd(St)}var VC=h0;function MC(n,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,ge(function(r,i){return Bd(r,i,n,e,void 0,!0,t)})}function FC(n){return ge(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function WC(n,e){return ge(d0(n,e,"value"))}function d0(n,e,t){var r=t==="index";return function(i,o){var s=0;i.subscribe(ue(o,function(a){var c=s++;n.call(e,a,c,i)&&(o.next(r?c:a),o.complete())},function(){o.next(r?-1:void 0),o.complete()}))}}function zC(n,e){return ge(d0(n,e,"index"))}function KC(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?fi(function(i,o){return n(i,o,r)}):St,Yo(1),t?Ic(e):Nc(function(){return new ki}))}}function HC(n,e,t,r){return ge(function(i,o){var s;!e||typeof e=="function"?s=e:(t=e.duration,s=e.element,r=e.connector);var a=new Map,c=function(f){a.forEach(f),f(o)},l=function(f){return c(function(p){return p.error(f)})},u=0,h=!1,y=new Sd(o,function(f){try{var p=n(f),v=a.get(p);if(!v){a.set(p,v=r?r():new kt);var w=d(p,v);if(o.next(w),t){var S=ue(v,function(){v.complete(),S==null||S.unsubscribe()},void 0,void 0,function(){return a.delete(p)});y.add(xe(t(w)).subscribe(S))}}v.next(s?s(f):f)}catch(R){l(R)}},function(){return c(function(f){return f.complete()})},l,function(){return a.clear()},function(){return h=!0,u===0});i.subscribe(y);function d(f,p){var v=new Le(function(w){u++;var S=p.subscribe(w);return function(){S.unsubscribe(),--u===0&&h&&y.unsubscribe()}});return v.key=f,v}})}function JC(){return ge(function(n,e){n.subscribe(ue(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function f0(n){return n<=0?function(){return sr}:ge(function(e,t){var r=[];e.subscribe(ue(t,function(i){r.push(i),n<r.length&&r.shift()},function(){var i,o;try{for(var s=tn(r),a=s.next();!a.done;a=s.next()){var c=a.value;t.next(c)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}t.complete()},void 0,function(){r=null}))})}function YC(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?fi(function(i,o){return n(i,o,r)}):St,f0(1),t?Ic(e):Nc(function(){return new ki}))}}function GC(){return ge(function(n,e){n.subscribe(ue(e,function(t){e.next(wa.createNext(t))},function(){e.next(wa.createComplete()),e.complete()},function(t){e.next(wa.createError(t)),e.complete()}))})}function XC(n){return vs(Te(n)?function(e,t){return n(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var QC=Mn;function ZC(n,e,t){return t===void 0&&(t=1/0),Te(e)?Mn(function(){return n},e,t):(typeof e=="number"&&(t=e),Mn(function(){return n},t))}function eR(n,e,t){return t===void 0&&(t=1/0),ge(function(r,i){var o=e;return Bd(r,i,function(s,a){return n(o,s,a)},t,function(s){o=s},!1,void 0,function(){return o=null})})}function tR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=kr(n),r=Ab(n,1/0);return n=to(n),ge(function(i,o){Cc(r)(xr(Ke([i],ze(n)),t)).subscribe(o)})}function nR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return tR.apply(void 0,Ke([],ze(n)))}function rR(n){return vs(Te(n)?function(e,t){return n(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function Md(n,e){var t=Te(n)?n:function(){return n};return Te(e)?Ud(e,{connector:t}):function(r){return new Ac(r,t)}}function iR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=to(n);return function(r){return Zb.apply(void 0,Ke([r],ze(t)))}}function oR(){return ge(function(n,e){var t,r=!1;n.subscribe(ue(e,function(i){var o=t;t=i,r&&e.next([o,i]),r=!0}))})}function sR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.length;if(t===0)throw new Error("list of properties cannot be empty.");return xi(function(r){for(var i=r,o=0;o<t;o++){var s=i==null?void 0:i[n[o]];if(typeof s!="undefined")i=s;else return}return i})}function aR(n){return n?function(e){return Ud(n)(e)}:function(e){return Md(new kt)(e)}}function cR(n){return function(e){var t=new kb(n);return new Ac(e,function(){return t})}}function lR(){return function(n){var e=new Pd;return new Ac(n,function(){return e})}}function uR(n,e,t,r){t&&!Te(t)&&(r=t);var i=Te(t)?t:void 0;return function(o){return Md(new Td(n,e,r),i)(o)}}function hR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.length?ge(function(t,r){e0(Ke([t],ze(n)))(r)}):St}function dR(n){var e,t=1/0,r;return n!=null&&(typeof n=="object"?(e=n.count,t=e===void 0?1/0:e,r=n.delay):t=n),t<=0?function(){return sr}:ge(function(i,o){var s=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,r!=null){var u=typeof r=="number"?_i(r):xe(r(s)),h=ue(o,function(){h.unsubscribe(),l()});u.subscribe(h)}else l()},l=function(){var u=!1;a=i.subscribe(ue(o,void 0,function(){++s<t?a?c():u=!0:o.complete()})),u&&c()};l()})}function fR(n){return ge(function(e,t){var r,i=!1,o,s=!1,a=!1,c=function(){return a&&s&&(t.complete(),!0)},l=function(){return o||(o=new kt,xe(n(o)).subscribe(ue(t,function(){r?u():i=!0},function(){s=!0,c()}))),o},u=function(){a=!1,r=e.subscribe(ue(t,void 0,function(){a=!0,!c()&&l().next()})),i&&(r.unsubscribe(),r=null,i=!1,u())};u()})}function pR(n){n===void 0&&(n=1/0);var e;n&&typeof n=="object"?e=n:e={count:n};var t=e.count,r=t===void 0?1/0:t,i=e.delay,o=e.resetOnSuccess,s=o===void 0?!1:o;return r<=0?St:ge(function(a,c){var l=0,u,h=function(){var y=!1;u=a.subscribe(ue(c,function(d){s&&(l=0),c.next(d)},void 0,function(d){if(l++<r){var f=function(){u?(u.unsubscribe(),u=null,h()):y=!0};if(i!=null){var p=typeof i=="number"?_i(i):xe(i(d,l)),v=ue(c,function(){v.unsubscribe(),f()},function(){c.complete()});p.subscribe(v)}else f()}else c.error(d)})),y&&(u.unsubscribe(),u=null,h())};h()})}function yR(n){return ge(function(e,t){var r,i=!1,o,s=function(){r=e.subscribe(ue(t,void 0,void 0,function(a){o||(o=new kt,xe(n(o)).subscribe(ue(t,function(){return r?s():i=!0}))),o&&o.next(a)})),i&&(r.unsubscribe(),r=null,i=!1,s())};s()})}function p0(n){return ge(function(e,t){var r=!1,i=null;e.subscribe(ue(t,function(o){r=!0,i=o})),xe(n).subscribe(ue(t,function(){if(r){r=!1;var o=i;i=null,t.next(o)}},ft))})}function gR(n,e){return e===void 0&&(e=Tn),p0(Xb(n,e))}function mR(n,e){return ge(r0(n,e,arguments.length>=2,!0))}function vR(n,e){return e===void 0&&(e=function(t,r){return t===r}),ge(function(t,r){var i=cy(),o=cy(),s=function(c){r.next(c),r.complete()},a=function(c,l){var u=ue(r,function(h){var y=l.buffer,d=l.complete;y.length===0?d?s(!1):c.buffer.push(h):!e(h,y.shift())&&s(!1)},function(){c.complete=!0;var h=l.complete,y=l.buffer;h&&s(y.length===0),u==null||u.unsubscribe()});return u};t.subscribe(a(i,o)),xe(n).subscribe(a(o,i))})}function cy(){return{buffer:[],complete:!1}}function y0(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new kt}:e,r=n.resetOnError,i=r===void 0?!0:r,o=n.resetOnComplete,s=o===void 0?!0:o,a=n.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,h,y,d=0,f=!1,p=!1,v=function(){h==null||h.unsubscribe(),h=void 0},w=function(){v(),u=y=void 0,f=p=!1},S=function(){var R=u;w(),R==null||R.unsubscribe()};return ge(function(R,j){d++,!p&&!f&&v();var N=y=y!=null?y:t();j.add(function(){d--,d===0&&!p&&!f&&(h=Ll(S,c))}),N.subscribe(j),!u&&d>0&&(u=new Ki({next:function(D){return N.next(D)},error:function(D){p=!0,v(),h=Ll(w,i,D),N.error(D)},complete:function(){f=!0,v(),h=Ll(w,s),N.complete()}}),xe(R).subscribe(u))})(l)}}function Ll(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];if(e===!0){n();return}if(e!==!1){var i=new Ki({next:function(){i.unsubscribe(),n()}});return xe(e.apply(void 0,Ke([],ze(t)))).subscribe(i)}}function bR(n,e,t){var r,i,o,s,a=!1;return n&&typeof n=="object"?(r=n.bufferSize,s=r===void 0?1/0:r,i=n.windowTime,e=i===void 0?1/0:i,o=n.refCount,a=o===void 0?!1:o,t=n.scheduler):s=n!=null?n:1/0,y0({connector:function(){return new Td(s,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function wR(n){return ge(function(e,t){var r=!1,i,o=!1,s=0;e.subscribe(ue(t,function(a){o=!0,(!n||n(a,s++,e))&&(r&&t.error(new Fb("Too many matching values")),r=!0,i=a)},function(){r?(t.next(i),t.complete()):t.error(o?new Mb("No matching values"):new ki)}))})}function kR(n){return fi(function(e,t){return n<=t})}function xR(n){return n<=0?St:ge(function(e,t){var r=new Array(n),i=0;return e.subscribe(ue(t,function(o){var s=i++;if(s<n)r[s]=o;else{var a=s%n,c=r[a];r[a]=o,t.next(c)}})),function(){r=null}})}function ER(n){return ge(function(e,t){var r=!1,i=ue(t,function(){i==null||i.unsubscribe(),r=!0},ft);xe(n).subscribe(i),e.subscribe(ue(t,function(o){return r&&t.next(o)}))})}function _R(n){return ge(function(e,t){var r=!1,i=0;e.subscribe(ue(t,function(o){return(r||(r=!n(o,i++)))&&t.next(o)}))})}function $R(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=kr(n);return ge(function(r,i){(t?Jo(n,r,t):Jo(n,r)).subscribe(i)})}function Go(n,e){return ge(function(t,r){var i=null,o=0,s=!1,a=function(){return s&&!i&&r.complete()};t.subscribe(ue(r,function(c){i==null||i.unsubscribe();var l=0,u=o++;xe(n(c,u)).subscribe(i=ue(r,function(h){return r.next(e?e(c,h,u,l++):h)},function(){i=null,a()}))},function(){s=!0,a()}))})}function OR(){return Go(St)}function AR(n,e){return Te(e)?Go(function(){return n},e):Go(function(){return n})}function SR(n,e){return ge(function(t,r){var i=e;return Go(function(o,s){return n(i,o,s)},function(o,s){return i=s,s})(t).subscribe(r),function(){i=null}})}function TR(n){return ge(function(e,t){xe(n).subscribe(ue(t,function(){return t.complete()},ft)),!t.closed&&e.subscribe(t)})}function PR(n,e){return e===void 0&&(e=!1),ge(function(t,r){var i=0;t.subscribe(ue(r,function(o){var s=n(o,i++);(s||e)&&r.next(o),!s&&r.complete()}))})}function jR(n,e,t){var r=Te(n)||e||t?{next:n,error:e,complete:t}:n;return r?ge(function(i,o){var s;(s=r.subscribe)===null||s===void 0||s.call(r);var a=!0;i.subscribe(ue(o,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),o.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),o.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),o.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):St}function g0(n,e){return ge(function(t,r){var i=e!=null?e:{},o=i.leading,s=o===void 0?!0:o,a=i.trailing,c=a===void 0?!1:a,l=!1,u=null,h=null,y=!1,d=function(){h==null||h.unsubscribe(),h=null,c&&(v(),y&&r.complete())},f=function(){h=null,y&&r.complete()},p=function(w){return h=xe(n(w)).subscribe(ue(r,d,f))},v=function(){if(l){l=!1;var w=u;u=null,r.next(w),!y&&p(w)}};t.subscribe(ue(r,function(w){l=!0,u=w,!(h&&!h.closed)&&(s?v():p(w))},function(){y=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function CR(n,e,t){e===void 0&&(e=Tn);var r=_i(n,e);return g0(function(){return r},t)}function RR(n){return n===void 0&&(n=Tn),ge(function(e,t){var r=n.now();e.subscribe(ue(t,function(i){var o=n.now(),s=o-r;r=o,t.next(new IR(i,s))}))})}var IR=function(){function n(e,t){this.value=e,this.interval=t}return n}();function NR(n,e,t){var r,i,o;if(t=t!=null?t:jd,Nd(n)?r=n:typeof n=="number"&&(i=n),e)o=function(){return e};else throw new TypeError("No observable provided to switch to");if(r==null&&i==null)throw new TypeError("No timeout provided.");return zb({first:r,each:i,scheduler:t,with:o})}function BR(n){return n===void 0&&(n=Sc),xi(function(e){return{value:e,timestamp:n.now()}})}function LR(n){return ge(function(e,t){var r=new kt;t.next(r.asObservable());var i=function(o){r.error(o),t.error(o)};return e.subscribe(ue(t,function(o){return r==null?void 0:r.next(o)},function(){r.complete(),t.complete()},i)),xe(n).subscribe(ue(t,function(){r.complete(),t.next(r=new kt)},ft,i)),function(){r==null||r.unsubscribe(),r=null}})}function DR(n,e){e===void 0&&(e=0);var t=e>0?e:n;return ge(function(r,i){var o=[new kt],s=[],a=0;i.next(o[0].asObservable()),r.subscribe(ue(i,function(c){var l,u;try{for(var h=tn(o),y=h.next();!y.done;y=h.next()){var d=y.value;d.next(c)}}catch(v){l={error:v}}finally{try{y&&!y.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}var f=a-n+1;if(f>=0&&f%t===0&&o.shift().complete(),++a%t===0){var p=new kt;o.push(p),i.next(p.asObservable())}},function(){for(;o.length>0;)o.shift().complete();i.complete()},function(c){for(;o.length>0;)o.shift().error(c);i.error(c)},function(){s=null,o=null}))})}function UR(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=kr(r))!==null&&e!==void 0?e:Tn,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return ge(function(c,l){var u=[],h=!1,y=function(v){var w=v.window,S=v.subs;w.complete(),S.unsubscribe(),mr(u,v),h&&d()},d=function(){if(u){var v=new an;l.add(v);var w=new kt,S={window:w,subs:v,seen:0};u.push(S),l.next(w.asObservable()),nn(v,o,function(){return y(S)},n)}};s!==null&&s>=0?nn(l,o,d,s,!0):h=!0,d();var f=function(v){return u.slice().forEach(v)},p=function(v){f(function(w){var S=w.window;return v(S)}),v(l),l.unsubscribe()};return c.subscribe(ue(l,function(v){f(function(w){w.window.next(v),a<=++w.seen&&y(w)})},function(){return p(function(v){return v.complete()})},function(v){return p(function(w){return w.error(v)})})),function(){u=null}})}function qR(n,e){return ge(function(t,r){var i=[],o=function(s){for(;0<i.length;)i.shift().error(s);r.error(s)};xe(n).subscribe(ue(r,function(s){var a=new kt;i.push(a);var c=new an,l=function(){mr(i,a),a.complete(),c.unsubscribe()},u;try{u=xe(e(s))}catch(h){o(h);return}r.next(a.asObservable()),c.add(u.subscribe(ue(r,l,ft,o)))},ft)),t.subscribe(ue(r,function(s){var a,c,l=i.slice();try{for(var u=tn(l),h=u.next();!h.done;h=u.next()){var y=h.value;y.next(s)}}catch(d){a={error:d}}finally{try{h&&!h.done&&(c=u.return)&&c.call(u)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();r.complete()},o,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function VR(n){return ge(function(e,t){var r,i,o=function(a){r.error(a),t.error(a)},s=function(){i==null||i.unsubscribe(),r==null||r.complete(),r=new kt,t.next(r.asObservable());var a;try{a=xe(n())}catch(c){o(c);return}a.subscribe(i=ue(t,s,s,o))};s(),e.subscribe(ue(t,function(a){return r.next(a)},function(){r.complete(),t.complete()},o,function(){i==null||i.unsubscribe(),r=null}))})}function MR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ms(n);return ge(function(r,i){for(var o=n.length,s=new Array(o),a=n.map(function(){return!1}),c=!1,l=function(h){xe(n[h]).subscribe(ue(i,function(y){s[h]=y,!c&&!a[h]&&(a[h]=!0,(c=a.every(St))&&(a=null))},ft))},u=0;u<o;u++)l(u);r.subscribe(ue(i,function(h){if(c){var y=Ke([h],ze(s));i.next(t?t.apply(void 0,Ke([],ze(y))):y)}}))})}function FR(n){return o0(Dd,n)}function WR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return ge(function(t,r){Dd.apply(void 0,Ke([t],ze(n))).subscribe(r)})}function zR(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return WR.apply(void 0,Ke([],ze(n)))}const KR=Object.freeze(Object.defineProperty({__proto__:null,Observable:Le,ConnectableObservable:Ac,observable:Oc,animationFrames:aj,Subject:kt,BehaviorSubject:kb,ReplaySubject:Td,AsyncSubject:Pd,asap:yj,asapScheduler:Eb,async:jd,asyncScheduler:Tn,queue:vj,queueScheduler:_b,animationFrame:kj,animationFrameScheduler:$b,VirtualTimeScheduler:xj,VirtualAction:Ob,Scheduler:Ju,Subscription:an,Subscriber:$c,Notification:wa,get NotificationKind(){return Yu},pipe:Ad,noop:ft,identity:St,isObservable:Bj,lastValueFrom:Lj,firstValueFrom:Dj,ArgumentOutOfRangeError:Gu,EmptyError:ki,NotFoundError:Mb,ObjectUnsubscribedError:wb,SequenceError:Fb,TimeoutError:Wb,UnsubscriptionError:va,bindCallback:Mj,bindNodeCallback:Fj,combineLatest:Jb,concat:Jo,connectable:Gj,defer:Rc,empty:Ej,forkJoin:Xj,from:xr,fromEvent:Xu,fromEventPattern:Gb,generate:iC,iif:oC,interval:Xb,merge:sC,never:aC,of:Id,onErrorResumeNext:Zb,pairs:lC,partition:hC,race:dC,range:fC,throwError:qb,timer:_i,using:pC,zip:Dd,scheduled:Ub,EMPTY:sr,NEVER:Qb,config:Xr,audit:t0,auditTime:yC,buffer:gC,bufferCount:mC,bufferTime:vC,bufferToggle:bC,bufferWhen:wC,catchError:n0,combineAll:xC,combineLatestAll:s0,combineLatestWith:EC,concatAll:Ld,concatMap:Qu,concatMapTo:_C,concatWith:OC,connect:Ud,count:TC,debounce:PC,debounceTime:jC,defaultIfEmpty:Ic,delay:CC,delayWhen:qd,dematerialize:RC,distinct:IC,distinctUntilChanged:u0,distinctUntilKeyChanged:BC,elementAt:DC,endWith:UC,every:qC,exhaust:VC,exhaustAll:h0,exhaustMap:Vd,expand:MC,filter:fi,finalize:FC,find:WC,findIndex:zC,first:KC,groupBy:HC,ignoreElements:c0,isEmpty:JC,last:YC,map:xi,mapTo:l0,materialize:GC,max:XC,mergeAll:Cc,flatMap:QC,mergeMap:Mn,mergeMapTo:ZC,mergeScan:eR,mergeWith:nR,min:rR,multicast:Md,observeOn:Pc,onErrorResumeNextWith:iR,pairwise:oR,pluck:sR,publish:aR,publishBehavior:cR,publishLast:lR,publishReplay:uR,raceWith:hR,reduce:vs,repeat:dR,repeatWhen:fR,retry:pR,retryWhen:yR,refCount:mb,sample:p0,sampleTime:gR,scan:mR,sequenceEqual:vR,share:y0,shareReplay:bR,single:wR,skip:kR,skipLast:xR,skipUntil:ER,skipWhile:_R,startWith:$R,subscribeOn:jc,switchAll:OR,switchMap:Go,switchMapTo:AR,switchScan:SR,take:Yo,takeLast:f0,takeUntil:TR,takeWhile:PR,tap:jR,throttle:g0,throttleTime:CR,throwIfEmpty:Nc,timeInterval:RR,timeout:zb,timeoutWith:NR,timestamp:BR,toArray:i0,window:LR,windowCount:DR,windowTime:UR,windowToggle:qR,windowWhen:VR,withLatestFrom:MR,zipAll:FR,zipWith:zR},Symbol.toStringTag,{value:"Module"}));var HR=Object.defineProperty,JR=Object.defineProperties,YR=Object.getOwnPropertyDescriptors,ly=Object.getOwnPropertySymbols,GR=Object.prototype.hasOwnProperty,XR=Object.prototype.propertyIsEnumerable,Zu=(n,e,t)=>e in n?HR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,te=(n,e)=>{for(var t in e||(e={}))GR.call(e,t)&&Zu(n,t,e[t]);if(ly)for(var t of ly(e))XR.call(e,t)&&Zu(n,t,e[t]);return n},Ge=(n,e)=>JR(n,YR(e)),QR=(n,e,t)=>(Zu(n,typeof e!="symbol"?e+"":e,t),t),m0=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},be=(n,e,t)=>(m0(n,e,"read from private field"),t?t.call(n):e.get(n)),fn=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},Cn=(n,e,t,r)=>(m0(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),W=(n,e,t)=>new Promise((r,i)=>{var o=c=>{try{a(t.next(c))}catch(l){i(l)}},s=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(o,s);a((t=t.apply(n,e)).next())});const nr=Object.create(null);nr.open="0";nr.close="1";nr.ping="2";nr.pong="3";nr.message="4";nr.upgrade="5";nr.noop="6";const ka=Object.create(null);Object.keys(nr).forEach(n=>{ka[nr[n]]=n});const ZR={type:"error",data:"parser error"},eI=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",tI=typeof ArrayBuffer=="function",nI=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,v0=({type:n,data:e},t,r)=>eI&&e instanceof Blob?t?r(e):uy(e,r):tI&&(e instanceof ArrayBuffer||nI(e))?t?r(e):uy(new Blob([e]),r):r(nr[n]+(e||"")),uy=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)},hy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Po=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let n=0;n<hy.length;n++)Po[hy.charCodeAt(n)]=n;const rI=n=>{let e=n.length*.75,t=n.length,r,i=0,o,s,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const l=new ArrayBuffer(e),u=new Uint8Array(l);for(r=0;r<t;r+=4)o=Po[n.charCodeAt(r)],s=Po[n.charCodeAt(r+1)],a=Po[n.charCodeAt(r+2)],c=Po[n.charCodeAt(r+3)],u[i++]=o<<2|s>>4,u[i++]=(s&15)<<4|a>>2,u[i++]=(a&3)<<6|c&63;return l},iI=typeof ArrayBuffer=="function",b0=(n,e)=>{if(typeof n!="string")return{type:"message",data:w0(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:oI(n.substring(1),e)}:ka[t]?n.length>1?{type:ka[t],data:n.substring(1)}:{type:ka[t]}:ZR},oI=(n,e)=>{if(iI){const t=rI(n);return w0(t,e)}else return{base64:!0,data:n}},w0=(n,e)=>{switch(e){case"blob":return n instanceof ArrayBuffer?new Blob([n]):n;case"arraybuffer":default:return n}},k0=String.fromCharCode(30),sI=(n,e)=>{const t=n.length,r=new Array(t);let i=0;n.forEach((o,s)=>{v0(o,!1,a=>{r[s]=a,++i===t&&e(r.join(k0))})})},aI=(n,e)=>{const t=n.split(k0),r=[];for(let i=0;i<t.length;i++){const o=b0(t[i],e);if(r.push(o),o.type==="error")break}return r},x0=4;function ht(n){if(n)return cI(n)}function cI(n){for(var e in ht.prototype)n[e]=ht.prototype[e];return n}ht.prototype.on=ht.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};ht.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};ht.prototype.off=ht.prototype.removeListener=ht.prototype.removeAllListeners=ht.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===e||r.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};ht.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,e)}return this};ht.prototype.emitReserved=ht.prototype.emit;ht.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};ht.prototype.hasListeners=function(n){return!!this.listeners(n).length};const _n=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function E0(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const lI=_n.setTimeout,uI=_n.clearTimeout;function Bc(n,e){e.useNativeTimers?(n.setTimeoutFn=lI.bind(_n),n.clearTimeoutFn=uI.bind(_n)):(n.setTimeoutFn=_n.setTimeout.bind(_n),n.clearTimeoutFn=_n.clearTimeout.bind(_n))}const hI=1.33;function dI(n){return typeof n=="string"?fI(n):Math.ceil((n.byteLength||n.size)*hI)}function fI(n){let e=0,t=0;for(let r=0,i=n.length;r<i;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}class pI extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class _0 extends ht{constructor(e){super(),this.writable=!1,Bc(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new pI(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=b0(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const $0="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),eh=64,yI={};let dy=0,Ms=0,fy;function py(n){let e="";do e=$0[n%eh]+e,n=Math.floor(n/eh);while(n>0);return e}function O0(){const n=py(+new Date);return n!==fy?(dy=0,fy=n):n+"."+py(dy++)}for(;Ms<eh;Ms++)yI[$0[Ms]]=Ms;function A0(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function gI(n){let e={},t=n.split("&");for(let r=0,i=t.length;r<i;r++){let o=t[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}let S0=!1;try{S0=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(n){}const mI=S0;function T0(n){const e=n.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||mI))return new XMLHttpRequest}catch(t){}if(!e)try{return new _n[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function vI(){}const bI=function(){return new T0({xdomain:!1}).responseType!=null}();class wI extends _0{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const r=location.protocol==="https:";let i=location.port;i||(i=r?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=bI&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};aI(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,sI(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=O0()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const i=A0(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new Zn(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class Zn extends ht{constructor(e,t){super(),Bc(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=E0(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new T0(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch(r){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(r){}try{t.setRequestHeader("Accept","*/*")}catch(r){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document!="undefined"&&(this.index=Zn.requestsCount++,Zn.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=vI,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete Zn.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Zn.requestsCount=0;Zn.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",yy);else if(typeof addEventListener=="function"){const n="onpagehide"in _n?"pagehide":"unload";addEventListener(n,yy,!1)}}function yy(){for(let n in Zn.requests)Zn.requests.hasOwnProperty(n)&&Zn.requests[n].abort()}const P0=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,e)=>e(n,0))(),Fs=_n.WebSocket||_n.MozWebSocket,gy=!0,kI="arraybuffer",my=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class xI extends _0{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=my?{}:E0(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=gy&&!my?t?new Fs(e,t):new Fs(e):new Fs(e,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||kI,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],i=t===e.length-1;v0(r,this.supportsBinary,o=>{try{gy&&this.ws.send(o)}catch(s){}i&&P0(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=O0()),this.supportsBinary||(e.b64=1);const i=A0(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(i.length?"?"+i:"")}check(){return!!Fs}}const EI={websocket:xI,polling:wI},_I=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,$I=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function th(n){const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let i=_I.exec(n||""),o={},s=14;for(;s--;)o[$I[s]]=i[s]||"";return t!=-1&&r!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=OI(o,o.path),o.queryKey=AI(o,o.query),o}function OI(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function AI(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(t[i]=o)}),t}class Mr extends ht{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=th(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=th(t.host).host),Bc(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=gI(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=x0,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new EI[e](r)}open(){let e;if(this.opts.rememberUpgrade&&Mr.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),r=!1;Mr.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Mr.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const y=new Error("probe error");y.transport=t.name,this.emitReserved("upgradeError",y)}}))};function o(){r||(r=!0,u(),t.close(),t=null)}const s=h=>{const y=new Error("probe error: "+h);y.transport=t.name,o(),this.emitReserved("upgradeError",y)};function a(){s("transport closed")}function c(){s("socket closed")}function l(h){t&&h.name!==t.name&&o()}const u=()=>{t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};t.once("open",i),t.once("error",s),t.once("close",a),this.once("close",c),this.once("upgrading",l),t.open()}onOpen(){if(this.readyState="open",Mr.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=dI(r)),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:e,data:t,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){Mr.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const i=e.length;for(;r<i;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}Mr.protocol=x0;function SI(n,e="",t){let r=n;t=t||typeof location!="undefined"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t!="undefined"?n=t.protocol+"//"+n:n="https://"+n),r=th(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}const TI=typeof ArrayBuffer=="function",PI=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,j0=Object.prototype.toString,jI=typeof Blob=="function"||typeof Blob!="undefined"&&j0.call(Blob)==="[object BlobConstructor]",CI=typeof File=="function"||typeof File!="undefined"&&j0.call(File)==="[object FileConstructor]";function Fd(n){return TI&&(n instanceof ArrayBuffer||PI(n))||jI&&n instanceof Blob||CI&&n instanceof File}function xa(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(xa(n[t]))return!0;return!1}if(Fd(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return xa(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&xa(n[t]))return!0;return!1}function RI(n){const e=[],t=n.data,r=n;return r.data=nh(t,e),r.attachments=e.length,{packet:r,buffers:e}}function nh(n,e){if(!n)return n;if(Fd(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=nh(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=nh(n[r],e));return t}return n}function II(n,e){return n.data=rh(n.data,e),delete n.attachments,n}function rh(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=rh(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=rh(n[t],e));return n}const NI=5;var Ne;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(Ne||(Ne={}));class BI{constructor(e){this.replacer=e}encode(e){return(e.type===Ne.EVENT||e.type===Ne.ACK)&&xa(e)?this.encodeAsBinary({type:e.type===Ne.EVENT?Ne.BINARY_EVENT:Ne.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===Ne.BINARY_EVENT||e.type===Ne.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=RI(e),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}class Wd extends ht{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Ne.BINARY_EVENT;r||t.type===Ne.BINARY_ACK?(t.type=r?Ne.EVENT:Ne.ACK,this.reconstructor=new LI(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Fd(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(Ne[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===Ne.BINARY_EVENT||r.type===Ne.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const s=e.substring(o,t);if(s!=Number(s)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(s)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(o,t)}else r.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const o=t+1;for(;++t;){const s=e.charAt(t);if(s==null||Number(s)!=s){--t;break}if(t===e.length)break}r.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(Wd.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Ne.CONNECT:return typeof t=="object";case Ne.DISCONNECT:return t===void 0;case Ne.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case Ne.EVENT:case Ne.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case Ne.ACK:case Ne.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class LI{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=II(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const DI=Object.freeze(Object.defineProperty({__proto__:null,protocol:NI,get PacketType(){return Ne},Encoder:BI,Decoder:Wd},Symbol.toStringTag,{value:"Module"}));function Nn(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const UI=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class C0 extends ht{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Nn(e,"open",this.onopen.bind(this)),Nn(e,"packet",this.onpacket.bind(this)),Nn(e,"error",this.onerror.bind(this)),Nn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(UI.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Ne.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,s=t.pop();this._registerAckCallback(o,s),r.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===e&&this.sendBuffer.splice(s,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...s)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...s])}}emitWithAck(e,...t){const r=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,o)=>{t.push((s,a)=>r?s?o(s):i(a):i(s)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...o)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Ne.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Ne.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Ne.EVENT:case Ne.BINARY_EVENT:this.onevent(e);break;case Ne.ACK:case Ne.BINARY_ACK:this.onack(e);break;case Ne.DISCONNECT:this.ondisconnect();break;case Ne.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:Ne.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Ne.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function no(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}no.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};no.prototype.reset=function(){this.attempts=0};no.prototype.setMin=function(n){this.ms=n};no.prototype.setMax=function(n){this.max=n};no.prototype.setJitter=function(n){this.jitter=n};class ih extends ht{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Bc(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new no({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||DI;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Mr(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=Nn(t,"open",function(){r.onopen(),e&&e()}),o=Nn(t,"error",s=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",s),e?e(s):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const s=this._timeout;s===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},s);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Nn(e,"ping",this.onping.bind(this)),Nn(e,"data",this.ondata.bind(this)),Nn(e,"error",this.onerror.bind(this)),Nn(e,"close",this.onclose.bind(this)),Nn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){P0(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new C0(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const vo={};function Ea(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=SI(n,e.path||"/socket.io"),r=t.source,i=t.id,o=t.path,s=vo[i]&&o in vo[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s;let c;return a?c=new ih(r,e):(vo[i]||(vo[i]=new ih(r,e)),c=vo[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(Ea,{Manager:ih,Socket:C0,io:Ea,connect:Ea});const qI={init:({API_KEY:n,HOST_SERVER:e,CURRENT:t,ENV:r,API_VERSION:i})=>{var o,s,a;let c={};const l=localStorage.getItem("accessToken");try{const u={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return l&&(u.Authorization="Bearer "+l),c.storage=Ea(e==null?void 0:e.STORAGE,{extraHeaders:u}),(o=c==null?void 0:c.storage)==null||o.on("connect",()=>{r==="dev"&&console.log("Swyger Storage Client JS is connected with Swyger Server!!!")}),c!=null&&c.storage||(s=c==null?void 0:c.storage)==null||s.disconnect(),(a=c==null?void 0:c.storage)==null||a.on("disconnect",h=>{r==="dev"&&console.log("The device is disconnected from Storage server!")}),c}catch(u){}}};function oh(n){this.message=n}oh.prototype=new Error,oh.prototype.name="InvalidCharacterError";var vy=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var e=String(n).replace(/=+$/,"");if(e.length%4==1)throw new oh("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,i=0,o=0,s="";r=e.charAt(o++);~r&&(t=i%4?64*t+r:r,i++%4)?s+=String.fromCharCode(255&t>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return s};function VI(n){var e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(vy(t).replace(/(.)/g,function(r,i){var o=i.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(e)}catch(t){return vy(e)}}function Ka(n){this.message=n}function MI(n,e){if(typeof n!="string")throw new Ka("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(VI(n.split(".")[t]))}catch(r){throw new Ka("Invalid token specified: "+r.message)}}Ka.prototype=new Error,Ka.prototype.name="InvalidTokenError";function R0(n,e){return function(){return n.apply(e,arguments)}}const{toString:FI}=Object.prototype,{getPrototypeOf:zd}=Object,Lc=(n=>e=>{const t=FI.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),ar=n=>(n=n.toLowerCase(),e=>Lc(e)===n),Dc=n=>e=>typeof e===n,{isArray:ro}=Array,Xo=Dc("undefined");function WI(n){return n!==null&&!Xo(n)&&n.constructor!==null&&!Xo(n.constructor)&&An(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const I0=ar("ArrayBuffer");function zI(n){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&I0(n.buffer),e}const KI=Dc("string"),An=Dc("function"),N0=Dc("number"),Uc=n=>n!==null&&typeof n=="object",HI=n=>n===!0||n===!1,_a=n=>{if(Lc(n)!=="object")return!1;const e=zd(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},JI=ar("Date"),YI=ar("File"),GI=ar("Blob"),XI=ar("FileList"),QI=n=>Uc(n)&&An(n.pipe),ZI=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||An(n.append)&&((e=Lc(n))==="formdata"||e==="object"&&An(n.toString)&&n.toString()==="[object FormData]"))},eN=ar("URLSearchParams"),tN=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function bs(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n=="undefined")return;let r,i;if(typeof n!="object"&&(n=[n]),ro(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const o=t?Object.getOwnPropertyNames(n):Object.keys(n),s=o.length;let a;for(r=0;r<s;r++)a=o[r],e.call(null,n[a],a,n)}}function B0(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const L0=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),D0=n=>!Xo(n)&&n!==L0;function sh(){const{caseless:n}=D0(this)&&this||{},e={},t=(r,i)=>{const o=n&&B0(e,i)||i;_a(e[o])&&_a(r)?e[o]=sh(e[o],r):_a(r)?e[o]=sh({},r):ro(r)?e[o]=r.slice():e[o]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&bs(arguments[r],t);return e}const nN=(n,e,t,{allOwnKeys:r}={})=>(bs(e,(i,o)=>{t&&An(i)?n[o]=R0(i,t):n[o]=i},{allOwnKeys:r}),n),rN=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),iN=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},oN=(n,e,t,r)=>{let i,o,s;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),o=i.length;o-- >0;)s=i[o],(!r||r(s,n,e))&&!a[s]&&(e[s]=n[s],a[s]=!0);n=t!==!1&&zd(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},sN=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},aN=n=>{if(!n)return null;if(ro(n))return n;let e=n.length;if(!N0(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},cN=(n=>e=>n&&e instanceof n)(typeof Uint8Array!="undefined"&&zd(Uint8Array)),lN=(n,e)=>{const t=(n&&n[Symbol.iterator]).call(n);let r;for(;(r=t.next())&&!r.done;){const i=r.value;e.call(n,i[0],i[1])}},uN=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},hN=ar("HTMLFormElement"),dN=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),by=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),fN=ar("RegExp"),U0=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};bs(t,(i,o)=>{e(i,o,n)!==!1&&(r[o]=i)}),Object.defineProperties(n,r)},pN=n=>{U0(n,(e,t)=>{if(An(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(An(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},yN=(n,e)=>{const t={},r=i=>{i.forEach(o=>{t[o]=!0})};return ro(n)?r(n):r(String(n).split(e)),t},gN=()=>{},mN=(n,e)=>(n=+n,Number.isFinite(n)?n:e),Dl="abcdefghijklmnopqrstuvwxyz",wy="0123456789",q0={DIGIT:wy,ALPHA:Dl,ALPHA_DIGIT:Dl+Dl.toUpperCase()+wy},vN=(n=16,e=q0.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;n--;)t+=e[Math.random()*r|0];return t};function bN(n){return!!(n&&An(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const wN=n=>{const e=new Array(10),t=(r,i)=>{if(Uc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const o=ro(r)?[]:{};return bs(r,(s,a)=>{const c=t(s,i+1);!Xo(c)&&(o[a]=c)}),e[i]=void 0,o}}return r};return t(n,0)},kN=ar("AsyncFunction"),xN=n=>n&&(Uc(n)||An(n))&&An(n.then)&&An(n.catch),Z={isArray:ro,isArrayBuffer:I0,isBuffer:WI,isFormData:ZI,isArrayBufferView:zI,isString:KI,isNumber:N0,isBoolean:HI,isObject:Uc,isPlainObject:_a,isUndefined:Xo,isDate:JI,isFile:YI,isBlob:GI,isRegExp:fN,isFunction:An,isStream:QI,isURLSearchParams:eN,isTypedArray:cN,isFileList:XI,forEach:bs,merge:sh,extend:nN,trim:tN,stripBOM:rN,inherits:iN,toFlatObject:oN,kindOf:Lc,kindOfTest:ar,endsWith:sN,toArray:aN,forEachEntry:lN,matchAll:uN,isHTMLForm:hN,hasOwnProperty:by,hasOwnProp:by,reduceDescriptors:U0,freezeMethods:pN,toObjectSet:yN,toCamelCase:dN,noop:gN,toFiniteNumber:mN,findKey:B0,global:L0,isContextDefined:D0,ALPHABET:q0,generateString:vN,isSpecCompliantForm:bN,toJSONObject:wN,isAsyncFn:kN,isThenable:xN};function Ve(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i)}Z.inherits(Ve,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Z.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const V0=Ve.prototype,M0={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{M0[n]={value:n}});Object.defineProperties(Ve,M0);Object.defineProperty(V0,"isAxiosError",{value:!0});Ve.from=(n,e,t,r,i,o)=>{const s=Object.create(V0);return Z.toFlatObject(n,s,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),Ve.call(s,n.message,e,t,r,i),s.cause=n,s.name=n.name,o&&Object.assign(s,o),s};const EN=null;function ah(n){return Z.isPlainObject(n)||Z.isArray(n)}function F0(n){return Z.endsWith(n,"[]")?n.slice(0,-2):n}function ky(n,e,t){return n?n.concat(e).map(function(r,i){return r=F0(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function _N(n){return Z.isArray(n)&&!n.some(ah)}const $N=Z.toFlatObject(Z,{},null,function(n){return/^is[A-Z]/.test(n)});function qc(n,e,t){if(!Z.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=Z.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(d,f){return!Z.isUndefined(f[d])});const r=t.metaTokens,i=t.visitor||l,o=t.dots,s=t.indexes,a=(t.Blob||typeof Blob!="undefined"&&Blob)&&Z.isSpecCompliantForm(e);if(!Z.isFunction(i))throw new TypeError("visitor must be a function");function c(d){if(d===null)return"";if(Z.isDate(d))return d.toISOString();if(!a&&Z.isBlob(d))throw new Ve("Blob is not supported. Use a Buffer instead.");return Z.isArrayBuffer(d)||Z.isTypedArray(d)?a&&typeof Blob=="function"?new Blob([d]):Buffer.from(d):d}function l(d,f,p){let v=d;if(d&&!p&&typeof d=="object"){if(Z.endsWith(f,"{}"))f=r?f:f.slice(0,-2),d=JSON.stringify(d);else if(Z.isArray(d)&&_N(d)||(Z.isFileList(d)||Z.endsWith(f,"[]"))&&(v=Z.toArray(d)))return f=F0(f),v.forEach(function(w,S){!(Z.isUndefined(w)||w===null)&&e.append(s===!0?ky([f],S,o):s===null?f:f+"[]",c(w))}),!1}return ah(d)?!0:(e.append(ky(p,f,o),c(d)),!1)}const u=[],h=Object.assign($N,{defaultVisitor:l,convertValue:c,isVisitable:ah});function y(d,f){if(!Z.isUndefined(d)){if(u.indexOf(d)!==-1)throw Error("Circular reference detected in "+f.join("."));u.push(d),Z.forEach(d,function(p,v){(!(Z.isUndefined(p)||p===null)&&i.call(e,p,Z.isString(v)?v.trim():v,f,h))===!0&&y(p,f?f.concat(v):[v])}),u.pop()}}if(!Z.isObject(n))throw new TypeError("data must be an object");return y(n),e}function xy(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Kd(n,e){this._pairs=[],n&&qc(n,this,e)}const W0=Kd.prototype;W0.append=function(n,e){this._pairs.push([n,e])};W0.toString=function(n){const e=n?function(t){return n.call(this,t,xy)}:xy;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};function ON(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function z0(n,e,t){if(!e)return n;const r=t&&t.encode||ON,i=t&&t.serialize;let o;if(i?o=i(e,t):o=Z.isURLSearchParams(e)?e.toString():new Kd(e,t).toString(r),o){const s=n.indexOf("#");s!==-1&&(n=n.slice(0,s)),n+=(n.indexOf("?")===-1?"?":"&")+o}return n}class AN{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Z.forEach(this.handlers,function(t){t!==null&&e(t)})}}const Ey=AN,K0={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},SN=typeof URLSearchParams!="undefined"?URLSearchParams:Kd,TN=typeof FormData!="undefined"?FormData:null,PN=typeof Blob!="undefined"?Blob:null,jN=(()=>{let n;return typeof navigator!="undefined"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),CN=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Gn={isBrowser:!0,classes:{URLSearchParams:SN,FormData:TN,Blob:PN},isStandardBrowserEnv:jN,isStandardBrowserWebWorkerEnv:CN,protocols:["http","https","file","blob","url","data"]};function RN(n,e){return qc(n,new Gn.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,o){return Gn.isNode&&Z.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function IN(n){return Z.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function NN(n){const e={},t=Object.keys(n);let r;const i=t.length;let o;for(r=0;r<i;r++)o=t[r],e[o]=n[o];return e}function H0(n){function e(t,r,i,o){let s=t[o++];const a=Number.isFinite(+s),c=o>=t.length;return s=!s&&Z.isArray(i)?i.length:s,c?(Z.hasOwnProp(i,s)?i[s]=[i[s],r]:i[s]=r,!a):((!i[s]||!Z.isObject(i[s]))&&(i[s]=[]),e(t,r,i[s],o)&&Z.isArray(i[s])&&(i[s]=NN(i[s])),!a)}if(Z.isFormData(n)&&Z.isFunction(n.entries)){const t={};return Z.forEachEntry(n,(r,i)=>{e(IN(r),i,t,0)}),t}return null}const BN={"Content-Type":void 0};function LN(n,e,t){if(Z.isString(n))try{return(e||JSON.parse)(n),Z.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const Vc={transitional:K0,adapter:["xhr","http"],transformRequest:[function(n,e){const t=e.getContentType()||"",r=t.indexOf("application/json")>-1,i=Z.isObject(n);if(i&&Z.isHTMLForm(n)&&(n=new FormData(n)),Z.isFormData(n))return r&&r?JSON.stringify(H0(n)):n;if(Z.isArrayBuffer(n)||Z.isBuffer(n)||Z.isStream(n)||Z.isFile(n)||Z.isBlob(n))return n;if(Z.isArrayBufferView(n))return n.buffer;if(Z.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let o;if(i){if(t.indexOf("application/x-www-form-urlencoded")>-1)return RN(n,this.formSerializer).toString();if((o=Z.isFileList(n))||t.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return qc(o?{"files[]":n}:n,s&&new s,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),LN(n)):n}],transformResponse:[function(n){const e=this.transitional||Vc.transitional,t=e&&e.forcedJSONParsing,r=this.responseType==="json";if(n&&Z.isString(n)&&(t&&!this.responseType||r)){const i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(n)}catch(o){if(i)throw o.name==="SyntaxError"?Ve.from(o,Ve.ERR_BAD_RESPONSE,this,null,this.response):o}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Gn.classes.FormData,Blob:Gn.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Z.forEach(["delete","get","head"],function(n){Vc.headers[n]={}});Z.forEach(["post","put","patch"],function(n){Vc.headers[n]=Z.merge(BN)});const Hd=Vc,DN=Z.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),UN=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),r=o.substring(i+1).trim(),!(!t||e[t]&&DN[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},_y=Symbol("internals");function bo(n){return n&&String(n).trim().toLowerCase()}function $a(n){return n===!1||n==null?n:Z.isArray(n)?n.map($a):String(n)}function qN(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const VN=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Ul(n,e,t,r,i){if(Z.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!Z.isString(e)){if(Z.isString(r))return e.indexOf(r)!==-1;if(Z.isRegExp(r))return r.test(e)}}function MN(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function FN(n,e){const t=Z.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,o,s){return this[r].call(this,e,i,o,s)},configurable:!0})})}class Mc{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function o(a,c,l){const u=bo(c);if(!u)throw new Error("header name must be a non-empty string");const h=Z.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||c]=$a(a))}const s=(a,c)=>Z.forEach(a,(l,u)=>o(l,u,c));return Z.isPlainObject(e)||e instanceof this.constructor?s(e,t):Z.isString(e)&&(e=e.trim())&&!VN(e)?s(UN(e),t):e!=null&&o(t,e,r),this}get(e,t){if(e=bo(e),e){const r=Z.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return qN(i);if(Z.isFunction(t))return t.call(this,i,r);if(Z.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=bo(e),e){const r=Z.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||Ul(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function o(s){if(s=bo(s),s){const a=Z.findKey(r,s);a&&(!t||Ul(r,r[a],a,t))&&(delete r[a],i=!0)}}return Z.isArray(e)?e.forEach(o):o(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const o=t[r];(!e||Ul(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){const t=this,r={};return Z.forEach(this,(i,o)=>{const s=Z.findKey(r,o);if(s){t[s]=$a(i),delete t[o];return}const a=e?MN(o):String(o).trim();a!==o&&delete t[o],t[a]=$a(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Z.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&Z.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const t=(this[_y]=this[_y]={accessors:{}}).accessors,r=this.prototype;function i(o){const s=bo(o);t[s]||(FN(r,o),t[s]=!0)}return Z.isArray(e)?e.forEach(i):i(e),this}}Mc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Z.freezeMethods(Mc.prototype);Z.freezeMethods(Mc);const yr=Mc;function ql(n,e){const t=this||Hd,r=e||t,i=yr.from(r.headers);let o=r.data;return Z.forEach(n,function(s){o=s.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function J0(n){return!!(n&&n.__CANCEL__)}function ws(n,e,t){Ve.call(this,n==null?"canceled":n,Ve.ERR_CANCELED,e,t),this.name="CanceledError"}Z.inherits(ws,Ve,{__CANCEL__:!0});function WN(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Ve("Request failed with status code "+t.status,[Ve.ERR_BAD_REQUEST,Ve.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const zN=Gn.isStandardBrowserEnv?function(){return{write:function(n,e,t,r,i,o){const s=[];s.push(n+"="+encodeURIComponent(e)),Z.isNumber(t)&&s.push("expires="+new Date(t).toGMTString()),Z.isString(r)&&s.push("path="+r),Z.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read:function(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function KN(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function HN(n,e){return e?n.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):n}function Y0(n,e){return n&&!KN(e)?HN(n,e):e}const JN=Gn.isStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let t;function r(i){let o=i;return n&&(e.setAttribute("href",o),o=e.href),e.setAttribute("href",o),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return t=r(window.location.href),function(i){const o=Z.isString(i)?r(i):i;return o.protocol===t.protocol&&o.host===t.host}}():function(){return function(){return!0}}();function YN(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function GN(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,o=0,s;return e=e!==void 0?e:1e3,function(a){const c=Date.now(),l=r[o];s||(s=c),t[i]=a,r[i]=c;let u=o,h=0;for(;u!==i;)h+=t[u++],u=u%n;if(i=(i+1)%n,i===o&&(o=(o+1)%n),c-s<e)return;const y=l&&c-l;return y?Math.round(h*1e3/y):void 0}}function $y(n,e){let t=0;const r=GN(50,250);return i=>{const o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-t,c=r(a),l=o<=s;t=o;const u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&l?(s-o)/c:void 0,event:i};u[e?"download":"upload"]=!0,n(u)}}const XN=typeof XMLHttpRequest!="undefined",QN=XN&&function(n){return new Promise(function(e,t){let r=n.data;const i=yr.from(n.headers).normalize(),o=n.responseType;let s;function a(){n.cancelToken&&n.cancelToken.unsubscribe(s),n.signal&&n.signal.removeEventListener("abort",s)}Z.isFormData(r)&&(Gn.isStandardBrowserEnv||Gn.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(n.auth){const y=n.auth.username||"",d=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";i.set("Authorization","Basic "+btoa(y+":"+d))}const l=Y0(n.baseURL,n.url);c.open(n.method.toUpperCase(),z0(l,n.params,n.paramsSerializer),!0),c.timeout=n.timeout;function u(){if(!c)return;const y=yr.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),d={data:!o||o==="text"||o==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:y,config:n,request:c};WN(function(f){e(f),a()},function(f){t(f),a()},d),c=null}if("onloadend"in c?c.onloadend=u:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(u)},c.onabort=function(){!c||(t(new Ve("Request aborted",Ve.ECONNABORTED,n,c)),c=null)},c.onerror=function(){t(new Ve("Network Error",Ve.ERR_NETWORK,n,c)),c=null},c.ontimeout=function(){let y=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const d=n.transitional||K0;n.timeoutErrorMessage&&(y=n.timeoutErrorMessage),t(new Ve(y,d.clarifyTimeoutError?Ve.ETIMEDOUT:Ve.ECONNABORTED,n,c)),c=null},Gn.isStandardBrowserEnv){const y=(n.withCredentials||JN(l))&&n.xsrfCookieName&&zN.read(n.xsrfCookieName);y&&i.set(n.xsrfHeaderName,y)}r===void 0&&i.setContentType(null),"setRequestHeader"in c&&Z.forEach(i.toJSON(),function(y,d){c.setRequestHeader(d,y)}),Z.isUndefined(n.withCredentials)||(c.withCredentials=!!n.withCredentials),o&&o!=="json"&&(c.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&c.addEventListener("progress",$y(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",$y(n.onUploadProgress)),(n.cancelToken||n.signal)&&(s=y=>{!c||(t(!y||y.type?new ws(null,n,c):y),c.abort(),c=null)},n.cancelToken&&n.cancelToken.subscribe(s),n.signal&&(n.signal.aborted?s():n.signal.addEventListener("abort",s)));const h=YN(l);if(h&&Gn.protocols.indexOf(h)===-1){t(new Ve("Unsupported protocol "+h+":",Ve.ERR_BAD_REQUEST,n));return}c.send(r||null)})},Oa={http:EN,xhr:QN};Z.forEach(Oa,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch(t){}Object.defineProperty(n,"adapterName",{value:e})}});const ZN={getAdapter:n=>{n=Z.isArray(n)?n:[n];const{length:e}=n;let t,r;for(let i=0;i<e&&(t=n[i],!(r=Z.isString(t)?Oa[t.toLowerCase()]:t));i++);if(!r)throw r===!1?new Ve(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(Z.hasOwnProp(Oa,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!Z.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:Oa};function Vl(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new ws(null,n)}function Oy(n){return Vl(n),n.headers=yr.from(n.headers),n.data=ql.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),ZN.getAdapter(n.adapter||Hd.adapter)(n).then(function(e){return Vl(n),e.data=ql.call(n,n.transformResponse,e),e.headers=yr.from(e.headers),e},function(e){return J0(e)||(Vl(n),e&&e.response&&(e.response.data=ql.call(n,n.transformResponse,e.response),e.response.headers=yr.from(e.response.headers))),Promise.reject(e)})}const Ay=n=>n instanceof yr?n.toJSON():n;function Hi(n,e){e=e||{};const t={};function r(l,u,h){return Z.isPlainObject(l)&&Z.isPlainObject(u)?Z.merge.call({caseless:h},l,u):Z.isPlainObject(u)?Z.merge({},u):Z.isArray(u)?u.slice():u}function i(l,u,h){if(Z.isUndefined(u)){if(!Z.isUndefined(l))return r(void 0,l,h)}else return r(l,u,h)}function o(l,u){if(!Z.isUndefined(u))return r(void 0,u)}function s(l,u){if(Z.isUndefined(u)){if(!Z.isUndefined(l))return r(void 0,l)}else return r(void 0,u)}function a(l,u,h){if(h in e)return r(l,u);if(h in n)return r(void 0,l)}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(l,u)=>i(Ay(l),Ay(u),!0)};return Z.forEach(Object.keys(Object.assign({},n,e)),function(l){const u=c[l]||i,h=u(n[l],e[l],l);Z.isUndefined(h)&&u!==a||(t[l]=h)}),t}const G0="1.4.0",Jd={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Jd[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const Sy={};Jd.transitional=function(n,e,t){function r(i,o){return"[Axios v"+G0+"] Transitional option '"+i+"'"+o+(t?". "+t:"")}return(i,o,s)=>{if(n===!1)throw new Ve(r(o," has been removed"+(e?" in "+e:"")),Ve.ERR_DEPRECATED);return e&&!Sy[o]&&(Sy[o]=!0,console.warn(r(o," has been deprecated since v"+e+" and will be removed in the near future"))),n?n(i,o,s):!0}};function e2(n,e,t){if(typeof n!="object")throw new Ve("options must be an object",Ve.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const o=r[i],s=e[o];if(s){const a=n[o],c=a===void 0||s(a,o,n);if(c!==!0)throw new Ve("option "+o+" must be "+c,Ve.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ve("Unknown option "+o,Ve.ERR_BAD_OPTION)}}const ch={assertOptions:e2,validators:Jd},Rr=ch.validators;class Ha{constructor(e){this.defaults=e,this.interceptors={request:new Ey,response:new Ey}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Hi(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:o}=t;r!==void 0&&ch.assertOptions(r,{silentJSONParsing:Rr.transitional(Rr.boolean),forcedJSONParsing:Rr.transitional(Rr.boolean),clarifyTimeoutError:Rr.transitional(Rr.boolean)},!1),i!=null&&(Z.isFunction(i)?t.paramsSerializer={serialize:i}:ch.assertOptions(i,{encode:Rr.function,serialize:Rr.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s;s=o&&Z.merge(o.common,o[t.method]),s&&Z.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),t.headers=yr.concat(s,o);const a=[];let c=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(t)===!1||(c=c&&f.synchronous,a.unshift(f.fulfilled,f.rejected))});const l=[];this.interceptors.response.forEach(function(f){l.push(f.fulfilled,f.rejected)});let u,h=0,y;if(!c){const f=[Oy.bind(this),void 0];for(f.unshift.apply(f,a),f.push.apply(f,l),y=f.length,u=Promise.resolve(t);h<y;)u=u.then(f[h++],f[h++]);return u}y=a.length;let d=t;for(h=0;h<y;){const f=a[h++],p=a[h++];try{d=f(d)}catch(v){p.call(this,v);break}}try{u=Oy.call(this,d)}catch(f){return Promise.reject(f)}for(h=0,y=l.length;h<y;)u=u.then(l[h++],l[h++]);return u}getUri(e){e=Hi(this.defaults,e);const t=Y0(e.baseURL,e.url);return z0(t,e.params,e.paramsSerializer)}}Z.forEach(["delete","get","head","options"],function(n){Ha.prototype[n]=function(e,t){return this.request(Hi(t||{},{method:n,url:e,data:(t||{}).data}))}});Z.forEach(["post","put","patch"],function(n){function e(t){return function(r,i,o){return this.request(Hi(o||{},{method:n,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}Ha.prototype[n]=e(),Ha.prototype[n+"Form"]=e(!0)});const Aa=Ha;class Yd{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](i);r._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(a=>{r.subscribe(a),o=a}).then(i);return s.cancel=function(){r.unsubscribe(o)},s},e(function(i,o,s){r.reason||(r.reason=new ws(i,o,s),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Yd(function(t){e=t}),cancel:e}}}const t2=Yd;function n2(n){return function(e){return n.apply(null,e)}}function r2(n){return Z.isObject(n)&&n.isAxiosError===!0}const lh={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(lh).forEach(([n,e])=>{lh[e]=n});const i2=lh;function X0(n){const e=new Aa(n),t=R0(Aa.prototype.request,e);return Z.extend(t,Aa.prototype,e,{allOwnKeys:!0}),Z.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return X0(Hi(n,r))},t}const xt=X0(Hd);xt.Axios=Aa;xt.CanceledError=ws;xt.CancelToken=t2;xt.isCancel=J0;xt.VERSION=G0;xt.toFormData=qc;xt.AxiosError=Ve;xt.Cancel=xt.CanceledError;xt.all=function(n){return Promise.all(n)};xt.spread=n2;xt.isAxiosError=r2;xt.mergeConfig=Hi;xt.AxiosHeaders=yr;xt.formToJSON=n=>H0(Z.isHTMLForm(n)?new FormData(n):n);xt.HttpStatusCode=i2;xt.default=xt;const o2=xt,Ty={init:({API_KEY:n})=>(...e)=>W(void 0,[...e],function*(t="post",r="/",i={},o={}){var s,a,c,l;const u=localStorage.getItem("accessToken");let h={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};u&&(h.Authorization="Bearer "+u);const y=r;typeof(i==null?void 0:i.get)=="function"&&(i==null?void 0:i.get("file"))&&(h["Content-Type"]="multipart/form-data"),o!=null&&o.headers&&(h=Object.assign(...h,...o.headers),delete o.headers);const d=Object.assign({mode:"cors",method:t,url:y,data:i,headers:h},o);let f={};try{const p=yield o2(d);f.data=((s=p==null?void 0:p.data)==null?void 0:s.data)||(p==null?void 0:p.data),p!=null&&p.error&&(f.error=p.error),f.data||(f.data={})}catch(p){f.error=((c=(a=p.response)==null?void 0:a.data)==null?void 0:c.error)||((l=p.response)==null?void 0:l.error),f.error||(f.error={})}return f})};let Ws;const s2=new Uint8Array(16);function a2(){if(!Ws&&(Ws=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ws))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ws(s2)}const Rt=[];for(let n=0;n<256;++n)Rt.push((n+256).toString(16).slice(1));function c2(n,e=0){return(Rt[n[e+0]]+Rt[n[e+1]]+Rt[n[e+2]]+Rt[n[e+3]]+"-"+Rt[n[e+4]]+Rt[n[e+5]]+"-"+Rt[n[e+6]]+Rt[n[e+7]]+"-"+Rt[n[e+8]]+Rt[n[e+9]]+"-"+Rt[n[e+10]]+Rt[n[e+11]]+Rt[n[e+12]]+Rt[n[e+13]]+Rt[n[e+14]]+Rt[n[e+15]]).toLowerCase()}const l2=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Py={randomUUID:l2};function Ml(n,e,t){if(Py.randomUUID&&!e&&!n)return Py.randomUUID();n=n||{};const r=n.random||(n.rng||a2)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return c2(r)}var Q0={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function o(c,l,u,h,y){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new i(u,h||c,y),f=t?t+l:l;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],d]:c._events[f].push(d):(c._events[f]=d,c._eventsCount++),c}function s(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],l,u;if(this._eventsCount===0)return c;for(u in l=this._events)e.call(l,u)&&c.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},a.prototype.listeners=function(c){var l=t?t+c:c,u=this._events[l];if(!u)return[];if(u.fn)return[u.fn];for(var h=0,y=u.length,d=new Array(y);h<y;h++)d[h]=u[h].fn;return d},a.prototype.listenerCount=function(c){var l=t?t+c:c,u=this._events[l];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,l,u,h,y,d){var f=t?t+c:c;if(!this._events[f])return!1;var p=this._events[f],v=arguments.length,w,S;if(p.fn){switch(p.once&&this.removeListener(c,p.fn,void 0,!0),v){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,l),!0;case 3:return p.fn.call(p.context,l,u),!0;case 4:return p.fn.call(p.context,l,u,h),!0;case 5:return p.fn.call(p.context,l,u,h,y),!0;case 6:return p.fn.call(p.context,l,u,h,y,d),!0}for(S=1,w=new Array(v-1);S<v;S++)w[S-1]=arguments[S];p.fn.apply(p.context,w)}else{var R=p.length,j;for(S=0;S<R;S++)switch(p[S].once&&this.removeListener(c,p[S].fn,void 0,!0),v){case 1:p[S].fn.call(p[S].context);break;case 2:p[S].fn.call(p[S].context,l);break;case 3:p[S].fn.call(p[S].context,l,u);break;case 4:p[S].fn.call(p[S].context,l,u,h);break;default:if(!w)for(j=1,w=new Array(v-1);j<v;j++)w[j-1]=arguments[j];p[S].fn.apply(p[S].context,w)}}return!0},a.prototype.on=function(c,l,u){return o(this,c,l,u,!1)},a.prototype.once=function(c,l,u){return o(this,c,l,u,!0)},a.prototype.removeListener=function(c,l,u,h){var y=t?t+c:c;if(!this._events[y])return this;if(!l)return s(this,y),this;var d=this._events[y];if(d.fn)d.fn===l&&(!h||d.once)&&(!u||d.context===u)&&s(this,y);else{for(var f=0,p=[],v=d.length;f<v;f++)(d[f].fn!==l||h&&!d[f].once||u&&d[f].context!==u)&&p.push(d[f]);p.length?this._events[y]=p.length===1?p[0]:p:s(this,y)}return this},a.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&s(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(Q0);const u2=Q0.exports;var h2={exports:{}};(function(n,e){(function(t){var r=this,i=Object.prototype.hasOwnProperty,o=function(c){for(var l=new Array(c.length),u=c.length,h=u-1;u--;)l[h-u]=c[u];return l},s=function(){var c=Array.prototype.slice.call(arguments);return c.length==2?s.find.apply(this,c):s.transform.apply(this,c)};s.find=function(c,l){return s.get(l,c)},s.memoizePath=!0;var a={};s.get=function(c,l,u){if(c===t||c===null||l===t||l===null)return u;var h;for(typeof l=="string"?s.memoizePath?a[l]?h=a[l].slice(0):(h=l.split(".").reverse(),a[l]=h.slice(0)):h=l.split(".").reverse():Array.isArray(l)&&(h=o(l));h.length&&(c=c[h.pop()])!==t&&c!==null;);return c===null&&h.length&&(c=t),c===t?u:c},s.exists=function(c,l){return s.get(c,l)!==t},s.set=function(c,l,u,h){var y=Array.isArray(l)?l:l.split("."),d=c,f,p=y.length;if(typeof d!="object")throw new Error("Parent is not an object.");for(var v=0;v<p;v++)if(f=y[v],(!i.call(d,f)||d[f]===t||(typeof d[f]!="object"||d[f]===null)&&h&&h.force===!0)&&(d[f]={}),v==p-1)d[f]=u;else{if(typeof d[f]!="object"||d[f]===null)throw new Error('Target key "'+f+'" is not suitable for a nested value. (It is in use as non-object. Set `force` to `true` to override.)');d=d[f]}d[f]=u},s.default=function(c,l,u){s.get(c,l)===t&&s.set(c,l,u)},s.transform=function(c,l){if(Array.isArray(c))return c.map(function(j){return s.transform(j,l)});l=l||{},l.delimiter=l.delimiter||".";var u,h,y,d,f={},p,v=Object.keys(c),w=v.length,S;for(S=0;S<w;S++)if(p=v[S],p.indexOf(l.delimiter)!==-1){u=p.split(l.delimiter),h=u.length,d=f;for(var R=0;R<h&&(y=u[R],R!=h-1&&!d.hasOwnProperty(y)&&(d[y]={}),R==h-1&&(d[y]=c[p]),d=d[y],d!==null);R++);}else f[p]=c[p];return f},s.flatten=function(c,l){typeof l=="undefined"&&(l=".");var u={},h,y;for(var d in c)if(i.call(c,d))if(h=c[d],Object.prototype.toString.call(h)==="[object Object]"){y=s.flatten(h,l);for(var f in y)u[d+l+f]=y[f]}else u[d]=h;return u},s.paths=function(c,l){var u=[],h,y;if(l=l||[],typeof c=="object")for(y in c)h=c[y],typeof h=="object"&&h!==null?u=u.concat(s.paths(h,l.concat([y]))):u.push(l.concat(y).join("."));else throw new Error("Paths was called with non-object argument.");return u},n.exports?n.exports=s:(r.Dottie=s,r.Dot=s,typeof t=="function"&&t([],function(){return s}))})()})(h2);function Fl(n,e){try{n(e)}catch(t){console.error("Error in subscription callback",t)}}const Ir=Symbol("subscriptions"),Nr=Symbol("oneTimeEvents");class Ji{constructor(){this[Ir]=[],this[Nr]=new Map}on(e,t){return this[Nr].has(e)?Fl(t,this[Nr].get(e)):(this[Ir].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[Ir]=this[Ir].filter(r=>r.event!==e||t&&r.callback!==t),this}once(e,t){return new Promise(r=>{const i=o=>{r(o),t==null||t(o)};this[Nr].has(e)?Fl(i,this[Nr].get(e)):this[Ir].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[Nr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let r=0;r<this[Ir].length;r++){const i=this[Ir][r];i.event===e&&(Fl(i.callback,t),i.once&&(this[Ir].splice(r,1),r--))}return this}emitOnce(e,t){if(this[Nr].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[Nr].set(e,t),this.off(e),this}pipe(e,t){this.on(e,r=>{t.emit(e,r)})}pipeOnce(e,t){this.once(e,r=>{t.emitOnce(e,r)})}}function Br(n){return n=n.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),n.length===0?[]:n.split("/").map(e=>e.startsWith("[")?parseInt(e.slice(1,-1)):e)}class Y{static get(e){return new Y(e)}static getChildPath(e,t){return Y.get(e).child(t).path}static getPathKeys(e){return Br(e)}constructor(e){typeof e=="string"?this.keys=Br(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,r,i)=>i===0?`${r}`:typeof r=="string"?`${t}/${r}`:`${t}[${r}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new Y(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=Br(e);t.forEach(r=>{if(typeof r=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(r))throw new Error(`Invalid child key "${r}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(r.length>128)throw new Error(`child key "${r}" for path "${this.path}" is too long. Max key length is 128`);if(r.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new Y(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const r=Br(e),i=Br(t);let o=0;const s={get length(){return o}};return r.forEach((a,c)=>{const l=i[c];if(a==="*")s[o++]=l;else if(typeof a=="string"&&a[0]==="$"){s[o++]=l,s[a]=l;const u=a.slice(1);typeof s[u]=="undefined"&&(s[u]=l)}}),s}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const r=Br(e),i=Br(t),o=r.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let s="";return o.forEach(a=>{typeof a=="number"?s+=`[${a}]`:(s.length>0&&(s+="/"),s+=a)}),s}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const r=Br(e);let i=0;return r.reduce((o,s)=>typeof s=="string"&&(s==="*"||s.startsWith("$"))?Y.getChildPath(o,t[i++]):Y.getChildPath(o,s),"")}equals(e){const t=e instanceof Y?e:new Y(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isAncestorOf(e){const t=e instanceof Y?e:new Y(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((r,i)=>{const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isDescendantOf(e){const t=e instanceof Y?e:new Y(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((r,i)=>{const o=this.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isOnTrailOf(e){const t=e instanceof Y?e:new Y(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((r,i)=>{if(i>=t.keys.length)return!0;const o=t.keys[i];return o===r||typeof o=="string"&&(o==="*"||o[0]==="$")||typeof r=="string"&&(r==="*"||r[0]==="$")})}isChildOf(e){const t=e instanceof Y?e:new Y(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof Y?e:new Y(e);return t.path===""?!1:this.equals(t.parent)}}function Wl(n,e,t=!1){if(!n.exists())return null;let r=t?n.previous():n.val();return typeof e=="number"?r[e]:(Y.getPathKeys(e).every(i=>(r=r[i],typeof r!="undefined")),r||null)}function zl(n){if(!n.exists())return[];const e=n.val();return e instanceof Array?new Array(e.length).map((t,r)=>r):typeof e=="object"?Object.keys(e):[]}class rt{exists(){return!1}constructor(e,t,r=!1,i,o){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>r?!1:t!==null&&typeof t!="undefined",this.context=()=>o||{}}static for(e,t){return new rt(e,t)}child(e){const t=Wl(this,e,!1),r=Wl(this,e,!0);return new rt(this.ref.child(e),t,!1,r)}hasChild(e){return Wl(this,e)!==null}hasChildren(){return zl(this).length>0}numChildren(){return zl(this).length}forEach(e){const t=this.val(),r=this.previous();return zl(this).every(i=>{const o=new rt(this.ref.child(i),t[i],!1,r[i]);return e(o)})}get key(){return this.ref.key}}class Sa extends rt{constructor(e,t,r){super(e,t,!1,void 0,r),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(t=>{const r=t.target.reduce((o,s)=>o.child(s),this.ref),i=new rt(r,t.val,!1,t.prev);return e(i)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],r=t.target.reduce((i,o)=>i.child(o),this.ref);return new rt(r,t.val,!1,t.prev)}}class Z0{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,r)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return r(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:r})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const r=this._internal.activatePromises.shift();e?(r.callback&&r.callback(!0),r.resolve&&r.resolve()):(r.callback&&r.callback(!1,t),r.reject&&r.reject(t))}}}class d2{constructor(e,t,r){this.publish=e,this.start=t,this.cancel=r}}class f2{constructor(e){const t=[];let r,i;const o="stopped (no more subscribers)";this.subscribe=(h,y)=>{if(typeof h!="function")throw new TypeError("callback must be a function");if(i===o)throw new Error("stream can't be used anymore because all subscribers were stopped");const d={callback:h,activationCallback:function(f,p){y==null||y(f,p),this.subscription._setActivationState(f,p)},subscription:new Z0(function(){return t.splice(t.indexOf(this),1),s()})};return t.push(d),typeof i!="undefined"&&(i===!0?(y==null||y(!0),d.subscription._setActivationState(!0)):typeof i=="string"&&(y==null||y(!1,i),d.subscription._setActivationState(!1,i))),d.subscription};const s=()=>{let h;return t.length===0&&(h=r==null?void 0:r(),i=o),Promise.resolve(h)};this.unsubscribe=h=>{(h?t.filter(y=>y.callback===h):t).forEach(y=>{const d=t.indexOf(y);t.splice(d,1)}),s()},this.stop=()=>{t.splice(0),s()};const a=h=>(t.forEach(y=>{try{y.callback(h)}catch(d){console.error(`Error running subscriber callback: ${d.message}`)}}),t.length===0&&s(),t.length>0),c=h=>{i=!0,r=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!0)})},l=h=>{i=h,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!1,h||new Error("unknown reason"))}),t.splice(0)},u=new d2(a,c,l);e(u)}}function Gd(n,e){const t="000000000"+n;return t.substr(t.length-e)}const p2=typeof window=="object"?window:self,y2=Object.keys(p2).length;var jy,Cy;const g2=(Cy=(jy=navigator.mimeTypes)==null?void 0:jy.length)!=null?Cy:0,m2=Gd((g2+navigator.userAgent.length).toString(36)+y2.toString(36),4);function v2(){return m2}let wo=0;const Xd=4,Ja=36,ew=Math.pow(Ja,Xd);function Ry(){return Gd((Math.random()*ew<<0).toString(Ja),Xd)}function b2(){return wo=wo<ew?wo:0,wo++,wo-1}function w2(n=0){const e="c",t=(new Date().getTime()+n).toString(Ja),r=Gd(b2().toString(Ja),Xd),i=v2(),o=Ry()+Ry();return e+t+r+i+o}let Iy=0;class Lt{static set timeBias(e){typeof e=="number"&&(Iy=e)}static generate(){return w2(Iy).slice(1)}}class it{constructor(e){this.path=e}}const kn={nextTick(n){setTimeout(n,0)}};class Ya{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function k2(n){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,n),new Array(...e)}function x2(n){if((Array.isArray(n)?n.length:n.byteLength)!==8)throw new TypeError("must be 8 bytes");const e=new Uint8Array(n);return new DataView(e.buffer).getFloat64(0)}const Fr={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function E2(n){if(typeof n!="bigint")throw new Error("number must be a bigint");const e=[],t=n<Fr.zero;do{const r=Number(n&Fr.ff);e.push(r),n=n>>Fr.eight}while(n!==(t?-Fr.one:Fr.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function _2(n){const e=n[0]>=128;let t=Fr.zero;for(let r of n)e&&(r=~r&255),t=(t<<Fr.eight)+BigInt(r);return e&&(t=-(t+Fr.one)),t}function $2(n){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(n);if(typeof Buffer=="function"){const e=Buffer.from(n,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r>128){if((r&55296)===55296){const i=n.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const o=r&1023,s=i&1023;r=65536|o<<10|s}if(r<2048){const i=192|r>>6&31,o=128|r&63;e.push(i,o)}else if(r<65536){const i=224|r>>12&15,o=128|r>>6&63,s=128|r&63;e.push(i,o,s)}else if(r<2097152){const i=240|r>>18&7,o=128|r>>12&63,s=128|r>>6&63,a=128|r&63;e.push(i,o,s,a)}else throw new Error(`Cannot convert character ${n.charAt(t)} (code ${r}) to utf-8`)}else e.push(r<128?r:63)}return new Uint8Array(e)}}function tw(n){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(n instanceof Uint8Array)return e.decode(n);const t=Uint8Array.from(n);return e.decode(t)}else if(typeof Buffer=="function"){if(n instanceof Array&&(n=Uint8Array.from(n)),!(n instanceof Buffer)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(n instanceof Buffer))throw new Error("Unsupported buffer argument");return n.toString("utf-8")}else{if(!(n instanceof Uint8Array)&&"buffer"in n&&n.buffer instanceof ArrayBuffer){const e=n;n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(n instanceof Buffer||n instanceof Array||n instanceof Uint8Array){let e="";for(let t=0;t<n.length;t++){let r=n[t];if(r>128)if((r&240)===240){const i=r,o=n[t+1],s=n[t+2],a=n[t+3];r=(i&7)<<18|(o&63)<<12|(s&63)<<6|a&63,t+=3}else if((r&224)===224){const i=r,o=n[t+1],s=n[t+2];r=(i&15)<<12|(o&63)<<6|s&63,t+=2}else if((r&192)===192){const i=r,o=n[t+1];r=(i&31)<<6|o&63,t++}else throw new Error("invalid utf-8 data");if(r>=65536){r^=65536;const i=55296|r>>10,o=56320|r&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(o)}else e+=String.fromCharCode(r)}return e}else throw new Error("Unsupported buffer argument")}}function O2(n,e){const t=new n.constructor(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Dn(n,e){var t;if(((t=n==null?void 0:n.constructor)==null?void 0:t.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${n.ref.path}")`);const r=s=>(s!==null&&typeof s=="object"&&typeof s.constructor=="function"&&typeof s.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(s.constructor.name)&&(s=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)),s);if(n=r(n),typeof n!="object"||n===null||n instanceof Date||n instanceof ArrayBuffer||n instanceof it||n instanceof RegExp)return n;const i=s=>{if(e.indexOf(s)>=0)throw new ReferenceError("object contains a circular reference");return s=r(s),s===null||s instanceof Date||s instanceof ArrayBuffer||s instanceof it||s instanceof RegExp||typeof s=="object"&&(e.push(s),s=Dn(s,e),e.pop()),s};typeof e=="undefined"&&(e=[n]);const o=n instanceof Array?[]:n instanceof Ya?new Ya:{};return Object.keys(n).forEach(s=>{const a=n[s];typeof a!="function"&&(o[s]=i(a))}),o}const Kr=n=>typeof n=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(n.constructor.name);function Ga(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="object"||typeof e=="object"){if(n===null||e===null)return!1;if(n instanceof it||e instanceof it)return n instanceof it&&e instanceof it&&n.path===e.path;if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime();if(n instanceof Array||e instanceof Array)return n instanceof Array&&e instanceof Array&&n.length===e.length&&n.every((i,o)=>Ga(n[o],e[o]));if(Kr(n)||Kr(e)){if(!Kr(n)||!Kr(e)||n.byteLength===e.byteLength)return!1;const i=n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((s,a)=>o[a]===s)}const t=Object.keys(n),r=Object.keys(e);return t.length===r.length&&t.every(i=>r.includes(i))&&t.every(i=>Ga(n[i],e[i]))}return!1}class nw{constructor(e,t,r){this.added=e,this.removed=t,this.changed=r}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(r=>r.key===e);return t?t.change:"identical"}}function Qd(n,e,t=!1){const r=[void 0,null];if(n===e)return"identical";if(r.indexOf(n)>=0&&r.indexOf(e)<0)return"added";if(r.indexOf(n)<0&&r.indexOf(e)>=0)return"removed";if(typeof n!=typeof e)return"changed";if(Kr(n)||Kr(e)){if(!Kr(n)||!Kr(e))return"changed";const i=n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===o.byteLength&&i.every((s,a)=>o[a]===s)?"identical":"changed"}else{if(n instanceof Date||e instanceof Date)return n instanceof Date&&e instanceof Date&&n.getTime()===e.getTime()?"identical":"changed";if(n instanceof it||e instanceof it)return n instanceof it&&e instanceof it&&n.path===e.path?"identical":"changed";if(typeof n=="object"){const i=n instanceof Array,o=h=>{let y=Object.keys(h).filter(d=>!r.includes(h[d]));return i&&(y=y.map(d=>parseInt(d))),y},s=o(n),a=o(e),c=s.filter(h=>!a.includes(h)),l=a.filter(h=>!s.includes(h)),u=a.reduce((h,y)=>{if(s.includes(y)){const d=n[y],f=e[y],p=Qd(d,f);p!=="identical"&&h.push({key:y,change:p})}return h},[]);return l.length===0&&c.length===0&&u.length===0?"identical":new nw(l,c,t?u.sort((h,y)=>h.key<y.key?-1:1):u)}}return"changed"}function rw(n,e,t=!1){const r=(o,s,a,c)=>{switch(s){case"identical":return[];case"changed":return[{target:o,prev:a,val:c}];case"added":return[{target:o,prev:null,val:c}];case"removed":return[{target:o,prev:a,val:null}];default:{let l=[];return s.added.forEach(u=>l.push({target:o.concat(u),prev:null,val:c[u]})),s.removed.forEach(u=>l.push({target:o.concat(u),prev:a[u],val:null})),s.changed.forEach(u=>{const h=r(o.concat(u.key),u.change,a[u.key],c[u.key]);l=l.concat(h)}),l}}},i=Qd(n,e,t);return r([],i,n,e)}function A2(n,e,t){return e=e===null?null:e[n],typeof e=="undefined"&&(e=null),t=t===null?null:t[n],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function S2(n){kn.nextTick(n)}function iw(){var n;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(n=function(){return this}())!=null?n:Function("return this")()}const ow=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:k2,bytesToNumber:x2,bigintToBytes:E2,bytesToBigint:_2,encodeString:$2,decodeString:tw,concatTypedArrays:O2,cloneObject:Dn,valuesAreEqual:Ga,ObjectDifferences:nw,compareValues:Qd,getMutations:rw,getChildValues:A2,defer:S2,getGlobalObject:iw},Symbol.toStringTag,{value:"Module"})),T2="modulepreload",P2=function(n){return"/"+n},Ny={},j2=function(n,e,t){if(!e||e.length===0)return n();const r=document.getElementsByTagName("link");return Promise.all(e.map(i=>{if(i=P2(i),i in Ny)return;Ny[i]=!0;const o=i.endsWith(".css"),s=o?'[rel="stylesheet"]':"";if(t)for(let c=r.length-1;c>=0;c--){const l=r[c];if(l.href===i&&(!o||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${s}`))return;const a=document.createElement("link");if(a.rel=o?"stylesheet":T2,o||(a.as="script",a.crossOrigin=""),a.href=i,document.head.appendChild(a),o)return new Promise((c,l)=>{a.addEventListener("load",c),a.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>n())};let sw=!1,Yr;W(void 0,null,function*(){const n=iw();if(typeof n.Observable!="undefined"){Yr=n.Observable;return}try{const{Observable:e}=yield j2(()=>Promise.resolve().then(()=>TU),void 0);Yr=e}catch(e){Yr=ef}});function Zd(){if(Yr===ef&&!sw&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),Yr)return Yr;throw new Error("RxJS Observable could not be loaded. ")}function C2(n){n==="shim"?(Yr=ef,sw=!0):Yr=n}class ef{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const t={next:r=>{this._subscribers.forEach(i=>{try{i(r)}catch(o){console.error("Error in subscriber callback:",o)}})}};this._cleanup=this._create(t),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class pn extends Array{static areEqual(e,t){return e.length===t.length&&e.every((r,i)=>t[i]===r)}static isAncestor(e,t){return e.length<t.length&&e.every((r,i)=>t[i]===r)}static isDescendant(e,t){return e.length>t.length&&t.every((r,i)=>e[i]===r)}}const ui=Symbol("isProxy");class R2{static create(e,t){return W(this,null,function*(){var r;e=new Fn(e.db,e.path);let i,o=!1,s=t==null?void 0:t.cursor,a;const c=Lt.generate(),l=[],u=new Ji;u.on("cursor",g=>s=g),u.on("error",g=>{console.error(g.message,g.details)});const h=(g,b)=>{if(g.length===0)return i=b,!0;let m=i;const x=g.slice();for(;x.length>1;){const k=x.shift();if(!(k in m))return!1;m=m[k]}const O=x.shift();return b===null?m instanceof Array?m.splice(O,1):delete m[O]:m[O]=b,!0},y=()=>W(this,null,function*(){!o||(yield E())}),d=e.on("mutations",{syncFallback:y}).subscribe(g=>W(this,null,function*(){var b;if(!o)return;const m=g.context(),x=((b=m.acebase_proxy)==null?void 0:b.id)!==c;!x||(g.val(!1).every(O=>{if(!h(O.target,O.val))return!1;const k=O.target.reduce((_,A)=>_.child(A),e),$=new rt(k,O.val,!1,O.prev,g.context());return u.emit("mutation",{snapshot:$,isRemote:x}),!0})?(u.emit("cursor",m.acebase_cursor),P.emit("mutations",{origin:"remote",snap:g})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield E()))}));let f=Promise.resolve();const p=[],v=[],w=()=>W(this,null,function*(){const g=[];for(let b=0,m=p[0];b<p.length;b++,m=p[b])v.find(x=>pn.areEqual(x.target,m.target)||pn.isAncestor(x.target,m.target))||(p.splice(b,1),b--,g.push(m));g.length!==0&&(g.forEach(b=>{b.value=Dn(mn(i,b.target))}),kn.nextTick(()=>{const b={acebase_proxy:{id:c,source:"update"}};g.forEach(x=>{const O=x.target.reduce(($,_)=>$.child(_),e),k=new rt(O,x.value,!1,x.previous,b);u.emit("mutation",{snapshot:k,isRemote:!1})});const m=new Sa(e,g.map(x=>({target:x.target,val:x.value,prev:x.previous})),b);P.emit("mutations",{origin:"local",snap:m})}),f=g.reduce((b,m,x,O)=>(O.some(k=>pn.isAncestor(k.target,m.target))||b.push(m),b),[]).reduce((b,m)=>{const x=m.target;if(x.length===0)b.push({ref:e,target:x,value:i,type:"set",previous:m.previous});else{const O=x.slice(0,-1),k=x.slice(-1)[0],$=O.reduce((C,L)=>C.child(L),e),_=b.find(C=>C.ref.path===$.path),A=mn(i,x),T=m.previous;_?(_.value[k]=A,_.previous[k]=T):b.push({ref:$,target:O,value:{[k]:A},type:"update",previous:{[k]:T}})}return b},[]).reduce((b,m)=>W(this,null,function*(){const x={acebase_proxy:{id:c,source:m.type}};yield b,yield m.ref.context(x)[m.type](m.value).catch(O=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:O});const k={acebase_proxy:{id:c,source:"update-rollback"}},$=[];if(m.type==="set"){Kl(i,m.target,m.previous);const A=new rt(m.ref,m.previous,!1,m.value,k);u.emit("mutation",{snapshot:A,isRemote:!1}),$.push({target:m.target,val:m.previous,prev:m.value})}else Object.keys(m.previous).forEach(A=>{Kl(i,m.target.concat(A),m.previous[A]);const T=new rt(m.ref.child(A),m.previous[A],!1,m.value[A],k);u.emit("mutation",{snapshot:T,isRemote:!1}),$.push({target:m.target.concat(A),val:m.previous[A],prev:m.value[A]})});$.forEach(A=>{const T=A.target.reduce((L,V)=>L.child(V),e),C=new rt(T,A.val,!1,A.prev,k);u.emit("mutation",{snapshot:C,isRemote:!1})});const _=new Sa(m.ref,$,k);P.emit("mutations",{origin:"local",snap:_})}),m.ref.cursor&&u.emit("cursor",m.ref.cursor)}),f),yield f)});let S=!1;const R=[],j=()=>{let g;const b=new Promise(m=>g=m);return R.push({resolve:g}),b};let N=null;const D=()=>{N||(N=setTimeout(()=>W(this,null,function*(){S=!0,N=null,yield w(),S=!1,R.splice(0).forEach(g=>g.resolve())}),0))},q=g=>{p.find(b=>pn.areEqual(b.target,g))||p.push({target:g,previous:Dn(mn(i,g))}),D()},P=new Ji,I=(g,b)=>{const m=k=>k!==null&&typeof k=="object",x=k=>W(this,null,function*(){var $;const{snap:_,origin:A}=k,T=_.context(),C=(($=T.acebase_proxy)==null?void 0:$.id)===c;if(k.origin==="remote"&&C){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const L=_.val(!1).filter(ie=>ie.target.slice(0,g.length).every((ee,fe)=>g[fe]===ee));if(L.length===0)return;let V,K;const G=L.find(ie=>ie.target.length<=g.length);if(G){const ie=g.slice(G.target.length);V=ie.reduce((ee,fe)=>!m(ee)||!(fe in ee)?null:ee[fe],G.val),K=ie.reduce((ee,fe)=>!m(ee)||!(fe in ee)?null:ee[fe],G.prev)}else{const ie=mn(i,g);V=Dn(ie),K=Dn(V),L.forEach(ee=>{const fe=ee.target.slice(g.length);for(let de=0,ne=V,ce=K;de<fe.length;de++){const Me=de+1===fe.length,ve=fe[de];Me?(ne[ve]=ee.val,ne[ve]===null&&delete ne[ve],ce[ve]=ee.prev,ce[ve]===null&&delete ce[ve]):(ne=ne[ve]=ve in ne?ne[ve]:{},ce=ce[ve]=ve in ce?ce[ve]:{})}})}kn.nextTick(()=>{let ie=!0;try{ie=b(Object.freeze(V),Object.freeze(K),!C,T)!==!1}catch(ee){u.emit("error",{source:A==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:ee})}ie===!1&&O()})});P.on("mutations",x);const O=()=>{P.off("mutations",x),l.splice(l.findIndex(k=>k.stop===O),1)};return l.push({target:g,stop:O}),{stop:O}},B=(g,b,m)=>{if(g==="write")return q(b);if(g==="onChange")return I(b,m.callback);if(g==="subscribe"||g==="observe"){const x=k=>{const $=mn(i,b);k.next($);const _=I(b,A=>{k.next(A)});return function(){_.stop()}};if(g==="subscribe")return x;const O=Zd();return new O(x)}else if(g==="transaction")return v.some(x=>pn.areEqual(b,x.target)||pn.isAncestor(b,x.target)||pn.isDescendant(b,x.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(x=>W(this,null,function*(){p.some(k=>pn.areEqual(b,k.target)||pn.isAncestor(b,k.target))&&(S||D(),yield j());const O={target:b,status:"started",transaction:null};v.push(O),O.transaction={get status(){return O.status},get completed(){return O.status!=="started"},get mutations(){return p.filter(k=>pn.areEqual(O.target,k.target)||pn.isAncestor(O.target,k.target))},get hasMutations(){return this.mutations.length>0},commit(){return W(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${O.status}')`);O.status="finished",v.splice(v.indexOf(O),1),S&&(yield j()),D(),yield j()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${O.status}')`);O.status="canceled";const k=[];for(let $=0;$<p.length;$++){const _=p[$];(pn.areEqual(O.target,_.target)||pn.isAncestor(O.target,_.target))&&(p.splice($,1),$--,k.push(_))}k.reverse().forEach($=>{$.target.length===0?i=$.previous:Kl(i,$.target,$.previous)}),v.splice(v.indexOf(O),1)}},x(O.transaction)}))},U=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(U.context().acebase_origin!=="cache"&&u.emit("cursor",(r=e.cursor)!=null?r:null),o=!0,i=U.val(),i===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){i=t.defaultValue;const g={acebase_proxy:{id:c,source:"default"}};yield e.context(g).set(i)}a=aw({root:{ref:e,get cache(){return i}},target:[],id:c,flag:B});const M=()=>{if(a===null)throw new Error("Proxy was destroyed")},E=()=>W(this,null,function*(){M(),p.splice(0);const g=yield e.get({allow_cache:!1}),b=i,m=g.val();i=m;const x=rw(b,m);if(x.length===0)return;const O=g.context();O.acebase_proxy={id:c,source:"reload"},x.forEach($=>{const _=uh(e,$.target),A=new rt(_,$.val,$.val===null,$.prev,O);u.emit("mutation",{snapshot:A,isRemote:!0})});const k=new Sa(e,x,O);P.emit("mutations",{origin:"local",snap:k})});return{destroy(){return W(this,null,function*(){yield f;const g=[d.stop(),...l.map(b=>b.stop())];yield Promise.all(g),["cursor","mutation","error"].forEach(b=>u.off(b)),i=null,a=null})},stop(){this.destroy()},get value(){return M(),a},get hasValue(){return M(),i!==null},set value(g){M(),g!==null&&typeof g=="object"&&g[ui]&&(g=g.valueOf()),q([]),i=g},get ref(){return e},get cursor(){return s},reload:E,onMutation(g){M(),u.off("mutation"),u.on("mutation",({snapshot:b,isRemote:m})=>{try{g(b,m)}catch(x){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:x})}})},onError(g){M(),u.off("error"),u.on("error",b=>{try{g(b)}catch(m){console.error(`Error in dataproxy onError callback: ${m.message}`)}})},on(g,b){u.on(g,b)},off(g,b){u.off(g,b)}}})}}function mn(n,e){let t=n;for(const r of e)t=typeof t=="object"&&t!==null&&r in t?t[r]:null;return t}function Kl(n,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const r=e.slice(0,-1).reduce((o,s)=>o[s],n),i=e.slice(-1)[0];t===null||typeof t=="undefined"?r instanceof Array?r.splice(i,1):delete r[i]:r[i]=t}function uh(n,e){const t=Y.get(n.path).childPath(e);return new Fn(n.db,t)}function aw(n){const e=uh(n.root.ref,n.target),t=[],r={get(o,s,a){if(o=mn(n.root.cache,n.target),typeof s=="symbol")if(s.toString()===Symbol.iterator.toString())s="values";else return s.toString()===ui.toString()?!0:Reflect.get(o,s,a);if(s==="valueOf")return function(){return o};if(o===null||typeof o!="object")throw new Error(`Cannot read property "${s}" of ${o}. Value of path "/${e.path}" is not an object (anymore)`);o instanceof Array&&typeof s=="string"&&/^[0-9]+$/.test(s)&&(s=parseInt(s));const c=o[s];if(c===null){delete o[s];return}const l=t.find(d=>d.prop===s);if(l){if(l.typeof===typeof c)return l.value;t.splice(t.indexOf(l),1)}const u=d=>{const f=o[d],p=t.find(w=>w.prop===d);if(p){if(p.typeof===typeof f)return p.value;t.splice(t.indexOf(p),1)}if(typeof f!="object")return f;const v=aw({root:n.root,target:n.target.concat(d),id:n.id,flag:n.flag});return t.push({typeof:typeof f,prop:d,value:v}),v},h=d=>d!==null&&typeof d=="object"&&d[ui]?d.getTarget():d;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof it||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const y=o instanceof Array;if(s==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return s==="push"?function(d){const f=e.push();return n.flag("write",n.target.concat(f.key)),o[f.key]=d,f.key}:s==="getTarget"?function(d=!0){return d&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),o}:s==="getRef"?function(){return uh(n.root.ref,n.target)}:s==="forEach"?function(d){const f=Object.keys(o);let p=!1;for(let v=0;!p&&v<f.length;v++){const w=f[v],S=u(w);p=d(S,w,v)===!1}}:["values","entries","keys"].includes(s)?function*(){const d=Object.keys(o);for(const f of d)if(s==="keys")yield f;else{const p=u(f);s==="entries"?yield[f,p]:yield p}}:s==="toArray"?function(d){const f=Object.keys(o).map(p=>u(p));return d&&f.sort(d),f}:s==="onChanged"?function(d){return n.flag("onChange",n.target,{callback:d})}:s==="subscribe"?function(){return n.flag("subscribe",n.target)}:s==="getObservable"?function(){return n.flag("observe",n.target)}:s==="getOrderedCollection"?function(d,f){return new I2(this,d,f)}:s==="startTransaction"?function(){return n.flag("transaction",n.target)}:s==="remove"&&!y?function(){if(n.target.length===0)throw new Error("Can't remove proxy root value");const d=mn(n.root.cache,n.target.slice(0,-1)),f=n.target.slice(-1)[0];n.flag("write",n.target),delete d[f]}:void 0;if(typeof c=="function"){if(y){const d=p=>(n.flag("write",n.target),p()),f=p=>p.map(v=>(v=h(v),hh(v),v));if(s==="push")return function(...p){return p=f(p),d(()=>o.push(...p))};if(s==="pop")return function(){return d(()=>o.pop())};if(s==="splice")return function(p,v,...w){return w=f(w),d(()=>o.splice(p,v,...w))};if(s==="shift")return function(){return d(()=>o.shift())};if(s==="unshift")return function(...p){return p=f(p),d(()=>o.unshift(...p))};if(s==="sort")return function(p){return d(()=>o.sort(p))};if(s==="reverse")return function(){return d(()=>o.reverse())};if(["indexOf","lastIndexOf"].includes(s))return function(p,v){return p!==null&&typeof p=="object"&&p[ui]&&(p=p.getTarget(!1)),o[s](p,v)};if(["forEach","every","some","filter","map"].includes(s))return function(p){return o[s]((v,w)=>p(u(w),w,i))};if(["reduce","reduceRight"].includes(s))return function(p,v){return o[s]((w,S,R)=>p(w,u(R),R,i),v)};if(["find","findIndex"].includes(s))return function(p){let v=o[s]((w,S)=>p(u(S),S,i));if(s==="find"&&v){const w=o.indexOf(v);v=u(w)}return v};if(["values","entries","keys"].includes(s))return function*(){for(let p=0;p<o.length;p++)if(s==="keys")yield p;else{const v=u(p);s==="entries"?yield[p,v]:yield v}}}return c}return u(s)},set(o,s,a,c){if(o=mn(n.root.cache,n.target),typeof s=="symbol")return Reflect.set(o,s,a,c);if(o===null||typeof o!="object")throw new Error(`Cannot set property "${s}" of ${o}. Value of path "/${e.path}" is not an object`);if(o instanceof Array&&typeof s=="string"){if(!/^[0-9]+$/.test(s))throw new Error(`Cannot set property "${s}" on array value of path "/${e.path}"`);s=parseInt(s)}return a!==null&&(typeof a=="object"&&(a[ui]&&(a=a.valueOf()),a=Dn(a)),Ga(a,o[s]))||(n.target.some(l=>typeof l=="number")?n.flag("write",n.target.slice(0,n.target.findIndex(l=>typeof l=="number"))):o instanceof Array?n.flag("write",n.target):n.flag("write",n.target.concat(s)),a===null?delete o[s]:(hh(a),o[s]=a)),!0},deleteProperty(o,s){if(o=mn(n.root.cache,n.target),o===null)throw new Error(`Cannot delete property ${s.toString()} of null`);return typeof s=="symbol"?Reflect.deleteProperty(o,s):(s in o&&(n.flag("write",n.target.concat(s)),delete o[s]),!0)},ownKeys(o){return o=mn(n.root.cache,n.target),Reflect.ownKeys(o)},has(o,s){return o=mn(n.root.cache,n.target),Reflect.has(o,s)},getOwnPropertyDescriptor(o,s){o=mn(n.root.cache,n.target);const a=Reflect.getOwnPropertyDescriptor(o,s);return a&&(a.configurable=!0),a},getPrototypeOf(o){return o=mn(n.root.cache,n.target),Reflect.getPrototypeOf(o)}},i=new Proxy({},r);return i}function hh(n){typeof n=="object"&&Object.keys(n).forEach(e=>{const t=n[e];t===null||typeof t=="undefined"?delete n[e]:typeof t=="object"&&hh(t)})}function Ta(n){if(typeof n!="object"||!n[ui])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return n}class I2{constructor(e,t="order",r=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=r,typeof e!="object"||!e[ui])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(i=>typeof e[i]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(i=>typeof e[i][t]=="number")){const i=Object.keys(e);for(let o=0;o<i.length;o++){const s=e[i[o]];s[t]=o*r}}}getObservable(){return Ta(this.collection).getObservable()}getArrayObservable(){const e=Zd();return new e(t=>{const r=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){r.unsubscribe()}})}getArray(){return Ta(this.collection).toArray((e,t)=>e[this.orderProperty]-t[this.orderProperty])}add(e,t,r){const i=this.getArray();let o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(let c=0;c<i.length;c++){const l=i[c][this.orderProperty];o=Math.min(l,o),s=Math.max(l,s)}let a;if(typeof r=="number"){if(a=Object.keys(this.collection).find(c=>this.collection[c]===e),!a)throw new Error("item not found in collection");if(r===t)return{key:a,index:t};if(Math.abs(r-t)===1){const c=i[t],l=c[this.orderProperty];return c[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=l,{key:a,index:t}}else i.splice(r,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:s+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:o-this.orderIncrement;else{const c=i.map(u=>u[this.orderProperty]),l=c[t]-c[t-1];if(l>1)e[this.orderProperty]=c[t]-Math.floor(l/2);else{i.splice(t,0,e);for(let u=0;u<i.length;u++)i[u][this.orderProperty]=u*this.orderIncrement}}return{key:typeof a=="string"?a:Ta(this.collection).push(e),index:t}}delete(e){const t=this.getArray()[e];if(!t)throw new Error(`Item at index ${e} not found`);const r=Object.keys(this.collection).find(i=>this.collection[i]===t);if(!r)throw new Error("Cannot find target object to delete");return this.collection[r]=null,{key:r,index:e}}move(e,t){const r=this.getArray();return this.add(r[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let r=0;r<t.length;r++)t[r][this.orderProperty]=r*this.orderIncrement}}class cw{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class N2 extends cw{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const Ae=Symbol("private");class Fn{constructor(e,t,r){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const i=Y.get(t).key,o=[];this[Ae]={get path(){return t},get key(){return i},get callbacks(){return o},vars:r||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const r=this[Ae].context;if(typeof e=="object"){const i=e?t?r||{}:e:{};return e&&Object.keys(e).forEach(o=>{i[o]=e[o]}),this[Ae].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),r;throw new Error("Invalid context argument")}}get cursor(){return this[Ae].cursor}set cursor(e){var t;this[Ae].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[Ae].path}get key(){const e=this[Ae].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[Ae].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=Y.fillVariables2(this.path,this.vars),t=Y.get(e);return t.parentPath===null?null:new Fn(this.db,t.parentPath).context(this[Ae].context)}get vars(){return this[Ae].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=Y.fillVariables2(this.path,this.vars),r=Y.getChildPath(t,e);return new Fn(this.db,r).context(this[Ae].context)}set(e,t){return W(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.set(this.path,e,{context:this[Ae].context});if(this.cursor=r,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}update(e,t){return W(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:r}=yield this.db.api.update(this.path,e,{context:this[Ae].context});this.cursor=r}if(typeof t=="function")try{t(null,this)}catch(r){console.error("Error in onComplete callback:",r)}}catch(r){if(typeof t=="function")try{t(r,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw r}return this})}transaction(e){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const r=o=>{o=this.db.types.deserialize(this.path,o);const s=new rt(this,o);let a;try{a=e(s)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,r,{context:this[Ae].context});if(this.cursor=i,t)throw t;return this})}on(e,t,r){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const o=new f2(c=>{i=c}),s={event:e,stream:o,userCallback:typeof t=="function"&&t,ourCallback:(c,l,u,h,y)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${l}"`,c);return}const d=this.db.ref(l);d[Ae].vars=Y.extractVariables(this.path,l);let f;if(e.startsWith("notify_"))f=d.context(y||{});else{const p={previous:this.db.types.deserialize(l,h),current:this.db.types.deserialize(l,u)};if(e==="child_removed")f=new rt(d,p.previous,!0,p.previous,y);else if(e==="mutations")f=new Sa(d,p.current,y);else{const v=e==="mutated"&&p.current===null;f=new rt(d,p.current,v,p.previous,y)}}i.publish(f),y!=null&&y.acebase_cursor&&(this.cursor=y.acebase_cursor)}};this[Ae].callbacks.push(s);const a=()=>{typeof t=="function"&&o.subscribe(t,(y,d)=>{y||r&&r(d)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const l=y=>{const d=this[Ae].callbacks;d.splice(d.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${y.message}`),i.cancel(y.message)},u=this.db.api.subscribe(this.path,e,s.ourCallback,{newOnly:c.newOnly,cancelCallback:l,syncFallback:c.syncFallback}),h=()=>{const y=this[Ae].callbacks;return y.splice(y.indexOf(s),1),this.db.api.unsubscribe(this.path,e,s.ourCallback)};if(u instanceof Promise?u.then(()=>{i.start(h)}).catch(l):i.start(h),!c.newOnly){if(e==="value")this.get(y=>{i.publish(y)});else if(e==="child_added")this.get(y=>{const d=y.val();d===null||typeof d!="object"||Object.keys(d).forEach(f=>{const p=new rt(this.child(f),d[f]);i.publish(p)})});else if(e==="notify_child_added"){let y=0;const d=()=>W(this,null,function*(){const f=yield this.db.api.reflect(this.path,"children",{limit:100,skip:y});f.list.forEach(p=>{const v=this.child(p.key);i.publish(v)}),f.more&&(y+=100,d())});d()}}};return this.db.isReady?a():this.db.ready(a),o}off(e,t){const r=this[Ae].callbacks.filter(i=>(!e||i.event===e)&&(!t||i.userCallback===t));return r.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),r.forEach(i=>{i.stream.stop()}),this}get(e,t){if(!this.db.isReady){const o=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const o=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw o;return Promise.reject(o)}const r=new cw(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,r).then(o=>{var s;"context"in o&&"value"in o||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),o={value:o,context:{}});const a=this.db.types.deserialize(this.path,o.value),c=new rt(this,a,void 0,void 0,o.context);return(s=o.context)!=null&&s.acebase_cursor&&(this.cursor=o.context.acebase_cursor),c});if(t){i.then(t).catch(o=>{console.error("Uncaught error:",o)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(r=>{const i=o=>{this.off(e,i),r(o)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const o=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw o;return Promise.reject(o)}const r=Lt.generate(),i=this.child(r);return i[Ae].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new lw(this)}count(){return W(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return W(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(e){return W(this,arguments,function*(t,r={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof t=="function"?t:t.write.bind(t);return this.db.api.export(this.path,i,r)})}import(e){return W(this,arguments,function*(t,r={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,t,r)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),R2.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=Zd();return new t(r=>{let i,o=!1,s=this.get(e).then(c=>{o=!0,i=c.val(),r.next(i)});const a=c=>{if(!o){s=s.then(()=>a(c));return}const l=c.ref.path;if(l===this.path)return i=c.val(),r.next(i);const u=Y.getPathKeys(l).slice(Y.getPathKeys(this.path).length);let h=i;for(;u.length>1;){const f=u.shift();f in h||(h[f]=typeof u[0]=="number"?[]:{}),h=h[f]}const y=u.shift(),d=c.val();d===null?h instanceof Array&&typeof y=="number"?h.splice(y,1):delete h[y]:h[y]=d,r.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return W(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),o={canceled:!1,total:i.list.length,processed:0};for(let s=0;s<i.list.length;s++){const a=i.list[s].key,c=yield this.child(a).get(r);if(o.processed++,!!c.exists()&&(yield t(c))===!1){o.canceled=!0;break}}return o})}getMutations(e){return W(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:r})})}getChanges(e){return W(this,null,function*(){const t=typeof e=="string"?e:void 0,r=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:r})})}}class lw{constructor(e){this.ref=e,this[Ae]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,r){if((t==="in"||t==="!in")&&(!(r instanceof Array)||r.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(r instanceof Array)||r.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(r instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[Ae].filters.push({key:e,op:t,compare:r}),this}where(e,t,r){return this.filter(e,t,r)}take(e){return this[Ae].take=e,this}skip(e){return this[Ae].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[Ae].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const o=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?o:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const r=new N2(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});r.allow_cache=r.cache_mode!=="bypass",r.eventHandler=o=>{if(!this[Ae].events[o.name])return!1;const s=this[Ae].events[o.name];if(typeof s!="object"||s.length===0)return!1;if(["add","change","remove"].includes(o.name)){const a={name:o.name,ref:new Fn(this.ref.db,o.path)};if(r.snapshots&&o.name!=="remove"){const c=i.types.deserialize(o.path,o.value);a.snapshot=new rt(a.ref,c,!1)}o=a}s.forEach(a=>{var c,l;try{a(o)}catch(u){this.ref.db.debug.error(`Error executing "${o.name}" event handler of realtime query on path "${this.ref.path}": ${(l=(c=u==null?void 0:u.stack)!=null?c:u==null?void 0:u.message)!=null?l:u}`)}})},r.monitor={add:!1,change:!1,remove:!1},this[Ae].events&&(this[Ae].events.add&&this[Ae].events.add.length>0&&(r.monitor.add=!0),this[Ae].events.change&&this[Ae].events.change.length>0&&(r.monitor.change=!0),this[Ae].events.remove&&this[Ae].events.remove.length>0&&(r.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[Ae],r).catch(o=>{throw new Error(o)}).then(o=>{const{stop:s}=o;let{results:a,context:c}=o;if(this.stop=()=>W(this,null,function*(){yield s()}),"results"in o&&"context"in o||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=o,c={}),r.snapshots){const l=a.map(u=>{const h=i.types.deserialize(u.path,u.val);return new rt(i.ref(u.path),h,!1,void 0,c)});return Fc.from(l)}else{const l=a.map(u=>i.ref(u));return tf.from(l)}}).then(o=>(t&&t(o),o))}stop(){return W(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return W(this,null,function*(){return(yield this.find()).length})}exists(){return W(this,null,function*(){const e=this[Ae].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return W(this,null,function*(){const t=yield this.find(),r=t.reduce((a,c)=>{const l=a[c.parent.path];return l?l.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,o=Object.keys(r).map(a=>W(this,null,function*(){const c=t.reduce((u,h)=>(u[h.key]=null,u),{}),l=i.ref(a);try{return yield l.update(c),{ref:l,success:!0}}catch(u){return{ref:l,success:!1,error:u}}})),s=yield Promise.all(o);return e&&e(s),s})}on(e,t){return this[Ae].events[e]||(this[Ae].events[e]=[]),this[Ae].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[Ae].events={},this;if(!this[Ae].events[e])return this;if(typeof t=="undefined")return delete this[Ae].events[e],this;const r=this[Ae].events[e].indexOf(t);return~r?(this[Ae].events[e].splice(r,1),this):this}forEach(e,t){return W(this,null,function*(){let r;if(typeof e=="function"?t=e:r=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),o={canceled:!1,total:i.length,processed:0};for(let s=0;s<i.length;s++){const a=yield i[s].get(r);if(o.processed++,!!a.exists()&&(yield t(a))===!1){o.canceled=!0;break}}return o})}}class Fc extends Array{static from(e){const t=new Fc(e.length);return e.forEach((r,i)=>t[i]=r),t}getValues(){return this.map(e=>e.val())}}class tf extends Array{static from(e){const t=new tf(e.length);return e.forEach((r,i)=>t[i]=r),t}getPaths(){return this.map(e=>e.path)}}function B2(n,e){e=e.replace(/^\/|\/$/g,"");const t=Y.getPathKeys(e),r=Object.keys(n).find(i=>{const o=Y.getPathKeys(i);return o.length!==t.length?!1:o.every((s,a)=>s==="*"||typeof s=="string"&&s[0]==="$"?!0:s===t[a])});return n[r]}function L2(n,e){const t=Y.get(e).parentPath;if(t!==null)return B2(n,t)}function D2(n,e){e=e.replace(/^\/|\/$/g,"");const t=Y.get(e).parentPath,r=t?Y.getPathKeys(t):[];return Object.keys(n).reduce((i,o)=>{const s=Y.getPathKeys(o);if(s.length<r.length)return i;let a=!0;if(r.length===0&&t!==null?a=s.length===1&&(s[0]==="*"||typeof s[0]=="string"&&s[0][0]==="$"):s.every((c,l)=>l>=r.length?!1:c==="*"||typeof c=="string"&&c[0]==="$"||c===r[l]?!0:(a=!1,!1)),a){const c=n[o];i.push({path:o,type:c})}return i},[])}function By(n,e,t,r,i){if(r===null||typeof r!="object")return r;const o=Y.getPathKeys(t),s=D2(e,t),a=[];return s.sort((c,l)=>Y.getPathKeys(c.path).length>Y.getPathKeys(l.path).length?-1:1),s.forEach(c=>{const l=Y.getPathKeys(c.path);l.push("*");const u=l.slice(o.length);if(u.length===0){const y=Y.extractVariables(c.path,t),d=new Fn(n,t,y);if(i==="serialize")r=c.type.serialize(r,d);else if(i==="deserialize"){const f=new rt(d,r);r=c.type.deserialize(f)}return}const h=(y,d,f)=>{if(r===null||typeof r!="object")return r;const p=f[0];let v=[];if(p==="*"||typeof p=="string"&&p[0]==="$")d instanceof Array?v=d.map((w,S)=>({key:S,val:w})):v=Object.keys(d).map(w=>({key:w,val:d[w]}));else{const w=d[p];typeof w=="object"&&v.push({key:p,val:w})}v.forEach(w=>{const S=Y.getChildPath(y,w.key),R=Y.extractVariables(c.path,S),j=new Fn(n,S,R);if(f.length===1){if(i==="serialize")a.push({parent:d,key:w.key,original:d[w.key]}),d[w.key]=c.type.serialize(w.val,j);else if(i==="deserialize"){const N=new rt(j,w.val);d[w.key]=c.type.deserialize(N)}}else h(S,w.val,f.slice(1))})};h(t,r,u)}),i==="serialize"&&(r=Dn(r),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),r}const Ci=Symbol("mappings");class uw{constructor(e){this.db=e,this[Ci]={}}get mappings(){return this[Ci]}map(e){return L2(this[Ci],e)}bind(e,t,r={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof r.serializer!="undefined"){if(typeof r.serializer=="string")if(typeof t.prototype[r.serializer]=="function")r.serializer=t.prototype[r.serializer];else throw new TypeError(`${t.name}.prototype.${r.serializer} is not a function, cannot use it as serializer`);else if(typeof r.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof r.creator=="undefined")typeof t.create=="function"&&(r.creator=t.create);else if(typeof r.creator=="string")if(typeof t[r.creator]=="function")r.creator=t[r.creator];else throw new TypeError(`${t.name}.${r.creator} is not a function, cannot use it as creator`);else if(typeof r.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[Ci][e]={db:this.db,type:t,creator:r.creator,serializer:r.serializer,deserialize(i){let o;return this.creator?o=this.creator.call(this.type,i):o=new this.type(i),o},serialize(i,o){return this.serializer?i=this.serializer.call(i,o,i):i&&typeof i.serialize=="function"&&(i=i.serialize(o,i)),i}}}serialize(e,t){return By(this.db,this[Ci],e,t,"serialize")}deserialize(e,t){return By(this.db,this[Ci],e,t,"deserialize")}}const zs=()=>{};class hw{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):zs,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):zs,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):zs,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):zs,this.write=r=>{const i=typeof kn!="undefined"&&kn.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";r&&i?r.split(`
`).forEach(o=>console.log(o)):console.log(r)}}}const Ly={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},Dy={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},Uy={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},Ks={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var Ot;(function(n){n.reset="reset",n.bold="bold",n.dim="dim",n.italic="italic",n.underline="underline",n.inverse="inverse",n.hidden="hidden",n.strikethrough="strikethrough",n.black="black",n.red="red",n.green="green",n.yellow="yellow",n.blue="blue",n.magenta="magenta",n.cyan="cyan",n.grey="grey",n.bgBlack="bgBlack",n.bgRed="bgRed",n.bgGreen="bgGreen",n.bgYellow="bgYellow",n.bgBlue="bgBlue",n.bgMagenta="bgMagenta",n.bgCyan="bgCyan",n.bgWhite="bgWhite",n.bgGrey="bgGrey"})(Ot||(Ot={}));function dw(){if(typeof kn=="undefined"||!kn.stdout||!kn.env||!kn.platform||kn.platform==="browser")return!1;if(kn.platform==="win32")return!0;const n=kn.env;return n.COLORTERM?!0:n.TERM==="dumb"?!1:n.CI||n.TEAMCITY_VERSION?!!n.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(n.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(n.TERM))}let fw=dw();function U2(n){fw=dw()&&n}function q2(n,e){if(!fw)return n;const t=[],r=[],i=a=>{a===Ot.reset?t.push(Ks.all):a in Ly?(t.push(Ly[a]),r.push(Ks[a])):a in Dy?(t.push(Dy[a]),r.push(Ks.color)):a in Uy&&(t.push(Uy[a]),r.push(Ks.background))};e instanceof Array?e.forEach(i):i(e);const o=t.map(a=>"\x1B["+a+"m").join(""),s=r.map(a=>"\x1B["+a+"m").join("");return n.split(`
`).map(a=>o+a+s).join(`
`)}String.prototype.colorize=function(n){return q2(this,n)};class pw{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class V2 extends Ji{constructor(e,t={}){super(),this._ready=!1,t=new pw(t),this.name=e,this.debug=new hw(t.logLevel,`[${e}]`),U2(t.logColors);const r=[Ot.magenta,Ot.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,o=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(r)),o&&this.debug.write(o.colorize(Ot.magenta))),this.types=new uw(this),this.once("ready",()=>{this._ready=!0})}ready(e){return W(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){C2(e)}ref(e){return new Fn(this,e)}get root(){return this.ref("")}query(e){const t=new Fn(this,e);return new lw(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,r)=>this.api.createIndex(e,t,r),delete:e=>W(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,r=!1)=>this.api.setSchema(e,t,r),all:()=>this.api.getSchemas(),check:(e,t,r)=>this.api.validateSchema(e,t,r)}}}class ct extends Error{constructor(e){super(`${e} is not implemented`)}}class M2 extends Ji{constructor(){super()}stats(e){throw new ct("stats")}subscribe(e,t,r,i){throw new ct("subscribe")}unsubscribe(e,t,r){throw new ct("unsubscribe")}update(e,t,r){throw new ct("update")}set(e,t,r){throw new ct("set")}get(e,t){throw new ct("get")}transaction(e,t,r){throw new ct("transaction")}exists(e){throw new ct("exists")}query(e,t,r){throw new ct("query")}reflect(e,t,r){throw new ct("reflect")}export(e,t,r){throw new ct("export")}import(e,t,r){throw new ct("import")}createIndex(e,t,r){throw new ct("createIndex")}getIndexes(){throw new ct("getIndexes")}deleteIndex(e){throw new ct("deleteIndex")}setSchema(e,t,r){throw new ct("setSchema")}getSchema(e){throw new ct("getSchema")}getSchemas(){throw new ct("getSchemas")}validateSchema(e,t,r){throw new ct("validateSchema")}getMutations(e){throw new ct("getMutations")}getChanges(e){throw new ct("getChanges")}}function qy(n,e,t){const r=[0,0,0,0,0];for(let i=0;i<e;i+=4){let o=((n[i]*256+n[i+1])*256+n[i+2])*256+n[i+3];if(!o)t.push("z");else{for(let s=0;s<5;r[s++]=o%85+33,o=Math.floor(o/85));t.push(String.fromCharCode(r[4],r[3],r[2],r[1],r[0]))}}}function F2(n){const e=n,t=[],r=e.length%4,i=e.length-r;if(qy(e,i,t),r){const s=new Uint8Array(4);s.set(e.slice(i),0),qy(s,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,r+1))}let o=t.join("");return o="<~"+o+"~>",o}const dr={encode:function(n){return n instanceof ArrayBuffer&&(n=new Uint8Array(n,0,n.byteLength)),F2(n)},decode:function(n){if(!n.startsWith("<~")||!n.endsWith("~>"))throw new Error("Invalid input string");n=n.substr(2,n.length-4);const e=n.length,t=[],r=[0,0,0,0,0];let i,o,s,a;for(let l=0;l<e;++l){if(n.charAt(l)=="z"){t.push(0,0,0,0);continue}for(let u=0;u<5;++u)r[u]=n.charCodeAt(l+u)-33;if(a=e-l,a<5){for(let u=a;u<4;r[++u]=0);r[a]=85}i=(((r[0]*85+r[1])*85+r[2])*85+r[3])*85+r[4],o=i&255,i>>>=8,s=i&255,i>>>=8,t.push(i>>>8,i&255,s,o);for(let u=a;u<5;++u,t.pop());l+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},W2=n=>{if(n.map===null||typeof n.map=="undefined"){if(typeof n.val=="undefined")throw new Error("serialized value must have a val property");return n.val}const e=(t,r)=>t==="date"?new Date(r):t==="binary"?dr.decode(r):t==="reference"?new it(r):t==="regexp"?new RegExp(r.pattern,r.flags):t==="array"?new Ya(r):t==="bigint"?BigInt(r):r;return typeof n.map=="string"?e(n.map,n.val):(Object.keys(n.map).forEach(t=>{const r=n.map[t],i=Y.getPathKeys(t);let o=n,s="val",a=n.val;i.forEach(c=>{s=c,o=a,a=a[s]}),o[s]=e(r,a)}),n.val)},yw=n=>{var e;if(n===null||typeof n!="object"||n instanceof Date||n instanceof ArrayBuffer||n instanceof it||n instanceof RegExp){const o=yw({value:n});return{map:(e=o.map)==null?void 0:e.value,val:o.val.value}}n=Dn(n);const t=(o,s,a)=>{o instanceof Ya&&(s[a]="array"),Object.keys(o).forEach(c=>{const l=o[c],u=a.length===0?c:`${a}/${c}`;typeof l=="bigint"?(o[c]=l.toString(),s[u]="bigint"):l instanceof Date?(o[c]=l.toISOString(),s[u]="date"):l instanceof ArrayBuffer?(o[c]=dr.encode(l),s[u]="binary"):l instanceof it?(o[c]=l.path,s[u]="reference"):l instanceof RegExp?(o[c]={pattern:l.source,flags:l.flags},s[u]="regexp"):typeof l=="object"&&l!==null&&t(l,s,u)})},r={};t(n,r,"");const i={val:n};return Object.keys(r).length>0&&(i.map=r),i},Vy=n=>n>0?Date.now()+n*1e3:1/0;class z2{get size(){return this.cache.size}constructor(e){var t;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const r=setInterval(()=>{this.cleanUp()},60*1e3);(t=r.unref)==null||t.call(r)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=Vy(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?Dn(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let r=null;const i=Date.now();for(const[o,s]of this.cache.entries()){if(s.expires<=i){this.cache.delete(o),r=null;break}(!r||s.accessed<r.accessed)&&(r={key:o,accessed:s.accessed})}r!==null&&this.cache.delete(r.key)}this.cache.set(e,{value:this.options.cloneValues?Dn(t):t,added:Date.now(),accessed:Date.now(),expires:Vy(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,r)=>{t.expires<=e&&this.cache.delete(r)})}}function K2(n){let e=0;function t(){let a;for(;a=n[e],[" ","\r",`
`,"	"].includes(a);)e++}function r(a){if(n[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${n[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=n[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${n.slice(e,e+10)}..`);return n[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),r(":"),a}function o(){t();let a={typeOf:"any"},c,l="";for(;c=n[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)l+=c,e++;if(l.length===0)if(n[e]==="*")r("*"),a.typeOf="any";else if(["'",'"',"`"].includes(n[e])){a.typeOf="string",a.value="";const u=n[e];for(r(u);c=n[e],c&&c!==u;)a.value+=c,e++;r(u)}else if(n[e]>="0"&&n[e]<="9"){a.typeOf="number";let u="";for(;c=n[e],c==="."||c==="n"||c>="0"&&c<="9";)u+=c,e++;u.endsWith("n")?a.value=BigInt(u):u.includes(".")?a.value=parseFloat(u):a.value=parseInt(u)}else if(n[e]==="{"){for(r("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const u=i(),h=s();if(a.children.push({name:u.name,optional:u.optional,wildcard:u.wildcard,types:h}),t(),(n[e]===";"||n[e]===",")&&(r(n[e]),t()),n[e]==="}")break}r("}")}else if(n[e]==="/"){r("/");let u="",h="";for(;c=n[e],c!=="/"||u.endsWith("\\");)u+=c,e++;for(r("/");c=n[e],["g","i","m","s","u","y","d"].includes(c);)h+=c,e++;a.typeOf="string",a.matches=new RegExp(u,h)}else throw new Error(`Expected a type definition at position ${e}, found character '${n[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(l))a.typeOf=l.toLowerCase();else if(l==="Object"||l==="object")a.typeOf="object",a.instanceOf=Object;else if(l==="Date")a.typeOf="object",a.instanceOf=Date;else if(l==="Binary"||l==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(l==="any")a.typeOf="any";else if(l==="null")a.typeOf="object",a.value=null;else if(l==="Array")r("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=s(),r(">");else if(["true","false"].includes(l))a.typeOf="boolean",a.value=l==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();n[e]==="[";)r("["),r("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function s(){t();const a=[o()];for(;n[e]==="|";)r("|"),a.push(o()),t();return a}return o()}function H2(n,e,t,r){const i=e.find(h=>h.name==="*"||h.name[0]==="$")?[]:Object.keys(t).filter(h=>![null,void 0].includes(t[h])&&!e.find(y=>y.name===h));if(i.length>0)return{ok:!1,reason:`Object at path "${n}" cannot have propert${i.length===1?"y":"ies"} ${i.map(h=>`"${h}"`).join(", ")}`};function o(h){const y=![null,void 0].includes(t[h.name]);return!h.optional&&(r?t[h.name]===null:!y)?{ok:!1,reason:`Property at path "${n}/${h.name}" is not optional`}:y&&h.types.length===1?Qo(`${n}/${h.name}`,h.types[0],t[h.name],!1):y&&!h.types.some(d=>Qo(`${n}/${h.name}`,d,t[h.name],!1).ok)?{ok:!1,reason:`Property at path "${n}/${h.name}" does not match any of ${h.types.length} allowed types`}:{ok:!0}}const s=e.filter(h=>!h.wildcard),a=s.find(h=>!o(h).ok);if(a)return{ok:!1,reason:o(a).reason};const c=e.find(h=>h.wildcard);if(!c)return{ok:!0};const l=Object.keys(t).filter(h=>!s.find(y=>y.name===h));let u={ok:!0};for(let h=0;h<l.length&&u.ok;h++){const y=l[h];u=o({name:y,types:c.types,optional:!0,wildcard:!0})}return u}function Qo(n,e,t,r,i){const o={ok:!0};if(e.typeOf==="any")return o;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`};if(!e.children)return o;const s=i[0];let a=e.children.find(l=>l.name===s);if(a||(a=e.children.find(l=>l.name==="*"||l.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${n}" cannot have property "${s}"`};if(a.optional&&t===null&&i.length===1)return o;let c;return a.types.some(l=>{const u=typeof s=="number"?`${n}[${s}]`:`${n}/${s}`;return c=Qo(u,l,t,r,i.slice(1)),c.ok}),c}return t===null?o:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${n}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${n}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${n}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${n}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(s=>e.genericTypes.some(a=>Qo(n,a,s,!1).ok))?{ok:!1,reason:`every array value of path "${n}" must match one of the specified types`}:e.typeOf==="object"&&e.children?H2(n,e.children,t,r):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${n}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:o}function J2(n){switch(n){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${n.name}`)}}class Y2{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const r=i=>"{"+Object.keys(i).map(o=>{let s=i[o];if(s===void 0)s="undefined";else if(s instanceof RegExp)s=`/${s.source}/${s.flags}`;else if(typeof s=="object")s=r(s);else if(typeof s=="function")s=J2(s);else if(!["string","number","boolean","bigint"].includes(typeof s))throw new Error(`Type definition for key "${o}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${o}:${s}`}).join(",")+"}";this.text=r(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=K2(this.text)}check(e,t,r,i){const o=Qo(e,this.type,t,r,i);return!o.ok&&this.handling.warnOnly&&(o.warning=`${r?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${o.reason}`,o.ok=!0,this.handling.warnCallback(o.warning)),o}}class Qt{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class Hl extends Qt{}class dh extends Qt{}class My extends Qt{}class G2 extends Qt{}class Fy extends Qt{}class X2 extends Qt{}const Q2={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},ae=Q2;function Z2(n){switch(n){case ae.ARRAY:return"array";case ae.BINARY:return"binary";case ae.BOOLEAN:return"boolean";case ae.DATETIME:return"date";case ae.NUMBER:return"number";case ae.OBJECT:return"object";case ae.REFERENCE:return"reference";case ae.STRING:return"string";case ae.BIGINT:return"bigint"}}class gw{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=Y.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return Z2(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function Jt(n,e){if(!n)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const eB=120,Yt={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class mw{constructor(e,t=eB){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Lt.generate()}_allowLock(e,t,r){const i=this._locks.find(o=>o.tid!==t&&o.state===Yt.LOCKED&&(r||o.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(r){console.error("Unhandled promise rejection:",r)}}_processLockQueue(){if(this._quit){const e=new Error("Quitting");this._locks.filter(t=>t.state===Yt.PENDING).forEach(t=>this._rejectLock(t,e)),this._locks.length===0&&this._quit()}this._locks.filter(e=>e.state===Yt.PENDING).sort((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.requested-t.requested).forEach(e=>{const t=this._allowLock(e.path,e.tid,e.forWriting);e.waitingFor=t.conflict||null,t.allow&&this.lock(e).then(e.resolve).catch(r=>this._rejectLock(e,r))})}lock(e,t){return W(this,arguments,function*(r,i,o=!0,s="",a={withPriority:!1,noTimeout:!1}){let c,l;if(r instanceof Jl)c=r,l=!0;else{if(this._locks.findIndex(u=>u.tid===i&&u.state===Yt.EXPIRED)>=0)throw new Error(`lock on tid ${i} has expired, not allowed to continue`);if(this._quit&&!a.withPriority)throw new Error("Quitting");{c=new Jl(this,r,i,o,a.withPriority===!0),c.comment=s,this._locks.push(c);const u=this._allowLock(r,i,o);c.waitingFor=u.conflict||null,l=u.allow}}if(l){if(c.state=Yt.LOCKED,typeof c.granted!="number"&&(c.granted=Date.now(),a.noTimeout!==!0)){c.expires=Date.now()+this.timeout;let u=0;const h=()=>{if(c.state===Yt.LOCKED){if(u++,u<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${u}]`),c.timeout=setTimeout(h,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=Yt.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(h,this.timeout/4)}return c}else return Jt(c.state===Yt.PENDING),new Promise((u,h)=>{c.resolve=u,c.reject=h})})}unlock(e,t,r=!0){let i,o;if(e instanceof Jl)i=e,o=this._locks.indexOf(i);else{const s=e;o=this._locks.findIndex(a=>a.id===s),i=this._locks[o]}if(o<0){const s=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(s)}return i.state=Yt.DONE,clearTimeout(i.timeout),this._locks.splice(o,1),r&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,r){return this._allowLock(e,t,r).allow}}let tB=0;class Jl{static get LOCK_STATE(){return Yt}constructor(e,t,r,i,o=!1){this.locker=e,this.path=t,this.tid=r,this.forWriting=i,this.priority=o,this.state=Yt.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++tB,this.history=[]}release(e){return W(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return W(this,null,function*(){const e=Y.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const t=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return t.history=this.history,t.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),t}})}}class nf extends Error{}class fh extends Error{}class nB extends Error{constructor(e){super(`Exiting: ${e}`)}}class rB extends Ji{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,r=e.name){super(),this.storage=e,this.id=t,this.dbname=r,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new mw(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(a=>a.callback===i.callback))return;const o=this.ourSubscriptions.some(a=>a.event===i.event&&a.path===i.path);if(this.ourSubscriptions.push(i),o)return;const s={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(s)}),e.on("unsubscribe",i=>{const o=this.remoteSubscriptions.find(s=>s.callback===i.callback);if(o){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(o),1);return}this.ourSubscriptions.filter(s=>s.path===i.path&&(!i.event||s.event===i.event)&&(!i.callback||s.callback===i.callback)).forEach(s=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(s),1);const a={type:"unsubscribe",from:this.id,data:{path:s.path,event:s.event}};this.sendMessage(a)})})}exit(e=0){return W(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(!this._exiting&&(this.peers.find(r=>r.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t)){const r={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(r),this.ourSubscriptions.forEach(i=>{const o={type:"subscribe",from:this.id,to:e,data:{path:i.path,event:i.event}};this.sendMessage(o)})}}removePeer(e,t=!1){if(this._exiting)return;const r=this.peers.find(i=>i.id===e);if(!r){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(r),1),this.remoteSubscriptions.filter(i=>i.for===e).forEach(i=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(i),1),this.storage.subscriptions.remove(i.path,i.event,i.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const r=(i,o,s,a,c)=>{const l={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:o,val:s,previous:a,context:c}};this.sendMessage(l)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:r}),this.storage.subscriptions.add(t.path,t.event,r)}cancelRemoteSubscription(e,t){const r=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!r||this.storage.subscriptions.remove(t.path,t.event,r.callback)}handleMessage(e){return W(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,r=t.data.context||{};r.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(i=>i.event===t.event&&i.path===t.path).forEach(i=>{i.callback(null,t.data.path,t.data.val,t.data.previous,r)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,r={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(i=>{var o;return((o=i.lock)==null?void 0:o.id)===t.data.id}).lock.release()}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("The request must be known to us!");t.ok?r.resolve(t.data):r.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,r={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const o=this._locks.find(s=>{var a;return((a=s.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield o.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);o.lock=i,r.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){r.ok=!1,r.reason=i.stack||i.message||i}return this.sendMessage(r)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,r=this._requests.get(t.id);if(typeof r!="object")throw new Error("Result of unknown request received");t.ok?r.resolve(t.data):r.reject(new Error(t.reason))}}})}lock(e){return W(this,null,function*(){if(this._exiting&&!this._locks.find(r=>r.tid===e.tid&&r.granted))throw new nB("new transaction lock denied because the IPC peer is exiting");const t=r=>{this._locks.splice(this._locks.indexOf(r),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);r.tid=i.tid,r.granted=!0;const o=s=>({get id(){return s.id},get tid(){return s.tid},get path(){return s.path},get forWriting(){return s.forWriting},get expires(){return s.expires},get comment(){return s.comment},get state(){return s.state},release:()=>W(this,null,function*(){yield s.release(),t(r)}),moveToParent:()=>W(this,null,function*(){const a=yield s.moveToParent();return r.lock=o(a),r.lock})});return r.lock=o(i),r.lock}else{const r={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(r);const i=c=>(r.granted=!0,r.tid=c.tid,r.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:Yt.LOCKED,expires:c.expires,comment:c.comment,release:()=>W(this,null,function*(){const l={type:"unlock-request",id:Lt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id}};yield this.request(l),r.lock.state=Yt.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${r.lock.id} (tid ${r.lock.tid}, ${r.lock.comment}, "/${r.lock.path}", ${r.lock.forWriting?"write":"read"})`),t(r)}),moveToParent:()=>W(this,null,function*(){const l={type:"move-lock-request",id:Lt.generate(),from:this.id,to:this.masterPeerId,data:{id:r.lock.id,move_to:"parent"}};let u;try{u=yield this.request(l)}catch(h){throw r.lock.state=Yt.DONE,t(r),h}return r.lock=i(u),r.lock})},r.lock),o={type:"lock-request",id:Lt.generate(),from:this.id,to:this.masterPeerId,data:e};let s,a;try{s=yield this.request(o)}catch(c){a=c,s=null}if(a)throw t(r),a;return i(s)}})}request(e){return W(this,null,function*(){let t,r;const i=new Promise((o,s)=>{t=a=>{this._requests.delete(e.id),o(a)},r=a=>{this._requests.delete(e.id),s(a)}});return this._requests.set(e.id,{resolve:t,reject:r,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Lt.generate(),data:e};return this.request(t).catch(r=>{throw this.storage.debug.error(r),r})}replyRequest(e,t){const r={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(r)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class iB extends rB{constructor(e){if(super(e,Lt.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const r=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:o=>{const s=Lt.generate(),a=`acebase:${e.name}:${this.id}:${s}`,c=JSON.stringify(yw(o));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(o){r[0]=o},set onmessageerror(o){i()},close(){i()},addEventListener(o,s){o!=="message"&&i(),r.push(s)},removeEventListener(o,s){const a=r.indexOf(s);a>=1&&r.splice(a,1)},dispatchEvent(o){return r.forEach(s=>{try{s&&s(o)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",o=>{const[s,a,c,l]=o.key.split(":");if(s!=="acebase"||a!==e.name||c===this.id||o.newValue===null)return;const u=W2(JSON.parse(o.newValue));this.channel.dispatchEvent({data:u})})}this.channel.addEventListener("message",r=>W(this,null,function*(){const i=r.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const o=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=o.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const s=this._locks.splice(0);yield Promise.all(s.filter(a=>a.granted).map(a=>W(this,null,function*(){let c,l;a.lock.release=()=>new Promise(h=>c=h),a.lock.moveToParent=()=>new Promise(h=>l=h);const u=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(l){const h=yield u.moveToParent();l(h)}c&&(yield u.release(),c())}))),yield Promise.all(s.filter(a=>!a.granted).map(a=>W(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class jo{static get hasFileSystem(){return!1}static get fs(){return null}}class rf extends Qt{}class vw extends Qt{}class oB extends Qt{}class sB extends Qt{}function aB(n,e,t,r){return W(this,null,function*(){if(!n.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:o,indexes:s,storage:a}=n,c=r&&r.rebuild===!0,l=r&&r.type||"normal";let u=r&&r.include||[];typeof u=="string"&&(u=[u]);const h=s.find(d=>d.path===e&&d.key===t&&d.type===l&&d.includeKeys.length===u.length&&d.includeKeys.every((f,p)=>u[p]===f));if(h&&r.config&&(h.config=r.config),h&&c!==!0)return o.log(`Index on "/${e}/*/${t}" already exists`.colorize(Ot.inverse)),h;if(!i.isMaster){const d=yield i.sendRequest({type:"index.create",path:e,key:t,options:r});if(d.ok)return a.indexes.add(d.fileName);throw new Error(d.reason)}yield jo.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(d=>{if(d.code!=="EEXIST")throw d});const y=h||(()=>{const{include:d,caseSensitive:f,textLocale:p,textLocaleKey:v}=r,w={include:d,caseSensitive:f,textLocale:p,textLocaleKey:v};switch(l){case"array":return new sB(a,e,t,te({},w));case"fulltext":return new vw(a,e,t,Ge(te({},w),{config:r.config}));case"geo":return new oB(a,e,t,te({},w));default:return new rf(a,e,t,te({},w))}})();h||s.push(y);try{yield y.build()}catch(d){throw n.debug.error(`Index build on "/${e}/*/${t}" failed: ${d.message} (code: ${d.code})`.colorize(Ot.red)),h||s.splice(s.indexOf(y),1),d}return i.sendNotification({type:"index.created",fileName:y.fileName,path:e,key:t,options:r}),y})}const{compareValues:Hs,getChildValues:ni,encodeString:Wy,defer:cB}=ow,ph=["value","child_added","child_changed","child_removed","mutated","mutations"];ph.push(...ph.map(n=>`notify_${n}`));const lB=()=>{};class uB extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class of{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class hB extends Ji{createTid(){return Lt.generate()}constructor(e,t,r){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return jo==null?void 0:jo.hasFileSystem},create:(o,s,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return aB(c,o,s,a)},get:(o,s=null)=>{if(o.includes("$")){const a=Y.getPathKeys(o).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);o=new Y(a).path}return this._indexes.filter(a=>a.path===o&&(s===null||s===a.key))},getAll:(o,s={parentPaths:!0,childPaths:!0})=>{const a=Y.getPathKeys(o);return this._indexes.filter(c=>{const l=Y.getPathKeys(c.path+"/*");return s.parentPaths&&l.every((u,h)=>u==="*"||a[h]===u)&&[c.key].concat(...c.includeKeys).includes(a[l.length])?!0:l.length<a.length||!s.childPaths&&l.length!==a.length?!1:a.every((u,h)=>[u,"*"].includes(l[h]))})},list:()=>this._indexes.slice(),load:()=>W(this,null,function*(){if(this._indexes.splice(0),!jo.hasFileSystem)return;let o=[];try{o=yield jo.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const s=[];o.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",l=/^\[[a-z]+\]-/.test(a);if(!c&&!l||c&&a.startsWith(`[${this.settings.type}]-`)){const u=this.indexes.add(a);s.push(u)}}),yield Promise.all(s)}),add:o=>W(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(s)return s;if(this._annoucedIndexes.has(o))return yield this._annoucedIndexes.get(o);try{const a=rf.readFromFile(this,o);this._annoucedIndexes.set(o,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(o),c}catch(a){return this.debug.error(a),null}}),delete:o=>W(this,null,function*(){const s=yield this.indexes.remove(o);yield s.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:s.fileName,path:s.path,keys:s.key})}),remove:o=>W(this,null,function*(){const s=this._indexes.find(a=>a.fileName===o);if(!s)throw new Error(`Index ${o} not found`);return this._indexes.splice(this._indexes.indexOf(s),1),s}),close:()=>W(this,null,function*(){const o=this.indexes.list().map(s=>s.close().catch(a=>this.debug.error(a)));yield Promise.all(o)})},this._eventSubscriptions={},this.subscriptions={add:(o,s,a)=>{if(ph.indexOf(s)<0)throw new TypeError(`Invalid event type "${s}"`);let c=this._eventSubscriptions[o];c||(c=this._eventSubscriptions[o]=[]),c.push({created:Date.now(),type:s,callback:a}),this.emit("subscribe",{path:o,event:s,callback:a})},remove:(o,s,a)=>{const c=this._eventSubscriptions[o];if(!c)return;const l=()=>c.findIndex(h=>(s?h.type===s:!0)&&(a?h.callback===a:!0));let u;for(;(u=l())>=0;)c.splice(u,1);this.emit("unsubscribe",{path:o,event:s,callback:a})},hasValueSubscribersForPath(o){return!!this.getValueSubscribersForPath(o)},getValueSubscribersForPath:o=>{const s=new Y(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.equals(c)||s.isDescendantOf(c)){const l=this._eventSubscriptions[c],u=Y.fillVariables(c,o);l.filter(h=>!h.type.startsWith("notify_")).forEach(h=>{let y=null;if(h.type==="value")y=u;else if(["mutated","mutations"].includes(h.type)&&s.isDescendantOf(u))y=o;else if(h.type==="child_changed"&&o!==u){const d=Y.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=Y.getChildPath(u,d)}else if(["child_added","child_removed"].includes(h.type)&&s.isChildOf(u)){const d=Y.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=Y.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},getAllSubscribersForPath:o=>{const s=Y.get(o),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(s.isOnTrailOf(c)){const l=this._eventSubscriptions[c],u=Y.fillVariables(c,o);l.forEach(h=>{let y=null;if(h.type==="value"||h.type==="notify_value")y=u;else if(["child_changed","notify_child_changed"].includes(h.type)){const d=o===u||s.isAncestorOf(u)?"*":Y.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=Y.getChildPath(u,d)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(h.type))y=o;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(h.type)&&(s.isChildOf(u)||o===u||s.isAncestorOf(u))){const d=o===u||s.isAncestorOf(u)?"*":Y.getPathKeys(o.slice(u.length).replace(/^\//,""))[0];y=Y.getChildPath(u,d)}y!==null&&!a.some(d=>d.type===h.type&&d.eventPath===u&&d.subscriptionPath===c)&&a.push({type:h.type,eventPath:u,dataPath:y,subscriptionPath:c})})}}),a},trigger:(o,s,a,c,l,u)=>{(this._eventSubscriptions[s]||[]).filter(h=>h.type===o).forEach(h=>{h.callback(null,a,l,c,u)})}},this.debug=new hw(r.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof Qt){const o={ipcName:i,server:t.ipc instanceof Qt?t.ipc:null};this.ipc=new Qt(this,o)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const o=Object.assign({dbname:i},t.ipc);this.ipc=new Qt(this,o)}else this.ipc=new iB(this,i);this.ipc.once("exit",o=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(o,s,a,c)=>this.ipc.lock({path:o,tid:s,write:a,comment:c})},this._lastTid=0}close(){return W(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:Wy(e).length<this.settings.maxInlineValueSize;if(e instanceof it)return e.path.length>this.settings.maxInlineValueSize?!1:Wy(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,r){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let r=e,i=!1;const o=t?[]:this.subscriptions.getAllSubscribersForPath(e),s=t?[]:this.subscriptions.getValueSubscribersForPath(e);s.length>0&&(i=!0,r=s.map(l=>({path:l.dataPath,keys:Y.getPathKeys(l.dataPath)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0)[0].path,s.filter(l=>l.dataPath===r).every(l=>l.type==="mutated"||l.type.startsWith("notify_"))&&(i=!1),r=Y.fillVariables(r,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(l=>({index:l,keys:Y.getPathKeys(l.path)})).sort((l,u)=>l.keys.length<u.keys.length?-1:l.keys.length>u.keys.length?1:0).map(l=>l.index),c=[];if(a.length>0){a.sort((h,y)=>(typeof h._pathKeys=="undefined"&&(h._pathKeys=Y.getPathKeys(h.path)),typeof y._pathKeys=="undefined"&&(y._pathKeys=Y.getPathKeys(y.path)),h._pathKeys.length<y._pathKeys.length?-1:h._pathKeys.length>y._pathKeys.length?1:0));const l=a[0],u=l.path===e?e:Y.fillVariables(`${l.path}/*`,e);u.length<r.length&&(r=u,a.filter(h=>h.path===l.path).forEach(h=>{[h.key].concat(h.includeKeys).forEach(y=>!c.includes(y)&&c.push(y))}))}return{topEventPath:r,eventSubscriptions:o,valueSubscribers:s,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(e,t){return W(this,arguments,function*(r,i,o={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(o=o||{},!o.tid&&!o.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");o.merge=o.merge===!0;const s=this.validateSchema(r,i,{updates:o.merge});if(!s.ok)throw new uB(s.reason);const a=o.tid,c=o.transaction;let l=null;const u=o.impact?o.impact:this.getUpdateImpact(r,o.suppress_events),{topEventPath:h,eventSubscriptions:y,hasValueSubscribers:d,indexes:f}=u;let{keysFilter:p}=u;const v=()=>{if(typeof o._customWriteFunction=="function")return o._customWriteFunction();if(l){const E=Y.getPathKeys(r),g=Y.getPathKeys(h),b=E.slice(g.length);let m=l;for(;b.length>0&&m!==null;){const x=b.shift();m=typeof m=="object"&&x in m?m[x]:null}o.currentValue=m}return this._writeNode(r,i,o)},w=this.settings.transactions&&this.settings.transactions.log===!0;if(y.length===0&&f.length===0&&!w)return v();if(!d&&o.merge===!0&&p.length===0&&(p=Object.keys(i),h!==r)){const E=r.slice(h.length);p=p.map(g=>`${E}/${g}`)}const S=yield this.getNodeInfo(h,{transaction:c,tid:a});let R=null;if(S.exists){const E={transaction:c,tid:a};p.length>0&&(E.include=p),h===""&&typeof E.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),R=(yield this.getNode(h,E)).value}l=R;const j=(yield v())||{};let N,D;if(r===h)o.merge?l===null?N=i instanceof Array?[]:{}:(N=l instanceof Array?[]:{},Object.keys(l).forEach(E=>{N[E]=l[E]})):N=i,D=N;else{const E=r.slice(h.length).replace(/^\//,""),g=Y.getPathKeys(E);for(l===null?N=typeof g[0]=="number"?[]:{}:(N=l instanceof Array?[]:{},Object.keys(l).forEach(b=>{N[b]=l[b]})),D=N;g.length>0;){const b=g.shift();if(!o.merge&&g.length===0)D[b]=i;else{const m=D[b],x=typeof b=="number"?[...m]:te({},m);D[b]=x}D=D[b]}}o.merge&&Object.keys(i).forEach(E=>{D[E]=i[E]});const q=Hs(l,N);if(q==="identical")return j.mutations=[],j;function P(E){if(E===null||typeof E!="object")return E;Object.keys(E).forEach(g=>{const b=E[g];b===null&&(delete E[g],E instanceof Array&&E.length--),typeof b=="object"&&P(b)})}P(N);const I=[];f.map(E=>({index:E,keys:Y.getPathKeys(E.path)})).sort((E,g)=>E.keys.length<g.keys.length?1:E.keys.length>g.keys.length?-1:0).forEach(({index:E})=>{const g=Y.getPathKeys(h),b=Y.getPathKeys(E.path+"/*"),m=b.slice(g.length),x=l,O=N;if(m.length===0){Jt(g.length===b.length,"check logic");const $=this.ipc.isMaster?E.handleRecordUpdate(h,x,O):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:h,oldValue:x,newValue:O});I.push($);return}const k=($,_,A)=>{if(_===null&&A===null)return[];const T=Y.getPathKeys($),C=Y.getPathKeys(E.path+"/*"),L=C.slice(T.length);if(L.length===0)return Jt(T.length===C.length,"check logic"),[{path:$,oldValue:_,newValue:A}];let V=[],K="";for(;L.length>0;){const G=L.shift();if(typeof G=="string"&&(G==="*"||G.startsWith("$"))){const ie=_===null?[]:Object.keys(_);A!==null&&Object.keys(A).forEach(ee=>{ie.indexOf(ee)<0&&ie.push(ee)}),ie.forEach(ee=>{const fe=Y.getChildPath(K,ee),de=ni(ee,_,A),ne=Y.getChildPath($,fe),ce=k(ne,de.oldValue,de.newValue);V=V.concat(ce)});break}else{const ie=ni(G,_,A);if(_=ie.oldValue,A=ie.newValue,_===null&&A===null)break;K=Y.getChildPath(K,G)}}return V};k(h,x,O).forEach($=>{const _=this.ipc.isMaster?E.handleRecordUpdate($.path,$.oldValue,$.newValue):this.ipc.sendRequest({type:"index.update",fileName:E.fileName,path:$.path,oldValue:$.oldValue,newValue:$.newValue});I.push(_)})});const B=(E,g,b,m=[])=>{let x=!0,O=E.type;if(O.startsWith("notify_")&&(O=O.slice(7)),O==="mutated"||(O==="child_changed"&&(g===null||b===null)?x=!1:O==="value"||O==="child_changed"?x=Hs(g,b)!=="identical":O==="child_added"?x=g===null&&b!==null:O==="child_removed"&&(x=g!==null&&b===null),!x))return;const k=Y.getPathKeys(E.dataPath);m.forEach(_=>{const A=k.indexOf(_.name);Jt(A>=0,`Variable "${_.name}" not found in subscription dataPath "${E.dataPath}"`),k[A]=_.value});const $=k.reduce((_,A)=>Y.getChildPath(_,A),"");this.subscriptions.trigger(E.type,E.subscriptionPath,$,g,b,o.context)},U=(E,g,b,m)=>{const x=[],O=m||Hs(g,b);return O==="identical"||(typeof O=="string"?x.push({path:E,oldValue:g,newValue:b}):(O.changed.forEach(k=>{const $=Y.getChildPath(E,k.key),_=ni(k.key,g,b),A=U($,_.oldValue,_.newValue,k.change);x.push(...A)}),O.added.forEach(k=>{const $=Y.getChildPath(E,k);x.push({path:$,oldValue:null,newValue:b[k]})}),g instanceof Array&&b instanceof Array&&O.removed.sort((k,$)=>k<$?1:-1),O.removed.forEach(k=>{const $=Y.getChildPath(E,k);x.push({path:$,oldValue:g[k],newValue:null})}))),x};w&&this.settings.type!=="transaction"&&(j.mutations=(()=>{const E=r.slice(h.length).replace(/^\//,""),g=Y.getPathKeys(E);let b=l,m=N;for(;g.length>0;){const O=g.shift();({oldValue:b,newValue:m}=ni(O,b,m))}const x=Hs(b,m);return U(r,b,m,x).map(O=>({target:Y.getPathKeys(O.path.slice(r.length)),prev:O.oldValue,val:O.newValue}))})());const M=()=>{y.filter(E=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(E.type)).map(E=>{const g=Y.getPathKeys(E.dataPath);return{sub:E,keys:g}}).sort((E,g)=>E.keys.length<g.keys.length?1:E.keys.length>g.keys.length?-1:0).forEach(({sub:E})=>{const g=(b,m,x,O=[])=>{const k=E.dataPath.slice(b.length).replace(/^\//,""),$=Y.getPathKeys(k);for(;$.length>0;){const _=$.shift();if(typeof _=="string"&&(_==="*"||_[0]==="$")){const A=m===null?[]:Object.keys(m).map(T=>m instanceof Array?parseInt(T):T);x!==null&&Object.keys(x).forEach(T=>{const C=x instanceof Array?parseInt(T):T;!A.includes(C)&&A.push(T)}),A.forEach(T=>{const C=ni(T,m,x),L=O.concat({name:_,value:T});$.length===0?B(E,C.oldValue,C.newValue,L):g(Y.getChildPath(b,_),C.oldValue,C.newValue,L)});return}else{b=Y.getChildPath(b,_);const A=ni(_,m,x);m=A.oldValue,x=A.newValue}}B(E,m,x,O)};if(E.type.startsWith("notify_")&&Y.get(E.eventPath).isAncestorOf(h)){const b=Y.get(E.eventPath).isParentOf(h);(E.type==="notify_value"||E.type==="notify_child_changed"&&(!b||!["added","removed"].includes(q))||E.type==="notify_child_removed"&&q==="removed"&&b||E.type==="notify_child_added"&&q==="added"&&b)&&this.subscriptions.trigger(E.type,E.subscriptionPath,E.dataPath,null,null,o.context)}else g(h,l,N)}),y.filter(E=>["mutated","mutations","notify_mutated","notify_mutations"].includes(E.type)).forEach(E=>{let g=h;const b=E.eventPath.slice(g.length).replace(/^\//,""),m=Y.getPathKeys(b);let x=l,O=N;for(;m.length>0;){const _=m.shift();g=Y.getChildPath(g,_);const A=ni(_,x,O);x=A.oldValue,O=A.newValue}const k=U(g,x,O);if(k.length===0)return;const $=E.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(E.type))k.forEach((_,A)=>{const T=o.context,C=$?null:_.oldValue,L=$?null:_.newValue;this.subscriptions.trigger(E.type,E.subscriptionPath,_.path,C,L,T)});else if(["mutations","notify_mutations"].includes(E.type)){const _=$?null:k.map(A=>({target:Y.getPathKeys(A.path.slice(E.subscriptionPath.length)),prev:A.oldValue,val:A.newValue}));this.subscriptions.trigger(E.type,E.subscriptionPath,E.subscriptionPath,null,_,o.context)}})};return o.waitForIndexUpdates===!1&&I.splice(0),yield Promise.all(I),cB(M),j})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(e){return W(this,arguments,function*(t,r={}){return(yield this.getNode(t,r)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,r){throw new Error("This method must be implemented by subclass")}updateNode(e,t,r){throw new Error("This method must be implemented by subclass")}transactNode(e,t){return W(this,arguments,function*(r,i,o={no_lock:!1,suppress_events:!1,context:null}){const s=o&&o.no_lock===!0,a=this.createTid(),c=s?{tid:a,release:lB}:yield this.nodeLocker.lock(r,a,!0,"transactNode");try{let l=!1;const u=()=>{l=!0};s&&this.subscriptions.add(r,"notify_value",u);const h=yield this.getNode(r,{tid:a}),y=h.revision;let d;try{d=i(h.value),d instanceof Promise&&(d=yield d.catch(f=>{this.debug.error(`Error in transaction callback: ${f.message}`)}))}catch(f){this.debug.error(`Error in transaction callback: ${f.message}`)}if(typeof d=="undefined")return;if(s&&this.subscriptions.remove(r,"notify_value",u),l)throw new fh("Node changed");return yield this.setNode(r,d,{assert_revision:y,tid:c.tid,suppress_events:o.suppress_events,context:o.context})}catch(l){if(l instanceof fh)return console.warn(`node value changed, running again. Error: ${l.message}`),this.transactNode(r,i,o);throw l}finally{c.release()}})}matchNode(e,t,r){return W(this,null,function*(){var i;const o=(i=r==null?void 0:r.tid)!=null?i:Lt.generate(),s=(c,l)=>W(this,null,function*(){if(l.length===0)return Promise.resolve(!0);const u=l.reduce((f,p)=>{let v=p.key;return typeof v=="string"&&v.includes("/")&&(v=v.slice(0,v.indexOf("/"))),f.indexOf(v)<0&&f.push(v),f},[]),h=u.slice();let y=!0;const d=[];try{return yield this.getChildren(c,{tid:o,keyFilter:u}).next(f=>{var p;const v=(p=f.key)!=null?p:f.index;h.includes(v)&&h.splice(h.indexOf(f.key),1);const w=l.filter(R=>R.key===v).map(R=>({op:R.op,compare:R.compare})),S=w.length>0?a(f,w):{isMatch:!0,promises:[]};if(y=S.isMatch,y){d.push(...S.promises);const R=l.filter(j=>typeof j.key=="string"&&j.key.startsWith(`${typeof v=="number"?`[${v}]`:v}/`)).map(j=>({key:j.key.slice(j.key.indexOf("/")+1),op:j.op,compare:j.compare}));if(R.length>0){const j=Y.getChildPath(c,f.key),N=s(j,R).then(D=>({isMatch:D}));d.push(N)}}if(!y||h.length===0)return!1}),y&&(y=(yield Promise.all(d)).every(f=>f.isMatch)),y?(y=h.every(f=>{const p=new gw(Ge(te(te({},typeof f=="number"&&{index:f}),typeof f=="string"&&{key:f}),{exists:!1})),v=l.filter(S=>typeof S.key=="string"&&S.key.startsWith(`${typeof f=="number"?`[${f}]`:f}/`)).map(S=>({op:S.op,compare:S.compare}));if(v.length>0&&!a(p,v).isMatch)return!1;const w=l.filter(S=>S.key===f).map(S=>({op:S.op,compare:S.compare}));return w.length===0?!0:a(p,w).isMatch}),y):!1}catch(f){throw this.debug.error(`Error matching on "${c}": `,f),f}}),a=(c,l)=>{const u=[];return{isMatch:l.every(h=>{let y=!0;if(h.op==="!exists"||h.op==="=="&&(typeof h.compare=="undefined"||h.compare===null))y=!c.exists;else if(h.op==="exists"||h.op==="!="&&(typeof h.compare=="undefined"||h.compare===null))y=c.exists;else if((h.op==="contains"||h.op==="!contains")&&h.compare instanceof Array&&h.compare.length===0)y=!0;else if(!c.exists)y=!1;else if(c.address)if(c.valueType===ae.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.op==="has"?"exists":"!exists",f=s(c.path,[{key:h.compare,op:d}]).then(p=>({key:c.key,isMatch:p}));u.push(f),y=!0}else if(c.valueType===ae.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=this.getNode(c.path,{tid:o}).then(({value:f})=>{const p=h.op==="contains"?h.compare instanceof Array?h.compare.every(v=>f.includes(v)):f.includes(h.compare):h.compare instanceof Array?!h.compare.some(v=>f.includes(v)):!f.includes(h.compare);return{key:c.key,isMatch:p}});u.push(d),y=!0}else if(c.valueType===ae.STRING){const d=this.getNode(c.path,{tid:o}).then(f=>({key:c.key,isMatch:this.test(f.value,h.op,h.compare)}));u.push(d),y=!0}else y=!1;else if(c.type===ae.OBJECT&&["has","!has"].indexOf(h.op)>=0){const d=h.compare in c.value;y=d&&h.op==="has"||!d&&h.op==="!has"}else if(c.type===ae.ARRAY&&["contains","!contains"].indexOf(h.op)>=0){const d=c.value.indexOf(h.compare)>=0;y=d&&h.op==="contains"||!d&&h.op==="!contains"}else{let d=this.test(c.value,h.op,h.compare);d instanceof Promise&&(u.push(d),d=!0),y=d}return y}),promises:u}};return s(e,t)})}test(e,t,r){if(t==="<")return e<r;if(t==="<=")return e<=r;if(t==="==")return e===r;if(t==="!=")return e!==r;if(t===">")return e>r;if(t===">=")return e>=r;if(t==="in")return r.indexOf(e)>=0;if(t==="!in")return r.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+r.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",o=new RegExp(i,"i").test(e.toString());return t==="like"?o:!o}if(t==="matches")return r.test(e.toString());if(t==="!matches")return!r.test(e.toString());if(t==="between")return e>=r[0]&&e<=r[1];if(t==="!between")return e<r[0]||e>r[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&r in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(r);return t==="contains"?i:!i}return!1}exportNode(e,t){return W(this,arguments,function*(r,i,o={format:"json",type_safe:!0}){if((o==null?void 0:o.format)!=="json")throw new Error("Only json output is currently supported");const s=typeof i!="function"?i.write.bind(i):i,a=(f,p)=>{const v=w=>w.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,S=>`\\u${S.charCodeAt(0).toString(16).padStart(4,"0")}`);return f===ae.DATETIME?(p=`"${p.toISOString()}"`,o.type_safe&&(p=`{".type":"date",".val":${p}}`)):f===ae.STRING?p=`"${v(p)}"`:f===ae.ARRAY?p="[]":f===ae.OBJECT?p="{}":f===ae.BINARY?(p=`"${v(dr.encode(p))}"`,o.type_safe&&(p=`{".type":"binary",".val":${p}}`)):f===ae.REFERENCE?(p=`"${p.path}"`,o.type_safe&&(p=`{".type":"reference",".val":${p}}`)):f===ae.BIGINT&&(p=`"${p}"`,o.type_safe&&(p=`{".type":"bigint",".val":${p}}`)),p};let c="",l="";const u=yield this.getNodeInfo(r);if(u.exists)if(u.type===ae.OBJECT)c="{",l="}";else if(u.type===ae.ARRAY)c="[",l="]";else{const f=yield this.getNode(r),p=a(u.type,f.value);return s(p)}else return s("null");if(c){const f=s(c);f instanceof Promise&&(yield f)}let h="",y=0;const d=[];if(yield this.getChildren(r).next(f=>{f.address?d.push(f):(y++>0&&(h+=","),typeof f.key=="string"&&(h+=`"${f.key}":`),h+=a(f.type,f.value))}),h){const f=s(h);f instanceof Promise&&(yield f)}for(;d.length>0;){const f=d.shift();let p=y++>0?",":"";const v=typeof f.index=="number"?f.index:f.key;if(typeof v=="string"&&(p+=`"${v}":`),p){const w=s(p);w instanceof Promise&&(yield w)}yield this.exportNode(Y.getChildPath(r,v),s,o)}if(l){const f=s(l);f instanceof Promise&&(yield f)}})}importNode(e,t){return W(this,arguments,function*(r,i,o={format:"json",method:"set"}){const s={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},a=(P=!1)=>W(this,null,function*(){let I=yield i(262144);if(I===null)throw s.data?new Error(`Unexpected EOF at index ${s.offset+s.data.length}`):new Error("Unable to read data from stream");typeof I=="object"&&(I=tw(I)),P?s.data+=I:(s.offset+=s.data.length,s.data=I,s.index=0)}),c=P=>W(this,null,function*(){let I="";return s.index+P>=s.data.length&&(I=s.data.slice(s.index),P-=I.length,yield a()),I+=s.data.slice(s.index,s.index+P),s.index+=P,I}),l=P=>W(this,null,function*(){if(s.index+P>s.data.length&&(yield a(!0)),s.index+P>s.data.length)throw new Error("Not enough data available from stream")}),u=P=>W(this,null,function*(){const I=yield c(P.length);if(I!==P)throw new Error(`Unexpected character "${I[0]}" at index ${s.offset+s.index}, expected "${P}"`)}),h=()=>W(this,null,function*(){const P=[" ","	","\r",`
`];for(;s.index>=s.data.length&&(yield a()),P.includes(s.data[s.index]);)s.index++}),y=P=>W(this,null,function*(){yield l(P);const I=s.index;return s.data.slice(I,I+P)}),d=()=>W(this,null,function*(){yield h();const P=yield y(1);switch(P){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(P==="-"||P>="0"&&P<="9")return"number";throw new Error(`Unknown value at index ${s.offset+s.index}`)}}}),f=()=>W(this,null,function*(){yield u('"');let P="",I=s.index;for(;s.data[I]!=='"'||s.data[I-1]==="\\";)I++,I>=s.data.length&&(P+=s.data.slice(s.index),yield a(),I=0);return P+=s.data.slice(s.index,I),s.index=I+1,S(P)}),p=()=>W(this,null,function*(){throw s.data[s.index]==="t"?yield u("true"):s.data[s.index]==="f"&&(yield u("false")),new Error(`Expected true or false at index ${s.offset+s.index}`)}),v=()=>W(this,null,function*(){let P="",I=s.index;const B=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;B.includes(s.data[I]);)I++,I>=s.data.length&&(P+=s.data.slice(s.index),yield a(),I=0);return P+=s.data.slice(s.index,I),s.index=I,P.endsWith("n")?BigInt(P.slice(0,-1)):P.includes(".")?parseFloat(P):parseInt(P)}),w=()=>W(this,null,function*(){yield h();const P=yield d(),I=yield(()=>{switch(P){case"string":return f();case"object":return{};case"array":return[];case"number":return v();case"null":return null;case"undefined":return;case"boolean":return p()}})();return{type:P,value:I}}),S=P=>P.replace(/\\n/g,`
`).replace(/\\"/g,'"'),R=(P,I)=>{const B=I[".type"];let U=I[".val"];switch(B){case"Date":case"date":{U=new Date(U);break}case"Buffer":case"binary":{if(U=S(U),U.startsWith("<~"))U=dr.decode(U);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${P}"`);break}case"PathReference":case"reference":{U=new it(U);break}case"bigint":{U=BigInt(U);break}default:throw new Error(`Import error: Unsupported type "${B}" for value at path "/${P}"`)}return U},j={acebase_import_id:Lt.generate()},N={suppress_events:o.suppress_events,context:j},D=P=>W(this,null,function*(){if(yield u("{"),yield h(),(yield y(1))==="}")return s.index++,this.setNode(P.path,{},N);let I=0,B={},U=!1;const M=()=>W(this,null,function*(){let g;U?Object.keys(B).length>0&&(g=this.updateNode(P.path,B,N)):(U=!0,g=this.setNode(P.path,B,N)),B={},g&&(yield g)}),E=[];for(;;){yield h();const g=yield f();yield h(),yield u(":"),yield h();const{value:b,type:m}=yield w();if(B[g]=b,I++,["object","array"].includes(m)&&(E.push(M()),m==="object"?yield D(P.child(g)):yield q(P.child(g))),yield h(),(yield y(1))==="}"){s.index++;break}yield u(",")}if(I===2&&".type"in B&&".val"in B){const g=R(P.path,B);return this.setNode(P.path,g,N)}E.push(M()),yield Promise.all(E)}),q=P=>W(this,null,function*(){if(yield u("["),yield h(),(yield y(1))==="]")return s.index++,this.setNode(P.path,[],N);let I=!1,B=[],U={};const M=()=>W(this,null,function*(){let m;I?Object.keys(U).length>0&&(m=this.updateNode(P.path,U,N),U={}):(I=!0,m=this.setNode(P.path,B,N),B=null),m&&(yield m)}),E=(m,x)=>{I?U[x]=m:B.push(m)},g=[];let b=0;for(;;){yield h();const{value:m,type:x}=yield w();if(E(m,b),["object","array"].includes(x)&&(g.push(M()),x==="object"?yield D(P.child(b)):yield q(P.child(b))),yield h(),(yield y(1))==="]"){s.index++;break}yield u(","),b++}g.push(M()),yield Promise.all(g)});return(()=>W(this,null,function*(){const{value:P,type:I}=yield w();if(["object","array"].includes(I)){const B=Y.get(r);I==="object"?yield D(B):yield q(B)}else yield this.setNode(r,P,N)}))()})}setSchema(e,t,r=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const s=this._schemas.findIndex(a=>a.path===e);s>=0&&this._schemas.splice(s,1);return}const i=new Y2(t,{warnOnly:r,warnCallback:s=>this.debug.warn(s)}),o=this._schemas.find(s=>s.path===e);o?o.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((s,a)=>{const c=Y.getPathKeys(s.path),l=Y.getPathKeys(a.path);return c.length===l.length?0:c.length<l.length?-1:1}))}getSchema(e){const t=this._schemas.find(r=>r.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,r={updates:!1}){let i={ok:!0};const o=Y.get(e);return this._schemas.filter(s=>o.isOnTrailOf(s.path)).every(s=>{if(o.isDescendantOf(s.path)){const u=Y.fillVariables(s.path,e),h=o.keys.slice(Y.getPathKeys(s.path).length);return i=s.schema.check(u,t,r.updates,h),i.ok}const a=Y.getPathKeys(s.path).slice(o.keys.length);if(r.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=r.updates===!0&&a.length===0,l=(u,h,y)=>{if(y.length===0)return s.schema.check(u,h,c);if(h===null)return{ok:!0};const d=y[0];if(typeof d=="string"&&(d==="*"||d[0]==="$")){if(h===null||typeof h!="object")return{ok:!0};let f;return Object.keys(h).every(p=>{const v=Y.getChildPath(u,p),w=h[p];return f=l(v,w,y.slice(1)),f.ok}),f}else{const f=Y.getChildPath(u,d),p=h[d];return l(f,p,y.slice(1))}};return i=l(e,t,a),i.ok}),i}}class Zo{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return Y}}class zy{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:dB}=ow;class sf{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Lt.generate()}getChildCount(e){return W(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return W(this,null,function*(){const t=new Map;return yield Promise.all(e.map(r=>this.get(r).then(i=>t.set(r,i)))),t})}setMultiple(e){return W(this,null,function*(){yield Promise.all(e.map(({path:t,node:r})=>this.set(t,r)))})}removeMultiple(e){return W(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return W(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return W(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(Zo.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class es extends of{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,r=t?new mw(console,this.lockTimeout):null;this.getTransaction=i=>W(this,[i],function*({path:o,write:s}){const a=yield e.getTransaction({path:o,write:s});Jt(typeof a.id=="string","transaction id not set");const c=a.rollback,l=a.commit;return a.commit=()=>W(this,null,function*(){const u=yield l.call(a);return t&&(yield a._lock.release("commit")),u}),a.rollback=u=>W(this,null,function*(){const h=yield c.call(a,u);return t&&(yield a._lock.release("rollback")),h}),t&&(a._lock=yield r.lock(o,a.id,s,`${this.name}::getTransaction`)),a})}}class Yl extends gw{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class fB extends hB{constructor(e,t,r){super(e,t,r),this._customImplementation=t,this._init()}_init(){return W(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize(Ot.dim)),this.debug.log("- Type: CustomStorage".colorize(Ot.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize(Ot.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize(Ot.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize(Ot.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,r){const i=s=>{if(s===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof s))return s;if(s instanceof Date)return{type:ae.DATETIME,value:s.getTime()};if(s instanceof it)return{type:ae.REFERENCE,value:s.path};if(s instanceof ArrayBuffer)return{type:ae.BINARY,value:dr.encode(s)};if(typeof s=="object")return Jt(Object.keys(s).length===0,"child object stored in parent can only be empty"),s},o="Caller should have pre-processed the value by converting it to a string";if(t.type===ae.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${o}`);const s={};for(let a=0;a<t.value.length;a++)s[a]=t.value[a];t.value=s}if(t.type===ae.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${o}`),t.value=dr.encode(t.value)),t.type===ae.REFERENCE&&t.value instanceof it&&(console.warn(`Unprocessed path reference. ${o}`),t.value=t.value.path),[ae.OBJECT,ae.ARRAY].includes(t.type)){const s=t.value;t.value={},Object.keys(s).forEach(a=>{t.value[a]=i(s[a])})}return r.transaction.set(e,t)}_processReadNodeValue(e){const t=r=>{if(r.type===ae.BINARY)return dr.decode(r.value);if(r.type===ae.DATETIME)return new Date(r.value);if(r.type===ae.REFERENCE)return new it(r.value);throw new Error(`Unhandled child value type ${r.type}`)};switch(e.type){case ae.ARRAY:case ae.OBJECT:{const r=e.value;Object.keys(r).forEach(i=>{const o=r[i];typeof o=="object"&&"type"in o&&(r[i]=t(o))}),e.value=r;break}case ae.BINARY:{e.value=dr.decode(e.value);break}case ae.REFERENCE:{e.value=new it(e.value);break}case ae.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return W(this,null,function*(){const r=yield t.transaction.get(e);return r===null?null:(typeof r!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(r),r)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=ae.STRING;else if(typeof e=="number")t=ae.NUMBER;else if(typeof e=="boolean")t=ae.BOOLEAN;else if(e instanceof Array)t=ae.ARRAY;else if(typeof e=="object")if("type"in e){const r=e;t=r.type,e=r.value,t===ae.DATETIME?e=new Date(e):t===ae.REFERENCE&&(e=new it(e))}else t=ae.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,r){return W(this,null,function*(){if(!r.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof r.diff=="undefined"&&typeof r.currentValue!="undefined"){const f=dB(r.currentValue,t);r.merge&&typeof f=="object"&&(f.removed=f.removed.filter(p=>t[p]===null)),r.diff=f}if(r.diff==="identical")return;const i=r.transaction,o=r.currentValue===null?null:yield this._readNode(e,{transaction:i});if(r.merge&&o){if(o.type===ae.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(f=>isNaN(parseInt(f))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&o.type!==ae.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const s=r.revision||Lt.generate(),a={type:o&&o.type===ae.ARRAY?ae.ARRAY:ae.OBJECT,value:{}},c={};if(t instanceof Array){a.type=ae.ARRAY;const f={};for(let p=0;p<t.length;p++)f[p]=t[p];t=f}else t instanceof it?(a.type=ae.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=ae.BINARY,a.value=dr.encode(t)):typeof t=="string"&&(a.type=ae.STRING,a.value=t);const l=o?[ae.OBJECT,ae.ARRAY].includes(o.type):!1,u=[ae.OBJECT,ae.ARRAY].includes(a.type),h={current:[],new:[]};let y=null;l&&(y=o.value,h.current=Object.keys(y),u&&(a.value=y)),u&&(r.merge||Object.keys(a.value).forEach(f=>{f in t||(t[f]=null)}),Object.keys(t).forEach(f=>{const p=t[f];if(delete a.value[f],p!==null){if(typeof p=="undefined")if(this.settings.removeVoidProperties===!0){delete t[f];return}else throw new Error(`Property "${f}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(p)?a.value[f]=p:c[f]=p}}));const d=a.type===ae.ARRAY;if(o){if(this.debug.log(`Node "/${e}" is being ${r.merge?"updated":"overwritten"}`.colorize(Ot.cyan)),l||u){const p=Y.get(e),v=[];let w=!1;const S=I=>(w=!0,!i.production&&!p.isParentOf(I)&&this.throwImplementationError(`"${I}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),R=I=>{w||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const B=Y.get(I).key;return v.push(B.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},S,R),h.current=h.current.concat(v),u&&(r&&r.merge&&(h.new=h.current.slice()),Object.keys(t).forEach(I=>{h.new.includes(I)||h.new.push(I)}));const j={insert:h.new.filter(I=>!h.current.includes(I)),update:[],delete:r&&r.merge?Object.keys(t).filter(I=>t[I]===null):h.current.filter(I=>!h.new.includes(I))};if(j.update=h.new.filter(I=>h.current.includes(I)&&!j.delete.includes(I)),d&&r.merge&&(j.insert.length>0||j.delete.length>0)&&!j.update.concat(j.insert).every((I,B,U)=>U.includes(B.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const N=Object.keys(c).map(I=>{const B=d?parseInt(I):I,U=typeof r.diff=="object"?r.diff.forChild(B):void 0;if(U==="identical")return;const M=p.childPath(B),E=c[B],g=typeof r.currentValue=="undefined"?void 0:r.currentValue!==null&&typeof r.currentValue=="object"&&B in r.currentValue?r.currentValue[B]:null;return this._writeNode(M,E,{transaction:i,revision:s,merge:!1,currentValue:g,diff:U})}),D=u?v.filter(I=>I in a.value):[],q=j.delete.concat(D).map(I=>{const B=d?parseInt(I):I,U=p.childPath(B);return this._deleteNode(U,{transaction:i})}),P=N.concat(q);yield Promise.all(P)}const f=this._storeNode(e,{type:a.type,value:a.value,revision:o.revision,revision_nr:o.revision_nr+1,created:o.created,modified:Date.now()},{transaction:i});if(f instanceof Promise)return yield f}else{if(this.debug.log(`Node "/${e}" is being created`.colorize(Ot.cyan)),d&&!Object.keys(a.value).concat(Object.keys(c)).every((v,w,S)=>S.includes(w.toString())))throw new Error("Cannot store arrays with missing entries");const f=Object.keys(c).map(v=>{const w=d?parseInt(v):v,S=Y.getChildPath(e,w),R=c[w];return this._writeNode(S,R,{transaction:i,revision:s,merge:!1,currentValue:null})}),p=this._storeNode(e,{type:a.type,value:a.value,revision:s,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});p instanceof Promise&&f.push(p),yield Promise.all(f)}})}_deleteNode(e,t){return W(this,null,function*(){const r=Y.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize(Ot.cyan));const i=[e];let o=!1;const s=l=>(o=!0,!c.production&&!r.isAncestorOf(l)&&this.throwImplementationError(`"${l}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=l=>(o||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(l),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},s,a),this.debug.log(`Nodes ${i.map(l=>`"/${l}"`).join(",")} are being deleted`.colorize(Ot.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let r;const i={next(s){return r=s,o()}},o=()=>W(this,null,function*(){const s=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>W(this,null,function*(){const c=yield this._readNode(e,{transaction:s});if(!c)throw new nf(`Node "/${e}" does not exist`);if(![ae.OBJECT,ae.ARRAY].includes(c.type))return;const l=c.type===ae.ARRAY,u=c.value;let h=Object.keys(u).map(v=>l?parseInt(v):v);t.keyFilter&&(h=h.filter(v=>t.keyFilter.includes(v)));const y=Y.get(e);if(h.length>0&&h.every(v=>{const w=this._getTypeFromStoredValue(u[v]),S=new Yl({path:y.childPath(v),key:l?null:v,index:l?v:null,type:w.type,address:null,exists:!0,value:w.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=r(S)===!1,!a}),a)return;let d=!1;const f=v=>{if(d=!0,!s.production&&!y.isParentOf(v)&&this.throwImplementationError(`"${v}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const w=Y.get(v).key;return t.keyFilter.includes(w)}return!0},p=(v,w)=>{d||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const S=Y.get(v).key,R=new Yl({path:v,type:w.type,key:l?null:S,index:l?S:null,address:new zy(v),exists:!0,value:null,revision:w.revision,revision_nr:w.revision_nr,created:new Date(w.created),modified:new Date(w.modified)});return a=r(R)===!1,!a};yield s.childrenOf(e,{metadata:!0,value:!1},f,p)}))(),t.transaction||(yield s.commit()),a}catch(a){throw t.transaction||(yield s.rollback(a)),a}});return i}getNode(e,t){return W(this,null,function*(){t=t||{};const r=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>W(this,null,function*(){const o=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,s=Y.get(e),a=yield this._readNode(e,{transaction:r});if(!a){if(e==="")return{value:null};const R=yield r.moveToParentPath(s.parentPath);Jt(R===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const j=yield this._readNode(s.parentPath,{transaction:r});if(j&&[ae.OBJECT,ae.ARRAY].includes(j.type)&&s.key in j.value){const N=this._getTypeFromStoredValue(j.value[s.key]);return{revision:j.revision,revision_nr:j.revision_nr,created:j.created,modified:j.modified,type:N.type,value:N.value}}return{value:null}}const c=a.type===ae.ARRAY,l=R=>{const j=N=>/^[0-9]+$/.test(N);return R.map(N=>Y.get(c&&j(N)?`[${N}]`:N))},u=t.include?l(t.include):[],h=t.exclude?l(t.exclude):[],y=(R,j)=>{if([ae.OBJECT,ae.ARRAY].includes(j.type)&&u.length>0){const N=Y.getPathKeys(R).slice(s.keys.length),D=new Y(N),q=[],P=u.filter(B=>B.isDescendantOf(D));if(P.length>0){const B=j.type===ae.ARRAY;q.push(...Object.keys(j.value).map(U=>B?+U:U));for(const U of P){const M=U.keys[N.length];if(typeof M=="string"&&(M==="*"||M.startsWith("$"))){q.splice(0);break}const E=q.indexOf(M);E>=0&&q.splice(E,1)}}const I=u.some(B=>B.isChildOf(D));if(h.some(B=>B.isChildOf(D))&&!I){const B=h.filter(U=>U.isChildOf(D));for(let U=0;U<q.length;U++)B.find(M=>M.equals(q[U]))||(q.splice(U,1),U--)}for(const B of q)delete j.value[B]}};y(e,a);let d=!1;const f=(R,j)=>{if(d=!0,!r.production&&!s.isAncestorOf(R)&&this.throwImplementationError(`"${R}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!o)return!0;const N=Y.getPathKeys(R).slice(s.keys.length),D=new Y(N);let q=(u.length>0?u.some(P=>D.isOnTrailOf(P)):!0)&&(h.length>0?!h.some(P=>P.equals(D)||P.isAncestorOf(D)):!0);return q&&t.child_objects===!1&&(s.isParentOf(R)&&[ae.OBJECT,ae.ARRAY].includes(j?j.type:-1)||Y.getPathKeys(R).length>s.pathKeys.length+1)&&(q=!1),q},p=[],v=(R,j)=>{if(d||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[ae.OBJECT,ae.ARRAY].includes(j.type))return!0;y(R,j),this._processReadNodeValue(j);const N=j;return N.path=R,p.push(N),!0};yield r.descendantsOf(e,{metadata:!0,value:!0},f,v),this.debug.log(`Read node "/${e}" and ${o?"(filtered) ":""}descendants from ${p.length+1} records`.colorize(Ot.magenta));const w=a,S=R=>{const j=[];return Object.keys(R).forEach(N=>{const D=parseInt(N);j[D]=R[D]}),j};if(a.type===ae.ARRAY&&(w.value=S(w.value)),a.type===ae.OBJECT||a.type===ae.ARRAY){const R=Y.getPathKeys(e),j=a.value;for(let N=0;N<p.length;N++){const D=p[N],q=Y.getPathKeys(D.path).slice(R.length);let P=j;for(let I=0;I<q.length;I++){Jt(typeof P=="object","parent must be an object/array to have children!!");const B=q[I],U=I===q.length-1,M=U?D.type:typeof q[I+1]=="number"?ae.ARRAY:ae.OBJECT;let E;U?(E=D.value,M===ae.ARRAY&&(E=S(E))):E=M===ae.OBJECT?{}:[],B in P?typeof P[B]==typeof E&&[ae.OBJECT,ae.ARRAY].includes(M)?Object.keys(E).forEach(g=>{g in P[B]&&this.throwImplementationError(`Custom storage merge error: child key "${g}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),P[B][g]=E[g]}):this.debug.error(`The value stored in node "${D.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:P,key:B,nodeType:M,nodeValue:E}):P[B]=E,P=P[B]}}}else p.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(w.value).forEach(R=>{typeof w.value[R]=="object"&&w.value[R].constructor===Object&&(Jt(Object.keys(w.value[R]).length===0),delete w.value[R])}),t.include,t.exclude){const R=(j,N)=>{if(typeof j!="object")return;const D=N[0];D==="*"?Object.keys(j).forEach(q=>{R(j[q],N.slice(1))}):N.length>1?D in j&&R(j[D],N.slice(1)):delete j[D]};t.exclude.forEach(j=>{const N=Y.getPathKeys(j);R(w.value,N)})}return w}))();return t.transaction||(yield r.commit()),i}catch(i){throw t.transaction||(yield r.rollback(i)),i}})}getNodeInfo(e){return W(this,arguments,function*(t,r={}){r=r||{};const i=Y.get(t),o=r.transaction||(yield this._customImplementation.getTransaction({path:t,write:!1}));try{const s=yield this._readNode(t,{transaction:o}),a=new Yl({path:t,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:s?s.type:0,exists:s!==null,address:s?new zy(t):null,created:s?new Date(s.created):null,modified:s?new Date(s.modified):null,revision:s?s.revision:null,revision_nr:s?s.revision_nr:null});if(!s&&t!==""){const c=yield o.moveToParentPath(i.parentPath);Jt(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${t}"`);const l=yield this._readNode(i.parentPath,{transaction:o});l&&[ae.OBJECT,ae.ARRAY].includes(l.type)&&i.key in l.value?(a.exists=!0,a.value=l.value[i.key],a.address=null,a.type=l.type,a.created=new Date(l.created),a.modified=new Date(l.modified),a.revision=l.revision,a.revision_nr=l.revision_nr):a.address=null}return r.include_child_count&&(a.childCount=0,[ae.OBJECT,ae.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=s.value?Object.keys(s.value).length:0,a.childCount+=yield o.getChildCount(t))),r.transaction||(yield o.commit()),a}catch(s){throw r.transaction||(yield o.rollback(s)),s}})}setNode(e,t){return W(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const s=Y.get(r),a=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{if(r===""){if(i===null||typeof i!="object"||i instanceof Array||i instanceof ArrayBuffer||"buffer"in i&&i.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${i}`);yield this._writeNodeWithTracking("",i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context})}else if(typeof o.assert_revision!="undefined"){const c=yield this.getNodeInfo(r,{transaction:a});if(c.revision!==o.assert_revision)throw new fh(`revision '${c.revision}' does not match requested revision '${o.assert_revision}'`);if(c.address&&c.address.path===r&&i!==null&&!this.valueFitsInline(i))yield this._writeNodeWithTracking(r,i,{merge:!1,transaction:a,suppress_events:o.suppress_events,context:o.context});else{const l=yield a.moveToParentPath(s.parentPath);Jt(l===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(s.parentPath,{[s.key]:i},{merge:!0,transaction:a,suppress_events:o.suppress_events,context:o.context})}}else{const c=yield a.moveToParentPath(s.parentPath);Jt(c===s.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(s.parentPath,{[s.key]:i},{transaction:a,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield a.commit())}catch(c){throw o.transaction||(yield a.rollback(c)),c}})}updateNode(e,t){return W(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof i!="object")throw new Error("invalid updates argument");if(Object.keys(i).length===0)return;const s=o.transaction||(yield this._customImplementation.getTransaction({path:r,write:!0}));try{const a=yield this.getNodeInfo(r,{transaction:s}),c=Y.get(r);if(a.exists&&a.address&&a.address.path===r)yield this._writeNodeWithTracking(r,i,{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context});else if(a.exists){const l=Y.get(r),u=yield s.moveToParentPath(l.parentPath);Jt(u===l.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this._writeNodeWithTracking(l.parentPath,{[l.key]:i},{transaction:s,merge:!0,suppress_events:o.suppress_events,context:o.context})}else{const l=yield s.moveToParentPath(c.parentPath);Jt(l===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${r}"`),yield this.updateNode(c.parentPath,{[c.key]:i},{transaction:s,suppress_events:o.suppress_events,context:o.context})}o.transaction||(yield s.commit())}catch(a){throw o.transaction||(yield s.rollback(a)),a}})}}class pB{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return W(this,null,function*(){var r,i;try{this.running++;const o=yield e();if(this.results[t]=o,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(r=this.doneCallback)==null||r.call(this,this.results);else if(this.scheduled.length>0){const s=this.scheduled.shift();this.execute(s.task,s.index)}}catch(o){this.done=!0,(i=this.errorCallback)==null||i.call(this,o)}})}add(e){var t;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const r=this.added++;((t=this.options)==null?void 0:t.wait)!==!0&&this.running<this.limit?this.execute(e,r):this.scheduled.push({task:e,index:r})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return W(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const yB=()=>{};function bw(n,e,t){return W(this,arguments,function*(r,i,o,s={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:yB}){var a,c,l,u,h,y;typeof s!="object"&&(s={}),typeof s.snapshots=="undefined"&&(s.snapshots=!1);const d={};(a=r.storage.settings.transactions)!=null&&a.log&&(d.acebase_cursor=Lt.generate());const f=o.filters.map(E=>te({},E)),p=o.order.map(E=>te({},E)),v=E=>{E.sort((g,b)=>{const m=x=>{const O=p[x],k=Y.getPathKeys(typeof O.key=="number"?`[${O.key}]`:O.key),$=k.reduce((A,T)=>A!==null&&typeof A=="object"&&T in A?A[T]:null,g.val),_=k.reduce((A,T)=>A!==null&&typeof A=="object"&&T in A?A[T]:null,b.val);return $===null?_===null?0:O.ascending?-1:1:_===null?O.ascending?1:-1:$==_?x<p.length-1?m(x+1):g.path<b.path?-1:1:$<_?O.ascending?-1:1:O.ascending?1:-1};return m(0)})},w=(E,g)=>W(this,null,function*(){if(E.length===0)return[];const b=50,m=new pB(b),x=[];return E.forEach(({path:O},k)=>m.add(()=>W(this,null,function*(){const $=(yield r.storage.getNode(O,g)).value;if($===null){r.storage.debug.warn(`Indexed result "/${O}" does not have a record!`);return}const _={path:O,val:$};M.sorted?x[k]=_:(x.push(_),!M.skipped&&x.length>o.skip+Math.abs(o.take)&&(v(x),x.pop()))}))),yield m.finish(),x}),S=Y.get(i),R=S.keys.some(E=>E==="*"||E.toString().startsWith("$")),j=r.storage.indexes.get(i),N=[];let D=()=>W(this,null,function*(){});if(R){const E=S.keys.filter(m=>typeof m=="string"&&m.startsWith("$")),g=E.length>0&&E.every(m=>o.filters.some(x=>x.key===m&&["==","in"].includes(x.op))),b=typeof s.monitor=="object"&&[(c=s.monitor)==null?void 0:c.add,(l=s.monitor)==null?void 0:l.change,(u=s.monitor)==null?void 0:u.remove].some(m=>m===!0);if(g&&!b){const m=[];for(const A of E){const T=o.filters.filter(L=>L.key===A).reduce((L,V)=>{if(V.op==="=="&&L.push(V.compare),V.op==="in"){if(!(V.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");L.push(...V.compare)}return L},[]),C=m.splice(0);T.forEach(L=>{C.length===0?m.push({[A]:L}):m.push(...C.map(V=>Ge(te({},V),{[A]:L})))})}const x=o.filters.filter(A=>!E.includes(A.key)),O=m.map(A=>Y.get(Y.getPathKeys(i).map(T=>{var C;return(C=A[T])!=null?C:T})).path),k=o.order.length>0,$=O.map(A=>{var T;return bw(r,A,{filters:x,take:0,skip:0,order:[]},{snapshots:k,cache_mode:s.cache_mode,include:[...(T=s.include)!=null?T:[],...o.order.map(C=>C.key)],exclude:s.exclude})});let _=(yield Promise.all($)).reduce((A,T)=>(A.push(...T.results),A),[]);if(k&&v(_),o.skip>0&&_.splice(0,o.skip),o.take>0&&_.splice(o.take),s.snapshots&&(!k||((h=s.include)==null?void 0:h.length)>0||((y=s.exclude)==null?void 0:y.length)>0||!s.child_objects)){const{include:A,exclude:T,child_objects:C}=s;_=yield w(_,{include:A,exclude:T,child_objects:C})}return{results:_,context:null,stop:D}}else if(j.length===0){const m=new Error(`Query on wildcard path "/${i}" requires an index`);return Promise.reject(m)}if(f.length===0){const m=j.filter(x=>x.type==="normal")[0];f.push({key:m.key,op:"!=",compare:null})}}f.forEach(E=>{if(E.index)return;const g=j.filter(b=>b.key===E.key).filter(b=>b.validOperators.includes(E.op));if(g.length>=1){const b=f.filter(k=>k!==E).map(k=>k.key),m=p.map(k=>k.key).filter(k=>k!==E.key),x=g.map(k=>{const $=k.includeKeys.concat(k.key),_=$.filter(L=>b.includes(L)),A=$.filter(L=>m.includes(L)),T=_.concat(A.filter(L=>!_.includes(L))),C={filters:_.length,sorting:A.length*(o.take!==0?A.length:1),both:T.length*T.length,get total(){return this.filters+this.sorting+this.both}};return{index:k,points:C.total,filterKeys:_,sortKeys:A}});x.sort((k,$)=>k.points>$.points?-1:1);const O=x[0];E.index=O.index,O.filterKeys.forEach(k=>{f.filter($=>$!==E&&$.key===k).forEach($=>{!rf.validOperators.includes($.op)||($.indexUsage="filter",$.index=O.index)})}),O.sortKeys.forEach(k=>{p.filter($=>$.key===k).forEach($=>{$.index=O.index})})}E.index&&N.push({index:E.index,description:E.index.description})}),p.length>0&&o.take!==0&&f.length===0&&p.forEach(E=>{E.index||(E.index=j.filter(g=>g.key===E.key).find(g=>g.type==="normal"))});const q=N.map(E=>E.description).join(", ");N.length>0&&r.storage.debug.log(`Using indexes for query: ${q}`);const P=f.filter(E=>!E.index),I=/^[a-z]+:/i;if(P.some(E=>I.test(E.op))){const E=P.find(b=>I.test(b.op)),g=new Error(`query contains operator "${E.op}" which requires a special index that was not found on path "${i}", key "${E.key}"`);return Promise.reject(g)}const B=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let E=0;E<P.length;E++){const g=P[E];if(!B.includes(g.op))return Promise.reject(new Error(`query contains unknown filter operator "${g.op}" on path "${i}", key "${g.key}"`))}if(R&&P.length>0){const E=P.reduce((b,m)=>(b.indexOf(m.key)<0&&b.push(m.key),b),[]).map(b=>`"${b}"`),g=new Error(`This wildcard path query on "/${i}" requires index(es) on key(s): ${E.join(", ")}. Create the index(es) and retry`);return Promise.reject(g)}const U=[];f.forEach(E=>{if(E.index&&E.indexUsage!=="filter"){let g=E.index.query(E.op,E.compare).then(m=>(s.eventHandler&&s.eventHandler({name:"stats",type:"index_query",source:E.index.description,stats:m.stats}),m.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"index_query",source:E.index.description,hints:m.hints}),m));const b=f.filter(m=>m.index===E.index&&m.indexUsage==="filter");b.length>0&&(g=g.then(m=>(b.forEach(x=>{const{key:O,op:k,index:$}=x;let{compare:_}=x;typeof _=="string"&&!$.caseSensitive&&(_=_.toLocaleLowerCase($.textLocale)),m=m.filterMetadata(O,k,_)}),m))),U.push(g)}});const M={filtered:f.length===0,skipped:o.skip===0,taken:o.take===0,sorted:p.length===0,preDataLoaded:!1,dataLoaded:!1};if(f.length===0&&o.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${i}"`),o.take=100),p.length>0&&p[0].index){const E=p[0].index,g=o.take<0?!p[0].ascending:p[0].ascending;if(f.length===0&&p.slice(1).every(b=>E.allMetadataKeys.includes(b.key))){r.storage.debug.log(`Using index for sorting: ${E.description}`);const b=p.slice(1).map(x=>(x.index=E,{key:x.key,ascending:x.ascending})),m=E.take(o.skip,Math.abs(o.take),{ascending:g,metadataSort:b}).then(x=>(s.eventHandler&&s.eventHandler({name:"stats",type:"sort_index_take",source:E.description,stats:x.stats}),x.hints.length>0&&s.eventHandler&&s.eventHandler({name:"hints",type:"sort_index_take",source:E.description,hints:x.hints}),x));U.push(m),M.skipped=!0,M.taken=!0,M.sorted=!0}}return Promise.all(U).then(E=>W(this,null,function*(){let g=[];if(E.length===1){const _=E[0];g=_.map(A=>{const T={key:A.key,path:A.path,val:{[_.filterKey]:A.value}};return A.metadata&&Object.assign(T.val,A.metadata),T}),M.filtered=!0}else if(E.length>1){E.sort((T,C)=>T.length<C.length?-1:1);const _=E[0],A=E.slice(1);g=_.reduce((T,C)=>{const L={key:C.key,path:C.path,val:{[_.filterKey]:C.value}};return A.every(V=>V.findIndex(K=>K.path===C.path)>=0)&&(C.metadata&&Object.assign(L.val,C.metadata),A.forEach(V=>{const K=V.find(G=>G.path===L.path);L.val[V.filterKey]=K.value,K.metadata&&Object.assign(L.val,K.metadata)}),T.push(L)),T},[]),M.filtered=!0}if(R||U.length>0&&P.length===0){if(p.length===0||p.every(_=>_.index)){if(M.preDataLoaded=!0,!M.sorted&&p.length>0&&v(g),M.sorted=!0,!M.skipped&&o.skip>0&&(g=o.take<0?g.slice(0,-o.skip):g.slice(o.skip)),!M.taken&&o.take!==0&&(g=o.take<0?g.slice(o.take):g.slice(0,o.take)),M.skipped=!0,M.taken=!0,!s.snapshots)return g;const _={include:s.include,exclude:s.exclude,child_objects:s.child_objects};return w(g,_).then(A=>(M.dataLoaded=!0,A))}if(s.snapshots||!M.sorted){const _=p.length>0,A=_?{include:p.map(T=>T.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects};return w(g,A).then(T=>(p.length>0&&v(T),M.sorted=!0,o.skip>0&&(T=o.take<0?T.slice(0,-o.skip):T.slice(o.skip)),o.take!==0&&(T=o.take<0?T.slice(o.take):T.slice(0,o.take)),M.skipped=!0,M.taken=!0,s.snapshots&&_?w(T,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}):T))}else return g}let b;g.length>0&&(b=g.map(_=>_.key));let m=[],x=!1;const O=p.length>0,k=O?{include:p.map(_=>_.key)}:{include:s.include,exclude:s.exclude,child_objects:s.child_objects},$={promises:[],add(_){if(this.promises.push(_),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then(A=>{})}};try{yield r.storage.getChildren(i,{keyFilter:b,async:!0}).next(_=>{if(_.type!==ae.OBJECT||!_.address)return;if(x)return!1;const A=()=>W(this,null,function*(){if(!(yield r.storage.matchNode(_.address.path,P)))return;const C=_.address.path;let L;if(s.snapshots||p.length>0){const V=yield r.storage.getNode(C,k);L={path:C,val:V.value}}else L={path:C};m.push(L),o.take!==0&&m.length>Math.abs(o.take)+o.skip&&(p.length>0?v(m):o.take>0&&(x=!0),m.pop())}),T=$.add(A());if(T instanceof Promise)return T})}catch(_){return _ instanceof nf||r.storage.debug.warn(`Error getting child stream: ${_}`),[]}return yield Promise.all($.promises),M.preDataLoaded=O,M.dataLoaded=!O,p.length>0&&v(m),M.sorted=!0,o.skip>0&&(m=o.take<0?m.slice(0,-o.skip):m.slice(o.skip)),M.skipped=!0,o.take!==0&&(m=o.take<0?m.slice(o.take):m.slice(0,o.take)),M.taken=!0,M.dataLoaded||(m=yield w(m,{include:s.include,exclude:s.exclude,child_objects:s.child_objects}),M.dataLoaded=!0),m})).then(E=>{if(!M.sorted&&p.length>0&&v(E),s.snapshots||(E=E.map(g=>g.path)),!M.skipped&&o.skip>0&&(E=o.take<0?E.slice(0,-o.skip):E.slice(o.skip)),!M.taken&&o.take!==0&&(E=o.take<0?E.slice(o.take):E.slice(0,o.take)),s.monitor===!0&&(s.monitor={add:!0,change:!0,remove:!0}),typeof s.monitor=="object"&&(s.monitor.add||s.monitor.change||s.monitor.remove)){const g=s.monitor,b=s.snapshots?E.map(T=>T.path):E.slice(),m=r.db.ref(i),x=T=>{const C=b.indexOf(T);C<0||b.splice(C,1)},O=T=>{b.includes(T)||b.push(T)},k=()=>{r.unsubscribe(m.path,"child_changed",$),r.unsubscribe(m.path,"child_added",_),r.unsubscribe(m.path,"notify_child_removed",A)};D=()=>W(this,null,function*(){k()});const $=(T,C,L,V)=>W(this,null,function*(){const K=b.includes(C);let G=!0;const ie=[];f.forEach(ne=>!ie.includes(ne.key)&&ie.push(ne.key));const ee=[];typeof V=="object"&&Object.keys(V).forEach(ne=>!ee.includes(ne)&&ee.push(ne)),typeof L=="object"&&Object.keys(L).forEach(ne=>!ee.includes(ne)&&ee.push(ne));const fe=[];let de=ee.every(ne=>ie.includes(ne)?f.filter(ce=>ce.key===ne).every(ce=>{var Me;return((Me=ce.index)==null?void 0:Me.textLocaleKey)&&!ee.includes(ce.index.textLocaleKey)?(fe.push(ce.index.textLocaleKey),!0):B.includes(ce.op)?r.storage.test(L[ne],ce.op,ce.compare):ce.index.test(L,ce.op,ce.compare)}):!0);if(de&&(fe.push(...ie.filter(ne=>!ee.includes(ne))),!K&&fe.length>0)){const ne=f.filter(ve=>fe.includes(ve.key)),ce=ne.filter(ve=>B.includes(ve.op)),Me=ne.filter(ve=>!B.includes(ve.op));if(ce.length>0&&(de=yield r.storage.matchNode(C,ce)),de&&Me.length>0){const ve=Me.reduce((Ce,Xe)=>(Ce.includes(Xe.key)||Ce.push(Xe.key),Xe.index instanceof vw&&Xe.index.config.localeKey&&!Ce.includes(Xe.index.config.localeKey)&&Ce.push(Xe.index.config.localeKey),Ce),[]),Vt=yield r.storage.getNode(C,{include:ve});if(Vt.value===null)return!1;de=Me.every(Ce=>Ce.index.test(Vt.value,Ce.op,Ce.compare))}}if(de){if(K||O(C),s.snapshots){const ne={include:s.include,exclude:s.exclude,child_objects:s.child_objects};L=(yield r.storage.getNode(C,ne)).value}K&&g.change?G=s.eventHandler({name:"change",path:C,value:L})!==!1:!K&&g.add&&(G=s.eventHandler({name:"add",path:C,value:L})!==!1)}else K&&(x(C),g.remove&&(G=s.eventHandler({name:"remove",path:C,value:V})!==!1));G===!1&&k()}),_=(T,C,L)=>{const V=f.every(G=>B.includes(G.op)?r.storage.test(L[G.key],G.op,G.compare):G.index.test(L,G.op,G.compare));let K=!0;V&&(O(C),g.add&&(K=s.eventHandler({name:"add",path:C,value:s.snapshots?L:null})!==!1)),K===!1&&k()},A=(T,C,L,V)=>{let K=!0;x(C),g.remove&&(K=s.eventHandler({name:"remove",path:C,value:s.snapshots?V:null})!==!1),K===!1&&k()};(s.monitor.add||s.monitor.change||s.monitor.remove)&&r.subscribe(m.path,"child_changed",$),s.monitor.remove&&r.subscribe(m.path,"notify_child_removed",A),s.monitor.add&&r.subscribe(m.path,"child_added",_)}return{results:E,context:d,stop:D}})})}class gB extends M2{constructor(e="default",t,r){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(My&&t.settings.storage instanceof My)this.storage=new G2(e,t.settings.storage,i);else if(Fy&&t.settings.storage instanceof Fy)this.storage=new X2(e,t.settings.storage,i);else if(es&&t.settings.storage instanceof es)this.storage=new fB(e,t.settings.storage,i);else{const o=t.settings.storage instanceof Hl?t.settings.storage:new Hl(t.settings.storage);this.storage=new dh(e,o,i)}else this.storage=new dh(e,new Hl,i);this.storage.on("ready",r)}stats(e){return W(this,null,function*(){return this.storage.stats})}subscribe(e,t,r){this.storage.subscriptions.add(e,t,r)}unsubscribe(e,t,r){this.storage.subscriptions.remove(e,t,r)}set(e,t){return W(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.setNode(r,i,{suppress_events:o.suppress_events,context:o.context});return te({},s&&{cursor:s})})}update(e,t){return W(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.updateNode(r,i,{suppress_events:o.suppress_events,context:o.context});return te({},s&&{cursor:s})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return W(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const r=yield this.storage.getNode(e,t);return{value:r.value,context:{acebase_cursor:r.cursor},cursor:r.cursor}})}transaction(e,t){return W(this,arguments,function*(r,i,o={suppress_events:!1,context:null}){const s=yield this.storage.transactNode(r,i,{suppress_events:o.suppress_events,context:o.context});return te({},s&&{cursor:s})})}exists(e){return W(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(e,t){return W(this,arguments,function*(r,i,o={snapshots:!1}){return yield bw(this,r,i,o)})}createIndex(e,t,r){return this.storage.indexes.create(e,t,r)}getIndexes(){return W(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return W(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,r){return W(this,null,function*(){r=r||{};const i=(o,s=50,a=0,c=null)=>W(this,null,function*(){typeof s=="string"&&(s=parseInt(s)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const l=[];let u=0,h=!1,y=!1;return yield this.storage.getChildren(o).next(d=>{if(h)return y=!0,!1;u++,(c!==null?d.key>c:a===0||u>a)&&l.push(te({key:typeof d.key=="string"?d.key:d.index,type:d.valueTypeName,value:d.value},typeof d.address=="object"&&"pageNr"in d.address&&{address:{pageNr:d.address.pageNr,recordNr:d.address.recordNr}})),h=s>0&&l.length===s}).catch(d=>{if(!(d instanceof nf))throw d}),{more:y,list:l}});switch(t){case"children":return yield i(e,r.limit,r.skip,r.from);case"info":{const o={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},s=yield this.storage.getNodeInfo(e,{include_child_count:r.child_count===!0});o.key=typeof s.key!="undefined"?s.key:s.index,o.exists=s.exists,o.type=s.exists?s.valueTypeName:void 0,o.value=s.value,o.address=typeof s.address=="object"&&"pageNr"in s.address?{pageNr:s.address.pageNr,recordNr:s.address.recordNr}:void 0;const a=s.exists&&s.address&&[ae.OBJECT,ae.ARRAY].includes(s.type);return r.child_count===!0?o.children={count:a?s.childCount:0}:typeof r.child_limit=="number"&&r.child_limit>0&&a&&(o.children=yield i(e,r.child_limit,r.child_skip,r.child_from)),o}}})}export(e,t,r={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,r)}import(e,t,r={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,r)}setSchema(e,t,r=!1){return W(this,null,function*(){return this.storage.setSchema(e,t,r)})}getSchema(e){return W(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return W(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,r){return W(this,null,function*(){return this.storage.validateSchema(e,t,{updates:r})})}getMutations(e){return W(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return W(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class mB extends of{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class vB extends sf{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return W(this,null,function*(){})}rollback(e){return W(this,null,function*(){})}get(e){return W(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return W(this,null,function*(){const r=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),r)})}remove(e){return W(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,r,i){return W(this,null,function*(){const o=Zo.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isParentOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}descendantsOf(e,t,r,i){return W(this,null,function*(){const o=Zo.PathInfo.get(e);for(let s=0;s<this.context.localStorage.length;s++){const a=this.context.localStorage.key(s);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(o.isAncestorOf(c)&&r(c)){let l;if(t.metadata||t.value){const u=this.context.localStorage.getItem(a);l=JSON.parse(u)}if(!i(c,l))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function bB(n,e={}){const t=new mB(e),r=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new es({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return W(this,null,function*(){})},getTransaction(s){return W(this,null,function*(){const a={debug:!0,dbname:n,localStorage:r};return new vB(a,s)})}}),o=new ks(n,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return o.settings.ipcEvents=t.multipleTabs===!0,o}class wB extends of{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class ww extends pw{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class kB extends V2{constructor(e,t={}){const r=new ww(t);super(e,r),this.recovery={repairNode:(o,s)=>W(this,null,function*(){if(yield this.ready(),this.api.storage instanceof dh)yield this.api.storage.repairNode(o,s);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:o=>W(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(o)})};const i={db:this,settings:r};this.api=new gB(e,i,()=>{this.emit("ready")})}close(){return W(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(r){t.setLevel(r)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(r){e.eventsEnabled=r}}}static WithLocalStorage(e,t={}){return bB(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function Ky(n){return new Promise((e,t)=>{n.onsuccess=r=>e(n.result||null),n.onerror=t})}class xB extends sf{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,r=te({},e);return delete r.value,{metadata:r,value:t}}commit(){return W(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(r=>r.path)});const t=this._createTransaction(!0);try{yield new Promise((r,i)=>{let o=!1,s=0;const a=l=>{o=!0,i(l)},c=()=>{++s===e.length&&r()};e.forEach((l,u)=>{if(o)return;let h,y;const d=l.path;if(l.action==="set"){const{metadata:p,value:v}=this._splitMetadata(l.node),w={path:d,metadata:p};h=t.objectStore("nodes").put(w),y=t.objectStore("content").put(v,d),this.context.cache.set(d,l.node)}else l.action==="remove"?(h=t.objectStore("content").delete(d),y=t.objectStore("nodes").delete(d),this.context.cache.set(d,null)):a(new Error(`Unknown pending operation "${l.action}" on path "${d}" `));let f=0;h.onsuccess=y.onsuccess=()=>{++f===2&&c()},h.onerror=y.onerror=a})}),t.commit&&t.commit()}catch(r){throw console.error(r),t.abort&&t.abort(),r}})}rollback(e){return W(this,null,function*(){this._pending=[]})}get(e){return W(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),r=Ky(t.objectStore("nodes").get(e)),i=Ky(t.objectStore("content").get(e));try{const o=yield Promise.all([r,i]);t.commit&&t.commit();const s=o[0];if(!s)return this.context.cache.set(e,null),null;const a=s.metadata;return a.value=o[1],this.context.cache.set(e,a),a}catch(o){throw console.error("IndexedDB get error",o),t.abort&&t.abort(),o}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return W(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,r,i){return this._getChildrenOf(e,Ge(te({},t),{descendants:!1}),r,i)}descendantsOf(e,t,r,i){return this._getChildrenOf(e,Ge(te({},t),{descendants:!0}),r,i)}_getChildrenOf(e,t,r,i){return new Promise((o,s)=>{const a=Zo.PathInfo.get(e),c=this._createTransaction(!1),l=c.objectStore("nodes"),u=IDBKeyRange.lowerBound(e,!0),h=t.metadata?l.openCursor(u):l.openKeyCursor(u);h.onerror=y=>{var d;(d=c.abort)==null||d.call(c),s(y)},h.onsuccess=y=>W(this,null,function*(){var d,f,p;const v=(f=(d=h.result)==null?void 0:d.key)!=null?f:null;let w=!0;if(v===null)w=!1;else if(!a.isAncestorOf(v))w=!1;else if(t.descendants||a.isParentOf(v)){let S;if(t.metadata&&(S=h.result.value.metadata),r(v,S)){if(t.value)if(this.context.cache.has(v)){const R=this.context.cache.get(v);S.value=R.value}else{const R=c.objectStore("content").get(v);S.value=yield new Promise((j,N)=>{R.onerror=D=>{j(null)},R.onsuccess=D=>{j(R.result)}}),this.context.cache.set(v,S.value===null?null:S)}w=i(v,S)}}if(w)try{h.result.continue()}catch(S){w=!1}w||((p=c.commit)==null||p.call(c),o())})})}}function EB(n,e={}){const t=new wB(e),r=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${n}.acebase`,1);r.onupgradeneeded=u=>{const h=r.result;h.createObjectStore("nodes",{keyPath:"path"}),h.createObjectStore("content")};let i;const o=new Promise((u,h)=>{r.onsuccess=y=>{i=r.result,u()},r.onerror=y=>{h(y)}}),s=new z2(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),a=new es({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return o},getTransaction(u){return W(this,null,function*(){yield o;const h={debug:!1,db:i,cache:s,ipc:l};return new xB(h,u)})}}),c=new ks(n,{logLevel:t.logLevel,storage:a,sponsor:t.sponsor}),l=c.api.storage.ipc;return c.settings.ipcEvents=t.multipleTabs===!0,l.on("notification",u=>W(this,null,function*(){const h=u.data;if(typeof h=="object"&&h.action==="cache.invalidate")for(const y of h.paths)s.remove(y)})),c}const _B=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class ks extends kB{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(_B);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return EB(e,t)}}const $B={AceBase:ks,AceBaseLocalSettings:ww,DataReference:Fn,DataSnapshot:rt,EventSubscription:Z0,PathReference:it,TypeMappings:uw,CustomStorageSettings:es,CustomStorageTransaction:sf,CustomStorageHelpers:Zo,ID:Lt,proxyAccess:Ta,DataSnapshotsArray:Fc};window.acebase=$B;window.AceBase=ks;let OB=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),Gl=(()=>"/ps"+OB()+"/pe")();const Pt={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},Mt={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},Xl={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+Gl+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+Gl+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+Gl+"/get-one",users:{base:"/users"}},ko={base:"/storage",upload:"/upload",download:{one:"download-one",many:"download-many"}};var Co,ii,Bi,Ro,Ft,kw,Io,yh,Pa,oi,Lr,Li,qt;class AB{constructor(e={}){fn(this,Co,"/on"),fn(this,ii,!0),fn(this,Bi,void 0),fn(this,Ro,void 0),fn(this,Ft,void 0),fn(this,kw,void 0),fn(this,Io,void 0),fn(this,yh,void 0),fn(this,Pa,new u2),fn(this,oi,void 0),fn(this,Lr,void 0),fn(this,Li,void 0),fn(this,qt,void 0),QR(this,"init",o=>{var s,a,c,l,u;let{ENV:h,HOST_SERVER:y,API_VERSION:d}=be(this,Li),f=()=>W(this,null,function*(){var g,b,m,x,O,k,$,_,A,T,C,L;let V="/transaction",K="/database",G=yield(m=(b=(g=be(this,qt))==null?void 0:g.ref(V))==null?void 0:b.get())==null?void 0:m.catch(ee=>{}),ie=yield(k=(O=(x=be(this,qt))==null?void 0:x.ref(K))==null?void 0:O.get())==null?void 0:k.catch(ee=>{});if(G.exists()){G=G.val();let ee=Object.keys(G);if((ee==null?void 0:ee.length)>0){for(let fe in ee){let de=G[fe];(de==null?void 0:de.path)&&(de==null?void 0:de.method)&&(de==null?void 0:de.value)&&(yield this.init(o).database().ref(de==null?void 0:de.path).req(de==null?void 0:de.method,de==null?void 0:de.path,de==null?void 0:de.value).val())}ie.exists()&&(yield(A=(_=($=be(this,qt))==null?void 0:$.ref(K))==null?void 0:_.remove())==null?void 0:A.catch(fe=>{})),yield(L=(C=(T=be(this,qt))==null?void 0:T.ref(V))==null?void 0:C.remove())==null?void 0:L.catch(fe=>{})}}});(a=(s=o==null?void 0:o.socket)==null?void 0:s.storage)==null||a.on("connect",()=>{Cn(this,Lr,!0),f()}),(l=(c=o==null?void 0:o.socket)==null?void 0:c.storage)==null||l.on("disconnect",()=>{Cn(this,Lr,!1)});const p=(g={})=>{var b,m,x;let O={};if(g&&Object.keys(g).length>0&&(O.data=g),be(this,Ft)&&(O.storage=be(this,Ft),O.config=be(this,Io)),be(this,yh)){let k=new FormData;Array.isArray(g)?(g.map(($,_)=>{typeof $=="object"&&($.attachmentName="attachment"+_,$==null||$.attachments.forEach(A=>{A!=null&&A.data?k.append("attachments"+_,A==null?void 0:A.data,A==null?void 0:A.name):k.append("attachments"+_,A)}))}),k.append("field",JSON.stringify(O))):Array.isArray(g==null?void 0:g.attachments)&&(g==null||g.attachments.forEach($=>{$!=null&&$.data?k.append("attachments",$==null?void 0:$.data,$==null?void 0:$.name):k.append("attachments",$)}),delete O.data.attachments,k.append("field",JSON.stringify(O))),O=k}else if(be(this,Ft)&&(g==null?void 0:g.file)){let k=new FormData;g!=null&&g.file?((b=g.file)!=null&&b.data?k.append("file",(m=g.file)==null?void 0:m.data,(x=g.file)==null?void 0:x.name):k.append("file",g.file),delete O.data.file,k.append("field",JSON.stringify(O))):Array.isArray(g==null?void 0:g.directory)&&(g==null||g.directory.forEach($=>{$!=null&&$.data?k.append("file",$==null?void 0:$.data,$==null?void 0:$.name):k.append("file",$)}),delete O.data.directory,k.append("field",JSON.stringify(O)),O=k),O=k}return O};let v=(g,b)=>W(this,null,function*(){var m,x,O,k,$,_,A,T;if(((m=g==null?void 0:g.error)==null?void 0:m.token)&&be(this,ii)){if(Cn(this,ii,!1),localStorage.getItem("refreshToken")){h==="dev"&&console.log("Token expired or not found: ",(x=g.error)==null?void 0:x.token," Trying to request a new refresh token");let C=yield(k=(O=this==null?void 0:this.init(o))==null?void 0:O.auth())==null?void 0:k.req(Xl.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(C!=null&&C.error)return h==="dev"&&console.log("Refresh token expired or not found: ",C),be(this,Bi)&&(window.top.location.href=be(this,Bi)),C;if(C!=null&&C.data&&(h==="dev"&&console.log("We got a new refresh token ,",C==null?void 0:C.data),($=C==null?void 0:C.data)!=null&&$.token&&localStorage.setItem("accessToken",(_=C==null?void 0:C.data)==null?void 0:_.token),(A=C==null?void 0:C.data)!=null&&A.refreshToken&&localStorage.setItem("refreshToken",(T=C==null?void 0:C.data)==null?void 0:T.refreshToken),h==="dev"&&console.log("Trying to restart your request..."),typeof b=="function"))return yield b()}}else return g});const w=(g,b,m,x=()=>{})=>{const O=be(this,Co);let k=b.version+O+b.base+m;k=k.replace(/\/\//g,"/"),h==="dev"&&console.log("socket listen local path: ",k),g==null||g.on(k,x)},S=(g,b=()=>{})=>{var m;const x=be(this,Co);let O=(d==null?void 0:d.STORAGE)+x+g;O=O.replace(/\/\//g,"/"),h==="dev"&&console.log("emitter listen local path: ",O),(m=be(this,Pa))==null||m.on(O,b)};let R=(g,b,m,x)=>{be(this,Ro)&&(x=x+be(this,Ro));let O={req:k=>(w(g,b,x+Mt.req,$=>{var _,A,T;(!((A=(_=$==null?void 0:$.error)==null?void 0:_.error)!=null&&A.token)&&!((T=$==null?void 0:$.error)!=null&&T.token)||($==null?void 0:$.data))&&typeof k=="function"&&k(Ge(te({},m),{value:$}))}),m),create:k=>(w(g,b,x+Mt.create,$=>{var _,A,T;(!((A=(_=$==null?void 0:$.error)==null?void 0:_.error)!=null&&A.token)&&!((T=$==null?void 0:$.error)!=null&&T.token)||($==null?void 0:$.data))&&typeof k=="function"&&k(Ge(te({},m),{value:$}))}),m),find:k=>(w(g,b,x+Mt.find,$=>{var _,A,T;(!((A=(_=$==null?void 0:$.error)==null?void 0:_.error)!=null&&A.token)&&!((T=$==null?void 0:$.error)!=null&&T.token)||($==null?void 0:$.data))&&typeof k=="function"&&k(Ge(te({},m),{value:$}))}),m),get:k=>(w(g,b,x+Mt.get,$=>{var _,A,T;(!((A=(_=$==null?void 0:$.error)==null?void 0:_.error)!=null&&A.token)&&!((T=$==null?void 0:$.error)!=null&&T.token)||($==null?void 0:$.data))&&typeof k=="function"&&k(Ge(te({},m),{value:$}))}),m),query:k=>(w(g,b,x+Mt.query,$=>{var _,A,T;(!((A=(_=$==null?void 0:$.error)==null?void 0:_.error)!=null&&A.token)&&!((T=$==null?void 0:$.error)!=null&&T.token)||($==null?void 0:$.data))&&typeof k=="function"&&k(Ge(te({},m),{value:$}))}),m),update:k=>(w(g,b,x+Mt.update,$=>{var _,A,T;(!((A=(_=$==null?void 0:$.error)==null?void 0:_.error)!=null&&A.token)&&!((T=$==null?void 0:$.error)!=null&&T.token)||($==null?void 0:$.data))&&typeof k=="function"&&k(Ge(te({},m),{value:$}))}),m),delete:k=>(w(g,b,x+Mt.delete,$=>{var _,A,T;(!((A=(_=$==null?void 0:$.error)==null?void 0:_.error)!=null&&A.token)&&!((T=$==null?void 0:$.error)!=null&&T.token)||($==null?void 0:$.data))&&typeof k=="function"&&k(Ge(te({},m),{value:$}))}),m)};return be(this,Ft)&&(O.upload=k=>(w(g,b,x+Mt.upload,$=>{var _,A,T;(!((A=(_=$==null?void 0:$.error)==null?void 0:_.error)!=null&&A.token)&&!((T=$==null?void 0:$.error)!=null&&T.token)||($==null?void 0:$.data))&&typeof k=="function"&&k(Ge(te({},m),{value:$}))}),m)),O},j=(g,b)=>({create:m=>(S(g+Mt.create,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Ge(te({},b),{value:x}))}),b),find:m=>(S(g+Mt.find,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Ge(te({},b),{value:x}))}),b),get:m=>(S(g+Mt.get,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Ge(te({},b),{value:x}))}),b),query:m=>(S(g+Mt.query,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Ge(te({},b),{value:x}))}),b),update:m=>(S(g+Mt.update,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Ge(te({},b),{value:x}))}),b),delete:m=>(S(g+Mt.delete,x=>{(!(x!=null&&x.error)||(x==null?void 0:x.data))&&typeof m=="function"&&m(Ge(te({},b),{value:x}))}),b)}),N=Ty.init(be(this,Li)),D=(g="",b={},m={},x={},O)=>{g=g.trim(),g.charAt(g.length-1)==="/"&&(g=g.slice(0,-1));let k=(()=>W(this,null,function*(){let $=()=>W(this,null,function*(){return yield N("post",y.AUTH+d.AUTH+Xl.base+g,p(b))}),_=yield $();return be(this,ii)&&(_=yield v(_,()=>W(this,null,function*(){return yield $()}))),typeof O=="function"&&O(Ge(te({},x),{value:_})),_}))();return Ge(te({},x),{val:()=>k})},q=(g,b,m,x={},O={},k)=>{let $=(()=>W(this,null,function*(){let _=()=>W(this,null,function*(){return yield N(g,b,p(m),x)}),A=yield _();return be(this,ii)&&(A=yield v(A,()=>W(this,null,function*(){return yield _()}))),typeof k=="function"&&k(Ge(te({},O),{value:A})),A}))();return Ge(te({},O),{val:()=>$})},P=g=>{let b={},m,[x={},,,]=g;if(g.length===1&&typeof x=="function"&&(m=g[0],x={}),g.length===2&&(typeof g[1]=="object"?b=g[1]:typeof g[1]=="function"&&(m=g[1])),g.length>=3){let[,O,k]=g;typeof O=="object"&&(b=O),m=k}return{data:x,onRequest:b,callback:m}},I=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),B=(g,b,m={},x,O)=>{b=b.replace(/\/\//g,"/");let k=(()=>W(this,null,function*(){var $,_,A,T,C,L,V,K,G,ie,ee,fe,de,ne,ce,Me,ve,Vt,Ce,Xe,oo,so,ao;let co="/transaction",we,lo,ot={error:{message:"We could not execute the "+g+" method for path: "+b}};switch(g){case"create":yield(A=(_=($=be(this,qt))==null?void 0:$.ref(b))==null?void 0:_.set(m))==null?void 0:A.catch(Ye=>ot);break;case"update":yield(L=(C=(T=be(this,qt))==null?void 0:T.ref(b))==null?void 0:C.update(m))==null?void 0:L.catch(Ye=>ot);break;case"query":let je=(V=be(this,qt))==null?void 0:V.query(b);Array.isArray(m==null?void 0:m.where)&&(yield Promise.all(m==null?void 0:m.where.map(Ye=>W(this,null,function*(){return yield new Promise(ln=>{je==null||je.filter(...Ye),ln()})})))),m!=null&&m.take&&(je==null||je.take(m==null?void 0:m.take)),m!=null&&m.skip&&(je==null||je.take(m==null?void 0:m.skip)),m!=null&&m.order&&Array.isArray(m==null?void 0:m.order)&&(yield Promise.all(m==null?void 0:m.order.map(Ye=>W(this,null,function*(){return yield new Promise(ln=>{je==null||je.sort(...Ye),ln()})})))),lo=yield je==null?void 0:je.count(),we=yield(K=je==null?void 0:je.get(te({},m==null?void 0:m.$option)))==null?void 0:K.catch(Ye=>ot);break;case"delete":we=yield(ee=(ie=(G=be(this,qt))==null?void 0:G.ref(b))==null?void 0:ie.get())==null?void 0:ee.catch(Ye=>ot),yield(ne=(de=(fe=be(this,qt))==null?void 0:fe.ref(b))==null?void 0:de.remove())==null?void 0:ne.catch(Ye=>ot);break}if(g!=="delete"&&g!=="query"&&(we=yield(ve=(Me=(ce=be(this,qt))==null?void 0:ce.ref(b))==null?void 0:Me.get(te({},m==null?void 0:m.$option)))==null?void 0:ve.catch(je=>ot)),g==="query"?we.exists()?(we=we==null?void 0:we.getValues(),we={data:we,max:lo,take:m==null?void 0:m.take,skip:m==null?void 0:m.skip}):we=te({},ot):we.exists()?(we=we==null?void 0:we.val(),we={data:we}):we=te({},ot),be(this,oi)&&x.auth().$currentUserId&&!be(this,Lr)&&["create","delete","update"].includes(g)&&we!=null&&we.data){let je=yield(Xe=(Ce=(Vt=be(this,qt))==null?void 0:Vt.ref(co))==null?void 0:Ce.get())==null?void 0:Xe.catch(nl=>ot);je.exists()?je=je.val():je={};let Ye,ln=Object.keys(je);switch(ln.length>0?Ye=ln.length+1:Ye=0,g){case"create":g="post";break;case"update":g="put";break;case"delete":g="delete";break}g!=="get"&&(yield(ao=(so=(oo=be(this,qt))==null?void 0:oo.ref(co+"/"+Ye))==null?void 0:so.set({path:b,method:g,uid:Ye,value:we.data}))==null?void 0:ao.catch(nl=>ot))}const tl=be(this,Co);let Zr=(d==null?void 0:d.STORAGE)+tl+b+"/"+g;return Zr=Zr.replace(/\/\//g,"/"),be(this,Pa).emit(Zr,we),typeof O=="function"&&O(Ge(te({},x),{value:we})),we}))();return Ge(te({},x),{val:()=>k})},U=(g,b)=>{typeof g=="function"&&(b==null||b.on("connect",g))},M=(g,b)=>{var m;let x="%"+g,O=(m=this.init(o))==null?void 0:m.storage();return{private:(k=I())=>O.event(g+k),child:k=>O.event(g+k),push:(k,$)=>{let _=O.event(g);return b==null||b.emit(x,k),typeof $=="function"&&(_==null||_.onValue($)),te(te({},_),O)},onValue:k=>{let $=O.event(g);return b==null||b.on(x,_=>{typeof k=="function"&&k(Ge(te(te({},$),O),{value:_}))}),te(te({},$),O)},onAnyValue:k=>(b==null||b.onAny(($,_)=>{let A=O.event($);typeof k=="function"&&k($,te(te({value:_},A),O))}),te({},O))}},E=(g,b,m)=>Ge(te({},g),{$io:m,connected:()=>m==null?void 0:m.connected,event:x=>M(x,m),ready:x=>U(x,m),ref:(x="")=>g.ref(x,b,m)});return{$connected:be(this,Lr),activity:()=>{let g=this.init(o);return{onStart:b=>(typeof b=="function"&&document.addEventListener("DOMContentLoaded",b),te(te({},g),g.activity())),onCreate:b=>(typeof b=="function"&&(window.onload=b),te(te({},g),g.activity())),onPause:b=>(window.addEventListener("beforeunload",function(m){typeof b=="function"&&b(),m.returnValue="onbeforeunload"}),te(te({},g),g.activity())),onResume:()=>te(te({},g),g.activity()),onLeave:b=>(typeof b=="function"&&(window.onunload=b),te(te({},g),g.activity()))}},socket:{storage:(u=o==null?void 0:o.socket)==null?void 0:u.storage},$randomUID:()=>Ml(),$randomId:()=>I(),$axios:Ty,local:(g={})=>{const b=this.init(o);return delete b.local,delete b.auth().register,delete b.auth().login,{database:(m="/database")=>({ref:(x="/database")=>{let O=this.init(o);return delete O.auth().login,delete O.auth().register,x=x.trim(),x=x.replace(/\/\//g,"/"),m=m+"/"+x,m=m.replace(/\/\//g,"/"),x.charAt(x.length-1)==="/"&&(x=x.slice(0,-1)),{child:(k="")=>{var $,_;return k=k.trim(),k=k.replace(/\/\//g,"/"),k.charAt(k.length-1)==="/"&&(k=k.slice(0,-1)),k.charAt(0)!=="/"&&(k="/"+k),(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x+k)},push:(...k)=>{var $,_;let A=Ml();return!k.length>0?{getKey:()=>A}:(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x+"/"+A).create(k)},create:(...k)=>{var $,_;let A=te(te({},(_=($=O.local(g))==null?void 0:$.database())==null?void 0:_.ref(x)),O),{data:T,callback:C}=P(k);return B(g,"create",m,T,A)},get:(...k)=>{var $,_;let A=te(te({},(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x)),O),{data:T,callback:C}=P(k);return B("get",m,T,A,C)},find:(...k)=>{var $,_;let A=te(te({},(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x)),O),{data:T,callback:C}=P(k);return B("get",m,T,A,C)},query:()=>{},update:(...k)=>{var $,_;let A=te(te({},(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x)),O),{data:T,callback:C}=P(k);return B("update",m,T,A,C)},delete:(...k)=>{var $,_;let A=te(te({},(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x)),O),{data:T,callback:C}=P(k);return B("delete",m,T,A,C)},on:()=>{var k,$;let _=te(te({},($=(k=O.local())==null?void 0:k.database())==null?void 0:$.ref(x)),O);return j(x,_)},onValue:k=>{var $,_,A,T,C,L,V;let K=te(te({},(_=($=O.local())==null?void 0:$.database())==null?void 0:_.ref(x)),O),G=(T=(A=O.local())==null?void 0:A.database())==null?void 0:T.ref(x);return(C=G==null?void 0:G.on())==null||C.create(k),(L=G==null?void 0:G.on())==null||L.update(k),(V=G==null?void 0:G.on())==null||V.delete(k),K}}}}),cache:(m="/cache")=>{var x;let O=this.init(o);return delete O.auth().login,delete O.auth().register,(x=O.local())==null?void 0:x.database(m)},storage:()=>({})}},cron:g=>{},task:g=>{},storage:(g="local",b)=>{var m;switch(Cn(this,oi,!1),Cn(this,Ft,g),g){case"aws":break;case"discord":Cn(this,Io,{token:b==null?void 0:b.token,channelId:b==null?void 0:b.channelId});break}const x=this.init(o);return delete x.storage,delete x.auth().register,delete x.auth().login,E(x,{host:y.STORAGE,version:d.STORAGE,base:ko.base},(m=o==null?void 0:o.socket)==null?void 0:m.storage)},$online:navigator==null?void 0:navigator.onLine,auth:()=>({req:(g,b,m)=>{let x=this.init(o);delete x.auth().login,delete x.auth().register;let O=te(te({},x),x.auth());return D(g+Xl.req,b,null,O,m)}}),syncDatabase:(g=!0)=>{const b=this.init(o);return Cn(this,oi,typeof g=="boolean"?g:!0),b.database()},ref:(g="",b={host:y.STORAGE,version:d.STORAGE,base:ko.base},m=(O=>(O=o==null?void 0:o.socket)==null?void 0:O.database)(),x=!0)=>{g=g.trim(),g=g.replace(/\/\//g,"/"),g.charAt(0)==="/"&&g.length<=1&&(g="/root"),g.charAt(g.length-1)==="/"&&(g=g.slice(0,-1));const O=b.host+b.version+b.base+g;let k=this.init(o);delete k.auth().login,delete k.auth().register,Cn(this,ii,x);let $={push:(..._)=>{let A=Ml();return!_.length>0?{getKey:()=>A}:k.ref(g+"/"+A,b,m).create(_)},private:(_=I())=>k.ref(g+"/ps"+_+"/pe",b,m),setAuthAccess:(_=!0,A=be(this,Bi))=>(Cn(this,Bi,A),k.ref(g,b,m,_)),req:(..._)=>{let A=te(te({},k.ref(g,b,m)),k);if(_.length>=2){let[T="post",C={},L={},V]=_;if(typeof T=="string"&&["post","put","delete","get"].includes(T)){let K=Pt.req;return q(T,O+K,C,L,A,V)}return A}else{let T=_.filter(C=>typeof C=="function");if(T.length>0)T=T[0],typeof T=="function"&&T(A);else return A}},child:(_="")=>(_=_.trim(),_=_.replace(/\/\//g,"/"),_.charAt(_.length-1)==="/"&&(_=_.slice(0,-1)),_.charAt(0)!=="/"&&(_="/"+_),k.ref(g+_,b,m)),set:(..._)=>{var A;return(A=k.ref(g,b,m))==null?void 0:A.create(..._)},create:(..._)=>{var A;let{data:T,onRequest:C,callback:L}=P(_),V=Pt.create.one;if(be(this,Ft)){if((T==null?void 0:T.file)||(T==null?void 0:T.directory))return(A=k.ref(g))==null?void 0:A.upload(T,null,L);Array.isArray(T.folders)&&(V=Pt.create.many)}else Array!=null&&Array.isArray(T)&&(V=Pt.create.many);return q("post",O+V,T,C,node,L)},find:(..._)=>{var A;h==="dev"&&console.log("Find: We are online");let T=te(te({},k.ref(g,b,m)),k),{data:C,onRequest:L,callback:V}=P(_),K=Pt.find.one;return be(this,Ft)?(Array.isArray(C==null?void 0:C.files)||Array.isArray(C==null?void 0:C.folders))&&(Array.isArray(C==null?void 0:C.files)&&(C.isFolder=!1),Array.isArray(C==null?void 0:C.folders)&&(C.isFolder=!0),K=Pt.find.many):(((A=Object.keys(C))==null?void 0:A.length)<=0||C.order||C.where||C.$option||C.skip||C.take)&&(K=Pt.find.many),q("post",O+K,C,L,T,V)},get:(..._)=>{var A;let T=te(te({},k.ref(g,b,m)),k),{data:C,onRequest:L,callback:V}=P(_),K=Pt.get.one;return be(this,Ft)?(Array.isArray(C==null?void 0:C.files)||Array.isArray(C==null?void 0:C.folders))&&(Array.isArray(C==null?void 0:C.files)&&(C.isFolder=!1),Array.isArray(C==null?void 0:C.folders)&&(C.isFolder=!0),K=Pt.get.many):(((A=Object.keys(C))==null?void 0:A.length)<=0||C.order||C.where||C.$option||C.skip||C.take)&&(K=Pt.get.many),q("get",O+K+"?query="+JSON.stringify(p(C)),null,L,T,V)},query:(..._)=>{var A,T,C;if(k.auth().$currentUserId&&(b==null?void 0:b.host)===(y==null?void 0:y.DATABASE)&&be(this,oi)&&!be(this,Lr))return(C=(T=(A=k.local())==null?void 0:A.database())==null?void 0:T.ref(g))==null?void 0:C.query(..._);{let L=te(te({},k.ref(g,b,m)),k),{data:V,onRequest:K,callback:G}=P(_);return(!V||V==="")&&(V={take:15},!be(this,Ro)&&!V.order&&(V.order={uid:"ASC"})),q("get",O+Pt.get.many+"?query="+JSON.stringify(p(V)),null,K,L,G)}},update:(..._)=>{let A=te(te({},k.ref(g,b,m)),k),{data:T,onRequest:C,callback:L}=P(_),V=Pt.update.one;return be(this,Ft)?(Array.isArray(T==null?void 0:T.files)||Array.isArray(T==null?void 0:T.folders))&&(Array.isArray(T==null?void 0:T.files)&&(T.isFolder=!1),Array.isArray(T==null?void 0:T.folders)&&(T.isFolder=!0),V=Pt.update.many):Array.isArray(T)&&(V=Pt.find.many),q("put",O+V,T,C,A,L)},delete:(..._)=>{var A,T,C;if(k.auth().$currentUserId&&(b==null?void 0:b.host)===(y==null?void 0:y.STORAGE)&&be(this,oi)&&!be(this,Lr))return(C=(T=(A=k.local())==null?void 0:A.database())==null?void 0:T.ref(g))==null?void 0:C.delete(..._);{let L=te(te({},k.ref(g,b,m)),k),{data:V,onRequest:K,callback:G}=P(_),ie=Pt.delete.one;return be(this,Ft)?(Array.isArray(V==null?void 0:V.files)||Array.isArray(V==null?void 0:V.folders))&&(Array.isArray(V==null?void 0:V.files)&&(V.isFolder=!1),Array.isArray(V==null?void 0:V.folders)&&(V.isFolder=!0),Object.keys(V).length<=0&&(V.isFolder=!0),ie=Pt.delete.many):(Array.isArray(V)||V.where)&&(ie=Pt.delete.many),q("delete",O+ie,V,K,L,G)}},on:()=>{let _=te(te({},k.ref(g,b,m)),k);return R(m,b,_,g)},onValue:_=>{var A,T,C,L;let V=te(te({},k.ref(g,b,m)),k),K=k.ref(g,b,m);return(A=K==null?void 0:K.on())==null||A.create(_),(T=K==null?void 0:K.on())==null||T.update(_),(C=K==null?void 0:K.on())==null||C.delete(_),(L=K==null?void 0:K.on())==null||L.upload(_),V}};return be(this,Ft)&&($.download=(..._)=>{let A=te(te({},k.ref(g,b,m)),k),{data:T,onRequest:C,callback:L}=P(_),V=ko.download.one;return(Array.isArray(T==null?void 0:T.files)||Array.isArray(T==null?void 0:T.folders))&&(V=ko.download.many),q("get",O+V+"?query="+JSON.stringify(p(T)),null,C,A,L)},$.upload=(..._)=>{let A=te(te({},k.ref(g,b,m)),k),{data:T,onRequest:C,callback:L}=P(_),V=ko.upload+"?query="+JSON.stringify({storage:be(this,Ft),config:be(this,Io)});return q("post",O+V,T,C,A,L)}),$}}}),Cn(this,Li,e);let{ENV:t,OFFLINE_DB_NAME:r}=be(this,Li);Cn(this,qt,ks.WithIndexedDB((r==null?void 0:r.STORAGE)||"swyger_storage"));let i=()=>W(this,null,function*(){try{let o,s=localStorage.getItem("accessToken");if((()=>{var a;try{o=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let c=MI(s);return(Date==null?void 0:Date.parse((a=new Date((c==null?void 0:c.exp)*1e3))==null?void 0:a.toString()))<Date.now()}catch(c){return!1}})()&&o.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(a){}}catch(o){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}Co=new WeakMap,ii=new WeakMap,Bi=new WeakMap,Ro=new WeakMap,Ft=new WeakMap,kw=new WeakMap,Io=new WeakMap,yh=new WeakMap,Pa=new WeakMap,oi=new WeakMap,Lr=new WeakMap,Li=new WeakMap,qt=new WeakMap;const SB={init:n=>{try{return(e={})=>new AB(n).init(e)}catch(e){return{}}}};let TB={init:n=>{var e,t,r,i,o;return{OFFLINE_DB_NAME:{STORAGE:((e=n==null?void 0:n.OFFLINE_DB_NAME)==null?void 0:e.STORAGE)||"swyger_storage"},ENV:(n==null?void 0:n.ENV)||"prod",HOST_SERVER:{AUTH:((t=n==null?void 0:n.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100",STORAGE:((r=n==null?void 0:n.HOST_SERVER)==null?void 0:r.STORAGE)||"http://localhost:4500"},API_VERSION:{AUTH:((i=n==null?void 0:n.API_VERSION)==null?void 0:i.AUTH)||"/api/v1",STORAGE:((o=n==null?void 0:n.API_VERSION)==null?void 0:o.STORAGE)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(n==null?void 0:n.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(n==null?void 0:n.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const PB={init:n=>{let e=TB.init(n);const t=qI.init(e),r={socket:{storage:t==null?void 0:t.storage}};return SB.init(e)(r)}};var gh=function(n,e){return gh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},gh(n,e)};function mt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");gh(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function jB(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(r.next(u))}catch(h){s(h)}}function c(u){try{l(r.throw(u))}catch(h){s(h)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function af(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function rn(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function He(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return o}function Je(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}function qi(n){return this instanceof qi?(this.v=n,this):new qi(n)}function CB(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(y){r[y]&&(i[y]=function(d){return new Promise(function(f,p){o.push([y,d,f,p])>1||a(y,d)})})}function a(y,d){try{c(r[y](d))}catch(f){h(o[0][3],f)}}function c(y){y.value instanceof qi?Promise.resolve(y.value.v).then(l,u):h(o[0][2],y)}function l(y){a("next",y)}function u(y){a("throw",y)}function h(y,d){y(d),o.shift(),o.length&&a(o[0][0],o[0][1])}}function RB(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof rn=="function"?rn(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=n[o]&&function(s){return new Promise(function(a,c){s=n[o](s),i(a,c,s.done,s.value)})}}function i(o,s,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},s)}}function Pe(n){return typeof n=="function"}function $i(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var ja=$i(function(n){return function(e){n(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(t,r){return r+1+") "+t.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function vr(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var cn=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=rn(s),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(p){e={error:p}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this);var u=this.initialTeardown;if(Pe(u))try{u()}catch(p){o=p instanceof ja?p.errors:[p]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var y=rn(h),d=y.next();!d.done;d=y.next()){var f=d.value;try{Hy(f)}catch(p){o=o!=null?o:[],p instanceof ja?o=Je(Je([],He(o)),He(p.errors)):o.push(p)}}}catch(p){r={error:p}}finally{try{d&&!d.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}}if(o)throw new ja(o)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)Hy(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&vr(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&vr(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),xw=cn.EMPTY;function Ew(n){return n instanceof cn||n&&"closed"in n&&Pe(n.remove)&&Pe(n.add)&&Pe(n.unsubscribe)}function Hy(n){Pe(n)?n():n.unsubscribe()}var Qr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},cf={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=cf.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,Je([n,e],He(t))):setTimeout.apply(void 0,Je([n,e],He(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function _w(n){cf.setTimeout(function(){var e=Qr.onUnhandledError;if(e)e(n);else throw n})}function pt(){}var IB=function(){return lf("C",void 0,void 0)}();function NB(n){return lf("E",void 0,n)}function BB(n){return lf("N",n,void 0)}function lf(n,e,t){return{kind:n,value:e,error:t}}var hi=null;function Ca(n){if(Qr.useDeprecatedSynchronousErrorHandling){var e=!hi;if(e&&(hi={errorThrown:!1,error:null}),n(),e){var t=hi,r=t.errorThrown,i=t.error;if(hi=null,r)throw i}}else n()}function LB(n){Qr.useDeprecatedSynchronousErrorHandling&&hi&&(hi.errorThrown=!0,hi.error=n)}var Wc=function(n){mt(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,Ew(t)&&t.add(r)):r.destination=VB,r}return e.create=function(t,r,i){return new Yi(t,r,i)},e.prototype.next=function(t){this.isStopped?Zl(BB(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?Zl(NB(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?Zl(IB,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(cn),DB=Function.prototype.bind;function Ql(n,e){return DB.call(n,e)}var UB=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){Js(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){Js(r)}else Js(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Js(t)}},n}(),Yi=function(n){mt(e,n);function e(t,r,i){var o=n.call(this)||this,s;if(Pe(t)||!t)s={next:t!=null?t:void 0,error:r!=null?r:void 0,complete:i!=null?i:void 0};else{var a;o&&Qr.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return o.unsubscribe()},s={next:t.next&&Ql(t.next,a),error:t.error&&Ql(t.error,a),complete:t.complete&&Ql(t.complete,a)}):s=t}return o.destination=new UB(s),o}return e}(Wc);function Js(n){Qr.useDeprecatedSynchronousErrorHandling?LB(n):_w(n)}function qB(n){throw n}function Zl(n,e){var t=Qr.onStoppedNotification;t&&cf.setTimeout(function(){return t(n,e)})}var VB={closed:!0,next:pt,error:qB,complete:pt},zc=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Tt(n){return n}function uf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return $w(n)}function $w(n){return n.length===0?Tt:n.length===1?n[0]:function(e){return n.reduce(function(t,r){return r(t)},e)}}var De=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var i=this,o=FB(e)?e:new Yi(e,t,r);return Ca(function(){var s=i,a=s.operator,c=s.source;o.add(a?a.call(o,c):c?i._subscribe(o):i._trySubscribe(o))}),o},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=Jy(t),new t(function(i,o){var s=new Yi({next:function(a){try{e(a)}catch(c){o(c),s.unsubscribe()}},error:o,complete:i});r.subscribe(s)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[zc]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $w(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=Jy(e),new e(function(r,i){var o;t.subscribe(function(s){return o=s},function(s){return i(s)},function(){return r(o)})})},n.create=function(e){return new n(e)},n}();function Jy(n){var e;return(e=n!=null?n:Qr.Promise)!==null&&e!==void 0?e:Promise}function MB(n){return n&&Pe(n.next)&&Pe(n.error)&&Pe(n.complete)}function FB(n){return n&&n instanceof Wc||MB(n)&&Ew(n)}function Ow(n){return Pe(n==null?void 0:n.lift)}function me(n){return function(e){if(Ow(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function he(n,e,t,r,i){return new hf(n,e,t,r,i)}var hf=function(n){mt(e,n);function e(t,r,i,o,s,a){var c=n.call(this,t)||this;return c.onFinalize=s,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:n.prototype._next,c._error=o?function(l){try{o(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:n.prototype._error,c._complete=i?function(){try{i()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(Wc);function Aw(){return me(function(n,e){var t=null;n._refCount++;var r=he(e,void 0,void 0,void 0,function(){if(!n||n._refCount<=0||0<--n._refCount){t=null;return}var i=n._connection,o=t;t=null,i&&(!o||i===o)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var Kc=function(n){mt(e,n);function e(t,r){var i=n.call(this)||this;return i.source=t,i.subjectFactory=r,i._subject=null,i._refCount=0,i._connection=null,Ow(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,r=this._connection;if(!r){r=this._connection=new cn;var i=this.getSubject();r.add(this.source.subscribe(he(i,void 0,function(){t._teardown(),i.complete()},function(o){t._teardown(),i.error(o)},function(){return t._teardown()}))),r.closed&&(this._connection=null,r=cn.EMPTY)}return r},e.prototype.refCount=function(){return Aw()(this)},e}(De),Sw={now:function(){return(Sw.delegate||performance).now()},delegate:void 0},ts={schedule:function(n){var e=requestAnimationFrame,t=cancelAnimationFrame,r=e(function(i){t=void 0,n(i)});return new cn(function(){return t==null?void 0:t(r)})},requestAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ts.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,Je([],He(n)))},cancelAnimationFrame:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return cancelAnimationFrame.apply(void 0,Je([],He(n)))},delegate:void 0};function WB(n){return n?Tw(n):zB}function Tw(n){return new De(function(e){var t=n||Sw,r=t.now(),i=0,o=function(){e.closed||(i=ts.requestAnimationFrame(function(s){i=0;var a=t.now();e.next({timestamp:n?a:s,elapsed:a-r}),o()}))};return o(),function(){i&&ts.cancelAnimationFrame(i)}})}var zB=Tw(),Pw=$i(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Et=function(n){mt(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new Yy(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Pw},e.prototype.next=function(t){var r=this;Ca(function(){var i,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=rn(r.currentObservers),a=s.next();!a.done;a=s.next()){var c=a.value;c.next(t)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var r=this;Ca(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var i=r.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;Ca(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?xw:(this.currentObservers=null,a.push(t),new cn(function(){r.currentObservers=null,vr(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r.thrownError,s=r.isStopped;i?t.error(o):s&&t.complete()},e.prototype.asObservable=function(){var t=new De;return t.source=this,t},e.create=function(t,r){return new Yy(t,r)},e}(De),Yy=function(n){mt(e,n);function e(t,r){var i=n.call(this)||this;return i.destination=t,i.source=r,i}return e.prototype.next=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,t)},e.prototype.error=function(t){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&i!==void 0?i:xw},e}(Et),jw=function(n){mt(e,n);function e(t){var r=n.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=n.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,i=t.thrownError,o=t._value;if(r)throw i;return this._throwIfClosed(),o},e.prototype.next=function(t){n.prototype.next.call(this,this._value=t)},e}(Et),Hc={now:function(){return(Hc.delegate||Date).now()},delegate:void 0},df=function(n){mt(e,n);function e(t,r,i){t===void 0&&(t=1/0),r===void 0&&(r=1/0),i===void 0&&(i=Hc);var o=n.call(this)||this;return o._bufferSize=t,o._windowTime=r,o._timestampProvider=i,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=r===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,r),o}return e.prototype.next=function(t){var r=this,i=r.isStopped,o=r._buffer,s=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(o.push(t),!s&&o.push(a.now()+c)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),i=this,o=i._infiniteTimeWindow,s=i._buffer,a=s.slice(),c=0;c<a.length&&!t.closed;c+=o?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,i=t._timestampProvider,o=t._buffer,s=t._infiniteTimeWindow,a=(s?1:2)*r;if(r<1/0&&a<o.length&&o.splice(0,o.length-a),!s){for(var c=i.now(),l=0,u=1;u<o.length&&o[u]<=c;u+=2)l=u;l&&o.splice(0,l+1)}},e}(Et),ff=function(n){mt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var r=this,i=r.hasError,o=r._hasValue,s=r._value,a=r.thrownError,c=r.isStopped,l=r._isComplete;i?t.error(a):(c||l)&&(o&&t.next(s),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,r=t._hasValue,i=t._value,o=t._isComplete;o||(this._isComplete=!0,r&&n.prototype.next.call(this,i),n.prototype.complete.call(this))},e}(Et),KB=function(n){mt(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(cn),mh={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var i=mh.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,Je([n,e],He(t))):setInterval.apply(void 0,Je([n,e],He(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},xs=function(n){mt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(t,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(s,this.id,r),this},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),mh.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&mh.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var i=!1,o;try{this.work(t)}catch(s){i=!0,o=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,i=t.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,vr(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(KB),HB=1,eu,vh={};function Gy(n){return n in vh?(delete vh[n],!0):!1}var Cw={setImmediate:function(n){var e=HB++;return vh[e]=!0,eu||(eu=Promise.resolve()),eu.then(function(){return Gy(e)&&n()}),e},clearImmediate:function(n){Gy(n)}},JB=Cw.setImmediate,YB=Cw.clearImmediate,bh={setImmediate:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=bh.delegate;return((t==null?void 0:t.setImmediate)||JB).apply(void 0,Je([],He(n)))},clearImmediate:function(n){return YB(n)},delegate:void 0},GB=function(n){mt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=bh.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(bh.clearImmediate(r),t._scheduled===r&&(t._scheduled=void 0))},e}(xs),wh=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=Hc.now,n}(),Es=function(n){mt(e,n);function e(t,r){r===void 0&&(r=wh.now);var i=n.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,i){for(;t=r.shift();)t.unsubscribe();throw i}},e}(wh),XB=function(n){mt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(Es),Rw=new XB(GB),QB=Rw,Pn=new Es(xs),pf=Pn,ZB=function(n){mt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.schedule=function(t,r){return r===void 0&&(r=0),r>0?n.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,r){return r>0||this.closed?n.prototype.execute.call(this,t,r):this._execute(t,r)},e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.flush(this),0)},e}(xs),eL=function(n){mt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(Es),Iw=new eL(ZB),tL=Iw,nL=function(n){mt(e,n);function e(t,r){var i=n.call(this,t,r)||this;return i.scheduler=t,i.work=r,i}return e.prototype.requestAsyncId=function(t,r,i){return i===void 0&&(i=0),i!==null&&i>0?n.prototype.requestAsyncId.call(this,t,r,i):(t.actions.push(this),t._scheduled||(t._scheduled=ts.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,r,i){var o;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return n.prototype.recycleAsyncId.call(this,t,r,i);var s=t.actions;r!=null&&((o=s[s.length-1])===null||o===void 0?void 0:o.id)!==r&&(ts.cancelAnimationFrame(r),t._scheduled=void 0)},e}(xs),rL=function(n){mt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var r=this._scheduled;this._scheduled=void 0;var i=this.actions,o;t=t||i.shift();do if(o=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===r&&i.shift());if(this._active=!1,o){for(;(t=i[0])&&t.id===r&&i.shift();)t.unsubscribe();throw o}},e}(Es),Nw=new rL(nL),iL=Nw,oL=function(n){mt(e,n);function e(t,r){t===void 0&&(t=Bw),r===void 0&&(r=1/0);var i=n.call(this,t,function(){return i.frame})||this;return i.maxFrames=r,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,r=t.actions,i=t.maxFrames,o,s;(s=r[0])&&s.delay<=i&&(r.shift(),this.frame=s.delay,!(o=s.execute(s.state,s.delay))););if(o){for(;s=r.shift();)s.unsubscribe();throw o}},e.frameTimeFactor=10,e}(Es),Bw=function(n){mt(e,n);function e(t,r,i){i===void 0&&(i=t.index+=1);var o=n.call(this,t,r)||this;return o.scheduler=t,o.work=r,o.index=i,o.active=!0,o.index=t.index=i,o}return e.prototype.schedule=function(t,r){if(r===void 0&&(r=0),Number.isFinite(r)){if(!this.id)return n.prototype.schedule.call(this,t,r);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,r)}else return cn.EMPTY},e.prototype.requestAsyncId=function(t,r,i){i===void 0&&(i=0),this.delay=t.frame+i;var o=t.actions;return o.push(this),o.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,r,i){},e.prototype._execute=function(t,r){if(this.active===!0)return n.prototype._execute.call(this,t,r)},e.sortActions=function(t,r){return t.delay===r.delay?t.index===r.index?0:t.index>r.index?1:-1:t.delay>r.delay?1:-1},e}(xs),cr=new De(function(n){return n.complete()});function sL(n){return n?aL(n):cr}function aL(n){return new De(function(e){return n.schedule(function(){return e.complete()})})}function Jc(n){return n&&Pe(n.schedule)}function yf(n){return n[n.length-1]}function _s(n){return Pe(yf(n))?n.pop():void 0}function Er(n){return Jc(yf(n))?n.pop():void 0}function Lw(n,e){return typeof yf(n)=="number"?n.pop():e}var gf=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function Dw(n){return Pe(n==null?void 0:n.then)}function Uw(n){return Pe(n[zc])}function qw(n){return Symbol.asyncIterator&&Pe(n==null?void 0:n[Symbol.asyncIterator])}function Vw(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function cL(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Mw=cL();function Fw(n){return Pe(n==null?void 0:n[Mw])}function Ww(n){return CB(this,arguments,function(){var e,t,r,i;return af(this,function(o){switch(o.label){case 0:e=n.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,qi(e.read())];case 3:return t=o.sent(),r=t.value,i=t.done,i?[4,qi(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,qi(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function zw(n){return Pe(n==null?void 0:n.getReader)}function Ee(n){if(n instanceof De)return n;if(n!=null){if(Uw(n))return lL(n);if(gf(n))return uL(n);if(Dw(n))return hL(n);if(qw(n))return Kw(n);if(Fw(n))return dL(n);if(zw(n))return fL(n)}throw Vw(n)}function lL(n){return new De(function(e){var t=n[zc]();if(Pe(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function uL(n){return new De(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function hL(n){return new De(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,_w)})}function dL(n){return new De(function(e){var t,r;try{for(var i=rn(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){t={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()})}function Kw(n){return new De(function(e){pL(n,e).catch(function(t){return e.error(t)})})}function fL(n){return Kw(Ww(n))}function pL(n,e){var t,r,i,o;return jB(this,void 0,void 0,function(){var s,a;return af(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=RB(n),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(s=r.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function on(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(o),!i)return o}function Yc(n,e){return e===void 0&&(e=0),me(function(t,r){t.subscribe(he(r,function(i){return on(r,n,function(){return r.next(i)},e)},function(){return on(r,n,function(){return r.complete()},e)},function(i){return on(r,n,function(){return r.error(i)},e)}))})}function Gc(n,e){return e===void 0&&(e=0),me(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function yL(n,e){return Ee(n).pipe(Gc(e),Yc(e))}function gL(n,e){return Ee(n).pipe(Gc(e),Yc(e))}function mL(n,e){return new De(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function Hw(n,e){return new De(function(t){var r;return on(t,e,function(){r=n[Mw](),on(t,e,function(){var i,o,s;try{i=r.next(),o=i.value,s=i.done}catch(a){t.error(a);return}s?t.complete():t.next(o)},0,!0)}),function(){return Pe(r==null?void 0:r.return)&&r.return()}})}function Jw(n,e){if(!n)throw new Error("Iterable cannot be null");return new De(function(t){on(t,e,function(){var r=n[Symbol.asyncIterator]();on(t,e,function(){r.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function vL(n,e){return Jw(Ww(n),e)}function Yw(n,e){if(n!=null){if(Uw(n))return yL(n,e);if(gf(n))return mL(n,e);if(Dw(n))return gL(n,e);if(qw(n))return Jw(n,e);if(Fw(n))return Hw(n,e);if(zw(n))return vL(n,e)}throw Vw(n)}function _r(n,e){return e?Yw(n,e):Ee(n)}function mf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Er(n);return _r(n,t)}function Gw(n,e){var t=Pe(n)?n:function(){return n},r=function(i){return i.error(t())};return new De(e?function(i){return e.schedule(r,0,i)}:r)}var kh;(function(n){n.NEXT="N",n.ERROR="E",n.COMPLETE="C"})(kh||(kh={}));var Ra=function(){function n(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue=e==="N"}return n.prototype.observe=function(e){return Xw(this,e)},n.prototype.do=function(e,t,r){var i=this,o=i.kind,s=i.value,a=i.error;return o==="N"?e==null?void 0:e(s):o==="E"?t==null?void 0:t(a):r==null?void 0:r()},n.prototype.accept=function(e,t,r){var i;return Pe((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,r)},n.prototype.toObservable=function(){var e=this,t=e.kind,r=e.value,i=e.error,o=t==="N"?mf(r):t==="E"?Gw(function(){return i}):t==="C"?cr:0;if(!o)throw new TypeError("Unexpected notification kind "+t);return o},n.createNext=function(e){return new n("N",e)},n.createError=function(e){return new n("E",void 0,e)},n.createComplete=function(){return n.completeNotification},n.completeNotification=new n("C"),n}();function Xw(n,e){var t,r,i,o=n,s=o.kind,a=o.value,c=o.error;if(typeof s!="string")throw new TypeError('Invalid notification, missing "kind"');s==="N"?(t=e.next)===null||t===void 0||t.call(e,a):s==="E"?(r=e.error)===null||r===void 0||r.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function bL(n){return!!n&&(n instanceof De||Pe(n.lift)&&Pe(n.subscribe))}var Oi=$i(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function wL(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=!1,s;n.subscribe({next:function(a){s=a,o=!0},error:i,complete:function(){o?r(s):t?r(e.defaultValue):i(new Oi)}})})}function kL(n,e){var t=typeof e=="object";return new Promise(function(r,i){var o=new Yi({next:function(s){r(s),o.unsubscribe()},error:i,complete:function(){t?r(e.defaultValue):i(new Oi)}});n.subscribe(o)})}var xh=$i(function(n){return function(){n(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),Qw=$i(function(n){return function(e){n(this),this.name="NotFoundError",this.message=e}}),Zw=$i(function(n){return function(e){n(this),this.name="SequenceError",this.message=e}});function vf(n){return n instanceof Date&&!isNaN(n)}var e1=$i(function(n){return function(e){e===void 0&&(e=null),n(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function t1(n,e){var t=vf(n)?{first:n}:typeof n=="number"?{each:n}:n,r=t.first,i=t.each,o=t.with,s=o===void 0?xL:o,a=t.scheduler,c=a===void 0?e!=null?e:Pn:a,l=t.meta,u=l===void 0?null:l;if(r==null&&i==null)throw new TypeError("No timeout provided.");return me(function(h,y){var d,f,p=null,v=0,w=function(S){f=on(y,c,function(){try{d.unsubscribe(),Ee(s({meta:u,lastValue:p,seen:v})).subscribe(y)}catch(R){y.error(R)}},S)};d=h.subscribe(he(y,function(S){f==null||f.unsubscribe(),v++,y.next(p=S),i>0&&w(i)},void 0,void 0,function(){f!=null&&f.closed||f==null||f.unsubscribe(),p=null})),!v&&w(r!=null?typeof r=="number"?r:+r-c.now():i)})}function xL(n){throw new e1(n)}function Ai(n,e){return me(function(t,r){var i=0;t.subscribe(he(r,function(o){r.next(n.call(e,o,i++))}))})}var EL=Array.isArray;function _L(n,e){return EL(e)?n.apply(void 0,Je([],He(e))):n(e)}function Si(n){return Ai(function(e){return _L(n,e)})}function Xa(n,e,t,r){if(t)if(Jc(t))r=t;else return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return Xa(n,e,r).apply(this,i).pipe(Si(t))};return r?function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return Xa(n,e).apply(this,i).pipe(Gc(r),Yc(r))}:function(){for(var i=this,o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var a=new ff,c=!0;return new De(function(l){var u=a.subscribe(l);if(c){c=!1;var h=!1,y=!1;e.apply(i,Je(Je([],He(o)),[function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];if(n){var p=d.shift();if(p!=null){a.error(p);return}}a.next(1<d.length?d:d[0]),y=!0,h&&a.complete()}])),y&&a.complete(),h=!0}return u})}}function $L(n,e,t){return Xa(!1,n,e,t)}function OL(n,e,t){return Xa(!0,n,e,t)}var AL=Array.isArray,SL=Object.getPrototypeOf,TL=Object.prototype,PL=Object.keys;function n1(n){if(n.length===1){var e=n[0];if(AL(e))return{args:e,keys:null};if(jL(e)){var t=PL(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function jL(n){return n&&typeof n=="object"&&SL(n)===TL}function r1(n,e){return n.reduce(function(t,r,i){return t[r]=e[i],t},{})}function i1(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Er(n),r=_s(n),i=n1(n),o=i.args,s=i.keys;if(o.length===0)return _r([],t);var a=new De(o1(o,t,s?function(c){return r1(s,c)}:Tt));return r?a.pipe(Si(r)):a}function o1(n,e,t){return t===void 0&&(t=Tt),function(r){Xy(e,function(){for(var i=n.length,o=new Array(i),s=i,a=i,c=function(u){Xy(e,function(){var h=_r(n[u],e),y=!1;h.subscribe(he(r,function(d){o[u]=d,y||(y=!0,a--),a||r.next(t(o.slice()))},function(){--s||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function Xy(n,e,t){n?on(t,n,e):e()}function bf(n,e,t,r,i,o,s,a){var c=[],l=0,u=0,h=!1,y=function(){h&&!c.length&&!l&&e.complete()},d=function(p){return l<r?f(p):c.push(p)},f=function(p){o&&e.next(p),l++;var v=!1;Ee(t(p,u++)).subscribe(he(e,function(w){i==null||i(w),o?d(w):e.next(w)},function(){v=!0},void 0,function(){if(v)try{l--;for(var w=function(){var S=c.shift();s?on(e,s,function(){return f(S)}):f(S)};c.length&&l<r;)w();y()}catch(S){e.error(S)}}))};return n.subscribe(he(e,d,function(){h=!0,y()})),function(){a==null||a()}}function Wn(n,e,t){return t===void 0&&(t=1/0),Pe(e)?Wn(function(r,i){return Ai(function(o,s){return e(r,o,i,s)})(Ee(n(r,i)))},t):(typeof e=="number"&&(t=e),me(function(r,i){return bf(r,i,n,t)}))}function Xc(n){return n===void 0&&(n=1/0),Wn(Tt,n)}function wf(){return Xc(1)}function ns(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return wf()(_r(n,Er(n)))}function Qc(n){return new De(function(e){Ee(n()).subscribe(e)})}var CL={connector:function(){return new Et},resetOnDisconnect:!0};function RL(n,e){e===void 0&&(e=CL);var t=null,r=e.connector,i=e.resetOnDisconnect,o=i===void 0?!0:i,s=r(),a=new De(function(c){return s.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=Qc(function(){return n}).subscribe(s),o&&t.add(function(){return s=r()})),t},a}function IL(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=_s(n),r=n1(n),i=r.args,o=r.keys,s=new De(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),u=c,h=c,y=function(f){var p=!1;Ee(i[f]).subscribe(he(a,function(v){p||(p=!0,h--),l[f]=v},function(){return u--},void 0,function(){(!u||!p)&&(h||a.next(o?r1(o,l):l),a.complete())}))},d=0;d<c;d++)y(d)});return t?s.pipe(Si(t)):s}var NL=["addListener","removeListener"],BL=["addEventListener","removeEventListener"],LL=["on","off"];function Eh(n,e,t,r){if(Pe(t)&&(r=t,t=void 0),r)return Eh(n,e,t).pipe(Si(r));var i=He(qL(n)?BL.map(function(a){return function(c){return n[a](e,c,t)}}):DL(n)?NL.map(Qy(n,e)):UL(n)?LL.map(Qy(n,e)):[],2),o=i[0],s=i[1];if(!o&&gf(n))return Wn(function(a){return Eh(a,e,t)})(Ee(n));if(!o)throw new TypeError("Invalid event target");return new De(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return o(c),function(){return s(c)}})}function Qy(n,e){return function(t){return function(r){return n[t](e,r)}}}function DL(n){return Pe(n.addListener)&&Pe(n.removeListener)}function UL(n){return Pe(n.on)&&Pe(n.off)}function qL(n){return Pe(n.addEventListener)&&Pe(n.removeEventListener)}function s1(n,e,t){return t?s1(n,e).pipe(Si(t)):new De(function(r){var i=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return r.next(s.length===1?s[0]:s)},o=n(i);return Pe(e)?function(){return e(i,o)}:void 0})}function VL(n,e,t,r,i){var o,s,a,c;arguments.length===1?(o=n,c=o.initialState,e=o.condition,t=o.iterate,s=o.resultSelector,a=s===void 0?Tt:s,i=o.scheduler):(c=n,!r||Jc(r)?(a=Tt,i=r):a=r);function l(){var u;return af(this,function(h){switch(h.label){case 0:u=c,h.label=1;case 1:return!e||e(u)?[4,a(u)]:[3,4];case 2:h.sent(),h.label=3;case 3:return u=t(u),[3,1];case 4:return[2]}})}return Qc(i?function(){return Hw(l(),i)}:l)}function ML(n,e,t){return Qc(function(){return n()?e:t})}function Ti(n,e,t){n===void 0&&(n=0),t===void 0&&(t=pf);var r=-1;return e!=null&&(Jc(e)?t=e:r=e),new De(function(i){var o=vf(n)?+n-t.now():n;o<0&&(o=0);var s=0;return t.schedule(function(){i.closed||(i.next(s++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function a1(n,e){return n===void 0&&(n=0),e===void 0&&(e=Pn),n<0&&(n=0),Ti(n,n,e)}function FL(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Er(n),r=Lw(n,1/0),i=n;return i.length?i.length===1?Ee(i[0]):Xc(r)(_r(i,t)):cr}var c1=new De(pt);function WL(){return c1}var zL=Array.isArray;function io(n){return n.length===1&&zL(n[0])?n[0]:n}function l1(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=io(n);return new De(function(r){var i=0,o=function(){if(i<t.length){var s=void 0;try{s=Ee(t[i++])}catch(c){o();return}var a=new hf(r,void 0,pt,pt);s.subscribe(a),a.add(o)}else r.complete()};o()})}function KL(n,e){return _r(Object.entries(n),e)}function HL(n,e){return function(t,r){return!n.call(e,t,r)}}function pi(n,e){return me(function(t,r){var i=0;t.subscribe(he(r,function(o){return n.call(e,o,i++)&&r.next(o)}))})}function JL(n,e,t){return[pi(e,t)(Ee(n)),pi(HL(e,t))(Ee(n))]}function YL(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=io(n),n.length===1?Ee(n[0]):new De(u1(n))}function u1(n){return function(e){for(var t=[],r=function(o){t.push(Ee(n[o]).subscribe(he(e,function(s){if(t){for(var a=0;a<t.length;a++)a!==o&&t[a].unsubscribe();t=null}e.next(s)})))},i=0;t&&!e.closed&&i<n.length;i++)r(i)}}function GL(n,e,t){if(e==null&&(e=n,n=0),e<=0)return cr;var r=e+n;return new De(t?function(i){var o=n;return t.schedule(function(){o<r?(i.next(o++),this.schedule()):i.complete()})}:function(i){for(var o=n;o<r&&!i.closed;)i.next(o++);i.complete()})}function XL(n,e){return new De(function(t){var r=n(),i=e(r),o=i?Ee(i):cr;return o.subscribe(t),function(){r&&r.unsubscribe()}})}function kf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=_s(n),r=io(n);return r.length?new De(function(i){var o=r.map(function(){return[]}),s=r.map(function(){return!1});i.add(function(){o=s=null});for(var a=function(l){Ee(r[l]).subscribe(he(i,function(u){if(o[l].push(u),o.every(function(y){return y.length})){var h=o.map(function(y){return y.shift()});i.next(t?t.apply(void 0,Je([],He(h))):h),o.some(function(y,d){return!y.length&&s[d]})&&i.complete()}},function(){s[l]=!0,!o[l].length&&i.complete()}))},c=0;!i.closed&&c<r.length;c++)a(c);return function(){o=s=null}}):cr}function h1(n){return me(function(e,t){var r=!1,i=null,o=null,s=!1,a=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var l=i;i=null,t.next(l)}s&&t.complete()},c=function(){o=null,s&&t.complete()};e.subscribe(he(t,function(l){r=!0,i=l,o||Ee(n(l)).subscribe(o=he(t,a,c))},function(){s=!0,(!r||!o||o.closed)&&t.complete()}))})}function QL(n,e){return e===void 0&&(e=Pn),h1(function(){return Ti(n,e)})}function ZL(n){return me(function(e,t){var r=[];return e.subscribe(he(t,function(i){return r.push(i)},function(){t.next(r),t.complete()})),Ee(n).subscribe(he(t,function(){var i=r;r=[],t.next(i)},pt)),function(){r=null}})}function eD(n,e){return e===void 0&&(e=null),e=e!=null?e:n,me(function(t,r){var i=[],o=0;t.subscribe(he(r,function(s){var a,c,l,u,h=null;o++%e===0&&i.push([]);try{for(var y=rn(i),d=y.next();!d.done;d=y.next()){var f=d.value;f.push(s),n<=f.length&&(h=h!=null?h:[],h.push(f))}}catch(w){a={error:w}}finally{try{d&&!d.done&&(c=y.return)&&c.call(y)}finally{if(a)throw a.error}}if(h)try{for(var p=rn(h),v=p.next();!v.done;v=p.next()){var f=v.value;vr(i,f),r.next(f)}}catch(w){l={error:w}}finally{try{v&&!v.done&&(u=p.return)&&u.call(p)}finally{if(l)throw l.error}}},function(){var s,a;try{for(var c=rn(i),l=c.next();!l.done;l=c.next()){var u=l.value;r.next(u)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}r.complete()},void 0,function(){i=null}))})}function tD(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=Er(r))!==null&&e!==void 0?e:Pn,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return me(function(c,l){var u=[],h=!1,y=function(p){var v=p.buffer,w=p.subs;w.unsubscribe(),vr(u,p),l.next(v),h&&d()},d=function(){if(u){var p=new cn;l.add(p);var v=[],w={buffer:v,subs:p};u.push(w),on(p,o,function(){return y(w)},n)}};s!==null&&s>=0?on(l,o,d,s,!0):h=!0,d();var f=he(l,function(p){var v,w,S=u.slice();try{for(var R=rn(S),j=R.next();!j.done;j=R.next()){var N=j.value,D=N.buffer;D.push(p),a<=D.length&&y(N)}}catch(q){v={error:q}}finally{try{j&&!j.done&&(w=R.return)&&w.call(R)}finally{if(v)throw v.error}}},function(){for(;u!=null&&u.length;)l.next(u.shift().buffer);f==null||f.unsubscribe(),l.complete(),l.unsubscribe()},void 0,function(){return u=null});c.subscribe(f)})}function nD(n,e){return me(function(t,r){var i=[];Ee(n).subscribe(he(r,function(o){var s=[];i.push(s);var a=new cn,c=function(){vr(i,s),r.next(s),a.unsubscribe()};a.add(Ee(e(o)).subscribe(he(r,c,pt)))},pt)),t.subscribe(he(r,function(o){var s,a;try{for(var c=rn(i),l=c.next();!l.done;l=c.next()){var u=l.value;u.push(o)}}catch(h){s={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}},function(){for(;i.length>0;)r.next(i.shift());r.complete()}))})}function rD(n){return me(function(e,t){var r=null,i=null,o=function(){i==null||i.unsubscribe();var s=r;r=[],s&&t.next(s),Ee(n()).subscribe(i=he(t,o,pt))};o(),e.subscribe(he(t,function(s){return r==null?void 0:r.push(s)},function(){r&&t.next(r),t.complete()},void 0,function(){return r=i=null}))})}function d1(n){return me(function(e,t){var r=null,i=!1,o;r=e.subscribe(he(t,void 0,void 0,function(s){o=Ee(n(s,d1(n)(e))),r?(r.unsubscribe(),r=null,o.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,o.subscribe(t))})}function f1(n,e,t,r,i){return function(o,s){var a=t,c=e,l=0;o.subscribe(he(s,function(u){var h=l++;c=a?n(c,u,h):(a=!0,u),r&&s.next(c)},i&&function(){a&&s.next(c),s.complete()}))}}function $s(n,e){return me(f1(n,e,arguments.length>=2,!1,!0))}var iD=function(n,e){return n.push(e),n};function p1(){return me(function(n,e){$s(iD,[])(n).subscribe(e)})}function y1(n,e){return uf(p1(),Wn(function(t){return n(t)}),e?Si(e):Tt)}function g1(n){return y1(i1,n)}var oD=g1;function m1(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=_s(n);return t?uf(m1.apply(void 0,Je([],He(n))),Si(t)):me(function(r,i){o1(Je([r],He(io(n))))(i)})}function sD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return m1.apply(void 0,Je([],He(n)))}function _h(n,e){return Pe(e)?Wn(n,e,1):Wn(n,1)}function aD(n,e){return Pe(e)?_h(function(){return n},e):_h(function(){return n})}function cD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Er(n);return me(function(r,i){wf()(_r(Je([r],He(n)),t)).subscribe(i)})}function lD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return cD.apply(void 0,Je([],He(n)))}function uD(n){return new De(function(e){return n.subscribe(e)})}var hD={connector:function(){return new Et}};function xf(n,e){e===void 0&&(e=hD);var t=e.connector;return me(function(r,i){var o=t();Ee(n(uD(o))).subscribe(i),i.add(r.subscribe(o))})}function dD(n){return $s(function(e,t,r){return!n||n(t,r)?e+1:e},0)}function fD(n){return me(function(e,t){var r=!1,i=null,o=null,s=function(){if(o==null||o.unsubscribe(),o=null,r){r=!1;var a=i;i=null,t.next(a)}};e.subscribe(he(t,function(a){o==null||o.unsubscribe(),r=!0,i=a,o=he(t,s,pt),Ee(n(a)).subscribe(o)},function(){s(),t.complete()},void 0,function(){i=o=null}))})}function pD(n,e){return e===void 0&&(e=Pn),me(function(t,r){var i=null,o=null,s=null,a=function(){if(i){i.unsubscribe(),i=null;var l=o;o=null,r.next(l)}};function c(){var l=s+n,u=e.now();if(u<l){i=this.schedule(void 0,l-u),r.add(i);return}a()}t.subscribe(he(r,function(l){o=l,s=e.now(),i||(i=e.schedule(c,n),r.add(i))},function(){a(),r.complete()},void 0,function(){o=i=null}))})}function Zc(n){return me(function(e,t){var r=!1;e.subscribe(he(t,function(i){r=!0,t.next(i)},function(){r||t.next(n),t.complete()}))})}function rs(n){return n<=0?function(){return cr}:me(function(e,t){var r=0;e.subscribe(he(t,function(i){++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function v1(){return me(function(n,e){n.subscribe(he(e,pt))})}function b1(n){return Ai(function(){return n})}function Ef(n,e){return e?function(t){return ns(e.pipe(rs(1),v1()),t.pipe(Ef(n)))}:Wn(function(t,r){return Ee(n(t,r)).pipe(rs(1),b1(t))})}function yD(n,e){e===void 0&&(e=Pn);var t=Ti(n,e);return Ef(function(){return t})}function gD(){return me(function(n,e){n.subscribe(he(e,function(t){return Xw(t,e)}))})}function mD(n,e){return me(function(t,r){var i=new Set;t.subscribe(he(r,function(o){var s=n?n(o):o;i.has(s)||(i.add(s),r.next(o))})),e&&Ee(e).subscribe(he(r,function(){return i.clear()},pt))})}function w1(n,e){return e===void 0&&(e=Tt),n=n!=null?n:vD,me(function(t,r){var i,o=!0;t.subscribe(he(r,function(s){var a=e(s);(o||!n(i,a))&&(o=!1,i=a,r.next(s))}))})}function vD(n,e){return n===e}function bD(n,e){return w1(function(t,r){return e?e(t[n],r[n]):t[n]===r[n]})}function el(n){return n===void 0&&(n=wD),me(function(e,t){var r=!1;e.subscribe(he(t,function(i){r=!0,t.next(i)},function(){return r?t.complete():t.error(n())}))})}function wD(){return new Oi}function kD(n,e){if(n<0)throw new xh;var t=arguments.length>=2;return function(r){return r.pipe(pi(function(i,o){return o===n}),rs(1),t?Zc(e):el(function(){return new xh}))}}function xD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(t){return ns(t,mf.apply(void 0,Je([],He(n))))}}function ED(n,e){return me(function(t,r){var i=0;t.subscribe(he(r,function(o){n.call(e,o,i++,t)||(r.next(!1),r.complete())},function(){r.next(!0),r.complete()}))})}function _f(n,e){return e?function(t){return t.pipe(_f(function(r,i){return Ee(n(r,i)).pipe(Ai(function(o,s){return e(r,o,i,s)}))}))}:me(function(t,r){var i=0,o=null,s=!1;t.subscribe(he(r,function(a){o||(o=he(r,void 0,function(){o=null,s&&r.complete()}),Ee(n(a,i++)).subscribe(o))},function(){s=!0,!o&&r.complete()}))})}function k1(){return _f(Tt)}var _D=k1;function $D(n,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,me(function(r,i){return bf(r,i,n,e,void 0,!0,t)})}function OD(n){return me(function(e,t){try{e.subscribe(t)}finally{t.add(n)}})}function AD(n,e){return me(x1(n,e,"value"))}function x1(n,e,t){var r=t==="index";return function(i,o){var s=0;i.subscribe(he(o,function(a){var c=s++;n.call(e,a,c,i)&&(o.next(r?c:a),o.complete())},function(){o.next(r?-1:void 0),o.complete()}))}}function SD(n,e){return me(x1(n,e,"index"))}function TD(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?pi(function(i,o){return n(i,o,r)}):Tt,rs(1),t?Zc(e):el(function(){return new Oi}))}}function PD(n,e,t,r){return me(function(i,o){var s;!e||typeof e=="function"?s=e:(t=e.duration,s=e.element,r=e.connector);var a=new Map,c=function(f){a.forEach(f),f(o)},l=function(f){return c(function(p){return p.error(f)})},u=0,h=!1,y=new hf(o,function(f){try{var p=n(f),v=a.get(p);if(!v){a.set(p,v=r?r():new Et);var w=d(p,v);if(o.next(w),t){var S=he(v,function(){v.complete(),S==null||S.unsubscribe()},void 0,void 0,function(){return a.delete(p)});y.add(Ee(t(w)).subscribe(S))}}v.next(s?s(f):f)}catch(R){l(R)}},function(){return c(function(f){return f.complete()})},l,function(){return a.clear()},function(){return h=!0,u===0});i.subscribe(y);function d(f,p){var v=new De(function(w){u++;var S=p.subscribe(w);return function(){S.unsubscribe(),--u===0&&h&&y.unsubscribe()}});return v.key=f,v}})}function jD(){return me(function(n,e){n.subscribe(he(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function E1(n){return n<=0?function(){return cr}:me(function(e,t){var r=[];e.subscribe(he(t,function(i){r.push(i),n<r.length&&r.shift()},function(){var i,o;try{for(var s=rn(r),a=s.next();!a.done;a=s.next()){var c=a.value;t.next(c)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}t.complete()},void 0,function(){r=null}))})}function CD(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?pi(function(i,o){return n(i,o,r)}):Tt,E1(1),t?Zc(e):el(function(){return new Oi}))}}function RD(){return me(function(n,e){n.subscribe(he(e,function(t){e.next(Ra.createNext(t))},function(){e.next(Ra.createComplete()),e.complete()},function(t){e.next(Ra.createError(t)),e.complete()}))})}function ID(n){return $s(Pe(n)?function(e,t){return n(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var ND=Wn;function BD(n,e,t){return t===void 0&&(t=1/0),Pe(e)?Wn(function(){return n},e,t):(typeof e=="number"&&(t=e),Wn(function(){return n},t))}function LD(n,e,t){return t===void 0&&(t=1/0),me(function(r,i){var o=e;return bf(r,i,function(s,a){return n(o,s,a)},t,function(s){o=s},!1,void 0,function(){return o=null})})}function DD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Er(n),r=Lw(n,1/0);return n=io(n),me(function(i,o){Xc(r)(_r(Je([i],He(n)),t)).subscribe(o)})}function UD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return DD.apply(void 0,Je([],He(n)))}function qD(n){return $s(Pe(n)?function(e,t){return n(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function $f(n,e){var t=Pe(n)?n:function(){return n};return Pe(e)?xf(e,{connector:t}):function(r){return new Kc(r,t)}}function VD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=io(n);return function(r){return l1.apply(void 0,Je([r],He(t)))}}function MD(){return me(function(n,e){var t,r=!1;n.subscribe(he(e,function(i){var o=t;t=i,r&&e.next([o,i]),r=!0}))})}function FD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.length;if(t===0)throw new Error("list of properties cannot be empty.");return Ai(function(r){for(var i=r,o=0;o<t;o++){var s=i==null?void 0:i[n[o]];if(typeof s!="undefined")i=s;else return}return i})}function WD(n){return n?function(e){return xf(n)(e)}:function(e){return $f(new Et)(e)}}function zD(n){return function(e){var t=new jw(n);return new Kc(e,function(){return t})}}function KD(){return function(n){var e=new ff;return new Kc(n,function(){return e})}}function HD(n,e,t,r){t&&!Pe(t)&&(r=t);var i=Pe(t)?t:void 0;return function(o){return $f(new df(n,e,r),i)(o)}}function JD(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.length?me(function(t,r){u1(Je([t],He(n)))(r)}):Tt}function YD(n){var e,t=1/0,r;return n!=null&&(typeof n=="object"?(e=n.count,t=e===void 0?1/0:e,r=n.delay):t=n),t<=0?function(){return cr}:me(function(i,o){var s=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,r!=null){var u=typeof r=="number"?Ti(r):Ee(r(s)),h=he(o,function(){h.unsubscribe(),l()});u.subscribe(h)}else l()},l=function(){var u=!1;a=i.subscribe(he(o,void 0,function(){++s<t?a?c():u=!0:o.complete()})),u&&c()};l()})}function GD(n){return me(function(e,t){var r,i=!1,o,s=!1,a=!1,c=function(){return a&&s&&(t.complete(),!0)},l=function(){return o||(o=new Et,Ee(n(o)).subscribe(he(t,function(){r?u():i=!0},function(){s=!0,c()}))),o},u=function(){a=!1,r=e.subscribe(he(t,void 0,function(){a=!0,!c()&&l().next()})),i&&(r.unsubscribe(),r=null,i=!1,u())};u()})}function XD(n){n===void 0&&(n=1/0);var e;n&&typeof n=="object"?e=n:e={count:n};var t=e.count,r=t===void 0?1/0:t,i=e.delay,o=e.resetOnSuccess,s=o===void 0?!1:o;return r<=0?Tt:me(function(a,c){var l=0,u,h=function(){var y=!1;u=a.subscribe(he(c,function(d){s&&(l=0),c.next(d)},void 0,function(d){if(l++<r){var f=function(){u?(u.unsubscribe(),u=null,h()):y=!0};if(i!=null){var p=typeof i=="number"?Ti(i):Ee(i(d,l)),v=he(c,function(){v.unsubscribe(),f()},function(){c.complete()});p.subscribe(v)}else f()}else c.error(d)})),y&&(u.unsubscribe(),u=null,h())};h()})}function QD(n){return me(function(e,t){var r,i=!1,o,s=function(){r=e.subscribe(he(t,void 0,void 0,function(a){o||(o=new Et,Ee(n(o)).subscribe(he(t,function(){return r?s():i=!0}))),o&&o.next(a)})),i&&(r.unsubscribe(),r=null,i=!1,s())};s()})}function _1(n){return me(function(e,t){var r=!1,i=null;e.subscribe(he(t,function(o){r=!0,i=o})),Ee(n).subscribe(he(t,function(){if(r){r=!1;var o=i;i=null,t.next(o)}},pt))})}function ZD(n,e){return e===void 0&&(e=Pn),_1(a1(n,e))}function eU(n,e){return me(f1(n,e,arguments.length>=2,!0))}function tU(n,e){return e===void 0&&(e=function(t,r){return t===r}),me(function(t,r){var i=Zy(),o=Zy(),s=function(c){r.next(c),r.complete()},a=function(c,l){var u=he(r,function(h){var y=l.buffer,d=l.complete;y.length===0?d?s(!1):c.buffer.push(h):!e(h,y.shift())&&s(!1)},function(){c.complete=!0;var h=l.complete,y=l.buffer;h&&s(y.length===0),u==null||u.unsubscribe()});return u};t.subscribe(a(i,o)),Ee(n).subscribe(a(o,i))})}function Zy(){return{buffer:[],complete:!1}}function $1(n){n===void 0&&(n={});var e=n.connector,t=e===void 0?function(){return new Et}:e,r=n.resetOnError,i=r===void 0?!0:r,o=n.resetOnComplete,s=o===void 0?!0:o,a=n.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,h,y,d=0,f=!1,p=!1,v=function(){h==null||h.unsubscribe(),h=void 0},w=function(){v(),u=y=void 0,f=p=!1},S=function(){var R=u;w(),R==null||R.unsubscribe()};return me(function(R,j){d++,!p&&!f&&v();var N=y=y!=null?y:t();j.add(function(){d--,d===0&&!p&&!f&&(h=tu(S,c))}),N.subscribe(j),!u&&d>0&&(u=new Yi({next:function(D){return N.next(D)},error:function(D){p=!0,v(),h=tu(w,i,D),N.error(D)},complete:function(){f=!0,v(),h=tu(w,s),N.complete()}}),Ee(R).subscribe(u))})(l)}}function tu(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];if(e===!0){n();return}if(e!==!1){var i=new Yi({next:function(){i.unsubscribe(),n()}});return Ee(e.apply(void 0,Je([],He(t)))).subscribe(i)}}function nU(n,e,t){var r,i,o,s,a=!1;return n&&typeof n=="object"?(r=n.bufferSize,s=r===void 0?1/0:r,i=n.windowTime,e=i===void 0?1/0:i,o=n.refCount,a=o===void 0?!1:o,t=n.scheduler):s=n!=null?n:1/0,$1({connector:function(){return new df(s,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function rU(n){return me(function(e,t){var r=!1,i,o=!1,s=0;e.subscribe(he(t,function(a){o=!0,(!n||n(a,s++,e))&&(r&&t.error(new Zw("Too many matching values")),r=!0,i=a)},function(){r?(t.next(i),t.complete()):t.error(o?new Qw("No matching values"):new Oi)}))})}function iU(n){return pi(function(e,t){return n<=t})}function oU(n){return n<=0?Tt:me(function(e,t){var r=new Array(n),i=0;return e.subscribe(he(t,function(o){var s=i++;if(s<n)r[s]=o;else{var a=s%n,c=r[a];r[a]=o,t.next(c)}})),function(){r=null}})}function sU(n){return me(function(e,t){var r=!1,i=he(t,function(){i==null||i.unsubscribe(),r=!0},pt);Ee(n).subscribe(i),e.subscribe(he(t,function(o){return r&&t.next(o)}))})}function aU(n){return me(function(e,t){var r=!1,i=0;e.subscribe(he(t,function(o){return(r||(r=!n(o,i++)))&&t.next(o)}))})}function cU(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Er(n);return me(function(r,i){(t?ns(n,r,t):ns(n,r)).subscribe(i)})}function is(n,e){return me(function(t,r){var i=null,o=0,s=!1,a=function(){return s&&!i&&r.complete()};t.subscribe(he(r,function(c){i==null||i.unsubscribe();var l=0,u=o++;Ee(n(c,u)).subscribe(i=he(r,function(h){return r.next(e?e(c,h,u,l++):h)},function(){i=null,a()}))},function(){s=!0,a()}))})}function lU(){return is(Tt)}function uU(n,e){return Pe(e)?is(function(){return n},e):is(function(){return n})}function hU(n,e){return me(function(t,r){var i=e;return is(function(o,s){return n(i,o,s)},function(o,s){return i=s,s})(t).subscribe(r),function(){i=null}})}function dU(n){return me(function(e,t){Ee(n).subscribe(he(t,function(){return t.complete()},pt)),!t.closed&&e.subscribe(t)})}function fU(n,e){return e===void 0&&(e=!1),me(function(t,r){var i=0;t.subscribe(he(r,function(o){var s=n(o,i++);(s||e)&&r.next(o),!s&&r.complete()}))})}function pU(n,e,t){var r=Pe(n)||e||t?{next:n,error:e,complete:t}:n;return r?me(function(i,o){var s;(s=r.subscribe)===null||s===void 0||s.call(r);var a=!0;i.subscribe(he(o,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),o.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),o.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),o.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):Tt}function O1(n,e){return me(function(t,r){var i=e!=null?e:{},o=i.leading,s=o===void 0?!0:o,a=i.trailing,c=a===void 0?!1:a,l=!1,u=null,h=null,y=!1,d=function(){h==null||h.unsubscribe(),h=null,c&&(v(),y&&r.complete())},f=function(){h=null,y&&r.complete()},p=function(w){return h=Ee(n(w)).subscribe(he(r,d,f))},v=function(){if(l){l=!1;var w=u;u=null,r.next(w),!y&&p(w)}};t.subscribe(he(r,function(w){l=!0,u=w,!(h&&!h.closed)&&(s?v():p(w))},function(){y=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function yU(n,e,t){e===void 0&&(e=Pn);var r=Ti(n,e);return O1(function(){return r},t)}function gU(n){return n===void 0&&(n=Pn),me(function(e,t){var r=n.now();e.subscribe(he(t,function(i){var o=n.now(),s=o-r;r=o,t.next(new mU(i,s))}))})}var mU=function(){function n(e,t){this.value=e,this.interval=t}return n}();function vU(n,e,t){var r,i,o;if(t=t!=null?t:pf,vf(n)?r=n:typeof n=="number"&&(i=n),e)o=function(){return e};else throw new TypeError("No observable provided to switch to");if(r==null&&i==null)throw new TypeError("No timeout provided.");return t1({first:r,each:i,scheduler:t,with:o})}function bU(n){return n===void 0&&(n=Hc),Ai(function(e){return{value:e,timestamp:n.now()}})}function wU(n){return me(function(e,t){var r=new Et;t.next(r.asObservable());var i=function(o){r.error(o),t.error(o)};return e.subscribe(he(t,function(o){return r==null?void 0:r.next(o)},function(){r.complete(),t.complete()},i)),Ee(n).subscribe(he(t,function(){r.complete(),t.next(r=new Et)},pt,i)),function(){r==null||r.unsubscribe(),r=null}})}function kU(n,e){e===void 0&&(e=0);var t=e>0?e:n;return me(function(r,i){var o=[new Et],s=[],a=0;i.next(o[0].asObservable()),r.subscribe(he(i,function(c){var l,u;try{for(var h=rn(o),y=h.next();!y.done;y=h.next()){var d=y.value;d.next(c)}}catch(v){l={error:v}}finally{try{y&&!y.done&&(u=h.return)&&u.call(h)}finally{if(l)throw l.error}}var f=a-n+1;if(f>=0&&f%t===0&&o.shift().complete(),++a%t===0){var p=new Et;o.push(p),i.next(p.asObservable())}},function(){for(;o.length>0;)o.shift().complete();i.complete()},function(c){for(;o.length>0;)o.shift().error(c);i.error(c)},function(){s=null,o=null}))})}function xU(n){for(var e,t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=(e=Er(r))!==null&&e!==void 0?e:Pn,s=(t=r[0])!==null&&t!==void 0?t:null,a=r[1]||1/0;return me(function(c,l){var u=[],h=!1,y=function(v){var w=v.window,S=v.subs;w.complete(),S.unsubscribe(),vr(u,v),h&&d()},d=function(){if(u){var v=new cn;l.add(v);var w=new Et,S={window:w,subs:v,seen:0};u.push(S),l.next(w.asObservable()),on(v,o,function(){return y(S)},n)}};s!==null&&s>=0?on(l,o,d,s,!0):h=!0,d();var f=function(v){return u.slice().forEach(v)},p=function(v){f(function(w){var S=w.window;return v(S)}),v(l),l.unsubscribe()};return c.subscribe(he(l,function(v){f(function(w){w.window.next(v),a<=++w.seen&&y(w)})},function(){return p(function(v){return v.complete()})},function(v){return p(function(w){return w.error(v)})})),function(){u=null}})}function EU(n,e){return me(function(t,r){var i=[],o=function(s){for(;0<i.length;)i.shift().error(s);r.error(s)};Ee(n).subscribe(he(r,function(s){var a=new Et;i.push(a);var c=new cn,l=function(){vr(i,a),a.complete(),c.unsubscribe()},u;try{u=Ee(e(s))}catch(h){o(h);return}r.next(a.asObservable()),c.add(u.subscribe(he(r,l,pt,o)))},pt)),t.subscribe(he(r,function(s){var a,c,l=i.slice();try{for(var u=rn(l),h=u.next();!h.done;h=u.next()){var y=h.value;y.next(s)}}catch(d){a={error:d}}finally{try{h&&!h.done&&(c=u.return)&&c.call(u)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();r.complete()},o,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function _U(n){return me(function(e,t){var r,i,o=function(a){r.error(a),t.error(a)},s=function(){i==null||i.unsubscribe(),r==null||r.complete(),r=new Et,t.next(r.asObservable());var a;try{a=Ee(n())}catch(c){o(c);return}a.subscribe(i=he(t,s,s,o))};s(),e.subscribe(he(t,function(a){return r.next(a)},function(){r.complete(),t.complete()},o,function(){i==null||i.unsubscribe(),r=null}))})}function $U(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=_s(n);return me(function(r,i){for(var o=n.length,s=new Array(o),a=n.map(function(){return!1}),c=!1,l=function(h){Ee(n[h]).subscribe(he(i,function(y){s[h]=y,!c&&!a[h]&&(a[h]=!0,(c=a.every(Tt))&&(a=null))},pt))},u=0;u<o;u++)l(u);r.subscribe(he(i,function(h){if(c){var y=Je([h],He(s));i.next(t?t.apply(void 0,Je([],He(y))):y)}}))})}function OU(n){return y1(kf,n)}function AU(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return me(function(t,r){kf.apply(void 0,Je([t],He(n))).subscribe(r)})}function SU(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return AU.apply(void 0,Je([],He(n)))}const TU=Object.freeze(Object.defineProperty({__proto__:null,Observable:De,ConnectableObservable:Kc,observable:zc,animationFrames:WB,Subject:Et,BehaviorSubject:jw,ReplaySubject:df,AsyncSubject:ff,asap:QB,asapScheduler:Rw,async:pf,asyncScheduler:Pn,queue:tL,queueScheduler:Iw,animationFrame:iL,animationFrameScheduler:Nw,VirtualTimeScheduler:oL,VirtualAction:Bw,Scheduler:wh,Subscription:cn,Subscriber:Wc,Notification:Ra,get NotificationKind(){return kh},pipe:uf,noop:pt,identity:Tt,isObservable:bL,lastValueFrom:wL,firstValueFrom:kL,ArgumentOutOfRangeError:xh,EmptyError:Oi,NotFoundError:Qw,ObjectUnsubscribedError:Pw,SequenceError:Zw,TimeoutError:e1,UnsubscriptionError:ja,bindCallback:$L,bindNodeCallback:OL,combineLatest:i1,concat:ns,connectable:RL,defer:Qc,empty:sL,forkJoin:IL,from:_r,fromEvent:Eh,fromEventPattern:s1,generate:VL,iif:ML,interval:a1,merge:FL,never:WL,of:mf,onErrorResumeNext:l1,pairs:KL,partition:JL,race:YL,range:GL,throwError:Gw,timer:Ti,using:XL,zip:kf,scheduled:Yw,EMPTY:cr,NEVER:c1,config:Qr,audit:h1,auditTime:QL,buffer:ZL,bufferCount:eD,bufferTime:tD,bufferToggle:nD,bufferWhen:rD,catchError:d1,combineAll:oD,combineLatestAll:g1,combineLatestWith:sD,concatAll:wf,concatMap:_h,concatMapTo:aD,concatWith:lD,connect:xf,count:dD,debounce:fD,debounceTime:pD,defaultIfEmpty:Zc,delay:yD,delayWhen:Ef,dematerialize:gD,distinct:mD,distinctUntilChanged:w1,distinctUntilKeyChanged:bD,elementAt:kD,endWith:xD,every:ED,exhaust:_D,exhaustAll:k1,exhaustMap:_f,expand:$D,filter:pi,finalize:OD,find:AD,findIndex:SD,first:TD,groupBy:PD,ignoreElements:v1,isEmpty:jD,last:CD,map:Ai,mapTo:b1,materialize:RD,max:ID,mergeAll:Xc,flatMap:ND,mergeMap:Wn,mergeMapTo:BD,mergeScan:LD,mergeWith:UD,min:qD,multicast:$f,observeOn:Yc,onErrorResumeNextWith:VD,pairwise:MD,pluck:FD,publish:WD,publishBehavior:zD,publishLast:KD,publishReplay:HD,raceWith:JD,reduce:$s,repeat:YD,repeatWhen:GD,retry:XD,retryWhen:QD,refCount:Aw,sample:_1,sampleTime:ZD,scan:eU,sequenceEqual:tU,share:$1,shareReplay:nU,single:rU,skip:iU,skipLast:oU,skipUntil:sU,skipWhile:aU,startWith:cU,subscribeOn:Gc,switchAll:lU,switchMap:is,switchMapTo:uU,switchScan:hU,take:rs,takeLast:E1,takeUntil:dU,takeWhile:fU,tap:pU,throttle:O1,throttleTime:yU,throwIfEmpty:el,timeInterval:gU,timeout:t1,timeoutWith:vU,timestamp:bU,toArray:p1,window:wU,windowCount:kU,windowTime:xU,windowToggle:EU,windowWhen:_U,withLatestFrom:$U,zipAll:OU,zipWith:SU},Symbol.toStringTag,{value:"Module"})),PU={init:n=>{const e=u_.init(n),t=HP.init(n),r=PB.init(n);return{auth:e,database:t,storage:r}}};export{PU as default};
//# sourceMappingURL=swyger-client.min.js.map
