var Ic=Object.defineProperty,Pc=Object.defineProperties;var Nc=Object.getOwnPropertyDescriptors;var ks=Object.getOwnPropertySymbols;var Rc=Object.prototype.hasOwnProperty,$c=Object.prototype.propertyIsEnumerable;var Yr=(r,e,t)=>e in r?Ic(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_=(r,e)=>{for(var t in e||(e={}))Rc.call(e,t)&&Yr(r,t,e[t]);if(ks)for(var t of ks(e))$c.call(e,t)&&Yr(r,t,e[t]);return r},q=(r,e)=>Pc(r,Nc(e));var Yn=(r,e,t)=>(Yr(r,typeof e!="symbol"?e+"":e,t),t),Ss=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var j=(r,e,t)=>(Ss(r,e,"read from private field"),t?t.call(r):e.get(r)),re=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},de=(r,e,t,n)=>(Ss(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var $=(r,e,t)=>new Promise((n,i)=>{var s=c=>{try{a(t.next(c))}catch(u){i(u)}},o=c=>{try{a(t.throw(c))}catch(u){i(u)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(s,o);a((t=t.apply(r,e)).next())});const gt=Object.create(null);gt.open="0";gt.close="1";gt.ping="2";gt.pong="3";gt.message="4";gt.upgrade="5";gt.noop="6";const ir=Object.create(null);Object.keys(gt).forEach(r=>{ir[gt[r]]=r});const jc={type:"error",data:"parser error"},Cc=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Bc=typeof ArrayBuffer=="function",Lc=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,xo=({type:r,data:e},t,n)=>Cc&&e instanceof Blob?t?n(e):Ts(e,n):Bc&&(e instanceof ArrayBuffer||Lc(e))?t?n(e):Ts(new Blob([e]),n):n(gt[r]+(e||"")),Ts=(r,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)},Os="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Rn=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let r=0;r<Os.length;r++)Rn[Os.charCodeAt(r)]=r;const Dc=r=>{let e=r.length*.75,t=r.length,n,i=0,s,o,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const u=new ArrayBuffer(e),y=new Uint8Array(u);for(n=0;n<t;n+=4)s=Rn[r.charCodeAt(n)],o=Rn[r.charCodeAt(n+1)],a=Rn[r.charCodeAt(n+2)],c=Rn[r.charCodeAt(n+3)],y[i++]=s<<2|o>>4,y[i++]=(o&15)<<4|a>>2,y[i++]=(a&3)<<6|c&63;return u},Uc=typeof ArrayBuffer=="function",Ao=(r,e)=>{if(typeof r!="string")return{type:"message",data:Eo(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:Fc(r.substring(1),e)}:ir[t]?r.length>1?{type:ir[t],data:r.substring(1)}:{type:ir[t]}:jc},Fc=(r,e)=>{if(Uc){const t=Dc(r);return Eo(t,e)}else return{base64:!0,data:r}},Eo=(r,e)=>{switch(e){case"blob":return r instanceof ArrayBuffer?new Blob([r]):r;case"arraybuffer":default:return r}},ko=String.fromCharCode(30),Mc=(r,e)=>{const t=r.length,n=new Array(t);let i=0;r.forEach((s,o)=>{xo(s,!1,a=>{n[o]=a,++i===t&&e(n.join(ko))})})},Kc=(r,e)=>{const t=r.split(ko),n=[];for(let i=0;i<t.length;i++){const s=Ao(t[i],e);if(n.push(s),s.type==="error")break}return n},So=4;function Se(r){if(r)return Wc(r)}function Wc(r){for(var e in Se.prototype)r[e]=Se.prototype[e];return r}Se.prototype.on=Se.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};Se.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};Se.prototype.off=Se.prototype.removeListener=Se.prototype.removeAllListeners=Se.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+r],this};Se.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};Se.prototype.emitReserved=Se.prototype.emit;Se.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};Se.prototype.hasListeners=function(r){return!!this.listeners(r).length};const it=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function To(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}const zc=it.setTimeout,Vc=it.clearTimeout;function Pr(r,e){e.useNativeTimers?(r.setTimeoutFn=zc.bind(it),r.clearTimeoutFn=Vc.bind(it)):(r.setTimeoutFn=it.setTimeout.bind(it),r.clearTimeoutFn=it.clearTimeout.bind(it))}const Hc=1.33;function Jc(r){return typeof r=="string"?qc(r):Math.ceil((r.byteLength||r.size)*Hc)}function qc(r){let e=0,t=0;for(let n=0,i=r.length;n<i;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}class Yc extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Oo extends Se{constructor(e){super(),this.writable=!1,Pr(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new Yc(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Ao(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const _o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),mi=64,Gc={};let _s=0,Gn=0,Is;function Ps(r){let e="";do e=_o[r%mi]+e,r=Math.floor(r/mi);while(r>0);return e}function Io(){const r=Ps(+new Date);return r!==Is?(_s=0,Is=r):r+"."+Ps(_s++)}for(;Gn<mi;Gn++)Gc[_o[Gn]]=Gn;function Po(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function Qc(r){let e={},t=r.split("&");for(let n=0,i=t.length;n<i;n++){let s=t[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}let No=!1;try{No=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(r){}const Xc=No;function Ro(r){const e=r.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||Xc))return new XMLHttpRequest}catch(t){}if(!e)try{return new it[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function Zc(){}const eu=function(){return new Ro({xdomain:!1}).responseType!=null}();class tu extends Oo{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const n=location.protocol==="https:";let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==n}const t=e&&e.forceBase64;this.supportsBinary=eu&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Kc(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Mc(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Io()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port);const i=Po(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new mt(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}class mt extends Se{constructor(e,t){super(),Pr(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=To(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new Ro(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.opts.extraHeaders[n])}}catch(n){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{t.setRequestHeader("Accept","*/*")}catch(n){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document!="undefined"&&(this.index=mt.requestsCount++,mt.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=Zc,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete mt.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}mt.requestsCount=0;mt.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Ns);else if(typeof addEventListener=="function"){const r="onpagehide"in it?"pagehide":"unload";addEventListener(r,Ns,!1)}}function Ns(){for(let r in mt.requests)mt.requests.hasOwnProperty(r)&&mt.requests[r].abort()}const $o=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),Qn=it.WebSocket||it.MozWebSocket,Rs=!0,nu="arraybuffer",$s=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class ru extends Oo{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=$s?{}:To(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Rs&&!$s?t?new Qn(e,t):new Qn(e):new Qn(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||nu,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;xo(n,this.supportsBinary,s=>{const o={};try{Rs&&this.ws.send(s)}catch(a){}i&&$o(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Io()),this.supportsBinary||(e.b64=1);const i=Po(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}check(){return!!Qn}}const iu={websocket:ru,polling:tu},su=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ou=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function gi(r){const e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let i=su.exec(r||""),s={},o=14;for(;o--;)s[ou[o]]=i[o]||"";return t!=-1&&n!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=au(s,s.path),s.queryKey=cu(s,s.query),s}function au(r,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function cu(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(t[i]=s)}),t}class Lt extends Se{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=gi(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=gi(t.host).host),Pr(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Qc(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=So,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new iu[e](n)}open(){let e;if(this.opts.rememberUpgrade&&Lt.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;Lt.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",g=>{if(!n)if(g.type==="pong"&&g.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Lt.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(y(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const k=new Error("probe error");k.transport=t.name,this.emitReserved("upgradeError",k)}}))};function s(){n||(n=!0,y(),t.close(),t=null)}const o=g=>{const k=new Error("probe error: "+g);k.transport=t.name,s(),this.emitReserved("upgradeError",k)};function a(){o("transport closed")}function c(){o("socket closed")}function u(g){t&&g.name!==t.name&&s()}const y=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",u),t.open()}onOpen(){if(this.readyState="open",Lt.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(t+=Jc(i)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if(typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const s={type:e,data:t,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){Lt.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}Lt.protocol=So;function uu(r,e="",t){let n=r;t=t||typeof location!="undefined"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t!="undefined"?r=t.protocol+"//"+r:r="https://"+r),n=gi(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+e,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}const lu=typeof ArrayBuffer=="function",fu=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,jo=Object.prototype.toString,hu=typeof Blob=="function"||typeof Blob!="undefined"&&jo.call(Blob)==="[object BlobConstructor]",du=typeof File=="function"||typeof File!="undefined"&&jo.call(File)==="[object FileConstructor]";function Mi(r){return lu&&(r instanceof ArrayBuffer||fu(r))||hu&&r instanceof Blob||du&&r instanceof File}function sr(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(sr(r[t]))return!0;return!1}if(Mi(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return sr(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&sr(r[t]))return!0;return!1}function pu(r){const e=[],t=r.data,n=r;return n.data=vi(t,e),n.attachments=e.length,{packet:n,buffers:e}}function vi(r,e){if(!r)return r;if(Mi(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=vi(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=vi(r[n],e));return t}return r}function yu(r,e){return r.data=wi(r.data,e),delete r.attachments,r}function wi(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=wi(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=wi(r[t],e));return r}const mu=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],gu=5;var ue;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(ue||(ue={}));class vu{constructor(e){this.replacer=e}encode(e){return(e.type===ue.EVENT||e.type===ue.ACK)&&sr(e)?this.encodeAsBinary({type:e.type===ue.EVENT?ue.BINARY_EVENT:ue.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===ue.BINARY_EVENT||e.type===ue.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=pu(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}function js(r){return Object.prototype.toString.call(r)==="[object Object]"}class Ki extends Se{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===ue.BINARY_EVENT;n||t.type===ue.BINARY_ACK?(t.type=n?ue.EVENT:ue.ACK,this.reconstructor=new wu(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Mi(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(ue[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===ue.BINARY_EVENT||n.type===ue.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(s,t)}else n.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(Ki.isPayloadValid(n.type,s))n.data=s;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case ue.CONNECT:return js(t);case ue.DISCONNECT:return t===void 0;case ue.CONNECT_ERROR:return typeof t=="string"||js(t);case ue.EVENT:case ue.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&mu.indexOf(t[0])===-1);case ue.ACK:case ue.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class wu{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=yu(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const bu=Object.freeze(Object.defineProperty({__proto__:null,protocol:gu,get PacketType(){return ue},Encoder:vu,Decoder:Ki},Symbol.toStringTag,{value:"Module"}));function ft(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const xu=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Co extends Se{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ft(e,"open",this.onopen.bind(this)),ft(e,"packet",this.onpacket.bind(this)),ft(e,"error",this.onerror.bind(this)),ft(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(xu.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:ue.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,a=t.pop();this._registerAckCallback(o,a),n.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}emitWithAck(e,...t){const n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{t.push((o,a)=>n?o?s(o):i(a):i(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ue.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ue.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ue.EVENT:case ue.BINARY_EVENT:this.onevent(e);break;case ue.ACK:case ue.BINARY_ACK:this.onack(e);break;case ue.DISCONNECT:this.ondisconnect();break;case ue.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:ue.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ue.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function kn(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}kn.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=(Math.floor(e*10)&1)==0?r-t:r+t}return Math.min(r,this.max)|0};kn.prototype.reset=function(){this.attempts=0};kn.prototype.setMin=function(r){this.ms=r};kn.prototype.setMax=function(r){this.max=r};kn.prototype.setJitter=function(r){this.jitter=r};class bi extends Se{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Pr(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new kn({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||bu;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Lt(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=ft(t,"open",function(){n.onopen(),e&&e()}),s=ft(t,"error",o=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",o),e?e(o):n.maybeReconnectOnOpen()});if(this._timeout!==!1){const o=this._timeout;o===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ft(e,"ping",this.onping.bind(this)),ft(e,"data",this.ondata.bind(this)),ft(e,"error",this.onerror.bind(this)),ft(e,"close",this.onclose.bind(this)),ft(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){$o(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Co(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const _n={};function zt(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=uu(r,e.path||"/socket.io"),n=t.source,i=t.id,s=t.path,o=_n[i]&&s in _n[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new bi(n,e):(_n[i]||(_n[i]=new bi(n,e)),c=_n[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(zt,{Manager:bi,Socket:Co,io:zt,connect:zt});const Au={init:({API_KEY:r,HOST_SERVER:e,CURRENT:t,ENV:n,API_VERSION:i})=>{var a,c;let s={};const o=localStorage.getItem("accessToken");try{const u={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return o&&(u.Authorization="Bearer "+o),s.auth=zt(e.AUTH,{extraHeaders:u}),(a=s==null?void 0:s.auth)==null||a.on("connect",()=>{var g,k,E,A,S;n==="dev"&&console.log("Swyger Auth Client JS is connected with Swyger Server!!!");let y=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");y.uid&&(g=s.auth)!=null&&g.id&&(n==="dev"&&console.log("The socket device id is: ",(k=s.auth)==null?void 0:k.id),(A=s==null?void 0:s.auth)==null||A.emit((i==null?void 0:i.AUTH)+"/user/join",{socketId:(E=s.auth)==null?void 0:E.id,currentUserId:y.uid}),(S=s==null?void 0:s.auth)==null||S.on((i==null?void 0:i.AUTH)+"/user/status",I=>{if(y.status!=="online"){let R;I.from===y.uid&&(R=I==null?void 0:I.value),R!=null&&R.status&&(n==="dev"&&console.log("user is online: ",R),y.status=R.status,localStorage.setItem("userInfo",JSON.stringify(y)))}}))}),(c=s==null?void 0:s.auth)==null||c.on("disconnect",y=>{n==="dev"&&console.log("The device is disconnected from Auth server!");let g=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");g.uid&&g.status!=="offline"&&(g.status="offline",localStorage.setItem("userInfo",JSON.stringify(g)))}),s}catch(u){}}};function xi(r){this.message=r}xi.prototype=new Error,xi.prototype.name="InvalidCharacterError";var Cs=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(r){var e=String(r).replace(/=+$/,"");if(e.length%4==1)throw new xi("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,i=0,s=0,o="";n=e.charAt(s++);~n&&(t=i%4?64*t+n:n,i++%4)?o+=String.fromCharCode(255&t>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o};function Eu(r){var e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(Cs(t).replace(/(.)/g,function(n,i){var s=i.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(e)}catch(t){return Cs(e)}}function yr(r){this.message=r}function mr(r,e){if(typeof r!="string")throw new yr("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(Eu(r.split(".")[t]))}catch(n){throw new yr("Invalid token specified: "+n.message)}}yr.prototype=new Error,yr.prototype.name="InvalidTokenError";function Bo(r,e){return function(){return r.apply(e,arguments)}}const{toString:ku}=Object.prototype,{getPrototypeOf:Wi}=Object,Nr=(r=>e=>{const t=ku.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),vt=r=>(r=r.toLowerCase(),e=>Nr(e)===r),Rr=r=>e=>typeof e===r,{isArray:Sn}=Array,$n=Rr("undefined");function Su(r){return r!==null&&!$n(r)&&r.constructor!==null&&!$n(r.constructor)&&st(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const Lo=vt("ArrayBuffer");function Tu(r){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&Lo(r.buffer),e}const Ou=Rr("string"),st=Rr("function"),Do=Rr("number"),$r=r=>r!==null&&typeof r=="object",_u=r=>r===!0||r===!1,or=r=>{if(Nr(r)!=="object")return!1;const e=Wi(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Iu=vt("Date"),Pu=vt("File"),Nu=vt("Blob"),Ru=vt("FileList"),$u=r=>$r(r)&&st(r.pipe),ju=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||st(r.append)&&((e=Nr(r))==="formdata"||e==="object"&&st(r.toString)&&r.toString()==="[object FormData]"))},Cu=vt("URLSearchParams"),Bu=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Wn(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r=="undefined")return;let n,i;if(typeof r!="object"&&(r=[r]),Sn(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{const s=t?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length;let a;for(n=0;n<o;n++)a=s[n],e.call(null,r[a],a,r)}}function Uo(r,e){e=e.toLowerCase();const t=Object.keys(r);let n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}const Fo=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),Mo=r=>!$n(r)&&r!==Fo;function Ai(){const{caseless:r}=Mo(this)&&this||{},e={},t=(n,i)=>{const s=r&&Uo(e,i)||i;or(e[s])&&or(n)?e[s]=Ai(e[s],n):or(n)?e[s]=Ai({},n):Sn(n)?e[s]=n.slice():e[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Wn(arguments[n],t);return e}const Lu=(r,e,t,{allOwnKeys:n}={})=>(Wn(e,(i,s)=>{t&&st(i)?r[s]=Bo(i,t):r[s]=i},{allOwnKeys:n}),r),Du=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Uu=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},Fu=(r,e,t,n)=>{let i,s,o;const a={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!n||n(o,r,e))&&!a[o]&&(e[o]=r[o],a[o]=!0);r=t!==!1&&Wi(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},Mu=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const n=r.indexOf(e,t);return n!==-1&&n===t},Ku=r=>{if(!r)return null;if(Sn(r))return r;let e=r.length;if(!Do(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},Wu=(r=>e=>r&&e instanceof r)(typeof Uint8Array!="undefined"&&Wi(Uint8Array)),zu=(r,e)=>{const n=(r&&r[Symbol.iterator]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},Vu=(r,e)=>{let t;const n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},Hu=vt("HTMLFormElement"),Ju=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),Bs=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),qu=vt("RegExp"),Ko=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),n={};Wn(t,(i,s)=>{e(i,s,r)!==!1&&(n[s]=i)}),Object.defineProperties(r,n)},Yu=r=>{Ko(r,(e,t)=>{if(st(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=r[t];if(!!st(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Gu=(r,e)=>{const t={},n=i=>{i.forEach(s=>{t[s]=!0})};return Sn(r)?n(r):n(String(r).split(e)),t},Qu=()=>{},Xu=(r,e)=>(r=+r,Number.isFinite(r)?r:e),Gr="abcdefghijklmnopqrstuvwxyz",Ls="0123456789",Wo={DIGIT:Ls,ALPHA:Gr,ALPHA_DIGIT:Gr+Gr.toUpperCase()+Ls},Zu=(r=16,e=Wo.ALPHA_DIGIT)=>{let t="";const{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function el(r){return!!(r&&st(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const tl=r=>{const e=new Array(10),t=(n,i)=>{if($r(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;const s=Sn(n)?[]:{};return Wn(n,(o,a)=>{const c=t(o,i+1);!$n(c)&&(s[a]=c)}),e[i]=void 0,s}}return n};return t(r,0)},nl=vt("AsyncFunction"),rl=r=>r&&($r(r)||st(r))&&st(r.then)&&st(r.catch),F={isArray:Sn,isArrayBuffer:Lo,isBuffer:Su,isFormData:ju,isArrayBufferView:Tu,isString:Ou,isNumber:Do,isBoolean:_u,isObject:$r,isPlainObject:or,isUndefined:$n,isDate:Iu,isFile:Pu,isBlob:Nu,isRegExp:qu,isFunction:st,isStream:$u,isURLSearchParams:Cu,isTypedArray:Wu,isFileList:Ru,forEach:Wn,merge:Ai,extend:Lu,trim:Bu,stripBOM:Du,inherits:Uu,toFlatObject:Fu,kindOf:Nr,kindOfTest:vt,endsWith:Mu,toArray:Ku,forEachEntry:zu,matchAll:Vu,isHTMLForm:Hu,hasOwnProperty:Bs,hasOwnProp:Bs,reduceDescriptors:Ko,freezeMethods:Yu,toObjectSet:Gu,toCamelCase:Ju,noop:Qu,toFiniteNumber:Xu,findKey:Uo,global:Fo,isContextDefined:Mo,ALPHABET:Wo,generateString:Zu,isSpecCompliantForm:el,toJSONObject:tl,isAsyncFn:nl,isThenable:rl};function he(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i)}F.inherits(he,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:F.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const zo=he.prototype,Vo={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{Vo[r]={value:r}});Object.defineProperties(he,Vo);Object.defineProperty(zo,"isAxiosError",{value:!0});he.from=(r,e,t,n,i,s)=>{const o=Object.create(zo);return F.toFlatObject(r,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),he.call(o,r.message,e,t,n,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};const il=null;function Ei(r){return F.isPlainObject(r)||F.isArray(r)}function Ho(r){return F.endsWith(r,"[]")?r.slice(0,-2):r}function Ds(r,e,t){return r?r.concat(e).map(function(i,s){return i=Ho(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function sl(r){return F.isArray(r)&&!r.some(Ei)}const ol=F.toFlatObject(F,{},null,function(e){return/^is[A-Z]/.test(e)});function jr(r,e,t){if(!F.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=F.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,I){return!F.isUndefined(I[S])});const n=t.metaTokens,i=t.visitor||y,s=t.dots,o=t.indexes,c=(t.Blob||typeof Blob!="undefined"&&Blob)&&F.isSpecCompliantForm(e);if(!F.isFunction(i))throw new TypeError("visitor must be a function");function u(A){if(A===null)return"";if(F.isDate(A))return A.toISOString();if(!c&&F.isBlob(A))throw new he("Blob is not supported. Use a Buffer instead.");return F.isArrayBuffer(A)||F.isTypedArray(A)?c&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function y(A,S,I){let R=A;if(A&&!I&&typeof A=="object"){if(F.endsWith(S,"{}"))S=n?S:S.slice(0,-2),A=JSON.stringify(A);else if(F.isArray(A)&&sl(A)||(F.isFileList(A)||F.endsWith(S,"[]"))&&(R=F.toArray(A)))return S=Ho(S),R.forEach(function(B,M){!(F.isUndefined(B)||B===null)&&e.append(o===!0?Ds([S],M,s):o===null?S:S+"[]",u(B))}),!1}return Ei(A)?!0:(e.append(Ds(I,S,s),u(A)),!1)}const g=[],k=Object.assign(ol,{defaultVisitor:y,convertValue:u,isVisitable:Ei});function E(A,S){if(!F.isUndefined(A)){if(g.indexOf(A)!==-1)throw Error("Circular reference detected in "+S.join("."));g.push(A),F.forEach(A,function(R,D){(!(F.isUndefined(R)||R===null)&&i.call(e,R,F.isString(D)?D.trim():D,S,k))===!0&&E(R,S?S.concat(D):[D])}),g.pop()}}if(!F.isObject(r))throw new TypeError("data must be an object");return E(r),e}function Us(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function zi(r,e){this._pairs=[],r&&jr(r,this,e)}const Jo=zi.prototype;Jo.append=function(e,t){this._pairs.push([e,t])};Jo.toString=function(e){const t=e?function(n){return e.call(this,n,Us)}:Us;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function al(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function qo(r,e,t){if(!e)return r;const n=t&&t.encode||al,i=t&&t.serialize;let s;if(i?s=i(e,t):s=F.isURLSearchParams(e)?e.toString():new zi(e,t).toString(n),s){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class cl{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){F.forEach(this.handlers,function(n){n!==null&&e(n)})}}const Fs=cl,Yo={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ul=typeof URLSearchParams!="undefined"?URLSearchParams:zi,ll=typeof FormData!="undefined"?FormData:null,fl=typeof Blob!="undefined"?Blob:null,hl=(()=>{let r;return typeof navigator!="undefined"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),dl=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),yt={isBrowser:!0,classes:{URLSearchParams:ul,FormData:ll,Blob:fl},isStandardBrowserEnv:hl,isStandardBrowserWebWorkerEnv:dl,protocols:["http","https","file","blob","url","data"]};function pl(r,e){return jr(r,new yt.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,s){return yt.isNode&&F.isBuffer(t)?(this.append(n,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function yl(r){return F.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ml(r){const e={},t=Object.keys(r);let n;const i=t.length;let s;for(n=0;n<i;n++)s=t[n],e[s]=r[s];return e}function Go(r){function e(t,n,i,s){let o=t[s++];const a=Number.isFinite(+o),c=s>=t.length;return o=!o&&F.isArray(i)?i.length:o,c?(F.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!a):((!i[o]||!F.isObject(i[o]))&&(i[o]=[]),e(t,n,i[o],s)&&F.isArray(i[o])&&(i[o]=ml(i[o])),!a)}if(F.isFormData(r)&&F.isFunction(r.entries)){const t={};return F.forEachEntry(r,(n,i)=>{e(yl(n),i,t,0)}),t}return null}const gl={"Content-Type":void 0};function vl(r,e,t){if(F.isString(r))try{return(e||JSON.parse)(r),F.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}const Cr={transitional:Yo,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=F.isObject(e);if(s&&F.isHTMLForm(e)&&(e=new FormData(e)),F.isFormData(e))return i&&i?JSON.stringify(Go(e)):e;if(F.isArrayBuffer(e)||F.isBuffer(e)||F.isStream(e)||F.isFile(e)||F.isBlob(e))return e;if(F.isArrayBufferView(e))return e.buffer;if(F.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return pl(e,this.formSerializer).toString();if((a=F.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return jr(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),vl(e)):e}],transformResponse:[function(e){const t=this.transitional||Cr.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&F.isString(e)&&(n&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?he.from(a,he.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:yt.classes.FormData,Blob:yt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};F.forEach(["delete","get","head"],function(e){Cr.headers[e]={}});F.forEach(["post","put","patch"],function(e){Cr.headers[e]=F.merge(gl)});const Vi=Cr,wl=F.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),bl=r=>{const e={};let t,n,i;return r&&r.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),n=o.substring(i+1).trim(),!(!t||e[t]&&wl[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},Ms=Symbol("internals");function In(r){return r&&String(r).trim().toLowerCase()}function ar(r){return r===!1||r==null?r:F.isArray(r)?r.map(ar):String(r)}function xl(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}const Al=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Qr(r,e,t,n,i){if(F.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!F.isString(e)){if(F.isString(n))return e.indexOf(n)!==-1;if(F.isRegExp(n))return n.test(e)}}function El(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function kl(r,e){const t=F.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,s,o){return this[n].call(this,e,i,s,o)},configurable:!0})})}class Br{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function s(a,c,u){const y=In(c);if(!y)throw new Error("header name must be a non-empty string");const g=F.findKey(i,y);(!g||i[g]===void 0||u===!0||u===void 0&&i[g]!==!1)&&(i[g||c]=ar(a))}const o=(a,c)=>F.forEach(a,(u,y)=>s(u,y,c));return F.isPlainObject(e)||e instanceof this.constructor?o(e,t):F.isString(e)&&(e=e.trim())&&!Al(e)?o(bl(e),t):e!=null&&s(t,e,n),this}get(e,t){if(e=In(e),e){const n=F.findKey(this,e);if(n){const i=this[n];if(!t)return i;if(t===!0)return xl(i);if(F.isFunction(t))return t.call(this,i,n);if(F.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=In(e),e){const n=F.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||Qr(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let i=!1;function s(o){if(o=In(o),o){const a=F.findKey(n,o);a&&(!t||Qr(n,n[a],a,t))&&(delete n[a],i=!0)}}return F.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const s=t[n];(!e||Qr(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,n={};return F.forEach(this,(i,s)=>{const o=F.findKey(n,s);if(o){t[o]=ar(i),delete t[s];return}const a=e?El(s):String(s).trim();a!==s&&delete t[s],t[a]=ar(i),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return F.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&F.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){const n=(this[Ms]=this[Ms]={accessors:{}}).accessors,i=this.prototype;function s(o){const a=In(o);n[a]||(kl(i,o),n[a]=!0)}return F.isArray(e)?e.forEach(s):s(e),this}}Br.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);F.freezeMethods(Br.prototype);F.freezeMethods(Br);const At=Br;function Xr(r,e){const t=this||Vi,n=e||t,i=At.from(n.headers);let s=n.data;return F.forEach(r,function(a){s=a.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function Qo(r){return!!(r&&r.__CANCEL__)}function zn(r,e,t){he.call(this,r==null?"canceled":r,he.ERR_CANCELED,e,t),this.name="CanceledError"}F.inherits(zn,he,{__CANCEL__:!0});function Sl(r,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new he("Request failed with status code "+t.status,[he.ERR_BAD_REQUEST,he.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const Tl=yt.isStandardBrowserEnv?function(){return{write:function(t,n,i,s,o,a){const c=[];c.push(t+"="+encodeURIComponent(n)),F.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),F.isString(s)&&c.push("path="+s),F.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){const n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function Ol(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function _l(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function Xo(r,e){return r&&!Ol(e)?_l(r,e):e}const Il=yt.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function i(s){let o=s;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(o){const a=F.isString(o)?i(o):o;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}();function Pl(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function Nl(r,e){r=r||10;const t=new Array(r),n=new Array(r);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(c){const u=Date.now(),y=n[s];o||(o=u),t[i]=c,n[i]=u;let g=s,k=0;for(;g!==i;)k+=t[g++],g=g%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),u-o<e)return;const E=y&&u-y;return E?Math.round(k*1e3/E):void 0}}function Ks(r,e){let t=0;const n=Nl(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-t,c=n(a),u=s<=o;t=s;const y={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&u?(o-s)/c:void 0,event:i};y[e?"download":"upload"]=!0,r(y)}}const Rl=typeof XMLHttpRequest!="undefined",$l=Rl&&function(r){return new Promise(function(t,n){let i=r.data;const s=At.from(r.headers).normalize(),o=r.responseType;let a;function c(){r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}F.isFormData(i)&&(yt.isStandardBrowserEnv||yt.isStandardBrowserWebWorkerEnv?s.setContentType(!1):s.setContentType("multipart/form-data;",!1));let u=new XMLHttpRequest;if(r.auth){const E=r.auth.username||"",A=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";s.set("Authorization","Basic "+btoa(E+":"+A))}const y=Xo(r.baseURL,r.url);u.open(r.method.toUpperCase(),qo(y,r.params,r.paramsSerializer),!0),u.timeout=r.timeout;function g(){if(!u)return;const E=At.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),S={data:!o||o==="text"||o==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:E,config:r,request:u};Sl(function(R){t(R),c()},function(R){n(R),c()},S),u=null}if("onloadend"in u?u.onloadend=g:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(g)},u.onabort=function(){!u||(n(new he("Request aborted",he.ECONNABORTED,r,u)),u=null)},u.onerror=function(){n(new he("Network Error",he.ERR_NETWORK,r,u)),u=null},u.ontimeout=function(){let A=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const S=r.transitional||Yo;r.timeoutErrorMessage&&(A=r.timeoutErrorMessage),n(new he(A,S.clarifyTimeoutError?he.ETIMEDOUT:he.ECONNABORTED,r,u)),u=null},yt.isStandardBrowserEnv){const E=(r.withCredentials||Il(y))&&r.xsrfCookieName&&Tl.read(r.xsrfCookieName);E&&s.set(r.xsrfHeaderName,E)}i===void 0&&s.setContentType(null),"setRequestHeader"in u&&F.forEach(s.toJSON(),function(A,S){u.setRequestHeader(S,A)}),F.isUndefined(r.withCredentials)||(u.withCredentials=!!r.withCredentials),o&&o!=="json"&&(u.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&u.addEventListener("progress",Ks(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",Ks(r.onUploadProgress)),(r.cancelToken||r.signal)&&(a=E=>{!u||(n(!E||E.type?new zn(null,r,u):E),u.abort(),u=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const k=Pl(y);if(k&&yt.protocols.indexOf(k)===-1){n(new he("Unsupported protocol "+k+":",he.ERR_BAD_REQUEST,r));return}u.send(i||null)})},cr={http:il,xhr:$l};F.forEach(cr,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch(t){}Object.defineProperty(r,"adapterName",{value:e})}});const jl={getAdapter:r=>{r=F.isArray(r)?r:[r];const{length:e}=r;let t,n;for(let i=0;i<e&&(t=r[i],!(n=F.isString(t)?cr[t.toLowerCase()]:t));i++);if(!n)throw n===!1?new he(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(F.hasOwnProp(cr,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!F.isFunction(n))throw new TypeError("adapter is not a function");return n},adapters:cr};function Zr(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new zn(null,r)}function Ws(r){return Zr(r),r.headers=At.from(r.headers),r.data=Xr.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),jl.getAdapter(r.adapter||Vi.adapter)(r).then(function(n){return Zr(r),n.data=Xr.call(r,r.transformResponse,n),n.headers=At.from(n.headers),n},function(n){return Qo(n)||(Zr(r),n&&n.response&&(n.response.data=Xr.call(r,r.transformResponse,n.response),n.response.headers=At.from(n.response.headers))),Promise.reject(n)})}const zs=r=>r instanceof At?r.toJSON():r;function xn(r,e){e=e||{};const t={};function n(u,y,g){return F.isPlainObject(u)&&F.isPlainObject(y)?F.merge.call({caseless:g},u,y):F.isPlainObject(y)?F.merge({},y):F.isArray(y)?y.slice():y}function i(u,y,g){if(F.isUndefined(y)){if(!F.isUndefined(u))return n(void 0,u,g)}else return n(u,y,g)}function s(u,y){if(!F.isUndefined(y))return n(void 0,y)}function o(u,y){if(F.isUndefined(y)){if(!F.isUndefined(u))return n(void 0,u)}else return n(void 0,y)}function a(u,y,g){if(g in e)return n(u,y);if(g in r)return n(void 0,u)}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(u,y)=>i(zs(u),zs(y),!0)};return F.forEach(Object.keys(Object.assign({},r,e)),function(y){const g=c[y]||i,k=g(r[y],e[y],y);F.isUndefined(k)&&g!==a||(t[y]=k)}),t}const Zo="1.4.0",Hi={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{Hi[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const Vs={};Hi.transitional=function(e,t,n){function i(s,o){return"[Axios v"+Zo+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return(s,o,a)=>{if(e===!1)throw new he(i(o," has been removed"+(t?" in "+t:"")),he.ERR_DEPRECATED);return t&&!Vs[o]&&(Vs[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};function Cl(r,e,t){if(typeof r!="object")throw new he("options must be an object",he.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],o=e[s];if(o){const a=r[s],c=a===void 0||o(a,s,r);if(c!==!0)throw new he("option "+s+" must be "+c,he.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new he("Unknown option "+s,he.ERR_BAD_OPTION)}}const ki={assertOptions:Cl,validators:Hi},$t=ki.validators;class gr{constructor(e){this.defaults=e,this.interceptors={request:new Fs,response:new Fs}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=xn(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;n!==void 0&&ki.assertOptions(n,{silentJSONParsing:$t.transitional($t.boolean),forcedJSONParsing:$t.transitional($t.boolean),clarifyTimeoutError:$t.transitional($t.boolean)},!1),i!=null&&(F.isFunction(i)?t.paramsSerializer={serialize:i}:ki.assertOptions(i,{encode:$t.function,serialize:$t.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o;o=s&&F.merge(s.common,s[t.method]),o&&F.forEach(["delete","get","head","post","put","patch","common"],A=>{delete s[A]}),t.headers=At.concat(o,s);const a=[];let c=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(c=c&&S.synchronous,a.unshift(S.fulfilled,S.rejected))});const u=[];this.interceptors.response.forEach(function(S){u.push(S.fulfilled,S.rejected)});let y,g=0,k;if(!c){const A=[Ws.bind(this),void 0];for(A.unshift.apply(A,a),A.push.apply(A,u),k=A.length,y=Promise.resolve(t);g<k;)y=y.then(A[g++],A[g++]);return y}k=a.length;let E=t;for(g=0;g<k;){const A=a[g++],S=a[g++];try{E=A(E)}catch(I){S.call(this,I);break}}try{y=Ws.call(this,E)}catch(A){return Promise.reject(A)}for(g=0,k=u.length;g<k;)y=y.then(u[g++],u[g++]);return y}getUri(e){e=xn(this.defaults,e);const t=Xo(e.baseURL,e.url);return qo(t,e.params,e.paramsSerializer)}}F.forEach(["delete","get","head","options"],function(e){gr.prototype[e]=function(t,n){return this.request(xn(n||{},{method:e,url:t,data:(n||{}).data}))}});F.forEach(["post","put","patch"],function(e){function t(n){return function(s,o,a){return this.request(xn(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}gr.prototype[e]=t(),gr.prototype[e+"Form"]=t(!0)});const ur=gr;class Ji{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{n.subscribe(a),s=a}).then(i);return o.cancel=function(){n.unsubscribe(s)},o},e(function(s,o,a){n.reason||(n.reason=new zn(s,o,a),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Ji(function(i){e=i}),cancel:e}}}const Bl=Ji;function Ll(r){return function(t){return r.apply(null,t)}}function Dl(r){return F.isObject(r)&&r.isAxiosError===!0}const Si={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Si).forEach(([r,e])=>{Si[e]=r});const Ul=Si;function ea(r){const e=new ur(r),t=Bo(ur.prototype.request,e);return F.extend(t,ur.prototype,e,{allOwnKeys:!0}),F.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return ea(xn(r,i))},t}const _e=ea(Vi);_e.Axios=ur;_e.CanceledError=zn;_e.CancelToken=Bl;_e.isCancel=Qo;_e.VERSION=Zo;_e.toFormData=jr;_e.AxiosError=he;_e.Cancel=_e.CanceledError;_e.all=function(e){return Promise.all(e)};_e.spread=Ll;_e.isAxiosError=Dl;_e.mergeConfig=xn;_e.AxiosHeaders=At;_e.formToJSON=r=>Go(F.isHTMLForm(r)?new FormData(r):r);_e.HttpStatusCode=Ul;_e.default=_e;const qi=_e,Hs={init:({API_KEY:r})=>(...s)=>$(void 0,[...s],function*(e="post",t="/",n={},i={}){var g,k,E,A;const o=localStorage.getItem("accessToken");let a={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};o&&(a.Authorization="Bearer "+o);const c=t;typeof(n==null?void 0:n.get)=="function"&&(n==null?void 0:n.get("file"))&&(a["Content-Type"]="multipart/form-data"),i!=null&&i.headers&&(a=Object.assign(...a,...i.headers),delete i.headers);const u=Object.assign({mode:"cors",method:e,url:c,data:n,headers:a},i);let y={};try{const S=yield qi(u);y.data=((g=S==null?void 0:S.data)==null?void 0:g.data)||(S==null?void 0:S.data),y.data||(y.data={})}catch(S){y.error=((E=(k=S.response)==null?void 0:k.data)==null?void 0:E.error)||((A=S.response)==null?void 0:A.error),y.error||(y.error={})}return y})};let Xn;const Fl=new Uint8Array(16);function Ml(){if(!Xn&&(Xn=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Xn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xn(Fl)}const De=[];for(let r=0;r<256;++r)De.push((r+256).toString(16).slice(1));function Kl(r,e=0){return(De[r[e+0]]+De[r[e+1]]+De[r[e+2]]+De[r[e+3]]+"-"+De[r[e+4]]+De[r[e+5]]+"-"+De[r[e+6]]+De[r[e+7]]+"-"+De[r[e+8]]+De[r[e+9]]+"-"+De[r[e+10]]+De[r[e+11]]+De[r[e+12]]+De[r[e+13]]+De[r[e+14]]+De[r[e+15]]).toLowerCase()}const Wl=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Js={randomUUID:Wl};function Et(r,e,t){if(Js.randomUUID&&!e&&!r)return Js.randomUUID();r=r||{};const n=r.random||(r.rng||Ml)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=n[i];return e}return Kl(n)}var ta={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,u,y){this.fn=c,this.context=u,this.once=y||!1}function s(c,u,y,g,k){if(typeof y!="function")throw new TypeError("The listener must be a function");var E=new i(y,g||c,k),A=t?t+u:u;return c._events[A]?c._events[A].fn?c._events[A]=[c._events[A],E]:c._events[A].push(E):(c._events[A]=E,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],y,g;if(this._eventsCount===0)return u;for(g in y=this._events)e.call(y,g)&&u.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(y)):u},a.prototype.listeners=function(u){var y=t?t+u:u,g=this._events[y];if(!g)return[];if(g.fn)return[g.fn];for(var k=0,E=g.length,A=new Array(E);k<E;k++)A[k]=g[k].fn;return A},a.prototype.listenerCount=function(u){var y=t?t+u:u,g=this._events[y];return g?g.fn?1:g.length:0},a.prototype.emit=function(u,y,g,k,E,A){var S=t?t+u:u;if(!this._events[S])return!1;var I=this._events[S],R=arguments.length,D,B;if(I.fn){switch(I.once&&this.removeListener(u,I.fn,void 0,!0),R){case 1:return I.fn.call(I.context),!0;case 2:return I.fn.call(I.context,y),!0;case 3:return I.fn.call(I.context,y,g),!0;case 4:return I.fn.call(I.context,y,g,k),!0;case 5:return I.fn.call(I.context,y,g,k,E),!0;case 6:return I.fn.call(I.context,y,g,k,E,A),!0}for(B=1,D=new Array(R-1);B<R;B++)D[B-1]=arguments[B];I.fn.apply(I.context,D)}else{var M=I.length,V;for(B=0;B<M;B++)switch(I[B].once&&this.removeListener(u,I[B].fn,void 0,!0),R){case 1:I[B].fn.call(I[B].context);break;case 2:I[B].fn.call(I[B].context,y);break;case 3:I[B].fn.call(I[B].context,y,g);break;case 4:I[B].fn.call(I[B].context,y,g,k);break;default:if(!D)for(V=1,D=new Array(R-1);V<R;V++)D[V-1]=arguments[V];I[B].fn.apply(I[B].context,D)}}return!0},a.prototype.on=function(u,y,g){return s(this,u,y,g,!1)},a.prototype.once=function(u,y,g){return s(this,u,y,g,!0)},a.prototype.removeListener=function(u,y,g,k){var E=t?t+u:u;if(!this._events[E])return this;if(!y)return o(this,E),this;var A=this._events[E];if(A.fn)A.fn===y&&(!k||A.once)&&(!g||A.context===g)&&o(this,E);else{for(var S=0,I=[],R=A.length;S<R;S++)(A[S].fn!==y||k&&!A[S].once||g&&A[S].context!==g)&&I.push(A[S]);I.length?this._events[E]=I.length===1?I[0]:I:o(this,E)}return this},a.prototype.removeAllListeners=function(u){var y;return u?(y=t?t+u:u,this._events[y]&&o(this,y)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(ta);const Yi=ta.exports;function ei(r,e){try{r(e)}catch(t){console.error("Error in subscription callback",t)}}const jt=Symbol("subscriptions"),Ct=Symbol("oneTimeEvents");class An{constructor(){this[jt]=[],this[Ct]=new Map}on(e,t){return this[Ct].has(e)?ei(t,this[Ct].get(e)):(this[jt].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[jt]=this[jt].filter(n=>n.event!==e||t&&n.callback!==t),this}once(e,t){return new Promise(n=>{const i=s=>{n(s),t==null||t(s)};this[Ct].has(e)?ei(i,this[Ct].get(e)):this[jt].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[Ct].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let n=0;n<this[jt].length;n++){const i=this[jt][n];i.event===e&&(ei(i.callback,t),i.once&&(this[jt].splice(n,1),n--))}return this}emitOnce(e,t){if(this[Ct].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[Ct].set(e,t),this.off(e),this}pipe(e,t){this.on(e,n=>{t.emit(e,n)})}pipeOnce(e,t){this.once(e,n=>{t.emitOnce(e,n)})}}function Bt(r){return r=r.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),r.length===0?[]:r.split("/").map(t=>t.startsWith("[")?parseInt(t.slice(1,-1)):t)}class L{static get(e){return new L(e)}static getChildPath(e,t){return L.get(e).child(t).path}static getPathKeys(e){return Bt(e)}constructor(e){typeof e=="string"?this.keys=Bt(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,n,i)=>i===0?`${n}`:typeof n=="string"?`${t}/${n}`:`${t}[${n}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new L(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=Bt(e);t.forEach(n=>{if(typeof n=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(n))throw new Error(`Invalid child key "${n}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(n.length>128)throw new Error(`child key "${n}" for path "${this.path}" is too long. Max key length is 128`);if(n.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new L(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const n=Bt(e),i=Bt(t);let s=0;const o={get length(){return s}};return n.forEach((a,c)=>{const u=i[c];if(a==="*")o[s++]=u;else if(typeof a=="string"&&a[0]==="$"){o[s++]=u,o[a]=u;const y=a.slice(1);typeof o[y]=="undefined"&&(o[y]=u)}}),o}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const n=Bt(e),i=Bt(t),s=n.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let o="";return s.forEach(a=>{typeof a=="number"?o+=`[${a}]`:(o.length>0&&(o+="/"),o+=a)}),o}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const n=Bt(e);let i=0;return n.reduce((o,a)=>typeof a=="string"&&(a==="*"||a.startsWith("$"))?L.getChildPath(o,t[i++]):L.getChildPath(o,a),"")}equals(e){const t=e instanceof L?e:new L(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((n,i)=>{const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isAncestorOf(e){const t=e instanceof L?e:new L(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((n,i)=>{const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isDescendantOf(e){const t=e instanceof L?e:new L(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((n,i)=>{const s=this.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isOnTrailOf(e){const t=e instanceof L?e:new L(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((n,i)=>{if(i>=t.keys.length)return!0;const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isChildOf(e){const t=e instanceof L?e:new L(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof L?e:new L(e);return t.path===""?!1:this.equals(t.parent)}}function ti(r,e,t=!1){if(!r.exists())return null;let n=t?r.previous():r.val();return typeof e=="number"?n[e]:(L.getPathKeys(e).every(i=>(n=n[i],typeof n!="undefined")),n||null)}function ni(r){if(!r.exists())return[];const e=r.val();return e instanceof Array?new Array(e.length).map((t,n)=>n):typeof e=="object"?Object.keys(e):[]}class be{exists(){return!1}constructor(e,t,n=!1,i,s){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>n?!1:t!==null&&typeof t!="undefined",this.context=()=>s||{}}static for(e,t){return new be(e,t)}child(e){const t=ti(this,e,!1),n=ti(this,e,!0);return new be(this.ref.child(e),t,!1,n)}hasChild(e){return ti(this,e)!==null}hasChildren(){return ni(this).length>0}numChildren(){return ni(this).length}forEach(e){const t=this.val(),n=this.previous();return ni(this).every(i=>{const s=new be(this.ref.child(i),t[i],!1,n[i]);return e(s)})}get key(){return this.ref.key}}class lr extends be{constructor(e,t,n){super(e,t,!1,void 0,n),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(n=>{const i=n.target.reduce((o,a)=>o.child(a),this.ref),s=new be(i,n.val,!1,n.prev);return e(s)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],n=t.target.reduce((i,s)=>i.child(s),this.ref);return new be(n,t.val,!1,t.prev)}}class na{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,n)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return n(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:n})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const n=this._internal.activatePromises.shift();e?(n.callback&&n.callback(!0),n.resolve&&n.resolve()):(n.callback&&n.callback(!1,t),n.reject&&n.reject(t))}}}class zl{constructor(e,t,n){this.publish=e,this.start=t,this.cancel=n}}class Vl{constructor(e){const t=[];let n,i;const s="stopped (no more subscribers)";this.subscribe=(g,k)=>{if(typeof g!="function")throw new TypeError("callback must be a function");if(i===s)throw new Error("stream can't be used anymore because all subscribers were stopped");const E={callback:g,activationCallback:function(A,S){k==null||k(A,S),this.subscription._setActivationState(A,S)},subscription:new na(function(){return t.splice(t.indexOf(this),1),o()})};return t.push(E),typeof i!="undefined"&&(i===!0?(k==null||k(!0),E.subscription._setActivationState(!0)):typeof i=="string"&&(k==null||k(!1,i),E.subscription._setActivationState(!1,i))),E.subscription};const o=()=>{let g;return t.length===0&&(g=n==null?void 0:n(),i=s),Promise.resolve(g)};this.unsubscribe=g=>{(g?t.filter(E=>E.callback===g):t).forEach(E=>{const A=t.indexOf(E);t.splice(A,1)}),o()},this.stop=()=>{t.splice(0),o()};const a=g=>(t.forEach(k=>{try{k.callback(g)}catch(E){console.error(`Error running subscriber callback: ${E.message}`)}}),t.length===0&&o(),t.length>0),c=g=>{i=!0,n=g,t.forEach(k=>{var E;(E=k.activationCallback)==null||E.call(k,!0)})},u=g=>{i=g,t.forEach(k=>{var E;(E=k.activationCallback)==null||E.call(k,!1,g||new Error("unknown reason"))}),t.splice(0)},y=new zl(a,c,u);e(y)}}function Gi(r,e){const t="000000000"+r;return t.substr(t.length-e)}const Hl=typeof window=="object"?window:self,Jl=Object.keys(Hl).length;var wo,bo;const ql=(bo=(wo=navigator.mimeTypes)==null?void 0:wo.length)!=null?bo:0,Yl=Gi((ql+navigator.userAgent.length).toString(36)+Jl.toString(36),4);function Gl(){return Yl}let Pn=0;const Qi=4,vr=36,ra=Math.pow(vr,Qi);function qs(){return Gi((Math.random()*ra<<0).toString(vr),Qi)}function Ql(){return Pn=Pn<ra?Pn:0,Pn++,Pn-1}function Xl(r=0){const e="c",t=(new Date().getTime()+r).toString(vr),n=Gi(Ql().toString(vr),Qi),i=Gl(),s=qs()+qs();return e+t+n+i+s}let Ys=0;class Ke{static set timeBias(e){typeof e=="number"&&(Ys=e)}static generate(){return Xl(Ys).slice(1)}}class xe{constructor(e){this.path=e}}const rt={nextTick(r){setTimeout(r,0)}};class wr{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function Zl(r){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,r),new Array(...e)}function ef(r){if((Array.isArray(r)?r.length:r.byteLength)!==8)throw new TypeError("must be 8 bytes");const t=new Uint8Array(r);return new DataView(t.buffer).getFloat64(0)}const Dt={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function tf(r){if(typeof r!="bigint")throw new Error("number must be a bigint");const e=[],t=r<Dt.zero;do{const n=Number(r&Dt.ff);e.push(n),r=r>>Dt.eight}while(r!==(t?-Dt.one:Dt.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function nf(r){const e=r[0]>=128;let t=Dt.zero;for(let n of r)e&&(n=~n&255),t=(t<<Dt.eight)+BigInt(n);return e&&(t=-(t+Dt.one)),t}function rf(r){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(r);if(typeof Buffer=="function"){const e=Buffer.from(r,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<r.length;t++){let n=r.charCodeAt(t);if(n>128){if((n&55296)===55296){const i=r.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const s=n&1023,o=i&1023;n=65536|s<<10|o}if(n<2048){const i=192|n>>6&31,s=128|n&63;e.push(i,s)}else if(n<65536){const i=224|n>>12&15,s=128|n>>6&63,o=128|n&63;e.push(i,s,o)}else if(n<2097152){const i=240|n>>18&7,s=128|n>>12&63,o=128|n>>6&63,a=128|n&63;e.push(i,s,o,a)}else throw new Error(`Cannot convert character ${r.charAt(t)} (code ${n}) to utf-8`)}else e.push(n<128?n:63)}return new Uint8Array(e)}}function ia(r){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(r instanceof Uint8Array)return e.decode(r);const t=Uint8Array.from(r);return e.decode(t)}else if(typeof Buffer=="function"){if(r instanceof Array&&(r=Uint8Array.from(r)),!(r instanceof Buffer)&&"buffer"in r&&r.buffer instanceof ArrayBuffer){const e=r;r=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(r instanceof Buffer))throw new Error("Unsupported buffer argument");return r.toString("utf-8")}else{if(!(r instanceof Uint8Array)&&"buffer"in r&&r.buffer instanceof ArrayBuffer){const e=r;r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(r instanceof Buffer||r instanceof Array||r instanceof Uint8Array){let e="";for(let t=0;t<r.length;t++){let n=r[t];if(n>128)if((n&240)===240){const i=n,s=r[t+1],o=r[t+2],a=r[t+3];n=(i&7)<<18|(s&63)<<12|(o&63)<<6|a&63,t+=3}else if((n&224)===224){const i=n,s=r[t+1],o=r[t+2];n=(i&15)<<12|(s&63)<<6|o&63,t+=2}else if((n&192)===192){const i=n,s=r[t+1];n=(i&31)<<6|s&63,t++}else throw new Error("invalid utf-8 data");if(n>=65536){n^=65536;const i=55296|n>>10,s=56320|n&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(s)}else e+=String.fromCharCode(n)}return e}else throw new Error("Unsupported buffer argument")}}function sf(r,e){const t=new r.constructor(r.length+e.length);return t.set(r),t.set(e,r.length),t}function ht(r,e){var s;if(((s=r==null?void 0:r.constructor)==null?void 0:s.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${r.ref.path}")`);const t=o=>(o!==null&&typeof o=="object"&&typeof o.constructor=="function"&&typeof o.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(o.constructor.name)&&(o=o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)),o);if(r=t(r),typeof r!="object"||r===null||r instanceof Date||r instanceof ArrayBuffer||r instanceof xe||r instanceof RegExp)return r;const n=o=>{if(e.indexOf(o)>=0)throw new ReferenceError("object contains a circular reference");return o=t(o),o===null||o instanceof Date||o instanceof ArrayBuffer||o instanceof xe||o instanceof RegExp||typeof o=="object"&&(e.push(o),o=ht(o,e),e.pop()),o};typeof e=="undefined"&&(e=[r]);const i=r instanceof Array?[]:r instanceof wr?new wr:{};return Object.keys(r).forEach(o=>{const a=r[o];typeof a!="function"&&(i[o]=n(a))}),i}const Wt=r=>typeof r=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(r.constructor.name);function br(r,e){if(r===e)return!0;if(typeof r!=typeof e)return!1;if(typeof r=="object"||typeof e=="object"){if(r===null||e===null)return!1;if(r instanceof xe||e instanceof xe)return r instanceof xe&&e instanceof xe&&r.path===e.path;if(r instanceof Date||e instanceof Date)return r instanceof Date&&e instanceof Date&&r.getTime()===e.getTime();if(r instanceof Array||e instanceof Array)return r instanceof Array&&e instanceof Array&&r.length===e.length&&r.every((i,s)=>br(r[s],e[s]));if(Wt(r)||Wt(e)){if(!Wt(r)||!Wt(e)||r.byteLength===e.byteLength)return!1;const i=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength),s=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((o,a)=>s[a]===o)}const t=Object.keys(r),n=Object.keys(e);return t.length===n.length&&t.every(i=>n.includes(i))&&t.every(i=>br(r[i],e[i]))}return!1}class sa{constructor(e,t,n){this.added=e,this.removed=t,this.changed=n}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(n=>n.key===e);return t?t.change:"identical"}}function Xi(r,e,t=!1){const n=[void 0,null];if(r===e)return"identical";if(n.indexOf(r)>=0&&n.indexOf(e)<0)return"added";if(n.indexOf(r)<0&&n.indexOf(e)>=0)return"removed";if(typeof r!=typeof e)return"changed";if(Wt(r)||Wt(e)){if(!Wt(r)||!Wt(e))return"changed";const i=r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength),s=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===s.byteLength&&i.every((o,a)=>s[a]===o)?"identical":"changed"}else{if(r instanceof Date||e instanceof Date)return r instanceof Date&&e instanceof Date&&r.getTime()===e.getTime()?"identical":"changed";if(r instanceof xe||e instanceof xe)return r instanceof xe&&e instanceof xe&&r.path===e.path?"identical":"changed";if(typeof r=="object"){const i=r instanceof Array,s=g=>{let k=Object.keys(g).filter(E=>!n.includes(g[E]));return i&&(k=k.map(E=>parseInt(E))),k},o=s(r),a=s(e),c=o.filter(g=>!a.includes(g)),u=a.filter(g=>!o.includes(g)),y=a.reduce((g,k)=>{if(o.includes(k)){const E=r[k],A=e[k],S=Xi(E,A);S!=="identical"&&g.push({key:k,change:S})}return g},[]);return u.length===0&&c.length===0&&y.length===0?"identical":new sa(u,c,t?y.sort((g,k)=>g.key<k.key?-1:1):y)}}return"changed"}function oa(r,e,t=!1){const n=(s,o,a,c)=>{switch(o){case"identical":return[];case"changed":return[{target:s,prev:a,val:c}];case"added":return[{target:s,prev:null,val:c}];case"removed":return[{target:s,prev:a,val:null}];default:{let u=[];return o.added.forEach(y=>u.push({target:s.concat(y),prev:null,val:c[y]})),o.removed.forEach(y=>u.push({target:s.concat(y),prev:a[y],val:null})),o.changed.forEach(y=>{const g=n(s.concat(y.key),y.change,a[y.key],c[y.key]);u=u.concat(g)}),u}}},i=Xi(r,e,t);return n([],i,r,e)}function of(r,e,t){return e=e===null?null:e[r],typeof e=="undefined"&&(e=null),t=t===null?null:t[r],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function af(r){rt.nextTick(r)}function aa(){var r;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(r=function(){return this}())!=null?r:Function("return this")()}const ca=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:Zl,bytesToNumber:ef,bigintToBytes:tf,bytesToBigint:nf,encodeString:rf,decodeString:ia,concatTypedArrays:sf,cloneObject:ht,valuesAreEqual:br,ObjectDifferences:sa,compareValues:Xi,getMutations:oa,getChildValues:of,defer:af,getGlobalObject:aa},Symbol.toStringTag,{value:"Module"})),cf="modulepreload",uf=function(r){return"/"+r},Gs={},lf=function(e,t,n){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=uf(s),s in Gs)return;Gs[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!n)for(let y=i.length-1;y>=0;y--){const g=i[y];if(g.href===s&&(!o||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":cf,o||(u.as="script",u.crossOrigin=""),u.href=s,document.head.appendChild(u),o)return new Promise((y,g)=>{u.addEventListener("load",y),u.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};let ua=!1,Vt;$(void 0,null,function*(){const r=aa();if(typeof r.Observable!="undefined"){Vt=r.Observable;return}try{const{Observable:e}=yield lf(()=>Promise.resolve().then(()=>xy),void 0);Vt=e}catch(e){Vt=es}});function Zi(){if(Vt===es&&!ua&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),Vt)return Vt;throw new Error("RxJS Observable could not be loaded. ")}function ff(r){r==="shim"?(Vt=es,ua=!0):Vt=r}class es{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const s={next:o=>{this._subscribers.forEach(a=>{try{a(o)}catch(c){console.error("Error in subscriber callback:",c)}})}};this._cleanup=this._create(s),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class Ze extends Array{static areEqual(e,t){return e.length===t.length&&e.every((n,i)=>t[i]===n)}static isAncestor(e,t){return e.length<t.length&&e.every((n,i)=>t[i]===n)}static isDescendant(e,t){return e.length>t.length&&t.every((n,i)=>e[i]===n)}}const qt=Symbol("isProxy");class hf{static create(e,t){return $(this,null,function*(){var l;e=new dt(e.db,e.path);let n,i=!1,s=t==null?void 0:t.cursor,o;const a=Ke.generate(),c=[],u=new An;u.on("cursor",h=>s=h),u.on("error",h=>{console.error(h.message,h.details)});const y=(h,f)=>{if(h.length===0)return n=f,!0;let w=n;const v=h.slice();for(;v.length>1;){const b=v.shift();if(!(b in w))return!1;w=w[b]}const T=v.shift();return f===null?w instanceof Array?w.splice(T,1):delete w[T]:w[T]=f,!0},g=()=>$(this,null,function*(){!i||(yield m())}),k=e.on("mutations",{syncFallback:g}).subscribe(h=>$(this,null,function*(){var b;if(!i)return;const f=h.context(),w=((b=f.acebase_proxy)==null?void 0:b.id)!==a;if(!w)return;h.val(!1).every(N=>{if(!y(N.target,N.val))return!1;const P=N.target.reduce((C,U)=>C.child(U),e),O=new be(P,N.val,!1,N.prev,h.context());return u.emit("mutation",{snapshot:O,isRemote:w}),!0})?(u.emit("cursor",f.acebase_cursor),X.emit("mutations",{origin:"remote",snap:h})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield m())}));let E=Promise.resolve();const A=[],S=[],I=()=>$(this,null,function*(){const h=[];for(let f=0,w=A[0];f<A.length;f++,w=A[f])S.find(v=>Ze.areEqual(v.target,w.target)||Ze.isAncestor(v.target,w.target))||(A.splice(f,1),f--,h.push(w));h.length!==0&&(h.forEach(f=>{f.value=ht(tt(n,f.target))}),rt.nextTick(()=>{const f={acebase_proxy:{id:a,source:"update"}};h.forEach(v=>{const T=v.target.reduce((N,P)=>N.child(P),e),b=new be(T,v.value,!1,v.previous,f);u.emit("mutation",{snapshot:b,isRemote:!1})});const w=new lr(e,h.map(v=>({target:v.target,val:v.value,prev:v.previous})),f);X.emit("mutations",{origin:"local",snap:w})}),E=h.reduce((f,w,v,T)=>(T.some(b=>Ze.isAncestor(b.target,w.target))||f.push(w),f),[]).reduce((f,w)=>{const v=w.target;if(v.length===0)f.push({ref:e,target:v,value:n,type:"set",previous:w.previous});else{const T=v.slice(0,-1),b=v.slice(-1)[0],N=T.reduce((U,z)=>U.child(z),e),P=f.find(U=>U.ref.path===N.path),O=tt(n,v),C=w.previous;P?(P.value[b]=O,P.previous[b]=C):f.push({ref:N,target:T,value:{[b]:O},type:"update",previous:{[b]:C}})}return f},[]).reduce((f,w)=>$(this,null,function*(){const v={acebase_proxy:{id:a,source:w.type}};yield f,yield w.ref.context(v)[w.type](w.value).catch(T=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:T});const b={acebase_proxy:{id:a,source:"update-rollback"}},N=[];if(w.type==="set"){ri(n,w.target,w.previous);const O=new be(w.ref,w.previous,!1,w.value,b);u.emit("mutation",{snapshot:O,isRemote:!1}),N.push({target:w.target,val:w.previous,prev:w.value})}else Object.keys(w.previous).forEach(O=>{ri(n,w.target.concat(O),w.previous[O]);const C=new be(w.ref.child(O),w.previous[O],!1,w.value[O],b);u.emit("mutation",{snapshot:C,isRemote:!1}),N.push({target:w.target.concat(O),val:w.previous[O],prev:w.value[O]})});N.forEach(O=>{const C=O.target.reduce((z,Q)=>z.child(Q),e),U=new be(C,O.val,!1,O.prev,b);u.emit("mutation",{snapshot:U,isRemote:!1})});const P=new lr(w.ref,N,b);X.emit("mutations",{origin:"local",snap:P})}),w.ref.cursor&&u.emit("cursor",w.ref.cursor)}),E),yield E)});let R=!1;const D=[],B=()=>{let h;const f=new Promise(w=>h=w);return D.push({resolve:h}),f};let M=null;const V=()=>{M||(M=setTimeout(()=>$(this,null,function*(){R=!0,M=null,yield I(),R=!1,D.splice(0).forEach(h=>h.resolve())}),0))},W=h=>{A.find(f=>Ze.areEqual(f.target,h))||A.push({target:h,previous:ht(tt(n,h))}),V()},X=new An,oe=(h,f)=>{const w=b=>b!==null&&typeof b=="object",v=b=>$(this,null,function*(){var ge;const{snap:N,origin:P}=b,O=N.context(),C=((ge=O.acebase_proxy)==null?void 0:ge.id)===a;if(b.origin==="remote"&&C){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const U=N.val(!1).filter(ae=>ae.target.slice(0,h.length).every((ce,pe)=>h[pe]===ce));if(U.length===0)return;let z,Q;const K=U.find(ae=>ae.target.length<=h.length);if(K){const ae=h.slice(K.target.length);z=ae.reduce((ce,pe)=>!w(ce)||!(pe in ce)?null:ce[pe],K.val),Q=ae.reduce((ce,pe)=>!w(ce)||!(pe in ce)?null:ce[pe],K.prev)}else{const ae=tt(n,h);z=ht(ae),Q=ht(z),U.forEach(ce=>{const pe=ce.target.slice(h.length);for(let se=0,we=z,le=Q;se<pe.length;se++){const Ae=se+1===pe.length,ve=pe[se];Ae?(we[ve]=ce.val,we[ve]===null&&delete we[ve],le[ve]=ce.prev,le[ve]===null&&delete le[ve]):(we=we[ve]=ve in we?we[ve]:{},le=le[ve]=ve in le?le[ve]:{})}})}rt.nextTick(()=>{let ae=!0;try{ae=f(Object.freeze(z),Object.freeze(Q),!C,O)!==!1}catch(ce){u.emit("error",{source:P==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:ce})}ae===!1&&T()})});X.on("mutations",v);const T=()=>{X.off("mutations",v),c.splice(c.findIndex(b=>b.stop===T),1)};return c.push({target:h,stop:T}),{stop:T}},ie=(h,f,w)=>{if(h==="write")return W(f);if(h==="onChange")return oe(f,w.callback);if(h==="subscribe"||h==="observe"){const v=b=>{const N=tt(n,f);b.next(N);const P=oe(f,O=>{b.next(O)});return function(){P.stop()}};if(h==="subscribe")return v;const T=Zi();return new T(v)}else if(h==="transaction")return S.some(T=>Ze.areEqual(f,T.target)||Ze.isAncestor(f,T.target)||Ze.isDescendant(f,T.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(T=>$(this,null,function*(){A.some(O=>Ze.areEqual(f,O.target)||Ze.isAncestor(f,O.target))&&(R||V(),yield B());const N={target:f,status:"started",transaction:null};S.push(N),N.transaction={get status(){return N.status},get completed(){return N.status!=="started"},get mutations(){return A.filter(O=>Ze.areEqual(N.target,O.target)||Ze.isAncestor(N.target,O.target))},get hasMutations(){return this.mutations.length>0},commit(){return $(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${N.status}')`);N.status="finished",S.splice(S.indexOf(N),1),R&&(yield B()),V(),yield B()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${N.status}')`);N.status="canceled";const O=[];for(let C=0;C<A.length;C++){const U=A[C];(Ze.areEqual(N.target,U.target)||Ze.isAncestor(N.target,U.target))&&(A.splice(C,1),C--,O.push(U))}O.reverse().forEach(C=>{C.target.length===0?n=C.previous:ri(n,C.target,C.previous)}),S.splice(S.indexOf(N),1)}},T(N.transaction)}))},d=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(d.context().acebase_origin!=="cache"&&u.emit("cursor",(l=e.cursor)!=null?l:null),i=!0,n=d.val(),n===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){n=t.defaultValue;const h={acebase_proxy:{id:a,source:"default"}};yield e.context(h).set(n)}o=la({root:{ref:e,get cache(){return n}},target:[],id:a,flag:ie});const p=()=>{if(o===null)throw new Error("Proxy was destroyed")},m=()=>$(this,null,function*(){p(),A.splice(0);const h=yield e.get({allow_cache:!1}),f=n,w=h.val();n=w;const v=oa(f,w);if(v.length===0)return;const T=h.context();T.acebase_proxy={id:a,source:"reload"},v.forEach(N=>{const P=Ti(e,N.target),O=new be(P,N.val,N.val===null,N.prev,T);u.emit("mutation",{snapshot:O,isRemote:!0})});const b=new lr(e,v,T);X.emit("mutations",{origin:"local",snap:b})});return{destroy(){return $(this,null,function*(){yield E;const h=[k.stop(),...c.map(f=>f.stop())];yield Promise.all(h),["cursor","mutation","error"].forEach(f=>u.off(f)),n=null,o=null})},stop(){this.destroy()},get value(){return p(),o},get hasValue(){return p(),n!==null},set value(h){p(),h!==null&&typeof h=="object"&&h[qt]&&(h=h.valueOf()),W([]),n=h},get ref(){return e},get cursor(){return s},reload:m,onMutation(h){p(),u.off("mutation"),u.on("mutation",({snapshot:f,isRemote:w})=>{try{h(f,w)}catch(v){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:v})}})},onError(h){p(),u.off("error"),u.on("error",f=>{try{h(f)}catch(w){console.error(`Error in dataproxy onError callback: ${w.message}`)}})},on(h,f){u.on(h,f)},off(h,f){u.off(h,f)}}})}}function tt(r,e){let t=r;for(const n of e)t=typeof t=="object"&&t!==null&&n in t?t[n]:null;return t}function ri(r,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const n=e.slice(0,-1).reduce((s,o)=>s[o],r),i=e.slice(-1)[0];t===null||typeof t=="undefined"?n instanceof Array?n.splice(i,1):delete n[i]:n[i]=t}function Ti(r,e){const t=L.get(r.path).childPath(e);return new dt(r.db,t)}function la(r){const e=Ti(r.root.ref,r.target),t=[],n={get(s,o,a){if(s=tt(r.root.cache,r.target),typeof o=="symbol")if(o.toString()===Symbol.iterator.toString())o="values";else return o.toString()===qt.toString()?!0:Reflect.get(s,o,a);if(o==="valueOf")return function(){return s};if(s===null||typeof s!="object")throw new Error(`Cannot read property "${o}" of ${s}. Value of path "/${e.path}" is not an object (anymore)`);s instanceof Array&&typeof o=="string"&&/^[0-9]+$/.test(o)&&(o=parseInt(o));const c=s[o];if(c===null){delete s[o];return}const u=t.find(E=>E.prop===o);if(u){if(u.typeof===typeof c)return u.value;t.splice(t.indexOf(u),1)}const y=E=>{const A=s[E],S=t.find(R=>R.prop===E);if(S){if(S.typeof===typeof A)return S.value;t.splice(t.indexOf(S),1)}if(typeof A!="object")return A;const I=la({root:r.root,target:r.target.concat(E),id:r.id,flag:r.flag});return t.push({typeof:typeof A,prop:E,value:I}),I},g=E=>E!==null&&typeof E=="object"&&E[qt]?E.getTarget():E;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof xe||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const k=s instanceof Array;if(o==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return o==="push"?function(A){const S=e.push();return r.flag("write",r.target.concat(S.key)),s[S.key]=A,S.key}:o==="getTarget"?function(E=!0){return E&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),s}:o==="getRef"?function(){return Ti(r.root.ref,r.target)}:o==="forEach"?function(A){const S=Object.keys(s);let I=!1;for(let R=0;!I&&R<S.length;R++){const D=S[R],B=y(D);I=A(B,D,R)===!1}}:["values","entries","keys"].includes(o)?function*(){const A=Object.keys(s);for(const S of A)if(o==="keys")yield S;else{const I=y(S);o==="entries"?yield[S,I]:yield I}}:o==="toArray"?function(A){const S=Object.keys(s).map(I=>y(I));return A&&S.sort(A),S}:o==="onChanged"?function(A){return r.flag("onChange",r.target,{callback:A})}:o==="subscribe"?function(){return r.flag("subscribe",r.target)}:o==="getObservable"?function(){return r.flag("observe",r.target)}:o==="getOrderedCollection"?function(A,S){return new df(this,A,S)}:o==="startTransaction"?function(){return r.flag("transaction",r.target)}:o==="remove"&&!k?function(){if(r.target.length===0)throw new Error("Can't remove proxy root value");const A=tt(r.root.cache,r.target.slice(0,-1)),S=r.target.slice(-1)[0];r.flag("write",r.target),delete A[S]}:void 0;if(typeof c=="function"){if(k){const E=S=>(r.flag("write",r.target),S()),A=S=>S.map(I=>(I=g(I),Oi(I),I));if(o==="push")return function(...I){return I=A(I),E(()=>s.push(...I))};if(o==="pop")return function(){return E(()=>s.pop())};if(o==="splice")return function(I,R,...D){return D=A(D),E(()=>s.splice(I,R,...D))};if(o==="shift")return function(){return E(()=>s.shift())};if(o==="unshift")return function(...I){return I=A(I),E(()=>s.unshift(...I))};if(o==="sort")return function(I){return E(()=>s.sort(I))};if(o==="reverse")return function(){return E(()=>s.reverse())};if(["indexOf","lastIndexOf"].includes(o))return function(I,R){return I!==null&&typeof I=="object"&&I[qt]&&(I=I.getTarget(!1)),s[o](I,R)};if(["forEach","every","some","filter","map"].includes(o))return function(I){return s[o]((R,D)=>I(y(D),D,i))};if(["reduce","reduceRight"].includes(o))return function(I,R){return s[o]((D,B,M)=>I(D,y(M),M,i),R)};if(["find","findIndex"].includes(o))return function(I){let R=s[o]((D,B)=>I(y(B),B,i));if(o==="find"&&R){const D=s.indexOf(R);R=y(D)}return R};if(["values","entries","keys"].includes(o))return function*(){for(let I=0;I<s.length;I++)if(o==="keys")yield I;else{const R=y(I);o==="entries"?yield[I,R]:yield R}}}return c}return y(o)},set(s,o,a,c){if(s=tt(r.root.cache,r.target),typeof o=="symbol")return Reflect.set(s,o,a,c);if(s===null||typeof s!="object")throw new Error(`Cannot set property "${o}" of ${s}. Value of path "/${e.path}" is not an object`);if(s instanceof Array&&typeof o=="string"){if(!/^[0-9]+$/.test(o))throw new Error(`Cannot set property "${o}" on array value of path "/${e.path}"`);o=parseInt(o)}return a!==null&&(typeof a=="object"&&(a[qt]&&(a=a.valueOf()),a=ht(a)),br(a,s[o]))||(r.target.some(u=>typeof u=="number")?r.flag("write",r.target.slice(0,r.target.findIndex(u=>typeof u=="number"))):s instanceof Array?r.flag("write",r.target):r.flag("write",r.target.concat(o)),a===null?delete s[o]:(Oi(a),s[o]=a)),!0},deleteProperty(s,o){if(s=tt(r.root.cache,r.target),s===null)throw new Error(`Cannot delete property ${o.toString()} of null`);return typeof o=="symbol"?Reflect.deleteProperty(s,o):(o in s&&(r.flag("write",r.target.concat(o)),delete s[o]),!0)},ownKeys(s){return s=tt(r.root.cache,r.target),Reflect.ownKeys(s)},has(s,o){return s=tt(r.root.cache,r.target),Reflect.has(s,o)},getOwnPropertyDescriptor(s,o){s=tt(r.root.cache,r.target);const a=Reflect.getOwnPropertyDescriptor(s,o);return a&&(a.configurable=!0),a},getPrototypeOf(s){return s=tt(r.root.cache,r.target),Reflect.getPrototypeOf(s)}},i=new Proxy({},n);return i}function Oi(r){typeof r=="object"&&Object.keys(r).forEach(e=>{const t=r[e];t===null||typeof t=="undefined"?delete r[e]:typeof t=="object"&&Oi(t)})}function fr(r){if(typeof r!="object"||!r[qt])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return r}class df{constructor(e,t="order",n=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=n,typeof e!="object"||!e[qt])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(s=>typeof e[s]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(s=>typeof e[s][t]=="number")){const s=Object.keys(e);for(let o=0;o<s.length;o++){const a=e[s[o]];a[t]=o*n}}}getObservable(){return fr(this.collection).getObservable()}getArrayObservable(){const e=Zi();return new e(t=>{const n=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){n.unsubscribe()}})}getArray(){return fr(this.collection).toArray((t,n)=>t[this.orderProperty]-n[this.orderProperty])}add(e,t,n){const i=this.getArray();let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let u=0;u<i.length;u++){const y=i[u][this.orderProperty];s=Math.min(y,s),o=Math.max(y,o)}let a;if(typeof n=="number"){if(a=Object.keys(this.collection).find(u=>this.collection[u]===e),!a)throw new Error("item not found in collection");if(n===t)return{key:a,index:t};if(Math.abs(n-t)===1){const u=i[t],y=u[this.orderProperty];return u[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=y,{key:a,index:t}}else i.splice(n,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:o+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:s-this.orderIncrement;else{const u=i.map(g=>g[this.orderProperty]),y=u[t]-u[t-1];if(y>1)e[this.orderProperty]=u[t]-Math.floor(y/2);else{i.splice(t,0,e);for(let g=0;g<i.length;g++)i[g][this.orderProperty]=g*this.orderIncrement}}return{key:typeof a=="string"?a:fr(this.collection).push(e),index:t}}delete(e){const n=this.getArray()[e];if(!n)throw new Error(`Item at index ${e} not found`);const i=Object.keys(this.collection).find(s=>this.collection[s]===n);if(!i)throw new Error("Cannot find target object to delete");return this.collection[i]=null,{key:i,index:e}}move(e,t){const n=this.getArray();return this.add(n[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let n=0;n<t.length;n++)t[n][this.orderProperty]=n*this.orderIncrement}}class fa{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class pf extends fa{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const ee=Symbol("private");class dt{constructor(e,t,n){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const s=L.get(t).key,o=[];this[ee]={get path(){return t},get key(){return s},get callbacks(){return o},vars:n||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const n=this[ee].context;if(typeof e=="object"){const i=e?t?n||{}:e:{};return e&&Object.keys(e).forEach(s=>{i[s]=e[s]}),this[ee].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),n;throw new Error("Invalid context argument")}}get cursor(){return this[ee].cursor}set cursor(e){var t;this[ee].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[ee].path}get key(){const e=this[ee].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[ee].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=L.fillVariables2(this.path,this.vars),t=L.get(e);return t.parentPath===null?null:new dt(this.db,t.parentPath).context(this[ee].context)}get vars(){return this[ee].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=L.fillVariables2(this.path,this.vars),n=L.getChildPath(t,e);return new dt(this.db,n).context(this[ee].context)}set(e,t){return $(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:n}=yield this.db.api.set(this.path,e,{context:this[ee].context});if(this.cursor=n,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(n){if(typeof t=="function")try{t(n,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw n}return this})}update(e,t){return $(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:n}=yield this.db.api.update(this.path,e,{context:this[ee].context});this.cursor=n}if(typeof t=="function")try{t(null,this)}catch(n){console.error("Error in onComplete callback:",n)}}catch(n){if(typeof t=="function")try{t(n,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw n}return this})}transaction(e){return $(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const n=s=>{s=this.db.types.deserialize(this.path,s);const o=new be(this,s);let a;try{a=e(o)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,n,{context:this[ee].context});if(this.cursor=i,t)throw t;return this})}on(e,t,n){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const s=new Vl(c=>{i=c}),o={event:e,stream:s,userCallback:typeof t=="function"&&t,ourCallback:(c,u,y,g,k)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${u}"`,c);return}const E=this.db.ref(u);E[ee].vars=L.extractVariables(this.path,u);let A;if(e.startsWith("notify_"))A=E.context(k||{});else{const S={previous:this.db.types.deserialize(u,g),current:this.db.types.deserialize(u,y)};if(e==="child_removed")A=new be(E,S.previous,!0,S.previous,k);else if(e==="mutations")A=new lr(E,S.current,k);else{const I=e==="mutated"&&S.current===null;A=new be(E,S.current,I,S.previous,k)}}i.publish(A),k!=null&&k.acebase_cursor&&(this.cursor=k.acebase_cursor)}};this[ee].callbacks.push(o);const a=()=>{typeof t=="function"&&s.subscribe(t,(k,E)=>{k||n&&n(E)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const u=k=>{const E=this[ee].callbacks;E.splice(E.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${k.message}`),i.cancel(k.message)},y=this.db.api.subscribe(this.path,e,o.ourCallback,{newOnly:c.newOnly,cancelCallback:u,syncFallback:c.syncFallback}),g=()=>{const k=this[ee].callbacks;return k.splice(k.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback)};if(y instanceof Promise?y.then(()=>{i.start(g)}).catch(u):i.start(g),!c.newOnly){if(e==="value")this.get(k=>{i.publish(k)});else if(e==="child_added")this.get(k=>{const E=k.val();E===null||typeof E!="object"||Object.keys(E).forEach(A=>{const S=new be(this.child(A),E[A]);i.publish(S)})});else if(e==="notify_child_added"){let A=0;const S=()=>$(this,null,function*(){const I=yield this.db.api.reflect(this.path,"children",{limit:100,skip:A});I.list.forEach(R=>{const D=this.child(R.key);i.publish(D)}),I.more&&(A+=100,S())});S()}}};return this.db.isReady?a():this.db.ready(a),s}off(e,t){const i=this[ee].callbacks.filter(s=>(!e||s.event===e)&&(!t||s.userCallback===t));return i.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),i.forEach(s=>{s.stream.stop()}),this}get(e,t){if(!this.db.isReady){const s=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const s=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw s;return Promise.reject(s)}const n=new fa(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,n).then(s=>{var u;"context"in s&&"value"in s||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),s={value:s,context:{}});const a=this.db.types.deserialize(this.path,s.value),c=new be(this,a,void 0,void 0,s.context);return(u=s.context)!=null&&u.acebase_cursor&&(this.cursor=s.context.acebase_cursor),c});if(t){i.then(t).catch(s=>{console.error("Uncaught error:",s)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(n=>{const i=s=>{this.off(e,i),n(s)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const s=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw s;return Promise.reject(s)}const n=Ke.generate(),i=this.child(n);return i[ee].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return $(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return $(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new ha(this)}count(){return $(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return $(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(n){return $(this,arguments,function*(e,t={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof e=="function"?e:e.write.bind(e);return this.db.api.export(this.path,i,t)})}import(n){return $(this,arguments,function*(e,t={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,e,t)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),hf.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=Zi();return new t(n=>{let i,s=!1,o=this.get(e).then(c=>{s=!0,i=c.val(),n.next(i)});const a=c=>{if(!s){o=o.then(()=>a(c));return}const u=c.ref.path;if(u===this.path)return i=c.val(),n.next(i);const y=L.getPathKeys(u).slice(L.getPathKeys(this.path).length);let g=i;for(;y.length>1;){const A=y.shift();A in g||(g[A]=typeof y[0]=="number"?[]:{}),g=g[A]}const k=y.shift(),E=c.val();E===null?g instanceof Array&&typeof k=="number"?g.splice(k,1):delete g[k]:g[k]=E,n.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return $(this,null,function*(){let n;if(typeof e=="function"?t=e:n=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),s={canceled:!1,total:i.list.length,processed:0};for(let o=0;o<i.list.length;o++){const a=i.list[o].key,c=yield this.child(a).get(n);if(s.processed++,!c.exists())continue;if((yield t(c))===!1){s.canceled=!0;break}}return s})}getMutations(e){return $(this,null,function*(){const t=typeof e=="string"?e:void 0,n=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:n})})}getChanges(e){return $(this,null,function*(){const t=typeof e=="string"?e:void 0,n=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:n})})}}class ha{constructor(e){this.ref=e,this[ee]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,n){if((t==="in"||t==="!in")&&(!(n instanceof Array)||n.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(n instanceof Array)||n.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(n instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[ee].filters.push({key:e,op:t,compare:n}),this}where(e,t,n){return this.filter(e,t,n)}take(e){return this[ee].take=e,this}skip(e){return this[ee].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[ee].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const s=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const n=new pf(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});n.allow_cache=n.cache_mode!=="bypass",n.eventHandler=s=>{if(!this[ee].events[s.name])return!1;const o=this[ee].events[s.name];if(typeof o!="object"||o.length===0)return!1;if(["add","change","remove"].includes(s.name)){const a={name:s.name,ref:new dt(this.ref.db,s.path)};if(n.snapshots&&s.name!=="remove"){const c=i.types.deserialize(s.path,s.value);a.snapshot=new be(a.ref,c,!1)}s=a}o.forEach(a=>{var c,u;try{a(s)}catch(y){this.ref.db.debug.error(`Error executing "${s.name}" event handler of realtime query on path "${this.ref.path}": ${(u=(c=y==null?void 0:y.stack)!=null?c:y==null?void 0:y.message)!=null?u:y}`)}})},n.monitor={add:!1,change:!1,remove:!1},this[ee].events&&(this[ee].events.add&&this[ee].events.add.length>0&&(n.monitor.add=!0),this[ee].events.change&&this[ee].events.change.length>0&&(n.monitor.change=!0),this[ee].events.remove&&this[ee].events.remove.length>0&&(n.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[ee],n).catch(s=>{throw new Error(s)}).then(s=>{const{stop:o}=s;let{results:a,context:c}=s;if(this.stop=()=>$(this,null,function*(){yield o()}),"results"in s&&"context"in s||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=s,c={}),n.snapshots){const u=a.map(y=>{const g=i.types.deserialize(y.path,y.val);return new be(i.ref(y.path),g,!1,void 0,c)});return Lr.from(u)}else{const u=a.map(y=>i.ref(y));return ts.from(u)}}).then(s=>(t&&t(s),s))}stop(){return $(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return $(this,null,function*(){return(yield this.find()).length})}exists(){return $(this,null,function*(){const e=this[ee].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return $(this,null,function*(){const t=yield this.find(),n=t.reduce((a,c)=>{const u=a[c.parent.path];return u?u.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,s=Object.keys(n).map(a=>$(this,null,function*(){const c=t.reduce((y,g)=>(y[g.key]=null,y),{}),u=i.ref(a);try{return yield u.update(c),{ref:u,success:!0}}catch(y){return{ref:u,success:!1,error:y}}})),o=yield Promise.all(s);return e&&e(o),o})}on(e,t){return this[ee].events[e]||(this[ee].events[e]=[]),this[ee].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[ee].events={},this;if(!this[ee].events[e])return this;if(typeof t=="undefined")return delete this[ee].events[e],this;const n=this[ee].events[e].indexOf(t);return~n?(this[ee].events[e].splice(n,1),this):this}forEach(e,t){return $(this,null,function*(){let n;if(typeof e=="function"?t=e:n=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),s={canceled:!1,total:i.length,processed:0};for(let o=0;o<i.length;o++){const c=yield i[o].get(n);if(s.processed++,!c.exists())continue;if((yield t(c))===!1){s.canceled=!0;break}}return s})}}class Lr extends Array{static from(e){const t=new Lr(e.length);return e.forEach((n,i)=>t[i]=n),t}getValues(){return this.map(e=>e.val())}}class ts extends Array{static from(e){const t=new ts(e.length);return e.forEach((n,i)=>t[i]=n),t}getPaths(){return this.map(e=>e.path)}}function yf(r,e){e=e.replace(/^\/|\/$/g,"");const t=L.getPathKeys(e),n=Object.keys(r).find(s=>{const o=L.getPathKeys(s);return o.length!==t.length?!1:o.every((a,c)=>a==="*"||typeof a=="string"&&a[0]==="$"?!0:a===t[c])});return r[n]}function mf(r,e){const t=L.get(e).parentPath;if(t!==null)return yf(r,t)}function gf(r,e){e=e.replace(/^\/|\/$/g,"");const n=L.get(e).parentPath,i=n?L.getPathKeys(n):[];return Object.keys(r).reduce((o,a)=>{const c=L.getPathKeys(a);if(c.length<i.length)return o;let u=!0;if(i.length===0&&n!==null?u=c.length===1&&(c[0]==="*"||typeof c[0]=="string"&&c[0][0]==="$"):c.every((y,g)=>g>=i.length?!1:y==="*"||typeof y=="string"&&y[0]==="$"||y===i[g]?!0:(u=!1,!1)),u){const y=r[a];o.push({path:a,type:y})}return o},[])}function Qs(r,e,t,n,i){if(n===null||typeof n!="object")return n;const s=L.getPathKeys(t),o=gf(e,t),a=[];return o.sort((c,u)=>L.getPathKeys(c.path).length>L.getPathKeys(u.path).length?-1:1),o.forEach(c=>{const u=L.getPathKeys(c.path);u.push("*");const y=u.slice(s.length);if(y.length===0){const k=L.extractVariables(c.path,t),E=new dt(r,t,k);if(i==="serialize")n=c.type.serialize(n,E);else if(i==="deserialize"){const A=new be(E,n);n=c.type.deserialize(A)}return}const g=(k,E,A)=>{if(n===null||typeof n!="object")return n;const S=A[0];let I=[];if(S==="*"||typeof S=="string"&&S[0]==="$")E instanceof Array?I=E.map((R,D)=>({key:D,val:R})):I=Object.keys(E).map(R=>({key:R,val:E[R]}));else{const R=E[S];typeof R=="object"&&I.push({key:S,val:R})}I.forEach(R=>{const D=L.getChildPath(k,R.key),B=L.extractVariables(c.path,D),M=new dt(r,D,B);if(A.length===1){if(i==="serialize")a.push({parent:E,key:R.key,original:E[R.key]}),E[R.key]=c.type.serialize(R.val,M);else if(i==="deserialize"){const V=new be(M,R.val);E[R.key]=c.type.deserialize(V)}}else g(D,R.val,A.slice(1))})};g(t,n,y)}),i==="serialize"&&(n=ht(n),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),n}const fn=Symbol("mappings");class da{constructor(e){this.db=e,this[fn]={}}get mappings(){return this[fn]}map(e){return mf(this[fn],e)}bind(e,t,n={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof n.serializer!="undefined"){if(typeof n.serializer=="string")if(typeof t.prototype[n.serializer]=="function")n.serializer=t.prototype[n.serializer];else throw new TypeError(`${t.name}.prototype.${n.serializer} is not a function, cannot use it as serializer`);else if(typeof n.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof n.creator=="undefined")typeof t.create=="function"&&(n.creator=t.create);else if(typeof n.creator=="string")if(typeof t[n.creator]=="function")n.creator=t[n.creator];else throw new TypeError(`${t.name}.${n.creator} is not a function, cannot use it as creator`);else if(typeof n.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[fn][e]={db:this.db,type:t,creator:n.creator,serializer:n.serializer,deserialize(i){let s;return this.creator?s=this.creator.call(this.type,i):s=new this.type(i),s},serialize(i,s){return this.serializer?i=this.serializer.call(i,s,i):i&&typeof i.serialize=="function"&&(i=i.serialize(s,i)),i}}}serialize(e,t){return Qs(this.db,this[fn],e,t,"serialize")}deserialize(e,t){return Qs(this.db,this[fn],e,t,"deserialize")}}const Zn=()=>{};class pa{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Zn,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):Zn,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):Zn,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):Zn,this.write=n=>{const i=typeof rt!="undefined"&&rt.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";n&&i?n.split(`
`).forEach(s=>console.log(s)):console.log(n)}}}const Xs={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},Zs={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},eo={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},er={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var Re;(function(r){r.reset="reset",r.bold="bold",r.dim="dim",r.italic="italic",r.underline="underline",r.inverse="inverse",r.hidden="hidden",r.strikethrough="strikethrough",r.black="black",r.red="red",r.green="green",r.yellow="yellow",r.blue="blue",r.magenta="magenta",r.cyan="cyan",r.grey="grey",r.bgBlack="bgBlack",r.bgRed="bgRed",r.bgGreen="bgGreen",r.bgYellow="bgYellow",r.bgBlue="bgBlue",r.bgMagenta="bgMagenta",r.bgCyan="bgCyan",r.bgWhite="bgWhite",r.bgGrey="bgGrey"})(Re||(Re={}));function ya(){if(typeof rt=="undefined"||!rt.stdout||!rt.env||!rt.platform||rt.platform==="browser")return!1;if(rt.platform==="win32")return!0;const r=rt.env;return r.COLORTERM?!0:r.TERM==="dumb"?!1:r.CI||r.TEAMCITY_VERSION?!!r.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(r.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(r.TERM))}let ma=ya();function vf(r){ma=ya()&&r}function wf(r,e){if(!ma)return r;const t=[],n=[],i=a=>{a===Re.reset?t.push(er.all):a in Xs?(t.push(Xs[a]),n.push(er[a])):a in Zs?(t.push(Zs[a]),n.push(er.color)):a in eo&&(t.push(eo[a]),n.push(er.background))};e instanceof Array?e.forEach(i):i(e);const s=t.map(a=>"\x1B["+a+"m").join(""),o=n.map(a=>"\x1B["+a+"m").join("");return r.split(`
`).map(a=>s+a+o).join(`
`)}String.prototype.colorize=function(r){return wf(this,r)};class ga{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class bf extends An{constructor(e,t={}){super(),this._ready=!1,t=new ga(t),this.name=e,this.debug=new pa(t.logLevel,`[${e}]`),vf(t.logColors);const n=[Re.magenta,Re.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,s=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(n)),s&&this.debug.write(s.colorize(Re.magenta))),this.types=new da(this),this.once("ready",()=>{this._ready=!0})}ready(e){return $(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){ff(e)}ref(e){return new dt(this,e)}get root(){return this.ref("")}query(e){const t=new dt(this,e);return new ha(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,n)=>this.api.createIndex(e,t,n),delete:e=>$(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,n=!1)=>this.api.setSchema(e,t,n),all:()=>this.api.getSchemas(),check:(e,t,n)=>this.api.validateSchema(e,t,n)}}}class Ee extends Error{constructor(e){super(`${e} is not implemented`)}}class xf extends An{constructor(){super()}stats(e){throw new Ee("stats")}subscribe(e,t,n,i){throw new Ee("subscribe")}unsubscribe(e,t,n){throw new Ee("unsubscribe")}update(e,t,n){throw new Ee("update")}set(e,t,n){throw new Ee("set")}get(e,t){throw new Ee("get")}transaction(e,t,n){throw new Ee("transaction")}exists(e){throw new Ee("exists")}query(e,t,n){throw new Ee("query")}reflect(e,t,n){throw new Ee("reflect")}export(e,t,n){throw new Ee("export")}import(e,t,n){throw new Ee("import")}createIndex(e,t,n){throw new Ee("createIndex")}getIndexes(){throw new Ee("getIndexes")}deleteIndex(e){throw new Ee("deleteIndex")}setSchema(e,t,n){throw new Ee("setSchema")}getSchema(e){throw new Ee("getSchema")}getSchemas(){throw new Ee("getSchemas")}validateSchema(e,t,n){throw new Ee("validateSchema")}getMutations(e){throw new Ee("getMutations")}getChanges(e){throw new Ee("getChanges")}}function to(r,e,t){const n=[0,0,0,0,0];for(let i=0;i<e;i+=4){let s=((r[i]*256+r[i+1])*256+r[i+2])*256+r[i+3];if(!s)t.push("z");else{for(let o=0;o<5;n[o++]=s%85+33,s=Math.floor(s/85));t.push(String.fromCharCode(n[4],n[3],n[2],n[1],n[0]))}}}function Af(r){const e=r,t=[],n=e.length%4,i=e.length-n;if(to(e,i,t),n){const o=new Uint8Array(4);o.set(e.slice(i),0),to(o,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,n+1))}let s=t.join("");return s="<~"+s+"~>",s}const xt={encode:function(r){return r instanceof ArrayBuffer&&(r=new Uint8Array(r,0,r.byteLength)),Af(r)},decode:function(r){if(!r.startsWith("<~")||!r.endsWith("~>"))throw new Error("Invalid input string");r=r.substr(2,r.length-4);const e=r.length,t=[],n=[0,0,0,0,0];let i,s,o,a;for(let u=0;u<e;++u){if(r.charAt(u)=="z"){t.push(0,0,0,0);continue}for(let y=0;y<5;++y)n[y]=r.charCodeAt(u+y)-33;if(a=e-u,a<5){for(let y=a;y<4;n[++y]=0);n[a]=85}i=(((n[0]*85+n[1])*85+n[2])*85+n[3])*85+n[4],s=i&255,i>>>=8,o=i&255,i>>>=8,t.push(i>>>8,i&255,o,s);for(let y=a;y<5;++y,t.pop());u+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},Ef=r=>{if(r.map===null||typeof r.map=="undefined"){if(typeof r.val=="undefined")throw new Error("serialized value must have a val property");return r.val}const e=(t,n)=>t==="date"?new Date(n):t==="binary"?xt.decode(n):t==="reference"?new xe(n):t==="regexp"?new RegExp(n.pattern,n.flags):t==="array"?new wr(n):t==="bigint"?BigInt(n):n;return typeof r.map=="string"?e(r.map,r.val):(Object.keys(r.map).forEach(t=>{const n=r.map[t],i=L.getPathKeys(t);let s=r,o="val",a=r.val;i.forEach(c=>{o=c,s=a,a=a[o]}),s[o]=e(n,a)}),r.val)},va=r=>{var i;if(r===null||typeof r!="object"||r instanceof Date||r instanceof ArrayBuffer||r instanceof xe||r instanceof RegExp){const s=va({value:r});return{map:(i=s.map)==null?void 0:i.value,val:s.val.value}}r=ht(r);const e=(s,o,a)=>{s instanceof wr&&(o[a]="array"),Object.keys(s).forEach(c=>{const u=s[c],y=a.length===0?c:`${a}/${c}`;typeof u=="bigint"?(s[c]=u.toString(),o[y]="bigint"):u instanceof Date?(s[c]=u.toISOString(),o[y]="date"):u instanceof ArrayBuffer?(s[c]=xt.encode(u),o[y]="binary"):u instanceof xe?(s[c]=u.path,o[y]="reference"):u instanceof RegExp?(s[c]={pattern:u.source,flags:u.flags},o[y]="regexp"):typeof u=="object"&&u!==null&&e(u,o,y)})},t={};e(r,t,"");const n={val:r};return Object.keys(t).length>0&&(n.map=t),n},no=r=>r>0?Date.now()+r*1e3:1/0;class kf{get size(){return this.cache.size}constructor(e){var n;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const t=setInterval(()=>{this.cleanUp()},60*1e3);(n=t.unref)==null||n.call(t)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=no(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?ht(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let n=null;const i=Date.now();for(const[s,o]of this.cache.entries()){if(o.expires<=i){this.cache.delete(s),n=null;break}(!n||o.accessed<n.accessed)&&(n={key:s,accessed:o.accessed})}n!==null&&this.cache.delete(n.key)}this.cache.set(e,{value:this.options.cloneValues?ht(t):t,added:Date.now(),accessed:Date.now(),expires:no(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,n)=>{t.expires<=e&&this.cache.delete(n)})}}function Sf(r){let e=0;function t(){let a;for(;a=r[e],[" ","\r",`
`,"	"].includes(a);)e++}function n(a){if(r[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${r[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=r[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${r.slice(e,e+10)}..`);return r[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),n(":"),a}function s(){t();let a={typeOf:"any"},c,u="";for(;c=r[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)u+=c,e++;if(u.length===0)if(r[e]==="*")n("*"),a.typeOf="any";else if(["'",'"',"`"].includes(r[e])){a.typeOf="string",a.value="";const y=r[e];for(n(y);c=r[e],c&&c!==y;)a.value+=c,e++;n(y)}else if(r[e]>="0"&&r[e]<="9"){a.typeOf="number";let y="";for(;c=r[e],c==="."||c==="n"||c>="0"&&c<="9";)y+=c,e++;y.endsWith("n")?a.value=BigInt(y):y.includes(".")?a.value=parseFloat(y):a.value=parseInt(y)}else if(r[e]==="{"){for(n("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const y=i(),g=o();if(a.children.push({name:y.name,optional:y.optional,wildcard:y.wildcard,types:g}),t(),(r[e]===";"||r[e]===",")&&(n(r[e]),t()),r[e]==="}")break}n("}")}else if(r[e]==="/"){n("/");let y="",g="";for(;c=r[e],c!=="/"||y.endsWith("\\");)y+=c,e++;for(n("/");c=r[e],["g","i","m","s","u","y","d"].includes(c);)g+=c,e++;a.typeOf="string",a.matches=new RegExp(y,g)}else throw new Error(`Expected a type definition at position ${e}, found character '${r[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(u))a.typeOf=u.toLowerCase();else if(u==="Object"||u==="object")a.typeOf="object",a.instanceOf=Object;else if(u==="Date")a.typeOf="object",a.instanceOf=Date;else if(u==="Binary"||u==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(u==="any")a.typeOf="any";else if(u==="null")a.typeOf="object",a.value=null;else if(u==="Array")n("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=o(),n(">");else if(["true","false"].includes(u))a.typeOf="boolean",a.value=u==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();r[e]==="[";)n("["),n("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function o(){t();const a=[s()];for(;r[e]==="|";)n("|"),a.push(s()),t();return a}return s()}function Tf(r,e,t,n){const i=e.find(g=>g.name==="*"||g.name[0]==="$")?[]:Object.keys(t).filter(g=>![null,void 0].includes(t[g])&&!e.find(k=>k.name===g));if(i.length>0)return{ok:!1,reason:`Object at path "${r}" cannot have propert${i.length===1?"y":"ies"} ${i.map(g=>`"${g}"`).join(", ")}`};function s(g){const k=![null,void 0].includes(t[g.name]);return!g.optional&&(n?t[g.name]===null:!k)?{ok:!1,reason:`Property at path "${r}/${g.name}" is not optional`}:k&&g.types.length===1?jn(`${r}/${g.name}`,g.types[0],t[g.name],!1):k&&!g.types.some(E=>jn(`${r}/${g.name}`,E,t[g.name],!1).ok)?{ok:!1,reason:`Property at path "${r}/${g.name}" does not match any of ${g.types.length} allowed types`}:{ok:!0}}const o=e.filter(g=>!g.wildcard),a=o.find(g=>!s(g).ok);if(a)return{ok:!1,reason:s(a).reason};const c=e.find(g=>g.wildcard);if(!c)return{ok:!0};const u=Object.keys(t).filter(g=>!o.find(k=>k.name===g));let y={ok:!0};for(let g=0;g<u.length&&y.ok;g++){const k=u[g];y=s({name:k,types:c.types,optional:!0,wildcard:!0})}return y}function jn(r,e,t,n,i){const s={ok:!0};if(e.typeOf==="any")return s;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${r}" must be typeof ${e.typeOf}`};if(!e.children)return s;const o=i[0];let a=e.children.find(u=>u.name===o);if(a||(a=e.children.find(u=>u.name==="*"||u.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${r}" cannot have property "${o}"`};if(a.optional&&t===null&&i.length===1)return s;let c;return a.types.some(u=>{const y=typeof o=="number"?`${r}[${o}]`:`${r}/${o}`;return c=jn(y,u,t,n,i.slice(1)),c.ok}),c}return t===null?s:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${r}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${r}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${r}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${r}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(o=>e.genericTypes.some(a=>jn(r,a,o,!1).ok))?{ok:!1,reason:`every array value of path "${r}" must match one of the specified types`}:e.typeOf==="object"&&e.children?Tf(r,e.children,t,n):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${r}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:s}function Of(r){switch(r){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${r.name}`)}}class _f{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const n=i=>"{"+Object.keys(i).map(s=>{let o=i[s];if(o===void 0)o="undefined";else if(o instanceof RegExp)o=`/${o.source}/${o.flags}`;else if(typeof o=="object")o=n(o);else if(typeof o=="function")o=Of(o);else if(!["string","number","boolean","bigint"].includes(typeof o))throw new Error(`Type definition for key "${s}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${s}:${o}`}).join(",")+"}";this.text=n(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=Sf(this.text)}check(e,t,n,i){const s=jn(e,this.type,t,n,i);return!s.ok&&this.handling.warnOnly&&(s.warning=`${n?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${s.reason}`,s.ok=!0,this.handling.warnCallback(s.warning)),s}}class Ye{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class ii extends Ye{}class _i extends Ye{}class ro extends Ye{}class If extends Ye{}class io extends Ye{}class Pf extends Ye{}const Nf={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},H=Nf;function Rf(r){switch(r){case H.ARRAY:return"array";case H.BINARY:return"binary";case H.BOOLEAN:return"boolean";case H.DATETIME:return"date";case H.NUMBER:return"number";case H.OBJECT:return"object";case H.REFERENCE:return"reference";case H.STRING:return"string";case H.BIGINT:return"bigint"}}class wa{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=L.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return Rf(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function Je(r,e){if(!r)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const $f=120,qe={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class ba{constructor(e,t=$f){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Ke.generate()}_allowLock(e,t,n){const i=this._locks.find(s=>s.tid!==t&&s.state===qe.LOCKED&&(n||s.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(n){console.error("Unhandled promise rejection:",n)}}_processLockQueue(){if(this._quit){const t=new Error("Quitting");this._locks.filter(n=>n.state===qe.PENDING).forEach(n=>this._rejectLock(n,t)),this._locks.length===0&&this._quit()}this._locks.filter(t=>t.state===qe.PENDING).sort((t,n)=>t.priority&&!n.priority?-1:!t.priority&&n.priority?1:t.requested-n.requested).forEach(t=>{const n=this._allowLock(t.path,t.tid,t.forWriting);t.waitingFor=n.conflict||null,n.allow&&this.lock(t).then(t.resolve).catch(i=>this._rejectLock(t,i))})}lock(o,a){return $(this,arguments,function*(e,t,n=!0,i="",s={withPriority:!1,noTimeout:!1}){let c,u;if(e instanceof si)c=e,u=!0;else{if(this._locks.findIndex(y=>y.tid===t&&y.state===qe.EXPIRED)>=0)throw new Error(`lock on tid ${t} has expired, not allowed to continue`);if(this._quit&&!s.withPriority)throw new Error("Quitting");{c=new si(this,e,t,n,s.withPriority===!0),c.comment=i,this._locks.push(c);const y=this._allowLock(e,t,n);c.waitingFor=y.conflict||null,u=y.allow}}if(u){if(c.state=qe.LOCKED,typeof c.granted!="number"){if(c.granted=Date.now(),s.noTimeout!==!0){c.expires=Date.now()+this.timeout;let y=0;const g=()=>{if(c.state===qe.LOCKED){if(y++,y<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${y}]`),c.timeout=setTimeout(g,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=qe.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(g,this.timeout/4)}}return c}else return Je(c.state===qe.PENDING),new Promise((y,g)=>{c.resolve=y,c.reject=g})})}unlock(e,t,n=!0){let i,s;if(e instanceof si)i=e,s=this._locks.indexOf(i);else{const o=e;s=this._locks.findIndex(a=>a.id===o),i=this._locks[s]}if(s<0){const o=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(o)}return i.state=qe.DONE,clearTimeout(i.timeout),this._locks.splice(s,1),n&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,n){return this._allowLock(e,t,n).allow}}let jf=0;class si{static get LOCK_STATE(){return qe}constructor(e,t,n,i,s=!1){this.locker=e,this.path=t,this.tid=n,this.forWriting=i,this.priority=s,this.state=qe.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++jf,this.history=[]}release(e){return $(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return $(this,null,function*(){const e=L.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const n=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return n.history=this.history,n.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),n}})}}class ns extends Error{}class Ii extends Error{}class Cf extends Error{constructor(e){super(`Exiting: ${e}`)}}class Bf extends An{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,n=e.name){super(),this.storage=e,this.id=t,this.dbname=n,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new ba(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(c=>c.callback===i.callback))return;const o=this.ourSubscriptions.some(c=>c.event===i.event&&c.path===i.path);if(this.ourSubscriptions.push(i),o)return;const a={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(a)}),e.on("unsubscribe",i=>{const s=this.remoteSubscriptions.find(o=>o.callback===i.callback);if(s){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1);return}this.ourSubscriptions.filter(o=>o.path===i.path&&(!i.event||o.event===i.event)&&(!i.callback||o.callback===i.callback)).forEach(o=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(o),1);const a={type:"unsubscribe",from:this.id,data:{path:o.path,event:o.event}};this.sendMessage(a)})})}exit(e=0){return $(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(this._exiting)return;if(this.peers.find(i=>i.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t){const i={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(i),this.ourSubscriptions.forEach(s=>{const o={type:"subscribe",from:this.id,to:e,data:{path:s.path,event:s.event}};this.sendMessage(o)})}}removePeer(e,t=!1){if(this._exiting)return;const n=this.peers.find(s=>s.id===e);if(!n){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(n),1),this.remoteSubscriptions.filter(s=>s.for===e).forEach(s=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1),this.storage.subscriptions.remove(s.path,s.event,s.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const n=(i,s,o,a,c)=>{const u={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:s,val:o,previous:a,context:c}};this.sendMessage(u)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:n}),this.storage.subscriptions.add(t.path,t.event,n)}cancelRemoteSubscription(e,t){const n=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!n||this.storage.subscriptions.remove(t.path,t.event,n.callback)}handleMessage(e){return $(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,n=t.data.context||{};n.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(s=>s.event===t.event&&s.path===t.path).forEach(s=>{s.callback(null,t.data.path,t.data.val,t.data.previous,n)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,n={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);n.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("The request must be known to us!");t.ok?n.resolve(t.data):n.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,n={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(s=>{var o;return((o=s.lock)==null?void 0:o.id)===t.data.id}).lock.release()}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("The request must be known to us!");t.ok?n.resolve(t.data):n.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,n={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const s=this._locks.find(o=>{var a;return((a=o.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield s.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);s.lock=i,n.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("Result of unknown request received");t.ok?n.resolve(t.data):n.reject(new Error(t.reason))}}})}lock(e){return $(this,null,function*(){if(this._exiting&&!this._locks.find(i=>i.tid===e.tid&&i.granted))throw new Cf("new transaction lock denied because the IPC peer is exiting");const t=n=>{this._locks.splice(this._locks.indexOf(n),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const n={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(n);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);n.tid=i.tid,n.granted=!0;const s=o=>({get id(){return o.id},get tid(){return o.tid},get path(){return o.path},get forWriting(){return o.forWriting},get expires(){return o.expires},get comment(){return o.comment},get state(){return o.state},release:()=>$(this,null,function*(){yield o.release(),t(n)}),moveToParent:()=>$(this,null,function*(){const a=yield o.moveToParent();return n.lock=s(a),n.lock})});return n.lock=s(i),n.lock}else{const n={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(n);const i=c=>(n.granted=!0,n.tid=c.tid,n.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:qe.LOCKED,expires:c.expires,comment:c.comment,release:()=>$(this,null,function*(){const u={type:"unlock-request",id:Ke.generate(),from:this.id,to:this.masterPeerId,data:{id:n.lock.id}};yield this.request(u),n.lock.state=qe.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${n.lock.id} (tid ${n.lock.tid}, ${n.lock.comment}, "/${n.lock.path}", ${n.lock.forWriting?"write":"read"})`),t(n)}),moveToParent:()=>$(this,null,function*(){const u={type:"move-lock-request",id:Ke.generate(),from:this.id,to:this.masterPeerId,data:{id:n.lock.id,move_to:"parent"}};let y;try{y=yield this.request(u)}catch(g){throw n.lock.state=qe.DONE,t(n),g}return n.lock=i(y),n.lock})},n.lock),s={type:"lock-request",id:Ke.generate(),from:this.id,to:this.masterPeerId,data:e};let o,a;try{o=yield this.request(s)}catch(c){a=c,o=null}if(a)throw t(n),a;return i(o)}})}request(e){return $(this,null,function*(){let t,n;const i=new Promise((s,o)=>{t=a=>{this._requests.delete(e.id),s(a)},n=a=>{this._requests.delete(e.id),o(a)}});return this._requests.set(e.id,{resolve:t,reject:n,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Ke.generate(),data:e};return this.request(t).catch(n=>{throw this.storage.debug.error(n),n})}replyRequest(e,t){const n={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(n)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class Lf extends Bf{constructor(e){if(super(e,Ke.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const n=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:s=>{const o=Ke.generate(),a=`acebase:${e.name}:${this.id}:${o}`,c=JSON.stringify(va(s));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(s){n[0]=s},set onmessageerror(s){i()},close(){i()},addEventListener(s,o){s!=="message"&&i(),n.push(o)},removeEventListener(s,o){const a=n.indexOf(o);a>=1&&n.splice(a,1)},dispatchEvent(s){return n.forEach(o=>{try{o&&o(s)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",s=>{const[o,a,c,u]=s.key.split(":");if(o!=="acebase"||a!==e.name||c===this.id||s.newValue===null)return;const y=Ef(JSON.parse(s.newValue));this.channel.dispatchEvent({data:y})})}this.channel.addEventListener("message",n=>$(this,null,function*(){const i=n.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const s=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=s.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const o=this._locks.splice(0);yield Promise.all(o.filter(a=>a.granted).map(a=>$(this,null,function*(){let c,u;a.lock.release=()=>new Promise(g=>c=g),a.lock.moveToParent=()=>new Promise(g=>u=g);const y=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(u){const g=yield y.moveToParent();u(g)}c&&(yield y.release(),c())}))),yield Promise.all(o.filter(a=>!a.granted).map(a=>$(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class hn{static get hasFileSystem(){return!1}static get fs(){return null}}class rs extends Ye{}class xa extends Ye{}class Df extends Ye{}class Uf extends Ye{}function Ff(r,e,t,n){return $(this,null,function*(){if(!r.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:s,indexes:o,storage:a}=r,c=n&&n.rebuild===!0,u=n&&n.type||"normal";let y=n&&n.include||[];typeof y=="string"&&(y=[y]);const g=o.find(E=>E.path===e&&E.key===t&&E.type===u&&E.includeKeys.length===y.length&&E.includeKeys.every((A,S)=>y[S]===A));if(g&&n.config&&(g.config=n.config),g&&c!==!0)return s.log(`Index on "/${e}/*/${t}" already exists`.colorize(Re.inverse)),g;if(!i.isMaster){const E=yield i.sendRequest({type:"index.create",path:e,key:t,options:n});if(E.ok)return a.indexes.add(E.fileName);throw new Error(E.reason)}yield hn.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(E=>{if(E.code!=="EEXIST")throw E});const k=g||(()=>{const{include:E,caseSensitive:A,textLocale:S,textLocaleKey:I}=n,R={include:E,caseSensitive:A,textLocale:S,textLocaleKey:I};switch(u){case"array":return new Uf(a,e,t,_({},R));case"fulltext":return new xa(a,e,t,q(_({},R),{config:n.config}));case"geo":return new Df(a,e,t,_({},R));default:return new rs(a,e,t,_({},R))}})();g||o.push(k);try{yield k.build()}catch(E){throw r.debug.error(`Index build on "/${e}/*/${t}" failed: ${E.message} (code: ${E.code})`.colorize(Re.red)),g||o.splice(o.indexOf(k),1),E}return i.sendNotification({type:"index.created",fileName:k.fileName,path:e,key:t,options:n}),k})}const{compareValues:tr,getChildValues:Jt,encodeString:so,defer:Mf}=ca,Pi=["value","child_added","child_changed","child_removed","mutated","mutations"];Pi.push(...Pi.map(r=>`notify_${r}`));const Kf=()=>{};class Wf extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class is{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class zf extends An{createTid(){return Ke.generate()}constructor(e,t,n){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return hn==null?void 0:hn.hasFileSystem},create:(s,o,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return Ff(c,s,o,a)},get:(s,o=null)=>{if(s.includes("$")){const a=L.getPathKeys(s).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);s=new L(a).path}return this._indexes.filter(a=>a.path===s&&(o===null||o===a.key))},getAll:(s,o={parentPaths:!0,childPaths:!0})=>{const a=L.getPathKeys(s);return this._indexes.filter(c=>{const u=L.getPathKeys(c.path+"/*");return o.parentPaths&&u.every((y,g)=>y==="*"||a[g]===y)&&[c.key].concat(...c.includeKeys).includes(a[u.length])?!0:u.length<a.length||!o.childPaths&&u.length!==a.length?!1:a.every((y,g)=>[y,"*"].includes(u[g]))})},list:()=>this._indexes.slice(),load:()=>$(this,null,function*(){if(this._indexes.splice(0),!hn.hasFileSystem)return;let s=[];try{s=yield hn.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const o=[];s.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",u=/^\[[a-z]+\]-/.test(a);if(!c&&!u||c&&a.startsWith(`[${this.settings.type}]-`)){const y=this.indexes.add(a);o.push(y)}}),yield Promise.all(o)}),add:s=>$(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(o)return o;if(this._annoucedIndexes.has(s))return yield this._annoucedIndexes.get(s);try{const a=rs.readFromFile(this,s);this._annoucedIndexes.set(s,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(s),c}catch(a){return this.debug.error(a),null}}),delete:s=>$(this,null,function*(){const o=yield this.indexes.remove(s);yield o.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:o.fileName,path:o.path,keys:o.key})}),remove:s=>$(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(!o)throw new Error(`Index ${s} not found`);return this._indexes.splice(this._indexes.indexOf(o),1),o}),close:()=>$(this,null,function*(){const s=this.indexes.list().map(o=>o.close().catch(a=>this.debug.error(a)));yield Promise.all(s)})},this._eventSubscriptions={},this.subscriptions={add:(s,o,a)=>{if(Pi.indexOf(o)<0)throw new TypeError(`Invalid event type "${o}"`);let c=this._eventSubscriptions[s];c||(c=this._eventSubscriptions[s]=[]),c.push({created:Date.now(),type:o,callback:a}),this.emit("subscribe",{path:s,event:o,callback:a})},remove:(s,o,a)=>{const c=this._eventSubscriptions[s];if(!c)return;const u=()=>c.findIndex(g=>(o?g.type===o:!0)&&(a?g.callback===a:!0));let y;for(;(y=u())>=0;)c.splice(y,1);this.emit("unsubscribe",{path:s,event:o,callback:a})},hasValueSubscribersForPath(s){return!!this.getValueSubscribersForPath(s)},getValueSubscribersForPath:s=>{const o=new L(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.equals(c)||o.isDescendantOf(c)){const u=this._eventSubscriptions[c],y=L.fillVariables(c,s);u.filter(g=>!g.type.startsWith("notify_")).forEach(g=>{let k=null;if(g.type==="value")k=y;else if(["mutated","mutations"].includes(g.type)&&o.isDescendantOf(y))k=s;else if(g.type==="child_changed"&&s!==y){const E=L.getPathKeys(s.slice(y.length).replace(/^\//,""))[0];k=L.getChildPath(y,E)}else if(["child_added","child_removed"].includes(g.type)&&o.isChildOf(y)){const E=L.getPathKeys(s.slice(y.length).replace(/^\//,""))[0];k=L.getChildPath(y,E)}k!==null&&!a.some(E=>E.type===g.type&&E.eventPath===y)&&a.push({type:g.type,eventPath:y,dataPath:k,subscriptionPath:c})})}}),a},getAllSubscribersForPath:s=>{const o=L.get(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.isOnTrailOf(c)){const u=this._eventSubscriptions[c],y=L.fillVariables(c,s);u.forEach(g=>{let k=null;if(g.type==="value"||g.type==="notify_value")k=y;else if(["child_changed","notify_child_changed"].includes(g.type)){const E=s===y||o.isAncestorOf(y)?"*":L.getPathKeys(s.slice(y.length).replace(/^\//,""))[0];k=L.getChildPath(y,E)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(g.type))k=s;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(g.type)&&(o.isChildOf(y)||s===y||o.isAncestorOf(y))){const E=s===y||o.isAncestorOf(y)?"*":L.getPathKeys(s.slice(y.length).replace(/^\//,""))[0];k=L.getChildPath(y,E)}k!==null&&!a.some(E=>E.type===g.type&&E.eventPath===y&&E.subscriptionPath===c)&&a.push({type:g.type,eventPath:y,dataPath:k,subscriptionPath:c})})}}),a},trigger:(s,o,a,c,u,y)=>{(this._eventSubscriptions[o]||[]).filter(k=>k.type===s).forEach(k=>{k.callback(null,a,u,c,y)})}},this.debug=new pa(n.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof Ye){const s={ipcName:i,server:t.ipc instanceof Ye?t.ipc:null};this.ipc=new Ye(this,s)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const s=Object.assign({dbname:i},t.ipc);this.ipc=new Ye(this,s)}else this.ipc=new Lf(this,i);this.ipc.once("exit",s=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(s,o,a,c)=>this.ipc.lock({path:s,tid:o,write:a,comment:c})},this._lastTid=0}close(){return $(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:so(e).length<this.settings.maxInlineValueSize;if(e instanceof xe)return e.path.length>this.settings.maxInlineValueSize?!1:so(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,n){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let n=e,i=!1;const s=t?[]:this.subscriptions.getAllSubscribersForPath(e),o=t?[]:this.subscriptions.getValueSubscribersForPath(e);o.length>0&&(i=!0,n=o.map(g=>({path:g.dataPath,keys:L.getPathKeys(g.dataPath)})).sort((g,k)=>g.keys.length<k.keys.length?-1:g.keys.length>k.keys.length?1:0)[0].path,o.filter(g=>g.dataPath===n).every(g=>g.type==="mutated"||g.type.startsWith("notify_"))&&(i=!1),n=L.fillVariables(n,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(u=>({index:u,keys:L.getPathKeys(u.path)})).sort((u,y)=>u.keys.length<y.keys.length?-1:u.keys.length>y.keys.length?1:0).map(u=>u.index),c=[];if(a.length>0){a.sort((g,k)=>(typeof g._pathKeys=="undefined"&&(g._pathKeys=L.getPathKeys(g.path)),typeof k._pathKeys=="undefined"&&(k._pathKeys=L.getPathKeys(k.path)),g._pathKeys.length<k._pathKeys.length?-1:g._pathKeys.length>k._pathKeys.length?1:0));const u=a[0],y=u.path===e?e:L.fillVariables(`${u.path}/*`,e);y.length<n.length&&(n=y,a.filter(g=>g.path===u.path).forEach(g=>{[g.key].concat(g.includeKeys).forEach(E=>!c.includes(E)&&c.push(E))}))}return{topEventPath:n,eventSubscriptions:s,valueSubscribers:o,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(i,s){return $(this,arguments,function*(e,t,n={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(n=n||{},!n.tid&&!n.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");n.merge=n.merge===!0;const o=this.validateSchema(e,t,{updates:n.merge});if(!o.ok)throw new Wf(o.reason);const a=n.tid,c=n.transaction;let u=null;const y=n.impact?n.impact:this.getUpdateImpact(e,n.suppress_events),{topEventPath:g,eventSubscriptions:k,hasValueSubscribers:E,indexes:A}=y;let{keysFilter:S}=y;const I=()=>{if(typeof n._customWriteFunction=="function")return n._customWriteFunction();if(u){const l=L.getPathKeys(e),x=L.getPathKeys(g),h=l.slice(x.length);let f=u;for(;h.length>0&&f!==null;){const w=h.shift();f=typeof f=="object"&&w in f?f[w]:null}n.currentValue=f}return this._writeNode(e,t,n)},R=this.settings.transactions&&this.settings.transactions.log===!0;if(k.length===0&&A.length===0&&!R)return I();if(!E&&n.merge===!0&&S.length===0&&(S=Object.keys(t),g!==e)){const l=e.slice(g.length);S=S.map(x=>`${l}/${x}`)}const D=yield this.getNodeInfo(g,{transaction:c,tid:a});let B=null;if(D.exists){const l={transaction:c,tid:a};S.length>0&&(l.include=S),g===""&&typeof l.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),B=(yield this.getNode(g,l)).value}u=B;const M=(yield I())||{};let V,W;if(e===g)n.merge?u===null?V=t instanceof Array?[]:{}:(V=u instanceof Array?[]:{},Object.keys(u).forEach(l=>{V[l]=u[l]})):V=t,W=V;else{const l=e.slice(g.length).replace(/^\//,""),x=L.getPathKeys(l);for(u===null?V=typeof x[0]=="number"?[]:{}:(V=u instanceof Array?[]:{},Object.keys(u).forEach(h=>{V[h]=u[h]})),W=V;x.length>0;){const h=x.shift();if(!n.merge&&x.length===0)W[h]=t;else{const f=W[h],w=typeof h=="number"?[...f]:_({},f);W[h]=w}W=W[h]}}n.merge&&Object.keys(t).forEach(l=>{W[l]=t[l]});const X=tr(u,V);if(X==="identical")return M.mutations=[],M;function oe(l){if(l===null||typeof l!="object")return l;Object.keys(l).forEach(x=>{const h=l[x];h===null&&(delete l[x],l instanceof Array&&l.length--),typeof h=="object"&&oe(h)})}oe(V);const ie=[];A.map(l=>({index:l,keys:L.getPathKeys(l.path)})).sort((l,x)=>l.keys.length<x.keys.length?1:l.keys.length>x.keys.length?-1:0).forEach(({index:l})=>{const x=L.getPathKeys(g),h=L.getPathKeys(l.path+"/*"),f=h.slice(x.length),w=u,v=V;if(f.length===0){Je(x.length===h.length,"check logic");const N=this.ipc.isMaster?l.handleRecordUpdate(g,w,v):this.ipc.sendRequest({type:"index.update",fileName:l.fileName,path:g,oldValue:w,newValue:v});ie.push(N);return}const T=(N,P,O)=>{if(P===null&&O===null)return[];const C=L.getPathKeys(N),U=L.getPathKeys(l.path+"/*"),z=U.slice(C.length);if(z.length===0)return Je(C.length===U.length,"check logic"),[{path:N,oldValue:P,newValue:O}];let Q=[],K="";for(;z.length>0;){const ge=z.shift();if(typeof ge=="string"&&(ge==="*"||ge.startsWith("$"))){const ae=P===null?[]:Object.keys(P);O!==null&&Object.keys(O).forEach(ce=>{ae.indexOf(ce)<0&&ae.push(ce)}),ae.forEach(ce=>{const pe=L.getChildPath(K,ce),se=Jt(ce,P,O),we=L.getChildPath(N,pe),le=T(we,se.oldValue,se.newValue);Q=Q.concat(le)});break}else{const ae=Jt(ge,P,O);if(P=ae.oldValue,O=ae.newValue,P===null&&O===null)break;K=L.getChildPath(K,ge)}}return Q};T(g,w,v).forEach(N=>{const P=this.ipc.isMaster?l.handleRecordUpdate(N.path,N.oldValue,N.newValue):this.ipc.sendRequest({type:"index.update",fileName:l.fileName,path:N.path,oldValue:N.oldValue,newValue:N.newValue});ie.push(P)})});const d=(l,x,h,f=[])=>{let w=!0,v=l.type;if(v.startsWith("notify_")&&(v=v.slice(7)),v==="mutated"||(v==="child_changed"&&(x===null||h===null)?w=!1:v==="value"||v==="child_changed"?w=tr(x,h)!=="identical":v==="child_added"?w=x===null&&h!==null:v==="child_removed"&&(w=x!==null&&h===null),!w))return;const T=L.getPathKeys(l.dataPath);f.forEach(N=>{const P=T.indexOf(N.name);Je(P>=0,`Variable "${N.name}" not found in subscription dataPath "${l.dataPath}"`),T[P]=N.value});const b=T.reduce((N,P)=>L.getChildPath(N,P),"");this.subscriptions.trigger(l.type,l.subscriptionPath,b,x,h,n.context)},p=(l,x,h,f)=>{const w=[],v=f||tr(x,h);return v==="identical"||(typeof v=="string"?w.push({path:l,oldValue:x,newValue:h}):(v.changed.forEach(T=>{const b=L.getChildPath(l,T.key),N=Jt(T.key,x,h),P=p(b,N.oldValue,N.newValue,T.change);w.push(...P)}),v.added.forEach(T=>{const b=L.getChildPath(l,T);w.push({path:b,oldValue:null,newValue:h[T]})}),x instanceof Array&&h instanceof Array&&v.removed.sort((T,b)=>T<b?1:-1),v.removed.forEach(T=>{const b=L.getChildPath(l,T);w.push({path:b,oldValue:x[T],newValue:null})}))),w};R&&this.settings.type!=="transaction"&&(M.mutations=(()=>{const l=e.slice(g.length).replace(/^\//,""),x=L.getPathKeys(l);let h=u,f=V;for(;x.length>0;){const b=x.shift();({oldValue:h,newValue:f}=Jt(b,h,f))}const w=tr(h,f);return p(e,h,f,w).map(b=>({target:L.getPathKeys(b.path.slice(e.length)),prev:b.oldValue,val:b.newValue}))})());const m=()=>{k.filter(x=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(x.type)).map(x=>{const h=L.getPathKeys(x.dataPath);return{sub:x,keys:h}}).sort((x,h)=>x.keys.length<h.keys.length?1:x.keys.length>h.keys.length?-1:0).forEach(({sub:x})=>{const h=(f,w,v,T=[])=>{const b=x.dataPath.slice(f.length).replace(/^\//,""),N=L.getPathKeys(b);for(;N.length>0;){const P=N.shift();if(typeof P=="string"&&(P==="*"||P[0]==="$")){const O=w===null?[]:Object.keys(w).map(C=>w instanceof Array?parseInt(C):C);v!==null&&Object.keys(v).forEach(C=>{const U=v instanceof Array?parseInt(C):C;!O.includes(U)&&O.push(C)}),O.forEach(C=>{const U=Jt(C,w,v),z=T.concat({name:P,value:C});N.length===0?d(x,U.oldValue,U.newValue,z):h(L.getChildPath(f,P),U.oldValue,U.newValue,z)});return}else{f=L.getChildPath(f,P);const O=Jt(P,w,v);w=O.oldValue,v=O.newValue}}d(x,w,v,T)};if(x.type.startsWith("notify_")&&L.get(x.eventPath).isAncestorOf(g)){const f=L.get(x.eventPath).isParentOf(g);(x.type==="notify_value"||x.type==="notify_child_changed"&&(!f||!["added","removed"].includes(X))||x.type==="notify_child_removed"&&X==="removed"&&f||x.type==="notify_child_added"&&X==="added"&&f)&&this.subscriptions.trigger(x.type,x.subscriptionPath,x.dataPath,null,null,n.context)}else h(g,u,V)}),k.filter(x=>["mutated","mutations","notify_mutated","notify_mutations"].includes(x.type)).forEach(x=>{let h=g;const f=x.eventPath.slice(h.length).replace(/^\//,""),w=L.getPathKeys(f);let v=u,T=V;for(;w.length>0;){const P=w.shift();h=L.getChildPath(h,P);const O=Jt(P,v,T);v=O.oldValue,T=O.newValue}const b=p(h,v,T);if(b.length===0)return;const N=x.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(x.type))b.forEach((P,O)=>{const C=n.context,U=N?null:P.oldValue,z=N?null:P.newValue;this.subscriptions.trigger(x.type,x.subscriptionPath,P.path,U,z,C)});else if(["mutations","notify_mutations"].includes(x.type)){const P=N?null:b.map(O=>({target:L.getPathKeys(O.path.slice(x.subscriptionPath.length)),prev:O.oldValue,val:O.newValue}));this.subscriptions.trigger(x.type,x.subscriptionPath,x.subscriptionPath,null,P,n.context)}})};return n.waitForIndexUpdates===!1&&ie.splice(0),yield Promise.all(ie),Mf(m),M})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(n){return $(this,arguments,function*(e,t={}){return(yield this.getNode(e,t)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,n){throw new Error("This method must be implemented by subclass")}updateNode(e,t,n){throw new Error("This method must be implemented by subclass")}transactNode(i,s){return $(this,arguments,function*(e,t,n={no_lock:!1,suppress_events:!1,context:null}){const o=n&&n.no_lock===!0,a=this.createTid(),c=o?{tid:a,release:Kf}:yield this.nodeLocker.lock(e,a,!0,"transactNode");try{let u=!1;const y=()=>{u=!0};o&&this.subscriptions.add(e,"notify_value",y);const g=yield this.getNode(e,{tid:a}),k=g.revision;let E;try{E=t(g.value),E instanceof Promise&&(E=yield E.catch(S=>{this.debug.error(`Error in transaction callback: ${S.message}`)}))}catch(S){this.debug.error(`Error in transaction callback: ${S.message}`)}if(typeof E=="undefined")return;if(o&&this.subscriptions.remove(e,"notify_value",y),u)throw new Ii("Node changed");return yield this.setNode(e,E,{assert_revision:k,tid:c.tid,suppress_events:n.suppress_events,context:n.context})}catch(u){if(u instanceof Ii)return console.warn(`node value changed, running again. Error: ${u.message}`),this.transactNode(e,t,n);throw u}finally{c.release()}})}matchNode(e,t,n){return $(this,null,function*(){var a;const i=(a=n==null?void 0:n.tid)!=null?a:Ke.generate(),s=(c,u)=>$(this,null,function*(){if(u.length===0)return Promise.resolve(!0);const y=u.reduce((A,S)=>{let I=S.key;return typeof I=="string"&&I.includes("/")&&(I=I.slice(0,I.indexOf("/"))),A.indexOf(I)<0&&A.push(I),A},[]),g=y.slice();let k=!0;const E=[];try{return yield this.getChildren(c,{tid:i,keyFilter:y}).next(A=>{var D;const S=(D=A.key)!=null?D:A.index;g.includes(S)&&g.splice(g.indexOf(A.key),1);const I=u.filter(B=>B.key===S).map(B=>({op:B.op,compare:B.compare})),R=I.length>0?o(A,I):{isMatch:!0,promises:[]};if(k=R.isMatch,k){E.push(...R.promises);const B=u.filter(M=>typeof M.key=="string"&&M.key.startsWith(`${typeof S=="number"?`[${S}]`:S}/`)).map(M=>({key:M.key.slice(M.key.indexOf("/")+1),op:M.op,compare:M.compare}));if(B.length>0){const M=L.getChildPath(c,A.key),V=s(M,B).then(W=>({isMatch:W}));E.push(V)}}if(!k||g.length===0)return!1}),k&&(k=(yield Promise.all(E)).every(S=>S.isMatch)),k?(k=g.every(A=>{const S=new wa(q(_(_({},typeof A=="number"&&{index:A}),typeof A=="string"&&{key:A}),{exists:!1})),I=u.filter(B=>typeof B.key=="string"&&B.key.startsWith(`${typeof A=="number"?`[${A}]`:A}/`)).map(B=>({op:B.op,compare:B.compare}));if(I.length>0&&!o(S,I).isMatch)return!1;const R=u.filter(B=>B.key===A).map(B=>({op:B.op,compare:B.compare}));return R.length===0?!0:o(S,R).isMatch}),k):!1}catch(A){throw this.debug.error(`Error matching on "${c}": `,A),A}}),o=(c,u)=>{const y=[];return{isMatch:u.every(k=>{let E=!0;if(k.op==="!exists"||k.op==="=="&&(typeof k.compare=="undefined"||k.compare===null))E=!c.exists;else if(k.op==="exists"||k.op==="!="&&(typeof k.compare=="undefined"||k.compare===null))E=c.exists;else if((k.op==="contains"||k.op==="!contains")&&k.compare instanceof Array&&k.compare.length===0)E=!0;else if(!c.exists)E=!1;else if(c.address)if(c.valueType===H.OBJECT&&["has","!has"].indexOf(k.op)>=0){const A=k.op==="has"?"exists":"!exists",S=s(c.path,[{key:k.compare,op:A}]).then(I=>({key:c.key,isMatch:I}));y.push(S),E=!0}else if(c.valueType===H.ARRAY&&["contains","!contains"].indexOf(k.op)>=0){const A=this.getNode(c.path,{tid:i}).then(({value:S})=>{const I=k.op==="contains"?k.compare instanceof Array?k.compare.every(R=>S.includes(R)):S.includes(k.compare):k.compare instanceof Array?!k.compare.some(R=>S.includes(R)):!S.includes(k.compare);return{key:c.key,isMatch:I}});y.push(A),E=!0}else if(c.valueType===H.STRING){const A=this.getNode(c.path,{tid:i}).then(S=>({key:c.key,isMatch:this.test(S.value,k.op,k.compare)}));y.push(A),E=!0}else E=!1;else if(c.type===H.OBJECT&&["has","!has"].indexOf(k.op)>=0){const A=k.compare in c.value;E=A&&k.op==="has"||!A&&k.op==="!has"}else if(c.type===H.ARRAY&&["contains","!contains"].indexOf(k.op)>=0){const A=c.value.indexOf(k.compare)>=0;E=A&&k.op==="contains"||!A&&k.op==="!contains"}else{let A=this.test(c.value,k.op,k.compare);A instanceof Promise&&(y.push(A),A=!0),E=A}return E}),promises:y}};return s(e,t)})}test(e,t,n){if(t==="<")return e<n;if(t==="<=")return e<=n;if(t==="==")return e===n;if(t==="!=")return e!==n;if(t===">")return e>n;if(t===">=")return e>=n;if(t==="in")return n.indexOf(e)>=0;if(t==="!in")return n.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+n.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",o=new RegExp(i,"i").test(e.toString());return t==="like"?o:!o}if(t==="matches")return n.test(e.toString());if(t==="!matches")return!n.test(e.toString());if(t==="between")return e>=n[0]&&e<=n[1];if(t==="!between")return e<n[0]||e>n[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&n in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(n);return t==="contains"?i:!i}return!1}exportNode(i,s){return $(this,arguments,function*(e,t,n={format:"json",type_safe:!0}){if((n==null?void 0:n.format)!=="json")throw new Error("Only json output is currently supported");const o=typeof t!="function"?t.write.bind(t):t,a=(A,S)=>{const I=R=>R.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,D=>`\\u${D.charCodeAt(0).toString(16).padStart(4,"0")}`);return A===H.DATETIME?(S=`"${S.toISOString()}"`,n.type_safe&&(S=`{".type":"date",".val":${S}}`)):A===H.STRING?S=`"${I(S)}"`:A===H.ARRAY?S="[]":A===H.OBJECT?S="{}":A===H.BINARY?(S=`"${I(xt.encode(S))}"`,n.type_safe&&(S=`{".type":"binary",".val":${S}}`)):A===H.REFERENCE?(S=`"${S.path}"`,n.type_safe&&(S=`{".type":"reference",".val":${S}}`)):A===H.BIGINT&&(S=`"${S}"`,n.type_safe&&(S=`{".type":"bigint",".val":${S}}`)),S};let c="",u="";const y=yield this.getNodeInfo(e);if(y.exists)if(y.type===H.OBJECT)c="{",u="}";else if(y.type===H.ARRAY)c="[",u="]";else{const A=yield this.getNode(e),S=a(y.type,A.value);return o(S)}else return o("null");if(c){const A=o(c);A instanceof Promise&&(yield A)}let g="",k=0;const E=[];if(yield this.getChildren(e).next(A=>{A.address?E.push(A):(k++>0&&(g+=","),typeof A.key=="string"&&(g+=`"${A.key}":`),g+=a(A.type,A.value))}),g){const A=o(g);A instanceof Promise&&(yield A)}for(;E.length>0;){const A=E.shift();let S=k++>0?",":"";const I=typeof A.index=="number"?A.index:A.key;if(typeof I=="string"&&(S+=`"${I}":`),S){const R=o(S);R instanceof Promise&&(yield R)}yield this.exportNode(L.getChildPath(e,I),o,n)}if(u){const A=o(u);A instanceof Promise&&(yield A)}})}importNode(i,s){return $(this,arguments,function*(e,t,n={format:"json",method:"set"}){const a={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},c=(d=!1)=>$(this,null,function*(){let p=yield t(262144);if(p===null)throw a.data?new Error(`Unexpected EOF at index ${a.offset+a.data.length}`):new Error("Unable to read data from stream");typeof p=="object"&&(p=ia(p)),d?a.data+=p:(a.offset+=a.data.length,a.data=p,a.index=0)}),u=d=>$(this,null,function*(){let p="";return a.index+d>=a.data.length&&(p=a.data.slice(a.index),d-=p.length,yield c()),p+=a.data.slice(a.index,a.index+d),a.index+=d,p}),y=d=>$(this,null,function*(){if(a.index+d>a.data.length&&(yield c(!0)),a.index+d>a.data.length)throw new Error("Not enough data available from stream")}),g=d=>$(this,null,function*(){const p=yield u(d.length);if(p!==d)throw new Error(`Unexpected character "${p[0]}" at index ${a.offset+a.index}, expected "${d}"`)}),k=()=>$(this,null,function*(){const d=[" ","	","\r",`
`];for(;a.index>=a.data.length&&(yield c()),d.includes(a.data[a.index]);)a.index++}),E=d=>$(this,null,function*(){yield y(d);const p=a.index;return a.data.slice(p,p+d)}),A=()=>$(this,null,function*(){yield k();const d=yield E(1);switch(d){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(d==="-"||d>="0"&&d<="9")return"number";throw new Error(`Unknown value at index ${a.offset+a.index}`)}}}),S=()=>$(this,null,function*(){yield g('"');let d="",p=a.index;for(;a.data[p]!=='"'||a.data[p-1]==="\\";)p++,p>=a.data.length&&(d+=a.data.slice(a.index),yield c(),p=0);return d+=a.data.slice(a.index,p),a.index=p+1,B(d)}),I=()=>$(this,null,function*(){throw a.data[a.index]==="t"?yield g("true"):a.data[a.index]==="f"&&(yield g("false")),new Error(`Expected true or false at index ${a.offset+a.index}`)}),R=()=>$(this,null,function*(){let d="",p=a.index;const m=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;m.includes(a.data[p]);)p++,p>=a.data.length&&(d+=a.data.slice(a.index),yield c(),p=0);return d+=a.data.slice(a.index,p),a.index=p,d.endsWith("n")?BigInt(d.slice(0,-1)):d.includes(".")?parseFloat(d):parseInt(d)}),D=()=>$(this,null,function*(){yield k();const d=yield A(),p=yield(()=>{switch(d){case"string":return S();case"object":return{};case"array":return[];case"number":return R();case"null":return null;case"undefined":return;case"boolean":return I()}})();return{type:d,value:p}}),B=d=>d.replace(/\\n/g,`
`).replace(/\\"/g,'"'),M=(d,p)=>{const m=p[".type"];let l=p[".val"];switch(m){case"Date":case"date":{l=new Date(l);break}case"Buffer":case"binary":{if(l=B(l),l.startsWith("<~"))l=xt.decode(l);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${d}"`);break}case"PathReference":case"reference":{l=new xe(l);break}case"bigint":{l=BigInt(l);break}default:throw new Error(`Import error: Unsupported type "${m}" for value at path "/${d}"`)}return l},V={acebase_import_id:Ke.generate()},W={suppress_events:n.suppress_events,context:V},X=d=>$(this,null,function*(){if(yield g("{"),yield k(),(yield E(1))==="}")return a.index++,this.setNode(d.path,{},W);let m=0,l={},x=!1;const h=()=>$(this,null,function*(){let v;x?Object.keys(l).length>0&&(v=this.updateNode(d.path,l,W)):(x=!0,v=this.setNode(d.path,l,W)),l={},v&&(yield v)}),f=[];for(;;){yield k();const v=yield S();yield k(),yield g(":"),yield k();const{value:T,type:b}=yield D();if(l[v]=T,m++,["object","array"].includes(b)&&(f.push(h()),b==="object"?yield X(d.child(v)):yield oe(d.child(v))),yield k(),(yield E(1))==="}"){a.index++;break}yield g(",")}if(m===2&&".type"in l&&".val"in l){const v=M(d.path,l);return this.setNode(d.path,v,W)}f.push(h()),yield Promise.all(f)}),oe=d=>$(this,null,function*(){if(yield g("["),yield k(),(yield E(1))==="]")return a.index++,this.setNode(d.path,[],W);let m=!1,l=[],x={};const h=()=>$(this,null,function*(){let T;m?Object.keys(x).length>0&&(T=this.updateNode(d.path,x,W),x={}):(m=!0,T=this.setNode(d.path,l,W),l=null),T&&(yield T)}),f=(T,b)=>{m?x[b]=T:l.push(T)},w=[];let v=0;for(;;){yield k();const{value:T,type:b}=yield D();if(f(T,v),["object","array"].includes(b)&&(w.push(h()),b==="object"?yield X(d.child(v)):yield oe(d.child(v))),yield k(),(yield E(1))==="]"){a.index++;break}yield g(","),v++}w.push(h()),yield Promise.all(w)});return(()=>$(this,null,function*(){const{value:d,type:p}=yield D();if(["object","array"].includes(p)){const m=L.get(e);p==="object"?yield X(m):yield oe(m)}else yield this.setNode(e,d,W)}))()})}setSchema(e,t,n=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const o=this._schemas.findIndex(a=>a.path===e);o>=0&&this._schemas.splice(o,1);return}const i=new _f(t,{warnOnly:n,warnCallback:o=>this.debug.warn(o)}),s=this._schemas.find(o=>o.path===e);s?s.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((o,a)=>{const c=L.getPathKeys(o.path),u=L.getPathKeys(a.path);return c.length===u.length?0:c.length<u.length?-1:1}))}getSchema(e){const t=this._schemas.find(n=>n.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,n={updates:!1}){let i={ok:!0};const s=L.get(e);return this._schemas.filter(o=>s.isOnTrailOf(o.path)).every(o=>{if(s.isDescendantOf(o.path)){const y=L.fillVariables(o.path,e),g=s.keys.slice(L.getPathKeys(o.path).length);return i=o.schema.check(y,t,n.updates,g),i.ok}const a=L.getPathKeys(o.path).slice(s.keys.length);if(n.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=n.updates===!0&&a.length===0,u=(y,g,k)=>{if(k.length===0)return o.schema.check(y,g,c);if(g===null)return{ok:!0};const E=k[0];if(typeof E=="string"&&(E==="*"||E[0]==="$")){if(g===null||typeof g!="object")return{ok:!0};let A;return Object.keys(g).every(S=>{const I=L.getChildPath(y,S),R=g[S];return A=u(I,R,k.slice(1)),A.ok}),A}else{const A=L.getChildPath(y,E),S=g[E];return u(A,S,k.slice(1))}};return i=u(e,t,a),i.ok}),i}}class Cn{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return L}}class oo{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:Vf}=ca;class ss{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Ke.generate()}getChildCount(e){return $(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return $(this,null,function*(){const t=new Map;return yield Promise.all(e.map(n=>this.get(n).then(i=>t.set(n,i)))),t})}setMultiple(e){return $(this,null,function*(){yield Promise.all(e.map(({path:t,node:n})=>this.set(t,n)))})}removeMultiple(e){return $(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return $(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return $(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(Cn.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class Bn extends is{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,n=t?new ba(console,this.lockTimeout):null;this.getTransaction=o=>$(this,[o],function*({path:i,write:s}){const a=yield e.getTransaction({path:i,write:s});Je(typeof a.id=="string","transaction id not set");const c=a.rollback,u=a.commit;return a.commit=()=>$(this,null,function*(){const y=yield u.call(a);return t&&(yield a._lock.release("commit")),y}),a.rollback=y=>$(this,null,function*(){const g=yield c.call(a,y);return t&&(yield a._lock.release("rollback")),g}),t&&(a._lock=yield n.lock(i,a.id,s,`${this.name}::getTransaction`)),a})}}class oi extends wa{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class Hf extends zf{constructor(e,t,n){super(e,t,n),this._customImplementation=t,this._init()}_init(){return $(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize(Re.dim)),this.debug.log("- Type: CustomStorage".colorize(Re.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize(Re.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize(Re.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize(Re.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,n){const i=o=>{if(o===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof o))return o;if(o instanceof Date)return{type:H.DATETIME,value:o.getTime()};if(o instanceof xe)return{type:H.REFERENCE,value:o.path};if(o instanceof ArrayBuffer)return{type:H.BINARY,value:xt.encode(o)};if(typeof o=="object")return Je(Object.keys(o).length===0,"child object stored in parent can only be empty"),o},s="Caller should have pre-processed the value by converting it to a string";if(t.type===H.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${s}`);const o={};for(let a=0;a<t.value.length;a++)o[a]=t.value[a];t.value=o}if(t.type===H.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${s}`),t.value=xt.encode(t.value)),t.type===H.REFERENCE&&t.value instanceof xe&&(console.warn(`Unprocessed path reference. ${s}`),t.value=t.value.path),[H.OBJECT,H.ARRAY].includes(t.type)){const o=t.value;t.value={},Object.keys(o).forEach(a=>{t.value[a]=i(o[a])})}return n.transaction.set(e,t)}_processReadNodeValue(e){const t=n=>{if(n.type===H.BINARY)return xt.decode(n.value);if(n.type===H.DATETIME)return new Date(n.value);if(n.type===H.REFERENCE)return new xe(n.value);throw new Error(`Unhandled child value type ${n.type}`)};switch(e.type){case H.ARRAY:case H.OBJECT:{const n=e.value;Object.keys(n).forEach(i=>{const s=n[i];typeof s=="object"&&"type"in s&&(n[i]=t(s))}),e.value=n;break}case H.BINARY:{e.value=xt.decode(e.value);break}case H.REFERENCE:{e.value=new xe(e.value);break}case H.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return $(this,null,function*(){const n=yield t.transaction.get(e);return n===null?null:(typeof n!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(n),n)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=H.STRING;else if(typeof e=="number")t=H.NUMBER;else if(typeof e=="boolean")t=H.BOOLEAN;else if(e instanceof Array)t=H.ARRAY;else if(typeof e=="object")if("type"in e){const n=e;t=n.type,e=n.value,t===H.DATETIME?e=new Date(e):t===H.REFERENCE&&(e=new xe(e))}else t=H.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,n){return $(this,null,function*(){if(!n.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof n.diff=="undefined"&&typeof n.currentValue!="undefined"){const A=Vf(n.currentValue,t);n.merge&&typeof A=="object"&&(A.removed=A.removed.filter(S=>t[S]===null)),n.diff=A}if(n.diff==="identical")return;const i=n.transaction,s=n.currentValue===null?null:yield this._readNode(e,{transaction:i});if(n.merge&&s){if(s.type===H.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(A=>isNaN(parseInt(A))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&s.type!==H.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const o=n.revision||Ke.generate(),a={type:s&&s.type===H.ARRAY?H.ARRAY:H.OBJECT,value:{}},c={};if(t instanceof Array){a.type=H.ARRAY;const A={};for(let S=0;S<t.length;S++)A[S]=t[S];t=A}else t instanceof xe?(a.type=H.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=H.BINARY,a.value=xt.encode(t)):typeof t=="string"&&(a.type=H.STRING,a.value=t);const u=s?[H.OBJECT,H.ARRAY].includes(s.type):!1,y=[H.OBJECT,H.ARRAY].includes(a.type),g={current:[],new:[]};let k=null;u&&(k=s.value,g.current=Object.keys(k),y&&(a.value=k)),y&&(n.merge||Object.keys(a.value).forEach(A=>{A in t||(t[A]=null)}),Object.keys(t).forEach(A=>{const S=t[A];if(delete a.value[A],S!==null){if(typeof S=="undefined")if(this.settings.removeVoidProperties===!0){delete t[A];return}else throw new Error(`Property "${A}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(S)?a.value[A]=S:c[A]=S}}));const E=a.type===H.ARRAY;if(s){if(this.debug.log(`Node "/${e}" is being ${n.merge?"updated":"overwritten"}`.colorize(Re.cyan)),u||y){const S=L.get(e),I=[];let R=!1;const D=d=>(R=!0,!i.production&&!S.isParentOf(d)&&this.throwImplementationError(`"${d}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),B=d=>{R||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const p=L.get(d).key;return I.push(p.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},D,B),g.current=g.current.concat(I),y&&(n&&n.merge&&(g.new=g.current.slice()),Object.keys(t).forEach(d=>{g.new.includes(d)||g.new.push(d)}));const M={insert:g.new.filter(d=>!g.current.includes(d)),update:[],delete:n&&n.merge?Object.keys(t).filter(d=>t[d]===null):g.current.filter(d=>!g.new.includes(d))};if(M.update=g.new.filter(d=>g.current.includes(d)&&!M.delete.includes(d)),E&&n.merge&&(M.insert.length>0||M.delete.length>0)&&!M.update.concat(M.insert).every((m,l,x)=>x.includes(l.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const V=Object.keys(c).map(d=>{const p=E?parseInt(d):d,m=typeof n.diff=="object"?n.diff.forChild(p):void 0;if(m==="identical")return;const l=S.childPath(p),x=c[p],h=typeof n.currentValue=="undefined"?void 0:n.currentValue!==null&&typeof n.currentValue=="object"&&p in n.currentValue?n.currentValue[p]:null;return this._writeNode(l,x,{transaction:i,revision:o,merge:!1,currentValue:h,diff:m})}),W=y?I.filter(d=>d in a.value):[],oe=M.delete.concat(W).map(d=>{const p=E?parseInt(d):d,m=S.childPath(p);return this._deleteNode(m,{transaction:i})}),ie=V.concat(oe);yield Promise.all(ie)}const A=this._storeNode(e,{type:a.type,value:a.value,revision:s.revision,revision_nr:s.revision_nr+1,created:s.created,modified:Date.now()},{transaction:i});if(A instanceof Promise)return yield A}else{if(this.debug.log(`Node "/${e}" is being created`.colorize(Re.cyan)),E&&!Object.keys(a.value).concat(Object.keys(c)).every((D,B,M)=>M.includes(B.toString())))throw new Error("Cannot store arrays with missing entries");const A=Object.keys(c).map(I=>{const R=E?parseInt(I):I,D=L.getChildPath(e,R),B=c[R];return this._writeNode(D,B,{transaction:i,revision:o,merge:!1,currentValue:null})}),S=this._storeNode(e,{type:a.type,value:a.value,revision:o,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});S instanceof Promise&&A.push(S),yield Promise.all(A)}})}_deleteNode(e,t){return $(this,null,function*(){const n=L.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize(Re.cyan));const i=[e];let s=!1;const o=u=>(s=!0,!c.production&&!n.isAncestorOf(u)&&this.throwImplementationError(`"${u}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=u=>(s||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(u),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},o,a),this.debug.log(`Nodes ${i.map(u=>`"/${u}"`).join(",")} are being deleted`.colorize(Re.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let n;const i={next(o){return n=o,s()}},s=()=>$(this,null,function*(){const o=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>$(this,null,function*(){const c=yield this._readNode(e,{transaction:o});if(!c)throw new ns(`Node "/${e}" does not exist`);if(![H.OBJECT,H.ARRAY].includes(c.type))return;const u=c.type===H.ARRAY,y=c.value;let g=Object.keys(y).map(I=>u?parseInt(I):I);t.keyFilter&&(g=g.filter(I=>t.keyFilter.includes(I)));const k=L.get(e);if(g.length>0&&g.every(I=>{const R=this._getTypeFromStoredValue(y[I]),D=new oi({path:k.childPath(I),key:u?null:I,index:u?I:null,type:R.type,address:null,exists:!0,value:R.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=n(D)===!1,!a}),a)return;let E=!1;const A=I=>{if(E=!0,!o.production&&!k.isParentOf(I)&&this.throwImplementationError(`"${I}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const R=L.get(I).key;return t.keyFilter.includes(R)}return!0},S=(I,R)=>{E||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const D=L.get(I).key,B=new oi({path:I,type:R.type,key:u?null:D,index:u?D:null,address:new oo(I),exists:!0,value:null,revision:R.revision,revision_nr:R.revision_nr,created:new Date(R.created),modified:new Date(R.modified)});return a=n(B)===!1,!a};yield o.childrenOf(e,{metadata:!0,value:!1},A,S)}))(),t.transaction||(yield o.commit()),a}catch(a){throw t.transaction||(yield o.rollback(a)),a}});return i}getNode(e,t){return $(this,null,function*(){t=t||{};const n=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>$(this,null,function*(){const s=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,o=L.get(e),a=yield this._readNode(e,{transaction:n});if(!a){if(e==="")return{value:null};const B=yield n.moveToParentPath(o.parentPath);Je(B===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const M=yield this._readNode(o.parentPath,{transaction:n});if(M&&[H.OBJECT,H.ARRAY].includes(M.type)&&o.key in M.value){const V=this._getTypeFromStoredValue(M.value[o.key]);return{revision:M.revision,revision_nr:M.revision_nr,created:M.created,modified:M.modified,type:V.type,value:V.value}}return{value:null}}const c=a.type===H.ARRAY,u=B=>{const M=V=>/^[0-9]+$/.test(V);return B.map(V=>L.get(c&&M(V)?`[${V}]`:V))},y=t.include?u(t.include):[],g=t.exclude?u(t.exclude):[],k=(B,M)=>{if([H.OBJECT,H.ARRAY].includes(M.type)&&y.length>0){const V=L.getPathKeys(B).slice(o.keys.length),W=new L(V),X=[],oe=y.filter(p=>p.isDescendantOf(W));if(oe.length>0){const p=M.type===H.ARRAY;X.push(...Object.keys(M.value).map(m=>p?+m:m));for(const m of oe){const l=m.keys[V.length];if(typeof l=="string"&&(l==="*"||l.startsWith("$"))){X.splice(0);break}const x=X.indexOf(l);x>=0&&X.splice(x,1)}}const ie=y.some(p=>p.isChildOf(W));if(g.some(p=>p.isChildOf(W))&&!ie){const p=g.filter(m=>m.isChildOf(W));for(let m=0;m<X.length;m++)p.find(l=>l.equals(X[m]))||(X.splice(m,1),m--)}for(const p of X)delete M.value[p]}};k(e,a);let E=!1;const A=(B,M)=>{if(E=!0,!n.production&&!o.isAncestorOf(B)&&this.throwImplementationError(`"${B}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!s)return!0;const W=L.getPathKeys(B).slice(o.keys.length),X=new L(W);let oe=(y.length>0?y.some(ie=>X.isOnTrailOf(ie)):!0)&&(g.length>0?!g.some(ie=>ie.equals(X)||ie.isAncestorOf(X)):!0);return oe&&t.child_objects===!1&&(o.isParentOf(B)&&[H.OBJECT,H.ARRAY].includes(M?M.type:-1)||L.getPathKeys(B).length>o.pathKeys.length+1)&&(oe=!1),oe},S=[],I=(B,M)=>{if(E||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[H.OBJECT,H.ARRAY].includes(M.type))return!0;k(B,M),this._processReadNodeValue(M);const V=M;return V.path=B,S.push(V),!0};yield n.descendantsOf(e,{metadata:!0,value:!0},A,I),this.debug.log(`Read node "/${e}" and ${s?"(filtered) ":""}descendants from ${S.length+1} records`.colorize(Re.magenta));const R=a,D=B=>{const M=[];return Object.keys(B).forEach(V=>{const W=parseInt(V);M[W]=B[W]}),M};if(a.type===H.ARRAY&&(R.value=D(R.value)),a.type===H.OBJECT||a.type===H.ARRAY){const B=L.getPathKeys(e),M=a.value;for(let V=0;V<S.length;V++){const W=S[V],oe=L.getPathKeys(W.path).slice(B.length);let ie=M;for(let d=0;d<oe.length;d++){Je(typeof ie=="object","parent must be an object/array to have children!!");const p=oe[d],m=d===oe.length-1,l=m?W.type:typeof oe[d+1]=="number"?H.ARRAY:H.OBJECT;let x;m?(x=W.value,l===H.ARRAY&&(x=D(x))):x=l===H.OBJECT?{}:[],p in ie?typeof ie[p]==typeof x&&[H.OBJECT,H.ARRAY].includes(l)?Object.keys(x).forEach(f=>{f in ie[p]&&this.throwImplementationError(`Custom storage merge error: child key "${f}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),ie[p][f]=x[f]}):this.debug.error(`The value stored in node "${W.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:ie,key:p,nodeType:l,nodeValue:x}):ie[p]=x,ie=ie[p]}}}else S.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(R.value).forEach(B=>{typeof R.value[B]=="object"&&R.value[B].constructor===Object&&(Je(Object.keys(R.value[B]).length===0),delete R.value[B])}),t.include,t.exclude){const B=(M,V)=>{if(typeof M!="object")return;const W=V[0];W==="*"?Object.keys(M).forEach(X=>{B(M[X],V.slice(1))}):V.length>1?W in M&&B(M[W],V.slice(1)):delete M[W]};t.exclude.forEach(M=>{const V=L.getPathKeys(M);B(R.value,V)})}return R}))();return t.transaction||(yield n.commit()),i}catch(i){throw t.transaction||(yield n.rollback(i)),i}})}getNodeInfo(n){return $(this,arguments,function*(e,t={}){t=t||{};const i=L.get(e),s=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const o=yield this._readNode(e,{transaction:s}),a=new oi({path:e,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:o?o.type:0,exists:o!==null,address:o?new oo(e):null,created:o?new Date(o.created):null,modified:o?new Date(o.modified):null,revision:o?o.revision:null,revision_nr:o?o.revision_nr:null});if(!o&&e!==""){const c=yield s.moveToParentPath(i.parentPath);Je(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const u=yield this._readNode(i.parentPath,{transaction:s});u&&[H.OBJECT,H.ARRAY].includes(u.type)&&i.key in u.value?(a.exists=!0,a.value=u.value[i.key],a.address=null,a.type=u.type,a.created=new Date(u.created),a.modified=new Date(u.modified),a.revision=u.revision,a.revision_nr=u.revision_nr):a.address=null}return t.include_child_count&&(a.childCount=0,[H.OBJECT,H.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=o.value?Object.keys(o.value).length:0,a.childCount+=yield s.getChildCount(e))),t.transaction||(yield s.commit()),a}catch(o){throw t.transaction||(yield s.rollback(o)),o}})}setNode(i,s){return $(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const o=L.get(e),a=n.transaction||(yield this._customImplementation.getTransaction({path:e,write:!0}));try{if(e===""){if(t===null||typeof t!="object"||t instanceof Array||t instanceof ArrayBuffer||"buffer"in t&&t.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${t}`);yield this._writeNodeWithTracking("",t,{merge:!1,transaction:a,suppress_events:n.suppress_events,context:n.context})}else if(typeof n.assert_revision!="undefined"){const c=yield this.getNodeInfo(e,{transaction:a});if(c.revision!==n.assert_revision)throw new Ii(`revision '${c.revision}' does not match requested revision '${n.assert_revision}'`);if(c.address&&c.address.path===e&&t!==null&&!this.valueFitsInline(t))yield this._writeNodeWithTracking(e,t,{merge:!1,transaction:a,suppress_events:n.suppress_events,context:n.context});else{const u=yield a.moveToParentPath(o.parentPath);Je(u===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this._writeNodeWithTracking(o.parentPath,{[o.key]:t},{merge:!0,transaction:a,suppress_events:n.suppress_events,context:n.context})}}else{const c=yield a.moveToParentPath(o.parentPath);Je(c===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this.updateNode(o.parentPath,{[o.key]:t},{transaction:a,suppress_events:n.suppress_events,context:n.context})}n.transaction||(yield a.commit())}catch(c){throw n.transaction||(yield a.rollback(c)),c}})}updateNode(i,s){return $(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof t!="object")throw new Error("invalid updates argument");if(Object.keys(t).length===0)return;const o=n.transaction||(yield this._customImplementation.getTransaction({path:e,write:!0}));try{const a=yield this.getNodeInfo(e,{transaction:o}),c=L.get(e);if(a.exists&&a.address&&a.address.path===e)yield this._writeNodeWithTracking(e,t,{transaction:o,merge:!0,suppress_events:n.suppress_events,context:n.context});else if(a.exists){const u=L.get(e),y=yield o.moveToParentPath(u.parentPath);Je(y===u.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this._writeNodeWithTracking(u.parentPath,{[u.key]:t},{transaction:o,merge:!0,suppress_events:n.suppress_events,context:n.context})}else{const u=yield o.moveToParentPath(c.parentPath);Je(u===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this.updateNode(c.parentPath,{[c.key]:t},{transaction:o,suppress_events:n.suppress_events,context:n.context})}n.transaction||(yield o.commit())}catch(a){throw n.transaction||(yield o.rollback(a)),a}})}}class Jf{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return $(this,null,function*(){var n,i;try{this.running++;const s=yield e();if(this.results[t]=s,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(n=this.doneCallback)==null||n.call(this,this.results);else if(this.scheduled.length>0){const o=this.scheduled.shift();this.execute(o.task,o.index)}}catch(s){this.done=!0,(i=this.errorCallback)==null||i.call(this,s)}})}add(e){var n;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const t=this.added++;((n=this.options)==null?void 0:n.wait)!==!0&&this.running<this.limit?this.execute(e,t):this.scheduled.push({task:e,index:t})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return $(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const qf=()=>{};function Aa(i,s,o){return $(this,arguments,function*(r,e,t,n={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:qf}){var X,oe,ie,d,p,m;typeof n!="object"&&(n={}),typeof n.snapshots=="undefined"&&(n.snapshots=!1);const a={};(X=r.storage.settings.transactions)!=null&&X.log&&(a.acebase_cursor=Ke.generate());const c=t.filters.map(l=>_({},l)),u=t.order.map(l=>_({},l)),y=l=>{l.sort((x,h)=>{const f=w=>{const v=u[w],T=L.getPathKeys(typeof v.key=="number"?`[${v.key}]`:v.key),b=T.reduce((P,O)=>P!==null&&typeof P=="object"&&O in P?P[O]:null,x.val),N=T.reduce((P,O)=>P!==null&&typeof P=="object"&&O in P?P[O]:null,h.val);return b===null?N===null?0:v.ascending?-1:1:N===null?v.ascending?1:-1:b==N?w<u.length-1?f(w+1):x.path<h.path?-1:1:b<N?v.ascending?-1:1:v.ascending?1:-1};return f(0)})},g=(l,x)=>$(this,null,function*(){if(l.length===0)return[];const h=50,f=new Jf(h),w=[];return l.forEach(({path:v},T)=>f.add(()=>$(this,null,function*(){const N=(yield r.storage.getNode(v,x)).value;if(N===null){r.storage.debug.warn(`Indexed result "/${v}" does not have a record!`);return}const P={path:v,val:N};W.sorted?w[T]=P:(w.push(P),!W.skipped&&w.length>t.skip+Math.abs(t.take)&&(y(w),w.pop()))}))),yield f.finish(),w}),k=L.get(e),E=k.keys.some(l=>l==="*"||l.toString().startsWith("$")),A=r.storage.indexes.get(e),S=[];let I=()=>$(this,null,function*(){});if(E){const l=k.keys.filter(f=>typeof f=="string"&&f.startsWith("$")),x=l.length>0&&l.every(f=>t.filters.some(w=>w.key===f&&["==","in"].includes(w.op))),h=typeof n.monitor=="object"&&[(oe=n.monitor)==null?void 0:oe.add,(ie=n.monitor)==null?void 0:ie.change,(d=n.monitor)==null?void 0:d.remove].some(f=>f===!0);if(x&&!h){const f=[];for(const O of l){const U=t.filters.filter(Q=>Q.key===O).reduce((Q,K)=>{if(K.op==="=="&&Q.push(K.compare),K.op==="in"){if(!(K.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");Q.push(...K.compare)}return Q},[]),z=f.splice(0);U.forEach(Q=>{z.length===0?f.push({[O]:Q}):f.push(...z.map(K=>q(_({},K),{[O]:Q})))})}const w=t.filters.filter(O=>!l.includes(O.key)),v=f.map(O=>L.get(L.getPathKeys(e).map(C=>{var U;return(U=O[C])!=null?U:C})).path),T=t.order.length>0,b=v.map(O=>{var C;return Aa(r,O,{filters:w,take:0,skip:0,order:[]},{snapshots:T,cache_mode:n.cache_mode,include:[...(C=n.include)!=null?C:[],...t.order.map(U=>U.key)],exclude:n.exclude})});let P=(yield Promise.all(b)).reduce((O,C)=>(O.push(...C.results),O),[]);if(T&&y(P),t.skip>0&&P.splice(0,t.skip),t.take>0&&P.splice(t.take),n.snapshots&&(!T||((p=n.include)==null?void 0:p.length)>0||((m=n.exclude)==null?void 0:m.length)>0||!n.child_objects)){const{include:O,exclude:C,child_objects:U}=n;P=yield g(P,{include:O,exclude:C,child_objects:U})}return{results:P,context:null,stop:I}}else if(A.length===0){const f=new Error(`Query on wildcard path "/${e}" requires an index`);return Promise.reject(f)}if(c.length===0){const f=A.filter(w=>w.type==="normal")[0];c.push({key:f.key,op:"!=",compare:null})}}c.forEach(l=>{if(l.index)return;const x=A.filter(h=>h.key===l.key).filter(h=>h.validOperators.includes(l.op));if(x.length>=1){const h=c.filter(T=>T!==l).map(T=>T.key),f=u.map(T=>T.key).filter(T=>T!==l.key),w=x.map(T=>{const b=T.includeKeys.concat(T.key),N=b.filter(U=>h.includes(U)),P=b.filter(U=>f.includes(U)),O=N.concat(P.filter(U=>!N.includes(U))),C={filters:N.length,sorting:P.length*(t.take!==0?P.length:1),both:O.length*O.length,get total(){return this.filters+this.sorting+this.both}};return{index:T,points:C.total,filterKeys:N,sortKeys:P}});w.sort((T,b)=>T.points>b.points?-1:1);const v=w[0];l.index=v.index,v.filterKeys.forEach(T=>{c.filter(b=>b!==l&&b.key===T).forEach(b=>{!rs.validOperators.includes(b.op)||(b.indexUsage="filter",b.index=v.index)})}),v.sortKeys.forEach(T=>{u.filter(b=>b.key===T).forEach(b=>{b.index=v.index})})}l.index&&S.push({index:l.index,description:l.index.description})}),u.length>0&&t.take!==0&&c.length===0&&u.forEach(l=>{l.index||(l.index=A.filter(x=>x.key===l.key).find(x=>x.type==="normal"))});const R=S.map(l=>l.description).join(", ");S.length>0&&r.storage.debug.log(`Using indexes for query: ${R}`);const D=c.filter(l=>!l.index),B=/^[a-z]+:/i;if(D.some(l=>B.test(l.op))){const l=D.find(h=>B.test(h.op)),x=new Error(`query contains operator "${l.op}" which requires a special index that was not found on path "${e}", key "${l.key}"`);return Promise.reject(x)}const M=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let l=0;l<D.length;l++){const x=D[l];if(!M.includes(x.op))return Promise.reject(new Error(`query contains unknown filter operator "${x.op}" on path "${e}", key "${x.key}"`))}if(E&&D.length>0){const l=D.reduce((h,f)=>(h.indexOf(f.key)<0&&h.push(f.key),h),[]).map(h=>`"${h}"`),x=new Error(`This wildcard path query on "/${e}" requires index(es) on key(s): ${l.join(", ")}. Create the index(es) and retry`);return Promise.reject(x)}const V=[];c.forEach(l=>{if(l.index&&l.indexUsage!=="filter"){let x=l.index.query(l.op,l.compare).then(f=>(n.eventHandler&&n.eventHandler({name:"stats",type:"index_query",source:l.index.description,stats:f.stats}),f.hints.length>0&&n.eventHandler&&n.eventHandler({name:"hints",type:"index_query",source:l.index.description,hints:f.hints}),f));const h=c.filter(f=>f.index===l.index&&f.indexUsage==="filter");h.length>0&&(x=x.then(f=>(h.forEach(w=>{const{key:v,op:T,index:b}=w;let{compare:N}=w;typeof N=="string"&&!b.caseSensitive&&(N=N.toLocaleLowerCase(b.textLocale)),f=f.filterMetadata(v,T,N)}),f))),V.push(x)}});const W={filtered:c.length===0,skipped:t.skip===0,taken:t.take===0,sorted:u.length===0,preDataLoaded:!1,dataLoaded:!1};if(c.length===0&&t.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${e}"`),t.take=100),u.length>0&&u[0].index){const l=u[0].index,x=t.take<0?!u[0].ascending:u[0].ascending;if(c.length===0&&u.slice(1).every(h=>l.allMetadataKeys.includes(h.key))){r.storage.debug.log(`Using index for sorting: ${l.description}`);const h=u.slice(1).map(w=>(w.index=l,{key:w.key,ascending:w.ascending})),f=l.take(t.skip,Math.abs(t.take),{ascending:x,metadataSort:h}).then(w=>(n.eventHandler&&n.eventHandler({name:"stats",type:"sort_index_take",source:l.description,stats:w.stats}),w.hints.length>0&&n.eventHandler&&n.eventHandler({name:"hints",type:"sort_index_take",source:l.description,hints:w.hints}),w));V.push(f),W.skipped=!0,W.taken=!0,W.sorted=!0}}return Promise.all(V).then(l=>$(this,null,function*(){let x=[];if(l.length===1){const N=l[0];x=N.map(P=>{const O={key:P.key,path:P.path,val:{[N.filterKey]:P.value}};return P.metadata&&Object.assign(O.val,P.metadata),O}),W.filtered=!0}else if(l.length>1){l.sort((O,C)=>O.length<C.length?-1:1);const N=l[0],P=l.slice(1);x=N.reduce((O,C)=>{const U={key:C.key,path:C.path,val:{[N.filterKey]:C.value}};return P.every(Q=>Q.findIndex(K=>K.path===C.path)>=0)&&(C.metadata&&Object.assign(U.val,C.metadata),P.forEach(Q=>{const K=Q.find(ge=>ge.path===U.path);U.val[Q.filterKey]=K.value,K.metadata&&Object.assign(U.val,K.metadata)}),O.push(U)),O},[]),W.filtered=!0}if(E||V.length>0&&D.length===0){if(u.length===0||u.every(N=>N.index)){if(W.preDataLoaded=!0,!W.sorted&&u.length>0&&y(x),W.sorted=!0,!W.skipped&&t.skip>0&&(x=t.take<0?x.slice(0,-t.skip):x.slice(t.skip)),!W.taken&&t.take!==0&&(x=t.take<0?x.slice(t.take):x.slice(0,t.take)),W.skipped=!0,W.taken=!0,!n.snapshots)return x;const N={include:n.include,exclude:n.exclude,child_objects:n.child_objects};return g(x,N).then(P=>(W.dataLoaded=!0,P))}if(n.snapshots||!W.sorted){const N=u.length>0,P=N?{include:u.map(O=>O.key)}:{include:n.include,exclude:n.exclude,child_objects:n.child_objects};return g(x,P).then(O=>(u.length>0&&y(O),W.sorted=!0,t.skip>0&&(O=t.take<0?O.slice(0,-t.skip):O.slice(t.skip)),t.take!==0&&(O=t.take<0?O.slice(t.take):O.slice(0,t.take)),W.skipped=!0,W.taken=!0,n.snapshots&&N?g(O,{include:n.include,exclude:n.exclude,child_objects:n.child_objects}):O))}else return x}let h;x.length>0&&(h=x.map(N=>N.key));let f=[],w=!1;const v=u.length>0,T=v?{include:u.map(N=>N.key)}:{include:n.include,exclude:n.exclude,child_objects:n.child_objects},b={promises:[],add(N){if(this.promises.push(N),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then(P=>{})}};try{yield r.storage.getChildren(e,{keyFilter:h,async:!0}).next(N=>{if(N.type!==H.OBJECT||!N.address)return;if(w)return!1;const P=()=>$(this,null,function*(){if(!(yield r.storage.matchNode(N.address.path,D)))return;const U=N.address.path;let z;if(n.snapshots||u.length>0){const Q=yield r.storage.getNode(U,T);z={path:U,val:Q.value}}else z={path:U};f.push(z),t.take!==0&&f.length>Math.abs(t.take)+t.skip&&(u.length>0?y(f):t.take>0&&(w=!0),f.pop())}),O=b.add(P());if(O instanceof Promise)return O})}catch(N){return N instanceof ns||r.storage.debug.warn(`Error getting child stream: ${N}`),[]}return yield Promise.all(b.promises),W.preDataLoaded=v,W.dataLoaded=!v,u.length>0&&y(f),W.sorted=!0,t.skip>0&&(f=t.take<0?f.slice(0,-t.skip):f.slice(t.skip)),W.skipped=!0,t.take!==0&&(f=t.take<0?f.slice(t.take):f.slice(0,t.take)),W.taken=!0,W.dataLoaded||(f=yield g(f,{include:n.include,exclude:n.exclude,child_objects:n.child_objects}),W.dataLoaded=!0),f})).then(l=>{if(!W.sorted&&u.length>0&&y(l),n.snapshots||(l=l.map(x=>x.path)),!W.skipped&&t.skip>0&&(l=t.take<0?l.slice(0,-t.skip):l.slice(t.skip)),!W.taken&&t.take!==0&&(l=t.take<0?l.slice(t.take):l.slice(0,t.take)),n.monitor===!0&&(n.monitor={add:!0,change:!0,remove:!0}),typeof n.monitor=="object"&&(n.monitor.add||n.monitor.change||n.monitor.remove)){const x=n.monitor,h=n.snapshots?l.map(O=>O.path):l.slice(),f=r.db.ref(e),w=O=>{const C=h.indexOf(O);C<0||h.splice(C,1)},v=O=>{h.includes(O)||h.push(O)},T=()=>{r.unsubscribe(f.path,"child_changed",b),r.unsubscribe(f.path,"child_added",N),r.unsubscribe(f.path,"notify_child_removed",P)};I=()=>$(this,null,function*(){T()});const b=(O,C,U,z)=>$(this,null,function*(){const Q=h.includes(C);let K=!0;const ge=[];c.forEach(se=>!ge.includes(se.key)&&ge.push(se.key));const ae=[];typeof z=="object"&&Object.keys(z).forEach(se=>!ae.includes(se)&&ae.push(se)),typeof U=="object"&&Object.keys(U).forEach(se=>!ae.includes(se)&&ae.push(se));const ce=[];let pe=ae.every(se=>ge.includes(se)?c.filter(le=>le.key===se).every(le=>{var Ae;return((Ae=le.index)==null?void 0:Ae.textLocaleKey)&&!ae.includes(le.index.textLocaleKey)?(ce.push(le.index.textLocaleKey),!0):M.includes(le.op)?r.storage.test(U[se],le.op,le.compare):le.index.test(U,le.op,le.compare)}):!0);if(pe&&(ce.push(...ge.filter(se=>!ae.includes(se))),!Q&&ce.length>0)){const se=c.filter(Ae=>ce.includes(Ae.key)),we=se.filter(Ae=>M.includes(Ae.op)),le=se.filter(Ae=>!M.includes(Ae.op));if(we.length>0&&(pe=yield r.storage.matchNode(C,we)),pe&&le.length>0){const Ae=le.reduce((Pe,We)=>(Pe.includes(We.key)||Pe.push(We.key),We.index instanceof xa&&We.index.config.localeKey&&!Pe.includes(We.index.config.localeKey)&&Pe.push(We.index.config.localeKey),Pe),[]),ve=yield r.storage.getNode(C,{include:Ae});if(ve.value===null)return!1;pe=le.every(Pe=>Pe.index.test(ve.value,Pe.op,Pe.compare))}}if(pe){if(Q||v(C),n.snapshots){const se={include:n.include,exclude:n.exclude,child_objects:n.child_objects};U=(yield r.storage.getNode(C,se)).value}Q&&x.change?K=n.eventHandler({name:"change",path:C,value:U})!==!1:!Q&&x.add&&(K=n.eventHandler({name:"add",path:C,value:U})!==!1)}else Q&&(w(C),x.remove&&(K=n.eventHandler({name:"remove",path:C,value:z})!==!1));K===!1&&T()}),N=(O,C,U)=>{const z=c.every(K=>M.includes(K.op)?r.storage.test(U[K.key],K.op,K.compare):K.index.test(U,K.op,K.compare));let Q=!0;z&&(v(C),x.add&&(Q=n.eventHandler({name:"add",path:C,value:n.snapshots?U:null})!==!1)),Q===!1&&T()},P=(O,C,U,z)=>{let Q=!0;w(C),x.remove&&(Q=n.eventHandler({name:"remove",path:C,value:n.snapshots?z:null})!==!1),Q===!1&&T()};(n.monitor.add||n.monitor.change||n.monitor.remove)&&r.subscribe(f.path,"child_changed",b),n.monitor.remove&&r.subscribe(f.path,"notify_child_removed",P),n.monitor.add&&r.subscribe(f.path,"child_added",N)}return{results:l,context:a,stop:I}})})}class Yf extends xf{constructor(e="default",t,n){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(ro&&t.settings.storage instanceof ro)this.storage=new If(e,t.settings.storage,i);else if(io&&t.settings.storage instanceof io)this.storage=new Pf(e,t.settings.storage,i);else if(Bn&&t.settings.storage instanceof Bn)this.storage=new Hf(e,t.settings.storage,i);else{const s=t.settings.storage instanceof ii?t.settings.storage:new ii(t.settings.storage);this.storage=new _i(e,s,i)}else this.storage=new _i(e,new ii,i);this.storage.on("ready",n)}stats(e){return $(this,null,function*(){return this.storage.stats})}subscribe(e,t,n){this.storage.subscriptions.add(e,t,n)}unsubscribe(e,t,n){this.storage.subscriptions.remove(e,t,n)}set(i,s){return $(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.setNode(e,t,{suppress_events:n.suppress_events,context:n.context});return _({},o&&{cursor:o})})}update(i,s){return $(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.updateNode(e,t,{suppress_events:n.suppress_events,context:n.context});return _({},o&&{cursor:o})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return $(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const n=yield this.storage.getNode(e,t);return{value:n.value,context:{acebase_cursor:n.cursor},cursor:n.cursor}})}transaction(i,s){return $(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.transactNode(e,t,{suppress_events:n.suppress_events,context:n.context});return _({},o&&{cursor:o})})}exists(e){return $(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(i,s){return $(this,arguments,function*(e,t,n={snapshots:!1}){return yield Aa(this,e,t,n)})}createIndex(e,t,n){return this.storage.indexes.create(e,t,n)}getIndexes(){return $(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return $(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,n){return $(this,null,function*(){n=n||{};const i=(s,o=50,a=0,c=null)=>$(this,null,function*(){typeof o=="string"&&(o=parseInt(o)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const u=[];let y=0,g=!1,k=!1;return yield this.storage.getChildren(s).next(E=>{if(g)return k=!0,!1;y++,(c!==null?E.key>c:a===0||y>a)&&u.push(_({key:typeof E.key=="string"?E.key:E.index,type:E.valueTypeName,value:E.value},typeof E.address=="object"&&"pageNr"in E.address&&{address:{pageNr:E.address.pageNr,recordNr:E.address.recordNr}})),g=o>0&&u.length===o}).catch(E=>{if(!(E instanceof ns))throw E}),{more:k,list:u}});switch(t){case"children":return yield i(e,n.limit,n.skip,n.from);case"info":{const s={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},o=yield this.storage.getNodeInfo(e,{include_child_count:n.child_count===!0});s.key=typeof o.key!="undefined"?o.key:o.index,s.exists=o.exists,s.type=o.exists?o.valueTypeName:void 0,s.value=o.value,s.address=typeof o.address=="object"&&"pageNr"in o.address?{pageNr:o.address.pageNr,recordNr:o.address.recordNr}:void 0;const a=o.exists&&o.address&&[H.OBJECT,H.ARRAY].includes(o.type);return n.child_count===!0?s.children={count:a?o.childCount:0}:typeof n.child_limit=="number"&&n.child_limit>0&&a&&(s.children=yield i(e,n.child_limit,n.child_skip,n.child_from)),s}}})}export(e,t,n={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,n)}import(e,t,n={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,n)}setSchema(e,t,n=!1){return $(this,null,function*(){return this.storage.setSchema(e,t,n)})}getSchema(e){return $(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return $(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,n){return $(this,null,function*(){return this.storage.validateSchema(e,t,{updates:n})})}getMutations(e){return $(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return $(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class Gf extends is{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class Qf extends ss{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return $(this,null,function*(){})}rollback(e){return $(this,null,function*(){})}get(e){return $(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return $(this,null,function*(){const n=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),n)})}remove(e){return $(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,n,i){return $(this,null,function*(){const s=Cn.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isParentOf(c)&&n(c)){let u;if(t.metadata||t.value){const g=this.context.localStorage.getItem(a);u=JSON.parse(g)}if(!i(c,u))break}}})}descendantsOf(e,t,n,i){return $(this,null,function*(){const s=Cn.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isAncestorOf(c)&&n(c)){let u;if(t.metadata||t.value){const g=this.context.localStorage.getItem(a);u=JSON.parse(g)}if(!i(c,u))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function Xf(r,e={}){const t=new Gf(e),n=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new Bn({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return $(this,null,function*(){})},getTransaction(a){return $(this,null,function*(){const c={debug:!0,dbname:r,localStorage:n};return new Qf(c,a)})}}),s=new sn(r,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return s.settings.ipcEvents=t.multipleTabs===!0,s}class Zf extends is{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class Ea extends ga{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class eh extends bf{constructor(e,t={}){const n=new Ea(t);super(e,n),this.recovery={repairNode:(s,o)=>$(this,null,function*(){if(yield this.ready(),this.api.storage instanceof _i)yield this.api.storage.repairNode(s,o);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:s=>$(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(s)})};const i={db:this,settings:n};this.api=new Yf(e,i,()=>{this.emit("ready")})}close(){return $(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(n){t.setLevel(n)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(n){e.eventsEnabled=n}}}static WithLocalStorage(e,t={}){return Xf(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function ao(r){return new Promise((e,t)=>{r.onsuccess=n=>e(r.result||null),r.onerror=t})}class th extends ss{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,n=_({},e);return delete n.value,{metadata:n,value:t}}commit(){return $(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(n=>n.path)});const t=this._createTransaction(!0);try{yield new Promise((n,i)=>{let s=!1,o=0;const a=u=>{s=!0,i(u)},c=()=>{++o===e.length&&n()};e.forEach((u,y)=>{if(s)return;let g,k;const E=u.path;if(u.action==="set"){const{metadata:S,value:I}=this._splitMetadata(u.node),R={path:E,metadata:S};g=t.objectStore("nodes").put(R),k=t.objectStore("content").put(I,E),this.context.cache.set(E,u.node)}else u.action==="remove"?(g=t.objectStore("content").delete(E),k=t.objectStore("nodes").delete(E),this.context.cache.set(E,null)):a(new Error(`Unknown pending operation "${u.action}" on path "${E}" `));let A=0;g.onsuccess=k.onsuccess=()=>{++A===2&&c()},g.onerror=k.onerror=a})}),t.commit&&t.commit()}catch(n){throw console.error(n),t.abort&&t.abort(),n}})}rollback(e){return $(this,null,function*(){this._pending=[]})}get(e){return $(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),n=ao(t.objectStore("nodes").get(e)),i=ao(t.objectStore("content").get(e));try{const s=yield Promise.all([n,i]);t.commit&&t.commit();const o=s[0];if(!o)return this.context.cache.set(e,null),null;const a=o.metadata;return a.value=s[1],this.context.cache.set(e,a),a}catch(s){throw console.error("IndexedDB get error",s),t.abort&&t.abort(),s}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return $(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,n,i){return this._getChildrenOf(e,q(_({},t),{descendants:!1}),n,i)}descendantsOf(e,t,n,i){return this._getChildrenOf(e,q(_({},t),{descendants:!0}),n,i)}_getChildrenOf(e,t,n,i){return new Promise((s,o)=>{const a=Cn.PathInfo.get(e),c=this._createTransaction(!1),u=c.objectStore("nodes"),y=IDBKeyRange.lowerBound(e,!0),g=t.metadata?u.openCursor(y):u.openKeyCursor(y);g.onerror=k=>{var E;(E=c.abort)==null||E.call(c),o(k)},g.onsuccess=k=>$(this,null,function*(){var S,I,R;const E=(I=(S=g.result)==null?void 0:S.key)!=null?I:null;let A=!0;if(E===null)A=!1;else if(!a.isAncestorOf(E))A=!1;else if(t.descendants||a.isParentOf(E)){let D;if(t.metadata&&(D=g.result.value.metadata),n(E,D)){if(t.value)if(this.context.cache.has(E)){const M=this.context.cache.get(E);D.value=M.value}else{const M=c.objectStore("content").get(E);D.value=yield new Promise((V,W)=>{M.onerror=X=>{V(null)},M.onsuccess=X=>{V(M.result)}}),this.context.cache.set(E,D.value===null?null:D)}A=i(E,D)}}if(A)try{g.result.continue()}catch(D){A=!1}A||((R=c.commit)==null||R.call(c),s())})})}}function nh(r,e={}){const t=new Zf(e),i=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${r}.acebase`,1);i.onupgradeneeded=k=>{const E=i.result;E.createObjectStore("nodes",{keyPath:"path"}),E.createObjectStore("content")};let s;const o=new Promise((k,E)=>{i.onsuccess=A=>{s=i.result,k()},i.onerror=A=>{E(A)}}),a=new kf(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),c=new Bn({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return o},getTransaction(k){return $(this,null,function*(){yield o;const E={debug:!1,db:s,cache:a,ipc:y};return new th(E,k)})}}),u=new sn(r,{logLevel:t.logLevel,storage:c,sponsor:t.sponsor}),y=u.api.storage.ipc;return u.settings.ipcEvents=t.multipleTabs===!0,y.on("notification",k=>$(this,null,function*(){const E=k.data;if(typeof E=="object"&&E.action==="cache.invalidate")for(const A of E.paths)a.remove(A)})),u}const rh=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class sn extends eh{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(rh);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return nh(e,t)}}const ih={AceBase:sn,AceBaseLocalSettings:Ea,DataReference:dt,DataSnapshot:be,EventSubscription:na,PathReference:xe,TypeMappings:da,CustomStorageSettings:Bn,CustomStorageTransaction:ss,CustomStorageHelpers:Cn,ID:Ke,proxyAccess:fr,DataSnapshotsArray:Lr};window.acebase=ih;window.AceBase=sn;let sh=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),ai=(()=>"/ps"+sh()+"/pe")();const je={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},Ce={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},nr={user:{base:"/user",device:{remove:"/user/device-remove",list:"/user/device-list"}},users:{base:"/users",device:{list:"/users/device-list"}}},nt={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+ai+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+ai+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+ai+"/get-one",users:{base:"/users"}};var pn,Ut,Gt,yn,at,Di,Sr,Tr,Fn,ct,He,Qt,Ne;class oh{constructor(e={}){re(this,pn,"/on");re(this,Ut,!0);re(this,Gt,void 0);re(this,yn,void 0);re(this,at,void 0);re(this,Di,void 0);re(this,Sr,void 0);re(this,Tr,void 0);re(this,Fn,new Yi);re(this,ct,void 0);re(this,He,void 0);re(this,Qt,void 0);re(this,Ne,void 0);Yn(this,"init",e=>{var V,W,X,oe,ie;let{ENV:t,HOST_SERVER:n,API_VERSION:i}=j(this,Qt),s=()=>$(this,null,function*(){var x,h,f,w,v,T,b,N,P,O,C,U;let d="/transaction",p="/database",m=yield(f=(h=(x=j(this,Ne))==null?void 0:x.ref(d))==null?void 0:h.get())==null?void 0:f.catch(z=>{}),l=yield(T=(v=(w=j(this,Ne))==null?void 0:w.ref(p))==null?void 0:v.get())==null?void 0:T.catch(z=>{});if(m.exists()){m=m.val();let z=Object.keys(m);if((z==null?void 0:z.length)>0){for(let Q in z){let K=m[Q];(K==null?void 0:K.path)&&(K==null?void 0:K.method)&&(K==null?void 0:K.value)&&(yield this.init(e).database().ref(K==null?void 0:K.path).req(K==null?void 0:K.method,K==null?void 0:K.path,K==null?void 0:K.value).val())}l.exists()&&(yield(P=(N=(b=j(this,Ne))==null?void 0:b.ref(p))==null?void 0:N.remove())==null?void 0:P.catch(Q=>{})),yield(U=(C=(O=j(this,Ne))==null?void 0:O.ref(d))==null?void 0:C.remove())==null?void 0:U.catch(Q=>{})}}});(W=(V=e==null?void 0:e.socket)==null?void 0:V.auth)==null||W.on("connect",()=>{de(this,He,!0),s()}),(oe=(X=e==null?void 0:e.socket)==null?void 0:X.auth)==null||oe.on("disconnect",()=>{de(this,He,!1)});const o=(d={})=>{var m,l,x;let p={};if(d&&Object.keys(d).length>0&&(p.data=d),j(this,at)&&(p.storage=j(this,at),p.config=j(this,Sr)),j(this,Tr)){let h=new FormData;Array.isArray(d)?(d.map((f,w)=>{typeof f=="object"&&(f.attachmentName="attachment"+w,f==null||f.attachments.forEach(v=>{v!=null&&v.data?h.append("attachments"+w,v==null?void 0:v.data,v==null?void 0:v.name):h.append("attachments"+w,v)}))}),h.append("field",JSON.stringify(p))):Array.isArray(d==null?void 0:d.attachments)&&(d==null||d.attachments.forEach(f=>{f!=null&&f.data?h.append("attachments",f==null?void 0:f.data,f==null?void 0:f.name):h.append("attachments",f)}),delete p.data.attachments,h.append("field",JSON.stringify(p))),p=h}else if(j(this,at)&&(d==null?void 0:d.file)){let h=new FormData;d!=null&&d.file?((m=d.file)!=null&&m.data?h.append("file",(l=d.file)==null?void 0:l.data,(x=d.file)==null?void 0:x.name):h.append("file",d.file),delete p.data.file,h.append("field",JSON.stringify(p))):Array.isArray(d==null?void 0:d.directory)&&(d==null||d.directory.forEach(f=>{f!=null&&f.data?h.append("file",f==null?void 0:f.data,f==null?void 0:f.name):h.append("file",f)}),delete p.data.directory,h.append("field",JSON.stringify(p)),p=h),p=h}return p};let a=(d,p)=>$(this,null,function*(){var m,l,x,h,f,w,v,T;if(((m=d==null?void 0:d.error)==null?void 0:m.token)&&j(this,Ut)){if(de(this,Ut,!1),localStorage.getItem("refreshToken")){t==="dev"&&console.log("Token expired or not found: ",(l=d.error)==null?void 0:l.token," Trying to request a new refresh token");let b=yield(h=(x=this==null?void 0:this.init(e))==null?void 0:x.auth())==null?void 0:h.req(nt.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(b!=null&&b.error)return t==="dev"&&console.log("Refresh token expired or not found: ",b),j(this,Gt)&&(window.top.location.href=j(this,Gt)),b;if(b!=null&&b.data&&(t==="dev"&&console.log("We got a new refresh token ,",b==null?void 0:b.data),(f=b==null?void 0:b.data)!=null&&f.token&&localStorage.setItem("accessToken",(w=b==null?void 0:b.data)==null?void 0:w.token),(v=b==null?void 0:b.data)!=null&&v.refreshToken&&localStorage.setItem("refreshToken",(T=b==null?void 0:b.data)==null?void 0:T.refreshToken),t==="dev"&&console.log("Trying to restart your request..."),typeof p=="function"))return yield p()}}else return d});const c=(d,p,m,l=()=>{})=>{const x=j(this,pn);let h=p.version+x+p.base+m;h=h.replace(/\/\//g,"/"),t==="dev"&&console.log("socket listen local path: ",h),d==null||d.on(h,l)},u=(d,p=()=>{})=>{var x;const m=j(this,pn);let l=(i==null?void 0:i.AUTH)+m+d;l=l.replace(/\/\//g,"/"),t==="dev"&&console.log("emitter listen local path: ",l),(x=j(this,Fn))==null||x.on(l,p)};let y=(d,p,m,l)=>(j(this,yn)&&(l=l+j(this,yn)),{req:x=>(c(d,p,l+Ce.req,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),create:x=>(c(d,p,l+Ce.create,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),find:x=>(c(d,p,l+Ce.find,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),get:x=>(c(d,p,l+Ce.get,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),query:x=>(c(d,p,l+Ce.query,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),update:x=>(c(d,p,l+Ce.update,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),delete:x=>(c(d,p,l+Ce.delete,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m)}),g=(d,p)=>({create:m=>(u(d+Ce.create,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),find:m=>(u(d+Ce.find,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),get:m=>(u(d+Ce.get,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),query:m=>(u(d+Ce.query,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),update:m=>(u(d+Ce.update,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),delete:m=>(u(d+Ce.delete,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p)}),k=Hs.init(j(this,Qt)),E=(d="",p={},m={},l={},x)=>{d=d.trim(),d.charAt(d.length-1)==="/"&&(d=d.slice(0,-1));let f=(()=>$(this,null,function*(){let w=()=>$(this,null,function*(){return yield k("post",n.AUTH+i.AUTH+nt.base+d,o(p))}),v=yield w();return j(this,Ut)&&(v=yield a(v,()=>$(this,null,function*(){return yield w()}))),typeof x=="function"&&x(q(_({},l),{value:v})),v}))();return q(_({},l),{val:()=>f})},A=(d,p,m,l={},x={},h)=>{let w=(()=>$(this,null,function*(){let v=()=>$(this,null,function*(){return yield k(d,p,o(m),l)}),T=yield v();return j(this,Ut)&&(T=yield a(T,()=>$(this,null,function*(){return yield v()}))),typeof h=="function"&&h(q(_({},x),{value:T})),T}))();return q(_({},x),{val:()=>w})},S=d=>{let p={},m,[l={},,,]=d;if(d.length===1&&typeof l=="function"&&(m=d[0],l={}),d.length===2&&(typeof d[1]=="object"?p=d[1]:typeof d[1]=="function"&&(m=d[1])),d.length>=3){let[,x,h]=d;typeof x=="object"&&(p=x),m=h}return{data:l,onRequest:p,callback:m}},I=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),R=(d,p,m={},l,x)=>{p=p.replace(/\/\//g,"/");let f=(()=>$(this,null,function*(){var O,C,U,z,Q,K,ge,ae,ce,pe,se,we,le,Ae,ve,Pe,We,Ot,_t,It,Pt,Nt,Rt;let w="/transaction",v,T,b={error:{message:"We could not execute the "+d+" method for path: "+p}};switch(d){case"create":yield(U=(C=(O=j(this,Ne))==null?void 0:O.ref(p))==null?void 0:C.set(m))==null?void 0:U.catch(ne=>b);break;case"update":yield(K=(Q=(z=j(this,Ne))==null?void 0:z.ref(p))==null?void 0:Q.update(m))==null?void 0:K.catch(ne=>b);break;case"query":let Y=(ge=j(this,Ne))==null?void 0:ge.query(p);Array.isArray(m==null?void 0:m.where)&&(yield Promise.all(m==null?void 0:m.where.map(ne=>$(this,null,function*(){return yield new Promise(ke=>{Y==null||Y.filter(...ne),ke()})})))),m!=null&&m.take&&(Y==null||Y.take(m==null?void 0:m.take)),m!=null&&m.skip&&(Y==null||Y.take(m==null?void 0:m.skip)),m!=null&&m.order&&Array.isArray(m==null?void 0:m.order)&&(yield Promise.all(m==null?void 0:m.order.map(ne=>$(this,null,function*(){return yield new Promise(ke=>{Y==null||Y.sort(...ne),ke()})})))),T=yield Y==null?void 0:Y.count(),v=yield(ae=Y==null?void 0:Y.get(_({},m==null?void 0:m.$option)))==null?void 0:ae.catch(ne=>b);break;case"delete":v=yield(se=(pe=(ce=j(this,Ne))==null?void 0:ce.ref(p))==null?void 0:pe.get())==null?void 0:se.catch(ne=>b),yield(Ae=(le=(we=j(this,Ne))==null?void 0:we.ref(p))==null?void 0:le.remove())==null?void 0:Ae.catch(ne=>b);break}if(d!=="delete"&&d!=="query"&&(v=yield(We=(Pe=(ve=j(this,Ne))==null?void 0:ve.ref(p))==null?void 0:Pe.get(_({},m==null?void 0:m.$option)))==null?void 0:We.catch(Y=>b)),d==="query"?v.exists()?(v=v==null?void 0:v.getValues(),v={data:v,max:T,take:m==null?void 0:m.take,skip:m==null?void 0:m.skip}):v=_({},b):v.exists()?(v=v==null?void 0:v.val(),v={data:v}):v=_({},b),j(this,ct)&&l.auth().$currentUserId&&!j(this,He)&&["create","delete","update"].includes(d)&&v!=null&&v.data){let Y=yield(It=(_t=(Ot=j(this,Ne))==null?void 0:Ot.ref(w))==null?void 0:_t.get())==null?void 0:It.catch(On=>b);Y.exists()?Y=Y.val():Y={};let ne,ke=Object.keys(Y);switch(ke.length>0?ne=ke.length+1:ne=0,d){case"create":d="post";break;case"update":d="put";break;case"delete":d="delete";break}d!=="get"&&(yield(Rt=(Nt=(Pt=j(this,Ne))==null?void 0:Pt.ref(w+"/"+ne))==null?void 0:Nt.set({path:p,method:d,uid:ne,value:v.data}))==null?void 0:Rt.catch(On=>b))}const N=j(this,pn);let P=(i==null?void 0:i.AUTH)+N+p+"/"+d;return P=P.replace(/\/\//g,"/"),j(this,Fn).emit(P,v),typeof x=="function"&&x(q(_({},l),{value:v})),v}))();return q(_({},l),{val:()=>f})},D=({value:d,node:p},m)=>{var x,h,f,w;let l=d;if((x=l==null?void 0:l.data)!=null&&x.data){let v=(h=l==null?void 0:l.data)==null?void 0:h.data,T=(f=l==null?void 0:l.data)==null?void 0:f.refreshToken,b=(w=l==null?void 0:l.data)==null?void 0:w.token;b&&localStorage.setItem("accessToken",b),T&&localStorage.setItem("refreshToken",T),v&&localStorage.setItem("userInfo",JSON.stringify(v))}typeof m=="function"&&m(q(_({},p),{value:l}))},B=(d,p)=>{typeof d=="function"&&(p==null||p.on("connect",d))},M=(d,p)=>{let m="%"+d,l=this.init(e);return delete l.auth().login,delete l.auth().register,{$connected:j(this,He),private:(x=I())=>l.event(d+x),child:x=>l.event(d+x),emit:(x,h)=>(p==null||p.emit(m,x),typeof h=="function"&&l.event(d).do(h),_(_({},l.event(d)),l)),do:x=>(p==null||p.on(m,h=>{typeof x=="function"&&x(q(_(_({},l.event(d)),l),{value:h}))}),_(_({},l.event(d)),l)),onAny:x=>{p==null||p.onAny((h,f)=>{typeof x=="function"&&x(h,_(_({value:f},l.event(h)),l))})}}};return{activity:()=>{let d=this.init(e);return{onStart:p=>(typeof p=="function"&&document.addEventListener("DOMContentLoaded",p),_(_({},d),d.activity())),onCreate:p=>(typeof p=="function"&&(window.onload=p),_(_({},d),d.activity())),onPause:p=>(window.addEventListener("beforeunload",function(m){typeof p=="function"&&p(),m.returnValue="onbeforeunload"}),_(_({},d),d.activity())),onResume:()=>_(_({},d),d.activity()),onLeave:p=>(typeof p=="function"&&(window.onunload=p),_(_({},d),d.activity()))}},socket:{auth:(ie=e==null?void 0:e.socket)==null?void 0:ie.auth},$randomUID:()=>Et(),$randomId:()=>I(),$axios:Hs,local:(d={})=>{const p=this.init(e);return delete p.local,delete p.auth().register,delete p.auth().login,{database:(m="/database")=>({ref:(l="/database")=>{let x=this.init(e);return delete x.auth().login,delete x.auth().register,l=l.trim(),l=l.replace(/\/\//g,"/"),m=m+"/"+l,m=m.replace(/\/\//g,"/"),l.charAt(l.length-1)==="/"&&(l=l.slice(0,-1)),{child:(h="")=>{var f,w;return h=h.trim(),h=h.replace(/\/\//g,"/"),h.charAt(h.length-1)==="/"&&(h=h.slice(0,-1)),h.charAt(0)!=="/"&&(h="/"+h),(w=(f=x.local())==null?void 0:f.database())==null?void 0:w.ref(l+h)},push:(...h)=>{var w,v;let f=Et();return!h.length>0?{getKey:()=>f}:(v=(w=x.local())==null?void 0:w.database())==null?void 0:v.ref(l+"/"+f).create(h)},create:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local(d))==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R(d,"create",m,w,f)},get:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("get",m,w,f,v)},find:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("get",m,w,f,v)},query:()=>{},update:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("update",m,w,f,v)},delete:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("delete",m,w,f,v)},on:()=>{var f,w;let h=_(_({},(w=(f=x.local())==null?void 0:f.database())==null?void 0:w.ref(l)),x);return g(l,h)},onValue:h=>{var v,T,b,N,P,O,C;let f=_(_({},(T=(v=x.local())==null?void 0:v.database())==null?void 0:T.ref(l)),x),w=(N=(b=x.local())==null?void 0:b.database())==null?void 0:N.ref(l);return(P=w==null?void 0:w.on())==null||P.create(h),(O=w==null?void 0:w.on())==null||O.update(h),(C=w==null?void 0:w.on())==null||C.delete(h),f}}}}),cache:(m="/cache")=>{var x;let l=this.init(e);return delete l.auth().login,delete l.auth().register,(x=l.local())==null?void 0:x.database(m)},storage:()=>({})}},$online:navigator==null?void 0:navigator.onLine,auth:()=>{var d;return{$io:(d=e==null?void 0:e.socket)==null?void 0:d.auth,connected:()=>{var p,m;return(m=(p=e==null?void 0:e.socket)==null?void 0:p.auth)==null?void 0:m.connected},event:p=>{var m;return M(p,(m=e==null?void 0:e.socket)==null?void 0:m.auth)},ready:p=>{var m;return B(p,(m=e==null?void 0:e.socket)==null?void 0:m.auth)},$currentUserId:(()=>{let p=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return p.uid?p.uid:!1})(),$status:(()=>{let p=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(p.status)return p.status})(),status:(...p)=>{var f,w,v,T;let m,l,x=this.init(e);if(delete x.auth().login,delete x.auth().register,p.length===1)typeof p[0]=="string"?m=p[0]:typeof p[0]=="function"&&(l=p[0]);else if(p.length>=2){const[b,N]=p;typeof b=="string"&&(m=b),l=N}let h=(w=(f=e==null?void 0:e.socket)==null?void 0:f.auth)==null?void 0:w.id;if(h){if(!m){let b=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");b.uid&&(m=b.uid)}m&&h&&((T=(v=e==null?void 0:e.socket)==null?void 0:v.auth)==null||T.on((i==null?void 0:i.AUTH)+Ce.user.status,b=>{t==="dev"&&console.log("The user with id: ",m," is disconnected/connected: ",b==null?void 0:b.value),typeof l=="function"&&l(_({value:b},x))}))}return _({},x)},device:{connected:(...p)=>{var f,w,v,T;let m=this.init(e);delete m.auth().login,delete m.auth().register;let l,x;if(p.length===1)typeof p[0]=="string"?l=p[0]:typeof p[0]=="function"&&(x=p[0]);else if(p.length>=2){const[b,N]=p;typeof b=="string"&&(l=b),x=N}let h=(w=(f=e==null?void 0:e.socket)==null?void 0:f.auth)==null?void 0:w.id;if(h){if(!l){let b=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");b.uid&&(l=b.uid)}l&&h&&((T=(v=e==null?void 0:e.socket)==null?void 0:v.auth)==null||T.on((i==null?void 0:i.AUTH)+Ce.user.device.connected,b=>{t==="dev"&&console.log("The user with id: ",l," has this device connected: ",b==null?void 0:b.value),typeof x=="function"&&x(q(_(_({},m.auth().device),m),{value:b}))}))}return _(_({},m.auth().device),m)},disconnected:(...p)=>{var f,w,v,T;let m=this.init(e);delete m.auth().login,delete m.auth().register;let l,x;if(p.length===1)typeof p[0]=="string"?l=p[0]:typeof p[0]=="function"&&(x=p[0]);else if(p.length>=2){const[b,N]=p;typeof b=="string"&&(l=b),x=N}let h=(w=(f=e==null?void 0:e.socket)==null?void 0:f.auth)==null?void 0:w.id;if(h){if(!l){let b=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");b.uid&&(l=b.uid)}l&&h&&((T=(v=e==null?void 0:e.socket)==null?void 0:v.auth)==null||T.on((i==null?void 0:i.AUTH)+Ce.user.device.disconnected,b=>{t==="dev"&&console.log("The user with id: ",l," has this device connected: ",b==null?void 0:b.value),typeof x=="function"&&x(q(_(_({},m.auth().device),m),{value:b}))}))}return _(_({},m.auth().device),m)},remove:(...p)=>{var w,v,T,b,N,P;let m=this.init(e);delete m.auth().login,delete m.auth().register;let l,x;if(p.length===1)typeof p[0]=="string"?l=p[0]:typeof p[0]=="function"&&(x=p[0]);else if(p.length>=2){const[O,C]=p;(typeof O=="string"||Array.isArray(O))&&(l=O),x=C}let h=(v=(w=e==null?void 0:e.socket)==null?void 0:w.auth)==null?void 0:v.id,f=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return l&&f.uid&&h&&((b=(T=e==null?void 0:e.socket)==null?void 0:T.auth)==null||b.emit((i==null?void 0:i.AUTH)+nr.user.device.remove,{socketId:h,userId:l,currentUserId:f.uid}),(P=(N=e==null?void 0:e.socket)==null?void 0:N.auth)==null||P.on((i==null?void 0:i.AUTH)+Ce.user.device.removed,O=>{t==="dev"&&console.log("The user with id: ",l," has this device connected: ",O==null?void 0:O.value),typeof x=="function"&&x(q(_(_({},m.auth().device),m),{value:O}))})),_(_({},m.auth().device),m)},list:(...p)=>{var v,T,b,N;let m=this.init(e);delete m.auth().login,delete m.auth().register;let l=nr.users.device.list,x,h;if(p.length===1)typeof p[0]=="string"?x=p[0]:typeof p[0]=="function"&&(h=p[0]);else if(p.length>=2){const[P,O]=p;typeof P=="string"&&(x=P,l=nr.user.device.list),h=O}let f=(T=(v=e==null?void 0:e.socket)==null?void 0:v.auth)==null?void 0:T.id,w=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return f&&w.uid&&(x||(l=nr.user.device.list,x=w.uid),x&&f&&((b=e==null?void 0:e.socket.auth)==null||b.emit((i==null?void 0:i.AUTH)+l,{socketId:f,userId:x,currenUserId:w.uid}),(N=e==null?void 0:e.socket.auth)==null||N.on((i==null?void 0:i.AUTH)+l+"/",P=>{t==="dev"&&console.log("The user with id: ",x," has these devices connected: ",res==null?void 0:res.value),typeof h=="function"&&h(q(_(_({},m.auth().device),m),{value:P}))}))),_(_({},m.auth().device),m)}},req:(p,m,l)=>{let x=this.init(e);delete x.auth().login,delete x.auth().register;let h=_(_({},x),x.auth());return E(p+nt.req,m,null,h,l)},$user:(()=>{let p=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(p.uid)return p})(),user:(...p)=>{let m,l;p.length>1?(typeof p[0]=="string"&&(m=p[0]),typeof p[1]=="function"&&(l=p[1])):p.length===1&&(typeof p[0]=="string"&&(m=p[0]),typeof p[0]=="function"&&(l=p[0]));let x=this.init(e);delete x.auth().login,delete x.auth().register;let h=_(_({},x),x.auth());if(!m||typeof m!="string"){let f=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}"),w=localStorage.getItem("accessToken"),v=(()=>{var T;try{let b=mr(w);return(Date==null?void 0:Date.parse((T=new Date((b==null?void 0:b.exp)*1e3))==null?void 0:T.toString()))>Date.now()}catch(b){return!1}})();return f.uid&&v?(typeof l=="function"&&l(q(_({},h),{value:f})),q(_({},h),{val:()=>f})):E(nt.user,{},null,null,({value:T})=>{var N;let b=T;b!=null&&b.data&&(b={data:(N=b==null?void 0:b.data)==null?void 0:N.data},b.data&&localStorage.setItem("userInfo",JSON.stringify(b.data))),typeof l=="function"&&l(q(_({},h),{value:b}))})}else return E(nt.user,{uid:m},null,null,({value:f})=>{var v;let w=f;w!=null&&w.data&&(w={data:(v=w==null?void 0:w.data)==null?void 0:v.data}),typeof l=="function"&&l(q(_({},h),{value:w}))})},verifyEmailCode:(p,m)=>{let l=this.init(e);return delete l.auth().login,delete l.auth().register,E(nt.verify_email_code,p,null,null,({value:x})=>{D({value:x,node:l},m)})},verifyTokenCode:(p,m)=>{let l=this.init(e);return delete l.auth().login,delete l.auth().register,E(nt.verify_token_code,p,null,null,({value:x})=>{D({value:x,node:l},m)})},verifyPassCode:(p,m)=>{let l=this.init(e);return delete l.auth().login,delete l.auth().register,E(nt.verify_pass_code,p,null,null,({value:x})=>{D({value:x,node:l},m)})},login:(p,m)=>{let l=this.init(e);return delete l.auth().login,delete l.auth().register,E(nt.login,p,null,null,({value:x})=>{D({value:x,node:l},m)})},loginWithToken:(p,m)=>{let l=this.init(e);return delete l.auth().login,delete l.auth().register,localStorage.setItem("userInfo","{}"),localStorage.setItem("accessToken",""),localStorage.setItem("refreshToken",p),this.init(e).auth.user(null,m)},logout:p=>{let m=this.init(e);return localStorage.removeItem("refreshToken"),localStorage.removeItem("userInfo"),localStorage.removeItem("accessToken"),(()=>$(this,null,function*(){var x,h,f,w,v,T;yield(f=(h=(x=j(this,Ne))==null?void 0:x.ref("/database"))==null?void 0:h.remove())==null?void 0:f.catch(b=>{}),yield(T=(v=(w=j(this,Ne))==null?void 0:w.ref("/transaction"))==null?void 0:v.remove())==null?void 0:T.catch(b=>{})}))().then(x=>{}).catch(x=>{}),typeof p=="function"&&p(_(_({},m),m.auth())),_(_({},m),m.auth())},register:(p,m)=>{let l=this.init(e);return delete l.auth().login,delete l.auth().register,E(nt.register,p,null,null,({value:x})=>{D({value:x,node:l},m)})},forgotPassword:(p,m)=>E(nt.forgotPassword,p,null,null,m),users:()=>{let p=this.init(e);return delete p.auth().login,delete p.auth().register,p.ref("/users")},tokens:()=>{let p=this.init(e);return delete p.auth().login,delete p.auth().register,p.ref("/tokens")}}},syncDatabase:(d=!0)=>{const p=this.init(e);return de(this,ct,typeof d=="boolean"?d:!0),p.database()},ref:(d="",p={host:n.AUTH,version:i.AUTH,base:nt.base},m=(x=>(x=e==null?void 0:e.socket)==null?void 0:x.socket)(),l=!0)=>{d=d.trim(),d=d.replace(/\/\//g,"/"),d.charAt(0)==="/"&&d.length<=1&&(d="/root"),d.charAt(d.length-1)==="/"&&(d=d.slice(0,-1));const h=p.host+p.version+p.base+d;let f=this.init(e);return delete f.auth().login,delete f.auth().register,de(this,Ut,l),{push:(...w)=>{let v=Et();return!w.length>0?{getKey:()=>v}:f.ref(d+"/"+v,p,m).create(w)},private:(w=I())=>f.ref(d+"/ps"+w+"/pe",p,m),setAuthAccess:(w=!0,v=j(this,Gt))=>(de(this,Gt,v),f.ref(d,p,m,w)),req:(...w)=>{let v=_(_({},f.ref(d,p,m)),f);if(w.length>=2){let[T="post",b={},N={},P]=w;if(typeof T=="string"&&["post","put","delete","get"].includes(T)){let O=je.req;return A(T,h+O,b,N,v,P)}return v}else{let T=w.filter(b=>typeof b=="function");if(T.length>0)T=T[0],typeof T=="function"&&T(v);else return v}},child:(w="")=>(w=w.trim(),w=w.replace(/\/\//g,"/"),w.charAt(w.length-1)==="/"&&(w=w.slice(0,-1)),w.charAt(0)!=="/"&&(w="/"+w),f.ref(d+w,p,m)),set:(...w)=>{var v;return(v=f.ref(d,p,m))==null?void 0:v.create(...w)},create:(...w)=>{var T,b,N,P;let v=_(_({},f.ref(d,p,m)),f);if(f.auth().$currentUserId&&d.includes("/users")&&j(this,ct)&&!j(this,He))return(N=(b=(T=f.local())==null?void 0:T.database())==null?void 0:b.ref(d))==null?void 0:N.create(...w);{let{data:O,onRequest:C,callback:U}=S(w),z=je.create.one;if(j(this,at)){if((O==null?void 0:O.file)||(O==null?void 0:O.directory))return(P=f.ref(d))==null?void 0:P.upload(O,null,U);Array.isArray(O.folders)&&(z=je.create.many)}else Array!=null&&Array.isArray(O)&&(z=je.create.many);return A("post",h+z,O,C,v,U)}},find:(...w)=>{var v,T,b,N;if(console.log("Database connected: ",j(this,He)),f.auth().$currentUserId&&d.includes("/users")&&j(this,ct)&&!j(this,He))return t==="dev"&&console.log("Find: We are offline"),(b=(T=(v=f.local())==null?void 0:v.database())==null?void 0:T.ref(d))==null?void 0:b.find(...w);{t==="dev"&&console.log("Find: We are online");let P=_(_({},f.ref(d,p,m)),f),{data:O,onRequest:C,callback:U}=S(w),z=je.find.one;return j(this,at)?(Array.isArray(O==null?void 0:O.files)||Array.isArray(O==null?void 0:O.folders))&&(Array.isArray(O==null?void 0:O.files)&&(O.isFolder=!1),Array.isArray(O==null?void 0:O.folders)&&(O.isFolder=!0),z=je.find.many):(((N=Object.keys(O))==null?void 0:N.length)<=0||O.order||O.where||O.$option||O.skip||O.take)&&(z=je.find.many),A("post",h+z,O,C,P,U)}},get:(...w)=>{var v,T,b,N;if(f.auth().$currentUserId&&d.includes("/users")&&j(this,ct)&&!j(this,He))return(b=(T=(v=f.local())==null?void 0:v.database())==null?void 0:T.ref(d))==null?void 0:b.get(...w);{let P=_(_({},f.ref(d,p,m)),f),{data:O,onRequest:C,callback:U}=S(w),z=je.get.one;return j(this,at)?(Array.isArray(O==null?void 0:O.files)||Array.isArray(O==null?void 0:O.folders))&&(Array.isArray(O==null?void 0:O.files)&&(O.isFolder=!1),Array.isArray(O==null?void 0:O.folders)&&(O.isFolder=!0),z=je.get.many):(((N=Object.keys(O))==null?void 0:N.length)<=0||O.order||O.where||O.$option||O.skip||O.take)&&(z=je.get.many),A("get",h+z+"?query="+JSON.stringify(o(O)),null,C,P,U)}},query:(...w)=>{var v,T,b;if(f.auth().$currentUserId&&d.includes("/users")&&j(this,ct)&&!j(this,He))return(b=(T=(v=f.local())==null?void 0:v.database())==null?void 0:T.ref(d))==null?void 0:b.query(...w);{let N=_(_({},f.ref(d,p,m)),f),{data:P,onRequest:O,callback:C}=S(w);return(!P||P==="")&&(P={take:15},!j(this,yn)&&!P.order&&(P.order={uid:"ASC"})),A("get",h+je.get.many+"?query="+JSON.stringify(o(P)),null,O,N,C)}},update:(...w)=>{var v,T,b;if(f.auth().$currentUserId&&d.includes("/users")&&j(this,ct)&&!j(this,He))return(b=(T=(v=f.local())==null?void 0:v.database())==null?void 0:T.ref(d))==null?void 0:b.update(...w);{let N=_(_({},f.ref(d,p,m)),f),{data:P,onRequest:O,callback:C}=S(w),U=je.update.one;return j(this,at)?(Array.isArray(P==null?void 0:P.files)||Array.isArray(P==null?void 0:P.folders))&&(Array.isArray(P==null?void 0:P.files)&&(P.isFolder=!1),Array.isArray(P==null?void 0:P.folders)&&(P.isFolder=!0),U=je.update.many):Array.isArray(P)&&(U=je.find.many),A("put",h+U,P,O,N,C)}},delete:(...w)=>{var v,T,b;if(f.auth().$currentUserId&&d.includes("/users")&&j(this,ct)&&!j(this,He))return(b=(T=(v=f.local())==null?void 0:v.database())==null?void 0:T.ref(d))==null?void 0:b.delete(...w);{let N=_(_({},f.ref(d,p,m)),f),{data:P,onRequest:O,callback:C}=S(w),U=je.delete.one;return j(this,at)?(Array.isArray(P==null?void 0:P.files)||Array.isArray(P==null?void 0:P.folders))&&(Array.isArray(P==null?void 0:P.files)&&(P.isFolder=!1),Array.isArray(P==null?void 0:P.folders)&&(P.isFolder=!0),Object.keys(P).length<=0&&(P.isFolder=!0),U=je.delete.many):(Array.isArray(P)||P.where)&&(U=je.delete.many),A("delete",h+U,P,O,N,C)}},on:()=>{let w=_(_({},f.ref(d,p,m)),f);return y(m,p,w,d)},onValue:w=>{let v=_(_({},f.ref(d,p,m)),f),T=f.ref(d,p,m);return T==null||T.on().create(w),T==null||T.on().update(w),T==null||T.on().delete(w),T==null||T.on().upload(w),v}}}}});de(this,Qt,e);let{ENV:t,OFFLINE_DB_NAME:n}=j(this,Qt);de(this,Ne,sn.WithIndexedDB((n==null?void 0:n.AUTH)||"swyger_auth"));let i=()=>$(this,null,function*(){try{let s,o=localStorage.getItem("accessToken");if((()=>{var c;try{s=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let u=mr(o);return(Date==null?void 0:Date.parse((c=new Date((u==null?void 0:u.exp)*1e3))==null?void 0:c.toString()))<Date.now()}catch(u){return!1}})()&&s.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(c){}}catch(s){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}pn=new WeakMap,Ut=new WeakMap,Gt=new WeakMap,yn=new WeakMap,at=new WeakMap,Di=new WeakMap,Sr=new WeakMap,Tr=new WeakMap,Fn=new WeakMap,ct=new WeakMap,He=new WeakMap,Qt=new WeakMap,Ne=new WeakMap;const ah={init:r=>{try{return(e={})=>new oh(r).init(e)}catch(e){return{}}}};let ch={init:r=>{var e,t,n;return{OFFLINE_DB_NAME:{AUTH:((e=r==null?void 0:r.OFFLINE_DB_NAME)==null?void 0:e.AUTH)||"swyger_auth"},ENV:(r==null?void 0:r.ENV)||"prod",HOST_SERVER:{AUTH:((t=r==null?void 0:r.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100"},API_VERSION:{AUTH:((n=r==null?void 0:r.API_VERSION)==null?void 0:n.AUTH)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(r==null?void 0:r.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(r==null?void 0:r.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const uh={init:r=>{let e=ch.init(r);const t=Au.init(e),n={socket:{auth:t==null?void 0:t.auth,database:t==null?void 0:t.database,storage:t==null?void 0:t.storage}};return ah.init(e)(n)}},lh={init:({API_KEY:r,HOST_SERVER:e,CURRENT:t,ENV:n,API_VERSION:i})=>{var a,c;let s={};const o=localStorage.getItem("accessToken");try{const u={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return o&&(u.Authorization="Bearer "+o),s.database=zt(e.DATABASE,{extraHeaders:u}),(a=s==null?void 0:s.database)==null||a.on("connect",()=>{n==="dev"&&console.log("Swyger Database Client JS is connected with Swyger Server!!!")}),(c=s==null?void 0:s.database)==null||c.on("disconnect",y=>{n==="dev"&&console.log("The device is disconnected from Database server!")}),s}catch(u){}}},co={init:({API_KEY:r})=>(...s)=>$(void 0,[...s],function*(e="post",t="/",n={},i={}){var g,k,E,A;const o=localStorage.getItem("accessToken");let a={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};o&&(a.Authorization="Bearer "+o);const c=t;typeof(n==null?void 0:n.get)=="function"&&(n==null?void 0:n.get("file"))&&(a["Content-Type"]="multipart/form-data"),i!=null&&i.headers&&(a=Object.assign(...a,...i.headers),delete i.headers);const u=Object.assign({mode:"cors",method:e,url:c,data:n,headers:a},i);let y={};try{const S=yield qi(u);y.data=((g=S==null?void 0:S.data)==null?void 0:g.data)||(S==null?void 0:S.data),y.data||(y.data={})}catch(S){y.error=((E=(k=S.response)==null?void 0:k.data)==null?void 0:E.error)||((A=S.response)==null?void 0:A.error),y.error||(y.error={})}return y})};var fh={exports:{}};(function(r,e){(function(t){var n=this,i=Object.prototype.hasOwnProperty,s=function(c){for(var u=new Array(c.length),y=c.length,g=y-1;y--;)u[g-y]=c[y];return u},o=function(){var c=Array.prototype.slice.call(arguments);return c.length==2?o.find.apply(this,c):o.transform.apply(this,c)};o.find=function(c,u){return o.get(u,c)},o.memoizePath=!0;var a={};o.get=function(c,u,y){if(c===t||c===null||u===t||u===null)return y;var g;for(typeof u=="string"?o.memoizePath?a[u]?g=a[u].slice(0):(g=u.split(".").reverse(),a[u]=g.slice(0)):g=u.split(".").reverse():Array.isArray(u)&&(g=s(u));g.length&&(c=c[g.pop()])!==t&&c!==null;);return c===null&&g.length&&(c=t),c===t?y:c},o.exists=function(c,u){return o.get(c,u)!==t},o.set=function(c,u,y,g){var k=Array.isArray(u)?u:u.split("."),E=c,A,S=k.length;if(k[0]!=="__proto__"){if(typeof E!="object")throw new Error("Parent is not an object.");for(var I=0;I<S;I++)if(A=k[I],(!i.call(E,A)||E[A]===t||(typeof E[A]!="object"||E[A]===null)&&g&&g.force===!0)&&(E[A]={}),I==S-1)E[A]=y;else{if(typeof E[A]!="object"||E[A]===null)throw new Error('Target key "'+A+'" is not suitable for a nested value. (It is in use as non-object. Set `force` to `true` to override.)');E=E[A]}E[A]=y}},o.default=function(c,u,y){o.get(c,u)===t&&o.set(c,u,y)},o.transform=function(u,y){if(Array.isArray(u))return u.map(function(V){return o.transform(V,y)});y=y||{},y.delimiter=y.delimiter||".";var g,k,E,A,S={},I,R=Object.keys(u),D=R.length,B;for(B=0;B<D;B++)if(I=R[B],I.indexOf(y.delimiter)!==-1){if(g=I.split(y.delimiter),g[0]==="__proto__")break;k=g.length,A=S;for(var M=0;M<k&&(E=g[M],M!=k-1&&!A.hasOwnProperty(E)&&(A[E]={}),M==k-1&&(A[E]=u[I]),A=A[E],A!==null);M++);}else S[I]=u[I];return S},o.flatten=function(c,u){typeof u=="undefined"&&(u=".");var y={},g,k;for(var E in c)if(i.call(c,E))if(g=c[E],Object.prototype.toString.call(g)==="[object Object]"){k=o.flatten(g,u);for(var A in k)y[E+u+A]=k[A]}else y[E]=g;return y},o.paths=function(c,u){var y=[],g,k;if(u=u||[],typeof c=="object")for(k in c)g=c[k],typeof g=="object"&&g!==null?y=y.concat(o.paths(g,u.concat([k]))):y.push(u.concat(k).join("."));else throw new Error("Paths was called with non-object argument.");return y},r.exports?r.exports=o:(n.Dottie=o,n.Dot=o,typeof t=="function"&&t([],function(){return o}))})()})(fh);let hh=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),ci=(()=>"/ps"+hh()+"/pe")();const Be={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},et={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},ui={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+ci+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+ci+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+ci+"/get-one",users:{base:"/users"}},uo={base:"/data"};var mn,Ft,Xt,gn,ut,Ui,Or,_r,Mn,lt,Ue,Zt,Fe;class dh{constructor(e={}){re(this,mn,"/on");re(this,Ft,!0);re(this,Xt,void 0);re(this,gn,void 0);re(this,ut,void 0);re(this,Ui,void 0);re(this,Or,void 0);re(this,_r,void 0);re(this,Mn,new Yi);re(this,lt,void 0);re(this,Ue,void 0);re(this,Zt,void 0);re(this,Fe,void 0);Yn(this,"init",e=>{var V,W,X,oe,ie;let{ENV:t,HOST_SERVER:n,API_VERSION:i}=j(this,Zt),s=()=>$(this,null,function*(){var x,h,f,w,v,T,b,N,P,O,C,U;let d="/transaction",p="/database",m=yield(f=(h=(x=j(this,Fe))==null?void 0:x.ref(d))==null?void 0:h.get())==null?void 0:f.catch(z=>{}),l=yield(T=(v=(w=j(this,Fe))==null?void 0:w.ref(p))==null?void 0:v.get())==null?void 0:T.catch(z=>{});if(m.exists()){m=m.val();let z=Object.keys(m);if((z==null?void 0:z.length)>0){for(let Q in z){let K=m[Q];(K==null?void 0:K.path)&&(K==null?void 0:K.method)&&(K==null?void 0:K.value)&&(yield this.init(e).database().ref(K==null?void 0:K.path).req(K==null?void 0:K.method,K==null?void 0:K.path,K==null?void 0:K.value).val())}l.exists()&&(yield(P=(N=(b=j(this,Fe))==null?void 0:b.ref(p))==null?void 0:N.remove())==null?void 0:P.catch(Q=>{})),yield(U=(C=(O=j(this,Fe))==null?void 0:O.ref(d))==null?void 0:C.remove())==null?void 0:U.catch(Q=>{})}}});(W=(V=e==null?void 0:e.socket)==null?void 0:V.database)==null||W.on("connect",()=>{de(this,Ue,!0),s()}),(oe=(X=e==null?void 0:e.socket)==null?void 0:X.database)==null||oe.on("disconnect",()=>{de(this,Ue,!1)});const o=(d={})=>{var m,l,x;let p={};if(d&&Object.keys(d).length>0&&(p.data=d),j(this,ut)&&(p.storage=j(this,ut),p.config=j(this,Or)),j(this,_r)){let h=new FormData;Array.isArray(d)?(d.map((f,w)=>{typeof f=="object"&&(f.attachmentName="attachment"+w,f==null||f.attachments.forEach(v=>{v!=null&&v.data?h.append("attachments"+w,v==null?void 0:v.data,v==null?void 0:v.name):h.append("attachments"+w,v)}))}),h.append("field",JSON.stringify(p))):Array.isArray(d==null?void 0:d.attachments)&&(d==null||d.attachments.forEach(f=>{f!=null&&f.data?h.append("attachments",f==null?void 0:f.data,f==null?void 0:f.name):h.append("attachments",f)}),delete p.data.attachments,h.append("field",JSON.stringify(p))),p=h}else if(j(this,ut)&&(d==null?void 0:d.file)){let h=new FormData;d!=null&&d.file?((m=d.file)!=null&&m.data?h.append("file",(l=d.file)==null?void 0:l.data,(x=d.file)==null?void 0:x.name):h.append("file",d.file),delete p.data.file,h.append("field",JSON.stringify(p))):Array.isArray(d==null?void 0:d.directory)&&(d==null||d.directory.forEach(f=>{f!=null&&f.data?h.append("file",f==null?void 0:f.data,f==null?void 0:f.name):h.append("file",f)}),delete p.data.directory,h.append("field",JSON.stringify(p)),p=h),p=h}return p};let a=(d,p)=>$(this,null,function*(){var m,l,x,h,f,w,v,T;if(((m=d==null?void 0:d.error)==null?void 0:m.token)&&j(this,Ft)){if(de(this,Ft,!1),localStorage.getItem("refreshToken")){t==="dev"&&console.log("Token expired or not found: ",(l=d.error)==null?void 0:l.token," Trying to request a new refresh token");let b=yield(h=(x=this==null?void 0:this.init(e))==null?void 0:x.auth())==null?void 0:h.req(ui.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(b!=null&&b.error)return t==="dev"&&console.log("Refresh token expired or not found: ",b),j(this,Xt)&&(window.top.location.href=j(this,Xt)),b;if(b!=null&&b.data&&(t==="dev"&&console.log("We got a new refresh token ,",b==null?void 0:b.data),(f=b==null?void 0:b.data)!=null&&f.token&&localStorage.setItem("accessToken",(w=b==null?void 0:b.data)==null?void 0:w.token),(v=b==null?void 0:b.data)!=null&&v.refreshToken&&localStorage.setItem("refreshToken",(T=b==null?void 0:b.data)==null?void 0:T.refreshToken),t==="dev"&&console.log("Trying to restart your request..."),typeof p=="function"))return yield p()}}else return d});const c=(d,p,m,l=()=>{})=>{const x=j(this,mn);let h=p.version+x+p.base+m;h=h.replace(/\/\//g,"/"),t==="dev"&&console.log("socket listen local path: ",h),d==null||d.on(h,l)},u=(d,p=()=>{})=>{var x;const m=j(this,mn);let l=(i==null?void 0:i.DATABASE)+m+d;l=l.replace(/\/\//g,"/"),t==="dev"&&console.log("emitter listen local path: ",l),(x=j(this,Mn))==null||x.on(l,p)};let y=(d,p,m,l)=>(j(this,gn)&&(l=l+j(this,gn)),{req:x=>(c(d,p,l+et.req,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),create:x=>(c(d,p,l+et.create,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),find:x=>(c(d,p,l+et.find,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),get:x=>(c(d,p,l+et.get,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),query:x=>(c(d,p,l+et.query,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),update:x=>(c(d,p,l+et.update,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m),delete:x=>(c(d,p,l+et.delete,h=>{var f,w,v;(!((w=(f=h==null?void 0:h.error)==null?void 0:f.error)!=null&&w.token)&&!((v=h==null?void 0:h.error)!=null&&v.token)||(h==null?void 0:h.data))&&typeof x=="function"&&x(q(_({},m),{value:h}))}),m)}),g=(d,p)=>({create:m=>(u(d+et.create,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),find:m=>(u(d+et.find,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),get:m=>(u(d+et.get,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),query:m=>(u(d+et.query,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),update:m=>(u(d+et.update,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),delete:m=>(u(d+et.delete,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p)}),k=co.init(j(this,Zt)),E=(d="",p={},m={},l={},x)=>{d=d.trim(),d.charAt(d.length-1)==="/"&&(d=d.slice(0,-1));let f=(()=>$(this,null,function*(){let w=()=>$(this,null,function*(){return yield k("post",n.AUTH+i.AUTH+ui.base+d,o(p))}),v=yield w();return j(this,Ft)&&(v=yield a(v,()=>$(this,null,function*(){return yield w()}))),typeof x=="function"&&x(q(_({},l),{value:v})),v}))();return q(_({},l),{val:()=>f})},A=(d,p,m,l={},x={},h)=>{let w=(()=>$(this,null,function*(){let v=()=>$(this,null,function*(){return yield k(d,p,o(m),l)}),T=yield v();return j(this,Ft)&&(T=yield a(T,()=>$(this,null,function*(){return yield v()}))),typeof h=="function"&&h(q(_({},x),{value:T})),T}))();return q(_({},x),{val:()=>w})},S=d=>{let p={},m,[l={},,,]=d;if(d.length===1&&typeof l=="function"&&(m=d[0],l={}),d.length===2&&(typeof d[1]=="object"?p=d[1]:typeof d[1]=="function"&&(m=d[1])),d.length>=3){let[,x,h]=d;typeof x=="object"&&(p=x),m=h}return{data:l,onRequest:p,callback:m}},I=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),R=(d,p,m={},l,x)=>{p=p.replace(/\/\//g,"/");let f=(()=>$(this,null,function*(){var O,C,U,z,Q,K,ge,ae,ce,pe,se,we,le,Ae,ve,Pe,We,Ot,_t,It,Pt,Nt,Rt;let w="/transaction",v,T,b={error:{message:"We could not execute the "+d+" method for path: "+p}};switch(d){case"create":yield(U=(C=(O=j(this,Fe))==null?void 0:O.ref(p))==null?void 0:C.set(m))==null?void 0:U.catch(ne=>b);break;case"update":yield(K=(Q=(z=j(this,Fe))==null?void 0:z.ref(p))==null?void 0:Q.update(m))==null?void 0:K.catch(ne=>b);break;case"query":let Y=(ge=j(this,Fe))==null?void 0:ge.query(p);Array.isArray(m==null?void 0:m.where)&&(yield Promise.all(m==null?void 0:m.where.map(ne=>$(this,null,function*(){return yield new Promise(ke=>{Y==null||Y.filter(...ne),ke()})})))),m!=null&&m.take&&(Y==null||Y.take(m==null?void 0:m.take)),m!=null&&m.skip&&(Y==null||Y.take(m==null?void 0:m.skip)),m!=null&&m.order&&Array.isArray(m==null?void 0:m.order)&&(yield Promise.all(m==null?void 0:m.order.map(ne=>$(this,null,function*(){return yield new Promise(ke=>{Y==null||Y.sort(...ne),ke()})})))),T=yield Y==null?void 0:Y.count(),v=yield(ae=Y==null?void 0:Y.get(_({},m==null?void 0:m.$option)))==null?void 0:ae.catch(ne=>b);break;case"delete":v=yield(se=(pe=(ce=j(this,Fe))==null?void 0:ce.ref(p))==null?void 0:pe.get())==null?void 0:se.catch(ne=>b),yield(Ae=(le=(we=j(this,Fe))==null?void 0:we.ref(p))==null?void 0:le.remove())==null?void 0:Ae.catch(ne=>b);break}if(d!=="delete"&&d!=="query"&&(v=yield(We=(Pe=(ve=j(this,Fe))==null?void 0:ve.ref(p))==null?void 0:Pe.get(_({},m==null?void 0:m.$option)))==null?void 0:We.catch(Y=>b)),d==="query"?v.exists()?(v=v==null?void 0:v.getValues(),v={data:v,max:T,take:m==null?void 0:m.take,skip:m==null?void 0:m.skip}):v=_({},b):v.exists()?(v=v==null?void 0:v.val(),v={data:v}):v=_({},b),j(this,lt)&&l.auth().$currentUserId&&!j(this,Ue)&&["create","delete","update"].includes(d)&&v!=null&&v.data){let Y=yield(It=(_t=(Ot=j(this,Fe))==null?void 0:Ot.ref(w))==null?void 0:_t.get())==null?void 0:It.catch(On=>b);Y.exists()?Y=Y.val():Y={};let ne,ke=Object.keys(Y);switch(ke.length>0?ne=ke.length+1:ne=0,d){case"create":d="post";break;case"update":d="put";break;case"delete":d="delete";break}d!=="get"&&(yield(Rt=(Nt=(Pt=j(this,Fe))==null?void 0:Pt.ref(w+"/"+ne))==null?void 0:Nt.set({path:p,method:d,uid:ne,value:v.data}))==null?void 0:Rt.catch(On=>b))}const N=j(this,mn);let P=(i==null?void 0:i.DATABASE)+N+p+"/"+d;return P=P.replace(/\/\//g,"/"),j(this,Mn).emit(P,v),typeof x=="function"&&x(q(_({},l),{value:v})),v}))();return q(_({},l),{val:()=>f})},D=(d,p)=>{typeof d=="function"&&(p==null||p.on("connect",d))},B=(d,p)=>{let m="%"+d,l=this.init(e);return delete l.auth().login,delete l.auth().register,{private:(x=I())=>l.event(d+x),child:x=>l.event(d+x),emit:(x,h)=>(p==null||p.emit(m,x),typeof h=="function"&&l.event(d).do(h),_(_({},l.event(d)),l)),do:x=>(p==null||p.on(m,h=>{typeof x=="function"&&x(q(_(_({},l.event(d)),l),{value:h}))}),_(_({},l.event(d)),l)),onAny:x=>{p==null||p.onAny((h,f)=>{typeof x=="function"&&x(h,_(_({value:f},l.event(h)),l))})}}},M=(d,p,m)=>q(_({},d),{$io:m,connected:()=>m==null?void 0:m.connected,event:l=>B(l,m),ready:l=>D(l,m),ref:(l="")=>d.ref(l,p,m)});return{$connected:j(this,Ue),activity:()=>{let d=this.init(e);return{onStart:p=>(typeof p=="function"&&document.addEventListener("DOMContentLoaded",p),_(_({},d),d.activity())),onCreate:p=>(typeof p=="function"&&(window.onload=p),_(_({},d),d.activity())),onPause:p=>(window.addEventListener("beforeunload",function(m){typeof p=="function"&&p(),m.returnValue="onbeforeunload"}),_(_({},d),d.activity())),onResume:()=>_(_({},d),d.activity()),onLeave:p=>(typeof p=="function"&&(window.onunload=p),_(_({},d),d.activity()))}},socket:{database:(ie=e==null?void 0:e.socket)==null?void 0:ie.database},$randomUID:()=>Et(),$randomId:()=>I(),$axios:co,local:(d={})=>{const p=this.init(e);return delete p.local,delete p.auth().register,delete p.auth().login,{database:(m="/database")=>({ref:(l="/database")=>{let x=this.init(e);return delete x.auth().login,delete x.auth().register,l=l.trim(),l=l.replace(/\/\//g,"/"),m=m+"/"+l,m=m.replace(/\/\//g,"/"),l.charAt(l.length-1)==="/"&&(l=l.slice(0,-1)),{child:(h="")=>{var f,w;return h=h.trim(),h=h.replace(/\/\//g,"/"),h.charAt(h.length-1)==="/"&&(h=h.slice(0,-1)),h.charAt(0)!=="/"&&(h="/"+h),(w=(f=x.local())==null?void 0:f.database())==null?void 0:w.ref(l+h)},push:(...h)=>{var w,v;let f=Et();return!h.length>0?{getKey:()=>f}:(v=(w=x.local())==null?void 0:w.database())==null?void 0:v.ref(l+"/"+f).create(h)},create:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local(d))==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R(d,"create",m,w,f)},get:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("get",m,w,f,v)},find:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("get",m,w,f,v)},query:()=>{},update:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("update",m,w,f,v)},delete:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("delete",m,w,f,v)},on:()=>{var f,w;let h=_(_({},(w=(f=x.local())==null?void 0:f.database())==null?void 0:w.ref(l)),x);return g(l,h)},onValue:h=>{var v,T,b,N,P,O,C;let f=_(_({},(T=(v=x.local())==null?void 0:v.database())==null?void 0:T.ref(l)),x),w=(N=(b=x.local())==null?void 0:b.database())==null?void 0:N.ref(l);return(P=w==null?void 0:w.on())==null||P.create(h),(O=w==null?void 0:w.on())==null||O.update(h),(C=w==null?void 0:w.on())==null||C.delete(h),f}}}}),cache:(m="/cache")=>{var x;let l=this.init(e);return delete l.auth().login,delete l.auth().register,(x=l.local())==null?void 0:x.database(m)},storage:()=>({})}},database:()=>{var p,m,l;const d=this.init(e);return delete d.database,delete d.auth().register,delete d.auth().login,(p=e==null?void 0:e.socket)==null||p.database.on("connect",()=>{de(this,Ue,!0),s()}),(m=e==null?void 0:e.socket)==null||m.database.on("disconnect",()=>{de(this,Ue,!1)}),M(d,{host:n.DATABASE,version:i.DATABASE,base:uo.base},(l=e==null?void 0:e.socket)==null?void 0:l.database)},cron:d=>{},task:d=>{},$online:navigator==null?void 0:navigator.onLine,auth:()=>({req:(d,p,m)=>{let l=this.init(e);delete l.auth().login,delete l.auth().register;let x=_(_({},l),l.auth());return E(d+ui.req,p,null,x,m)}}),syncDatabase:(d=!0)=>{const p=this.init(e);return de(this,lt,typeof d=="boolean"?d:!0),p.database()},ref:(d="",p={host:n.DATABASE,version:i.DATABASE,base:uo.base},m=(x=>(x=e==null?void 0:e.socket)==null?void 0:x.database)(),l=!0)=>{d=d.trim(),d=d.replace(/\/\//g,"/"),d.charAt(0)==="/"&&d.length<=1&&(d="/root"),d.charAt(d.length-1)==="/"&&(d=d.slice(0,-1));const h=p.host+p.version+p.base+d;let f=this.init(e);return delete f.auth().login,delete f.auth().register,de(this,Ft,l),{push:(...w)=>{let v=Et();return!w.length>0?{getKey:()=>v}:f.ref(d+"/"+v,p,m).create(w)},private:(w=I())=>f.ref(d+"/ps"+w+"/pe",p,m),setAuthAccess:(w=!0,v=j(this,Xt))=>(de(this,Xt,v),f.ref(d,p,m,w)),req:(...w)=>{let v=_(_({},f.ref(d,p,m)),f);if(w.length>=2){let[T="post",b={},N={},P]=w;if(typeof T=="string"&&["post","put","delete","get"].includes(T)){let O=Be.req;return A(T,h+O,b,N,v,P)}return v}else{let T=w.filter(b=>typeof b=="function");if(T.length>0)T=T[0],typeof T=="function"&&T(v);else return v}},child:(w="")=>(w=w.trim(),w=w.replace(/\/\//g,"/"),w.charAt(w.length-1)==="/"&&(w=w.slice(0,-1)),w.charAt(0)!=="/"&&(w="/"+w),f.ref(d+w,p,m)),set:(...w)=>{var v;return(v=f.ref(d,p,m))==null?void 0:v.create(...w)},create:(...w)=>{var T,b,N,P;let v=_(_({},f.ref(d,p,m)),f);if(f.auth().$currentUserId&&(p==null?void 0:p.host)===(n==null?void 0:n.DATABASE)&&j(this,lt)&&!j(this,Ue))return(N=(b=(T=f.local())==null?void 0:T.database())==null?void 0:b.ref(d))==null?void 0:N.create(...w);{let{data:O,onRequest:C,callback:U}=S(w),z=Be.create.one;if(j(this,ut)){if((O==null?void 0:O.file)||(O==null?void 0:O.directory))return(P=f.ref(d))==null?void 0:P.upload(O,null,U);Array.isArray(O.folders)&&(z=Be.create.many)}else Array!=null&&Array.isArray(O)&&(z=Be.create.many);return A("post",h+z,O,C,v,U)}},find:(...w)=>{var v,T,b,N;if(console.log("Database connected: ",j(this,Ue)),f.auth().$currentUserId&&(p==null?void 0:p.host)===(n==null?void 0:n.DATABASE)&&j(this,lt)&&!j(this,Ue))return t==="dev"&&console.log("Find: We are offline"),(b=(T=(v=f.local())==null?void 0:v.database())==null?void 0:T.ref(d))==null?void 0:b.find(...w);{t==="dev"&&console.log("Find: We are online");let P=_(_({},f.ref(d,p,m)),f),{data:O,onRequest:C,callback:U}=S(w),z=Be.find.one;return j(this,ut)?(Array.isArray(O==null?void 0:O.files)||Array.isArray(O==null?void 0:O.folders))&&(Array.isArray(O==null?void 0:O.files)&&(O.isFolder=!1),Array.isArray(O==null?void 0:O.folders)&&(O.isFolder=!0),z=Be.find.many):(((N=Object.keys(O))==null?void 0:N.length)<=0||O.order||O.where||O.$option||O.skip||O.take)&&(z=Be.find.many),A("post",h+z,O,C,P,U)}},get:(...w)=>{var v,T,b,N;if(f.auth().$currentUserId&&(p==null?void 0:p.host)===(n==null?void 0:n.DATABASE)&&j(this,lt)&&!j(this,Ue))return(b=(T=(v=f.local())==null?void 0:v.database())==null?void 0:T.ref(d))==null?void 0:b.get(...w);{let P=_(_({},f.ref(d,p,m)),f),{data:O,onRequest:C,callback:U}=S(w),z=Be.get.one;return j(this,ut)?(Array.isArray(O==null?void 0:O.files)||Array.isArray(O==null?void 0:O.folders))&&(Array.isArray(O==null?void 0:O.files)&&(O.isFolder=!1),Array.isArray(O==null?void 0:O.folders)&&(O.isFolder=!0),z=Be.get.many):(((N=Object.keys(O))==null?void 0:N.length)<=0||O.order||O.where||O.$option||O.skip||O.take)&&(z=Be.get.many),A("get",h+z+"?query="+JSON.stringify(o(O)),null,C,P,U)}},query:(...w)=>{var v,T,b;if(f.auth().$currentUserId&&(p==null?void 0:p.host)===(n==null?void 0:n.DATABASE)&&j(this,lt)&&!j(this,Ue))return(b=(T=(v=f.local())==null?void 0:v.database())==null?void 0:T.ref(d))==null?void 0:b.query(...w);{let N=_(_({},f.ref(d,p,m)),f),{data:P,onRequest:O,callback:C}=S(w);return(!P||P==="")&&(P={take:15},!j(this,gn)&&!P.order&&(P.order={uid:"ASC"})),A("get",h+Be.get.many+"?query="+JSON.stringify(o(P)),null,O,N,C)}},update:(...w)=>{var v,T,b;if(f.auth().$currentUserId&&(p==null?void 0:p.host)===(n==null?void 0:n.DATABASE)&&j(this,lt)&&!j(this,Ue))return(b=(T=(v=f.local())==null?void 0:v.database())==null?void 0:T.ref(d))==null?void 0:b.update(...w);{let N=_(_({},f.ref(d,p,m)),f),{data:P,onRequest:O,callback:C}=S(w),U=Be.update.one;return j(this,ut)?(Array.isArray(P==null?void 0:P.files)||Array.isArray(P==null?void 0:P.folders))&&(Array.isArray(P==null?void 0:P.files)&&(P.isFolder=!1),Array.isArray(P==null?void 0:P.folders)&&(P.isFolder=!0),U=Be.update.many):Array.isArray(P)&&(U=Be.find.many),A("put",h+U,P,O,N,C)}},delete:(...w)=>{var v,T,b;if(f.auth().$currentUserId&&(p==null?void 0:p.host)===(n==null?void 0:n.DATABASE)&&j(this,lt)&&!j(this,Ue))return(b=(T=(v=f.local())==null?void 0:v.database())==null?void 0:T.ref(d))==null?void 0:b.delete(...w);{let N=_(_({},f.ref(d,p,m)),f),{data:P,onRequest:O,callback:C}=S(w),U=Be.delete.one;return j(this,ut)?(Array.isArray(P==null?void 0:P.files)||Array.isArray(P==null?void 0:P.folders))&&(Array.isArray(P==null?void 0:P.files)&&(P.isFolder=!1),Array.isArray(P==null?void 0:P.folders)&&(P.isFolder=!0),Object.keys(P).length<=0&&(P.isFolder=!0),U=Be.delete.many):(Array.isArray(P)||P.where)&&(U=Be.delete.many),A("delete",h+U,P,O,N,C)}},on:()=>{let w=_(_({},f.ref(d,p,m)),f);return y(m,p,w,d)},onValue:w=>{let v=_(_({},f.ref(d,p,m)),f),T=f.ref(d,p,m);return T==null||T.on().create(w),T==null||T.on().update(w),T==null||T.on().delete(w),T==null||T.on().upload(w),v}}}}});de(this,Zt,e);let{ENV:t,OFFLINE_DB_NAME:n}=j(this,Zt);de(this,Fe,sn.WithIndexedDB((n==null?void 0:n.DATABASE)||"swyger_database"));let i=()=>$(this,null,function*(){try{let s,o=localStorage.getItem("accessToken");if((()=>{var c;try{s=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let u=mr(o);return(Date==null?void 0:Date.parse((c=new Date((u==null?void 0:u.exp)*1e3))==null?void 0:c.toString()))<Date.now()}catch(u){return!1}})()&&s.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(c){}}catch(s){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}mn=new WeakMap,Ft=new WeakMap,Xt=new WeakMap,gn=new WeakMap,ut=new WeakMap,Ui=new WeakMap,Or=new WeakMap,_r=new WeakMap,Mn=new WeakMap,lt=new WeakMap,Ue=new WeakMap,Zt=new WeakMap,Fe=new WeakMap;const ph={init:r=>{try{return(e={})=>new dh(r).init(e)}catch(e){return{}}}};let yh={init:r=>{var e,t,n,i,s;return{OFFLINE_DB_NAME:{DATABASE:((e=r==null?void 0:r.OFFLINE_DB_NAME)==null?void 0:e.DATABASE)||"swyger_database"},ENV:(r==null?void 0:r.ENV)||"prod",HOST_SERVER:{AUTH:((t=r==null?void 0:r.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100",DATABASE:((n=r==null?void 0:r.HOST_SERVER)==null?void 0:n.DATABASE)||"http://localhost:4400"},API_VERSION:{AUTH:((i=r==null?void 0:r.API_VERSION)==null?void 0:i.AUTH)||"/api/v1",DATABASE:((s=r==null?void 0:r.API_VERSION)==null?void 0:s.DATABASE)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(r==null?void 0:r.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(r==null?void 0:r.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const mh={init:r=>{let e=yh.init(r);const t=lh.init(e),n={socket:{database:t==null?void 0:t.database}};return ph.init(e)(n)}},gh={init:({API_KEY:r,HOST_SERVER:e,CURRENT:t,ENV:n,API_VERSION:i})=>{var a,c,u,y;let s={};const o=localStorage.getItem("accessToken");try{const g={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return o&&(g.Authorization="Bearer "+o),s.auth=zt(e.AUTH,{extraHeaders:g}),s.database=zt(e.DATABASE,{extraHeaders:g}),s.storage=zt(e.STORAGE,{extraHeaders:g}),(a=s==null?void 0:s.auth)==null||a.on("connect",()=>{var E,A,S,I,R;let k=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");k.uid&&(E=s.auth)!=null&&E.id&&(n==="dev"&&console.log("The socket device id is: ",(A=s.auth)==null?void 0:A.id),(I=s==null?void 0:s.auth)==null||I.emit((i==null?void 0:i.AUTH)+"/user/join",{socketId:(S=s.auth)==null?void 0:S.id,currentUserId:k.uid}),(R=s==null?void 0:s.auth)==null||R.on((i==null?void 0:i.AUTH)+"/user/status",D=>{if(k.status!=="online"){let B;D.from===k.uid&&(B=D==null?void 0:D.value),B!=null&&B.status&&(n==="dev"&&console.log("user is online: ",B),k.status=B.status,localStorage.setItem("userInfo",JSON.stringify(k)))}}))}),(c=s==null?void 0:s.auth)==null||c.on("disconnect",k=>{s.auth.disconnect(),n==="dev"&&console.log("The device is disconnected from Auth server");let E=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");E.uid&&E.status!=="offline"&&(E.status="offline",localStorage.setItem("userInfo",JSON.stringify(E)))}),(u=s==null?void 0:s.database)==null||u.on("disconnect",k=>{n==="dev"&&console.log("The device is disconnected from Database server")}),s.storage.connected||s.storage.disconnect(),(y=s==null?void 0:s.storage)==null||y.on("disconnect",k=>{var E;n==="dev"&&console.log("The device is disconnected from Storage server"),(E=s==null?void 0:s.storage)==null||E.disconnect()}),s}catch(g){}}},lo={init:({API_KEY:r})=>(...s)=>$(void 0,[...s],function*(e="post",t="/",n={},i={}){var g,k,E,A;const o=localStorage.getItem("accessToken");let a={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};o&&(a.Authorization="Bearer "+o);const c=t;typeof(n==null?void 0:n.get)=="function"&&(n==null?void 0:n.get("file"))&&(a["Content-Type"]="multipart/form-data"),i!=null&&i.headers&&(a=Object.assign(...a,...i.headers),delete i.headers);const u=Object.assign({mode:"cors",method:e,url:c,data:n,headers:a},i);let y={};try{const S=yield qi(u);y.data=((g=S==null?void 0:S.data)==null?void 0:g.data)||(S==null?void 0:S.data),y.data||(y.data={})}catch(S){y.error=((E=(k=S.response)==null?void 0:k.data)==null?void 0:E.error)||((A=S.response)==null?void 0:A.error),y.error||(y.error={})}return y})};let vh=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),li=(()=>"/ps"+vh()+"/pe")();const Le={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},Ve={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},fi={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+li+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+li+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+li+"/get-one",users:{base:"/users"}},Nn={base:"/storage",upload:"/upload",download:{one:"download-one",many:"download-many"}};var vn,Mt,en,wn,ze,Fi,bn,Ir,Kn,Kt,bt,tn,Me;class wh{constructor(e={}){re(this,vn,"/on");re(this,Mt,!0);re(this,en,void 0);re(this,wn,void 0);re(this,ze,void 0);re(this,Fi,void 0);re(this,bn,void 0);re(this,Ir,void 0);re(this,Kn,new Yi);re(this,Kt,void 0);re(this,bt,void 0);re(this,tn,void 0);re(this,Me,void 0);Yn(this,"init",e=>{var V,W,X,oe,ie;let{ENV:t,HOST_SERVER:n,API_VERSION:i}=j(this,tn),s=()=>$(this,null,function*(){var x,h,f,w,v,T,b,N,P,O,C,U;let d="/transaction",p="/database",m=yield(f=(h=(x=j(this,Me))==null?void 0:x.ref(d))==null?void 0:h.get())==null?void 0:f.catch(z=>{}),l=yield(T=(v=(w=j(this,Me))==null?void 0:w.ref(p))==null?void 0:v.get())==null?void 0:T.catch(z=>{});if(m.exists()){m=m.val();let z=Object.keys(m);if((z==null?void 0:z.length)>0){for(let Q in z){let K=m[Q];(K==null?void 0:K.path)&&(K==null?void 0:K.method)&&(K==null?void 0:K.value)&&(yield this.init(e).database().ref(K==null?void 0:K.path).req(K==null?void 0:K.method,K==null?void 0:K.path,K==null?void 0:K.value).val())}l.exists()&&(yield(P=(N=(b=j(this,Me))==null?void 0:b.ref(p))==null?void 0:N.remove())==null?void 0:P.catch(Q=>{})),yield(U=(C=(O=j(this,Me))==null?void 0:O.ref(d))==null?void 0:C.remove())==null?void 0:U.catch(Q=>{})}}});(W=(V=e==null?void 0:e.socket)==null?void 0:V.storage)==null||W.on("connect",()=>{de(this,bt,!0),s()}),(oe=(X=e==null?void 0:e.socket)==null?void 0:X.storage)==null||oe.on("disconnect",()=>{de(this,bt,!1)});const o=(d={})=>{var m,l,x;let p={};if(d&&Object.keys(d).length>0&&(p.data=d),j(this,ze)&&(p.storage=j(this,ze),p.config=j(this,bn)),j(this,Ir)){let h=new FormData;Array.isArray(d)?(d.map((f,w)=>{typeof f=="object"&&(f.attachmentName="attachment"+w,f==null||f.attachments.forEach(v=>{v!=null&&v.data?h.append("attachments"+w,v==null?void 0:v.data,v==null?void 0:v.name):h.append("attachments"+w,v)}))}),h.append("field",JSON.stringify(p))):Array.isArray(d==null?void 0:d.attachments)&&(d==null||d.attachments.forEach(f=>{f!=null&&f.data?h.append("attachments",f==null?void 0:f.data,f==null?void 0:f.name):h.append("attachments",f)}),delete p.data.attachments,h.append("field",JSON.stringify(p))),p=h}else if(j(this,ze)&&(d==null?void 0:d.file)){let h=new FormData;d!=null&&d.file?((m=d.file)!=null&&m.data?h.append("file",(l=d.file)==null?void 0:l.data,(x=d.file)==null?void 0:x.name):h.append("file",d.file),delete p.data.file,h.append("field",JSON.stringify(p))):Array.isArray(d==null?void 0:d.directory)&&(d==null||d.directory.forEach(f=>{f!=null&&f.data?h.append("file",f==null?void 0:f.data,f==null?void 0:f.name):h.append("file",f)}),delete p.data.directory,h.append("field",JSON.stringify(p)),p=h),p=h}return p};let a=(d,p)=>$(this,null,function*(){var m,l,x,h,f,w,v,T;if(((m=d==null?void 0:d.error)==null?void 0:m.token)&&j(this,Mt)){if(de(this,Mt,!1),localStorage.getItem("refreshToken")){t==="dev"&&console.log("Token expired or not found: ",(l=d.error)==null?void 0:l.token," Trying to request a new refresh token");let b=yield(h=(x=this==null?void 0:this.init(e))==null?void 0:x.auth())==null?void 0:h.req(fi.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(b!=null&&b.error)return t==="dev"&&console.log("Refresh token expired or not found: ",b),j(this,en)&&(window.top.location.href=j(this,en)),b;if(b!=null&&b.data&&(t==="dev"&&console.log("We got a new refresh token ,",b==null?void 0:b.data),(f=b==null?void 0:b.data)!=null&&f.token&&localStorage.setItem("accessToken",(w=b==null?void 0:b.data)==null?void 0:w.token),(v=b==null?void 0:b.data)!=null&&v.refreshToken&&localStorage.setItem("refreshToken",(T=b==null?void 0:b.data)==null?void 0:T.refreshToken),t==="dev"&&console.log("Trying to restart your request..."),typeof p=="function"))return yield p()}}else return d});const c=(d,p,m,l=()=>{})=>{const x=j(this,vn);let h=p.version+x+p.base+m;h=h.replace(/\/\//g,"/"),t==="dev"&&console.log("socket listen local path: ",h),d==null||d.on(h,l)},u=(d,p=()=>{})=>{var x;const m=j(this,vn);let l=(i==null?void 0:i.STORAGE)+m+d;l=l.replace(/\/\//g,"/"),t==="dev"&&console.log("emitter listen local path: ",l),(x=j(this,Kn))==null||x.on(l,p)};let y=(d,p,m,l)=>{j(this,wn)&&(l=l+j(this,wn));let x={req:h=>(c(d,p,l+Ve.req,f=>{var w,v,T;(!((v=(w=f==null?void 0:f.error)==null?void 0:w.error)!=null&&v.token)&&!((T=f==null?void 0:f.error)!=null&&T.token)||(f==null?void 0:f.data))&&typeof h=="function"&&h(q(_({},m),{value:f}))}),m),create:h=>(c(d,p,l+Ve.create,f=>{var w,v,T;(!((v=(w=f==null?void 0:f.error)==null?void 0:w.error)!=null&&v.token)&&!((T=f==null?void 0:f.error)!=null&&T.token)||(f==null?void 0:f.data))&&typeof h=="function"&&h(q(_({},m),{value:f}))}),m),find:h=>(c(d,p,l+Ve.find,f=>{var w,v,T;(!((v=(w=f==null?void 0:f.error)==null?void 0:w.error)!=null&&v.token)&&!((T=f==null?void 0:f.error)!=null&&T.token)||(f==null?void 0:f.data))&&typeof h=="function"&&h(q(_({},m),{value:f}))}),m),get:h=>(c(d,p,l+Ve.get,f=>{var w,v,T;(!((v=(w=f==null?void 0:f.error)==null?void 0:w.error)!=null&&v.token)&&!((T=f==null?void 0:f.error)!=null&&T.token)||(f==null?void 0:f.data))&&typeof h=="function"&&h(q(_({},m),{value:f}))}),m),query:h=>(c(d,p,l+Ve.query,f=>{var w,v,T;(!((v=(w=f==null?void 0:f.error)==null?void 0:w.error)!=null&&v.token)&&!((T=f==null?void 0:f.error)!=null&&T.token)||(f==null?void 0:f.data))&&typeof h=="function"&&h(q(_({},m),{value:f}))}),m),update:h=>(c(d,p,l+Ve.update,f=>{var w,v,T;(!((v=(w=f==null?void 0:f.error)==null?void 0:w.error)!=null&&v.token)&&!((T=f==null?void 0:f.error)!=null&&T.token)||(f==null?void 0:f.data))&&typeof h=="function"&&h(q(_({},m),{value:f}))}),m),delete:h=>(c(d,p,l+Ve.delete,f=>{var w,v,T;(!((v=(w=f==null?void 0:f.error)==null?void 0:w.error)!=null&&v.token)&&!((T=f==null?void 0:f.error)!=null&&T.token)||(f==null?void 0:f.data))&&typeof h=="function"&&h(q(_({},m),{value:f}))}),m)};return j(this,ze)&&(x.upload=h=>(c(d,p,l+Ve.upload,f=>{var w,v,T;(!((v=(w=f==null?void 0:f.error)==null?void 0:w.error)!=null&&v.token)&&!((T=f==null?void 0:f.error)!=null&&T.token)||(f==null?void 0:f.data))&&typeof h=="function"&&h(q(_({},m),{value:f}))}),m)),x},g=(d,p)=>({create:m=>(u(d+Ve.create,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),find:m=>(u(d+Ve.find,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),get:m=>(u(d+Ve.get,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),query:m=>(u(d+Ve.query,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),update:m=>(u(d+Ve.update,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p),delete:m=>(u(d+Ve.delete,l=>{(!(l!=null&&l.error)||(l==null?void 0:l.data))&&typeof m=="function"&&m(q(_({},p),{value:l}))}),p)}),k=lo.init(j(this,tn)),E=(d="",p={},m={},l={},x)=>{d=d.trim(),d.charAt(d.length-1)==="/"&&(d=d.slice(0,-1));let f=(()=>$(this,null,function*(){let w=()=>$(this,null,function*(){return yield k("post",n.AUTH+i.AUTH+fi.base+d,o(p))}),v=yield w();return j(this,Mt)&&(v=yield a(v,()=>$(this,null,function*(){return yield w()}))),typeof x=="function"&&x(q(_({},l),{value:v})),v}))();return q(_({},l),{val:()=>f})},A=(d,p,m,l={},x={},h)=>{let w=(()=>$(this,null,function*(){let v=()=>$(this,null,function*(){return yield k(d,p,o(m),l)}),T=yield v();return j(this,Mt)&&(T=yield a(T,()=>$(this,null,function*(){return yield v()}))),typeof h=="function"&&h(q(_({},x),{value:T})),T}))();return q(_({},x),{val:()=>w})},S=d=>{let p={},m,[l={},,,]=d;if(d.length===1&&typeof l=="function"&&(m=d[0],l={}),d.length===2&&(typeof d[1]=="object"?p=d[1]:typeof d[1]=="function"&&(m=d[1])),d.length>=3){let[,x,h]=d;typeof x=="object"&&(p=x),m=h}return{data:l,onRequest:p,callback:m}},I=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),R=(d,p,m={},l,x)=>{p=p.replace(/\/\//g,"/");let f=(()=>$(this,null,function*(){var O,C,U,z,Q,K,ge,ae,ce,pe,se,we,le,Ae,ve,Pe,We,Ot,_t,It,Pt,Nt,Rt;let w="/transaction",v,T,b={error:{message:"We could not execute the "+d+" method for path: "+p}};switch(d){case"create":yield(U=(C=(O=j(this,Me))==null?void 0:O.ref(p))==null?void 0:C.set(m))==null?void 0:U.catch(ne=>b);break;case"update":yield(K=(Q=(z=j(this,Me))==null?void 0:z.ref(p))==null?void 0:Q.update(m))==null?void 0:K.catch(ne=>b);break;case"query":let Y=(ge=j(this,Me))==null?void 0:ge.query(p);Array.isArray(m==null?void 0:m.where)&&(yield Promise.all(m==null?void 0:m.where.map(ne=>$(this,null,function*(){return yield new Promise(ke=>{Y==null||Y.filter(...ne),ke()})})))),m!=null&&m.take&&(Y==null||Y.take(m==null?void 0:m.take)),m!=null&&m.skip&&(Y==null||Y.take(m==null?void 0:m.skip)),m!=null&&m.order&&Array.isArray(m==null?void 0:m.order)&&(yield Promise.all(m==null?void 0:m.order.map(ne=>$(this,null,function*(){return yield new Promise(ke=>{Y==null||Y.sort(...ne),ke()})})))),T=yield Y==null?void 0:Y.count(),v=yield(ae=Y==null?void 0:Y.get(_({},m==null?void 0:m.$option)))==null?void 0:ae.catch(ne=>b);break;case"delete":v=yield(se=(pe=(ce=j(this,Me))==null?void 0:ce.ref(p))==null?void 0:pe.get())==null?void 0:se.catch(ne=>b),yield(Ae=(le=(we=j(this,Me))==null?void 0:we.ref(p))==null?void 0:le.remove())==null?void 0:Ae.catch(ne=>b);break}if(d!=="delete"&&d!=="query"&&(v=yield(We=(Pe=(ve=j(this,Me))==null?void 0:ve.ref(p))==null?void 0:Pe.get(_({},m==null?void 0:m.$option)))==null?void 0:We.catch(Y=>b)),d==="query"?v.exists()?(v=v==null?void 0:v.getValues(),v={data:v,max:T,take:m==null?void 0:m.take,skip:m==null?void 0:m.skip}):v=_({},b):v.exists()?(v=v==null?void 0:v.val(),v={data:v}):v=_({},b),j(this,Kt)&&l.auth().$currentUserId&&!j(this,bt)&&["create","delete","update"].includes(d)&&v!=null&&v.data){let Y=yield(It=(_t=(Ot=j(this,Me))==null?void 0:Ot.ref(w))==null?void 0:_t.get())==null?void 0:It.catch(On=>b);Y.exists()?Y=Y.val():Y={};let ne,ke=Object.keys(Y);switch(ke.length>0?ne=ke.length+1:ne=0,d){case"create":d="post";break;case"update":d="put";break;case"delete":d="delete";break}d!=="get"&&(yield(Rt=(Nt=(Pt=j(this,Me))==null?void 0:Pt.ref(w+"/"+ne))==null?void 0:Nt.set({path:p,method:d,uid:ne,value:v.data}))==null?void 0:Rt.catch(On=>b))}const N=j(this,vn);let P=(i==null?void 0:i.STORAGE)+N+p+"/"+d;return P=P.replace(/\/\//g,"/"),j(this,Kn).emit(P,v),typeof x=="function"&&x(q(_({},l),{value:v})),v}))();return q(_({},l),{val:()=>f})},D=(d,p)=>{typeof d=="function"&&(p==null||p.on("connect",d))},B=(d,p)=>{let m="%"+d,l=this.init(e);return delete l.auth().login,delete l.auth().register,{private:(x=I())=>l.event(d+x),child:x=>l.event(d+x),emit:(x,h)=>(p==null||p.emit(m,x),typeof h=="function"&&l.event(d).do(h),_(_({},l.event(d)),l)),do:x=>(p==null||p.on(m,h=>{typeof x=="function"&&x(q(_(_({},l.event(d)),l),{value:h}))}),_(_({},l.event(d)),l)),onAny:x=>{p==null||p.onAny((h,f)=>{typeof x=="function"&&x(h,_(_({value:f},l.event(h)),l))})}}},M=(d,p,m)=>q(_({},d),{$io:m,connected:()=>m==null?void 0:m.connected,event:l=>B(l,m),ready:l=>D(l,m),ref:(l="")=>d.ref(l,p,m)});return{$connected:j(this,bt),activity:()=>{let d=this.init(e);return{onStart:p=>(typeof p=="function"&&document.addEventListener("DOMContentLoaded",p),_(_({},d),d.activity())),onCreate:p=>(typeof p=="function"&&(window.onload=p),_(_({},d),d.activity())),onPause:p=>(window.addEventListener("beforeunload",function(m){typeof p=="function"&&p(),m.returnValue="onbeforeunload"}),_(_({},d),d.activity())),onResume:()=>_(_({},d),d.activity()),onLeave:p=>(typeof p=="function"&&(window.onunload=p),_(_({},d),d.activity()))}},socket:{storage:(ie=e==null?void 0:e.socket)==null?void 0:ie.storage},$randomUID:()=>Et(),$randomId:()=>I(),$axios:lo,local:(d={})=>{const p=this.init(e);return delete p.local,delete p.auth().register,delete p.auth().login,{database:(m="/database")=>({ref:(l="/database")=>{let x=this.init(e);return delete x.auth().login,delete x.auth().register,l=l.trim(),l=l.replace(/\/\//g,"/"),m=m+"/"+l,m=m.replace(/\/\//g,"/"),l.charAt(l.length-1)==="/"&&(l=l.slice(0,-1)),{child:(h="")=>{var f,w;return h=h.trim(),h=h.replace(/\/\//g,"/"),h.charAt(h.length-1)==="/"&&(h=h.slice(0,-1)),h.charAt(0)!=="/"&&(h="/"+h),(w=(f=x.local())==null?void 0:f.database())==null?void 0:w.ref(l+h)},push:(...h)=>{var w,v;let f=Et();return!h.length>0?{getKey:()=>f}:(v=(w=x.local())==null?void 0:w.database())==null?void 0:v.ref(l+"/"+f).create(h)},create:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local(d))==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R(d,"create",m,w,f)},get:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("get",m,w,f,v)},find:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("get",m,w,f,v)},query:()=>{},update:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("update",m,w,f,v)},delete:(...h)=>{var T,b;let f=_(_({},(b=(T=x.local())==null?void 0:T.database())==null?void 0:b.ref(l)),x),{data:w,callback:v}=S(h);return R("delete",m,w,f,v)},on:()=>{var f,w;let h=_(_({},(w=(f=x.local())==null?void 0:f.database())==null?void 0:w.ref(l)),x);return g(l,h)},onValue:h=>{var v,T,b,N,P,O,C;let f=_(_({},(T=(v=x.local())==null?void 0:v.database())==null?void 0:T.ref(l)),x),w=(N=(b=x.local())==null?void 0:b.database())==null?void 0:N.ref(l);return(P=w==null?void 0:w.on())==null||P.create(h),(O=w==null?void 0:w.on())==null||O.update(h),(C=w==null?void 0:w.on())==null||C.delete(h),f}}}}),cache:(m="/cache")=>{var x;let l=this.init(e);return delete l.auth().login,delete l.auth().register,(x=l.local())==null?void 0:x.database(m)},storage:()=>({})}},cron:d=>{},task:d=>{},storage:(d="local",p)=>{var l;switch(de(this,Kt,!1),de(this,ze,d),d){case"aws":break;case"discord":de(this,bn,{token:p==null?void 0:p.token,channelId:p==null?void 0:p.channelId});break}const m=this.init(e);return delete m.storage,delete m.auth().register,delete m.auth().login,M(m,{host:n.STORAGE,version:i.STORAGE,base:Nn.base},(l=e==null?void 0:e.socket)==null?void 0:l.storage)},$online:navigator==null?void 0:navigator.onLine,auth:()=>({req:(d,p,m)=>{let l=this.init(e);delete l.auth().login,delete l.auth().register;let x=_(_({},l),l.auth());return E(d+fi.req,p,null,x,m)}}),syncDatabase:(d=!0)=>{const p=this.init(e);return de(this,Kt,typeof d=="boolean"?d:!0),p.database()},ref:(d="",p={host:n.STORAGE,version:i.STORAGE,base:Nn.base},m=(x=>(x=e==null?void 0:e.socket)==null?void 0:x.database)(),l=!0)=>{d=d.trim(),d=d.replace(/\/\//g,"/"),d.charAt(0)==="/"&&d.length<=1&&(d="/root"),d.charAt(d.length-1)==="/"&&(d=d.slice(0,-1));const h=p.host+p.version+p.base+d;let f=this.init(e);delete f.auth().login,delete f.auth().register,de(this,Mt,l);let w={push:(...v)=>{let T=Et();return!v.length>0?{getKey:()=>T}:f.ref(d+"/"+T,p,m).create(v)},private:(v=I())=>f.ref(d+"/ps"+v+"/pe",p,m),setAuthAccess:(v=!0,T=j(this,en))=>(de(this,en,T),f.ref(d,p,m,v)),req:(...v)=>{let T=_(_({},f.ref(d,p,m)),f);if(v.length>=2){let[b="post",N={},P={},O]=v;if(typeof b=="string"&&["post","put","delete","get"].includes(b)){let C=Le.req;return A(b,h+C,N,P,T,O)}return T}else{let b=v.filter(N=>typeof N=="function");if(b.length>0)b=b[0],typeof b=="function"&&b(T);else return T}},child:(v="")=>(v=v.trim(),v=v.replace(/\/\//g,"/"),v.charAt(v.length-1)==="/"&&(v=v.slice(0,-1)),v.charAt(0)!=="/"&&(v="/"+v),f.ref(d+v,p,m)),set:(...v)=>{var T;return(T=f.ref(d,p,m))==null?void 0:T.create(...v)},create:(...v)=>{var O;let{data:T,onRequest:b,callback:N}=S(v),P=Le.create.one;if(j(this,ze)){if((T==null?void 0:T.file)||(T==null?void 0:T.directory))return(O=f.ref(d))==null?void 0:O.upload(T,null,N);Array.isArray(T.folders)&&(P=Le.create.many)}else Array!=null&&Array.isArray(T)&&(P=Le.create.many);return A("post",h+P,T,b,node,N)},find:(...v)=>{var C;t==="dev"&&console.log("Find: We are online");let T=_(_({},f.ref(d,p,m)),f),{data:b,onRequest:N,callback:P}=S(v),O=Le.find.one;return j(this,ze)?(Array.isArray(b==null?void 0:b.files)||Array.isArray(b==null?void 0:b.folders))&&(Array.isArray(b==null?void 0:b.files)&&(b.isFolder=!1),Array.isArray(b==null?void 0:b.folders)&&(b.isFolder=!0),O=Le.find.many):(((C=Object.keys(b))==null?void 0:C.length)<=0||b.order||b.where||b.$option||b.skip||b.take)&&(O=Le.find.many),A("post",h+O,b,N,T,P)},get:(...v)=>{var C;let T=_(_({},f.ref(d,p,m)),f),{data:b,onRequest:N,callback:P}=S(v),O=Le.get.one;return j(this,ze)?(Array.isArray(b==null?void 0:b.files)||Array.isArray(b==null?void 0:b.folders))&&(Array.isArray(b==null?void 0:b.files)&&(b.isFolder=!1),Array.isArray(b==null?void 0:b.folders)&&(b.isFolder=!0),O=Le.get.many):(((C=Object.keys(b))==null?void 0:C.length)<=0||b.order||b.where||b.$option||b.skip||b.take)&&(O=Le.get.many),A("get",h+O+"?query="+JSON.stringify(o(b)),null,N,T,P)},query:(...v)=>{var T,b,N;if(f.auth().$currentUserId&&(p==null?void 0:p.host)===(n==null?void 0:n.DATABASE)&&j(this,Kt)&&!j(this,bt))return(N=(b=(T=f.local())==null?void 0:T.database())==null?void 0:b.ref(d))==null?void 0:N.query(...v);{let P=_(_({},f.ref(d,p,m)),f),{data:O,onRequest:C,callback:U}=S(v);return(!O||O==="")&&(O={take:15},!j(this,wn)&&!O.order&&(O.order={uid:"ASC"})),A("get",h+Le.get.many+"?query="+JSON.stringify(o(O)),null,C,P,U)}},update:(...v)=>{let T=_(_({},f.ref(d,p,m)),f),{data:b,onRequest:N,callback:P}=S(v),O=Le.update.one;return j(this,ze)?(Array.isArray(b==null?void 0:b.files)||Array.isArray(b==null?void 0:b.folders))&&(Array.isArray(b==null?void 0:b.files)&&(b.isFolder=!1),Array.isArray(b==null?void 0:b.folders)&&(b.isFolder=!0),O=Le.update.many):Array.isArray(b)&&(O=Le.find.many),A("put",h+O,b,N,T,P)},delete:(...v)=>{var T,b,N;if(f.auth().$currentUserId&&(p==null?void 0:p.host)===(n==null?void 0:n.STORAGE)&&j(this,Kt)&&!j(this,bt))return(N=(b=(T=f.local())==null?void 0:T.database())==null?void 0:b.ref(d))==null?void 0:N.delete(...v);{let P=_(_({},f.ref(d,p,m)),f),{data:O,onRequest:C,callback:U}=S(v),z=Le.delete.one;return j(this,ze)?(Array.isArray(O==null?void 0:O.files)||Array.isArray(O==null?void 0:O.folders))&&(Array.isArray(O==null?void 0:O.files)&&(O.isFolder=!1),Array.isArray(O==null?void 0:O.folders)&&(O.isFolder=!0),Object.keys(O).length<=0&&(O.isFolder=!0),z=Le.delete.many):(Array.isArray(O)||O.where)&&(z=Le.delete.many),A("delete",h+z,O,C,P,U)}},on:()=>{let v=_(_({},f.ref(d,p,m)),f);return y(m,p,v,d)},onValue:v=>{let T=_(_({},f.ref(d,p,m)),f),b=f.ref(d,p,m);return b==null||b.on().create(v),b==null||b.on().update(v),b==null||b.on().delete(v),b==null||b.on().upload(v),T}};return j(this,ze)&&(w.download=(...v)=>{let T=_(_({},f.ref(d,p,m)),f),{data:b,onRequest:N,callback:P}=S(v),O=Nn.download.one;return(Array.isArray(b==null?void 0:b.files)||Array.isArray(b==null?void 0:b.folders))&&(O=Nn.download.many),A("get",h+O+"?query="+JSON.stringify(o(b)),null,N,T,P)},w.upload=(...v)=>{let T=_(_({},f.ref(d,p,m)),f),{data:b,onRequest:N,callback:P}=S(v),O=Nn.upload+"?query="+JSON.stringify({storage:j(this,ze),config:j(this,bn)});return A("post",h+O,b,N,T,P)}),w}}});de(this,tn,e);let{ENV:t,OFFLINE_DB_NAME:n}=j(this,tn);de(this,Me,sn.WithIndexedDB((n==null?void 0:n.STORAGE)||"swyger_storage"));let i=()=>$(this,null,function*(){try{let s,o=localStorage.getItem("accessToken");if((()=>{var c;try{s=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let u=mr(o);return(Date==null?void 0:Date.parse((c=new Date((u==null?void 0:u.exp)*1e3))==null?void 0:c.toString()))<Date.now()}catch(u){return!1}})()&&s.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(c){}}catch(s){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}vn=new WeakMap,Mt=new WeakMap,en=new WeakMap,wn=new WeakMap,ze=new WeakMap,Fi=new WeakMap,bn=new WeakMap,Ir=new WeakMap,Kn=new WeakMap,Kt=new WeakMap,bt=new WeakMap,tn=new WeakMap,Me=new WeakMap;const bh={init:r=>{try{return(e={})=>new wh(r).init(e)}catch(e){return{}}}};let xh={init:r=>{var e,t,n,i,s;return{OFFLINE_DB_NAME:{STORAGE:((e=r==null?void 0:r.OFFLINE_DB_NAME)==null?void 0:e.STORAGE)||"swyger_storage"},ENV:(r==null?void 0:r.ENV)||"prod",HOST_SERVER:{AUTH:((t=r==null?void 0:r.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100",STORAGE:((n=r==null?void 0:r.HOST_SERVER)==null?void 0:n.STORAGE)||"http://localhost:4500"},API_VERSION:{AUTH:((i=r==null?void 0:r.API_VERSION)==null?void 0:i.AUTH)||"/api/v1",STORAGE:((s=r==null?void 0:r.API_VERSION)==null?void 0:s.STORAGE)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(r==null?void 0:r.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(r==null?void 0:r.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const Ah={init:r=>{let e=xh.init(r);const t=gh.init(e),n={socket:{storage:t==null?void 0:t.storage}};return bh.init(e)(n)}},Ey={init:r=>{const e=uh.init(r),t=mh.init(r),n=Ah.init(r);return{auth:e,database:t,storage:n}}};var Ni=function(r,e){return Ni=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},Ni(r,e)};function Oe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ni(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Eh(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(y){try{u(n.next(y))}catch(g){o(g)}}function c(y){try{u(n.throw(y))}catch(g){o(g)}}function u(y){y.done?s(y.value):i(y.value).then(a,c)}u((n=n.apply(r,e||[])).next())})}function os(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(y){return c([u,y])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(y){u=[6,y],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Ge(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ye(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function me(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))}function dn(r){return this instanceof dn?(this.v=r,this):new dn(r)}function kh(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(k){n[k]&&(i[k]=function(E){return new Promise(function(A,S){s.push([k,E,A,S])>1||a(k,E)})})}function a(k,E){try{c(n[k](E))}catch(A){g(s[0][3],A)}}function c(k){k.value instanceof dn?Promise.resolve(k.value.v).then(u,y):g(s[0][2],k)}function u(k){a("next",k)}function y(k){a("throw",k)}function g(k,E){k(E),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Sh(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Ge=="function"?Ge(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=r[s]&&function(o){return new Promise(function(a,c){o=r[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function te(r){return typeof r=="function"}function on(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var hr=on(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function kt(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var Xe=function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Ge(o),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(S){e={error:S}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var y=this.initialTeardown;if(te(y))try{y()}catch(S){s=S instanceof hr?S.errors:[S]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var k=Ge(g),E=k.next();!E.done;E=k.next()){var A=E.value;try{fo(A)}catch(S){s=s!=null?s:[],S instanceof hr?s=me(me([],ye(s)),ye(S.errors)):s.push(S)}}}catch(S){n={error:S}}finally{try{E&&!E.done&&(i=k.return)&&i.call(k)}finally{if(n)throw n.error}}}if(s)throw new hr(s)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)fo(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&kt(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&kt(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=function(){var e=new r;return e.closed=!0,e}(),r}(),ka=Xe.EMPTY;function Sa(r){return r instanceof Xe||r&&"closed"in r&&te(r.remove)&&te(r.add)&&te(r.unsubscribe)}function fo(r){te(r)?r():r.unsubscribe()}var Ht={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},xr={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=xr.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,me([r,e],ye(t))):setTimeout.apply(void 0,me([r,e],ye(t)))},clearTimeout:function(r){var e=xr.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(r)},delegate:void 0};function Ta(r){xr.setTimeout(function(){var e=Ht.onUnhandledError;if(e)e(r);else throw r})}function Te(){}var Th=function(){return as("C",void 0,void 0)}();function Oh(r){return as("E",void 0,r)}function _h(r){return as("N",r,void 0)}function as(r,e,t){return{kind:r,value:e,error:t}}var Yt=null;function dr(r){if(Ht.useDeprecatedSynchronousErrorHandling){var e=!Yt;if(e&&(Yt={errorThrown:!1,error:null}),r(),e){var t=Yt,n=t.errorThrown,i=t.error;if(Yt=null,n)throw i}}else r()}function Ih(r){Ht.useDeprecatedSynchronousErrorHandling&&Yt&&(Yt.errorThrown=!0,Yt.error=r)}var Dr=function(r){Oe(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Sa(t)&&t.add(n)):n.destination=$h,n}return e.create=function(t,n,i){return new En(t,n,i)},e.prototype.next=function(t){this.isStopped?di(_h(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?di(Oh(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?di(Th,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Xe),Ph=Function.prototype.bind;function hi(r,e){return Ph.call(r,e)}var Nh=function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){rr(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){rr(n)}else rr(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){rr(t)}},r}(),En=function(r){Oe(e,r);function e(t,n,i){var s=r.call(this)||this,o;if(te(t)||!t)o={next:t!=null?t:void 0,error:n!=null?n:void 0,complete:i!=null?i:void 0};else{var a;s&&Ht.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&hi(t.next,a),error:t.error&&hi(t.error,a),complete:t.complete&&hi(t.complete,a)}):o=t}return s.destination=new Nh(o),s}return e}(Dr);function rr(r){Ht.useDeprecatedSynchronousErrorHandling?Ih(r):Ta(r)}function Rh(r){throw r}function di(r,e){var t=Ht.onStoppedNotification;t&&xr.setTimeout(function(){return t(r,e)})}var $h={closed:!0,next:Te,error:Rh,complete:Te},Ur=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function $e(r){return r}function cs(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Oa(r)}function Oa(r){return r.length===0?$e:r.length===1?r[0]:function(t){return r.reduce(function(n,i){return i(n)},t)}}var fe=function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var i=this,s=Ch(e)?e:new En(e,t,n);return dr(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=ho(t),new t(function(i,s){var o=new En({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});n.subscribe(o)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[Ur]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Oa(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=ho(e),new e(function(n,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},r.create=function(e){return new r(e)},r}();function ho(r){var e;return(e=r!=null?r:Ht.Promise)!==null&&e!==void 0?e:Promise}function jh(r){return r&&te(r.next)&&te(r.error)&&te(r.complete)}function Ch(r){return r&&r instanceof Dr||jh(r)&&Sa(r)}function _a(r){return te(r==null?void 0:r.lift)}function G(r){return function(e){if(_a(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function J(r,e,t,n,i){return new us(r,e,t,n,i)}var us=function(r){Oe(e,r);function e(t,n,i,s,o,a){var c=r.call(this,t)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=n?function(u){try{n(u)}catch(y){t.error(y)}}:r.prototype._next,c._error=s?function(u){try{s(u)}catch(y){t.error(y)}finally{this.unsubscribe()}}:r.prototype._error,c._complete=i?function(){try{i()}catch(u){t.error(u)}finally{this.unsubscribe()}}:r.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;r.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(Dr);function Ia(){return G(function(r,e){var t=null;r._refCount++;var n=J(e,void 0,void 0,void 0,function(){if(!r||r._refCount<=0||0<--r._refCount){t=null;return}var i=r._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});r.subscribe(n),n.closed||(t=r.connect())})}var Fr=function(r){Oe(e,r);function e(t,n){var i=r.call(this)||this;return i.source=t,i.subjectFactory=n,i._subject=null,i._refCount=0,i._connection=null,_a(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,n=this._connection;if(!n){n=this._connection=new Xe;var i=this.getSubject();n.add(this.source.subscribe(J(i,void 0,function(){t._teardown(),i.complete()},function(s){t._teardown(),i.error(s)},function(){return t._teardown()}))),n.closed&&(this._connection=null,n=Xe.EMPTY)}return n},e.prototype.refCount=function(){return Ia()(this)},e}(fe),Pa={now:function(){return(Pa.delegate||performance).now()},delegate:void 0},nn={schedule:function(r){var e=requestAnimationFrame,t=cancelAnimationFrame,n=nn.delegate;n&&(e=n.requestAnimationFrame,t=n.cancelAnimationFrame);var i=e(function(s){t=void 0,r(s)});return new Xe(function(){return t==null?void 0:t(i)})},requestAnimationFrame:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=nn.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,me([],ye(r)))},cancelAnimationFrame:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=nn.delegate;return((t==null?void 0:t.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,me([],ye(r)))},delegate:void 0};function Bh(r){return r?Na(r):Lh}function Na(r){return new fe(function(e){var t=r||Pa,n=t.now(),i=0,s=function(){e.closed||(i=nn.requestAnimationFrame(function(o){i=0;var a=t.now();e.next({timestamp:r?a:o,elapsed:a-n}),s()}))};return s(),function(){i&&nn.cancelAnimationFrame(i)}})}var Lh=Na(),Ra=on(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ie=function(r){Oe(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new po(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new Ra},e.prototype.next=function(t){var n=this;dr(function(){var i,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var o=Ge(n.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(t)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var n=this;dr(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var i=n.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;dr(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?ka:(this.currentObservers=null,a.push(t),new Xe(function(){n.currentObservers=null,kt(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,s=n.thrownError,o=n.isStopped;i?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new fe;return t.source=this,t},e.create=function(t,n){return new po(t,n)},e}(fe),po=function(r){Oe(e,r);function e(t,n){var i=r.call(this)||this;return i.destination=t,i.source=n,i}return e.prototype.next=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,t)},e.prototype.error=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&i!==void 0?i:ka},e}(Ie),$a=function(r){Oe(e,r);function e(t){var n=r.call(this)||this;return n._value=t,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var n=r.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},e.prototype.getValue=function(){var t=this,n=t.hasError,i=t.thrownError,s=t._value;if(n)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){r.prototype.next.call(this,this._value=t)},e}(Ie),Mr={now:function(){return(Mr.delegate||Date).now()},delegate:void 0},ls=function(r){Oe(e,r);function e(t,n,i){t===void 0&&(t=1/0),n===void 0&&(n=1/0),i===void 0&&(i=Mr);var s=r.call(this)||this;return s._bufferSize=t,s._windowTime=n,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,n),s}return e.prototype.next=function(t){var n=this,i=n.isStopped,s=n._buffer,o=n._infiniteTimeWindow,a=n._timestampProvider,c=n._windowTime;i||(s.push(t),!o&&s.push(a.now()+c)),this._trimBuffer(),r.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(t),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!t.closed;c+=s?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),n},e.prototype._trimBuffer=function(){var t=this,n=t._bufferSize,i=t._timestampProvider,s=t._buffer,o=t._infiniteTimeWindow,a=(o?1:2)*n;if(n<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),u=0,y=1;y<s.length&&s[y]<=c;y+=2)u=y;u&&s.splice(0,u+1)}},e}(Ie),fs=function(r){Oe(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,s=n._hasValue,o=n._value,a=n.thrownError,c=n.isStopped,u=n._isComplete;i?t.error(a):(c||u)&&(s&&t.next(o),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,n=t._hasValue,i=t._value,s=t._isComplete;s||(this._isComplete=!0,n&&r.prototype.next.call(this,i),r.prototype.complete.call(this))},e}(Ie),Dh=function(r){Oe(e,r);function e(t,n){return r.call(this)||this}return e.prototype.schedule=function(t,n){return this},e}(Xe),Ar={setInterval:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=Ar.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,me([r,e],ye(t))):setInterval.apply(void 0,me([r,e],ye(t)))},clearInterval:function(r){var e=Ar.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(r)},delegate:void 0},Vn=function(r){Oe(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return e.prototype.schedule=function(t,n){var i;if(n===void 0&&(n=0),this.closed)return this;this.state=t;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,n)),this.pending=!0,this.delay=n,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,n),this},e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),Ar.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,n,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return n;n!=null&&Ar.clearInterval(n)},e.prototype.execute=function(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,n){var i=!1,s;try{this.work(t)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,n=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,kt(s,this),n!=null&&(this.id=this.recycleAsyncId(i,n,null)),this.delay=null,r.prototype.unsubscribe.call(this)}},e}(Dh),Uh=1,pi,Ri={};function yo(r){return r in Ri?(delete Ri[r],!0):!1}var ja={setImmediate:function(r){var e=Uh++;return Ri[e]=!0,pi||(pi=Promise.resolve()),pi.then(function(){return yo(e)&&r()}),e},clearImmediate:function(r){yo(r)}},Fh=ja.setImmediate,Mh=ja.clearImmediate,Er={setImmediate:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Er.delegate;return((t==null?void 0:t.setImmediate)||Fh).apply(void 0,me([],ye(r)))},clearImmediate:function(r){var e=Er.delegate;return((e==null?void 0:e.clearImmediate)||Mh)(r)},delegate:void 0},Kh=function(r){Oe(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!==null&&i>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=Er.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,n,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return r.prototype.recycleAsyncId.call(this,t,n,i);var o=t.actions;n!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==n&&(Er.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))},e}(Vn),$i=function(){function r(e,t){t===void 0&&(t=r.now),this.schedulerActionCtor=e,this.now=t}return r.prototype.schedule=function(e,t,n){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},r.now=Mr.now,r}(),Hn=function(r){Oe(e,r);function e(t,n){n===void 0&&(n=$i.now);var i=r.call(this,t,n)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var n=this.actions;if(this._active){n.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=n.shift());if(this._active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}},e}($i),Wh=function(r){Oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var n=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw s}},e}(Hn),Ca=new Wh(Kh),zh=Ca,ot=new Hn(Vn),hs=ot,Vh=function(r){Oe(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.schedule=function(t,n){return n===void 0&&(n=0),n>0?r.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,n){return n>0||this.closed?r.prototype.execute.call(this,t,n):this._execute(t,n)},e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.flush(this),0)},e}(Vn),Hh=function(r){Oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(Hn),Ba=new Hh(Vh),Jh=Ba,qh=function(r){Oe(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!==null&&i>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=nn.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,n,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return r.prototype.recycleAsyncId.call(this,t,n,i);var o=t.actions;n!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==n&&(nn.cancelAnimationFrame(n),t._scheduled=void 0)},e}(Vn),Yh=function(r){Oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var n=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw s}},e}(Hn),La=new Yh(qh),Gh=La,Qh=function(r){Oe(e,r);function e(t,n){t===void 0&&(t=Da),n===void 0&&(n=1/0);var i=r.call(this,t,function(){return i.frame})||this;return i.maxFrames=n,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,n=t.actions,i=t.maxFrames,s,o;(o=n[0])&&o.delay<=i&&(n.shift(),this.frame=o.delay,!(s=o.execute(o.state,o.delay))););if(s){for(;o=n.shift();)o.unsubscribe();throw s}},e.frameTimeFactor=10,e}(Hn),Da=function(r){Oe(e,r);function e(t,n,i){i===void 0&&(i=t.index+=1);var s=r.call(this,t,n)||this;return s.scheduler=t,s.work=n,s.index=i,s.active=!0,s.index=t.index=i,s}return e.prototype.schedule=function(t,n){if(n===void 0&&(n=0),Number.isFinite(n)){if(!this.id)return r.prototype.schedule.call(this,t,n);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,n)}else return Xe.EMPTY},e.prototype.requestAsyncId=function(t,n,i){i===void 0&&(i=0),this.delay=t.frame+i;var s=t.actions;return s.push(this),s.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,n,i){},e.prototype._execute=function(t,n){if(this.active===!0)return r.prototype._execute.call(this,t,n)},e.sortActions=function(t,n){return t.delay===n.delay?t.index===n.index?0:t.index>n.index?1:-1:t.delay>n.delay?1:-1},e}(Vn),wt=new fe(function(r){return r.complete()});function Xh(r){return r?Zh(r):wt}function Zh(r){return new fe(function(e){return r.schedule(function(){return e.complete()})})}function Kr(r){return r&&te(r.schedule)}function ds(r){return r[r.length-1]}function Jn(r){return te(ds(r))?r.pop():void 0}function St(r){return Kr(ds(r))?r.pop():void 0}function Ua(r,e){return typeof ds(r)=="number"?r.pop():e}var ps=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function Fa(r){return te(r==null?void 0:r.then)}function Ma(r){return te(r[Ur])}function Ka(r){return Symbol.asyncIterator&&te(r==null?void 0:r[Symbol.asyncIterator])}function Wa(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function ed(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var za=ed();function Va(r){return te(r==null?void 0:r[za])}function Ha(r){return kh(this,arguments,function(){var t,n,i,s;return os(this,function(o){switch(o.label){case 0:t=r.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,dn(t.read())];case 3:return n=o.sent(),i=n.value,s=n.done,s?[4,dn(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,dn(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Ja(r){return te(r==null?void 0:r.getReader)}function Z(r){if(r instanceof fe)return r;if(r!=null){if(Ma(r))return td(r);if(ps(r))return nd(r);if(Fa(r))return rd(r);if(Ka(r))return qa(r);if(Va(r))return id(r);if(Ja(r))return sd(r)}throw Wa(r)}function td(r){return new fe(function(e){var t=r[Ur]();if(te(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function nd(r){return new fe(function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}function rd(r){return new fe(function(e){r.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Ta)})}function id(r){return new fe(function(e){var t,n;try{for(var i=Ge(r),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){t={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()})}function qa(r){return new fe(function(e){od(r,e).catch(function(t){return e.error(t)})})}function sd(r){return qa(Ha(r))}function od(r,e){var t,n,i,s;return Eh(this,void 0,void 0,function(){var o,a;return os(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=Sh(r),c.label=1;case 1:return[4,t.next()];case 2:if(n=c.sent(),!!n.done)return[3,4];if(o=n.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Qe(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(s),!i)return s}function Wr(r,e){return e===void 0&&(e=0),G(function(t,n){t.subscribe(J(n,function(i){return Qe(n,r,function(){return n.next(i)},e)},function(){return Qe(n,r,function(){return n.complete()},e)},function(i){return Qe(n,r,function(){return n.error(i)},e)}))})}function zr(r,e){return e===void 0&&(e=0),G(function(t,n){n.add(r.schedule(function(){return t.subscribe(n)},e))})}function ad(r,e){return Z(r).pipe(zr(e),Wr(e))}function cd(r,e){return Z(r).pipe(zr(e),Wr(e))}function ud(r,e){return new fe(function(t){var n=0;return e.schedule(function(){n===r.length?t.complete():(t.next(r[n++]),t.closed||this.schedule())})})}function Ya(r,e){return new fe(function(t){var n;return Qe(t,e,function(){n=r[za](),Qe(t,e,function(){var i,s,o;try{i=n.next(),s=i.value,o=i.done}catch(a){t.error(a);return}o?t.complete():t.next(s)},0,!0)}),function(){return te(n==null?void 0:n.return)&&n.return()}})}function Ga(r,e){if(!r)throw new Error("Iterable cannot be null");return new fe(function(t){Qe(t,e,function(){var n=r[Symbol.asyncIterator]();Qe(t,e,function(){n.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function ld(r,e){return Ga(Ha(r),e)}function Qa(r,e){if(r!=null){if(Ma(r))return ad(r,e);if(ps(r))return ud(r,e);if(Fa(r))return cd(r,e);if(Ka(r))return Ga(r,e);if(Va(r))return Ya(r,e);if(Ja(r))return ld(r,e)}throw Wa(r)}function Tt(r,e){return e?Qa(r,e):Z(r)}function ys(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=St(r);return Tt(r,t)}function Xa(r,e){var t=te(r)?r:function(){return r},n=function(i){return i.error(t())};return new fe(e?function(i){return e.schedule(n,0,i)}:n)}var ji;(function(r){r.NEXT="N",r.ERROR="E",r.COMPLETE="C"})(ji||(ji={}));var pr=function(){function r(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue=e==="N"}return r.prototype.observe=function(e){return Za(this,e)},r.prototype.do=function(e,t,n){var i=this,s=i.kind,o=i.value,a=i.error;return s==="N"?e==null?void 0:e(o):s==="E"?t==null?void 0:t(a):n==null?void 0:n()},r.prototype.accept=function(e,t,n){var i;return te((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,n)},r.prototype.toObservable=function(){var e=this,t=e.kind,n=e.value,i=e.error,s=t==="N"?ys(n):t==="E"?Xa(function(){return i}):t==="C"?wt:0;if(!s)throw new TypeError("Unexpected notification kind "+t);return s},r.createNext=function(e){return new r("N",e)},r.createError=function(e){return new r("E",void 0,e)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r}();function Za(r,e){var t,n,i,s=r,o=s.kind,a=s.value,c=s.error;if(typeof o!="string")throw new TypeError('Invalid notification, missing "kind"');o==="N"?(t=e.next)===null||t===void 0||t.call(e,a):o==="E"?(n=e.error)===null||n===void 0||n.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function fd(r){return!!r&&(r instanceof fe||te(r.lift)&&te(r.subscribe))}var an=on(function(r){return function(){r(this),this.name="EmptyError",this.message="no elements in sequence"}});function hd(r,e){var t=typeof e=="object";return new Promise(function(n,i){var s=!1,o;r.subscribe({next:function(a){o=a,s=!0},error:i,complete:function(){s?n(o):t?n(e.defaultValue):i(new an)}})})}function dd(r,e){var t=typeof e=="object";return new Promise(function(n,i){var s=new En({next:function(o){n(o),s.unsubscribe()},error:i,complete:function(){t?n(e.defaultValue):i(new an)}});r.subscribe(s)})}var Ci=on(function(r){return function(){r(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),ec=on(function(r){return function(t){r(this),this.name="NotFoundError",this.message=t}}),tc=on(function(r){return function(t){r(this),this.name="SequenceError",this.message=t}});function ms(r){return r instanceof Date&&!isNaN(r)}var nc=on(function(r){return function(t){t===void 0&&(t=null),r(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function rc(r,e){var t=ms(r)?{first:r}:typeof r=="number"?{each:r}:r,n=t.first,i=t.each,s=t.with,o=s===void 0?pd:s,a=t.scheduler,c=a===void 0?e!=null?e:ot:a,u=t.meta,y=u===void 0?null:u;if(n==null&&i==null)throw new TypeError("No timeout provided.");return G(function(g,k){var E,A,S=null,I=0,R=function(D){A=Qe(k,c,function(){try{E.unsubscribe(),Z(o({meta:y,lastValue:S,seen:I})).subscribe(k)}catch(B){k.error(B)}},D)};E=g.subscribe(J(k,function(D){A==null||A.unsubscribe(),I++,k.next(S=D),i>0&&R(i)},void 0,void 0,function(){A!=null&&A.closed||A==null||A.unsubscribe(),S=null})),!I&&R(n!=null?typeof n=="number"?n:+n-c.now():i)})}function pd(r){throw new nc(r)}function cn(r,e){return G(function(t,n){var i=0;t.subscribe(J(n,function(s){n.next(r.call(e,s,i++))}))})}var yd=Array.isArray;function md(r,e){return yd(e)?r.apply(void 0,me([],ye(e))):r(e)}function un(r){return cn(function(e){return md(r,e)})}function kr(r,e,t,n){if(t)if(Kr(t))n=t;else return function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return kr(r,e,n).apply(this,i).pipe(un(t))};return n?function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return kr(r,e).apply(this,i).pipe(zr(n),Wr(n))}:function(){for(var i=this,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=new fs,c=!0;return new fe(function(u){var y=a.subscribe(u);if(c){c=!1;var g=!1,k=!1;e.apply(i,me(me([],ye(s)),[function(){for(var E=[],A=0;A<arguments.length;A++)E[A]=arguments[A];if(r){var S=E.shift();if(S!=null){a.error(S);return}}a.next(1<E.length?E:E[0]),k=!0,g&&a.complete()}])),k&&a.complete(),g=!0}return y})}}function gd(r,e,t){return kr(!1,r,e,t)}function vd(r,e,t){return kr(!0,r,e,t)}var wd=Array.isArray,bd=Object.getPrototypeOf,xd=Object.prototype,Ad=Object.keys;function ic(r){if(r.length===1){var e=r[0];if(wd(e))return{args:e,keys:null};if(Ed(e)){var t=Ad(e);return{args:t.map(function(n){return e[n]}),keys:t}}}return{args:r,keys:null}}function Ed(r){return r&&typeof r=="object"&&bd(r)===xd}function sc(r,e){return r.reduce(function(t,n,i){return t[n]=e[i],t},{})}function oc(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=St(r),n=Jn(r),i=ic(r),s=i.args,o=i.keys;if(s.length===0)return Tt([],t);var a=new fe(ac(s,t,o?function(c){return sc(o,c)}:$e));return n?a.pipe(un(n)):a}function ac(r,e,t){return t===void 0&&(t=$e),function(n){mo(e,function(){for(var i=r.length,s=new Array(i),o=i,a=i,c=function(y){mo(e,function(){var g=Tt(r[y],e),k=!1;g.subscribe(J(n,function(E){s[y]=E,k||(k=!0,a--),a||n.next(t(s.slice()))},function(){--o||n.complete()}))},n)},u=0;u<i;u++)c(u)},n)}}function mo(r,e,t){r?Qe(t,r,e):e()}function gs(r,e,t,n,i,s,o,a){var c=[],u=0,y=0,g=!1,k=function(){g&&!c.length&&!u&&e.complete()},E=function(S){return u<n?A(S):c.push(S)},A=function(S){s&&e.next(S),u++;var I=!1;Z(t(S,y++)).subscribe(J(e,function(R){i==null||i(R),s?E(R):e.next(R)},function(){I=!0},void 0,function(){if(I)try{u--;for(var R=function(){var D=c.shift();o?Qe(e,o,function(){return A(D)}):A(D)};c.length&&u<n;)R();k()}catch(D){e.error(D)}}))};return r.subscribe(J(e,E,function(){g=!0,k()})),function(){a==null||a()}}function pt(r,e,t){return t===void 0&&(t=1/0),te(e)?pt(function(n,i){return cn(function(s,o){return e(n,s,i,o)})(Z(r(n,i)))},t):(typeof e=="number"&&(t=e),G(function(n,i){return gs(n,i,r,t)}))}function Vr(r){return r===void 0&&(r=1/0),pt($e,r)}function vs(){return Vr(1)}function Ln(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return vs()(Tt(r,St(r)))}function Hr(r){return new fe(function(e){Z(r()).subscribe(e)})}var kd={connector:function(){return new Ie},resetOnDisconnect:!0};function Sd(r,e){e===void 0&&(e=kd);var t=null,n=e.connector,i=e.resetOnDisconnect,s=i===void 0?!0:i,o=n(),a=new fe(function(c){return o.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=Hr(function(){return r}).subscribe(o),s&&t.add(function(){return o=n()})),t},a}function Td(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Jn(r),n=ic(r),i=n.args,s=n.keys,o=new fe(function(a){var c=i.length;if(!c){a.complete();return}for(var u=new Array(c),y=c,g=c,k=function(A){var S=!1;Z(i[A]).subscribe(J(a,function(I){S||(S=!0,g--),u[A]=I},function(){return y--},void 0,function(){(!y||!S)&&(g||a.next(s?sc(s,u):u),a.complete())}))},E=0;E<c;E++)k(E)});return t?o.pipe(un(t)):o}var Od=["addListener","removeListener"],_d=["addEventListener","removeEventListener"],Id=["on","off"];function Bi(r,e,t,n){if(te(t)&&(n=t,t=void 0),n)return Bi(r,e,t).pipe(un(n));var i=ye(Rd(r)?_d.map(function(a){return function(c){return r[a](e,c,t)}}):Pd(r)?Od.map(go(r,e)):Nd(r)?Id.map(go(r,e)):[],2),s=i[0],o=i[1];if(!s&&ps(r))return pt(function(a){return Bi(a,e,t)})(Z(r));if(!s)throw new TypeError("Invalid event target");return new fe(function(a){var c=function(){for(var u=[],y=0;y<arguments.length;y++)u[y]=arguments[y];return a.next(1<u.length?u:u[0])};return s(c),function(){return o(c)}})}function go(r,e){return function(t){return function(n){return r[t](e,n)}}}function Pd(r){return te(r.addListener)&&te(r.removeListener)}function Nd(r){return te(r.on)&&te(r.off)}function Rd(r){return te(r.addEventListener)&&te(r.removeEventListener)}function cc(r,e,t){return t?cc(r,e).pipe(un(t)):new fe(function(n){var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return n.next(o.length===1?o[0]:o)},s=r(i);return te(e)?function(){return e(i,s)}:void 0})}function $d(r,e,t,n,i){var s,o,a,c;arguments.length===1?(s=r,c=s.initialState,e=s.condition,t=s.iterate,o=s.resultSelector,a=o===void 0?$e:o,i=s.scheduler):(c=r,!n||Kr(n)?(a=$e,i=n):a=n);function u(){var y;return os(this,function(g){switch(g.label){case 0:y=c,g.label=1;case 1:return!e||e(y)?[4,a(y)]:[3,4];case 2:g.sent(),g.label=3;case 3:return y=t(y),[3,1];case 4:return[2]}})}return Hr(i?function(){return Ya(u(),i)}:u)}function jd(r,e,t){return Hr(function(){return r()?e:t})}function ln(r,e,t){r===void 0&&(r=0),t===void 0&&(t=hs);var n=-1;return e!=null&&(Kr(e)?t=e:n=e),new fe(function(i){var s=ms(r)?+r-t.now():r;s<0&&(s=0);var o=0;return t.schedule(function(){i.closed||(i.next(o++),0<=n?this.schedule(void 0,n):i.complete())},s)})}function uc(r,e){return r===void 0&&(r=0),e===void 0&&(e=ot),r<0&&(r=0),ln(r,r,e)}function Cd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=St(r),n=Ua(r,1/0),i=r;return i.length?i.length===1?Z(i[0]):Vr(n)(Tt(i,t)):wt}var lc=new fe(Te);function Bd(){return lc}var Ld=Array.isArray;function Tn(r){return r.length===1&&Ld(r[0])?r[0]:r}function fc(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Tn(r);return new fe(function(n){var i=0,s=function(){if(i<t.length){var o=void 0;try{o=Z(t[i++])}catch(c){s();return}var a=new us(n,void 0,Te,Te);o.subscribe(a),a.add(s)}else n.complete()};s()})}function Dd(r,e){return Tt(Object.entries(r),e)}function Ud(r,e){return function(t,n){return!r.call(e,t,n)}}function rn(r,e){return G(function(t,n){var i=0;t.subscribe(J(n,function(s){return r.call(e,s,i++)&&n.next(s)}))})}function Fd(r,e,t){return[rn(e,t)(Z(r)),rn(Ud(e,t))(Z(r))]}function Md(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r=Tn(r),r.length===1?Z(r[0]):new fe(hc(r))}function hc(r){return function(e){for(var t=[],n=function(s){t.push(Z(r[s]).subscribe(J(e,function(o){if(t){for(var a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(o)})))},i=0;t&&!e.closed&&i<r.length;i++)n(i)}}function Kd(r,e,t){if(e==null&&(e=r,r=0),e<=0)return wt;var n=e+r;return new fe(t?function(i){var s=r;return t.schedule(function(){s<n?(i.next(s++),this.schedule()):i.complete()})}:function(i){for(var s=r;s<n&&!i.closed;)i.next(s++);i.complete()})}function Wd(r,e){return new fe(function(t){var n=r(),i=e(n),s=i?Z(i):wt;return s.subscribe(t),function(){n&&n.unsubscribe()}})}function ws(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Jn(r),n=Tn(r);return n.length?new fe(function(i){var s=n.map(function(){return[]}),o=n.map(function(){return!1});i.add(function(){s=o=null});for(var a=function(u){Z(n[u]).subscribe(J(i,function(y){if(s[u].push(y),s.every(function(k){return k.length})){var g=s.map(function(k){return k.shift()});i.next(t?t.apply(void 0,me([],ye(g))):g),s.some(function(k,E){return!k.length&&o[E]})&&i.complete()}},function(){o[u]=!0,!s[u].length&&i.complete()}))},c=0;!i.closed&&c<n.length;c++)a(c);return function(){s=o=null}}):wt}function dc(r){return G(function(e,t){var n=!1,i=null,s=null,o=!1,a=function(){if(s==null||s.unsubscribe(),s=null,n){n=!1;var u=i;i=null,t.next(u)}o&&t.complete()},c=function(){s=null,o&&t.complete()};e.subscribe(J(t,function(u){n=!0,i=u,s||Z(r(u)).subscribe(s=J(t,a,c))},function(){o=!0,(!n||!s||s.closed)&&t.complete()}))})}function zd(r,e){return e===void 0&&(e=ot),dc(function(){return ln(r,e)})}function Vd(r){return G(function(e,t){var n=[];return e.subscribe(J(t,function(i){return n.push(i)},function(){t.next(n),t.complete()})),Z(r).subscribe(J(t,function(){var i=n;n=[],t.next(i)},Te)),function(){n=null}})}function Hd(r,e){return e===void 0&&(e=null),e=e!=null?e:r,G(function(t,n){var i=[],s=0;t.subscribe(J(n,function(o){var a,c,u,y,g=null;s++%e===0&&i.push([]);try{for(var k=Ge(i),E=k.next();!E.done;E=k.next()){var A=E.value;A.push(o),r<=A.length&&(g=g!=null?g:[],g.push(A))}}catch(R){a={error:R}}finally{try{E&&!E.done&&(c=k.return)&&c.call(k)}finally{if(a)throw a.error}}if(g)try{for(var S=Ge(g),I=S.next();!I.done;I=S.next()){var A=I.value;kt(i,A),n.next(A)}}catch(R){u={error:R}}finally{try{I&&!I.done&&(y=S.return)&&y.call(S)}finally{if(u)throw u.error}}},function(){var o,a;try{for(var c=Ge(i),u=c.next();!u.done;u=c.next()){var y=u.value;n.next(y)}}catch(g){o={error:g}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}n.complete()},void 0,function(){i=null}))})}function Jd(r){for(var e,t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=(e=St(n))!==null&&e!==void 0?e:ot,o=(t=n[0])!==null&&t!==void 0?t:null,a=n[1]||1/0;return G(function(c,u){var y=[],g=!1,k=function(S){var I=S.buffer,R=S.subs;R.unsubscribe(),kt(y,S),u.next(I),g&&E()},E=function(){if(y){var S=new Xe;u.add(S);var I=[],R={buffer:I,subs:S};y.push(R),Qe(S,s,function(){return k(R)},r)}};o!==null&&o>=0?Qe(u,s,E,o,!0):g=!0,E();var A=J(u,function(S){var I,R,D=y.slice();try{for(var B=Ge(D),M=B.next();!M.done;M=B.next()){var V=M.value,W=V.buffer;W.push(S),a<=W.length&&k(V)}}catch(X){I={error:X}}finally{try{M&&!M.done&&(R=B.return)&&R.call(B)}finally{if(I)throw I.error}}},function(){for(;y!=null&&y.length;)u.next(y.shift().buffer);A==null||A.unsubscribe(),u.complete(),u.unsubscribe()},void 0,function(){return y=null});c.subscribe(A)})}function qd(r,e){return G(function(t,n){var i=[];Z(r).subscribe(J(n,function(s){var o=[];i.push(o);var a=new Xe,c=function(){kt(i,o),n.next(o),a.unsubscribe()};a.add(Z(e(s)).subscribe(J(n,c,Te)))},Te)),t.subscribe(J(n,function(s){var o,a;try{for(var c=Ge(i),u=c.next();!u.done;u=c.next()){var y=u.value;y.push(s)}}catch(g){o={error:g}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}},function(){for(;i.length>0;)n.next(i.shift());n.complete()}))})}function Yd(r){return G(function(e,t){var n=null,i=null,s=function(){i==null||i.unsubscribe();var o=n;n=[],o&&t.next(o),Z(r()).subscribe(i=J(t,s,Te))};s(),e.subscribe(J(t,function(o){return n==null?void 0:n.push(o)},function(){n&&t.next(n),t.complete()},void 0,function(){return n=i=null}))})}function pc(r){return G(function(e,t){var n=null,i=!1,s;n=e.subscribe(J(t,void 0,void 0,function(o){s=Z(r(o,pc(r)(e))),n?(n.unsubscribe(),n=null,s.subscribe(t)):i=!0})),i&&(n.unsubscribe(),n=null,s.subscribe(t))})}function yc(r,e,t,n,i){return function(s,o){var a=t,c=e,u=0;s.subscribe(J(o,function(y){var g=u++;c=a?r(c,y,g):(a=!0,y),n&&o.next(c)},i&&function(){a&&o.next(c),o.complete()}))}}function qn(r,e){return G(yc(r,e,arguments.length>=2,!1,!0))}var Gd=function(r,e){return r.push(e),r};function mc(){return G(function(r,e){qn(Gd,[])(r).subscribe(e)})}function gc(r,e){return cs(mc(),pt(function(t){return r(t)}),e?un(e):$e)}function vc(r){return gc(oc,r)}var Qd=vc;function wc(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Jn(r);return t?cs(wc.apply(void 0,me([],ye(r))),un(t)):G(function(n,i){ac(me([n],ye(Tn(r))))(i)})}function Xd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return wc.apply(void 0,me([],ye(r)))}function Li(r,e){return te(e)?pt(r,e,1):pt(r,1)}function Zd(r,e){return te(e)?Li(function(){return r},e):Li(function(){return r})}function ep(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=St(r);return G(function(n,i){vs()(Tt(me([n],ye(r)),t)).subscribe(i)})}function tp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return ep.apply(void 0,me([],ye(r)))}function np(r){return new fe(function(e){return r.subscribe(e)})}var rp={connector:function(){return new Ie}};function bs(r,e){e===void 0&&(e=rp);var t=e.connector;return G(function(n,i){var s=t();Z(r(np(s))).subscribe(i),i.add(n.subscribe(s))})}function ip(r){return qn(function(e,t,n){return!r||r(t,n)?e+1:e},0)}function sp(r){return G(function(e,t){var n=!1,i=null,s=null,o=function(){if(s==null||s.unsubscribe(),s=null,n){n=!1;var a=i;i=null,t.next(a)}};e.subscribe(J(t,function(a){s==null||s.unsubscribe(),n=!0,i=a,s=J(t,o,Te),Z(r(a)).subscribe(s)},function(){o(),t.complete()},void 0,function(){i=s=null}))})}function op(r,e){return e===void 0&&(e=ot),G(function(t,n){var i=null,s=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var u=s;s=null,n.next(u)}};function c(){var u=o+r,y=e.now();if(y<u){i=this.schedule(void 0,u-y),n.add(i);return}a()}t.subscribe(J(n,function(u){s=u,o=e.now(),i||(i=e.schedule(c,r),n.add(i))},function(){a(),n.complete()},void 0,function(){s=i=null}))})}function Jr(r){return G(function(e,t){var n=!1;e.subscribe(J(t,function(i){n=!0,t.next(i)},function(){n||t.next(r),t.complete()}))})}function Dn(r){return r<=0?function(){return wt}:G(function(e,t){var n=0;e.subscribe(J(t,function(i){++n<=r&&(t.next(i),r<=n&&t.complete())}))})}function bc(){return G(function(r,e){r.subscribe(J(e,Te))})}function xc(r){return cn(function(){return r})}function xs(r,e){return e?function(t){return Ln(e.pipe(Dn(1),bc()),t.pipe(xs(r)))}:pt(function(t,n){return Z(r(t,n)).pipe(Dn(1),xc(t))})}function ap(r,e){e===void 0&&(e=ot);var t=ln(r,e);return xs(function(){return t})}function cp(){return G(function(r,e){r.subscribe(J(e,function(t){return Za(t,e)}))})}function up(r,e){return G(function(t,n){var i=new Set;t.subscribe(J(n,function(s){var o=r?r(s):s;i.has(o)||(i.add(o),n.next(s))})),e&&Z(e).subscribe(J(n,function(){return i.clear()},Te))})}function Ac(r,e){return e===void 0&&(e=$e),r=r!=null?r:lp,G(function(t,n){var i,s=!0;t.subscribe(J(n,function(o){var a=e(o);(s||!r(i,a))&&(s=!1,i=a,n.next(o))}))})}function lp(r,e){return r===e}function fp(r,e){return Ac(function(t,n){return e?e(t[r],n[r]):t[r]===n[r]})}function qr(r){return r===void 0&&(r=hp),G(function(e,t){var n=!1;e.subscribe(J(t,function(i){n=!0,t.next(i)},function(){return n?t.complete():t.error(r())}))})}function hp(){return new an}function dp(r,e){if(r<0)throw new Ci;var t=arguments.length>=2;return function(n){return n.pipe(rn(function(i,s){return s===r}),Dn(1),t?Jr(e):qr(function(){return new Ci}))}}function pp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return function(t){return Ln(t,ys.apply(void 0,me([],ye(r))))}}function yp(r,e){return G(function(t,n){var i=0;t.subscribe(J(n,function(s){r.call(e,s,i++,t)||(n.next(!1),n.complete())},function(){n.next(!0),n.complete()}))})}function As(r,e){return e?function(t){return t.pipe(As(function(n,i){return Z(r(n,i)).pipe(cn(function(s,o){return e(n,s,i,o)}))}))}:G(function(t,n){var i=0,s=null,o=!1;t.subscribe(J(n,function(a){s||(s=J(n,void 0,function(){s=null,o&&n.complete()}),Z(r(a,i++)).subscribe(s))},function(){o=!0,!s&&n.complete()}))})}function Ec(){return As($e)}var mp=Ec;function gp(r,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,G(function(n,i){return gs(n,i,r,e,void 0,!0,t)})}function vp(r){return G(function(e,t){try{e.subscribe(t)}finally{t.add(r)}})}function wp(r,e){return G(kc(r,e,"value"))}function kc(r,e,t){var n=t==="index";return function(i,s){var o=0;i.subscribe(J(s,function(a){var c=o++;r.call(e,a,c,i)&&(s.next(n?c:a),s.complete())},function(){s.next(n?-1:void 0),s.complete()}))}}function bp(r,e){return G(kc(r,e,"index"))}function xp(r,e){var t=arguments.length>=2;return function(n){return n.pipe(r?rn(function(i,s){return r(i,s,n)}):$e,Dn(1),t?Jr(e):qr(function(){return new an}))}}function Ap(r,e,t,n){return G(function(i,s){var o;!e||typeof e=="function"?o=e:(t=e.duration,o=e.element,n=e.connector);var a=new Map,c=function(A){a.forEach(A),A(s)},u=function(A){return c(function(S){return S.error(A)})},y=0,g=!1,k=new us(s,function(A){try{var S=r(A),I=a.get(S);if(!I){a.set(S,I=n?n():new Ie);var R=E(S,I);if(s.next(R),t){var D=J(I,function(){I.complete(),D==null||D.unsubscribe()},void 0,void 0,function(){return a.delete(S)});k.add(Z(t(R)).subscribe(D))}}I.next(o?o(A):A)}catch(B){u(B)}},function(){return c(function(A){return A.complete()})},u,function(){return a.clear()},function(){return g=!0,y===0});i.subscribe(k);function E(A,S){var I=new fe(function(R){y++;var D=S.subscribe(R);return function(){D.unsubscribe(),--y===0&&g&&k.unsubscribe()}});return I.key=A,I}})}function Ep(){return G(function(r,e){r.subscribe(J(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function Sc(r){return r<=0?function(){return wt}:G(function(e,t){var n=[];e.subscribe(J(t,function(i){n.push(i),r<n.length&&n.shift()},function(){var i,s;try{for(var o=Ge(n),a=o.next();!a.done;a=o.next()){var c=a.value;t.next(c)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}t.complete()},void 0,function(){n=null}))})}function kp(r,e){var t=arguments.length>=2;return function(n){return n.pipe(r?rn(function(i,s){return r(i,s,n)}):$e,Sc(1),t?Jr(e):qr(function(){return new an}))}}function Sp(){return G(function(r,e){r.subscribe(J(e,function(t){e.next(pr.createNext(t))},function(){e.next(pr.createComplete()),e.complete()},function(t){e.next(pr.createError(t)),e.complete()}))})}function Tp(r){return qn(te(r)?function(e,t){return r(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var Op=pt;function _p(r,e,t){return t===void 0&&(t=1/0),te(e)?pt(function(){return r},e,t):(typeof e=="number"&&(t=e),pt(function(){return r},t))}function Ip(r,e,t){return t===void 0&&(t=1/0),G(function(n,i){var s=e;return gs(n,i,function(o,a){return r(s,o,a)},t,function(o){s=o},!1,void 0,function(){return s=null})})}function Pp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=St(r),n=Ua(r,1/0);return r=Tn(r),G(function(i,s){Vr(n)(Tt(me([i],ye(r)),t)).subscribe(s)})}function Np(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Pp.apply(void 0,me([],ye(r)))}function Rp(r){return qn(te(r)?function(e,t){return r(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function Es(r,e){var t=te(r)?r:function(){return r};return te(e)?bs(e,{connector:t}):function(n){return new Fr(n,t)}}function $p(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Tn(r);return function(n){return fc.apply(void 0,me([n],ye(t)))}}function jp(){return G(function(r,e){var t,n=!1;r.subscribe(J(e,function(i){var s=t;t=i,n&&e.next([s,i]),n=!0}))})}function Cp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=r.length;if(t===0)throw new Error("list of properties cannot be empty.");return cn(function(n){for(var i=n,s=0;s<t;s++){var o=i==null?void 0:i[r[s]];if(typeof o!="undefined")i=o;else return}return i})}function Bp(r){return r?function(e){return bs(r)(e)}:function(e){return Es(new Ie)(e)}}function Lp(r){return function(e){var t=new $a(r);return new Fr(e,function(){return t})}}function Dp(){return function(r){var e=new fs;return new Fr(r,function(){return e})}}function Up(r,e,t,n){t&&!te(t)&&(n=t);var i=te(t)?t:void 0;return function(s){return Es(new ls(r,e,n),i)(s)}}function Fp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r.length?G(function(t,n){hc(me([t],ye(r)))(n)}):$e}function Mp(r){var e,t=1/0,n;return r!=null&&(typeof r=="object"?(e=r.count,t=e===void 0?1/0:e,n=r.delay):t=r),t<=0?function(){return wt}:G(function(i,s){var o=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,n!=null){var y=typeof n=="number"?ln(n):Z(n(o)),g=J(s,function(){g.unsubscribe(),u()});y.subscribe(g)}else u()},u=function(){var y=!1;a=i.subscribe(J(s,void 0,function(){++o<t?a?c():y=!0:s.complete()})),y&&c()};u()})}function Kp(r){return G(function(e,t){var n,i=!1,s,o=!1,a=!1,c=function(){return a&&o&&(t.complete(),!0)},u=function(){return s||(s=new Ie,Z(r(s)).subscribe(J(t,function(){n?y():i=!0},function(){o=!0,c()}))),s},y=function(){a=!1,n=e.subscribe(J(t,void 0,function(){a=!0,!c()&&u().next()})),i&&(n.unsubscribe(),n=null,i=!1,y())};y()})}function Wp(r){r===void 0&&(r=1/0);var e;r&&typeof r=="object"?e=r:e={count:r};var t=e.count,n=t===void 0?1/0:t,i=e.delay,s=e.resetOnSuccess,o=s===void 0?!1:s;return n<=0?$e:G(function(a,c){var u=0,y,g=function(){var k=!1;y=a.subscribe(J(c,function(E){o&&(u=0),c.next(E)},void 0,function(E){if(u++<n){var A=function(){y?(y.unsubscribe(),y=null,g()):k=!0};if(i!=null){var S=typeof i=="number"?ln(i):Z(i(E,u)),I=J(c,function(){I.unsubscribe(),A()},function(){c.complete()});S.subscribe(I)}else A()}else c.error(E)})),k&&(y.unsubscribe(),y=null,g())};g()})}function zp(r){return G(function(e,t){var n,i=!1,s,o=function(){n=e.subscribe(J(t,void 0,void 0,function(a){s||(s=new Ie,Z(r(s)).subscribe(J(t,function(){return n?o():i=!0}))),s&&s.next(a)})),i&&(n.unsubscribe(),n=null,i=!1,o())};o()})}function Tc(r){return G(function(e,t){var n=!1,i=null;e.subscribe(J(t,function(s){n=!0,i=s})),Z(r).subscribe(J(t,function(){if(n){n=!1;var s=i;i=null,t.next(s)}},Te))})}function Vp(r,e){return e===void 0&&(e=ot),Tc(uc(r,e))}function Hp(r,e){return G(yc(r,e,arguments.length>=2,!0))}function Jp(r,e){return e===void 0&&(e=function(t,n){return t===n}),G(function(t,n){var i=vo(),s=vo(),o=function(c){n.next(c),n.complete()},a=function(c,u){var y=J(n,function(g){var k=u.buffer,E=u.complete;k.length===0?E?o(!1):c.buffer.push(g):!e(g,k.shift())&&o(!1)},function(){c.complete=!0;var g=u.complete,k=u.buffer;g&&o(k.length===0),y==null||y.unsubscribe()});return y};t.subscribe(a(i,s)),Z(r).subscribe(a(s,i))})}function vo(){return{buffer:[],complete:!1}}function Oc(r){r===void 0&&(r={});var e=r.connector,t=e===void 0?function(){return new Ie}:e,n=r.resetOnError,i=n===void 0?!0:n,s=r.resetOnComplete,o=s===void 0?!0:s,a=r.resetOnRefCountZero,c=a===void 0?!0:a;return function(u){var y,g,k,E=0,A=!1,S=!1,I=function(){g==null||g.unsubscribe(),g=void 0},R=function(){I(),y=k=void 0,A=S=!1},D=function(){var B=y;R(),B==null||B.unsubscribe()};return G(function(B,M){E++,!S&&!A&&I();var V=k=k!=null?k:t();M.add(function(){E--,E===0&&!S&&!A&&(g=yi(D,c))}),V.subscribe(M),!y&&E>0&&(y=new En({next:function(W){return V.next(W)},error:function(W){S=!0,I(),g=yi(R,i,W),V.error(W)},complete:function(){A=!0,I(),g=yi(R,o),V.complete()}}),Z(B).subscribe(y))})(u)}}function yi(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];if(e===!0){r();return}if(e!==!1){var i=new En({next:function(){i.unsubscribe(),r()}});return Z(e.apply(void 0,me([],ye(t)))).subscribe(i)}}function qp(r,e,t){var n,i,s,o,a=!1;return r&&typeof r=="object"?(n=r.bufferSize,o=n===void 0?1/0:n,i=r.windowTime,e=i===void 0?1/0:i,s=r.refCount,a=s===void 0?!1:s,t=r.scheduler):o=r!=null?r:1/0,Oc({connector:function(){return new ls(o,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function Yp(r){return G(function(e,t){var n=!1,i,s=!1,o=0;e.subscribe(J(t,function(a){s=!0,(!r||r(a,o++,e))&&(n&&t.error(new tc("Too many matching values")),n=!0,i=a)},function(){n?(t.next(i),t.complete()):t.error(s?new ec("No matching values"):new an)}))})}function Gp(r){return rn(function(e,t){return r<=t})}function Qp(r){return r<=0?$e:G(function(e,t){var n=new Array(r),i=0;return e.subscribe(J(t,function(s){var o=i++;if(o<r)n[o]=s;else{var a=o%r,c=n[a];n[a]=s,t.next(c)}})),function(){n=null}})}function Xp(r){return G(function(e,t){var n=!1,i=J(t,function(){i==null||i.unsubscribe(),n=!0},Te);Z(r).subscribe(i),e.subscribe(J(t,function(s){return n&&t.next(s)}))})}function Zp(r){return G(function(e,t){var n=!1,i=0;e.subscribe(J(t,function(s){return(n||(n=!r(s,i++)))&&t.next(s)}))})}function ey(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=St(r);return G(function(n,i){(t?Ln(r,n,t):Ln(r,n)).subscribe(i)})}function Un(r,e){return G(function(t,n){var i=null,s=0,o=!1,a=function(){return o&&!i&&n.complete()};t.subscribe(J(n,function(c){i==null||i.unsubscribe();var u=0,y=s++;Z(r(c,y)).subscribe(i=J(n,function(g){return n.next(e?e(c,g,y,u++):g)},function(){i=null,a()}))},function(){o=!0,a()}))})}function ty(){return Un($e)}function ny(r,e){return te(e)?Un(function(){return r},e):Un(function(){return r})}function ry(r,e){return G(function(t,n){var i=e;return Un(function(s,o){return r(i,s,o)},function(s,o){return i=o,o})(t).subscribe(n),function(){i=null}})}function iy(r){return G(function(e,t){Z(r).subscribe(J(t,function(){return t.complete()},Te)),!t.closed&&e.subscribe(t)})}function sy(r,e){return e===void 0&&(e=!1),G(function(t,n){var i=0;t.subscribe(J(n,function(s){var o=r(s,i++);(o||e)&&n.next(s),!o&&n.complete()}))})}function oy(r,e,t){var n=te(r)||e||t?{next:r,error:e,complete:t}:r;return n?G(function(i,s){var o;(o=n.subscribe)===null||o===void 0||o.call(n);var a=!0;i.subscribe(J(s,function(c){var u;(u=n.next)===null||u===void 0||u.call(n,c),s.next(c)},function(){var c;a=!1,(c=n.complete)===null||c===void 0||c.call(n),s.complete()},function(c){var u;a=!1,(u=n.error)===null||u===void 0||u.call(n,c),s.error(c)},function(){var c,u;a&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(u=n.finalize)===null||u===void 0||u.call(n)}))}):$e}function _c(r,e){return G(function(t,n){var i=e!=null?e:{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,c=a===void 0?!1:a,u=!1,y=null,g=null,k=!1,E=function(){g==null||g.unsubscribe(),g=null,c&&(I(),k&&n.complete())},A=function(){g=null,k&&n.complete()},S=function(R){return g=Z(r(R)).subscribe(J(n,E,A))},I=function(){if(u){u=!1;var R=y;y=null,n.next(R),!k&&S(R)}};t.subscribe(J(n,function(R){u=!0,y=R,!(g&&!g.closed)&&(o?I():S(R))},function(){k=!0,!(c&&u&&g&&!g.closed)&&n.complete()}))})}function ay(r,e,t){e===void 0&&(e=ot);var n=ln(r,e);return _c(function(){return n},t)}function cy(r){return r===void 0&&(r=ot),G(function(e,t){var n=r.now();e.subscribe(J(t,function(i){var s=r.now(),o=s-n;n=s,t.next(new uy(i,o))}))})}var uy=function(){function r(e,t){this.value=e,this.interval=t}return r}();function ly(r,e,t){var n,i,s;if(t=t!=null?t:hs,ms(r)?n=r:typeof r=="number"&&(i=r),e)s=function(){return e};else throw new TypeError("No observable provided to switch to");if(n==null&&i==null)throw new TypeError("No timeout provided.");return rc({first:n,each:i,scheduler:t,with:s})}function fy(r){return r===void 0&&(r=Mr),cn(function(e){return{value:e,timestamp:r.now()}})}function hy(r){return G(function(e,t){var n=new Ie;t.next(n.asObservable());var i=function(s){n.error(s),t.error(s)};return e.subscribe(J(t,function(s){return n==null?void 0:n.next(s)},function(){n.complete(),t.complete()},i)),Z(r).subscribe(J(t,function(){n.complete(),t.next(n=new Ie)},Te,i)),function(){n==null||n.unsubscribe(),n=null}})}function dy(r,e){e===void 0&&(e=0);var t=e>0?e:r;return G(function(n,i){var s=[new Ie],o=[],a=0;i.next(s[0].asObservable()),n.subscribe(J(i,function(c){var u,y;try{for(var g=Ge(s),k=g.next();!k.done;k=g.next()){var E=k.value;E.next(c)}}catch(I){u={error:I}}finally{try{k&&!k.done&&(y=g.return)&&y.call(g)}finally{if(u)throw u.error}}var A=a-r+1;if(A>=0&&A%t===0&&s.shift().complete(),++a%t===0){var S=new Ie;s.push(S),i.next(S.asObservable())}},function(){for(;s.length>0;)s.shift().complete();i.complete()},function(c){for(;s.length>0;)s.shift().error(c);i.error(c)},function(){o=null,s=null}))})}function py(r){for(var e,t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=(e=St(n))!==null&&e!==void 0?e:ot,o=(t=n[0])!==null&&t!==void 0?t:null,a=n[1]||1/0;return G(function(c,u){var y=[],g=!1,k=function(I){var R=I.window,D=I.subs;R.complete(),D.unsubscribe(),kt(y,I),g&&E()},E=function(){if(y){var I=new Xe;u.add(I);var R=new Ie,D={window:R,subs:I,seen:0};y.push(D),u.next(R.asObservable()),Qe(I,s,function(){return k(D)},r)}};o!==null&&o>=0?Qe(u,s,E,o,!0):g=!0,E();var A=function(I){return y.slice().forEach(I)},S=function(I){A(function(R){var D=R.window;return I(D)}),I(u),u.unsubscribe()};return c.subscribe(J(u,function(I){A(function(R){R.window.next(I),a<=++R.seen&&k(R)})},function(){return S(function(I){return I.complete()})},function(I){return S(function(R){return R.error(I)})})),function(){y=null}})}function yy(r,e){return G(function(t,n){var i=[],s=function(o){for(;0<i.length;)i.shift().error(o);n.error(o)};Z(r).subscribe(J(n,function(o){var a=new Ie;i.push(a);var c=new Xe,u=function(){kt(i,a),a.complete(),c.unsubscribe()},y;try{y=Z(e(o))}catch(g){s(g);return}n.next(a.asObservable()),c.add(y.subscribe(J(n,u,Te,s)))},Te)),t.subscribe(J(n,function(o){var a,c,u=i.slice();try{for(var y=Ge(u),g=y.next();!g.done;g=y.next()){var k=g.value;k.next(o)}}catch(E){a={error:E}}finally{try{g&&!g.done&&(c=y.return)&&c.call(y)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();n.complete()},s,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function my(r){return G(function(e,t){var n,i,s=function(a){n.error(a),t.error(a)},o=function(){i==null||i.unsubscribe(),n==null||n.complete(),n=new Ie,t.next(n.asObservable());var a;try{a=Z(r())}catch(c){s(c);return}a.subscribe(i=J(t,o,o,s))};o(),e.subscribe(J(t,function(a){return n.next(a)},function(){n.complete(),t.complete()},s,function(){i==null||i.unsubscribe(),n=null}))})}function gy(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Jn(r);return G(function(n,i){for(var s=r.length,o=new Array(s),a=r.map(function(){return!1}),c=!1,u=function(g){Z(r[g]).subscribe(J(i,function(k){o[g]=k,!c&&!a[g]&&(a[g]=!0,(c=a.every($e))&&(a=null))},Te))},y=0;y<s;y++)u(y);n.subscribe(J(i,function(g){if(c){var k=me([g],ye(o));i.next(t?t.apply(void 0,me([],ye(k))):k)}}))})}function vy(r){return gc(ws,r)}function wy(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return G(function(t,n){ws.apply(void 0,me([t],ye(r))).subscribe(n)})}function by(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return wy.apply(void 0,me([],ye(r)))}const xy=Object.freeze(Object.defineProperty({__proto__:null,Observable:fe,ConnectableObservable:Fr,observable:Ur,animationFrames:Bh,Subject:Ie,BehaviorSubject:$a,ReplaySubject:ls,AsyncSubject:fs,asap:zh,asapScheduler:Ca,async:hs,asyncScheduler:ot,queue:Jh,queueScheduler:Ba,animationFrame:Gh,animationFrameScheduler:La,VirtualTimeScheduler:Qh,VirtualAction:Da,Scheduler:$i,Subscription:Xe,Subscriber:Dr,Notification:pr,get NotificationKind(){return ji},pipe:cs,noop:Te,identity:$e,isObservable:fd,lastValueFrom:hd,firstValueFrom:dd,ArgumentOutOfRangeError:Ci,EmptyError:an,NotFoundError:ec,ObjectUnsubscribedError:Ra,SequenceError:tc,TimeoutError:nc,UnsubscriptionError:hr,bindCallback:gd,bindNodeCallback:vd,combineLatest:oc,concat:Ln,connectable:Sd,defer:Hr,empty:Xh,forkJoin:Td,from:Tt,fromEvent:Bi,fromEventPattern:cc,generate:$d,iif:jd,interval:uc,merge:Cd,never:Bd,of:ys,onErrorResumeNext:fc,pairs:Dd,partition:Fd,race:Md,range:Kd,throwError:Xa,timer:ln,using:Wd,zip:ws,scheduled:Qa,EMPTY:wt,NEVER:lc,config:Ht,audit:dc,auditTime:zd,buffer:Vd,bufferCount:Hd,bufferTime:Jd,bufferToggle:qd,bufferWhen:Yd,catchError:pc,combineAll:Qd,combineLatestAll:vc,combineLatestWith:Xd,concatAll:vs,concatMap:Li,concatMapTo:Zd,concatWith:tp,connect:bs,count:ip,debounce:sp,debounceTime:op,defaultIfEmpty:Jr,delay:ap,delayWhen:xs,dematerialize:cp,distinct:up,distinctUntilChanged:Ac,distinctUntilKeyChanged:fp,elementAt:dp,endWith:pp,every:yp,exhaust:mp,exhaustAll:Ec,exhaustMap:As,expand:gp,filter:rn,finalize:vp,find:wp,findIndex:bp,first:xp,groupBy:Ap,ignoreElements:bc,isEmpty:Ep,last:kp,map:cn,mapTo:xc,materialize:Sp,max:Tp,mergeAll:Vr,flatMap:Op,mergeMap:pt,mergeMapTo:_p,mergeScan:Ip,mergeWith:Np,min:Rp,multicast:Es,observeOn:Wr,onErrorResumeNextWith:$p,pairwise:jp,pluck:Cp,publish:Bp,publishBehavior:Lp,publishLast:Dp,publishReplay:Up,raceWith:Fp,reduce:qn,repeat:Mp,repeatWhen:Kp,retry:Wp,retryWhen:zp,refCount:Ia,sample:Tc,sampleTime:Vp,scan:Hp,sequenceEqual:Jp,share:Oc,shareReplay:qp,single:Yp,skip:Gp,skipLast:Qp,skipUntil:Xp,skipWhile:Zp,startWith:ey,subscribeOn:zr,switchAll:ty,switchMap:Un,switchMapTo:ny,switchScan:ry,take:Dn,takeLast:Sc,takeUntil:iy,takeWhile:sy,tap:oy,throttle:_c,throttleTime:ay,throwIfEmpty:qr,timeInterval:cy,timeout:rc,timeoutWith:ly,timestamp:fy,toArray:mc,window:hy,windowCount:dy,windowTime:py,windowToggle:yy,windowWhen:my,withLatestFrom:gy,zipAll:vy,zipWith:by},Symbol.toStringTag,{value:"Module"}));export{Ey as default};
//# sourceMappingURL=swyger-client.min.js.map
