var Ka=Object.defineProperty,Wa=Object.defineProperties;var za=Object.getOwnPropertyDescriptors;var Di=Object.getOwnPropertySymbols;var Va=Object.prototype.hasOwnProperty,Ha=Object.prototype.propertyIsEnumerable;var lr=(r,e,t)=>e in r?Ka(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$=(r,e)=>{for(var t in e||(e={}))Va.call(e,t)&&lr(r,t,e[t]);if(Di)for(var t of Di(e))Ha.call(e,t)&&lr(r,t,e[t]);return r},ee=(r,e)=>Wa(r,za(e));var Ui=(r,e,t)=>(lr(r,typeof e!="symbol"?e+"":e,t),t),Fi=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var J=(r,e,t)=>(Fi(r,e,"read from private field"),t?t.call(r):e.get(r)),Ne=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},ct=(r,e,t,n)=>(Fi(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var C=(r,e,t)=>new Promise((n,i)=>{var s=c=>{try{a(t.next(c))}catch(u){i(u)}},o=c=>{try{a(t.throw(c))}catch(u){i(u)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(s,o);a((t=t.apply(r,e)).next())});const it=Object.create(null);it.open="0";it.close="1";it.ping="2";it.pong="3";it.message="4";it.upgrade="5";it.noop="6";const En=Object.create(null);Object.keys(it).forEach(r=>{En[it[r]]=r});const Ja={type:"error",data:"parser error"},qa=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ya=typeof ArrayBuffer=="function",Ga=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Cs=({type:r,data:e},t,n)=>qa&&e instanceof Blob?t?n(e):Mi(e,n):Ya&&(e instanceof ArrayBuffer||Ga(e))?t?n(e):Mi(new Blob([e]),n):n(it[r]+(e||"")),Mi=(r,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)},Ki="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Qt=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let r=0;r<Ki.length;r++)Qt[Ki.charCodeAt(r)]=r;const Qa=r=>{let e=r.length*.75,t=r.length,n,i=0,s,o,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const u=new ArrayBuffer(e),l=new Uint8Array(u);for(n=0;n<t;n+=4)s=Qt[r.charCodeAt(n)],o=Qt[r.charCodeAt(n+1)],a=Qt[r.charCodeAt(n+2)],c=Qt[r.charCodeAt(n+3)],l[i++]=s<<2|o>>4,l[i++]=(o&15)<<4|a>>2,l[i++]=(a&3)<<6|c&63;return u},Xa=typeof ArrayBuffer=="function",Ns=(r,e)=>{if(typeof r!="string")return{type:"message",data:$s(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:Za(r.substring(1),e)}:En[t]?r.length>1?{type:En[t],data:r.substring(1)}:{type:En[t]}:Ja},Za=(r,e)=>{if(Xa){const t=Qa(r);return $s(t,e)}else return{base64:!0,data:r}},$s=(r,e)=>{switch(e){case"blob":return r instanceof ArrayBuffer?new Blob([r]):r;case"arraybuffer":default:return r}},js=String.fromCharCode(30),ec=(r,e)=>{const t=r.length,n=new Array(t);let i=0;r.forEach((s,o)=>{Cs(s,!1,a=>{n[o]=a,++i===t&&e(n.join(js))})})},tc=(r,e)=>{const t=r.split(js),n=[];for(let i=0;i<t.length;i++){const s=Ns(t[i],e);if(n.push(s),s.type==="error")break}return n},Bs=4;function ge(r){if(r)return nc(r)}function nc(r){for(var e in ge.prototype)r[e]=ge.prototype[e];return r}ge.prototype.on=ge.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};ge.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};ge.prototype.off=ge.prototype.removeListener=ge.prototype.removeAllListeners=ge.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+r],this};ge.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};ge.prototype.emitReserved=ge.prototype.emit;ge.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};ge.prototype.hasListeners=function(r){return!!this.listeners(r).length};const Je=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function Ls(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}const rc=Je.setTimeout,ic=Je.clearTimeout;function Vn(r,e){e.useNativeTimers?(r.setTimeoutFn=rc.bind(Je),r.clearTimeoutFn=ic.bind(Je)):(r.setTimeoutFn=Je.setTimeout.bind(Je),r.clearTimeoutFn=Je.clearTimeout.bind(Je))}const sc=1.33;function oc(r){return typeof r=="string"?ac(r):Math.ceil((r.byteLength||r.size)*sc)}function ac(r){let e=0,t=0;for(let n=0,i=r.length;n<i;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}class cc extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Ds extends ge{constructor(e){super(),this.writable=!1,Vn(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new cc(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Ns(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const Us="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Or=64,uc={};let Wi=0,pn=0,zi;function Vi(r){let e="";do e=Us[r%Or]+e,r=Math.floor(r/Or);while(r>0);return e}function Fs(){const r=Vi(+new Date);return r!==zi?(Wi=0,zi=r):r+"."+Vi(Wi++)}for(;pn<Or;pn++)uc[Us[pn]]=pn;function Ms(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function lc(r){let e={},t=r.split("&");for(let n=0,i=t.length;n<i;n++){let s=t[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}let Ks=!1;try{Ks=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(r){}const fc=Ks;function Ws(r){const e=r.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||fc))return new XMLHttpRequest}catch(t){}if(!e)try{return new Je[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function hc(){}const dc=function(){return new Ws({xdomain:!1}).responseType!=null}();class pc extends Ds{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const n=location.protocol==="https:";let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==n}const t=e&&e.forceBase64;this.supportsBinary=dc&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};tc(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,ec(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Fs()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port);const i=Ms(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new rt(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}class rt extends ge{constructor(e,t){super(),Vn(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=Ls(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new Ws(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.opts.extraHeaders[n])}}catch(n){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{t.setRequestHeader("Accept","*/*")}catch(n){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document!="undefined"&&(this.index=rt.requestsCount++,rt.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=hc,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete rt.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}rt.requestsCount=0;rt.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Hi);else if(typeof addEventListener=="function"){const r="onpagehide"in Je?"pagehide":"unload";addEventListener(r,Hi,!1)}}function Hi(){for(let r in rt.requests)rt.requests.hasOwnProperty(r)&&rt.requests[r].abort()}const zs=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),yn=Je.WebSocket||Je.MozWebSocket,Ji=!0,yc="arraybuffer",qi=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class mc extends Ds{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=qi?{}:Ls(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Ji&&!qi?t?new yn(e,t):new yn(e):new yn(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||yc,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;Cs(n,this.supportsBinary,s=>{const o={};try{Ji&&this.ws.send(s)}catch(a){}i&&zs(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Fs()),this.supportsBinary||(e.b64=1);const i=Ms(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}check(){return!!yn}}const gc={websocket:mc,polling:pc},vc=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,wc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Pr(r){const e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let i=vc.exec(r||""),s={},o=14;for(;o--;)s[wc[o]]=i[o]||"";return t!=-1&&n!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=bc(s,s.path),s.queryKey=xc(s,s.query),s}function bc(r,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function xc(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(t[i]=s)}),t}class vt extends ge{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=Pr(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Pr(t.host).host),Vn(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=lc(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Bs,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new gc[e](n)}open(){let e;if(this.opts.rememberUpgrade&&vt.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;vt.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",f=>{if(!n)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;vt.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const y=new Error("probe error");y.transport=t.name,this.emitReserved("upgradeError",y)}}))};function s(){n||(n=!0,l(),t.close(),t=null)}const o=f=>{const y=new Error("probe error: "+f);y.transport=t.name,s(),this.emitReserved("upgradeError",y)};function a(){o("transport closed")}function c(){o("socket closed")}function u(f){t&&f.name!==t.name&&s()}const l=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",u),t.open()}onOpen(){if(this.readyState="open",vt.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(t+=oc(i)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if(typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const s={type:e,data:t,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){vt.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}vt.protocol=Bs;function Ec(r,e="",t){let n=r;t=t||typeof location!="undefined"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t!="undefined"?r=t.protocol+"//"+r:r="https://"+r),n=Pr(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+e,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}const kc=typeof ArrayBuffer=="function",Ac=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Vs=Object.prototype.toString,Sc=typeof Blob=="function"||typeof Blob!="undefined"&&Vs.call(Blob)==="[object BlobConstructor]",_c=typeof File=="function"||typeof File!="undefined"&&Vs.call(File)==="[object FileConstructor]";function Qr(r){return kc&&(r instanceof ArrayBuffer||Ac(r))||Sc&&r instanceof Blob||_c&&r instanceof File}function kn(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(kn(r[t]))return!0;return!1}if(Qr(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return kn(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&kn(r[t]))return!0;return!1}function Tc(r){const e=[],t=r.data,n=r;return n.data=Ir(t,e),n.attachments=e.length,{packet:n,buffers:e}}function Ir(r,e){if(!r)return r;if(Qr(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=Ir(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=Ir(r[n],e));return t}return r}function Oc(r,e){return r.data=Rr(r.data,e),delete r.attachments,r}function Rr(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=Rr(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=Rr(r[t],e));return r}const Pc=5;var te;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(te||(te={}));class Ic{constructor(e){this.replacer=e}encode(e){return(e.type===te.EVENT||e.type===te.ACK)&&kn(e)?this.encodeAsBinary({type:e.type===te.EVENT?te.BINARY_EVENT:te.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===te.BINARY_EVENT||e.type===te.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Tc(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}class Xr extends ge{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===te.BINARY_EVENT;n||t.type===te.BINARY_ACK?(t.type=n?te.EVENT:te.ACK,this.reconstructor=new Rc(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Qr(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(te[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===te.BINARY_EVENT||n.type===te.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(s,t)}else n.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(Xr.isPayloadValid(n.type,s))n.data=s;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case te.CONNECT:return typeof t=="object";case te.DISCONNECT:return t===void 0;case te.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case te.EVENT:case te.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case te.ACK:case te.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Rc{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Oc(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Cc=Object.freeze(Object.defineProperty({__proto__:null,protocol:Pc,get PacketType(){return te},Encoder:Ic,Decoder:Xr},Symbol.toStringTag,{value:"Module"}));function Xe(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const Nc=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Hs extends ge{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Xe(e,"open",this.onopen.bind(this)),Xe(e,"packet",this.onpacket.bind(this)),Xe(e,"error",this.onerror.bind(this)),Xe(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Nc.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:te.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,a=t.pop();this._registerAckCallback(o,a),n.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}emitWithAck(e,...t){const n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{t.push((o,a)=>n?o?s(o):i(a):i(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:te.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case te.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case te.EVENT:case te.BINARY_EVENT:this.onevent(e);break;case te.ACK:case te.BINARY_ACK:this.onack(e);break;case te.DISCONNECT:this.ondisconnect();break;case te.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:te.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:te.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Vt(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Vt.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=(Math.floor(e*10)&1)==0?r-t:r+t}return Math.min(r,this.max)|0};Vt.prototype.reset=function(){this.attempts=0};Vt.prototype.setMin=function(r){this.ms=r};Vt.prototype.setMax=function(r){this.max=r};Vt.prototype.setJitter=function(r){this.jitter=r};class Cr extends ge{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Vn(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Vt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||Cc;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new vt(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=Xe(t,"open",function(){n.onopen(),e&&e()}),s=Xe(t,"error",o=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",o),e?e(o):n.maybeReconnectOnOpen()});if(this._timeout!==!1){const o=this._timeout;o===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Xe(e,"ping",this.onping.bind(this)),Xe(e,"data",this.ondata.bind(this)),Xe(e,"error",this.onerror.bind(this)),Xe(e,"close",this.onclose.bind(this)),Xe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){zs(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Hs(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const qt={};function An(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=Ec(r,e.path||"/socket.io"),n=t.source,i=t.id,s=t.path,o=qt[i]&&s in qt[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new Cr(n,e):(qt[i]||(qt[i]=new Cr(n,e)),c=qt[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(An,{Manager:Cr,Socket:Hs,io:An,connect:An});const $c={init:({API_KEY:r,HOST_SERVER:e,CURRENT:t,ENV:n,API_VERSION:i})=>{var a,c;let s={};const o=localStorage.getItem("accessToken");try{const u={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return o&&(u.Authorization="Bearer "+o),s.auth=An(e.AUTH,{extraHeaders:u}),(a=s==null?void 0:s.auth)==null||a.on("connect",()=>{var f,y,d,p,g;n==="dev"&&console.log("Swyger Auth Client JS is connected with Swyger Server!!!");let l=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");l.uid&&(f=s.auth)!=null&&f.id&&(n==="dev"&&console.log("The socket device id is: ",(y=s.auth)==null?void 0:y.id),(p=s==null?void 0:s.auth)==null||p.emit((i==null?void 0:i.AUTH)+"/user/join",{socketId:(d=s.auth)==null?void 0:d.id,currentUserId:l.uid}),(g=s==null?void 0:s.auth)==null||g.on((i==null?void 0:i.AUTH)+"/user/status",S=>{if(l.status!=="online"){let P;S.from===l.uid&&(P=S==null?void 0:S.value),P!=null&&P.status&&(n==="dev"&&console.log("user is online: ",P),l.status=P.status,localStorage.setItem("userInfo",JSON.stringify(l)))}}))}),(c=s==null?void 0:s.auth)==null||c.on("disconnect",l=>{n==="dev"&&console.log("The device is disconnected from Auth server!");let f=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");f.uid&&f.status!=="offline"&&(f.status="offline",localStorage.setItem("userInfo",JSON.stringify(f)))}),s}catch(u){}}};function Nr(r){this.message=r}Nr.prototype=new Error,Nr.prototype.name="InvalidCharacterError";var Yi=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(r){var e=String(r).replace(/=+$/,"");if(e.length%4==1)throw new Nr("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,i=0,s=0,o="";n=e.charAt(s++);~n&&(t=i%4?64*t+n:n,i++%4)?o+=String.fromCharCode(255&t>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o};function jc(r){var e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(Yi(t).replace(/(.)/g,function(n,i){var s=i.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(e)}catch(t){return Yi(e)}}function $n(r){this.message=r}function Gi(r,e){if(typeof r!="string")throw new $n("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(jc(r.split(".")[t]))}catch(n){throw new $n("Invalid token specified: "+n.message)}}$n.prototype=new Error,$n.prototype.name="InvalidTokenError";function Js(r,e){return function(){return r.apply(e,arguments)}}const{toString:Bc}=Object.prototype,{getPrototypeOf:Zr}=Object,Hn=(r=>e=>{const t=Bc.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),st=r=>(r=r.toLowerCase(),e=>Hn(e)===r),Jn=r=>e=>typeof e===r,{isArray:Ht}=Array,Xt=Jn("undefined");function Lc(r){return r!==null&&!Xt(r)&&r.constructor!==null&&!Xt(r.constructor)&&qe(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const qs=st("ArrayBuffer");function Dc(r){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&qs(r.buffer),e}const Uc=Jn("string"),qe=Jn("function"),Ys=Jn("number"),qn=r=>r!==null&&typeof r=="object",Fc=r=>r===!0||r===!1,Sn=r=>{if(Hn(r)!=="object")return!1;const e=Zr(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Mc=st("Date"),Kc=st("File"),Wc=st("Blob"),zc=st("FileList"),Vc=r=>qn(r)&&qe(r.pipe),Hc=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||qe(r.append)&&((e=Hn(r))==="formdata"||e==="object"&&qe(r.toString)&&r.toString()==="[object FormData]"))},Jc=st("URLSearchParams"),qc=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function an(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r=="undefined")return;let n,i;if(typeof r!="object"&&(r=[r]),Ht(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{const s=t?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length;let a;for(n=0;n<o;n++)a=s[n],e.call(null,r[a],a,r)}}function Gs(r,e){e=e.toLowerCase();const t=Object.keys(r);let n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}const Qs=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),Xs=r=>!Xt(r)&&r!==Qs;function $r(){const{caseless:r}=Xs(this)&&this||{},e={},t=(n,i)=>{const s=r&&Gs(e,i)||i;Sn(e[s])&&Sn(n)?e[s]=$r(e[s],n):Sn(n)?e[s]=$r({},n):Ht(n)?e[s]=n.slice():e[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&an(arguments[n],t);return e}const Yc=(r,e,t,{allOwnKeys:n}={})=>(an(e,(i,s)=>{t&&qe(i)?r[s]=Js(i,t):r[s]=i},{allOwnKeys:n}),r),Gc=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Qc=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},Xc=(r,e,t,n)=>{let i,s,o;const a={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!n||n(o,r,e))&&!a[o]&&(e[o]=r[o],a[o]=!0);r=t!==!1&&Zr(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},Zc=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const n=r.indexOf(e,t);return n!==-1&&n===t},eu=r=>{if(!r)return null;if(Ht(r))return r;let e=r.length;if(!Ys(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},tu=(r=>e=>r&&e instanceof r)(typeof Uint8Array!="undefined"&&Zr(Uint8Array)),nu=(r,e)=>{const n=(r&&r[Symbol.iterator]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},ru=(r,e)=>{let t;const n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},iu=st("HTMLFormElement"),su=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),Qi=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),ou=st("RegExp"),Zs=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),n={};an(t,(i,s)=>{e(i,s,r)!==!1&&(n[s]=i)}),Object.defineProperties(r,n)},au=r=>{Zs(r,(e,t)=>{if(qe(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=r[t];if(!!qe(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},cu=(r,e)=>{const t={},n=i=>{i.forEach(s=>{t[s]=!0})};return Ht(r)?n(r):n(String(r).split(e)),t},uu=()=>{},lu=(r,e)=>(r=+r,Number.isFinite(r)?r:e),fr="abcdefghijklmnopqrstuvwxyz",Xi="0123456789",eo={DIGIT:Xi,ALPHA:fr,ALPHA_DIGIT:fr+fr.toUpperCase()+Xi},fu=(r=16,e=eo.ALPHA_DIGIT)=>{let t="";const{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function hu(r){return!!(r&&qe(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const du=r=>{const e=new Array(10),t=(n,i)=>{if(qn(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;const s=Ht(n)?[]:{};return an(n,(o,a)=>{const c=t(o,i+1);!Xt(c)&&(s[a]=c)}),e[i]=void 0,s}}return n};return t(r,0)},pu=st("AsyncFunction"),yu=r=>r&&(qn(r)||qe(r))&&qe(r.then)&&qe(r.catch),B={isArray:Ht,isArrayBuffer:qs,isBuffer:Lc,isFormData:Hc,isArrayBufferView:Dc,isString:Uc,isNumber:Ys,isBoolean:Fc,isObject:qn,isPlainObject:Sn,isUndefined:Xt,isDate:Mc,isFile:Kc,isBlob:Wc,isRegExp:ou,isFunction:qe,isStream:Vc,isURLSearchParams:Jc,isTypedArray:tu,isFileList:zc,forEach:an,merge:$r,extend:Yc,trim:qc,stripBOM:Gc,inherits:Qc,toFlatObject:Xc,kindOf:Hn,kindOfTest:st,endsWith:Zc,toArray:eu,forEachEntry:nu,matchAll:ru,isHTMLForm:iu,hasOwnProperty:Qi,hasOwnProp:Qi,reduceDescriptors:Zs,freezeMethods:au,toObjectSet:cu,toCamelCase:su,noop:uu,toFiniteNumber:lu,findKey:Gs,global:Qs,isContextDefined:Xs,ALPHABET:eo,generateString:fu,isSpecCompliantForm:hu,toJSONObject:du,isAsyncFn:pu,isThenable:yu};function re(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i)}B.inherits(re,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:B.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const to=re.prototype,no={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{no[r]={value:r}});Object.defineProperties(re,no);Object.defineProperty(to,"isAxiosError",{value:!0});re.from=(r,e,t,n,i,s)=>{const o=Object.create(to);return B.toFlatObject(r,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),re.call(o,r.message,e,t,n,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};const mu=null;function jr(r){return B.isPlainObject(r)||B.isArray(r)}function ro(r){return B.endsWith(r,"[]")?r.slice(0,-2):r}function Zi(r,e,t){return r?r.concat(e).map(function(i,s){return i=ro(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function gu(r){return B.isArray(r)&&!r.some(jr)}const vu=B.toFlatObject(B,{},null,function(e){return/^is[A-Z]/.test(e)});function Yn(r,e,t){if(!B.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=B.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,S){return!B.isUndefined(S[g])});const n=t.metaTokens,i=t.visitor||l,s=t.dots,o=t.indexes,c=(t.Blob||typeof Blob!="undefined"&&Blob)&&B.isSpecCompliantForm(e);if(!B.isFunction(i))throw new TypeError("visitor must be a function");function u(p){if(p===null)return"";if(B.isDate(p))return p.toISOString();if(!c&&B.isBlob(p))throw new re("Blob is not supported. Use a Buffer instead.");return B.isArrayBuffer(p)||B.isTypedArray(p)?c&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function l(p,g,S){let P=p;if(p&&!S&&typeof p=="object"){if(B.endsWith(g,"{}"))g=n?g:g.slice(0,-2),p=JSON.stringify(p);else if(B.isArray(p)&&gu(p)||(B.isFileList(p)||B.endsWith(g,"[]"))&&(P=B.toArray(p)))return g=ro(g),P.forEach(function(j,D){!(B.isUndefined(j)||j===null)&&e.append(o===!0?Zi([g],D,s):o===null?g:g+"[]",u(j))}),!1}return jr(p)?!0:(e.append(Zi(S,g,s),u(p)),!1)}const f=[],y=Object.assign(vu,{defaultVisitor:l,convertValue:u,isVisitable:jr});function d(p,g){if(!B.isUndefined(p)){if(f.indexOf(p)!==-1)throw Error("Circular reference detected in "+g.join("."));f.push(p),B.forEach(p,function(P,L){(!(B.isUndefined(P)||P===null)&&i.call(e,P,B.isString(L)?L.trim():L,g,y))===!0&&d(P,g?g.concat(L):[L])}),f.pop()}}if(!B.isObject(r))throw new TypeError("data must be an object");return d(r),e}function es(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function ei(r,e){this._pairs=[],r&&Yn(r,this,e)}const io=ei.prototype;io.append=function(e,t){this._pairs.push([e,t])};io.toString=function(e){const t=e?function(n){return e.call(this,n,es)}:es;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function wu(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function so(r,e,t){if(!e)return r;const n=t&&t.encode||wu,i=t&&t.serialize;let s;if(i?s=i(e,t):s=B.isURLSearchParams(e)?e.toString():new ei(e,t).toString(n),s){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class bu{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){B.forEach(this.handlers,function(n){n!==null&&e(n)})}}const ts=bu,oo={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},xu=typeof URLSearchParams!="undefined"?URLSearchParams:ei,Eu=typeof FormData!="undefined"?FormData:null,ku=typeof Blob!="undefined"?Blob:null,Au=(()=>{let r;return typeof navigator!="undefined"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),Su=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),nt={isBrowser:!0,classes:{URLSearchParams:xu,FormData:Eu,Blob:ku},isStandardBrowserEnv:Au,isStandardBrowserWebWorkerEnv:Su,protocols:["http","https","file","blob","url","data"]};function _u(r,e){return Yn(r,new nt.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,s){return nt.isNode&&B.isBuffer(t)?(this.append(n,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function Tu(r){return B.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Ou(r){const e={},t=Object.keys(r);let n;const i=t.length;let s;for(n=0;n<i;n++)s=t[n],e[s]=r[s];return e}function ao(r){function e(t,n,i,s){let o=t[s++];const a=Number.isFinite(+o),c=s>=t.length;return o=!o&&B.isArray(i)?i.length:o,c?(B.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!a):((!i[o]||!B.isObject(i[o]))&&(i[o]=[]),e(t,n,i[o],s)&&B.isArray(i[o])&&(i[o]=Ou(i[o])),!a)}if(B.isFormData(r)&&B.isFunction(r.entries)){const t={};return B.forEachEntry(r,(n,i)=>{e(Tu(n),i,t,0)}),t}return null}const Pu={"Content-Type":void 0};function Iu(r,e,t){if(B.isString(r))try{return(e||JSON.parse)(r),B.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}const Gn={transitional:oo,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=B.isObject(e);if(s&&B.isHTMLForm(e)&&(e=new FormData(e)),B.isFormData(e))return i&&i?JSON.stringify(ao(e)):e;if(B.isArrayBuffer(e)||B.isBuffer(e)||B.isStream(e)||B.isFile(e)||B.isBlob(e))return e;if(B.isArrayBufferView(e))return e.buffer;if(B.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return _u(e,this.formSerializer).toString();if((a=B.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Yn(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),Iu(e)):e}],transformResponse:[function(e){const t=this.transitional||Gn.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&B.isString(e)&&(n&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?re.from(a,re.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:nt.classes.FormData,Blob:nt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};B.forEach(["delete","get","head"],function(e){Gn.headers[e]={}});B.forEach(["post","put","patch"],function(e){Gn.headers[e]=B.merge(Pu)});const ti=Gn,Ru=B.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Cu=r=>{const e={};let t,n,i;return r&&r.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),n=o.substring(i+1).trim(),!(!t||e[t]&&Ru[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},ns=Symbol("internals");function Yt(r){return r&&String(r).trim().toLowerCase()}function _n(r){return r===!1||r==null?r:B.isArray(r)?r.map(_n):String(r)}function Nu(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}const $u=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function hr(r,e,t,n,i){if(B.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!B.isString(e)){if(B.isString(n))return e.indexOf(n)!==-1;if(B.isRegExp(n))return n.test(e)}}function ju(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function Bu(r,e){const t=B.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,s,o){return this[n].call(this,e,i,s,o)},configurable:!0})})}class Qn{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function s(a,c,u){const l=Yt(c);if(!l)throw new Error("header name must be a non-empty string");const f=B.findKey(i,l);(!f||i[f]===void 0||u===!0||u===void 0&&i[f]!==!1)&&(i[f||c]=_n(a))}const o=(a,c)=>B.forEach(a,(u,l)=>s(u,l,c));return B.isPlainObject(e)||e instanceof this.constructor?o(e,t):B.isString(e)&&(e=e.trim())&&!$u(e)?o(Cu(e),t):e!=null&&s(t,e,n),this}get(e,t){if(e=Yt(e),e){const n=B.findKey(this,e);if(n){const i=this[n];if(!t)return i;if(t===!0)return Nu(i);if(B.isFunction(t))return t.call(this,i,n);if(B.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Yt(e),e){const n=B.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||hr(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let i=!1;function s(o){if(o=Yt(o),o){const a=B.findKey(n,o);a&&(!t||hr(n,n[a],a,t))&&(delete n[a],i=!0)}}return B.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const s=t[n];(!e||hr(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,n={};return B.forEach(this,(i,s)=>{const o=B.findKey(n,s);if(o){t[o]=_n(i),delete t[s];return}const a=e?ju(s):String(s).trim();a!==s&&delete t[s],t[a]=_n(i),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return B.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&B.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){const n=(this[ns]=this[ns]={accessors:{}}).accessors,i=this.prototype;function s(o){const a=Yt(o);n[a]||(Bu(i,o),n[a]=!0)}return B.isArray(e)?e.forEach(s):s(e),this}}Qn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);B.freezeMethods(Qn.prototype);B.freezeMethods(Qn);const lt=Qn;function dr(r,e){const t=this||ti,n=e||t,i=lt.from(n.headers);let s=n.data;return B.forEach(r,function(a){s=a.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function co(r){return!!(r&&r.__CANCEL__)}function cn(r,e,t){re.call(this,r==null?"canceled":r,re.ERR_CANCELED,e,t),this.name="CanceledError"}B.inherits(cn,re,{__CANCEL__:!0});function Lu(r,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new re("Request failed with status code "+t.status,[re.ERR_BAD_REQUEST,re.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const Du=nt.isStandardBrowserEnv?function(){return{write:function(t,n,i,s,o,a){const c=[];c.push(t+"="+encodeURIComponent(n)),B.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),B.isString(s)&&c.push("path="+s),B.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){const n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function Uu(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Fu(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function uo(r,e){return r&&!Uu(e)?Fu(r,e):e}const Mu=nt.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function i(s){let o=s;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(o){const a=B.isString(o)?i(o):o;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}();function Ku(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function Wu(r,e){r=r||10;const t=new Array(r),n=new Array(r);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(c){const u=Date.now(),l=n[s];o||(o=u),t[i]=c,n[i]=u;let f=s,y=0;for(;f!==i;)y+=t[f++],f=f%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),u-o<e)return;const d=l&&u-l;return d?Math.round(y*1e3/d):void 0}}function rs(r,e){let t=0;const n=Wu(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-t,c=n(a),u=s<=o;t=s;const l={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&u?(o-s)/c:void 0,event:i};l[e?"download":"upload"]=!0,r(l)}}const zu=typeof XMLHttpRequest!="undefined",Vu=zu&&function(r){return new Promise(function(t,n){let i=r.data;const s=lt.from(r.headers).normalize(),o=r.responseType;let a;function c(){r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}B.isFormData(i)&&(nt.isStandardBrowserEnv||nt.isStandardBrowserWebWorkerEnv?s.setContentType(!1):s.setContentType("multipart/form-data;",!1));let u=new XMLHttpRequest;if(r.auth){const d=r.auth.username||"",p=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";s.set("Authorization","Basic "+btoa(d+":"+p))}const l=uo(r.baseURL,r.url);u.open(r.method.toUpperCase(),so(l,r.params,r.paramsSerializer),!0),u.timeout=r.timeout;function f(){if(!u)return;const d=lt.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),g={data:!o||o==="text"||o==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:d,config:r,request:u};Lu(function(P){t(P),c()},function(P){n(P),c()},g),u=null}if("onloadend"in u?u.onloadend=f:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(f)},u.onabort=function(){!u||(n(new re("Request aborted",re.ECONNABORTED,r,u)),u=null)},u.onerror=function(){n(new re("Network Error",re.ERR_NETWORK,r,u)),u=null},u.ontimeout=function(){let p=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const g=r.transitional||oo;r.timeoutErrorMessage&&(p=r.timeoutErrorMessage),n(new re(p,g.clarifyTimeoutError?re.ETIMEDOUT:re.ECONNABORTED,r,u)),u=null},nt.isStandardBrowserEnv){const d=(r.withCredentials||Mu(l))&&r.xsrfCookieName&&Du.read(r.xsrfCookieName);d&&s.set(r.xsrfHeaderName,d)}i===void 0&&s.setContentType(null),"setRequestHeader"in u&&B.forEach(s.toJSON(),function(p,g){u.setRequestHeader(g,p)}),B.isUndefined(r.withCredentials)||(u.withCredentials=!!r.withCredentials),o&&o!=="json"&&(u.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&u.addEventListener("progress",rs(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",rs(r.onUploadProgress)),(r.cancelToken||r.signal)&&(a=d=>{!u||(n(!d||d.type?new cn(null,r,u):d),u.abort(),u=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const y=Ku(l);if(y&&nt.protocols.indexOf(y)===-1){n(new re("Unsupported protocol "+y+":",re.ERR_BAD_REQUEST,r));return}u.send(i||null)})},Tn={http:mu,xhr:Vu};B.forEach(Tn,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch(t){}Object.defineProperty(r,"adapterName",{value:e})}});const Hu={getAdapter:r=>{r=B.isArray(r)?r:[r];const{length:e}=r;let t,n;for(let i=0;i<e&&(t=r[i],!(n=B.isString(t)?Tn[t.toLowerCase()]:t));i++);if(!n)throw n===!1?new re(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(B.hasOwnProp(Tn,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!B.isFunction(n))throw new TypeError("adapter is not a function");return n},adapters:Tn};function pr(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new cn(null,r)}function is(r){return pr(r),r.headers=lt.from(r.headers),r.data=dr.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),Hu.getAdapter(r.adapter||ti.adapter)(r).then(function(n){return pr(r),n.data=dr.call(r,r.transformResponse,n),n.headers=lt.from(n.headers),n},function(n){return co(n)||(pr(r),n&&n.response&&(n.response.data=dr.call(r,r.transformResponse,n.response),n.response.headers=lt.from(n.response.headers))),Promise.reject(n)})}const ss=r=>r instanceof lt?r.toJSON():r;function Kt(r,e){e=e||{};const t={};function n(u,l,f){return B.isPlainObject(u)&&B.isPlainObject(l)?B.merge.call({caseless:f},u,l):B.isPlainObject(l)?B.merge({},l):B.isArray(l)?l.slice():l}function i(u,l,f){if(B.isUndefined(l)){if(!B.isUndefined(u))return n(void 0,u,f)}else return n(u,l,f)}function s(u,l){if(!B.isUndefined(l))return n(void 0,l)}function o(u,l){if(B.isUndefined(l)){if(!B.isUndefined(u))return n(void 0,u)}else return n(void 0,l)}function a(u,l,f){if(f in e)return n(u,l);if(f in r)return n(void 0,u)}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(u,l)=>i(ss(u),ss(l),!0)};return B.forEach(Object.keys(Object.assign({},r,e)),function(l){const f=c[l]||i,y=f(r[l],e[l],l);B.isUndefined(y)&&f!==a||(t[l]=y)}),t}const lo="1.4.0",ni={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{ni[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const os={};ni.transitional=function(e,t,n){function i(s,o){return"[Axios v"+lo+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return(s,o,a)=>{if(e===!1)throw new re(i(o," has been removed"+(t?" in "+t:"")),re.ERR_DEPRECATED);return t&&!os[o]&&(os[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};function Ju(r,e,t){if(typeof r!="object")throw new re("options must be an object",re.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],o=e[s];if(o){const a=r[s],c=a===void 0||o(a,s,r);if(c!==!0)throw new re("option "+s+" must be "+c,re.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new re("Unknown option "+s,re.ERR_BAD_OPTION)}}const Br={assertOptions:Ju,validators:ni},pt=Br.validators;class jn{constructor(e){this.defaults=e,this.interceptors={request:new ts,response:new ts}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Kt(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;n!==void 0&&Br.assertOptions(n,{silentJSONParsing:pt.transitional(pt.boolean),forcedJSONParsing:pt.transitional(pt.boolean),clarifyTimeoutError:pt.transitional(pt.boolean)},!1),i!=null&&(B.isFunction(i)?t.paramsSerializer={serialize:i}:Br.assertOptions(i,{encode:pt.function,serialize:pt.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o;o=s&&B.merge(s.common,s[t.method]),o&&B.forEach(["delete","get","head","post","put","patch","common"],p=>{delete s[p]}),t.headers=lt.concat(o,s);const a=[];let c=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(c=c&&g.synchronous,a.unshift(g.fulfilled,g.rejected))});const u=[];this.interceptors.response.forEach(function(g){u.push(g.fulfilled,g.rejected)});let l,f=0,y;if(!c){const p=[is.bind(this),void 0];for(p.unshift.apply(p,a),p.push.apply(p,u),y=p.length,l=Promise.resolve(t);f<y;)l=l.then(p[f++],p[f++]);return l}y=a.length;let d=t;for(f=0;f<y;){const p=a[f++],g=a[f++];try{d=p(d)}catch(S){g.call(this,S);break}}try{l=is.call(this,d)}catch(p){return Promise.reject(p)}for(f=0,y=u.length;f<y;)l=l.then(u[f++],u[f++]);return l}getUri(e){e=Kt(this.defaults,e);const t=uo(e.baseURL,e.url);return so(t,e.params,e.paramsSerializer)}}B.forEach(["delete","get","head","options"],function(e){jn.prototype[e]=function(t,n){return this.request(Kt(n||{},{method:e,url:t,data:(n||{}).data}))}});B.forEach(["post","put","patch"],function(e){function t(n){return function(s,o,a){return this.request(Kt(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}jn.prototype[e]=t(),jn.prototype[e+"Form"]=t(!0)});const On=jn;class ri{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{n.subscribe(a),s=a}).then(i);return o.cancel=function(){n.unsubscribe(s)},o},e(function(s,o,a){n.reason||(n.reason=new cn(s,o,a),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new ri(function(i){e=i}),cancel:e}}}const qu=ri;function Yu(r){return function(t){return r.apply(null,t)}}function Gu(r){return B.isObject(r)&&r.isAxiosError===!0}const Lr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Lr).forEach(([r,e])=>{Lr[e]=r});const Qu=Lr;function fo(r){const e=new On(r),t=Js(On.prototype.request,e);return B.extend(t,On.prototype,e,{allOwnKeys:!0}),B.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return fo(Kt(r,i))},t}const be=fo(ti);be.Axios=On;be.CanceledError=cn;be.CancelToken=qu;be.isCancel=co;be.VERSION=lo;be.toFormData=Yn;be.AxiosError=re;be.Cancel=be.CanceledError;be.all=function(e){return Promise.all(e)};be.spread=Yu;be.isAxiosError=Gu;be.mergeConfig=Kt;be.AxiosHeaders=lt;be.formToJSON=r=>ao(B.isHTMLForm(r)?new FormData(r):r);be.HttpStatusCode=Qu;be.default=be;const Xu=be,as={init:({API_KEY:r})=>(...s)=>C(void 0,[...s],function*(e="post",t="/",n={},i={}){var f,y,d,p;const o=localStorage.getItem("accessToken");let a={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};o&&(a.Authorization="Bearer "+o);const c=t;typeof(n==null?void 0:n.get)=="function"&&(n==null?void 0:n.get("file"))&&(a["Content-Type"]="multipart/form-data"),i!=null&&i.headers&&(a=Object.assign(...a,...i.headers),delete i.headers);const u=Object.assign({mode:"cors",method:e,url:c,data:n,headers:a},i);let l={};try{const g=yield Xu(u);l.data=((f=g==null?void 0:g.data)==null?void 0:f.data)||(g==null?void 0:g.data),l.data||(l.data={})}catch(g){l.error=((d=(y=g.response)==null?void 0:y.data)==null?void 0:d.error)||((p=g.response)==null?void 0:p.error),l.error||(l.error={})}return l})};let mn;const Zu=new Uint8Array(16);function el(){if(!mn&&(mn=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!mn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mn(Zu)}const Ie=[];for(let r=0;r<256;++r)Ie.push((r+256).toString(16).slice(1));function tl(r,e=0){return(Ie[r[e+0]]+Ie[r[e+1]]+Ie[r[e+2]]+Ie[r[e+3]]+"-"+Ie[r[e+4]]+Ie[r[e+5]]+"-"+Ie[r[e+6]]+Ie[r[e+7]]+"-"+Ie[r[e+8]]+Ie[r[e+9]]+"-"+Ie[r[e+10]]+Ie[r[e+11]]+Ie[r[e+12]]+Ie[r[e+13]]+Ie[r[e+14]]+Ie[r[e+15]]).toLowerCase()}const nl=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),cs={randomUUID:nl};function yr(r,e,t){if(cs.randomUUID&&!e&&!r)return cs.randomUUID();r=r||{};const n=r.random||(r.rng||el)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=n[i];return e}return tl(n)}var ho={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function s(c,u,l,f,y){if(typeof l!="function")throw new TypeError("The listener must be a function");var d=new i(l,f||c,y),p=t?t+u:u;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],d]:c._events[p].push(d):(c._events[p]=d,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],l,f;if(this._eventsCount===0)return u;for(f in l=this._events)e.call(l,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},a.prototype.listeners=function(u){var l=t?t+u:u,f=this._events[l];if(!f)return[];if(f.fn)return[f.fn];for(var y=0,d=f.length,p=new Array(d);y<d;y++)p[y]=f[y].fn;return p},a.prototype.listenerCount=function(u){var l=t?t+u:u,f=this._events[l];return f?f.fn?1:f.length:0},a.prototype.emit=function(u,l,f,y,d,p){var g=t?t+u:u;if(!this._events[g])return!1;var S=this._events[g],P=arguments.length,L,j;if(S.fn){switch(S.once&&this.removeListener(u,S.fn,void 0,!0),P){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,l),!0;case 3:return S.fn.call(S.context,l,f),!0;case 4:return S.fn.call(S.context,l,f,y),!0;case 5:return S.fn.call(S.context,l,f,y,d),!0;case 6:return S.fn.call(S.context,l,f,y,d,p),!0}for(j=1,L=new Array(P-1);j<P;j++)L[j-1]=arguments[j];S.fn.apply(S.context,L)}else{var D=S.length,W;for(j=0;j<D;j++)switch(S[j].once&&this.removeListener(u,S[j].fn,void 0,!0),P){case 1:S[j].fn.call(S[j].context);break;case 2:S[j].fn.call(S[j].context,l);break;case 3:S[j].fn.call(S[j].context,l,f);break;case 4:S[j].fn.call(S[j].context,l,f,y);break;default:if(!L)for(W=1,L=new Array(P-1);W<P;W++)L[W-1]=arguments[W];S[j].fn.apply(S[j].context,L)}}return!0},a.prototype.on=function(u,l,f){return s(this,u,l,f,!1)},a.prototype.once=function(u,l,f){return s(this,u,l,f,!0)},a.prototype.removeListener=function(u,l,f,y){var d=t?t+u:u;if(!this._events[d])return this;if(!l)return o(this,d),this;var p=this._events[d];if(p.fn)p.fn===l&&(!y||p.once)&&(!f||p.context===f)&&o(this,d);else{for(var g=0,S=[],P=p.length;g<P;g++)(p[g].fn!==l||y&&!p[g].once||f&&p[g].context!==f)&&S.push(p[g]);S.length?this._events[d]=S.length===1?S[0]:S:o(this,d)}return this},a.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&o(this,l)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(ho);const rl=ho.exports;function mr(r,e){try{r(e)}catch(t){console.error("Error in subscription callback",t)}}const yt=Symbol("subscriptions"),mt=Symbol("oneTimeEvents");class Wt{constructor(){this[yt]=[],this[mt]=new Map}on(e,t){return this[mt].has(e)?mr(t,this[mt].get(e)):(this[yt].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[yt]=this[yt].filter(n=>n.event!==e||t&&n.callback!==t),this}once(e,t){return new Promise(n=>{const i=s=>{n(s),t==null||t(s)};this[mt].has(e)?mr(i,this[mt].get(e)):this[yt].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[mt].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let n=0;n<this[yt].length;n++){const i=this[yt][n];i.event===e&&(mr(i.callback,t),i.once&&(this[yt].splice(n,1),n--))}return this}emitOnce(e,t){if(this[mt].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[mt].set(e,t),this.off(e),this}pipe(e,t){this.on(e,n=>{t.emit(e,n)})}pipeOnce(e,t){this.once(e,n=>{t.emitOnce(e,n)})}}function gt(r){return r=r.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),r.length===0?[]:r.split("/").map(t=>t.startsWith("[")?parseInt(t.slice(1,-1)):t)}class N{static get(e){return new N(e)}static getChildPath(e,t){return N.get(e).child(t).path}static getPathKeys(e){return gt(e)}constructor(e){typeof e=="string"?this.keys=gt(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,n,i)=>i===0?`${n}`:typeof n=="string"?`${t}/${n}`:`${t}[${n}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new N(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=gt(e);t.forEach(n=>{if(typeof n=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(n))throw new Error(`Invalid child key "${n}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(n.length>128)throw new Error(`child key "${n}" for path "${this.path}" is too long. Max key length is 128`);if(n.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new N(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const n=gt(e),i=gt(t);let s=0;const o={get length(){return s}};return n.forEach((a,c)=>{const u=i[c];if(a==="*")o[s++]=u;else if(typeof a=="string"&&a[0]==="$"){o[s++]=u,o[a]=u;const l=a.slice(1);typeof o[l]=="undefined"&&(o[l]=u)}}),o}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const n=gt(e),i=gt(t),s=n.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let o="";return s.forEach(a=>{typeof a=="number"?o+=`[${a}]`:(o.length>0&&(o+="/"),o+=a)}),o}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const n=gt(e);let i=0;return n.reduce((o,a)=>typeof a=="string"&&(a==="*"||a.startsWith("$"))?N.getChildPath(o,t[i++]):N.getChildPath(o,a),"")}equals(e){const t=e instanceof N?e:new N(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((n,i)=>{const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isAncestorOf(e){const t=e instanceof N?e:new N(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((n,i)=>{const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isDescendantOf(e){const t=e instanceof N?e:new N(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((n,i)=>{const s=this.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isOnTrailOf(e){const t=e instanceof N?e:new N(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((n,i)=>{if(i>=t.keys.length)return!0;const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isChildOf(e){const t=e instanceof N?e:new N(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof N?e:new N(e);return t.path===""?!1:this.equals(t.parent)}}function gr(r,e,t=!1){if(!r.exists())return null;let n=t?r.previous():r.val();return typeof e=="number"?n[e]:(N.getPathKeys(e).every(i=>(n=n[i],typeof n!="undefined")),n||null)}function vr(r){if(!r.exists())return[];const e=r.val();return e instanceof Array?new Array(e.length).map((t,n)=>n):typeof e=="object"?Object.keys(e):[]}class de{exists(){return!1}constructor(e,t,n=!1,i,s){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>n?!1:t!==null&&typeof t!="undefined",this.context=()=>s||{}}static for(e,t){return new de(e,t)}child(e){const t=gr(this,e,!1),n=gr(this,e,!0);return new de(this.ref.child(e),t,!1,n)}hasChild(e){return gr(this,e)!==null}hasChildren(){return vr(this).length>0}numChildren(){return vr(this).length}forEach(e){const t=this.val(),n=this.previous();return vr(this).every(i=>{const s=new de(this.ref.child(i),t[i],!1,n[i]);return e(s)})}get key(){return this.ref.key}}class Pn extends de{constructor(e,t,n){super(e,t,!1,void 0,n),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(n=>{const i=n.target.reduce((o,a)=>o.child(a),this.ref),s=new de(i,n.val,!1,n.prev);return e(s)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],n=t.target.reduce((i,s)=>i.child(s),this.ref);return new de(n,t.val,!1,t.prev)}}class po{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,n)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return n(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:n})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const n=this._internal.activatePromises.shift();e?(n.callback&&n.callback(!0),n.resolve&&n.resolve()):(n.callback&&n.callback(!1,t),n.reject&&n.reject(t))}}}class il{constructor(e,t,n){this.publish=e,this.start=t,this.cancel=n}}class sl{constructor(e){const t=[];let n,i;const s="stopped (no more subscribers)";this.subscribe=(f,y)=>{if(typeof f!="function")throw new TypeError("callback must be a function");if(i===s)throw new Error("stream can't be used anymore because all subscribers were stopped");const d={callback:f,activationCallback:function(p,g){y==null||y(p,g),this.subscription._setActivationState(p,g)},subscription:new po(function(){return t.splice(t.indexOf(this),1),o()})};return t.push(d),typeof i!="undefined"&&(i===!0?(y==null||y(!0),d.subscription._setActivationState(!0)):typeof i=="string"&&(y==null||y(!1,i),d.subscription._setActivationState(!1,i))),d.subscription};const o=()=>{let f;return t.length===0&&(f=n==null?void 0:n(),i=s),Promise.resolve(f)};this.unsubscribe=f=>{(f?t.filter(d=>d.callback===f):t).forEach(d=>{const p=t.indexOf(d);t.splice(p,1)}),o()},this.stop=()=>{t.splice(0),o()};const a=f=>(t.forEach(y=>{try{y.callback(f)}catch(d){console.error(`Error running subscriber callback: ${d.message}`)}}),t.length===0&&o(),t.length>0),c=f=>{i=!0,n=f,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!0)})},u=f=>{i=f,t.forEach(y=>{var d;(d=y.activationCallback)==null||d.call(y,!1,f||new Error("unknown reason"))}),t.splice(0)},l=new il(a,c,u);e(l)}}function ii(r,e){const t="000000000"+r;return t.substr(t.length-e)}const ol=typeof window=="object"?window:self,al=Object.keys(ol).length;var Is,Rs;const cl=(Rs=(Is=navigator.mimeTypes)==null?void 0:Is.length)!=null?Rs:0,ul=ii((cl+navigator.userAgent.length).toString(36)+al.toString(36),4);function ll(){return ul}let Gt=0;const si=4,Bn=36,yo=Math.pow(Bn,si);function us(){return ii((Math.random()*yo<<0).toString(Bn),si)}function fl(){return Gt=Gt<yo?Gt:0,Gt++,Gt-1}function hl(r=0){const e="c",t=(new Date().getTime()+r).toString(Bn),n=ii(fl().toString(Bn),si),i=ll(),s=us()+us();return e+t+n+i+s}let ls=0;class Re{static set timeBias(e){typeof e=="number"&&(ls=e)}static generate(){return hl(ls).slice(1)}}class pe{constructor(e){this.path=e}}const He={nextTick(r){setTimeout(r,0)}};class Ln{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function dl(r){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,r),new Array(...e)}function pl(r){if((Array.isArray(r)?r.length:r.byteLength)!==8)throw new TypeError("must be 8 bytes");const t=new Uint8Array(r);return new DataView(t.buffer).getFloat64(0)}const wt={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function yl(r){if(typeof r!="bigint")throw new Error("number must be a bigint");const e=[],t=r<wt.zero;do{const n=Number(r&wt.ff);e.push(n),r=r>>wt.eight}while(r!==(t?-wt.one:wt.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function ml(r){const e=r[0]>=128;let t=wt.zero;for(let n of r)e&&(n=~n&255),t=(t<<wt.eight)+BigInt(n);return e&&(t=-(t+wt.one)),t}function gl(r){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(r);if(typeof Buffer=="function"){const e=Buffer.from(r,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<r.length;t++){let n=r.charCodeAt(t);if(n>128){if((n&55296)===55296){const i=r.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const s=n&1023,o=i&1023;n=65536|s<<10|o}if(n<2048){const i=192|n>>6&31,s=128|n&63;e.push(i,s)}else if(n<65536){const i=224|n>>12&15,s=128|n>>6&63,o=128|n&63;e.push(i,s,o)}else if(n<2097152){const i=240|n>>18&7,s=128|n>>12&63,o=128|n>>6&63,a=128|n&63;e.push(i,s,o,a)}else throw new Error(`Cannot convert character ${r.charAt(t)} (code ${n}) to utf-8`)}else e.push(n<128?n:63)}return new Uint8Array(e)}}function mo(r){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(r instanceof Uint8Array)return e.decode(r);const t=Uint8Array.from(r);return e.decode(t)}else if(typeof Buffer=="function"){if(r instanceof Array&&(r=Uint8Array.from(r)),!(r instanceof Buffer)&&"buffer"in r&&r.buffer instanceof ArrayBuffer){const e=r;r=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(r instanceof Buffer))throw new Error("Unsupported buffer argument");return r.toString("utf-8")}else{if(!(r instanceof Uint8Array)&&"buffer"in r&&r.buffer instanceof ArrayBuffer){const e=r;r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(r instanceof Buffer||r instanceof Array||r instanceof Uint8Array){let e="";for(let t=0;t<r.length;t++){let n=r[t];if(n>128)if((n&240)===240){const i=n,s=r[t+1],o=r[t+2],a=r[t+3];n=(i&7)<<18|(s&63)<<12|(o&63)<<6|a&63,t+=3}else if((n&224)===224){const i=n,s=r[t+1],o=r[t+2];n=(i&15)<<12|(s&63)<<6|o&63,t+=2}else if((n&192)===192){const i=n,s=r[t+1];n=(i&31)<<6|s&63,t++}else throw new Error("invalid utf-8 data");if(n>=65536){n^=65536;const i=55296|n>>10,s=56320|n&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(s)}else e+=String.fromCharCode(n)}return e}else throw new Error("Unsupported buffer argument")}}function vl(r,e){const t=new r.constructor(r.length+e.length);return t.set(r),t.set(e,r.length),t}function Ze(r,e){var s;if(((s=r==null?void 0:r.constructor)==null?void 0:s.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${r.ref.path}")`);const t=o=>(o!==null&&typeof o=="object"&&typeof o.constructor=="function"&&typeof o.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(o.constructor.name)&&(o=o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)),o);if(r=t(r),typeof r!="object"||r===null||r instanceof Date||r instanceof ArrayBuffer||r instanceof pe||r instanceof RegExp)return r;const n=o=>{if(e.indexOf(o)>=0)throw new ReferenceError("object contains a circular reference");return o=t(o),o===null||o instanceof Date||o instanceof ArrayBuffer||o instanceof pe||o instanceof RegExp||typeof o=="object"&&(e.push(o),o=Ze(o,e),e.pop()),o};typeof e=="undefined"&&(e=[r]);const i=r instanceof Array?[]:r instanceof Ln?new Ln:{};return Object.keys(r).forEach(o=>{const a=r[o];typeof a!="function"&&(i[o]=n(a))}),i}const xt=r=>typeof r=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(r.constructor.name);function Dn(r,e){if(r===e)return!0;if(typeof r!=typeof e)return!1;if(typeof r=="object"||typeof e=="object"){if(r===null||e===null)return!1;if(r instanceof pe||e instanceof pe)return r instanceof pe&&e instanceof pe&&r.path===e.path;if(r instanceof Date||e instanceof Date)return r instanceof Date&&e instanceof Date&&r.getTime()===e.getTime();if(r instanceof Array||e instanceof Array)return r instanceof Array&&e instanceof Array&&r.length===e.length&&r.every((i,s)=>Dn(r[s],e[s]));if(xt(r)||xt(e)){if(!xt(r)||!xt(e)||r.byteLength===e.byteLength)return!1;const i=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength),s=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((o,a)=>s[a]===o)}const t=Object.keys(r),n=Object.keys(e);return t.length===n.length&&t.every(i=>n.includes(i))&&t.every(i=>Dn(r[i],e[i]))}return!1}class go{constructor(e,t,n){this.added=e,this.removed=t,this.changed=n}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(n=>n.key===e);return t?t.change:"identical"}}function oi(r,e,t=!1){const n=[void 0,null];if(r===e)return"identical";if(n.indexOf(r)>=0&&n.indexOf(e)<0)return"added";if(n.indexOf(r)<0&&n.indexOf(e)>=0)return"removed";if(typeof r!=typeof e)return"changed";if(xt(r)||xt(e)){if(!xt(r)||!xt(e))return"changed";const i=r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength),s=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===s.byteLength&&i.every((o,a)=>s[a]===o)?"identical":"changed"}else{if(r instanceof Date||e instanceof Date)return r instanceof Date&&e instanceof Date&&r.getTime()===e.getTime()?"identical":"changed";if(r instanceof pe||e instanceof pe)return r instanceof pe&&e instanceof pe&&r.path===e.path?"identical":"changed";if(typeof r=="object"){const i=r instanceof Array,s=f=>{let y=Object.keys(f).filter(d=>!n.includes(f[d]));return i&&(y=y.map(d=>parseInt(d))),y},o=s(r),a=s(e),c=o.filter(f=>!a.includes(f)),u=a.filter(f=>!o.includes(f)),l=a.reduce((f,y)=>{if(o.includes(y)){const d=r[y],p=e[y],g=oi(d,p);g!=="identical"&&f.push({key:y,change:g})}return f},[]);return u.length===0&&c.length===0&&l.length===0?"identical":new go(u,c,t?l.sort((f,y)=>f.key<y.key?-1:1):l)}}return"changed"}function vo(r,e,t=!1){const n=(s,o,a,c)=>{switch(o){case"identical":return[];case"changed":return[{target:s,prev:a,val:c}];case"added":return[{target:s,prev:null,val:c}];case"removed":return[{target:s,prev:a,val:null}];default:{let u=[];return o.added.forEach(l=>u.push({target:s.concat(l),prev:null,val:c[l]})),o.removed.forEach(l=>u.push({target:s.concat(l),prev:a[l],val:null})),o.changed.forEach(l=>{const f=n(s.concat(l.key),l.change,a[l.key],c[l.key]);u=u.concat(f)}),u}}},i=oi(r,e,t);return n([],i,r,e)}function wl(r,e,t){return e=e===null?null:e[r],typeof e=="undefined"&&(e=null),t=t===null?null:t[r],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function bl(r){He.nextTick(r)}function wo(){var r;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(r=function(){return this}())!=null?r:Function("return this")()}const bo=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:dl,bytesToNumber:pl,bigintToBytes:yl,bytesToBigint:ml,encodeString:gl,decodeString:mo,concatTypedArrays:vl,cloneObject:Ze,valuesAreEqual:Dn,ObjectDifferences:go,compareValues:oi,getMutations:vo,getChildValues:wl,defer:bl,getGlobalObject:wo},Symbol.toStringTag,{value:"Module"})),xl="modulepreload",El=function(r){return"/"+r},fs={},kl=function(e,t,n){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=El(s),s in fs)return;fs[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!n)for(let l=i.length-1;l>=0;l--){const f=i[l];if(f.href===s&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":xl,o||(u.as="script",u.crossOrigin=""),u.href=s,document.head.appendChild(u),o)return new Promise((l,f)=>{u.addEventListener("load",l),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};let xo=!1,Et;C(void 0,null,function*(){const r=wo();if(typeof r.Observable!="undefined"){Et=r.Observable;return}try{const{Observable:e}=yield kl(()=>Promise.resolve().then(()=>xp),void 0);Et=e}catch(e){Et=ci}});function ai(){if(Et===ci&&!xo&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),Et)return Et;throw new Error("RxJS Observable could not be loaded. ")}function Al(r){r==="shim"?(Et=ci,xo=!0):Et=r}class ci{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const s={next:o=>{this._subscribers.forEach(a=>{try{a(o)}catch(c){console.error("Error in subscriber callback:",c)}})}};this._cleanup=this._create(s),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class Ke extends Array{static areEqual(e,t){return e.length===t.length&&e.every((n,i)=>t[i]===n)}static isAncestor(e,t){return e.length<t.length&&e.every((n,i)=>t[i]===n)}static isDescendant(e,t){return e.length>t.length&&t.every((n,i)=>e[i]===n)}}const St=Symbol("isProxy");class Sl{static create(e,t){return C(this,null,function*(){var h;e=new et(e.db,e.path);let n,i=!1,s=t==null?void 0:t.cursor,o;const a=Re.generate(),c=[],u=new Wt;u.on("cursor",m=>s=m),u.on("error",m=>{console.error(m.message,m.details)});const l=(m,v)=>{if(m.length===0)return n=v,!0;let b=n;const k=m.slice();for(;k.length>1;){const _=k.shift();if(!(_ in b))return!1;b=b[_]}const T=k.shift();return v===null?b instanceof Array?b.splice(T,1):delete b[T]:b[T]=v,!0},f=()=>C(this,null,function*(){!i||(yield A())}),y=e.on("mutations",{syncFallback:f}).subscribe(m=>C(this,null,function*(){var _;if(!i)return;const v=m.context(),b=((_=v.acebase_proxy)==null?void 0:_.id)!==a;if(!b)return;m.val(!1).every(R=>{if(!l(R.target,R.val))return!1;const I=R.target.reduce((U,K)=>U.child(K),e),O=new de(I,R.val,!1,R.prev,m.context());return u.emit("mutation",{snapshot:O,isRemote:b}),!0})?(u.emit("cursor",v.acebase_cursor),Z.emit("mutations",{origin:"remote",snap:m})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield A())}));let d=Promise.resolve();const p=[],g=[],S=()=>C(this,null,function*(){const m=[];for(let v=0,b=p[0];v<p.length;v++,b=p[v])g.find(k=>Ke.areEqual(k.target,b.target)||Ke.isAncestor(k.target,b.target))||(p.splice(v,1),v--,m.push(b));m.length!==0&&(m.forEach(v=>{v.value=Ze(We(n,v.target))}),He.nextTick(()=>{const v={acebase_proxy:{id:a,source:"update"}};m.forEach(k=>{const T=k.target.reduce((R,I)=>R.child(I),e),_=new de(T,k.value,!1,k.previous,v);u.emit("mutation",{snapshot:_,isRemote:!1})});const b=new Pn(e,m.map(k=>({target:k.target,val:k.value,prev:k.previous})),v);Z.emit("mutations",{origin:"local",snap:b})}),d=m.reduce((v,b,k,T)=>(T.some(_=>Ke.isAncestor(_.target,b.target))||v.push(b),v),[]).reduce((v,b)=>{const k=b.target;if(k.length===0)v.push({ref:e,target:k,value:n,type:"set",previous:b.previous});else{const T=k.slice(0,-1),_=k.slice(-1)[0],R=T.reduce((K,q)=>K.child(q),e),I=v.find(K=>K.ref.path===R.path),O=We(n,k),U=b.previous;I?(I.value[_]=O,I.previous[_]=U):v.push({ref:R,target:T,value:{[_]:O},type:"update",previous:{[_]:U}})}return v},[]).reduce((v,b)=>C(this,null,function*(){const k={acebase_proxy:{id:a,source:b.type}};yield v,yield b.ref.context(k)[b.type](b.value).catch(T=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:T});const _={acebase_proxy:{id:a,source:"update-rollback"}},R=[];if(b.type==="set"){wr(n,b.target,b.previous);const O=new de(b.ref,b.previous,!1,b.value,_);u.emit("mutation",{snapshot:O,isRemote:!1}),R.push({target:b.target,val:b.previous,prev:b.value})}else Object.keys(b.previous).forEach(O=>{wr(n,b.target.concat(O),b.previous[O]);const U=new de(b.ref.child(O),b.previous[O],!1,b.value[O],_);u.emit("mutation",{snapshot:U,isRemote:!1}),R.push({target:b.target.concat(O),val:b.previous[O],prev:b.value[O]})});R.forEach(O=>{const U=O.target.reduce((q,G)=>q.child(G),e),K=new de(U,O.val,!1,O.prev,_);u.emit("mutation",{snapshot:K,isRemote:!1})});const I=new Pn(b.ref,R,_);Z.emit("mutations",{origin:"local",snap:I})}),b.ref.cursor&&u.emit("cursor",b.ref.cursor)}),d),yield d)});let P=!1;const L=[],j=()=>{let m;const v=new Promise(b=>m=b);return L.push({resolve:m}),v};let D=null;const W=()=>{D||(D=setTimeout(()=>C(this,null,function*(){P=!0,D=null,yield S(),P=!1,L.splice(0).forEach(m=>m.resolve())}),0))},M=m=>{p.find(v=>Ke.areEqual(v.target,m))||p.push({target:m,previous:Ze(We(n,m))}),W()},Z=new Wt,oe=(m,v)=>{const b=_=>_!==null&&typeof _=="object",k=_=>C(this,null,function*(){var Ee;const{snap:R,origin:I}=_,O=R.context(),U=((Ee=O.acebase_proxy)==null?void 0:Ee.id)===a;if(_.origin==="remote"&&U){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const K=R.val(!1).filter(ae=>ae.target.slice(0,m.length).every((ce,ye)=>m[ye]===ce));if(K.length===0)return;let q,G;const H=K.find(ae=>ae.target.length<=m.length);if(H){const ae=m.slice(H.target.length);q=ae.reduce((ce,ye)=>!b(ce)||!(ye in ce)?null:ce[ye],H.val),G=ae.reduce((ce,ye)=>!b(ce)||!(ye in ce)?null:ce[ye],H.prev)}else{const ae=We(n,m);q=Ze(ae),G=Ze(q),K.forEach(ce=>{const ye=ce.target.slice(m.length);for(let se=0,Te=q,ue=G;se<ye.length;se++){const Ce=se+1===ye.length,ke=ye[se];Ce?(Te[ke]=ce.val,Te[ke]===null&&delete Te[ke],ue[ke]=ce.prev,ue[ke]===null&&delete ue[ke]):(Te=Te[ke]=ke in Te?Te[ke]:{},ue=ue[ke]=ke in ue?ue[ke]:{})}})}He.nextTick(()=>{let ae=!0;try{ae=v(Object.freeze(q),Object.freeze(G),!U,O)!==!1}catch(ce){u.emit("error",{source:I==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:ce})}ae===!1&&T()})});Z.on("mutations",k);const T=()=>{Z.off("mutations",k),c.splice(c.findIndex(_=>_.stop===T),1)};return c.push({target:m,stop:T}),{stop:T}},ie=(m,v,b)=>{if(m==="write")return M(v);if(m==="onChange")return oe(v,b.callback);if(m==="subscribe"||m==="observe"){const k=_=>{const R=We(n,v);_.next(R);const I=oe(v,O=>{_.next(O)});return function(){I.stop()}};if(m==="subscribe")return k;const T=ai();return new T(k)}else if(m==="transaction")return g.some(T=>Ke.areEqual(v,T.target)||Ke.isAncestor(v,T.target)||Ke.isDescendant(v,T.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(T=>C(this,null,function*(){p.some(O=>Ke.areEqual(v,O.target)||Ke.isAncestor(v,O.target))&&(P||W(),yield j());const R={target:v,status:"started",transaction:null};g.push(R),R.transaction={get status(){return R.status},get completed(){return R.status!=="started"},get mutations(){return p.filter(O=>Ke.areEqual(R.target,O.target)||Ke.isAncestor(R.target,O.target))},get hasMutations(){return this.mutations.length>0},commit(){return C(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${R.status}')`);R.status="finished",g.splice(g.indexOf(R),1),P&&(yield j()),W(),yield j()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${R.status}')`);R.status="canceled";const O=[];for(let U=0;U<p.length;U++){const K=p[U];(Ke.areEqual(R.target,K.target)||Ke.isAncestor(R.target,K.target))&&(p.splice(U,1),U--,O.push(K))}O.reverse().forEach(U=>{U.target.length===0?n=U.previous:wr(n,U.target,U.previous)}),g.splice(g.indexOf(R),1)}},T(R.transaction)}))},E=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(E.context().acebase_origin!=="cache"&&u.emit("cursor",(h=e.cursor)!=null?h:null),i=!0,n=E.val(),n===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){n=t.defaultValue;const m={acebase_proxy:{id:a,source:"default"}};yield e.context(m).set(n)}o=Eo({root:{ref:e,get cache(){return n}},target:[],id:a,flag:ie});const w=()=>{if(o===null)throw new Error("Proxy was destroyed")},A=()=>C(this,null,function*(){w(),p.splice(0);const m=yield e.get({allow_cache:!1}),v=n,b=m.val();n=b;const k=vo(v,b);if(k.length===0)return;const T=m.context();T.acebase_proxy={id:a,source:"reload"},k.forEach(R=>{const I=Dr(e,R.target),O=new de(I,R.val,R.val===null,R.prev,T);u.emit("mutation",{snapshot:O,isRemote:!0})});const _=new Pn(e,k,T);Z.emit("mutations",{origin:"local",snap:_})});return{destroy(){return C(this,null,function*(){yield d;const m=[y.stop(),...c.map(v=>v.stop())];yield Promise.all(m),["cursor","mutation","error"].forEach(v=>u.off(v)),n=null,o=null})},stop(){this.destroy()},get value(){return w(),o},get hasValue(){return w(),n!==null},set value(m){w(),m!==null&&typeof m=="object"&&m[St]&&(m=m.valueOf()),M([]),n=m},get ref(){return e},get cursor(){return s},reload:A,onMutation(m){w(),u.off("mutation"),u.on("mutation",({snapshot:v,isRemote:b})=>{try{m(v,b)}catch(k){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:k})}})},onError(m){w(),u.off("error"),u.on("error",v=>{try{m(v)}catch(b){console.error(`Error in dataproxy onError callback: ${b.message}`)}})},on(m,v){u.on(m,v)},off(m,v){u.off(m,v)}}})}}function We(r,e){let t=r;for(const n of e)t=typeof t=="object"&&t!==null&&n in t?t[n]:null;return t}function wr(r,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const n=e.slice(0,-1).reduce((s,o)=>s[o],r),i=e.slice(-1)[0];t===null||typeof t=="undefined"?n instanceof Array?n.splice(i,1):delete n[i]:n[i]=t}function Dr(r,e){const t=N.get(r.path).childPath(e);return new et(r.db,t)}function Eo(r){const e=Dr(r.root.ref,r.target),t=[],n={get(s,o,a){if(s=We(r.root.cache,r.target),typeof o=="symbol")if(o.toString()===Symbol.iterator.toString())o="values";else return o.toString()===St.toString()?!0:Reflect.get(s,o,a);if(o==="valueOf")return function(){return s};if(s===null||typeof s!="object")throw new Error(`Cannot read property "${o}" of ${s}. Value of path "/${e.path}" is not an object (anymore)`);s instanceof Array&&typeof o=="string"&&/^[0-9]+$/.test(o)&&(o=parseInt(o));const c=s[o];if(c===null){delete s[o];return}const u=t.find(d=>d.prop===o);if(u){if(u.typeof===typeof c)return u.value;t.splice(t.indexOf(u),1)}const l=d=>{const p=s[d],g=t.find(P=>P.prop===d);if(g){if(g.typeof===typeof p)return g.value;t.splice(t.indexOf(g),1)}if(typeof p!="object")return p;const S=Eo({root:r.root,target:r.target.concat(d),id:r.id,flag:r.flag});return t.push({typeof:typeof p,prop:d,value:S}),S},f=d=>d!==null&&typeof d=="object"&&d[St]?d.getTarget():d;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof pe||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const y=s instanceof Array;if(o==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return o==="push"?function(p){const g=e.push();return r.flag("write",r.target.concat(g.key)),s[g.key]=p,g.key}:o==="getTarget"?function(d=!0){return d&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),s}:o==="getRef"?function(){return Dr(r.root.ref,r.target)}:o==="forEach"?function(p){const g=Object.keys(s);let S=!1;for(let P=0;!S&&P<g.length;P++){const L=g[P],j=l(L);S=p(j,L,P)===!1}}:["values","entries","keys"].includes(o)?function*(){const p=Object.keys(s);for(const g of p)if(o==="keys")yield g;else{const S=l(g);o==="entries"?yield[g,S]:yield S}}:o==="toArray"?function(p){const g=Object.keys(s).map(S=>l(S));return p&&g.sort(p),g}:o==="onChanged"?function(p){return r.flag("onChange",r.target,{callback:p})}:o==="subscribe"?function(){return r.flag("subscribe",r.target)}:o==="getObservable"?function(){return r.flag("observe",r.target)}:o==="getOrderedCollection"?function(p,g){return new _l(this,p,g)}:o==="startTransaction"?function(){return r.flag("transaction",r.target)}:o==="remove"&&!y?function(){if(r.target.length===0)throw new Error("Can't remove proxy root value");const p=We(r.root.cache,r.target.slice(0,-1)),g=r.target.slice(-1)[0];r.flag("write",r.target),delete p[g]}:void 0;if(typeof c=="function"){if(y){const d=g=>(r.flag("write",r.target),g()),p=g=>g.map(S=>(S=f(S),Ur(S),S));if(o==="push")return function(...S){return S=p(S),d(()=>s.push(...S))};if(o==="pop")return function(){return d(()=>s.pop())};if(o==="splice")return function(S,P,...L){return L=p(L),d(()=>s.splice(S,P,...L))};if(o==="shift")return function(){return d(()=>s.shift())};if(o==="unshift")return function(...S){return S=p(S),d(()=>s.unshift(...S))};if(o==="sort")return function(S){return d(()=>s.sort(S))};if(o==="reverse")return function(){return d(()=>s.reverse())};if(["indexOf","lastIndexOf"].includes(o))return function(S,P){return S!==null&&typeof S=="object"&&S[St]&&(S=S.getTarget(!1)),s[o](S,P)};if(["forEach","every","some","filter","map"].includes(o))return function(S){return s[o]((P,L)=>S(l(L),L,i))};if(["reduce","reduceRight"].includes(o))return function(S,P){return s[o]((L,j,D)=>S(L,l(D),D,i),P)};if(["find","findIndex"].includes(o))return function(S){let P=s[o]((L,j)=>S(l(j),j,i));if(o==="find"&&P){const L=s.indexOf(P);P=l(L)}return P};if(["values","entries","keys"].includes(o))return function*(){for(let S=0;S<s.length;S++)if(o==="keys")yield S;else{const P=l(S);o==="entries"?yield[S,P]:yield P}}}return c}return l(o)},set(s,o,a,c){if(s=We(r.root.cache,r.target),typeof o=="symbol")return Reflect.set(s,o,a,c);if(s===null||typeof s!="object")throw new Error(`Cannot set property "${o}" of ${s}. Value of path "/${e.path}" is not an object`);if(s instanceof Array&&typeof o=="string"){if(!/^[0-9]+$/.test(o))throw new Error(`Cannot set property "${o}" on array value of path "/${e.path}"`);o=parseInt(o)}return a!==null&&(typeof a=="object"&&(a[St]&&(a=a.valueOf()),a=Ze(a)),Dn(a,s[o]))||(r.target.some(u=>typeof u=="number")?r.flag("write",r.target.slice(0,r.target.findIndex(u=>typeof u=="number"))):s instanceof Array?r.flag("write",r.target):r.flag("write",r.target.concat(o)),a===null?delete s[o]:(Ur(a),s[o]=a)),!0},deleteProperty(s,o){if(s=We(r.root.cache,r.target),s===null)throw new Error(`Cannot delete property ${o.toString()} of null`);return typeof o=="symbol"?Reflect.deleteProperty(s,o):(o in s&&(r.flag("write",r.target.concat(o)),delete s[o]),!0)},ownKeys(s){return s=We(r.root.cache,r.target),Reflect.ownKeys(s)},has(s,o){return s=We(r.root.cache,r.target),Reflect.has(s,o)},getOwnPropertyDescriptor(s,o){s=We(r.root.cache,r.target);const a=Reflect.getOwnPropertyDescriptor(s,o);return a&&(a.configurable=!0),a},getPrototypeOf(s){return s=We(r.root.cache,r.target),Reflect.getPrototypeOf(s)}},i=new Proxy({},n);return i}function Ur(r){typeof r=="object"&&Object.keys(r).forEach(e=>{const t=r[e];t===null||typeof t=="undefined"?delete r[e]:typeof t=="object"&&Ur(t)})}function In(r){if(typeof r!="object"||!r[St])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return r}class _l{constructor(e,t="order",n=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=n,typeof e!="object"||!e[St])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(s=>typeof e[s]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(s=>typeof e[s][t]=="number")){const s=Object.keys(e);for(let o=0;o<s.length;o++){const a=e[s[o]];a[t]=o*n}}}getObservable(){return In(this.collection).getObservable()}getArrayObservable(){const e=ai();return new e(t=>{const n=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){n.unsubscribe()}})}getArray(){return In(this.collection).toArray((t,n)=>t[this.orderProperty]-n[this.orderProperty])}add(e,t,n){const i=this.getArray();let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let u=0;u<i.length;u++){const l=i[u][this.orderProperty];s=Math.min(l,s),o=Math.max(l,o)}let a;if(typeof n=="number"){if(a=Object.keys(this.collection).find(u=>this.collection[u]===e),!a)throw new Error("item not found in collection");if(n===t)return{key:a,index:t};if(Math.abs(n-t)===1){const u=i[t],l=u[this.orderProperty];return u[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=l,{key:a,index:t}}else i.splice(n,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:o+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:s-this.orderIncrement;else{const u=i.map(f=>f[this.orderProperty]),l=u[t]-u[t-1];if(l>1)e[this.orderProperty]=u[t]-Math.floor(l/2);else{i.splice(t,0,e);for(let f=0;f<i.length;f++)i[f][this.orderProperty]=f*this.orderIncrement}}return{key:typeof a=="string"?a:In(this.collection).push(e),index:t}}delete(e){const n=this.getArray()[e];if(!n)throw new Error(`Item at index ${e} not found`);const i=Object.keys(this.collection).find(s=>this.collection[s]===n);if(!i)throw new Error("Cannot find target object to delete");return this.collection[i]=null,{key:i,index:e}}move(e,t){const n=this.getArray();return this.add(n[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let n=0;n<t.length;n++)t[n][this.orderProperty]=n*this.orderIncrement}}class ko{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class Tl extends ko{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const Q=Symbol("private");class et{constructor(e,t,n){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const s=N.get(t).key,o=[];this[Q]={get path(){return t},get key(){return s},get callbacks(){return o},vars:n||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const n=this[Q].context;if(typeof e=="object"){const i=e?t?n||{}:e:{};return e&&Object.keys(e).forEach(s=>{i[s]=e[s]}),this[Q].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),n;throw new Error("Invalid context argument")}}get cursor(){return this[Q].cursor}set cursor(e){var t;this[Q].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[Q].path}get key(){const e=this[Q].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[Q].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=N.fillVariables2(this.path,this.vars),t=N.get(e);return t.parentPath===null?null:new et(this.db,t.parentPath).context(this[Q].context)}get vars(){return this[Q].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=N.fillVariables2(this.path,this.vars),n=N.getChildPath(t,e);return new et(this.db,n).context(this[Q].context)}set(e,t){return C(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:n}=yield this.db.api.set(this.path,e,{context:this[Q].context});if(this.cursor=n,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(n){if(typeof t=="function")try{t(n,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw n}return this})}update(e,t){return C(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:n}=yield this.db.api.update(this.path,e,{context:this[Q].context});this.cursor=n}if(typeof t=="function")try{t(null,this)}catch(n){console.error("Error in onComplete callback:",n)}}catch(n){if(typeof t=="function")try{t(n,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw n}return this})}transaction(e){return C(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const n=s=>{s=this.db.types.deserialize(this.path,s);const o=new de(this,s);let a;try{a=e(o)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,n,{context:this[Q].context});if(this.cursor=i,t)throw t;return this})}on(e,t,n){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const s=new sl(c=>{i=c}),o={event:e,stream:s,userCallback:typeof t=="function"&&t,ourCallback:(c,u,l,f,y)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${u}"`,c);return}const d=this.db.ref(u);d[Q].vars=N.extractVariables(this.path,u);let p;if(e.startsWith("notify_"))p=d.context(y||{});else{const g={previous:this.db.types.deserialize(u,f),current:this.db.types.deserialize(u,l)};if(e==="child_removed")p=new de(d,g.previous,!0,g.previous,y);else if(e==="mutations")p=new Pn(d,g.current,y);else{const S=e==="mutated"&&g.current===null;p=new de(d,g.current,S,g.previous,y)}}i.publish(p),y!=null&&y.acebase_cursor&&(this.cursor=y.acebase_cursor)}};this[Q].callbacks.push(o);const a=()=>{typeof t=="function"&&s.subscribe(t,(y,d)=>{y||n&&n(d)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const u=y=>{const d=this[Q].callbacks;d.splice(d.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${y.message}`),i.cancel(y.message)},l=this.db.api.subscribe(this.path,e,o.ourCallback,{newOnly:c.newOnly,cancelCallback:u,syncFallback:c.syncFallback}),f=()=>{const y=this[Q].callbacks;return y.splice(y.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback)};if(l instanceof Promise?l.then(()=>{i.start(f)}).catch(u):i.start(f),!c.newOnly){if(e==="value")this.get(y=>{i.publish(y)});else if(e==="child_added")this.get(y=>{const d=y.val();d===null||typeof d!="object"||Object.keys(d).forEach(p=>{const g=new de(this.child(p),d[p]);i.publish(g)})});else if(e==="notify_child_added"){let p=0;const g=()=>C(this,null,function*(){const S=yield this.db.api.reflect(this.path,"children",{limit:100,skip:p});S.list.forEach(P=>{const L=this.child(P.key);i.publish(L)}),S.more&&(p+=100,g())});g()}}};return this.db.isReady?a():this.db.ready(a),s}off(e,t){const i=this[Q].callbacks.filter(s=>(!e||s.event===e)&&(!t||s.userCallback===t));return i.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),i.forEach(s=>{s.stream.stop()}),this}get(e,t){if(!this.db.isReady){const s=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const s=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw s;return Promise.reject(s)}const n=new ko(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,n).then(s=>{var u;"context"in s&&"value"in s||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),s={value:s,context:{}});const a=this.db.types.deserialize(this.path,s.value),c=new de(this,a,void 0,void 0,s.context);return(u=s.context)!=null&&u.acebase_cursor&&(this.cursor=s.context.acebase_cursor),c});if(t){i.then(t).catch(s=>{console.error("Uncaught error:",s)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(n=>{const i=s=>{this.off(e,i),n(s)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const s=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw s;return Promise.reject(s)}const n=Re.generate(),i=this.child(n);return i[Q].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return C(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return C(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new Ao(this)}count(){return C(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return C(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(n){return C(this,arguments,function*(e,t={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof e=="function"?e:e.write.bind(e);return this.db.api.export(this.path,i,t)})}import(n){return C(this,arguments,function*(e,t={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,e,t)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),Sl.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=ai();return new t(n=>{let i,s=!1,o=this.get(e).then(c=>{s=!0,i=c.val(),n.next(i)});const a=c=>{if(!s){o=o.then(()=>a(c));return}const u=c.ref.path;if(u===this.path)return i=c.val(),n.next(i);const l=N.getPathKeys(u).slice(N.getPathKeys(this.path).length);let f=i;for(;l.length>1;){const p=l.shift();p in f||(f[p]=typeof l[0]=="number"?[]:{}),f=f[p]}const y=l.shift(),d=c.val();d===null?f instanceof Array&&typeof y=="number"?f.splice(y,1):delete f[y]:f[y]=d,n.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return C(this,null,function*(){let n;if(typeof e=="function"?t=e:n=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),s={canceled:!1,total:i.list.length,processed:0};for(let o=0;o<i.list.length;o++){const a=i.list[o].key,c=yield this.child(a).get(n);if(s.processed++,!c.exists())continue;if((yield t(c))===!1){s.canceled=!0;break}}return s})}getMutations(e){return C(this,null,function*(){const t=typeof e=="string"?e:void 0,n=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:n})})}getChanges(e){return C(this,null,function*(){const t=typeof e=="string"?e:void 0,n=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:n})})}}class Ao{constructor(e){this.ref=e,this[Q]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,n){if((t==="in"||t==="!in")&&(!(n instanceof Array)||n.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(n instanceof Array)||n.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(n instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[Q].filters.push({key:e,op:t,compare:n}),this}where(e,t,n){return this.filter(e,t,n)}take(e){return this[Q].take=e,this}skip(e){return this[Q].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[Q].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const s=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const n=new Tl(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});n.allow_cache=n.cache_mode!=="bypass",n.eventHandler=s=>{if(!this[Q].events[s.name])return!1;const o=this[Q].events[s.name];if(typeof o!="object"||o.length===0)return!1;if(["add","change","remove"].includes(s.name)){const a={name:s.name,ref:new et(this.ref.db,s.path)};if(n.snapshots&&s.name!=="remove"){const c=i.types.deserialize(s.path,s.value);a.snapshot=new de(a.ref,c,!1)}s=a}o.forEach(a=>{var c,u;try{a(s)}catch(l){this.ref.db.debug.error(`Error executing "${s.name}" event handler of realtime query on path "${this.ref.path}": ${(u=(c=l==null?void 0:l.stack)!=null?c:l==null?void 0:l.message)!=null?u:l}`)}})},n.monitor={add:!1,change:!1,remove:!1},this[Q].events&&(this[Q].events.add&&this[Q].events.add.length>0&&(n.monitor.add=!0),this[Q].events.change&&this[Q].events.change.length>0&&(n.monitor.change=!0),this[Q].events.remove&&this[Q].events.remove.length>0&&(n.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[Q],n).catch(s=>{throw new Error(s)}).then(s=>{const{stop:o}=s;let{results:a,context:c}=s;if(this.stop=()=>C(this,null,function*(){yield o()}),"results"in s&&"context"in s||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=s,c={}),n.snapshots){const u=a.map(l=>{const f=i.types.deserialize(l.path,l.val);return new de(i.ref(l.path),f,!1,void 0,c)});return Xn.from(u)}else{const u=a.map(l=>i.ref(l));return ui.from(u)}}).then(s=>(t&&t(s),s))}stop(){return C(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return C(this,null,function*(){return(yield this.find()).length})}exists(){return C(this,null,function*(){const e=this[Q].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return C(this,null,function*(){const t=yield this.find(),n=t.reduce((a,c)=>{const u=a[c.parent.path];return u?u.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,s=Object.keys(n).map(a=>C(this,null,function*(){const c=t.reduce((l,f)=>(l[f.key]=null,l),{}),u=i.ref(a);try{return yield u.update(c),{ref:u,success:!0}}catch(l){return{ref:u,success:!1,error:l}}})),o=yield Promise.all(s);return e&&e(o),o})}on(e,t){return this[Q].events[e]||(this[Q].events[e]=[]),this[Q].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[Q].events={},this;if(!this[Q].events[e])return this;if(typeof t=="undefined")return delete this[Q].events[e],this;const n=this[Q].events[e].indexOf(t);return~n?(this[Q].events[e].splice(n,1),this):this}forEach(e,t){return C(this,null,function*(){let n;if(typeof e=="function"?t=e:n=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),s={canceled:!1,total:i.length,processed:0};for(let o=0;o<i.length;o++){const c=yield i[o].get(n);if(s.processed++,!c.exists())continue;if((yield t(c))===!1){s.canceled=!0;break}}return s})}}class Xn extends Array{static from(e){const t=new Xn(e.length);return e.forEach((n,i)=>t[i]=n),t}getValues(){return this.map(e=>e.val())}}class ui extends Array{static from(e){const t=new ui(e.length);return e.forEach((n,i)=>t[i]=n),t}getPaths(){return this.map(e=>e.path)}}function Ol(r,e){e=e.replace(/^\/|\/$/g,"");const t=N.getPathKeys(e),n=Object.keys(r).find(s=>{const o=N.getPathKeys(s);return o.length!==t.length?!1:o.every((a,c)=>a==="*"||typeof a=="string"&&a[0]==="$"?!0:a===t[c])});return r[n]}function Pl(r,e){const t=N.get(e).parentPath;if(t!==null)return Ol(r,t)}function Il(r,e){e=e.replace(/^\/|\/$/g,"");const n=N.get(e).parentPath,i=n?N.getPathKeys(n):[];return Object.keys(r).reduce((o,a)=>{const c=N.getPathKeys(a);if(c.length<i.length)return o;let u=!0;if(i.length===0&&n!==null?u=c.length===1&&(c[0]==="*"||typeof c[0]=="string"&&c[0][0]==="$"):c.every((l,f)=>f>=i.length?!1:l==="*"||typeof l=="string"&&l[0]==="$"||l===i[f]?!0:(u=!1,!1)),u){const l=r[a];o.push({path:a,type:l})}return o},[])}function hs(r,e,t,n,i){if(n===null||typeof n!="object")return n;const s=N.getPathKeys(t),o=Il(e,t),a=[];return o.sort((c,u)=>N.getPathKeys(c.path).length>N.getPathKeys(u.path).length?-1:1),o.forEach(c=>{const u=N.getPathKeys(c.path);u.push("*");const l=u.slice(s.length);if(l.length===0){const y=N.extractVariables(c.path,t),d=new et(r,t,y);if(i==="serialize")n=c.type.serialize(n,d);else if(i==="deserialize"){const p=new de(d,n);n=c.type.deserialize(p)}return}const f=(y,d,p)=>{if(n===null||typeof n!="object")return n;const g=p[0];let S=[];if(g==="*"||typeof g=="string"&&g[0]==="$")d instanceof Array?S=d.map((P,L)=>({key:L,val:P})):S=Object.keys(d).map(P=>({key:P,val:d[P]}));else{const P=d[g];typeof P=="object"&&S.push({key:g,val:P})}S.forEach(P=>{const L=N.getChildPath(y,P.key),j=N.extractVariables(c.path,L),D=new et(r,L,j);if(p.length===1){if(i==="serialize")a.push({parent:d,key:P.key,original:d[P.key]}),d[P.key]=c.type.serialize(P.val,D);else if(i==="deserialize"){const W=new de(D,P.val);d[P.key]=c.type.deserialize(W)}}else f(L,P.val,p.slice(1))})};f(t,n,l)}),i==="serialize"&&(n=Ze(n),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),n}const Lt=Symbol("mappings");class So{constructor(e){this.db=e,this[Lt]={}}get mappings(){return this[Lt]}map(e){return Pl(this[Lt],e)}bind(e,t,n={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof n.serializer!="undefined"){if(typeof n.serializer=="string")if(typeof t.prototype[n.serializer]=="function")n.serializer=t.prototype[n.serializer];else throw new TypeError(`${t.name}.prototype.${n.serializer} is not a function, cannot use it as serializer`);else if(typeof n.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof n.creator=="undefined")typeof t.create=="function"&&(n.creator=t.create);else if(typeof n.creator=="string")if(typeof t[n.creator]=="function")n.creator=t[n.creator];else throw new TypeError(`${t.name}.${n.creator} is not a function, cannot use it as creator`);else if(typeof n.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[Lt][e]={db:this.db,type:t,creator:n.creator,serializer:n.serializer,deserialize(i){let s;return this.creator?s=this.creator.call(this.type,i):s=new this.type(i),s},serialize(i,s){return this.serializer?i=this.serializer.call(i,s,i):i&&typeof i.serialize=="function"&&(i=i.serialize(s,i)),i}}}serialize(e,t){return hs(this.db,this[Lt],e,t,"serialize")}deserialize(e,t){return hs(this.db,this[Lt],e,t,"deserialize")}}const gn=()=>{};class _o{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):gn,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):gn,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):gn,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):gn,this.write=n=>{const i=typeof He!="undefined"&&He.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";n&&i?n.split(`
`).forEach(s=>console.log(s)):console.log(n)}}}const ds={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},ps={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},ys={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},vn={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var Se;(function(r){r.reset="reset",r.bold="bold",r.dim="dim",r.italic="italic",r.underline="underline",r.inverse="inverse",r.hidden="hidden",r.strikethrough="strikethrough",r.black="black",r.red="red",r.green="green",r.yellow="yellow",r.blue="blue",r.magenta="magenta",r.cyan="cyan",r.grey="grey",r.bgBlack="bgBlack",r.bgRed="bgRed",r.bgGreen="bgGreen",r.bgYellow="bgYellow",r.bgBlue="bgBlue",r.bgMagenta="bgMagenta",r.bgCyan="bgCyan",r.bgWhite="bgWhite",r.bgGrey="bgGrey"})(Se||(Se={}));function To(){if(typeof He=="undefined"||!He.stdout||!He.env||!He.platform||He.platform==="browser")return!1;if(He.platform==="win32")return!0;const r=He.env;return r.COLORTERM?!0:r.TERM==="dumb"?!1:r.CI||r.TEAMCITY_VERSION?!!r.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(r.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(r.TERM))}let Oo=To();function Rl(r){Oo=To()&&r}function Cl(r,e){if(!Oo)return r;const t=[],n=[],i=a=>{a===Se.reset?t.push(vn.all):a in ds?(t.push(ds[a]),n.push(vn[a])):a in ps?(t.push(ps[a]),n.push(vn.color)):a in ys&&(t.push(ys[a]),n.push(vn.background))};e instanceof Array?e.forEach(i):i(e);const s=t.map(a=>"\x1B["+a+"m").join(""),o=n.map(a=>"\x1B["+a+"m").join("");return r.split(`
`).map(a=>s+a+o).join(`
`)}String.prototype.colorize=function(r){return Cl(this,r)};class Po{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class Nl extends Wt{constructor(e,t={}){super(),this._ready=!1,t=new Po(t),this.name=e,this.debug=new _o(t.logLevel,`[${e}]`),Rl(t.logColors);const n=[Se.magenta,Se.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,s=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(n)),s&&this.debug.write(s.colorize(Se.magenta))),this.types=new So(this),this.once("ready",()=>{this._ready=!0})}ready(e){return C(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){Al(e)}ref(e){return new et(this,e)}get root(){return this.ref("")}query(e){const t=new et(this,e);return new Ao(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,n)=>this.api.createIndex(e,t,n),delete:e=>C(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,n=!1)=>this.api.setSchema(e,t,n),all:()=>this.api.getSchemas(),check:(e,t,n)=>this.api.validateSchema(e,t,n)}}}class me extends Error{constructor(e){super(`${e} is not implemented`)}}class $l extends Wt{constructor(){super()}stats(e){throw new me("stats")}subscribe(e,t,n,i){throw new me("subscribe")}unsubscribe(e,t,n){throw new me("unsubscribe")}update(e,t,n){throw new me("update")}set(e,t,n){throw new me("set")}get(e,t){throw new me("get")}transaction(e,t,n){throw new me("transaction")}exists(e){throw new me("exists")}query(e,t,n){throw new me("query")}reflect(e,t,n){throw new me("reflect")}export(e,t,n){throw new me("export")}import(e,t,n){throw new me("import")}createIndex(e,t,n){throw new me("createIndex")}getIndexes(){throw new me("getIndexes")}deleteIndex(e){throw new me("deleteIndex")}setSchema(e,t,n){throw new me("setSchema")}getSchema(e){throw new me("getSchema")}getSchemas(){throw new me("getSchemas")}validateSchema(e,t,n){throw new me("validateSchema")}getMutations(e){throw new me("getMutations")}getChanges(e){throw new me("getChanges")}}function ms(r,e,t){const n=[0,0,0,0,0];for(let i=0;i<e;i+=4){let s=((r[i]*256+r[i+1])*256+r[i+2])*256+r[i+3];if(!s)t.push("z");else{for(let o=0;o<5;n[o++]=s%85+33,s=Math.floor(s/85));t.push(String.fromCharCode(n[4],n[3],n[2],n[1],n[0]))}}}function jl(r){const e=r,t=[],n=e.length%4,i=e.length-n;if(ms(e,i,t),n){const o=new Uint8Array(4);o.set(e.slice(i),0),ms(o,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,n+1))}let s=t.join("");return s="<~"+s+"~>",s}const ut={encode:function(r){return r instanceof ArrayBuffer&&(r=new Uint8Array(r,0,r.byteLength)),jl(r)},decode:function(r){if(!r.startsWith("<~")||!r.endsWith("~>"))throw new Error("Invalid input string");r=r.substr(2,r.length-4);const e=r.length,t=[],n=[0,0,0,0,0];let i,s,o,a;for(let u=0;u<e;++u){if(r.charAt(u)=="z"){t.push(0,0,0,0);continue}for(let l=0;l<5;++l)n[l]=r.charCodeAt(u+l)-33;if(a=e-u,a<5){for(let l=a;l<4;n[++l]=0);n[a]=85}i=(((n[0]*85+n[1])*85+n[2])*85+n[3])*85+n[4],s=i&255,i>>>=8,o=i&255,i>>>=8,t.push(i>>>8,i&255,o,s);for(let l=a;l<5;++l,t.pop());u+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},Bl=r=>{if(r.map===null||typeof r.map=="undefined"){if(typeof r.val=="undefined")throw new Error("serialized value must have a val property");return r.val}const e=(t,n)=>t==="date"?new Date(n):t==="binary"?ut.decode(n):t==="reference"?new pe(n):t==="regexp"?new RegExp(n.pattern,n.flags):t==="array"?new Ln(n):t==="bigint"?BigInt(n):n;return typeof r.map=="string"?e(r.map,r.val):(Object.keys(r.map).forEach(t=>{const n=r.map[t],i=N.getPathKeys(t);let s=r,o="val",a=r.val;i.forEach(c=>{o=c,s=a,a=a[o]}),s[o]=e(n,a)}),r.val)},Io=r=>{var i;if(r===null||typeof r!="object"||r instanceof Date||r instanceof ArrayBuffer||r instanceof pe||r instanceof RegExp){const s=Io({value:r});return{map:(i=s.map)==null?void 0:i.value,val:s.val.value}}r=Ze(r);const e=(s,o,a)=>{s instanceof Ln&&(o[a]="array"),Object.keys(s).forEach(c=>{const u=s[c],l=a.length===0?c:`${a}/${c}`;typeof u=="bigint"?(s[c]=u.toString(),o[l]="bigint"):u instanceof Date?(s[c]=u.toISOString(),o[l]="date"):u instanceof ArrayBuffer?(s[c]=ut.encode(u),o[l]="binary"):u instanceof pe?(s[c]=u.path,o[l]="reference"):u instanceof RegExp?(s[c]={pattern:u.source,flags:u.flags},o[l]="regexp"):typeof u=="object"&&u!==null&&e(u,o,l)})},t={};e(r,t,"");const n={val:r};return Object.keys(t).length>0&&(n.map=t),n},gs=r=>r>0?Date.now()+r*1e3:1/0;class Ll{get size(){return this.cache.size}constructor(e){var n;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const t=setInterval(()=>{this.cleanUp()},60*1e3);(n=t.unref)==null||n.call(t)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=gs(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?Ze(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let n=null;const i=Date.now();for(const[s,o]of this.cache.entries()){if(o.expires<=i){this.cache.delete(s),n=null;break}(!n||o.accessed<n.accessed)&&(n={key:s,accessed:o.accessed})}n!==null&&this.cache.delete(n.key)}this.cache.set(e,{value:this.options.cloneValues?Ze(t):t,added:Date.now(),accessed:Date.now(),expires:gs(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,n)=>{t.expires<=e&&this.cache.delete(n)})}}function Dl(r){let e=0;function t(){let a;for(;a=r[e],[" ","\r",`
`,"	"].includes(a);)e++}function n(a){if(r[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${r[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=r[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${r.slice(e,e+10)}..`);return r[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),n(":"),a}function s(){t();let a={typeOf:"any"},c,u="";for(;c=r[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)u+=c,e++;if(u.length===0)if(r[e]==="*")n("*"),a.typeOf="any";else if(["'",'"',"`"].includes(r[e])){a.typeOf="string",a.value="";const l=r[e];for(n(l);c=r[e],c&&c!==l;)a.value+=c,e++;n(l)}else if(r[e]>="0"&&r[e]<="9"){a.typeOf="number";let l="";for(;c=r[e],c==="."||c==="n"||c>="0"&&c<="9";)l+=c,e++;l.endsWith("n")?a.value=BigInt(l):l.includes(".")?a.value=parseFloat(l):a.value=parseInt(l)}else if(r[e]==="{"){for(n("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const l=i(),f=o();if(a.children.push({name:l.name,optional:l.optional,wildcard:l.wildcard,types:f}),t(),(r[e]===";"||r[e]===",")&&(n(r[e]),t()),r[e]==="}")break}n("}")}else if(r[e]==="/"){n("/");let l="",f="";for(;c=r[e],c!=="/"||l.endsWith("\\");)l+=c,e++;for(n("/");c=r[e],["g","i","m","s","u","y","d"].includes(c);)f+=c,e++;a.typeOf="string",a.matches=new RegExp(l,f)}else throw new Error(`Expected a type definition at position ${e}, found character '${r[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(u))a.typeOf=u.toLowerCase();else if(u==="Object"||u==="object")a.typeOf="object",a.instanceOf=Object;else if(u==="Date")a.typeOf="object",a.instanceOf=Date;else if(u==="Binary"||u==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(u==="any")a.typeOf="any";else if(u==="null")a.typeOf="object",a.value=null;else if(u==="Array")n("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=o(),n(">");else if(["true","false"].includes(u))a.typeOf="boolean",a.value=u==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();r[e]==="[";)n("["),n("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function o(){t();const a=[s()];for(;r[e]==="|";)n("|"),a.push(s()),t();return a}return s()}function Ul(r,e,t,n){const i=e.find(f=>f.name==="*"||f.name[0]==="$")?[]:Object.keys(t).filter(f=>![null,void 0].includes(t[f])&&!e.find(y=>y.name===f));if(i.length>0)return{ok:!1,reason:`Object at path "${r}" cannot have propert${i.length===1?"y":"ies"} ${i.map(f=>`"${f}"`).join(", ")}`};function s(f){const y=![null,void 0].includes(t[f.name]);return!f.optional&&(n?t[f.name]===null:!y)?{ok:!1,reason:`Property at path "${r}/${f.name}" is not optional`}:y&&f.types.length===1?Zt(`${r}/${f.name}`,f.types[0],t[f.name],!1):y&&!f.types.some(d=>Zt(`${r}/${f.name}`,d,t[f.name],!1).ok)?{ok:!1,reason:`Property at path "${r}/${f.name}" does not match any of ${f.types.length} allowed types`}:{ok:!0}}const o=e.filter(f=>!f.wildcard),a=o.find(f=>!s(f).ok);if(a)return{ok:!1,reason:s(a).reason};const c=e.find(f=>f.wildcard);if(!c)return{ok:!0};const u=Object.keys(t).filter(f=>!o.find(y=>y.name===f));let l={ok:!0};for(let f=0;f<u.length&&l.ok;f++){const y=u[f];l=s({name:y,types:c.types,optional:!0,wildcard:!0})}return l}function Zt(r,e,t,n,i){const s={ok:!0};if(e.typeOf==="any")return s;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${r}" must be typeof ${e.typeOf}`};if(!e.children)return s;const o=i[0];let a=e.children.find(u=>u.name===o);if(a||(a=e.children.find(u=>u.name==="*"||u.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${r}" cannot have property "${o}"`};if(a.optional&&t===null&&i.length===1)return s;let c;return a.types.some(u=>{const l=typeof o=="number"?`${r}[${o}]`:`${r}/${o}`;return c=Zt(l,u,t,n,i.slice(1)),c.ok}),c}return t===null?s:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${r}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${r}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${r}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${r}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(o=>e.genericTypes.some(a=>Zt(r,a,o,!1).ok))?{ok:!1,reason:`every array value of path "${r}" must match one of the specified types`}:e.typeOf==="object"&&e.children?Ul(r,e.children,t,n):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${r}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:s}function Fl(r){switch(r){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${r.name}`)}}class Ml{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const n=i=>"{"+Object.keys(i).map(s=>{let o=i[s];if(o===void 0)o="undefined";else if(o instanceof RegExp)o=`/${o.source}/${o.flags}`;else if(typeof o=="object")o=n(o);else if(typeof o=="function")o=Fl(o);else if(!["string","number","boolean","bigint"].includes(typeof o))throw new Error(`Type definition for key "${s}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${s}:${o}`}).join(",")+"}";this.text=n(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=Dl(this.text)}check(e,t,n,i){const s=Zt(e,this.type,t,n,i);return!s.ok&&this.handling.warnOnly&&(s.warning=`${n?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${s.reason}`,s.ok=!0,this.handling.warnCallback(s.warning)),s}}class Le{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class br extends Le{}class Fr extends Le{}class vs extends Le{}class Kl extends Le{}class ws extends Le{}class Wl extends Le{}const zl={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},F=zl;function Vl(r){switch(r){case F.ARRAY:return"array";case F.BINARY:return"binary";case F.BOOLEAN:return"boolean";case F.DATETIME:return"date";case F.NUMBER:return"number";case F.OBJECT:return"object";case F.REFERENCE:return"reference";case F.STRING:return"string";case F.BIGINT:return"bigint"}}class Ro{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=N.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return Vl(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function je(r,e){if(!r)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const Hl=120,Be={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class Co{constructor(e,t=Hl){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Re.generate()}_allowLock(e,t,n){const i=this._locks.find(s=>s.tid!==t&&s.state===Be.LOCKED&&(n||s.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(n){console.error("Unhandled promise rejection:",n)}}_processLockQueue(){if(this._quit){const t=new Error("Quitting");this._locks.filter(n=>n.state===Be.PENDING).forEach(n=>this._rejectLock(n,t)),this._locks.length===0&&this._quit()}this._locks.filter(t=>t.state===Be.PENDING).sort((t,n)=>t.priority&&!n.priority?-1:!t.priority&&n.priority?1:t.requested-n.requested).forEach(t=>{const n=this._allowLock(t.path,t.tid,t.forWriting);t.waitingFor=n.conflict||null,n.allow&&this.lock(t).then(t.resolve).catch(i=>this._rejectLock(t,i))})}lock(o,a){return C(this,arguments,function*(e,t,n=!0,i="",s={withPriority:!1,noTimeout:!1}){let c,u;if(e instanceof xr)c=e,u=!0;else{if(this._locks.findIndex(l=>l.tid===t&&l.state===Be.EXPIRED)>=0)throw new Error(`lock on tid ${t} has expired, not allowed to continue`);if(this._quit&&!s.withPriority)throw new Error("Quitting");{c=new xr(this,e,t,n,s.withPriority===!0),c.comment=i,this._locks.push(c);const l=this._allowLock(e,t,n);c.waitingFor=l.conflict||null,u=l.allow}}if(u){if(c.state=Be.LOCKED,typeof c.granted!="number"){if(c.granted=Date.now(),s.noTimeout!==!0){c.expires=Date.now()+this.timeout;let l=0;const f=()=>{if(c.state===Be.LOCKED){if(l++,l<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${l}]`),c.timeout=setTimeout(f,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=Be.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(f,this.timeout/4)}}return c}else return je(c.state===Be.PENDING),new Promise((l,f)=>{c.resolve=l,c.reject=f})})}unlock(e,t,n=!0){let i,s;if(e instanceof xr)i=e,s=this._locks.indexOf(i);else{const o=e;s=this._locks.findIndex(a=>a.id===o),i=this._locks[s]}if(s<0){const o=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(o)}return i.state=Be.DONE,clearTimeout(i.timeout),this._locks.splice(s,1),n&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,n){return this._allowLock(e,t,n).allow}}let Jl=0;class xr{static get LOCK_STATE(){return Be}constructor(e,t,n,i,s=!1){this.locker=e,this.path=t,this.tid=n,this.forWriting=i,this.priority=s,this.state=Be.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++Jl,this.history=[]}release(e){return C(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return C(this,null,function*(){const e=N.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const n=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return n.history=this.history,n.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),n}})}}class li extends Error{}class Mr extends Error{}class ql extends Error{constructor(e){super(`Exiting: ${e}`)}}class Yl extends Wt{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,n=e.name){super(),this.storage=e,this.id=t,this.dbname=n,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new Co(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(c=>c.callback===i.callback))return;const o=this.ourSubscriptions.some(c=>c.event===i.event&&c.path===i.path);if(this.ourSubscriptions.push(i),o)return;const a={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(a)}),e.on("unsubscribe",i=>{const s=this.remoteSubscriptions.find(o=>o.callback===i.callback);if(s){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1);return}this.ourSubscriptions.filter(o=>o.path===i.path&&(!i.event||o.event===i.event)&&(!i.callback||o.callback===i.callback)).forEach(o=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(o),1);const a={type:"unsubscribe",from:this.id,data:{path:o.path,event:o.event}};this.sendMessage(a)})})}exit(e=0){return C(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(this._exiting)return;if(this.peers.find(i=>i.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t){const i={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(i),this.ourSubscriptions.forEach(s=>{const o={type:"subscribe",from:this.id,to:e,data:{path:s.path,event:s.event}};this.sendMessage(o)})}}removePeer(e,t=!1){if(this._exiting)return;const n=this.peers.find(s=>s.id===e);if(!n){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(n),1),this.remoteSubscriptions.filter(s=>s.for===e).forEach(s=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1),this.storage.subscriptions.remove(s.path,s.event,s.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const n=(i,s,o,a,c)=>{const u={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:s,val:o,previous:a,context:c}};this.sendMessage(u)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:n}),this.storage.subscriptions.add(t.path,t.event,n)}cancelRemoteSubscription(e,t){const n=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!n||this.storage.subscriptions.remove(t.path,t.event,n.callback)}handleMessage(e){return C(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,n=t.data.context||{};n.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(s=>s.event===t.event&&s.path===t.path).forEach(s=>{s.callback(null,t.data.path,t.data.val,t.data.previous,n)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,n={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);n.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("The request must be known to us!");t.ok?n.resolve(t.data):n.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,n={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(s=>{var o;return((o=s.lock)==null?void 0:o.id)===t.data.id}).lock.release()}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("The request must be known to us!");t.ok?n.resolve(t.data):n.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,n={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const s=this._locks.find(o=>{var a;return((a=o.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield s.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);s.lock=i,n.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("Result of unknown request received");t.ok?n.resolve(t.data):n.reject(new Error(t.reason))}}})}lock(e){return C(this,null,function*(){if(this._exiting&&!this._locks.find(i=>i.tid===e.tid&&i.granted))throw new ql("new transaction lock denied because the IPC peer is exiting");const t=n=>{this._locks.splice(this._locks.indexOf(n),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const n={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(n);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);n.tid=i.tid,n.granted=!0;const s=o=>({get id(){return o.id},get tid(){return o.tid},get path(){return o.path},get forWriting(){return o.forWriting},get expires(){return o.expires},get comment(){return o.comment},get state(){return o.state},release:()=>C(this,null,function*(){yield o.release(),t(n)}),moveToParent:()=>C(this,null,function*(){const a=yield o.moveToParent();return n.lock=s(a),n.lock})});return n.lock=s(i),n.lock}else{const n={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(n);const i=c=>(n.granted=!0,n.tid=c.tid,n.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:Be.LOCKED,expires:c.expires,comment:c.comment,release:()=>C(this,null,function*(){const u={type:"unlock-request",id:Re.generate(),from:this.id,to:this.masterPeerId,data:{id:n.lock.id}};yield this.request(u),n.lock.state=Be.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${n.lock.id} (tid ${n.lock.tid}, ${n.lock.comment}, "/${n.lock.path}", ${n.lock.forWriting?"write":"read"})`),t(n)}),moveToParent:()=>C(this,null,function*(){const u={type:"move-lock-request",id:Re.generate(),from:this.id,to:this.masterPeerId,data:{id:n.lock.id,move_to:"parent"}};let l;try{l=yield this.request(u)}catch(f){throw n.lock.state=Be.DONE,t(n),f}return n.lock=i(l),n.lock})},n.lock),s={type:"lock-request",id:Re.generate(),from:this.id,to:this.masterPeerId,data:e};let o,a;try{o=yield this.request(s)}catch(c){a=c,o=null}if(a)throw t(n),a;return i(o)}})}request(e){return C(this,null,function*(){let t,n;const i=new Promise((s,o)=>{t=a=>{this._requests.delete(e.id),s(a)},n=a=>{this._requests.delete(e.id),o(a)}});return this._requests.set(e.id,{resolve:t,reject:n,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Re.generate(),data:e};return this.request(t).catch(n=>{throw this.storage.debug.error(n),n})}replyRequest(e,t){const n={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(n)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class Gl extends Yl{constructor(e){if(super(e,Re.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const n=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:s=>{const o=Re.generate(),a=`acebase:${e.name}:${this.id}:${o}`,c=JSON.stringify(Io(s));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(s){n[0]=s},set onmessageerror(s){i()},close(){i()},addEventListener(s,o){s!=="message"&&i(),n.push(o)},removeEventListener(s,o){const a=n.indexOf(o);a>=1&&n.splice(a,1)},dispatchEvent(s){return n.forEach(o=>{try{o&&o(s)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",s=>{const[o,a,c,u]=s.key.split(":");if(o!=="acebase"||a!==e.name||c===this.id||s.newValue===null)return;const l=Bl(JSON.parse(s.newValue));this.channel.dispatchEvent({data:l})})}this.channel.addEventListener("message",n=>C(this,null,function*(){const i=n.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const s=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=s.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const o=this._locks.splice(0);yield Promise.all(o.filter(a=>a.granted).map(a=>C(this,null,function*(){let c,u;a.lock.release=()=>new Promise(f=>c=f),a.lock.moveToParent=()=>new Promise(f=>u=f);const l=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(u){const f=yield l.moveToParent();u(f)}c&&(yield l.release(),c())}))),yield Promise.all(o.filter(a=>!a.granted).map(a=>C(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class Dt{static get hasFileSystem(){return!1}static get fs(){return null}}class fi extends Le{}class No extends Le{}class Ql extends Le{}class Xl extends Le{}function Zl(r,e,t,n){return C(this,null,function*(){if(!r.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:s,indexes:o,storage:a}=r,c=n&&n.rebuild===!0,u=n&&n.type||"normal";let l=n&&n.include||[];typeof l=="string"&&(l=[l]);const f=o.find(d=>d.path===e&&d.key===t&&d.type===u&&d.includeKeys.length===l.length&&d.includeKeys.every((p,g)=>l[g]===p));if(f&&n.config&&(f.config=n.config),f&&c!==!0)return s.log(`Index on "/${e}/*/${t}" already exists`.colorize(Se.inverse)),f;if(!i.isMaster){const d=yield i.sendRequest({type:"index.create",path:e,key:t,options:n});if(d.ok)return a.indexes.add(d.fileName);throw new Error(d.reason)}yield Dt.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(d=>{if(d.code!=="EEXIST")throw d});const y=f||(()=>{const{include:d,caseSensitive:p,textLocale:g,textLocaleKey:S}=n,P={include:d,caseSensitive:p,textLocale:g,textLocaleKey:S};switch(u){case"array":return new Xl(a,e,t,$({},P));case"fulltext":return new No(a,e,t,ee($({},P),{config:n.config}));case"geo":return new Ql(a,e,t,$({},P));default:return new fi(a,e,t,$({},P))}})();f||o.push(y);try{yield y.build()}catch(d){throw r.debug.error(`Index build on "/${e}/*/${t}" failed: ${d.message} (code: ${d.code})`.colorize(Se.red)),f||o.splice(o.indexOf(y),1),d}return i.sendNotification({type:"index.created",fileName:y.fileName,path:e,key:t,options:n}),y})}const{compareValues:wn,getChildValues:At,encodeString:bs,defer:ef}=bo,Kr=["value","child_added","child_changed","child_removed","mutated","mutations"];Kr.push(...Kr.map(r=>`notify_${r}`));const tf=()=>{};class nf extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class hi{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class rf extends Wt{createTid(){return Re.generate()}constructor(e,t,n){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return Dt==null?void 0:Dt.hasFileSystem},create:(s,o,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return Zl(c,s,o,a)},get:(s,o=null)=>{if(s.includes("$")){const a=N.getPathKeys(s).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);s=new N(a).path}return this._indexes.filter(a=>a.path===s&&(o===null||o===a.key))},getAll:(s,o={parentPaths:!0,childPaths:!0})=>{const a=N.getPathKeys(s);return this._indexes.filter(c=>{const u=N.getPathKeys(c.path+"/*");return o.parentPaths&&u.every((l,f)=>l==="*"||a[f]===l)&&[c.key].concat(...c.includeKeys).includes(a[u.length])?!0:u.length<a.length||!o.childPaths&&u.length!==a.length?!1:a.every((l,f)=>[l,"*"].includes(u[f]))})},list:()=>this._indexes.slice(),load:()=>C(this,null,function*(){if(this._indexes.splice(0),!Dt.hasFileSystem)return;let s=[];try{s=yield Dt.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const o=[];s.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",u=/^\[[a-z]+\]-/.test(a);if(!c&&!u||c&&a.startsWith(`[${this.settings.type}]-`)){const l=this.indexes.add(a);o.push(l)}}),yield Promise.all(o)}),add:s=>C(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(o)return o;if(this._annoucedIndexes.has(s))return yield this._annoucedIndexes.get(s);try{const a=fi.readFromFile(this,s);this._annoucedIndexes.set(s,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(s),c}catch(a){return this.debug.error(a),null}}),delete:s=>C(this,null,function*(){const o=yield this.indexes.remove(s);yield o.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:o.fileName,path:o.path,keys:o.key})}),remove:s=>C(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(!o)throw new Error(`Index ${s} not found`);return this._indexes.splice(this._indexes.indexOf(o),1),o}),close:()=>C(this,null,function*(){const s=this.indexes.list().map(o=>o.close().catch(a=>this.debug.error(a)));yield Promise.all(s)})},this._eventSubscriptions={},this.subscriptions={add:(s,o,a)=>{if(Kr.indexOf(o)<0)throw new TypeError(`Invalid event type "${o}"`);let c=this._eventSubscriptions[s];c||(c=this._eventSubscriptions[s]=[]),c.push({created:Date.now(),type:o,callback:a}),this.emit("subscribe",{path:s,event:o,callback:a})},remove:(s,o,a)=>{const c=this._eventSubscriptions[s];if(!c)return;const u=()=>c.findIndex(f=>(o?f.type===o:!0)&&(a?f.callback===a:!0));let l;for(;(l=u())>=0;)c.splice(l,1);this.emit("unsubscribe",{path:s,event:o,callback:a})},hasValueSubscribersForPath(s){return!!this.getValueSubscribersForPath(s)},getValueSubscribersForPath:s=>{const o=new N(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.equals(c)||o.isDescendantOf(c)){const u=this._eventSubscriptions[c],l=N.fillVariables(c,s);u.filter(f=>!f.type.startsWith("notify_")).forEach(f=>{let y=null;if(f.type==="value")y=l;else if(["mutated","mutations"].includes(f.type)&&o.isDescendantOf(l))y=s;else if(f.type==="child_changed"&&s!==l){const d=N.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];y=N.getChildPath(l,d)}else if(["child_added","child_removed"].includes(f.type)&&o.isChildOf(l)){const d=N.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];y=N.getChildPath(l,d)}y!==null&&!a.some(d=>d.type===f.type&&d.eventPath===l)&&a.push({type:f.type,eventPath:l,dataPath:y,subscriptionPath:c})})}}),a},getAllSubscribersForPath:s=>{const o=N.get(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.isOnTrailOf(c)){const u=this._eventSubscriptions[c],l=N.fillVariables(c,s);u.forEach(f=>{let y=null;if(f.type==="value"||f.type==="notify_value")y=l;else if(["child_changed","notify_child_changed"].includes(f.type)){const d=s===l||o.isAncestorOf(l)?"*":N.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];y=N.getChildPath(l,d)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(f.type))y=s;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(f.type)&&(o.isChildOf(l)||s===l||o.isAncestorOf(l))){const d=s===l||o.isAncestorOf(l)?"*":N.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];y=N.getChildPath(l,d)}y!==null&&!a.some(d=>d.type===f.type&&d.eventPath===l&&d.subscriptionPath===c)&&a.push({type:f.type,eventPath:l,dataPath:y,subscriptionPath:c})})}}),a},trigger:(s,o,a,c,u,l)=>{(this._eventSubscriptions[o]||[]).filter(y=>y.type===s).forEach(y=>{y.callback(null,a,u,c,l)})}},this.debug=new _o(n.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof Le){const s={ipcName:i,server:t.ipc instanceof Le?t.ipc:null};this.ipc=new Le(this,s)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const s=Object.assign({dbname:i},t.ipc);this.ipc=new Le(this,s)}else this.ipc=new Gl(this,i);this.ipc.once("exit",s=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(s,o,a,c)=>this.ipc.lock({path:s,tid:o,write:a,comment:c})},this._lastTid=0}close(){return C(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:bs(e).length<this.settings.maxInlineValueSize;if(e instanceof pe)return e.path.length>this.settings.maxInlineValueSize?!1:bs(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,n){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let n=e,i=!1;const s=t?[]:this.subscriptions.getAllSubscribersForPath(e),o=t?[]:this.subscriptions.getValueSubscribersForPath(e);o.length>0&&(i=!0,n=o.map(f=>({path:f.dataPath,keys:N.getPathKeys(f.dataPath)})).sort((f,y)=>f.keys.length<y.keys.length?-1:f.keys.length>y.keys.length?1:0)[0].path,o.filter(f=>f.dataPath===n).every(f=>f.type==="mutated"||f.type.startsWith("notify_"))&&(i=!1),n=N.fillVariables(n,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(u=>({index:u,keys:N.getPathKeys(u.path)})).sort((u,l)=>u.keys.length<l.keys.length?-1:u.keys.length>l.keys.length?1:0).map(u=>u.index),c=[];if(a.length>0){a.sort((f,y)=>(typeof f._pathKeys=="undefined"&&(f._pathKeys=N.getPathKeys(f.path)),typeof y._pathKeys=="undefined"&&(y._pathKeys=N.getPathKeys(y.path)),f._pathKeys.length<y._pathKeys.length?-1:f._pathKeys.length>y._pathKeys.length?1:0));const u=a[0],l=u.path===e?e:N.fillVariables(`${u.path}/*`,e);l.length<n.length&&(n=l,a.filter(f=>f.path===u.path).forEach(f=>{[f.key].concat(f.includeKeys).forEach(d=>!c.includes(d)&&c.push(d))}))}return{topEventPath:n,eventSubscriptions:s,valueSubscribers:o,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(i,s){return C(this,arguments,function*(e,t,n={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(n=n||{},!n.tid&&!n.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");n.merge=n.merge===!0;const o=this.validateSchema(e,t,{updates:n.merge});if(!o.ok)throw new nf(o.reason);const a=n.tid,c=n.transaction;let u=null;const l=n.impact?n.impact:this.getUpdateImpact(e,n.suppress_events),{topEventPath:f,eventSubscriptions:y,hasValueSubscribers:d,indexes:p}=l;let{keysFilter:g}=l;const S=()=>{if(typeof n._customWriteFunction=="function")return n._customWriteFunction();if(u){const h=N.getPathKeys(e),x=N.getPathKeys(f),m=h.slice(x.length);let v=u;for(;m.length>0&&v!==null;){const b=m.shift();v=typeof v=="object"&&b in v?v[b]:null}n.currentValue=v}return this._writeNode(e,t,n)},P=this.settings.transactions&&this.settings.transactions.log===!0;if(y.length===0&&p.length===0&&!P)return S();if(!d&&n.merge===!0&&g.length===0&&(g=Object.keys(t),f!==e)){const h=e.slice(f.length);g=g.map(x=>`${h}/${x}`)}const L=yield this.getNodeInfo(f,{transaction:c,tid:a});let j=null;if(L.exists){const h={transaction:c,tid:a};g.length>0&&(h.include=g),f===""&&typeof h.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),j=(yield this.getNode(f,h)).value}u=j;const D=(yield S())||{};let W,M;if(e===f)n.merge?u===null?W=t instanceof Array?[]:{}:(W=u instanceof Array?[]:{},Object.keys(u).forEach(h=>{W[h]=u[h]})):W=t,M=W;else{const h=e.slice(f.length).replace(/^\//,""),x=N.getPathKeys(h);for(u===null?W=typeof x[0]=="number"?[]:{}:(W=u instanceof Array?[]:{},Object.keys(u).forEach(m=>{W[m]=u[m]})),M=W;x.length>0;){const m=x.shift();if(!n.merge&&x.length===0)M[m]=t;else{const v=M[m],b=typeof m=="number"?[...v]:$({},v);M[m]=b}M=M[m]}}n.merge&&Object.keys(t).forEach(h=>{M[h]=t[h]});const Z=wn(u,W);if(Z==="identical")return D.mutations=[],D;function oe(h){if(h===null||typeof h!="object")return h;Object.keys(h).forEach(x=>{const m=h[x];m===null&&(delete h[x],h instanceof Array&&h.length--),typeof m=="object"&&oe(m)})}oe(W);const ie=[];p.map(h=>({index:h,keys:N.getPathKeys(h.path)})).sort((h,x)=>h.keys.length<x.keys.length?1:h.keys.length>x.keys.length?-1:0).forEach(({index:h})=>{const x=N.getPathKeys(f),m=N.getPathKeys(h.path+"/*"),v=m.slice(x.length),b=u,k=W;if(v.length===0){je(x.length===m.length,"check logic");const R=this.ipc.isMaster?h.handleRecordUpdate(f,b,k):this.ipc.sendRequest({type:"index.update",fileName:h.fileName,path:f,oldValue:b,newValue:k});ie.push(R);return}const T=(R,I,O)=>{if(I===null&&O===null)return[];const U=N.getPathKeys(R),K=N.getPathKeys(h.path+"/*"),q=K.slice(U.length);if(q.length===0)return je(U.length===K.length,"check logic"),[{path:R,oldValue:I,newValue:O}];let G=[],H="";for(;q.length>0;){const Ee=q.shift();if(typeof Ee=="string"&&(Ee==="*"||Ee.startsWith("$"))){const ae=I===null?[]:Object.keys(I);O!==null&&Object.keys(O).forEach(ce=>{ae.indexOf(ce)<0&&ae.push(ce)}),ae.forEach(ce=>{const ye=N.getChildPath(H,ce),se=At(ce,I,O),Te=N.getChildPath(R,ye),ue=T(Te,se.oldValue,se.newValue);G=G.concat(ue)});break}else{const ae=At(Ee,I,O);if(I=ae.oldValue,O=ae.newValue,I===null&&O===null)break;H=N.getChildPath(H,Ee)}}return G};T(f,b,k).forEach(R=>{const I=this.ipc.isMaster?h.handleRecordUpdate(R.path,R.oldValue,R.newValue):this.ipc.sendRequest({type:"index.update",fileName:h.fileName,path:R.path,oldValue:R.oldValue,newValue:R.newValue});ie.push(I)})});const E=(h,x,m,v=[])=>{let b=!0,k=h.type;if(k.startsWith("notify_")&&(k=k.slice(7)),k==="mutated"||(k==="child_changed"&&(x===null||m===null)?b=!1:k==="value"||k==="child_changed"?b=wn(x,m)!=="identical":k==="child_added"?b=x===null&&m!==null:k==="child_removed"&&(b=x!==null&&m===null),!b))return;const T=N.getPathKeys(h.dataPath);v.forEach(R=>{const I=T.indexOf(R.name);je(I>=0,`Variable "${R.name}" not found in subscription dataPath "${h.dataPath}"`),T[I]=R.value});const _=T.reduce((R,I)=>N.getChildPath(R,I),"");this.subscriptions.trigger(h.type,h.subscriptionPath,_,x,m,n.context)},w=(h,x,m,v)=>{const b=[],k=v||wn(x,m);return k==="identical"||(typeof k=="string"?b.push({path:h,oldValue:x,newValue:m}):(k.changed.forEach(T=>{const _=N.getChildPath(h,T.key),R=At(T.key,x,m),I=w(_,R.oldValue,R.newValue,T.change);b.push(...I)}),k.added.forEach(T=>{const _=N.getChildPath(h,T);b.push({path:_,oldValue:null,newValue:m[T]})}),x instanceof Array&&m instanceof Array&&k.removed.sort((T,_)=>T<_?1:-1),k.removed.forEach(T=>{const _=N.getChildPath(h,T);b.push({path:_,oldValue:x[T],newValue:null})}))),b};P&&this.settings.type!=="transaction"&&(D.mutations=(()=>{const h=e.slice(f.length).replace(/^\//,""),x=N.getPathKeys(h);let m=u,v=W;for(;x.length>0;){const _=x.shift();({oldValue:m,newValue:v}=At(_,m,v))}const b=wn(m,v);return w(e,m,v,b).map(_=>({target:N.getPathKeys(_.path.slice(e.length)),prev:_.oldValue,val:_.newValue}))})());const A=()=>{y.filter(x=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(x.type)).map(x=>{const m=N.getPathKeys(x.dataPath);return{sub:x,keys:m}}).sort((x,m)=>x.keys.length<m.keys.length?1:x.keys.length>m.keys.length?-1:0).forEach(({sub:x})=>{const m=(v,b,k,T=[])=>{const _=x.dataPath.slice(v.length).replace(/^\//,""),R=N.getPathKeys(_);for(;R.length>0;){const I=R.shift();if(typeof I=="string"&&(I==="*"||I[0]==="$")){const O=b===null?[]:Object.keys(b).map(U=>b instanceof Array?parseInt(U):U);k!==null&&Object.keys(k).forEach(U=>{const K=k instanceof Array?parseInt(U):U;!O.includes(K)&&O.push(U)}),O.forEach(U=>{const K=At(U,b,k),q=T.concat({name:I,value:U});R.length===0?E(x,K.oldValue,K.newValue,q):m(N.getChildPath(v,I),K.oldValue,K.newValue,q)});return}else{v=N.getChildPath(v,I);const O=At(I,b,k);b=O.oldValue,k=O.newValue}}E(x,b,k,T)};if(x.type.startsWith("notify_")&&N.get(x.eventPath).isAncestorOf(f)){const v=N.get(x.eventPath).isParentOf(f);(x.type==="notify_value"||x.type==="notify_child_changed"&&(!v||!["added","removed"].includes(Z))||x.type==="notify_child_removed"&&Z==="removed"&&v||x.type==="notify_child_added"&&Z==="added"&&v)&&this.subscriptions.trigger(x.type,x.subscriptionPath,x.dataPath,null,null,n.context)}else m(f,u,W)}),y.filter(x=>["mutated","mutations","notify_mutated","notify_mutations"].includes(x.type)).forEach(x=>{let m=f;const v=x.eventPath.slice(m.length).replace(/^\//,""),b=N.getPathKeys(v);let k=u,T=W;for(;b.length>0;){const I=b.shift();m=N.getChildPath(m,I);const O=At(I,k,T);k=O.oldValue,T=O.newValue}const _=w(m,k,T);if(_.length===0)return;const R=x.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(x.type))_.forEach((I,O)=>{const U=n.context,K=R?null:I.oldValue,q=R?null:I.newValue;this.subscriptions.trigger(x.type,x.subscriptionPath,I.path,K,q,U)});else if(["mutations","notify_mutations"].includes(x.type)){const I=R?null:_.map(O=>({target:N.getPathKeys(O.path.slice(x.subscriptionPath.length)),prev:O.oldValue,val:O.newValue}));this.subscriptions.trigger(x.type,x.subscriptionPath,x.subscriptionPath,null,I,n.context)}})};return n.waitForIndexUpdates===!1&&ie.splice(0),yield Promise.all(ie),ef(A),D})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(n){return C(this,arguments,function*(e,t={}){return(yield this.getNode(e,t)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,n){throw new Error("This method must be implemented by subclass")}updateNode(e,t,n){throw new Error("This method must be implemented by subclass")}transactNode(i,s){return C(this,arguments,function*(e,t,n={no_lock:!1,suppress_events:!1,context:null}){const o=n&&n.no_lock===!0,a=this.createTid(),c=o?{tid:a,release:tf}:yield this.nodeLocker.lock(e,a,!0,"transactNode");try{let u=!1;const l=()=>{u=!0};o&&this.subscriptions.add(e,"notify_value",l);const f=yield this.getNode(e,{tid:a}),y=f.revision;let d;try{d=t(f.value),d instanceof Promise&&(d=yield d.catch(g=>{this.debug.error(`Error in transaction callback: ${g.message}`)}))}catch(g){this.debug.error(`Error in transaction callback: ${g.message}`)}if(typeof d=="undefined")return;if(o&&this.subscriptions.remove(e,"notify_value",l),u)throw new Mr("Node changed");return yield this.setNode(e,d,{assert_revision:y,tid:c.tid,suppress_events:n.suppress_events,context:n.context})}catch(u){if(u instanceof Mr)return console.warn(`node value changed, running again. Error: ${u.message}`),this.transactNode(e,t,n);throw u}finally{c.release()}})}matchNode(e,t,n){return C(this,null,function*(){var a;const i=(a=n==null?void 0:n.tid)!=null?a:Re.generate(),s=(c,u)=>C(this,null,function*(){if(u.length===0)return Promise.resolve(!0);const l=u.reduce((p,g)=>{let S=g.key;return typeof S=="string"&&S.includes("/")&&(S=S.slice(0,S.indexOf("/"))),p.indexOf(S)<0&&p.push(S),p},[]),f=l.slice();let y=!0;const d=[];try{return yield this.getChildren(c,{tid:i,keyFilter:l}).next(p=>{var L;const g=(L=p.key)!=null?L:p.index;f.includes(g)&&f.splice(f.indexOf(p.key),1);const S=u.filter(j=>j.key===g).map(j=>({op:j.op,compare:j.compare})),P=S.length>0?o(p,S):{isMatch:!0,promises:[]};if(y=P.isMatch,y){d.push(...P.promises);const j=u.filter(D=>typeof D.key=="string"&&D.key.startsWith(`${typeof g=="number"?`[${g}]`:g}/`)).map(D=>({key:D.key.slice(D.key.indexOf("/")+1),op:D.op,compare:D.compare}));if(j.length>0){const D=N.getChildPath(c,p.key),W=s(D,j).then(M=>({isMatch:M}));d.push(W)}}if(!y||f.length===0)return!1}),y&&(y=(yield Promise.all(d)).every(g=>g.isMatch)),y?(y=f.every(p=>{const g=new Ro(ee($($({},typeof p=="number"&&{index:p}),typeof p=="string"&&{key:p}),{exists:!1})),S=u.filter(j=>typeof j.key=="string"&&j.key.startsWith(`${typeof p=="number"?`[${p}]`:p}/`)).map(j=>({op:j.op,compare:j.compare}));if(S.length>0&&!o(g,S).isMatch)return!1;const P=u.filter(j=>j.key===p).map(j=>({op:j.op,compare:j.compare}));return P.length===0?!0:o(g,P).isMatch}),y):!1}catch(p){throw this.debug.error(`Error matching on "${c}": `,p),p}}),o=(c,u)=>{const l=[];return{isMatch:u.every(y=>{let d=!0;if(y.op==="!exists"||y.op==="=="&&(typeof y.compare=="undefined"||y.compare===null))d=!c.exists;else if(y.op==="exists"||y.op==="!="&&(typeof y.compare=="undefined"||y.compare===null))d=c.exists;else if((y.op==="contains"||y.op==="!contains")&&y.compare instanceof Array&&y.compare.length===0)d=!0;else if(!c.exists)d=!1;else if(c.address)if(c.valueType===F.OBJECT&&["has","!has"].indexOf(y.op)>=0){const p=y.op==="has"?"exists":"!exists",g=s(c.path,[{key:y.compare,op:p}]).then(S=>({key:c.key,isMatch:S}));l.push(g),d=!0}else if(c.valueType===F.ARRAY&&["contains","!contains"].indexOf(y.op)>=0){const p=this.getNode(c.path,{tid:i}).then(({value:g})=>{const S=y.op==="contains"?y.compare instanceof Array?y.compare.every(P=>g.includes(P)):g.includes(y.compare):y.compare instanceof Array?!y.compare.some(P=>g.includes(P)):!g.includes(y.compare);return{key:c.key,isMatch:S}});l.push(p),d=!0}else if(c.valueType===F.STRING){const p=this.getNode(c.path,{tid:i}).then(g=>({key:c.key,isMatch:this.test(g.value,y.op,y.compare)}));l.push(p),d=!0}else d=!1;else if(c.type===F.OBJECT&&["has","!has"].indexOf(y.op)>=0){const p=y.compare in c.value;d=p&&y.op==="has"||!p&&y.op==="!has"}else if(c.type===F.ARRAY&&["contains","!contains"].indexOf(y.op)>=0){const p=c.value.indexOf(y.compare)>=0;d=p&&y.op==="contains"||!p&&y.op==="!contains"}else{let p=this.test(c.value,y.op,y.compare);p instanceof Promise&&(l.push(p),p=!0),d=p}return d}),promises:l}};return s(e,t)})}test(e,t,n){if(t==="<")return e<n;if(t==="<=")return e<=n;if(t==="==")return e===n;if(t==="!=")return e!==n;if(t===">")return e>n;if(t===">=")return e>=n;if(t==="in")return n.indexOf(e)>=0;if(t==="!in")return n.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+n.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",o=new RegExp(i,"i").test(e.toString());return t==="like"?o:!o}if(t==="matches")return n.test(e.toString());if(t==="!matches")return!n.test(e.toString());if(t==="between")return e>=n[0]&&e<=n[1];if(t==="!between")return e<n[0]||e>n[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&n in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(n);return t==="contains"?i:!i}return!1}exportNode(i,s){return C(this,arguments,function*(e,t,n={format:"json",type_safe:!0}){if((n==null?void 0:n.format)!=="json")throw new Error("Only json output is currently supported");const o=typeof t!="function"?t.write.bind(t):t,a=(p,g)=>{const S=P=>P.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,L=>`\\u${L.charCodeAt(0).toString(16).padStart(4,"0")}`);return p===F.DATETIME?(g=`"${g.toISOString()}"`,n.type_safe&&(g=`{".type":"date",".val":${g}}`)):p===F.STRING?g=`"${S(g)}"`:p===F.ARRAY?g="[]":p===F.OBJECT?g="{}":p===F.BINARY?(g=`"${S(ut.encode(g))}"`,n.type_safe&&(g=`{".type":"binary",".val":${g}}`)):p===F.REFERENCE?(g=`"${g.path}"`,n.type_safe&&(g=`{".type":"reference",".val":${g}}`)):p===F.BIGINT&&(g=`"${g}"`,n.type_safe&&(g=`{".type":"bigint",".val":${g}}`)),g};let c="",u="";const l=yield this.getNodeInfo(e);if(l.exists)if(l.type===F.OBJECT)c="{",u="}";else if(l.type===F.ARRAY)c="[",u="]";else{const p=yield this.getNode(e),g=a(l.type,p.value);return o(g)}else return o("null");if(c){const p=o(c);p instanceof Promise&&(yield p)}let f="",y=0;const d=[];if(yield this.getChildren(e).next(p=>{p.address?d.push(p):(y++>0&&(f+=","),typeof p.key=="string"&&(f+=`"${p.key}":`),f+=a(p.type,p.value))}),f){const p=o(f);p instanceof Promise&&(yield p)}for(;d.length>0;){const p=d.shift();let g=y++>0?",":"";const S=typeof p.index=="number"?p.index:p.key;if(typeof S=="string"&&(g+=`"${S}":`),g){const P=o(g);P instanceof Promise&&(yield P)}yield this.exportNode(N.getChildPath(e,S),o,n)}if(u){const p=o(u);p instanceof Promise&&(yield p)}})}importNode(i,s){return C(this,arguments,function*(e,t,n={format:"json",method:"set"}){const a={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},c=(E=!1)=>C(this,null,function*(){let w=yield t(262144);if(w===null)throw a.data?new Error(`Unexpected EOF at index ${a.offset+a.data.length}`):new Error("Unable to read data from stream");typeof w=="object"&&(w=mo(w)),E?a.data+=w:(a.offset+=a.data.length,a.data=w,a.index=0)}),u=E=>C(this,null,function*(){let w="";return a.index+E>=a.data.length&&(w=a.data.slice(a.index),E-=w.length,yield c()),w+=a.data.slice(a.index,a.index+E),a.index+=E,w}),l=E=>C(this,null,function*(){if(a.index+E>a.data.length&&(yield c(!0)),a.index+E>a.data.length)throw new Error("Not enough data available from stream")}),f=E=>C(this,null,function*(){const w=yield u(E.length);if(w!==E)throw new Error(`Unexpected character "${w[0]}" at index ${a.offset+a.index}, expected "${E}"`)}),y=()=>C(this,null,function*(){const E=[" ","	","\r",`
`];for(;a.index>=a.data.length&&(yield c()),E.includes(a.data[a.index]);)a.index++}),d=E=>C(this,null,function*(){yield l(E);const w=a.index;return a.data.slice(w,w+E)}),p=()=>C(this,null,function*(){yield y();const E=yield d(1);switch(E){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(E==="-"||E>="0"&&E<="9")return"number";throw new Error(`Unknown value at index ${a.offset+a.index}`)}}}),g=()=>C(this,null,function*(){yield f('"');let E="",w=a.index;for(;a.data[w]!=='"'||a.data[w-1]==="\\";)w++,w>=a.data.length&&(E+=a.data.slice(a.index),yield c(),w=0);return E+=a.data.slice(a.index,w),a.index=w+1,j(E)}),S=()=>C(this,null,function*(){throw a.data[a.index]==="t"?yield f("true"):a.data[a.index]==="f"&&(yield f("false")),new Error(`Expected true or false at index ${a.offset+a.index}`)}),P=()=>C(this,null,function*(){let E="",w=a.index;const A=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;A.includes(a.data[w]);)w++,w>=a.data.length&&(E+=a.data.slice(a.index),yield c(),w=0);return E+=a.data.slice(a.index,w),a.index=w,E.endsWith("n")?BigInt(E.slice(0,-1)):E.includes(".")?parseFloat(E):parseInt(E)}),L=()=>C(this,null,function*(){yield y();const E=yield p(),w=yield(()=>{switch(E){case"string":return g();case"object":return{};case"array":return[];case"number":return P();case"null":return null;case"undefined":return;case"boolean":return S()}})();return{type:E,value:w}}),j=E=>E.replace(/\\n/g,`
`).replace(/\\"/g,'"'),D=(E,w)=>{const A=w[".type"];let h=w[".val"];switch(A){case"Date":case"date":{h=new Date(h);break}case"Buffer":case"binary":{if(h=j(h),h.startsWith("<~"))h=ut.decode(h);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${E}"`);break}case"PathReference":case"reference":{h=new pe(h);break}case"bigint":{h=BigInt(h);break}default:throw new Error(`Import error: Unsupported type "${A}" for value at path "/${E}"`)}return h},W={acebase_import_id:Re.generate()},M={suppress_events:n.suppress_events,context:W},Z=E=>C(this,null,function*(){if(yield f("{"),yield y(),(yield d(1))==="}")return a.index++,this.setNode(E.path,{},M);let A=0,h={},x=!1;const m=()=>C(this,null,function*(){let k;x?Object.keys(h).length>0&&(k=this.updateNode(E.path,h,M)):(x=!0,k=this.setNode(E.path,h,M)),h={},k&&(yield k)}),v=[];for(;;){yield y();const k=yield g();yield y(),yield f(":"),yield y();const{value:T,type:_}=yield L();if(h[k]=T,A++,["object","array"].includes(_)&&(v.push(m()),_==="object"?yield Z(E.child(k)):yield oe(E.child(k))),yield y(),(yield d(1))==="}"){a.index++;break}yield f(",")}if(A===2&&".type"in h&&".val"in h){const k=D(E.path,h);return this.setNode(E.path,k,M)}v.push(m()),yield Promise.all(v)}),oe=E=>C(this,null,function*(){if(yield f("["),yield y(),(yield d(1))==="]")return a.index++,this.setNode(E.path,[],M);let A=!1,h=[],x={};const m=()=>C(this,null,function*(){let T;A?Object.keys(x).length>0&&(T=this.updateNode(E.path,x,M),x={}):(A=!0,T=this.setNode(E.path,h,M),h=null),T&&(yield T)}),v=(T,_)=>{A?x[_]=T:h.push(T)},b=[];let k=0;for(;;){yield y();const{value:T,type:_}=yield L();if(v(T,k),["object","array"].includes(_)&&(b.push(m()),_==="object"?yield Z(E.child(k)):yield oe(E.child(k))),yield y(),(yield d(1))==="]"){a.index++;break}yield f(","),k++}b.push(m()),yield Promise.all(b)});return(()=>C(this,null,function*(){const{value:E,type:w}=yield L();if(["object","array"].includes(w)){const A=N.get(e);w==="object"?yield Z(A):yield oe(A)}else yield this.setNode(e,E,M)}))()})}setSchema(e,t,n=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const o=this._schemas.findIndex(a=>a.path===e);o>=0&&this._schemas.splice(o,1);return}const i=new Ml(t,{warnOnly:n,warnCallback:o=>this.debug.warn(o)}),s=this._schemas.find(o=>o.path===e);s?s.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((o,a)=>{const c=N.getPathKeys(o.path),u=N.getPathKeys(a.path);return c.length===u.length?0:c.length<u.length?-1:1}))}getSchema(e){const t=this._schemas.find(n=>n.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,n={updates:!1}){let i={ok:!0};const s=N.get(e);return this._schemas.filter(o=>s.isOnTrailOf(o.path)).every(o=>{if(s.isDescendantOf(o.path)){const l=N.fillVariables(o.path,e),f=s.keys.slice(N.getPathKeys(o.path).length);return i=o.schema.check(l,t,n.updates,f),i.ok}const a=N.getPathKeys(o.path).slice(s.keys.length);if(n.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=n.updates===!0&&a.length===0,u=(l,f,y)=>{if(y.length===0)return o.schema.check(l,f,c);if(f===null)return{ok:!0};const d=y[0];if(typeof d=="string"&&(d==="*"||d[0]==="$")){if(f===null||typeof f!="object")return{ok:!0};let p;return Object.keys(f).every(g=>{const S=N.getChildPath(l,g),P=f[g];return p=u(S,P,y.slice(1)),p.ok}),p}else{const p=N.getChildPath(l,d),g=f[d];return u(p,g,y.slice(1))}};return i=u(e,t,a),i.ok}),i}}class en{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return N}}class xs{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:sf}=bo;class di{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Re.generate()}getChildCount(e){return C(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return C(this,null,function*(){const t=new Map;return yield Promise.all(e.map(n=>this.get(n).then(i=>t.set(n,i)))),t})}setMultiple(e){return C(this,null,function*(){yield Promise.all(e.map(({path:t,node:n})=>this.set(t,n)))})}removeMultiple(e){return C(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return C(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return C(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(en.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class tn extends hi{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,n=t?new Co(console,this.lockTimeout):null;this.getTransaction=o=>C(this,[o],function*({path:i,write:s}){const a=yield e.getTransaction({path:i,write:s});je(typeof a.id=="string","transaction id not set");const c=a.rollback,u=a.commit;return a.commit=()=>C(this,null,function*(){const l=yield u.call(a);return t&&(yield a._lock.release("commit")),l}),a.rollback=l=>C(this,null,function*(){const f=yield c.call(a,l);return t&&(yield a._lock.release("rollback")),f}),t&&(a._lock=yield n.lock(i,a.id,s,`${this.name}::getTransaction`)),a})}}class Er extends Ro{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class of extends rf{constructor(e,t,n){super(e,t,n),this._customImplementation=t,this._init()}_init(){return C(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize(Se.dim)),this.debug.log("- Type: CustomStorage".colorize(Se.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize(Se.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize(Se.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize(Se.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,n){const i=o=>{if(o===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof o))return o;if(o instanceof Date)return{type:F.DATETIME,value:o.getTime()};if(o instanceof pe)return{type:F.REFERENCE,value:o.path};if(o instanceof ArrayBuffer)return{type:F.BINARY,value:ut.encode(o)};if(typeof o=="object")return je(Object.keys(o).length===0,"child object stored in parent can only be empty"),o},s="Caller should have pre-processed the value by converting it to a string";if(t.type===F.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${s}`);const o={};for(let a=0;a<t.value.length;a++)o[a]=t.value[a];t.value=o}if(t.type===F.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${s}`),t.value=ut.encode(t.value)),t.type===F.REFERENCE&&t.value instanceof pe&&(console.warn(`Unprocessed path reference. ${s}`),t.value=t.value.path),[F.OBJECT,F.ARRAY].includes(t.type)){const o=t.value;t.value={},Object.keys(o).forEach(a=>{t.value[a]=i(o[a])})}return n.transaction.set(e,t)}_processReadNodeValue(e){const t=n=>{if(n.type===F.BINARY)return ut.decode(n.value);if(n.type===F.DATETIME)return new Date(n.value);if(n.type===F.REFERENCE)return new pe(n.value);throw new Error(`Unhandled child value type ${n.type}`)};switch(e.type){case F.ARRAY:case F.OBJECT:{const n=e.value;Object.keys(n).forEach(i=>{const s=n[i];typeof s=="object"&&"type"in s&&(n[i]=t(s))}),e.value=n;break}case F.BINARY:{e.value=ut.decode(e.value);break}case F.REFERENCE:{e.value=new pe(e.value);break}case F.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return C(this,null,function*(){const n=yield t.transaction.get(e);return n===null?null:(typeof n!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(n),n)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=F.STRING;else if(typeof e=="number")t=F.NUMBER;else if(typeof e=="boolean")t=F.BOOLEAN;else if(e instanceof Array)t=F.ARRAY;else if(typeof e=="object")if("type"in e){const n=e;t=n.type,e=n.value,t===F.DATETIME?e=new Date(e):t===F.REFERENCE&&(e=new pe(e))}else t=F.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,n){return C(this,null,function*(){if(!n.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof n.diff=="undefined"&&typeof n.currentValue!="undefined"){const p=sf(n.currentValue,t);n.merge&&typeof p=="object"&&(p.removed=p.removed.filter(g=>t[g]===null)),n.diff=p}if(n.diff==="identical")return;const i=n.transaction,s=n.currentValue===null?null:yield this._readNode(e,{transaction:i});if(n.merge&&s){if(s.type===F.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(p=>isNaN(parseInt(p))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&s.type!==F.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const o=n.revision||Re.generate(),a={type:s&&s.type===F.ARRAY?F.ARRAY:F.OBJECT,value:{}},c={};if(t instanceof Array){a.type=F.ARRAY;const p={};for(let g=0;g<t.length;g++)p[g]=t[g];t=p}else t instanceof pe?(a.type=F.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=F.BINARY,a.value=ut.encode(t)):typeof t=="string"&&(a.type=F.STRING,a.value=t);const u=s?[F.OBJECT,F.ARRAY].includes(s.type):!1,l=[F.OBJECT,F.ARRAY].includes(a.type),f={current:[],new:[]};let y=null;u&&(y=s.value,f.current=Object.keys(y),l&&(a.value=y)),l&&(n.merge||Object.keys(a.value).forEach(p=>{p in t||(t[p]=null)}),Object.keys(t).forEach(p=>{const g=t[p];if(delete a.value[p],g!==null){if(typeof g=="undefined")if(this.settings.removeVoidProperties===!0){delete t[p];return}else throw new Error(`Property "${p}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(g)?a.value[p]=g:c[p]=g}}));const d=a.type===F.ARRAY;if(s){if(this.debug.log(`Node "/${e}" is being ${n.merge?"updated":"overwritten"}`.colorize(Se.cyan)),u||l){const g=N.get(e),S=[];let P=!1;const L=E=>(P=!0,!i.production&&!g.isParentOf(E)&&this.throwImplementationError(`"${E}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),j=E=>{P||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const w=N.get(E).key;return S.push(w.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},L,j),f.current=f.current.concat(S),l&&(n&&n.merge&&(f.new=f.current.slice()),Object.keys(t).forEach(E=>{f.new.includes(E)||f.new.push(E)}));const D={insert:f.new.filter(E=>!f.current.includes(E)),update:[],delete:n&&n.merge?Object.keys(t).filter(E=>t[E]===null):f.current.filter(E=>!f.new.includes(E))};if(D.update=f.new.filter(E=>f.current.includes(E)&&!D.delete.includes(E)),d&&n.merge&&(D.insert.length>0||D.delete.length>0)&&!D.update.concat(D.insert).every((A,h,x)=>x.includes(h.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const W=Object.keys(c).map(E=>{const w=d?parseInt(E):E,A=typeof n.diff=="object"?n.diff.forChild(w):void 0;if(A==="identical")return;const h=g.childPath(w),x=c[w],m=typeof n.currentValue=="undefined"?void 0:n.currentValue!==null&&typeof n.currentValue=="object"&&w in n.currentValue?n.currentValue[w]:null;return this._writeNode(h,x,{transaction:i,revision:o,merge:!1,currentValue:m,diff:A})}),M=l?S.filter(E=>E in a.value):[],oe=D.delete.concat(M).map(E=>{const w=d?parseInt(E):E,A=g.childPath(w);return this._deleteNode(A,{transaction:i})}),ie=W.concat(oe);yield Promise.all(ie)}const p=this._storeNode(e,{type:a.type,value:a.value,revision:s.revision,revision_nr:s.revision_nr+1,created:s.created,modified:Date.now()},{transaction:i});if(p instanceof Promise)return yield p}else{if(this.debug.log(`Node "/${e}" is being created`.colorize(Se.cyan)),d&&!Object.keys(a.value).concat(Object.keys(c)).every((L,j,D)=>D.includes(j.toString())))throw new Error("Cannot store arrays with missing entries");const p=Object.keys(c).map(S=>{const P=d?parseInt(S):S,L=N.getChildPath(e,P),j=c[P];return this._writeNode(L,j,{transaction:i,revision:o,merge:!1,currentValue:null})}),g=this._storeNode(e,{type:a.type,value:a.value,revision:o,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});g instanceof Promise&&p.push(g),yield Promise.all(p)}})}_deleteNode(e,t){return C(this,null,function*(){const n=N.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize(Se.cyan));const i=[e];let s=!1;const o=u=>(s=!0,!c.production&&!n.isAncestorOf(u)&&this.throwImplementationError(`"${u}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=u=>(s||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(u),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},o,a),this.debug.log(`Nodes ${i.map(u=>`"/${u}"`).join(",")} are being deleted`.colorize(Se.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let n;const i={next(o){return n=o,s()}},s=()=>C(this,null,function*(){const o=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>C(this,null,function*(){const c=yield this._readNode(e,{transaction:o});if(!c)throw new li(`Node "/${e}" does not exist`);if(![F.OBJECT,F.ARRAY].includes(c.type))return;const u=c.type===F.ARRAY,l=c.value;let f=Object.keys(l).map(S=>u?parseInt(S):S);t.keyFilter&&(f=f.filter(S=>t.keyFilter.includes(S)));const y=N.get(e);if(f.length>0&&f.every(S=>{const P=this._getTypeFromStoredValue(l[S]),L=new Er({path:y.childPath(S),key:u?null:S,index:u?S:null,type:P.type,address:null,exists:!0,value:P.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=n(L)===!1,!a}),a)return;let d=!1;const p=S=>{if(d=!0,!o.production&&!y.isParentOf(S)&&this.throwImplementationError(`"${S}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const P=N.get(S).key;return t.keyFilter.includes(P)}return!0},g=(S,P)=>{d||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const L=N.get(S).key,j=new Er({path:S,type:P.type,key:u?null:L,index:u?L:null,address:new xs(S),exists:!0,value:null,revision:P.revision,revision_nr:P.revision_nr,created:new Date(P.created),modified:new Date(P.modified)});return a=n(j)===!1,!a};yield o.childrenOf(e,{metadata:!0,value:!1},p,g)}))(),t.transaction||(yield o.commit()),a}catch(a){throw t.transaction||(yield o.rollback(a)),a}});return i}getNode(e,t){return C(this,null,function*(){t=t||{};const n=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>C(this,null,function*(){const s=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,o=N.get(e),a=yield this._readNode(e,{transaction:n});if(!a){if(e==="")return{value:null};const j=yield n.moveToParentPath(o.parentPath);je(j===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const D=yield this._readNode(o.parentPath,{transaction:n});if(D&&[F.OBJECT,F.ARRAY].includes(D.type)&&o.key in D.value){const W=this._getTypeFromStoredValue(D.value[o.key]);return{revision:D.revision,revision_nr:D.revision_nr,created:D.created,modified:D.modified,type:W.type,value:W.value}}return{value:null}}const c=a.type===F.ARRAY,u=j=>{const D=W=>/^[0-9]+$/.test(W);return j.map(W=>N.get(c&&D(W)?`[${W}]`:W))},l=t.include?u(t.include):[],f=t.exclude?u(t.exclude):[],y=(j,D)=>{if([F.OBJECT,F.ARRAY].includes(D.type)&&l.length>0){const W=N.getPathKeys(j).slice(o.keys.length),M=new N(W),Z=[],oe=l.filter(w=>w.isDescendantOf(M));if(oe.length>0){const w=D.type===F.ARRAY;Z.push(...Object.keys(D.value).map(A=>w?+A:A));for(const A of oe){const h=A.keys[W.length];if(typeof h=="string"&&(h==="*"||h.startsWith("$"))){Z.splice(0);break}const x=Z.indexOf(h);x>=0&&Z.splice(x,1)}}const ie=l.some(w=>w.isChildOf(M));if(f.some(w=>w.isChildOf(M))&&!ie){const w=f.filter(A=>A.isChildOf(M));for(let A=0;A<Z.length;A++)w.find(h=>h.equals(Z[A]))||(Z.splice(A,1),A--)}for(const w of Z)delete D.value[w]}};y(e,a);let d=!1;const p=(j,D)=>{if(d=!0,!n.production&&!o.isAncestorOf(j)&&this.throwImplementationError(`"${j}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!s)return!0;const M=N.getPathKeys(j).slice(o.keys.length),Z=new N(M);let oe=(l.length>0?l.some(ie=>Z.isOnTrailOf(ie)):!0)&&(f.length>0?!f.some(ie=>ie.equals(Z)||ie.isAncestorOf(Z)):!0);return oe&&t.child_objects===!1&&(o.isParentOf(j)&&[F.OBJECT,F.ARRAY].includes(D?D.type:-1)||N.getPathKeys(j).length>o.pathKeys.length+1)&&(oe=!1),oe},g=[],S=(j,D)=>{if(d||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[F.OBJECT,F.ARRAY].includes(D.type))return!0;y(j,D),this._processReadNodeValue(D);const W=D;return W.path=j,g.push(W),!0};yield n.descendantsOf(e,{metadata:!0,value:!0},p,S),this.debug.log(`Read node "/${e}" and ${s?"(filtered) ":""}descendants from ${g.length+1} records`.colorize(Se.magenta));const P=a,L=j=>{const D=[];return Object.keys(j).forEach(W=>{const M=parseInt(W);D[M]=j[M]}),D};if(a.type===F.ARRAY&&(P.value=L(P.value)),a.type===F.OBJECT||a.type===F.ARRAY){const j=N.getPathKeys(e),D=a.value;for(let W=0;W<g.length;W++){const M=g[W],oe=N.getPathKeys(M.path).slice(j.length);let ie=D;for(let E=0;E<oe.length;E++){je(typeof ie=="object","parent must be an object/array to have children!!");const w=oe[E],A=E===oe.length-1,h=A?M.type:typeof oe[E+1]=="number"?F.ARRAY:F.OBJECT;let x;A?(x=M.value,h===F.ARRAY&&(x=L(x))):x=h===F.OBJECT?{}:[],w in ie?typeof ie[w]==typeof x&&[F.OBJECT,F.ARRAY].includes(h)?Object.keys(x).forEach(v=>{v in ie[w]&&this.throwImplementationError(`Custom storage merge error: child key "${v}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),ie[w][v]=x[v]}):this.debug.error(`The value stored in node "${M.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:ie,key:w,nodeType:h,nodeValue:x}):ie[w]=x,ie=ie[w]}}}else g.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(P.value).forEach(j=>{typeof P.value[j]=="object"&&P.value[j].constructor===Object&&(je(Object.keys(P.value[j]).length===0),delete P.value[j])}),t.include,t.exclude){const j=(D,W)=>{if(typeof D!="object")return;const M=W[0];M==="*"?Object.keys(D).forEach(Z=>{j(D[Z],W.slice(1))}):W.length>1?M in D&&j(D[M],W.slice(1)):delete D[M]};t.exclude.forEach(D=>{const W=N.getPathKeys(D);j(P.value,W)})}return P}))();return t.transaction||(yield n.commit()),i}catch(i){throw t.transaction||(yield n.rollback(i)),i}})}getNodeInfo(n){return C(this,arguments,function*(e,t={}){t=t||{};const i=N.get(e),s=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const o=yield this._readNode(e,{transaction:s}),a=new Er({path:e,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:o?o.type:0,exists:o!==null,address:o?new xs(e):null,created:o?new Date(o.created):null,modified:o?new Date(o.modified):null,revision:o?o.revision:null,revision_nr:o?o.revision_nr:null});if(!o&&e!==""){const c=yield s.moveToParentPath(i.parentPath);je(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const u=yield this._readNode(i.parentPath,{transaction:s});u&&[F.OBJECT,F.ARRAY].includes(u.type)&&i.key in u.value?(a.exists=!0,a.value=u.value[i.key],a.address=null,a.type=u.type,a.created=new Date(u.created),a.modified=new Date(u.modified),a.revision=u.revision,a.revision_nr=u.revision_nr):a.address=null}return t.include_child_count&&(a.childCount=0,[F.OBJECT,F.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=o.value?Object.keys(o.value).length:0,a.childCount+=yield s.getChildCount(e))),t.transaction||(yield s.commit()),a}catch(o){throw t.transaction||(yield s.rollback(o)),o}})}setNode(i,s){return C(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const o=N.get(e),a=n.transaction||(yield this._customImplementation.getTransaction({path:e,write:!0}));try{if(e===""){if(t===null||typeof t!="object"||t instanceof Array||t instanceof ArrayBuffer||"buffer"in t&&t.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${t}`);yield this._writeNodeWithTracking("",t,{merge:!1,transaction:a,suppress_events:n.suppress_events,context:n.context})}else if(typeof n.assert_revision!="undefined"){const c=yield this.getNodeInfo(e,{transaction:a});if(c.revision!==n.assert_revision)throw new Mr(`revision '${c.revision}' does not match requested revision '${n.assert_revision}'`);if(c.address&&c.address.path===e&&t!==null&&!this.valueFitsInline(t))yield this._writeNodeWithTracking(e,t,{merge:!1,transaction:a,suppress_events:n.suppress_events,context:n.context});else{const u=yield a.moveToParentPath(o.parentPath);je(u===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this._writeNodeWithTracking(o.parentPath,{[o.key]:t},{merge:!0,transaction:a,suppress_events:n.suppress_events,context:n.context})}}else{const c=yield a.moveToParentPath(o.parentPath);je(c===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this.updateNode(o.parentPath,{[o.key]:t},{transaction:a,suppress_events:n.suppress_events,context:n.context})}n.transaction||(yield a.commit())}catch(c){throw n.transaction||(yield a.rollback(c)),c}})}updateNode(i,s){return C(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof t!="object")throw new Error("invalid updates argument");if(Object.keys(t).length===0)return;const o=n.transaction||(yield this._customImplementation.getTransaction({path:e,write:!0}));try{const a=yield this.getNodeInfo(e,{transaction:o}),c=N.get(e);if(a.exists&&a.address&&a.address.path===e)yield this._writeNodeWithTracking(e,t,{transaction:o,merge:!0,suppress_events:n.suppress_events,context:n.context});else if(a.exists){const u=N.get(e),l=yield o.moveToParentPath(u.parentPath);je(l===u.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this._writeNodeWithTracking(u.parentPath,{[u.key]:t},{transaction:o,merge:!0,suppress_events:n.suppress_events,context:n.context})}else{const u=yield o.moveToParentPath(c.parentPath);je(u===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this.updateNode(c.parentPath,{[c.key]:t},{transaction:o,suppress_events:n.suppress_events,context:n.context})}n.transaction||(yield o.commit())}catch(a){throw n.transaction||(yield o.rollback(a)),a}})}}class af{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return C(this,null,function*(){var n,i;try{this.running++;const s=yield e();if(this.results[t]=s,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(n=this.doneCallback)==null||n.call(this,this.results);else if(this.scheduled.length>0){const o=this.scheduled.shift();this.execute(o.task,o.index)}}catch(s){this.done=!0,(i=this.errorCallback)==null||i.call(this,s)}})}add(e){var n;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const t=this.added++;((n=this.options)==null?void 0:n.wait)!==!0&&this.running<this.limit?this.execute(e,t):this.scheduled.push({task:e,index:t})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return C(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const cf=()=>{};function $o(i,s,o){return C(this,arguments,function*(r,e,t,n={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:cf}){var Z,oe,ie,E,w,A;typeof n!="object"&&(n={}),typeof n.snapshots=="undefined"&&(n.snapshots=!1);const a={};(Z=r.storage.settings.transactions)!=null&&Z.log&&(a.acebase_cursor=Re.generate());const c=t.filters.map(h=>$({},h)),u=t.order.map(h=>$({},h)),l=h=>{h.sort((x,m)=>{const v=b=>{const k=u[b],T=N.getPathKeys(typeof k.key=="number"?`[${k.key}]`:k.key),_=T.reduce((I,O)=>I!==null&&typeof I=="object"&&O in I?I[O]:null,x.val),R=T.reduce((I,O)=>I!==null&&typeof I=="object"&&O in I?I[O]:null,m.val);return _===null?R===null?0:k.ascending?-1:1:R===null?k.ascending?1:-1:_==R?b<u.length-1?v(b+1):x.path<m.path?-1:1:_<R?k.ascending?-1:1:k.ascending?1:-1};return v(0)})},f=(h,x)=>C(this,null,function*(){if(h.length===0)return[];const m=50,v=new af(m),b=[];return h.forEach(({path:k},T)=>v.add(()=>C(this,null,function*(){const R=(yield r.storage.getNode(k,x)).value;if(R===null){r.storage.debug.warn(`Indexed result "/${k}" does not have a record!`);return}const I={path:k,val:R};M.sorted?b[T]=I:(b.push(I),!M.skipped&&b.length>t.skip+Math.abs(t.take)&&(l(b),b.pop()))}))),yield v.finish(),b}),y=N.get(e),d=y.keys.some(h=>h==="*"||h.toString().startsWith("$")),p=r.storage.indexes.get(e),g=[];let S=()=>C(this,null,function*(){});if(d){const h=y.keys.filter(v=>typeof v=="string"&&v.startsWith("$")),x=h.length>0&&h.every(v=>t.filters.some(b=>b.key===v&&["==","in"].includes(b.op))),m=typeof n.monitor=="object"&&[(oe=n.monitor)==null?void 0:oe.add,(ie=n.monitor)==null?void 0:ie.change,(E=n.monitor)==null?void 0:E.remove].some(v=>v===!0);if(x&&!m){const v=[];for(const O of h){const K=t.filters.filter(G=>G.key===O).reduce((G,H)=>{if(H.op==="=="&&G.push(H.compare),H.op==="in"){if(!(H.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");G.push(...H.compare)}return G},[]),q=v.splice(0);K.forEach(G=>{q.length===0?v.push({[O]:G}):v.push(...q.map(H=>ee($({},H),{[O]:G})))})}const b=t.filters.filter(O=>!h.includes(O.key)),k=v.map(O=>N.get(N.getPathKeys(e).map(U=>{var K;return(K=O[U])!=null?K:U})).path),T=t.order.length>0,_=k.map(O=>{var U;return $o(r,O,{filters:b,take:0,skip:0,order:[]},{snapshots:T,cache_mode:n.cache_mode,include:[...(U=n.include)!=null?U:[],...t.order.map(K=>K.key)],exclude:n.exclude})});let I=(yield Promise.all(_)).reduce((O,U)=>(O.push(...U.results),O),[]);if(T&&l(I),t.skip>0&&I.splice(0,t.skip),t.take>0&&I.splice(t.take),n.snapshots&&(!T||((w=n.include)==null?void 0:w.length)>0||((A=n.exclude)==null?void 0:A.length)>0||!n.child_objects)){const{include:O,exclude:U,child_objects:K}=n;I=yield f(I,{include:O,exclude:U,child_objects:K})}return{results:I,context:null,stop:S}}else if(p.length===0){const v=new Error(`Query on wildcard path "/${e}" requires an index`);return Promise.reject(v)}if(c.length===0){const v=p.filter(b=>b.type==="normal")[0];c.push({key:v.key,op:"!=",compare:null})}}c.forEach(h=>{if(h.index)return;const x=p.filter(m=>m.key===h.key).filter(m=>m.validOperators.includes(h.op));if(x.length>=1){const m=c.filter(T=>T!==h).map(T=>T.key),v=u.map(T=>T.key).filter(T=>T!==h.key),b=x.map(T=>{const _=T.includeKeys.concat(T.key),R=_.filter(K=>m.includes(K)),I=_.filter(K=>v.includes(K)),O=R.concat(I.filter(K=>!R.includes(K))),U={filters:R.length,sorting:I.length*(t.take!==0?I.length:1),both:O.length*O.length,get total(){return this.filters+this.sorting+this.both}};return{index:T,points:U.total,filterKeys:R,sortKeys:I}});b.sort((T,_)=>T.points>_.points?-1:1);const k=b[0];h.index=k.index,k.filterKeys.forEach(T=>{c.filter(_=>_!==h&&_.key===T).forEach(_=>{!fi.validOperators.includes(_.op)||(_.indexUsage="filter",_.index=k.index)})}),k.sortKeys.forEach(T=>{u.filter(_=>_.key===T).forEach(_=>{_.index=k.index})})}h.index&&g.push({index:h.index,description:h.index.description})}),u.length>0&&t.take!==0&&c.length===0&&u.forEach(h=>{h.index||(h.index=p.filter(x=>x.key===h.key).find(x=>x.type==="normal"))});const P=g.map(h=>h.description).join(", ");g.length>0&&r.storage.debug.log(`Using indexes for query: ${P}`);const L=c.filter(h=>!h.index),j=/^[a-z]+:/i;if(L.some(h=>j.test(h.op))){const h=L.find(m=>j.test(m.op)),x=new Error(`query contains operator "${h.op}" which requires a special index that was not found on path "${e}", key "${h.key}"`);return Promise.reject(x)}const D=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let h=0;h<L.length;h++){const x=L[h];if(!D.includes(x.op))return Promise.reject(new Error(`query contains unknown filter operator "${x.op}" on path "${e}", key "${x.key}"`))}if(d&&L.length>0){const h=L.reduce((m,v)=>(m.indexOf(v.key)<0&&m.push(v.key),m),[]).map(m=>`"${m}"`),x=new Error(`This wildcard path query on "/${e}" requires index(es) on key(s): ${h.join(", ")}. Create the index(es) and retry`);return Promise.reject(x)}const W=[];c.forEach(h=>{if(h.index&&h.indexUsage!=="filter"){let x=h.index.query(h.op,h.compare).then(v=>(n.eventHandler&&n.eventHandler({name:"stats",type:"index_query",source:h.index.description,stats:v.stats}),v.hints.length>0&&n.eventHandler&&n.eventHandler({name:"hints",type:"index_query",source:h.index.description,hints:v.hints}),v));const m=c.filter(v=>v.index===h.index&&v.indexUsage==="filter");m.length>0&&(x=x.then(v=>(m.forEach(b=>{const{key:k,op:T,index:_}=b;let{compare:R}=b;typeof R=="string"&&!_.caseSensitive&&(R=R.toLocaleLowerCase(_.textLocale)),v=v.filterMetadata(k,T,R)}),v))),W.push(x)}});const M={filtered:c.length===0,skipped:t.skip===0,taken:t.take===0,sorted:u.length===0,preDataLoaded:!1,dataLoaded:!1};if(c.length===0&&t.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${e}"`),t.take=100),u.length>0&&u[0].index){const h=u[0].index,x=t.take<0?!u[0].ascending:u[0].ascending;if(c.length===0&&u.slice(1).every(m=>h.allMetadataKeys.includes(m.key))){r.storage.debug.log(`Using index for sorting: ${h.description}`);const m=u.slice(1).map(b=>(b.index=h,{key:b.key,ascending:b.ascending})),v=h.take(t.skip,Math.abs(t.take),{ascending:x,metadataSort:m}).then(b=>(n.eventHandler&&n.eventHandler({name:"stats",type:"sort_index_take",source:h.description,stats:b.stats}),b.hints.length>0&&n.eventHandler&&n.eventHandler({name:"hints",type:"sort_index_take",source:h.description,hints:b.hints}),b));W.push(v),M.skipped=!0,M.taken=!0,M.sorted=!0}}return Promise.all(W).then(h=>C(this,null,function*(){let x=[];if(h.length===1){const R=h[0];x=R.map(I=>{const O={key:I.key,path:I.path,val:{[R.filterKey]:I.value}};return I.metadata&&Object.assign(O.val,I.metadata),O}),M.filtered=!0}else if(h.length>1){h.sort((O,U)=>O.length<U.length?-1:1);const R=h[0],I=h.slice(1);x=R.reduce((O,U)=>{const K={key:U.key,path:U.path,val:{[R.filterKey]:U.value}};return I.every(G=>G.findIndex(H=>H.path===U.path)>=0)&&(U.metadata&&Object.assign(K.val,U.metadata),I.forEach(G=>{const H=G.find(Ee=>Ee.path===K.path);K.val[G.filterKey]=H.value,H.metadata&&Object.assign(K.val,H.metadata)}),O.push(K)),O},[]),M.filtered=!0}if(d||W.length>0&&L.length===0){if(u.length===0||u.every(R=>R.index)){if(M.preDataLoaded=!0,!M.sorted&&u.length>0&&l(x),M.sorted=!0,!M.skipped&&t.skip>0&&(x=t.take<0?x.slice(0,-t.skip):x.slice(t.skip)),!M.taken&&t.take!==0&&(x=t.take<0?x.slice(t.take):x.slice(0,t.take)),M.skipped=!0,M.taken=!0,!n.snapshots)return x;const R={include:n.include,exclude:n.exclude,child_objects:n.child_objects};return f(x,R).then(I=>(M.dataLoaded=!0,I))}if(n.snapshots||!M.sorted){const R=u.length>0,I=R?{include:u.map(O=>O.key)}:{include:n.include,exclude:n.exclude,child_objects:n.child_objects};return f(x,I).then(O=>(u.length>0&&l(O),M.sorted=!0,t.skip>0&&(O=t.take<0?O.slice(0,-t.skip):O.slice(t.skip)),t.take!==0&&(O=t.take<0?O.slice(t.take):O.slice(0,t.take)),M.skipped=!0,M.taken=!0,n.snapshots&&R?f(O,{include:n.include,exclude:n.exclude,child_objects:n.child_objects}):O))}else return x}let m;x.length>0&&(m=x.map(R=>R.key));let v=[],b=!1;const k=u.length>0,T=k?{include:u.map(R=>R.key)}:{include:n.include,exclude:n.exclude,child_objects:n.child_objects},_={promises:[],add(R){if(this.promises.push(R),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then(I=>{})}};try{yield r.storage.getChildren(e,{keyFilter:m,async:!0}).next(R=>{if(R.type!==F.OBJECT||!R.address)return;if(b)return!1;const I=()=>C(this,null,function*(){if(!(yield r.storage.matchNode(R.address.path,L)))return;const K=R.address.path;let q;if(n.snapshots||u.length>0){const G=yield r.storage.getNode(K,T);q={path:K,val:G.value}}else q={path:K};v.push(q),t.take!==0&&v.length>Math.abs(t.take)+t.skip&&(u.length>0?l(v):t.take>0&&(b=!0),v.pop())}),O=_.add(I());if(O instanceof Promise)return O})}catch(R){return R instanceof li||r.storage.debug.warn(`Error getting child stream: ${R}`),[]}return yield Promise.all(_.promises),M.preDataLoaded=k,M.dataLoaded=!k,u.length>0&&l(v),M.sorted=!0,t.skip>0&&(v=t.take<0?v.slice(0,-t.skip):v.slice(t.skip)),M.skipped=!0,t.take!==0&&(v=t.take<0?v.slice(t.take):v.slice(0,t.take)),M.taken=!0,M.dataLoaded||(v=yield f(v,{include:n.include,exclude:n.exclude,child_objects:n.child_objects}),M.dataLoaded=!0),v})).then(h=>{if(!M.sorted&&u.length>0&&l(h),n.snapshots||(h=h.map(x=>x.path)),!M.skipped&&t.skip>0&&(h=t.take<0?h.slice(0,-t.skip):h.slice(t.skip)),!M.taken&&t.take!==0&&(h=t.take<0?h.slice(t.take):h.slice(0,t.take)),n.monitor===!0&&(n.monitor={add:!0,change:!0,remove:!0}),typeof n.monitor=="object"&&(n.monitor.add||n.monitor.change||n.monitor.remove)){const x=n.monitor,m=n.snapshots?h.map(O=>O.path):h.slice(),v=r.db.ref(e),b=O=>{const U=m.indexOf(O);U<0||m.splice(U,1)},k=O=>{m.includes(O)||m.push(O)},T=()=>{r.unsubscribe(v.path,"child_changed",_),r.unsubscribe(v.path,"child_added",R),r.unsubscribe(v.path,"notify_child_removed",I)};S=()=>C(this,null,function*(){T()});const _=(O,U,K,q)=>C(this,null,function*(){const G=m.includes(U);let H=!0;const Ee=[];c.forEach(se=>!Ee.includes(se.key)&&Ee.push(se.key));const ae=[];typeof q=="object"&&Object.keys(q).forEach(se=>!ae.includes(se)&&ae.push(se)),typeof K=="object"&&Object.keys(K).forEach(se=>!ae.includes(se)&&ae.push(se));const ce=[];let ye=ae.every(se=>Ee.includes(se)?c.filter(ue=>ue.key===se).every(ue=>{var Ce;return((Ce=ue.index)==null?void 0:Ce.textLocaleKey)&&!ae.includes(ue.index.textLocaleKey)?(ce.push(ue.index.textLocaleKey),!0):D.includes(ue.op)?r.storage.test(K[se],ue.op,ue.compare):ue.index.test(K,ue.op,ue.compare)}):!0);if(ye&&(ce.push(...Ee.filter(se=>!ae.includes(se))),!G&&ce.length>0)){const se=c.filter(Ce=>ce.includes(Ce.key)),Te=se.filter(Ce=>D.includes(Ce.op)),ue=se.filter(Ce=>!D.includes(Ce.op));if(Te.length>0&&(ye=yield r.storage.matchNode(U,Te)),ye&&ue.length>0){const Ce=ue.reduce((ze,at)=>(ze.includes(at.key)||ze.push(at.key),at.index instanceof No&&at.index.config.localeKey&&!ze.includes(at.index.config.localeKey)&&ze.push(at.index.config.localeKey),ze),[]),ke=yield r.storage.getNode(U,{include:Ce});if(ke.value===null)return!1;ye=ue.every(ze=>ze.index.test(ke.value,ze.op,ze.compare))}}if(ye){if(G||k(U),n.snapshots){const se={include:n.include,exclude:n.exclude,child_objects:n.child_objects};K=(yield r.storage.getNode(U,se)).value}G&&x.change?H=n.eventHandler({name:"change",path:U,value:K})!==!1:!G&&x.add&&(H=n.eventHandler({name:"add",path:U,value:K})!==!1)}else G&&(b(U),x.remove&&(H=n.eventHandler({name:"remove",path:U,value:q})!==!1));H===!1&&T()}),R=(O,U,K)=>{const q=c.every(H=>D.includes(H.op)?r.storage.test(K[H.key],H.op,H.compare):H.index.test(K,H.op,H.compare));let G=!0;q&&(k(U),x.add&&(G=n.eventHandler({name:"add",path:U,value:n.snapshots?K:null})!==!1)),G===!1&&T()},I=(O,U,K,q)=>{let G=!0;b(U),x.remove&&(G=n.eventHandler({name:"remove",path:U,value:n.snapshots?q:null})!==!1),G===!1&&T()};(n.monitor.add||n.monitor.change||n.monitor.remove)&&r.subscribe(v.path,"child_changed",_),n.monitor.remove&&r.subscribe(v.path,"notify_child_removed",I),n.monitor.add&&r.subscribe(v.path,"child_added",R)}return{results:h,context:a,stop:S}})})}class uf extends $l{constructor(e="default",t,n){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(vs&&t.settings.storage instanceof vs)this.storage=new Kl(e,t.settings.storage,i);else if(ws&&t.settings.storage instanceof ws)this.storage=new Wl(e,t.settings.storage,i);else if(tn&&t.settings.storage instanceof tn)this.storage=new of(e,t.settings.storage,i);else{const s=t.settings.storage instanceof br?t.settings.storage:new br(t.settings.storage);this.storage=new Fr(e,s,i)}else this.storage=new Fr(e,new br,i);this.storage.on("ready",n)}stats(e){return C(this,null,function*(){return this.storage.stats})}subscribe(e,t,n){this.storage.subscriptions.add(e,t,n)}unsubscribe(e,t,n){this.storage.subscriptions.remove(e,t,n)}set(i,s){return C(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.setNode(e,t,{suppress_events:n.suppress_events,context:n.context});return $({},o&&{cursor:o})})}update(i,s){return C(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.updateNode(e,t,{suppress_events:n.suppress_events,context:n.context});return $({},o&&{cursor:o})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return C(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const n=yield this.storage.getNode(e,t);return{value:n.value,context:{acebase_cursor:n.cursor},cursor:n.cursor}})}transaction(i,s){return C(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.transactNode(e,t,{suppress_events:n.suppress_events,context:n.context});return $({},o&&{cursor:o})})}exists(e){return C(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(i,s){return C(this,arguments,function*(e,t,n={snapshots:!1}){return yield $o(this,e,t,n)})}createIndex(e,t,n){return this.storage.indexes.create(e,t,n)}getIndexes(){return C(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return C(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,n){return C(this,null,function*(){n=n||{};const i=(s,o=50,a=0,c=null)=>C(this,null,function*(){typeof o=="string"&&(o=parseInt(o)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const u=[];let l=0,f=!1,y=!1;return yield this.storage.getChildren(s).next(d=>{if(f)return y=!0,!1;l++,(c!==null?d.key>c:a===0||l>a)&&u.push($({key:typeof d.key=="string"?d.key:d.index,type:d.valueTypeName,value:d.value},typeof d.address=="object"&&"pageNr"in d.address&&{address:{pageNr:d.address.pageNr,recordNr:d.address.recordNr}})),f=o>0&&u.length===o}).catch(d=>{if(!(d instanceof li))throw d}),{more:y,list:u}});switch(t){case"children":return yield i(e,n.limit,n.skip,n.from);case"info":{const s={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},o=yield this.storage.getNodeInfo(e,{include_child_count:n.child_count===!0});s.key=typeof o.key!="undefined"?o.key:o.index,s.exists=o.exists,s.type=o.exists?o.valueTypeName:void 0,s.value=o.value,s.address=typeof o.address=="object"&&"pageNr"in o.address?{pageNr:o.address.pageNr,recordNr:o.address.recordNr}:void 0;const a=o.exists&&o.address&&[F.OBJECT,F.ARRAY].includes(o.type);return n.child_count===!0?s.children={count:a?o.childCount:0}:typeof n.child_limit=="number"&&n.child_limit>0&&a&&(s.children=yield i(e,n.child_limit,n.child_skip,n.child_from)),s}}})}export(e,t,n={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,n)}import(e,t,n={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,n)}setSchema(e,t,n=!1){return C(this,null,function*(){return this.storage.setSchema(e,t,n)})}getSchema(e){return C(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return C(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,n){return C(this,null,function*(){return this.storage.validateSchema(e,t,{updates:n})})}getMutations(e){return C(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return C(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class lf extends hi{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class ff extends di{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return C(this,null,function*(){})}rollback(e){return C(this,null,function*(){})}get(e){return C(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return C(this,null,function*(){const n=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),n)})}remove(e){return C(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,n,i){return C(this,null,function*(){const s=en.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isParentOf(c)&&n(c)){let u;if(t.metadata||t.value){const f=this.context.localStorage.getItem(a);u=JSON.parse(f)}if(!i(c,u))break}}})}descendantsOf(e,t,n,i){return C(this,null,function*(){const s=en.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isAncestorOf(c)&&n(c)){let u;if(t.metadata||t.value){const f=this.context.localStorage.getItem(a);u=JSON.parse(f)}if(!i(c,u))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function hf(r,e={}){const t=new lf(e),n=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new tn({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return C(this,null,function*(){})},getTransaction(a){return C(this,null,function*(){const c={debug:!0,dbname:r,localStorage:n};return new ff(c,a)})}}),s=new un(r,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return s.settings.ipcEvents=t.multipleTabs===!0,s}class df extends hi{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class jo extends Po{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class pf extends Nl{constructor(e,t={}){const n=new jo(t);super(e,n),this.recovery={repairNode:(s,o)=>C(this,null,function*(){if(yield this.ready(),this.api.storage instanceof Fr)yield this.api.storage.repairNode(s,o);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:s=>C(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(s)})};const i={db:this,settings:n};this.api=new uf(e,i,()=>{this.emit("ready")})}close(){return C(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(n){t.setLevel(n)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(n){e.eventsEnabled=n}}}static WithLocalStorage(e,t={}){return hf(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function Es(r){return new Promise((e,t)=>{r.onsuccess=n=>e(r.result||null),r.onerror=t})}class yf extends di{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,n=$({},e);return delete n.value,{metadata:n,value:t}}commit(){return C(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(n=>n.path)});const t=this._createTransaction(!0);try{yield new Promise((n,i)=>{let s=!1,o=0;const a=u=>{s=!0,i(u)},c=()=>{++o===e.length&&n()};e.forEach((u,l)=>{if(s)return;let f,y;const d=u.path;if(u.action==="set"){const{metadata:g,value:S}=this._splitMetadata(u.node),P={path:d,metadata:g};f=t.objectStore("nodes").put(P),y=t.objectStore("content").put(S,d),this.context.cache.set(d,u.node)}else u.action==="remove"?(f=t.objectStore("content").delete(d),y=t.objectStore("nodes").delete(d),this.context.cache.set(d,null)):a(new Error(`Unknown pending operation "${u.action}" on path "${d}" `));let p=0;f.onsuccess=y.onsuccess=()=>{++p===2&&c()},f.onerror=y.onerror=a})}),t.commit&&t.commit()}catch(n){throw console.error(n),t.abort&&t.abort(),n}})}rollback(e){return C(this,null,function*(){this._pending=[]})}get(e){return C(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),n=Es(t.objectStore("nodes").get(e)),i=Es(t.objectStore("content").get(e));try{const s=yield Promise.all([n,i]);t.commit&&t.commit();const o=s[0];if(!o)return this.context.cache.set(e,null),null;const a=o.metadata;return a.value=s[1],this.context.cache.set(e,a),a}catch(s){throw console.error("IndexedDB get error",s),t.abort&&t.abort(),s}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return C(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,n,i){return this._getChildrenOf(e,ee($({},t),{descendants:!1}),n,i)}descendantsOf(e,t,n,i){return this._getChildrenOf(e,ee($({},t),{descendants:!0}),n,i)}_getChildrenOf(e,t,n,i){return new Promise((s,o)=>{const a=en.PathInfo.get(e),c=this._createTransaction(!1),u=c.objectStore("nodes"),l=IDBKeyRange.lowerBound(e,!0),f=t.metadata?u.openCursor(l):u.openKeyCursor(l);f.onerror=y=>{var d;(d=c.abort)==null||d.call(c),o(y)},f.onsuccess=y=>C(this,null,function*(){var g,S,P;const d=(S=(g=f.result)==null?void 0:g.key)!=null?S:null;let p=!0;if(d===null)p=!1;else if(!a.isAncestorOf(d))p=!1;else if(t.descendants||a.isParentOf(d)){let L;if(t.metadata&&(L=f.result.value.metadata),n(d,L)){if(t.value)if(this.context.cache.has(d)){const D=this.context.cache.get(d);L.value=D.value}else{const D=c.objectStore("content").get(d);L.value=yield new Promise((W,M)=>{D.onerror=Z=>{W(null)},D.onsuccess=Z=>{W(D.result)}}),this.context.cache.set(d,L.value===null?null:L)}p=i(d,L)}}if(p)try{f.result.continue()}catch(L){p=!1}p||((P=c.commit)==null||P.call(c),s())})})}}function mf(r,e={}){const t=new df(e),i=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${r}.acebase`,1);i.onupgradeneeded=y=>{const d=i.result;d.createObjectStore("nodes",{keyPath:"path"}),d.createObjectStore("content")};let s;const o=new Promise((y,d)=>{i.onsuccess=p=>{s=i.result,y()},i.onerror=p=>{d(p)}}),a=new Ll(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),c=new tn({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return o},getTransaction(y){return C(this,null,function*(){yield o;const d={debug:!1,db:s,cache:a,ipc:l};return new yf(d,y)})}}),u=new un(r,{logLevel:t.logLevel,storage:c,sponsor:t.sponsor}),l=u.api.storage.ipc;return u.settings.ipcEvents=t.multipleTabs===!0,l.on("notification",y=>C(this,null,function*(){const d=y.data;if(typeof d=="object"&&d.action==="cache.invalidate")for(const p of d.paths)a.remove(p)})),u}const gf=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class un extends pf{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(gf);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return mf(e,t)}}const vf={AceBase:un,AceBaseLocalSettings:jo,DataReference:et,DataSnapshot:de,EventSubscription:po,PathReference:pe,TypeMappings:So,CustomStorageSettings:tn,CustomStorageTransaction:di,CustomStorageHelpers:en,ID:Re,proxyAccess:In,DataSnapshotsArray:Xn};window.acebase=vf;window.AceBase=un;let wf=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),kr=(()=>"/ps"+wf()+"/pe")();const Oe={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},Pe={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},bn={user:{base:"/user",device:{remove:"/user/device-remove",list:"/user/device-list"}},users:{base:"/users",device:{list:"/users/device-list"}}},Ve={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+kr+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+kr+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+kr+"/get-one",users:{base:"/users"}};var Ft,bt,Tt,Mt,Ge,Gr,Wn,zn,on,Qe,$e,Ot,Ae;class bf{constructor(e={}){Ne(this,Ft,"/on");Ne(this,bt,!0);Ne(this,Tt,void 0);Ne(this,Mt,void 0);Ne(this,Ge,void 0);Ne(this,Gr,void 0);Ne(this,Wn,void 0);Ne(this,zn,void 0);Ne(this,on,new rl);Ne(this,Qe,void 0);Ne(this,$e,void 0);Ne(this,Ot,void 0);Ne(this,Ae,void 0);Ui(this,"init",e=>{var W,M,Z,oe,ie;let{ENV:t,HOST_SERVER:n,API_VERSION:i}=J(this,Ot),s=()=>C(this,null,function*(){var x,m,v,b,k,T,_,R,I,O,U,K;let E="/transaction",w="/database",A=yield(v=(m=(x=J(this,Ae))==null?void 0:x.ref(E))==null?void 0:m.get())==null?void 0:v.catch(q=>{}),h=yield(T=(k=(b=J(this,Ae))==null?void 0:b.ref(w))==null?void 0:k.get())==null?void 0:T.catch(q=>{});if(A.exists()){A=A.val();let q=Object.keys(A);if((q==null?void 0:q.length)>0){for(let G in q){let H=A[G];(H==null?void 0:H.path)&&(H==null?void 0:H.method)&&(H==null?void 0:H.value)&&(yield this.init(e).database().ref(H==null?void 0:H.path).req(H==null?void 0:H.method,H==null?void 0:H.path,H==null?void 0:H.value).val())}h.exists()&&(yield(I=(R=(_=J(this,Ae))==null?void 0:_.ref(w))==null?void 0:R.remove())==null?void 0:I.catch(G=>{})),yield(K=(U=(O=J(this,Ae))==null?void 0:O.ref(E))==null?void 0:U.remove())==null?void 0:K.catch(G=>{})}}});(M=(W=e==null?void 0:e.socket)==null?void 0:W.auth)==null||M.on("connect",()=>{ct(this,$e,!0),s()}),(oe=(Z=e==null?void 0:e.socket)==null?void 0:Z.auth)==null||oe.on("disconnect",()=>{ct(this,$e,!1)});const o=(E={})=>{var A,h,x;let w={};if(E&&Object.keys(E).length>0&&(w.data=E),J(this,Ge)&&(w.storage=J(this,Ge),w.config=J(this,Wn)),J(this,zn)){let m=new FormData;Array.isArray(E)?(E.map((v,b)=>{typeof v=="object"&&(v.attachmentName="attachment"+b,v==null||v.attachments.forEach(k=>{k!=null&&k.data?m.append("attachments"+b,k==null?void 0:k.data,k==null?void 0:k.name):m.append("attachments"+b,k)}))}),m.append("field",JSON.stringify(w))):Array.isArray(E==null?void 0:E.attachments)&&(E==null||E.attachments.forEach(v=>{v!=null&&v.data?m.append("attachments",v==null?void 0:v.data,v==null?void 0:v.name):m.append("attachments",v)}),delete w.data.attachments,m.append("field",JSON.stringify(w))),w=m}else if(J(this,Ge)&&(E==null?void 0:E.file)){let m=new FormData;E!=null&&E.file?((A=E.file)!=null&&A.data?m.append("file",(h=E.file)==null?void 0:h.data,(x=E.file)==null?void 0:x.name):m.append("file",E.file),delete w.data.file,m.append("field",JSON.stringify(w))):Array.isArray(E==null?void 0:E.directory)&&(E==null||E.directory.forEach(v=>{v!=null&&v.data?m.append("file",v==null?void 0:v.data,v==null?void 0:v.name):m.append("file",v)}),delete w.data.directory,m.append("field",JSON.stringify(w)),w=m),w=m}return w};let a=(E,w)=>C(this,null,function*(){var A,h,x,m,v,b,k,T;if(((A=E==null?void 0:E.error)==null?void 0:A.token)&&J(this,bt)){if(ct(this,bt,!1),localStorage.getItem("refreshToken")){t==="dev"&&console.log("Token expired or not found: ",(h=E.error)==null?void 0:h.token," Trying to request a new refresh token");let _=yield(m=(x=this==null?void 0:this.init(e))==null?void 0:x.auth())==null?void 0:m.req(Ve.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(_!=null&&_.error)return t==="dev"&&console.log("Refresh token expired or not found: ",_),J(this,Tt)&&(window.top.location.href=J(this,Tt)),_;if(_!=null&&_.data&&(t==="dev"&&console.log("We got a new refresh token ,",_==null?void 0:_.data),(v=_==null?void 0:_.data)!=null&&v.token&&localStorage.setItem("accessToken",(b=_==null?void 0:_.data)==null?void 0:b.token),(k=_==null?void 0:_.data)!=null&&k.refreshToken&&localStorage.setItem("refreshToken",(T=_==null?void 0:_.data)==null?void 0:T.refreshToken),t==="dev"&&console.log("Trying to restart your request..."),typeof w=="function"))return yield w()}}else return E});const c=(E,w,A,h=()=>{})=>{const x=J(this,Ft);let m=w.version+x+w.base+A;m=m.replace(/\/\//g,"/"),t==="dev"&&console.log("socket listen local path: ",m),E==null||E.on(m,h)},u=(E,w=()=>{})=>{var x;const A=J(this,Ft);let h=(i==null?void 0:i.AUTH)+A+E;h=h.replace(/\/\//g,"/"),t==="dev"&&console.log("emitter listen local path: ",h),(x=J(this,on))==null||x.on(h,w)};let l=(E,w,A,h)=>(J(this,Mt)&&(h=h+J(this,Mt)),{req:x=>(c(E,w,h+Pe.req,m=>{var v,b,k;(!((b=(v=m==null?void 0:m.error)==null?void 0:v.error)!=null&&b.token)&&!((k=m==null?void 0:m.error)!=null&&k.token)||(m==null?void 0:m.data))&&typeof x=="function"&&x(ee($({},A),{value:m}))}),A),create:x=>(c(E,w,h+Pe.create,m=>{var v,b,k;(!((b=(v=m==null?void 0:m.error)==null?void 0:v.error)!=null&&b.token)&&!((k=m==null?void 0:m.error)!=null&&k.token)||(m==null?void 0:m.data))&&typeof x=="function"&&x(ee($({},A),{value:m}))}),A),find:x=>(c(E,w,h+Pe.find,m=>{var v,b,k;(!((b=(v=m==null?void 0:m.error)==null?void 0:v.error)!=null&&b.token)&&!((k=m==null?void 0:m.error)!=null&&k.token)||(m==null?void 0:m.data))&&typeof x=="function"&&x(ee($({},A),{value:m}))}),A),get:x=>(c(E,w,h+Pe.get,m=>{var v,b,k;(!((b=(v=m==null?void 0:m.error)==null?void 0:v.error)!=null&&b.token)&&!((k=m==null?void 0:m.error)!=null&&k.token)||(m==null?void 0:m.data))&&typeof x=="function"&&x(ee($({},A),{value:m}))}),A),query:x=>(c(E,w,h+Pe.query,m=>{var v,b,k;(!((b=(v=m==null?void 0:m.error)==null?void 0:v.error)!=null&&b.token)&&!((k=m==null?void 0:m.error)!=null&&k.token)||(m==null?void 0:m.data))&&typeof x=="function"&&x(ee($({},A),{value:m}))}),A),update:x=>(c(E,w,h+Pe.update,m=>{var v,b,k;(!((b=(v=m==null?void 0:m.error)==null?void 0:v.error)!=null&&b.token)&&!((k=m==null?void 0:m.error)!=null&&k.token)||(m==null?void 0:m.data))&&typeof x=="function"&&x(ee($({},A),{value:m}))}),A),delete:x=>(c(E,w,h+Pe.delete,m=>{var v,b,k;(!((b=(v=m==null?void 0:m.error)==null?void 0:v.error)!=null&&b.token)&&!((k=m==null?void 0:m.error)!=null&&k.token)||(m==null?void 0:m.data))&&typeof x=="function"&&x(ee($({},A),{value:m}))}),A)}),f=(E,w)=>({create:A=>(u(E+Pe.create,h=>{(!(h!=null&&h.error)||(h==null?void 0:h.data))&&typeof A=="function"&&A(ee($({},w),{value:h}))}),w),find:A=>(u(E+Pe.find,h=>{(!(h!=null&&h.error)||(h==null?void 0:h.data))&&typeof A=="function"&&A(ee($({},w),{value:h}))}),w),get:A=>(u(E+Pe.get,h=>{(!(h!=null&&h.error)||(h==null?void 0:h.data))&&typeof A=="function"&&A(ee($({},w),{value:h}))}),w),query:A=>(u(E+Pe.query,h=>{(!(h!=null&&h.error)||(h==null?void 0:h.data))&&typeof A=="function"&&A(ee($({},w),{value:h}))}),w),update:A=>(u(E+Pe.update,h=>{(!(h!=null&&h.error)||(h==null?void 0:h.data))&&typeof A=="function"&&A(ee($({},w),{value:h}))}),w),delete:A=>(u(E+Pe.delete,h=>{(!(h!=null&&h.error)||(h==null?void 0:h.data))&&typeof A=="function"&&A(ee($({},w),{value:h}))}),w)}),y=as.init(J(this,Ot)),d=(E="",w={},A={},h={},x)=>{E=E.trim(),E.charAt(E.length-1)==="/"&&(E=E.slice(0,-1));let v=(()=>C(this,null,function*(){let b=()=>C(this,null,function*(){return yield y("post",n.AUTH+i.AUTH+Ve.base+E,o(w))}),k=yield b();return J(this,bt)&&(k=yield a(k,()=>C(this,null,function*(){return yield b()}))),typeof x=="function"&&x(ee($({},h),{value:k})),k}))();return ee($({},h),{val:()=>v})},p=(E,w,A,h={},x={},m)=>{let b=(()=>C(this,null,function*(){let k=()=>C(this,null,function*(){return yield y(E,w,o(A),h)}),T=yield k();return J(this,bt)&&(T=yield a(T,()=>C(this,null,function*(){return yield k()}))),typeof m=="function"&&m(ee($({},x),{value:T})),T}))();return ee($({},x),{val:()=>b})},g=E=>{let w={},A,[h={},,,]=E;if(E.length===1&&typeof h=="function"&&(A=E[0],h={}),E.length===2&&(typeof E[1]=="object"?w=E[1]:typeof E[1]=="function"&&(A=E[1])),E.length>=3){let[,x,m]=E;typeof x=="object"&&(w=x),A=m}return{data:h,onRequest:w,callback:A}},S=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),P=(E,w,A={},h,x)=>{w=w.replace(/\/\//g,"/");let v=(()=>C(this,null,function*(){var O,U,K,q,G,H,Ee,ae,ce,ye,se,Te,ue,Ce,ke,ze,at,Ci,Ni,$i,ji,Bi,Li;let b="/transaction",k,T,_={error:{message:"We could not execute the "+E+" method for path: "+w}};switch(E){case"create":yield(K=(U=(O=J(this,Ae))==null?void 0:O.ref(w))==null?void 0:U.set(A))==null?void 0:K.catch(Me=>_);break;case"update":yield(H=(G=(q=J(this,Ae))==null?void 0:q.ref(w))==null?void 0:G.update(A))==null?void 0:H.catch(Me=>_);break;case"query":let he=(Ee=J(this,Ae))==null?void 0:Ee.query(w);Array.isArray(A==null?void 0:A.where)&&(yield Promise.all(A==null?void 0:A.where.map(Me=>C(this,null,function*(){return yield new Promise(Bt=>{he==null||he.filter(...Me),Bt()})})))),A!=null&&A.take&&(he==null||he.take(A==null?void 0:A.take)),A!=null&&A.skip&&(he==null||he.take(A==null?void 0:A.skip)),A!=null&&A.order&&Array.isArray(A==null?void 0:A.order)&&(yield Promise.all(A==null?void 0:A.order.map(Me=>C(this,null,function*(){return yield new Promise(Bt=>{he==null||he.sort(...Me),Bt()})})))),T=yield he==null?void 0:he.count(),k=yield(ae=he==null?void 0:he.get($({},A==null?void 0:A.$option)))==null?void 0:ae.catch(Me=>_);break;case"delete":k=yield(se=(ye=(ce=J(this,Ae))==null?void 0:ce.ref(w))==null?void 0:ye.get())==null?void 0:se.catch(Me=>_),yield(Ce=(ue=(Te=J(this,Ae))==null?void 0:Te.ref(w))==null?void 0:ue.remove())==null?void 0:Ce.catch(Me=>_);break}if(E!=="delete"&&E!=="query"&&(k=yield(at=(ze=(ke=J(this,Ae))==null?void 0:ke.ref(w))==null?void 0:ze.get($({},A==null?void 0:A.$option)))==null?void 0:at.catch(he=>_)),E==="query"?k.exists()?(k=k==null?void 0:k.getValues(),k={data:k,max:T,take:A==null?void 0:A.take,skip:A==null?void 0:A.skip}):k=$({},_):k.exists()?(k=k==null?void 0:k.val(),k={data:k}):k=$({},_),J(this,Qe)&&h.auth().$currentUserId&&!J(this,$e)&&["create","delete","update"].includes(E)&&k!=null&&k.data){let he=yield($i=(Ni=(Ci=J(this,Ae))==null?void 0:Ci.ref(b))==null?void 0:Ni.get())==null?void 0:$i.catch(Ma=>_);he.exists()?he=he.val():he={};let Me,Bt=Object.keys(he);switch(Bt.length>0?Me=Bt.length+1:Me=0,E){case"create":E="post";break;case"update":E="put";break;case"delete":E="delete";break}E!=="get"&&(yield(Li=(Bi=(ji=J(this,Ae))==null?void 0:ji.ref(b+"/"+Me))==null?void 0:Bi.set({path:w,method:E,uid:Me,value:k.data}))==null?void 0:Li.catch(Ma=>_))}const R=J(this,Ft);let I=(i==null?void 0:i.AUTH)+R+w+"/"+E;return I=I.replace(/\/\//g,"/"),J(this,on).emit(I,k),typeof x=="function"&&x(ee($({},h),{value:k})),k}))();return ee($({},h),{val:()=>v})},L=({value:E,node:w},A)=>{var x,m,v,b;let h=E;if((x=h==null?void 0:h.data)!=null&&x.data){let k=(m=h==null?void 0:h.data)==null?void 0:m.data,T=(v=h==null?void 0:h.data)==null?void 0:v.refreshToken,_=(b=h==null?void 0:h.data)==null?void 0:b.token;_&&localStorage.setItem("accessToken",_),T&&localStorage.setItem("refreshToken",T),k&&localStorage.setItem("userInfo",JSON.stringify(k))}typeof A=="function"&&A(ee($({},w),{value:h}))},j=(E,w)=>{typeof E=="function"&&(w==null||w.on("connect",E))},D=(E,w)=>{let A="%"+E,h=this.init(e);return delete h.auth().login,delete h.auth().register,{$connected:J(this,$e),private:(x=S())=>h.event(E+x),child:x=>h.event(E+x),emit:(x,m)=>(w==null||w.emit(A,x),typeof m=="function"&&h.event(E).do(m),$($({},h.event(E)),h)),do:x=>(w==null||w.on(A,m=>{typeof x=="function"&&x(ee($($({},h.event(E)),h),{value:m}))}),$($({},h.event(E)),h)),onAny:x=>{w==null||w.onAny((m,v)=>{typeof x=="function"&&x(m,$($({value:v},h.event(m)),h))})}}};return{activity:()=>{let E=this.init(e);return{onStart:w=>(typeof w=="function"&&document.addEventListener("DOMContentLoaded",w),$($({},E),E.activity())),onCreate:w=>(typeof w=="function"&&(window.onload=w),$($({},E),E.activity())),onPause:w=>(window.addEventListener("beforeunload",function(A){typeof w=="function"&&w(),A.returnValue="onbeforeunload"}),$($({},E),E.activity())),onResume:()=>$($({},E),E.activity()),onLeave:w=>(typeof w=="function"&&(window.onunload=w),$($({},E),E.activity()))}},socket:{auth:(ie=e==null?void 0:e.socket)==null?void 0:ie.auth},$randomUID:()=>yr(),$randomId:()=>S(),$axios:as,local:(E={})=>{const w=this.init(e);return delete w.local,delete w.auth().register,delete w.auth().login,{database:(A="/database")=>({ref:(h="/database")=>{let x=this.init(e);return delete x.auth().login,delete x.auth().register,h=h.trim(),h=h.replace(/\/\//g,"/"),A=A+"/"+h,A=A.replace(/\/\//g,"/"),h.charAt(h.length-1)==="/"&&(h=h.slice(0,-1)),{child:(m="")=>{var v,b;return m=m.trim(),m=m.replace(/\/\//g,"/"),m.charAt(m.length-1)==="/"&&(m=m.slice(0,-1)),m.charAt(0)!=="/"&&(m="/"+m),(b=(v=x.local())==null?void 0:v.database())==null?void 0:b.ref(h+m)},push:(...m)=>{var b,k;let v=yr();return!m.length>0?{getKey:()=>v}:(k=(b=x.local())==null?void 0:b.database())==null?void 0:k.ref(h+"/"+v).create(m)},create:(...m)=>{var T,_;let v=$($({},(_=(T=x.local(E))==null?void 0:T.database())==null?void 0:_.ref(h)),x),{data:b,callback:k}=g(m);return P(E,"create",A,b,v)},get:(...m)=>{var T,_;let v=$($({},(_=(T=x.local())==null?void 0:T.database())==null?void 0:_.ref(h)),x),{data:b,callback:k}=g(m);return P("get",A,b,v,k)},find:(...m)=>{var T,_;let v=$($({},(_=(T=x.local())==null?void 0:T.database())==null?void 0:_.ref(h)),x),{data:b,callback:k}=g(m);return P("get",A,b,v,k)},query:()=>{},update:(...m)=>{var T,_;let v=$($({},(_=(T=x.local())==null?void 0:T.database())==null?void 0:_.ref(h)),x),{data:b,callback:k}=g(m);return P("update",A,b,v,k)},delete:(...m)=>{var T,_;let v=$($({},(_=(T=x.local())==null?void 0:T.database())==null?void 0:_.ref(h)),x),{data:b,callback:k}=g(m);return P("delete",A,b,v,k)},on:()=>{var v,b;let m=$($({},(b=(v=x.local())==null?void 0:v.database())==null?void 0:b.ref(h)),x);return f(h,m)},onValue:m=>{var k,T,_,R,I,O,U;let v=$($({},(T=(k=x.local())==null?void 0:k.database())==null?void 0:T.ref(h)),x),b=(R=(_=x.local())==null?void 0:_.database())==null?void 0:R.ref(h);return(I=b==null?void 0:b.on())==null||I.create(m),(O=b==null?void 0:b.on())==null||O.update(m),(U=b==null?void 0:b.on())==null||U.delete(m),v}}}}),cache:(A="/cache")=>{var x;let h=this.init(e);return delete h.auth().login,delete h.auth().register,(x=h.local())==null?void 0:x.database(A)},storage:()=>({})}},$online:navigator==null?void 0:navigator.onLine,auth:()=>{var E;return{$io:(E=e==null?void 0:e.socket)==null?void 0:E.auth,connected:()=>{var w,A;return(A=(w=e==null?void 0:e.socket)==null?void 0:w.auth)==null?void 0:A.connected},event:w=>{var A;return D(w,(A=e==null?void 0:e.socket)==null?void 0:A.auth)},ready:w=>{var A;return j(w,(A=e==null?void 0:e.socket)==null?void 0:A.auth)},$currentUserId:(()=>{let w=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return w.uid?w.uid:!1})(),$status:(()=>{let w=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(w.status)return w.status})(),status:(...w)=>{var v,b,k,T;let A,h,x=this.init(e);if(delete x.auth().login,delete x.auth().register,w.length===1)typeof w[0]=="string"?A=w[0]:typeof w[0]=="function"&&(h=w[0]);else if(w.length>=2){const[_,R]=w;typeof _=="string"&&(A=_),h=R}let m=(b=(v=e==null?void 0:e.socket)==null?void 0:v.auth)==null?void 0:b.id;if(m){if(!A){let _=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");_.uid&&(A=_.uid)}A&&m&&((T=(k=e==null?void 0:e.socket)==null?void 0:k.auth)==null||T.on((i==null?void 0:i.AUTH)+Pe.user.status,_=>{t==="dev"&&console.log("The user with id: ",A," is disconnected/connected: ",_==null?void 0:_.value),typeof h=="function"&&h($({value:_},x))}))}return $({},x)},device:{connected:(...w)=>{var v,b,k,T;let A=this.init(e);delete A.auth().login,delete A.auth().register;let h,x;if(w.length===1)typeof w[0]=="string"?h=w[0]:typeof w[0]=="function"&&(x=w[0]);else if(w.length>=2){const[_,R]=w;typeof _=="string"&&(h=_),x=R}let m=(b=(v=e==null?void 0:e.socket)==null?void 0:v.auth)==null?void 0:b.id;if(m){if(!h){let _=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");_.uid&&(h=_.uid)}h&&m&&((T=(k=e==null?void 0:e.socket)==null?void 0:k.auth)==null||T.on((i==null?void 0:i.AUTH)+Pe.user.device.connected,_=>{t==="dev"&&console.log("The user with id: ",h," has this device connected: ",_==null?void 0:_.value),typeof x=="function"&&x(ee($($({},A.auth().device),A),{value:_}))}))}return $($({},A.auth().device),A)},disconnected:(...w)=>{var v,b,k,T;let A=this.init(e);delete A.auth().login,delete A.auth().register;let h,x;if(w.length===1)typeof w[0]=="string"?h=w[0]:typeof w[0]=="function"&&(x=w[0]);else if(w.length>=2){const[_,R]=w;typeof _=="string"&&(h=_),x=R}let m=(b=(v=e==null?void 0:e.socket)==null?void 0:v.auth)==null?void 0:b.id;if(m){if(!h){let _=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");_.uid&&(h=_.uid)}h&&m&&((T=(k=e==null?void 0:e.socket)==null?void 0:k.auth)==null||T.on((i==null?void 0:i.AUTH)+Pe.user.device.disconnected,_=>{t==="dev"&&console.log("The user with id: ",h," has this device connected: ",_==null?void 0:_.value),typeof x=="function"&&x(ee($($({},A.auth().device),A),{value:_}))}))}return $($({},A.auth().device),A)},remove:(...w)=>{var b,k,T,_,R,I;let A=this.init(e);delete A.auth().login,delete A.auth().register;let h,x;if(w.length===1)typeof w[0]=="string"?h=w[0]:typeof w[0]=="function"&&(x=w[0]);else if(w.length>=2){const[O,U]=w;(typeof O=="string"||Array.isArray(O))&&(h=O),x=U}let m=(k=(b=e==null?void 0:e.socket)==null?void 0:b.auth)==null?void 0:k.id,v=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return h&&v.uid&&m&&((_=(T=e==null?void 0:e.socket)==null?void 0:T.auth)==null||_.emit((i==null?void 0:i.AUTH)+bn.user.device.remove,{socketId:m,userId:h,currentUserId:v.uid}),(I=(R=e==null?void 0:e.socket)==null?void 0:R.auth)==null||I.on((i==null?void 0:i.AUTH)+Pe.user.device.removed,O=>{t==="dev"&&console.log("The user with id: ",h," has this device connected: ",O==null?void 0:O.value),typeof x=="function"&&x(ee($($({},A.auth().device),A),{value:O}))})),$($({},A.auth().device),A)},list:(...w)=>{var k,T,_,R;let A=this.init(e);delete A.auth().login,delete A.auth().register;let h=bn.users.device.list,x,m;if(w.length===1)typeof w[0]=="string"?x=w[0]:typeof w[0]=="function"&&(m=w[0]);else if(w.length>=2){const[I,O]=w;typeof I=="string"&&(x=I,h=bn.user.device.list),m=O}let v=(T=(k=e==null?void 0:e.socket)==null?void 0:k.auth)==null?void 0:T.id,b=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");return v&&b.uid&&(x||(h=bn.user.device.list,x=b.uid),x&&v&&((_=e==null?void 0:e.socket.auth)==null||_.emit((i==null?void 0:i.AUTH)+h,{socketId:v,userId:x,currenUserId:b.uid}),(R=e==null?void 0:e.socket.auth)==null||R.on((i==null?void 0:i.AUTH)+h+"/",I=>{t==="dev"&&console.log("The user with id: ",x," has these devices connected: ",res==null?void 0:res.value),typeof m=="function"&&m(ee($($({},A.auth().device),A),{value:I}))}))),$($({},A.auth().device),A)}},req:(w,A,h)=>{let x=this.init(e);delete x.auth().login,delete x.auth().register;let m=$($({},x),x.auth());return d(w+Ve.req,A,null,m,h)},$user:(()=>{let w=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");if(w.uid)return w})(),user:(...w)=>{let A,h;w.length>1?(typeof w[0]=="string"&&(A=w[0]),typeof w[1]=="function"&&(h=w[1])):w.length===1&&(typeof w[0]=="string"&&(A=w[0]),typeof w[0]=="function"&&(h=w[0]));let x=this.init(e);delete x.auth().login,delete x.auth().register;let m=$($({},x),x.auth());if(!A||typeof A!="string"){let v=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}"),b=localStorage.getItem("accessToken"),k=(()=>{var T;try{let _=Gi(b);return(Date==null?void 0:Date.parse((T=new Date((_==null?void 0:_.exp)*1e3))==null?void 0:T.toString()))>Date.now()}catch(_){return!1}})();return v.uid&&k?(typeof h=="function"&&h(ee($({},m),{value:v})),ee($({},m),{val:()=>v})):d(Ve.user,{},null,null,({value:T})=>{var R;let _=T;_!=null&&_.data&&(_={data:(R=_==null?void 0:_.data)==null?void 0:R.data},_.data&&localStorage.setItem("userInfo",JSON.stringify(_.data))),typeof h=="function"&&h(ee($({},m),{value:_}))})}else return d(Ve.user,{uid:A},null,null,({value:v})=>{var k;let b=v;b!=null&&b.data&&(b={data:(k=b==null?void 0:b.data)==null?void 0:k.data}),typeof h=="function"&&h(ee($({},m),{value:b}))})},verifyEmailCode:(w,A)=>{let h=this.init(e);return delete h.auth().login,delete h.auth().register,d(Ve.verify_email_code,w,null,null,({value:x})=>{L({value:x,node:h},A)})},verifyTokenCode:(w,A)=>{let h=this.init(e);return delete h.auth().login,delete h.auth().register,d(Ve.verify_token_code,w,null,null,({value:x})=>{L({value:x,node:h},A)})},verifyPassCode:(w,A)=>{let h=this.init(e);return delete h.auth().login,delete h.auth().register,d(Ve.verify_pass_code,w,null,null,({value:x})=>{L({value:x,node:h},A)})},login:(w,A)=>{let h=this.init(e);return delete h.auth().login,delete h.auth().register,d(Ve.login,w,null,null,({value:x})=>{L({value:x,node:h},A)})},loginWithToken:(w,A)=>{let h=this.init(e);return delete h.auth().login,delete h.auth().register,localStorage.setItem("userInfo","{}"),localStorage.setItem("accessToken",""),localStorage.setItem("refreshToken",w),this.init(e).auth.user(null,A)},logout:w=>{let A=this.init(e);return localStorage.removeItem("refreshToken"),localStorage.removeItem("userInfo"),localStorage.removeItem("accessToken"),(()=>C(this,null,function*(){var x,m,v,b,k,T;yield(v=(m=(x=J(this,Ae))==null?void 0:x.ref("/database"))==null?void 0:m.remove())==null?void 0:v.catch(_=>{}),yield(T=(k=(b=J(this,Ae))==null?void 0:b.ref("/transaction"))==null?void 0:k.remove())==null?void 0:T.catch(_=>{})}))().then(x=>{}).catch(x=>{}),typeof w=="function"&&w($($({},A),A.auth())),$($({},A),A.auth())},register:(w,A)=>{let h=this.init(e);return delete h.auth().login,delete h.auth().register,d(Ve.register,w,null,null,({value:x})=>{L({value:x,node:h},A)})},forgotPassword:(w,A)=>d(Ve.forgotPassword,w,null,null,A),users:()=>{let w=this.init(e);return delete w.auth().login,delete w.auth().register,w.ref("/users")},tokens:()=>{let w=this.init(e);return delete w.auth().login,delete w.auth().register,w.ref("/tokens")}}},syncDatabase:(E=!0)=>{const w=this.init(e);return ct(this,Qe,typeof E=="boolean"?E:!0),w.database()},ref:(E="",w={host:n.AUTH,version:i.AUTH,base:Ve.base},A=(x=>(x=e==null?void 0:e.socket)==null?void 0:x.socket)(),h=!0)=>{E=E.trim(),E=E.replace(/\/\//g,"/"),E.charAt(0)==="/"&&E.length<=1&&(E="/root"),E.charAt(E.length-1)==="/"&&(E=E.slice(0,-1));const m=w.host+w.version+w.base+E;let v=this.init(e);return delete v.auth().login,delete v.auth().register,ct(this,bt,h),{push:(...b)=>{let k=yr();return!b.length>0?{getKey:()=>k}:v.ref(E+"/"+k,w,A).create(b)},private:(b=S())=>v.ref(E+"/ps"+b+"/pe",w,A),setAuthAccess:(b=!0,k=J(this,Tt))=>(ct(this,Tt,k),v.ref(E,w,A,b)),req:(...b)=>{let k=$($({},v.ref(E,w,A)),v);if(b.length>=2){let[T="post",_={},R={},I]=b;if(typeof T=="string"&&["post","put","delete","get"].includes(T)){let O=Oe.req;return p(T,m+O,_,R,k,I)}return k}else{let T=b.filter(_=>typeof _=="function");if(T.length>0)T=T[0],typeof T=="function"&&T(k);else return k}},child:(b="")=>(b=b.trim(),b=b.replace(/\/\//g,"/"),b.charAt(b.length-1)==="/"&&(b=b.slice(0,-1)),b.charAt(0)!=="/"&&(b="/"+b),v.ref(E+b,w,A)),set:(...b)=>{var k;return(k=v.ref(E,w,A))==null?void 0:k.create(...b)},create:(...b)=>{var T,_,R,I;let k=$($({},v.ref(E,w,A)),v);if(v.auth().$currentUserId&&E.includes("/users")&&J(this,Qe)&&!J(this,$e))return(R=(_=(T=v.local())==null?void 0:T.database())==null?void 0:_.ref(E))==null?void 0:R.create(...b);{let{data:O,onRequest:U,callback:K}=g(b),q=Oe.create.one;if(J(this,Ge)){if((O==null?void 0:O.file)||(O==null?void 0:O.directory))return(I=v.ref(E))==null?void 0:I.upload(O,null,K);Array.isArray(O.folders)&&(q=Oe.create.many)}else Array!=null&&Array.isArray(O)&&(q=Oe.create.many);return p("post",m+q,O,U,k,K)}},find:(...b)=>{var k,T,_,R;if(console.log("Database connected: ",J(this,$e)),v.auth().$currentUserId&&E.includes("/users")&&J(this,Qe)&&!J(this,$e))return t==="dev"&&console.log("Find: We are offline"),(_=(T=(k=v.local())==null?void 0:k.database())==null?void 0:T.ref(E))==null?void 0:_.find(...b);{t==="dev"&&console.log("Find: We are online");let I=$($({},v.ref(E,w,A)),v),{data:O,onRequest:U,callback:K}=g(b),q=Oe.find.one;return J(this,Ge)?(Array.isArray(O==null?void 0:O.files)||Array.isArray(O==null?void 0:O.folders))&&(Array.isArray(O==null?void 0:O.files)&&(O.isFolder=!1),Array.isArray(O==null?void 0:O.folders)&&(O.isFolder=!0),q=Oe.find.many):(((R=Object.keys(O))==null?void 0:R.length)<=0||O.order||O.where||O.$option||O.skip||O.take)&&(q=Oe.find.many),p("post",m+q,O,U,I,K)}},get:(...b)=>{var k,T,_,R;if(v.auth().$currentUserId&&E.includes("/users")&&J(this,Qe)&&!J(this,$e))return(_=(T=(k=v.local())==null?void 0:k.database())==null?void 0:T.ref(E))==null?void 0:_.get(...b);{let I=$($({},v.ref(E,w,A)),v),{data:O,onRequest:U,callback:K}=g(b),q=Oe.get.one;return J(this,Ge)?(Array.isArray(O==null?void 0:O.files)||Array.isArray(O==null?void 0:O.folders))&&(Array.isArray(O==null?void 0:O.files)&&(O.isFolder=!1),Array.isArray(O==null?void 0:O.folders)&&(O.isFolder=!0),q=Oe.get.many):(((R=Object.keys(O))==null?void 0:R.length)<=0||O.order||O.where||O.$option||O.skip||O.take)&&(q=Oe.get.many),p("get",m+q+"?query="+JSON.stringify(o(O)),null,U,I,K)}},query:(...b)=>{var k,T,_;if(v.auth().$currentUserId&&E.includes("/users")&&J(this,Qe)&&!J(this,$e))return(_=(T=(k=v.local())==null?void 0:k.database())==null?void 0:T.ref(E))==null?void 0:_.query(...b);{let R=$($({},v.ref(E,w,A)),v),{data:I,onRequest:O,callback:U}=g(b);return(!I||I==="")&&(I={take:15},!J(this,Mt)&&!I.order&&(I.order={uid:"ASC"})),p("get",m+Oe.get.many+"?query="+JSON.stringify(o(I)),null,O,R,U)}},update:(...b)=>{var k,T,_;if(v.auth().$currentUserId&&E.includes("/users")&&J(this,Qe)&&!J(this,$e))return(_=(T=(k=v.local())==null?void 0:k.database())==null?void 0:T.ref(E))==null?void 0:_.update(...b);{let R=$($({},v.ref(E,w,A)),v),{data:I,onRequest:O,callback:U}=g(b),K=Oe.update.one;return J(this,Ge)?(Array.isArray(I==null?void 0:I.files)||Array.isArray(I==null?void 0:I.folders))&&(Array.isArray(I==null?void 0:I.files)&&(I.isFolder=!1),Array.isArray(I==null?void 0:I.folders)&&(I.isFolder=!0),K=Oe.update.many):Array.isArray(I)&&(K=Oe.find.many),p("put",m+K,I,O,R,U)}},delete:(...b)=>{var k,T,_;if(v.auth().$currentUserId&&E.includes("/users")&&J(this,Qe)&&!J(this,$e))return(_=(T=(k=v.local())==null?void 0:k.database())==null?void 0:T.ref(E))==null?void 0:_.delete(...b);{let R=$($({},v.ref(E,w,A)),v),{data:I,onRequest:O,callback:U}=g(b),K=Oe.delete.one;return J(this,Ge)?(Array.isArray(I==null?void 0:I.files)||Array.isArray(I==null?void 0:I.folders))&&(Array.isArray(I==null?void 0:I.files)&&(I.isFolder=!1),Array.isArray(I==null?void 0:I.folders)&&(I.isFolder=!0),Object.keys(I).length<=0&&(I.isFolder=!0),K=Oe.delete.many):(Array.isArray(I)||I.where)&&(K=Oe.delete.many),p("delete",m+K,I,O,R,U)}},on:()=>{let b=$($({},v.ref(E,w,A)),v);return l(A,w,b,E)},onValue:b=>{let k=$($({},v.ref(E,w,A)),v),T=v.ref(E,w,A);return T==null||T.on().create(b),T==null||T.on().update(b),T==null||T.on().delete(b),T==null||T.on().upload(b),k}}}}});ct(this,Ot,e);let{ENV:t,OFFLINE_DB_NAME:n}=J(this,Ot);ct(this,Ae,un.WithIndexedDB((n==null?void 0:n.AUTH)||"swyger_auth"));let i=()=>C(this,null,function*(){try{let s,o=localStorage.getItem("accessToken");if((()=>{var c;try{s=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let u=Gi(o);return(Date==null?void 0:Date.parse((c=new Date((u==null?void 0:u.exp)*1e3))==null?void 0:c.toString()))<Date.now()}catch(u){return!1}})()&&s.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(c){}}catch(s){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}Ft=new WeakMap,bt=new WeakMap,Tt=new WeakMap,Mt=new WeakMap,Ge=new WeakMap,Gr=new WeakMap,Wn=new WeakMap,zn=new WeakMap,on=new WeakMap,Qe=new WeakMap,$e=new WeakMap,Ot=new WeakMap,Ae=new WeakMap;const xf={init:r=>{try{return(e={})=>new bf(r).init(e)}catch(e){return{}}}};let Ef={init:r=>{var e,t,n;return{OFFLINE_DB_NAME:{AUTH:((e=r==null?void 0:r.OFFLINE_DB_NAME)==null?void 0:e.AUTH)||"swyger_auth"},ENV:(r==null?void 0:r.ENV)||"prod",HOST_SERVER:{AUTH:((t=r==null?void 0:r.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100"},API_VERSION:{AUTH:((n=r==null?void 0:r.API_VERSION)==null?void 0:n.AUTH)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(r==null?void 0:r.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(r==null?void 0:r.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const kp={init:r=>{let e=Ef.init(r);const t=$c.init(e),n={socket:{auth:t==null?void 0:t.auth,database:t==null?void 0:t.database,storage:t==null?void 0:t.storage}};return xf.init(e)(n)}};var Wr=function(r,e){return Wr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},Wr(r,e)};function we(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Wr(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function kf(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(f){o(f)}}function c(l){try{u(n.throw(l))}catch(f){o(f)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(r,e||[])).next())})}function pi(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function De(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function le(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function fe(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))}function Ut(r){return this instanceof Ut?(this.v=r,this):new Ut(r)}function Af(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(y){n[y]&&(i[y]=function(d){return new Promise(function(p,g){s.push([y,d,p,g])>1||a(y,d)})})}function a(y,d){try{c(n[y](d))}catch(p){f(s[0][3],p)}}function c(y){y.value instanceof Ut?Promise.resolve(y.value.v).then(u,l):f(s[0][2],y)}function u(y){a("next",y)}function l(y){a("throw",y)}function f(y,d){y(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Sf(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof De=="function"?De(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=r[s]&&function(o){return new Promise(function(a,c){o=r[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function X(r){return typeof r=="function"}function Rt(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Rn=Rt(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function ft(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var Fe=function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=De(o),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(g){e={error:g}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(X(l))try{l()}catch(g){s=g instanceof Rn?g.errors:[g]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var y=De(f),d=y.next();!d.done;d=y.next()){var p=d.value;try{ks(p)}catch(g){s=s!=null?s:[],g instanceof Rn?s=fe(fe([],le(s)),le(g.errors)):s.push(g)}}}catch(g){n={error:g}}finally{try{d&&!d.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}}}if(s)throw new Rn(s)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)ks(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ft(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&ft(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=function(){var e=new r;return e.closed=!0,e}(),r}(),Bo=Fe.EMPTY;function Lo(r){return r instanceof Fe||r&&"closed"in r&&X(r.remove)&&X(r.add)&&X(r.unsubscribe)}function ks(r){X(r)?r():r.unsubscribe()}var kt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Un={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=Un.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,fe([r,e],le(t))):setTimeout.apply(void 0,fe([r,e],le(t)))},clearTimeout:function(r){var e=Un.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(r)},delegate:void 0};function Do(r){Un.setTimeout(function(){var e=kt.onUnhandledError;if(e)e(r);else throw r})}function ve(){}var _f=function(){return yi("C",void 0,void 0)}();function Tf(r){return yi("E",void 0,r)}function Of(r){return yi("N",r,void 0)}function yi(r,e,t){return{kind:r,value:e,error:t}}var _t=null;function Cn(r){if(kt.useDeprecatedSynchronousErrorHandling){var e=!_t;if(e&&(_t={errorThrown:!1,error:null}),r(),e){var t=_t,n=t.errorThrown,i=t.error;if(_t=null,n)throw i}}else r()}function Pf(r){kt.useDeprecatedSynchronousErrorHandling&&_t&&(_t.errorThrown=!0,_t.error=r)}var Zn=function(r){we(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Lo(t)&&t.add(n)):n.destination=Nf,n}return e.create=function(t,n,i){return new zt(t,n,i)},e.prototype.next=function(t){this.isStopped?Sr(Of(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?Sr(Tf(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?Sr(_f,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Fe),If=Function.prototype.bind;function Ar(r,e){return If.call(r,e)}var Rf=function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){xn(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){xn(n)}else xn(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){xn(t)}},r}(),zt=function(r){we(e,r);function e(t,n,i){var s=r.call(this)||this,o;if(X(t)||!t)o={next:t!=null?t:void 0,error:n!=null?n:void 0,complete:i!=null?i:void 0};else{var a;s&&kt.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&Ar(t.next,a),error:t.error&&Ar(t.error,a),complete:t.complete&&Ar(t.complete,a)}):o=t}return s.destination=new Rf(o),s}return e}(Zn);function xn(r){kt.useDeprecatedSynchronousErrorHandling?Pf(r):Do(r)}function Cf(r){throw r}function Sr(r,e){var t=kt.onStoppedNotification;t&&Un.setTimeout(function(){return t(r,e)})}var Nf={closed:!0,next:ve,error:Cf,complete:ve},er=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function _e(r){return r}function mi(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Uo(r)}function Uo(r){return r.length===0?_e:r.length===1?r[0]:function(t){return r.reduce(function(n,i){return i(n)},t)}}var ne=function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var i=this,s=jf(e)?e:new zt(e,t,n);return Cn(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=As(t),new t(function(i,s){var o=new zt({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});n.subscribe(o)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[er]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Uo(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=As(e),new e(function(n,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},r.create=function(e){return new r(e)},r}();function As(r){var e;return(e=r!=null?r:kt.Promise)!==null&&e!==void 0?e:Promise}function $f(r){return r&&X(r.next)&&X(r.error)&&X(r.complete)}function jf(r){return r&&r instanceof Zn||$f(r)&&Lo(r)}function Fo(r){return X(r==null?void 0:r.lift)}function V(r){return function(e){if(Fo(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function z(r,e,t,n,i){return new gi(r,e,t,n,i)}var gi=function(r){we(e,r);function e(t,n,i,s,o,a){var c=r.call(this,t)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=n?function(u){try{n(u)}catch(l){t.error(l)}}:r.prototype._next,c._error=s?function(u){try{s(u)}catch(l){t.error(l)}finally{this.unsubscribe()}}:r.prototype._error,c._complete=i?function(){try{i()}catch(u){t.error(u)}finally{this.unsubscribe()}}:r.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;r.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(Zn);function Mo(){return V(function(r,e){var t=null;r._refCount++;var n=z(e,void 0,void 0,void 0,function(){if(!r||r._refCount<=0||0<--r._refCount){t=null;return}var i=r._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});r.subscribe(n),n.closed||(t=r.connect())})}var tr=function(r){we(e,r);function e(t,n){var i=r.call(this)||this;return i.source=t,i.subjectFactory=n,i._subject=null,i._refCount=0,i._connection=null,Fo(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,n=this._connection;if(!n){n=this._connection=new Fe;var i=this.getSubject();n.add(this.source.subscribe(z(i,void 0,function(){t._teardown(),i.complete()},function(s){t._teardown(),i.error(s)},function(){return t._teardown()}))),n.closed&&(this._connection=null,n=Fe.EMPTY)}return n},e.prototype.refCount=function(){return Mo()(this)},e}(ne),Ko={now:function(){return(Ko.delegate||performance).now()},delegate:void 0},Pt={schedule:function(r){var e=requestAnimationFrame,t=cancelAnimationFrame,n=Pt.delegate;n&&(e=n.requestAnimationFrame,t=n.cancelAnimationFrame);var i=e(function(s){t=void 0,r(s)});return new Fe(function(){return t==null?void 0:t(i)})},requestAnimationFrame:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Pt.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,fe([],le(r)))},cancelAnimationFrame:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Pt.delegate;return((t==null?void 0:t.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,fe([],le(r)))},delegate:void 0};function Bf(r){return r?Wo(r):Lf}function Wo(r){return new ne(function(e){var t=r||Ko,n=t.now(),i=0,s=function(){e.closed||(i=Pt.requestAnimationFrame(function(o){i=0;var a=t.now();e.next({timestamp:r?a:o,elapsed:a-n}),s()}))};return s(),function(){i&&Pt.cancelAnimationFrame(i)}})}var Lf=Wo(),zo=Rt(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),xe=function(r){we(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new Ss(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new zo},e.prototype.next=function(t){var n=this;Cn(function(){var i,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var o=De(n.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(t)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var n=this;Cn(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var i=n.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;Cn(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?Bo:(this.currentObservers=null,a.push(t),new Fe(function(){n.currentObservers=null,ft(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,s=n.thrownError,o=n.isStopped;i?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new ne;return t.source=this,t},e.create=function(t,n){return new Ss(t,n)},e}(ne),Ss=function(r){we(e,r);function e(t,n){var i=r.call(this)||this;return i.destination=t,i.source=n,i}return e.prototype.next=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,t)},e.prototype.error=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&i!==void 0?i:Bo},e}(xe),Vo=function(r){we(e,r);function e(t){var n=r.call(this)||this;return n._value=t,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var n=r.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},e.prototype.getValue=function(){var t=this,n=t.hasError,i=t.thrownError,s=t._value;if(n)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){r.prototype.next.call(this,this._value=t)},e}(xe),nr={now:function(){return(nr.delegate||Date).now()},delegate:void 0},vi=function(r){we(e,r);function e(t,n,i){t===void 0&&(t=1/0),n===void 0&&(n=1/0),i===void 0&&(i=nr);var s=r.call(this)||this;return s._bufferSize=t,s._windowTime=n,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,n),s}return e.prototype.next=function(t){var n=this,i=n.isStopped,s=n._buffer,o=n._infiniteTimeWindow,a=n._timestampProvider,c=n._windowTime;i||(s.push(t),!o&&s.push(a.now()+c)),this._trimBuffer(),r.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(t),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!t.closed;c+=s?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),n},e.prototype._trimBuffer=function(){var t=this,n=t._bufferSize,i=t._timestampProvider,s=t._buffer,o=t._infiniteTimeWindow,a=(o?1:2)*n;if(n<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),u=0,l=1;l<s.length&&s[l]<=c;l+=2)u=l;u&&s.splice(0,u+1)}},e}(xe),wi=function(r){we(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,s=n._hasValue,o=n._value,a=n.thrownError,c=n.isStopped,u=n._isComplete;i?t.error(a):(c||u)&&(s&&t.next(o),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,n=t._hasValue,i=t._value,s=t._isComplete;s||(this._isComplete=!0,n&&r.prototype.next.call(this,i),r.prototype.complete.call(this))},e}(xe),Df=function(r){we(e,r);function e(t,n){return r.call(this)||this}return e.prototype.schedule=function(t,n){return this},e}(Fe),Fn={setInterval:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=Fn.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,fe([r,e],le(t))):setInterval.apply(void 0,fe([r,e],le(t)))},clearInterval:function(r){var e=Fn.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(r)},delegate:void 0},ln=function(r){we(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return e.prototype.schedule=function(t,n){var i;if(n===void 0&&(n=0),this.closed)return this;this.state=t;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,n)),this.pending=!0,this.delay=n,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,n),this},e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),Fn.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,n,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return n;n!=null&&Fn.clearInterval(n)},e.prototype.execute=function(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,n){var i=!1,s;try{this.work(t)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,n=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ft(s,this),n!=null&&(this.id=this.recycleAsyncId(i,n,null)),this.delay=null,r.prototype.unsubscribe.call(this)}},e}(Df),Uf=1,_r,zr={};function _s(r){return r in zr?(delete zr[r],!0):!1}var Ho={setImmediate:function(r){var e=Uf++;return zr[e]=!0,_r||(_r=Promise.resolve()),_r.then(function(){return _s(e)&&r()}),e},clearImmediate:function(r){_s(r)}},Ff=Ho.setImmediate,Mf=Ho.clearImmediate,Mn={setImmediate:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Mn.delegate;return((t==null?void 0:t.setImmediate)||Ff).apply(void 0,fe([],le(r)))},clearImmediate:function(r){var e=Mn.delegate;return((e==null?void 0:e.clearImmediate)||Mf)(r)},delegate:void 0},Kf=function(r){we(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!==null&&i>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=Mn.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,n,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return r.prototype.recycleAsyncId.call(this,t,n,i);var o=t.actions;n!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==n&&(Mn.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))},e}(ln),Vr=function(){function r(e,t){t===void 0&&(t=r.now),this.schedulerActionCtor=e,this.now=t}return r.prototype.schedule=function(e,t,n){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},r.now=nr.now,r}(),fn=function(r){we(e,r);function e(t,n){n===void 0&&(n=Vr.now);var i=r.call(this,t,n)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var n=this.actions;if(this._active){n.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=n.shift());if(this._active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}},e}(Vr),Wf=function(r){we(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var n=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw s}},e}(fn),Jo=new Wf(Kf),zf=Jo,Ye=new fn(ln),bi=Ye,Vf=function(r){we(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.schedule=function(t,n){return n===void 0&&(n=0),n>0?r.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,n){return n>0||this.closed?r.prototype.execute.call(this,t,n):this._execute(t,n)},e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.flush(this),0)},e}(ln),Hf=function(r){we(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(fn),qo=new Hf(Vf),Jf=qo,qf=function(r){we(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!==null&&i>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=Pt.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,n,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return r.prototype.recycleAsyncId.call(this,t,n,i);var o=t.actions;n!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==n&&(Pt.cancelAnimationFrame(n),t._scheduled=void 0)},e}(ln),Yf=function(r){we(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var n=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw s}},e}(fn),Yo=new Yf(qf),Gf=Yo,Qf=function(r){we(e,r);function e(t,n){t===void 0&&(t=Go),n===void 0&&(n=1/0);var i=r.call(this,t,function(){return i.frame})||this;return i.maxFrames=n,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,n=t.actions,i=t.maxFrames,s,o;(o=n[0])&&o.delay<=i&&(n.shift(),this.frame=o.delay,!(s=o.execute(o.state,o.delay))););if(s){for(;o=n.shift();)o.unsubscribe();throw s}},e.frameTimeFactor=10,e}(fn),Go=function(r){we(e,r);function e(t,n,i){i===void 0&&(i=t.index+=1);var s=r.call(this,t,n)||this;return s.scheduler=t,s.work=n,s.index=i,s.active=!0,s.index=t.index=i,s}return e.prototype.schedule=function(t,n){if(n===void 0&&(n=0),Number.isFinite(n)){if(!this.id)return r.prototype.schedule.call(this,t,n);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,n)}else return Fe.EMPTY},e.prototype.requestAsyncId=function(t,n,i){i===void 0&&(i=0),this.delay=t.frame+i;var s=t.actions;return s.push(this),s.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,n,i){},e.prototype._execute=function(t,n){if(this.active===!0)return r.prototype._execute.call(this,t,n)},e.sortActions=function(t,n){return t.delay===n.delay?t.index===n.index?0:t.index>n.index?1:-1:t.delay>n.delay?1:-1},e}(ln),ot=new ne(function(r){return r.complete()});function Xf(r){return r?Zf(r):ot}function Zf(r){return new ne(function(e){return r.schedule(function(){return e.complete()})})}function rr(r){return r&&X(r.schedule)}function xi(r){return r[r.length-1]}function hn(r){return X(xi(r))?r.pop():void 0}function ht(r){return rr(xi(r))?r.pop():void 0}function Qo(r,e){return typeof xi(r)=="number"?r.pop():e}var Ei=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function Xo(r){return X(r==null?void 0:r.then)}function Zo(r){return X(r[er])}function ea(r){return Symbol.asyncIterator&&X(r==null?void 0:r[Symbol.asyncIterator])}function ta(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function eh(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var na=eh();function ra(r){return X(r==null?void 0:r[na])}function ia(r){return Af(this,arguments,function(){var t,n,i,s;return pi(this,function(o){switch(o.label){case 0:t=r.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Ut(t.read())];case 3:return n=o.sent(),i=n.value,s=n.done,s?[4,Ut(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Ut(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function sa(r){return X(r==null?void 0:r.getReader)}function Y(r){if(r instanceof ne)return r;if(r!=null){if(Zo(r))return th(r);if(Ei(r))return nh(r);if(Xo(r))return rh(r);if(ea(r))return oa(r);if(ra(r))return ih(r);if(sa(r))return sh(r)}throw ta(r)}function th(r){return new ne(function(e){var t=r[er]();if(X(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function nh(r){return new ne(function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}function rh(r){return new ne(function(e){r.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Do)})}function ih(r){return new ne(function(e){var t,n;try{for(var i=De(r),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){t={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()})}function oa(r){return new ne(function(e){oh(r,e).catch(function(t){return e.error(t)})})}function sh(r){return oa(ia(r))}function oh(r,e){var t,n,i,s;return kf(this,void 0,void 0,function(){var o,a;return pi(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=Sf(r),c.label=1;case 1:return[4,t.next()];case 2:if(n=c.sent(),!!n.done)return[3,4];if(o=n.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Ue(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(s),!i)return s}function ir(r,e){return e===void 0&&(e=0),V(function(t,n){t.subscribe(z(n,function(i){return Ue(n,r,function(){return n.next(i)},e)},function(){return Ue(n,r,function(){return n.complete()},e)},function(i){return Ue(n,r,function(){return n.error(i)},e)}))})}function sr(r,e){return e===void 0&&(e=0),V(function(t,n){n.add(r.schedule(function(){return t.subscribe(n)},e))})}function ah(r,e){return Y(r).pipe(sr(e),ir(e))}function ch(r,e){return Y(r).pipe(sr(e),ir(e))}function uh(r,e){return new ne(function(t){var n=0;return e.schedule(function(){n===r.length?t.complete():(t.next(r[n++]),t.closed||this.schedule())})})}function aa(r,e){return new ne(function(t){var n;return Ue(t,e,function(){n=r[na](),Ue(t,e,function(){var i,s,o;try{i=n.next(),s=i.value,o=i.done}catch(a){t.error(a);return}o?t.complete():t.next(s)},0,!0)}),function(){return X(n==null?void 0:n.return)&&n.return()}})}function ca(r,e){if(!r)throw new Error("Iterable cannot be null");return new ne(function(t){Ue(t,e,function(){var n=r[Symbol.asyncIterator]();Ue(t,e,function(){n.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function lh(r,e){return ca(ia(r),e)}function ua(r,e){if(r!=null){if(Zo(r))return ah(r,e);if(Ei(r))return uh(r,e);if(Xo(r))return ch(r,e);if(ea(r))return ca(r,e);if(ra(r))return aa(r,e);if(sa(r))return lh(r,e)}throw ta(r)}function dt(r,e){return e?ua(r,e):Y(r)}function ki(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=ht(r);return dt(r,t)}function la(r,e){var t=X(r)?r:function(){return r},n=function(i){return i.error(t())};return new ne(e?function(i){return e.schedule(n,0,i)}:n)}var Hr;(function(r){r.NEXT="N",r.ERROR="E",r.COMPLETE="C"})(Hr||(Hr={}));var Nn=function(){function r(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue=e==="N"}return r.prototype.observe=function(e){return fa(this,e)},r.prototype.do=function(e,t,n){var i=this,s=i.kind,o=i.value,a=i.error;return s==="N"?e==null?void 0:e(o):s==="E"?t==null?void 0:t(a):n==null?void 0:n()},r.prototype.accept=function(e,t,n){var i;return X((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,n)},r.prototype.toObservable=function(){var e=this,t=e.kind,n=e.value,i=e.error,s=t==="N"?ki(n):t==="E"?la(function(){return i}):t==="C"?ot:0;if(!s)throw new TypeError("Unexpected notification kind "+t);return s},r.createNext=function(e){return new r("N",e)},r.createError=function(e){return new r("E",void 0,e)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r}();function fa(r,e){var t,n,i,s=r,o=s.kind,a=s.value,c=s.error;if(typeof o!="string")throw new TypeError('Invalid notification, missing "kind"');o==="N"?(t=e.next)===null||t===void 0||t.call(e,a):o==="E"?(n=e.error)===null||n===void 0||n.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function fh(r){return!!r&&(r instanceof ne||X(r.lift)&&X(r.subscribe))}var Ct=Rt(function(r){return function(){r(this),this.name="EmptyError",this.message="no elements in sequence"}});function hh(r,e){var t=typeof e=="object";return new Promise(function(n,i){var s=!1,o;r.subscribe({next:function(a){o=a,s=!0},error:i,complete:function(){s?n(o):t?n(e.defaultValue):i(new Ct)}})})}function dh(r,e){var t=typeof e=="object";return new Promise(function(n,i){var s=new zt({next:function(o){n(o),s.unsubscribe()},error:i,complete:function(){t?n(e.defaultValue):i(new Ct)}});r.subscribe(s)})}var Jr=Rt(function(r){return function(){r(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),ha=Rt(function(r){return function(t){r(this),this.name="NotFoundError",this.message=t}}),da=Rt(function(r){return function(t){r(this),this.name="SequenceError",this.message=t}});function Ai(r){return r instanceof Date&&!isNaN(r)}var pa=Rt(function(r){return function(t){t===void 0&&(t=null),r(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function ya(r,e){var t=Ai(r)?{first:r}:typeof r=="number"?{each:r}:r,n=t.first,i=t.each,s=t.with,o=s===void 0?ph:s,a=t.scheduler,c=a===void 0?e!=null?e:Ye:a,u=t.meta,l=u===void 0?null:u;if(n==null&&i==null)throw new TypeError("No timeout provided.");return V(function(f,y){var d,p,g=null,S=0,P=function(L){p=Ue(y,c,function(){try{d.unsubscribe(),Y(o({meta:l,lastValue:g,seen:S})).subscribe(y)}catch(j){y.error(j)}},L)};d=f.subscribe(z(y,function(L){p==null||p.unsubscribe(),S++,y.next(g=L),i>0&&P(i)},void 0,void 0,function(){p!=null&&p.closed||p==null||p.unsubscribe(),g=null})),!S&&P(n!=null?typeof n=="number"?n:+n-c.now():i)})}function ph(r){throw new pa(r)}function Nt(r,e){return V(function(t,n){var i=0;t.subscribe(z(n,function(s){n.next(r.call(e,s,i++))}))})}var yh=Array.isArray;function mh(r,e){return yh(e)?r.apply(void 0,fe([],le(e))):r(e)}function $t(r){return Nt(function(e){return mh(r,e)})}function Kn(r,e,t,n){if(t)if(rr(t))n=t;else return function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return Kn(r,e,n).apply(this,i).pipe($t(t))};return n?function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return Kn(r,e).apply(this,i).pipe(sr(n),ir(n))}:function(){for(var i=this,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=new wi,c=!0;return new ne(function(u){var l=a.subscribe(u);if(c){c=!1;var f=!1,y=!1;e.apply(i,fe(fe([],le(s)),[function(){for(var d=[],p=0;p<arguments.length;p++)d[p]=arguments[p];if(r){var g=d.shift();if(g!=null){a.error(g);return}}a.next(1<d.length?d:d[0]),y=!0,f&&a.complete()}])),y&&a.complete(),f=!0}return l})}}function gh(r,e,t){return Kn(!1,r,e,t)}function vh(r,e,t){return Kn(!0,r,e,t)}var wh=Array.isArray,bh=Object.getPrototypeOf,xh=Object.prototype,Eh=Object.keys;function ma(r){if(r.length===1){var e=r[0];if(wh(e))return{args:e,keys:null};if(kh(e)){var t=Eh(e);return{args:t.map(function(n){return e[n]}),keys:t}}}return{args:r,keys:null}}function kh(r){return r&&typeof r=="object"&&bh(r)===xh}function ga(r,e){return r.reduce(function(t,n,i){return t[n]=e[i],t},{})}function va(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=ht(r),n=hn(r),i=ma(r),s=i.args,o=i.keys;if(s.length===0)return dt([],t);var a=new ne(wa(s,t,o?function(c){return ga(o,c)}:_e));return n?a.pipe($t(n)):a}function wa(r,e,t){return t===void 0&&(t=_e),function(n){Ts(e,function(){for(var i=r.length,s=new Array(i),o=i,a=i,c=function(l){Ts(e,function(){var f=dt(r[l],e),y=!1;f.subscribe(z(n,function(d){s[l]=d,y||(y=!0,a--),a||n.next(t(s.slice()))},function(){--o||n.complete()}))},n)},u=0;u<i;u++)c(u)},n)}}function Ts(r,e,t){r?Ue(t,r,e):e()}function Si(r,e,t,n,i,s,o,a){var c=[],u=0,l=0,f=!1,y=function(){f&&!c.length&&!u&&e.complete()},d=function(g){return u<n?p(g):c.push(g)},p=function(g){s&&e.next(g),u++;var S=!1;Y(t(g,l++)).subscribe(z(e,function(P){i==null||i(P),s?d(P):e.next(P)},function(){S=!0},void 0,function(){if(S)try{u--;for(var P=function(){var L=c.shift();o?Ue(e,o,function(){return p(L)}):p(L)};c.length&&u<n;)P();y()}catch(L){e.error(L)}}))};return r.subscribe(z(e,d,function(){f=!0,y()})),function(){a==null||a()}}function tt(r,e,t){return t===void 0&&(t=1/0),X(e)?tt(function(n,i){return Nt(function(s,o){return e(n,s,i,o)})(Y(r(n,i)))},t):(typeof e=="number"&&(t=e),V(function(n,i){return Si(n,i,r,t)}))}function or(r){return r===void 0&&(r=1/0),tt(_e,r)}function _i(){return or(1)}function nn(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return _i()(dt(r,ht(r)))}function ar(r){return new ne(function(e){Y(r()).subscribe(e)})}var Ah={connector:function(){return new xe},resetOnDisconnect:!0};function Sh(r,e){e===void 0&&(e=Ah);var t=null,n=e.connector,i=e.resetOnDisconnect,s=i===void 0?!0:i,o=n(),a=new ne(function(c){return o.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=ar(function(){return r}).subscribe(o),s&&t.add(function(){return o=n()})),t},a}function _h(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=hn(r),n=ma(r),i=n.args,s=n.keys,o=new ne(function(a){var c=i.length;if(!c){a.complete();return}for(var u=new Array(c),l=c,f=c,y=function(p){var g=!1;Y(i[p]).subscribe(z(a,function(S){g||(g=!0,f--),u[p]=S},function(){return l--},void 0,function(){(!l||!g)&&(f||a.next(s?ga(s,u):u),a.complete())}))},d=0;d<c;d++)y(d)});return t?o.pipe($t(t)):o}var Th=["addListener","removeListener"],Oh=["addEventListener","removeEventListener"],Ph=["on","off"];function qr(r,e,t,n){if(X(t)&&(n=t,t=void 0),n)return qr(r,e,t).pipe($t(n));var i=le(Ch(r)?Oh.map(function(a){return function(c){return r[a](e,c,t)}}):Ih(r)?Th.map(Os(r,e)):Rh(r)?Ph.map(Os(r,e)):[],2),s=i[0],o=i[1];if(!s&&Ei(r))return tt(function(a){return qr(a,e,t)})(Y(r));if(!s)throw new TypeError("Invalid event target");return new ne(function(a){var c=function(){for(var u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];return a.next(1<u.length?u:u[0])};return s(c),function(){return o(c)}})}function Os(r,e){return function(t){return function(n){return r[t](e,n)}}}function Ih(r){return X(r.addListener)&&X(r.removeListener)}function Rh(r){return X(r.on)&&X(r.off)}function Ch(r){return X(r.addEventListener)&&X(r.removeEventListener)}function ba(r,e,t){return t?ba(r,e).pipe($t(t)):new ne(function(n){var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return n.next(o.length===1?o[0]:o)},s=r(i);return X(e)?function(){return e(i,s)}:void 0})}function Nh(r,e,t,n,i){var s,o,a,c;arguments.length===1?(s=r,c=s.initialState,e=s.condition,t=s.iterate,o=s.resultSelector,a=o===void 0?_e:o,i=s.scheduler):(c=r,!n||rr(n)?(a=_e,i=n):a=n);function u(){var l;return pi(this,function(f){switch(f.label){case 0:l=c,f.label=1;case 1:return!e||e(l)?[4,a(l)]:[3,4];case 2:f.sent(),f.label=3;case 3:return l=t(l),[3,1];case 4:return[2]}})}return ar(i?function(){return aa(u(),i)}:u)}function $h(r,e,t){return ar(function(){return r()?e:t})}function jt(r,e,t){r===void 0&&(r=0),t===void 0&&(t=bi);var n=-1;return e!=null&&(rr(e)?t=e:n=e),new ne(function(i){var s=Ai(r)?+r-t.now():r;s<0&&(s=0);var o=0;return t.schedule(function(){i.closed||(i.next(o++),0<=n?this.schedule(void 0,n):i.complete())},s)})}function xa(r,e){return r===void 0&&(r=0),e===void 0&&(e=Ye),r<0&&(r=0),jt(r,r,e)}function jh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=ht(r),n=Qo(r,1/0),i=r;return i.length?i.length===1?Y(i[0]):or(n)(dt(i,t)):ot}var Ea=new ne(ve);function Bh(){return Ea}var Lh=Array.isArray;function Jt(r){return r.length===1&&Lh(r[0])?r[0]:r}function ka(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Jt(r);return new ne(function(n){var i=0,s=function(){if(i<t.length){var o=void 0;try{o=Y(t[i++])}catch(c){s();return}var a=new gi(n,void 0,ve,ve);o.subscribe(a),a.add(s)}else n.complete()};s()})}function Dh(r,e){return dt(Object.entries(r),e)}function Uh(r,e){return function(t,n){return!r.call(e,t,n)}}function It(r,e){return V(function(t,n){var i=0;t.subscribe(z(n,function(s){return r.call(e,s,i++)&&n.next(s)}))})}function Fh(r,e,t){return[It(e,t)(Y(r)),It(Uh(e,t))(Y(r))]}function Mh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r=Jt(r),r.length===1?Y(r[0]):new ne(Aa(r))}function Aa(r){return function(e){for(var t=[],n=function(s){t.push(Y(r[s]).subscribe(z(e,function(o){if(t){for(var a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(o)})))},i=0;t&&!e.closed&&i<r.length;i++)n(i)}}function Kh(r,e,t){if(e==null&&(e=r,r=0),e<=0)return ot;var n=e+r;return new ne(t?function(i){var s=r;return t.schedule(function(){s<n?(i.next(s++),this.schedule()):i.complete()})}:function(i){for(var s=r;s<n&&!i.closed;)i.next(s++);i.complete()})}function Wh(r,e){return new ne(function(t){var n=r(),i=e(n),s=i?Y(i):ot;return s.subscribe(t),function(){n&&n.unsubscribe()}})}function Ti(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=hn(r),n=Jt(r);return n.length?new ne(function(i){var s=n.map(function(){return[]}),o=n.map(function(){return!1});i.add(function(){s=o=null});for(var a=function(u){Y(n[u]).subscribe(z(i,function(l){if(s[u].push(l),s.every(function(y){return y.length})){var f=s.map(function(y){return y.shift()});i.next(t?t.apply(void 0,fe([],le(f))):f),s.some(function(y,d){return!y.length&&o[d]})&&i.complete()}},function(){o[u]=!0,!s[u].length&&i.complete()}))},c=0;!i.closed&&c<n.length;c++)a(c);return function(){s=o=null}}):ot}function Sa(r){return V(function(e,t){var n=!1,i=null,s=null,o=!1,a=function(){if(s==null||s.unsubscribe(),s=null,n){n=!1;var u=i;i=null,t.next(u)}o&&t.complete()},c=function(){s=null,o&&t.complete()};e.subscribe(z(t,function(u){n=!0,i=u,s||Y(r(u)).subscribe(s=z(t,a,c))},function(){o=!0,(!n||!s||s.closed)&&t.complete()}))})}function zh(r,e){return e===void 0&&(e=Ye),Sa(function(){return jt(r,e)})}function Vh(r){return V(function(e,t){var n=[];return e.subscribe(z(t,function(i){return n.push(i)},function(){t.next(n),t.complete()})),Y(r).subscribe(z(t,function(){var i=n;n=[],t.next(i)},ve)),function(){n=null}})}function Hh(r,e){return e===void 0&&(e=null),e=e!=null?e:r,V(function(t,n){var i=[],s=0;t.subscribe(z(n,function(o){var a,c,u,l,f=null;s++%e===0&&i.push([]);try{for(var y=De(i),d=y.next();!d.done;d=y.next()){var p=d.value;p.push(o),r<=p.length&&(f=f!=null?f:[],f.push(p))}}catch(P){a={error:P}}finally{try{d&&!d.done&&(c=y.return)&&c.call(y)}finally{if(a)throw a.error}}if(f)try{for(var g=De(f),S=g.next();!S.done;S=g.next()){var p=S.value;ft(i,p),n.next(p)}}catch(P){u={error:P}}finally{try{S&&!S.done&&(l=g.return)&&l.call(g)}finally{if(u)throw u.error}}},function(){var o,a;try{for(var c=De(i),u=c.next();!u.done;u=c.next()){var l=u.value;n.next(l)}}catch(f){o={error:f}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}n.complete()},void 0,function(){i=null}))})}function Jh(r){for(var e,t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=(e=ht(n))!==null&&e!==void 0?e:Ye,o=(t=n[0])!==null&&t!==void 0?t:null,a=n[1]||1/0;return V(function(c,u){var l=[],f=!1,y=function(g){var S=g.buffer,P=g.subs;P.unsubscribe(),ft(l,g),u.next(S),f&&d()},d=function(){if(l){var g=new Fe;u.add(g);var S=[],P={buffer:S,subs:g};l.push(P),Ue(g,s,function(){return y(P)},r)}};o!==null&&o>=0?Ue(u,s,d,o,!0):f=!0,d();var p=z(u,function(g){var S,P,L=l.slice();try{for(var j=De(L),D=j.next();!D.done;D=j.next()){var W=D.value,M=W.buffer;M.push(g),a<=M.length&&y(W)}}catch(Z){S={error:Z}}finally{try{D&&!D.done&&(P=j.return)&&P.call(j)}finally{if(S)throw S.error}}},function(){for(;l!=null&&l.length;)u.next(l.shift().buffer);p==null||p.unsubscribe(),u.complete(),u.unsubscribe()},void 0,function(){return l=null});c.subscribe(p)})}function qh(r,e){return V(function(t,n){var i=[];Y(r).subscribe(z(n,function(s){var o=[];i.push(o);var a=new Fe,c=function(){ft(i,o),n.next(o),a.unsubscribe()};a.add(Y(e(s)).subscribe(z(n,c,ve)))},ve)),t.subscribe(z(n,function(s){var o,a;try{for(var c=De(i),u=c.next();!u.done;u=c.next()){var l=u.value;l.push(s)}}catch(f){o={error:f}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}},function(){for(;i.length>0;)n.next(i.shift());n.complete()}))})}function Yh(r){return V(function(e,t){var n=null,i=null,s=function(){i==null||i.unsubscribe();var o=n;n=[],o&&t.next(o),Y(r()).subscribe(i=z(t,s,ve))};s(),e.subscribe(z(t,function(o){return n==null?void 0:n.push(o)},function(){n&&t.next(n),t.complete()},void 0,function(){return n=i=null}))})}function _a(r){return V(function(e,t){var n=null,i=!1,s;n=e.subscribe(z(t,void 0,void 0,function(o){s=Y(r(o,_a(r)(e))),n?(n.unsubscribe(),n=null,s.subscribe(t)):i=!0})),i&&(n.unsubscribe(),n=null,s.subscribe(t))})}function Ta(r,e,t,n,i){return function(s,o){var a=t,c=e,u=0;s.subscribe(z(o,function(l){var f=u++;c=a?r(c,l,f):(a=!0,l),n&&o.next(c)},i&&function(){a&&o.next(c),o.complete()}))}}function dn(r,e){return V(Ta(r,e,arguments.length>=2,!1,!0))}var Gh=function(r,e){return r.push(e),r};function Oa(){return V(function(r,e){dn(Gh,[])(r).subscribe(e)})}function Pa(r,e){return mi(Oa(),tt(function(t){return r(t)}),e?$t(e):_e)}function Ia(r){return Pa(va,r)}var Qh=Ia;function Ra(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=hn(r);return t?mi(Ra.apply(void 0,fe([],le(r))),$t(t)):V(function(n,i){wa(fe([n],le(Jt(r))))(i)})}function Xh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Ra.apply(void 0,fe([],le(r)))}function Yr(r,e){return X(e)?tt(r,e,1):tt(r,1)}function Zh(r,e){return X(e)?Yr(function(){return r},e):Yr(function(){return r})}function ed(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=ht(r);return V(function(n,i){_i()(dt(fe([n],le(r)),t)).subscribe(i)})}function td(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return ed.apply(void 0,fe([],le(r)))}function nd(r){return new ne(function(e){return r.subscribe(e)})}var rd={connector:function(){return new xe}};function Oi(r,e){e===void 0&&(e=rd);var t=e.connector;return V(function(n,i){var s=t();Y(r(nd(s))).subscribe(i),i.add(n.subscribe(s))})}function id(r){return dn(function(e,t,n){return!r||r(t,n)?e+1:e},0)}function sd(r){return V(function(e,t){var n=!1,i=null,s=null,o=function(){if(s==null||s.unsubscribe(),s=null,n){n=!1;var a=i;i=null,t.next(a)}};e.subscribe(z(t,function(a){s==null||s.unsubscribe(),n=!0,i=a,s=z(t,o,ve),Y(r(a)).subscribe(s)},function(){o(),t.complete()},void 0,function(){i=s=null}))})}function od(r,e){return e===void 0&&(e=Ye),V(function(t,n){var i=null,s=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var u=s;s=null,n.next(u)}};function c(){var u=o+r,l=e.now();if(l<u){i=this.schedule(void 0,u-l),n.add(i);return}a()}t.subscribe(z(n,function(u){s=u,o=e.now(),i||(i=e.schedule(c,r),n.add(i))},function(){a(),n.complete()},void 0,function(){s=i=null}))})}function cr(r){return V(function(e,t){var n=!1;e.subscribe(z(t,function(i){n=!0,t.next(i)},function(){n||t.next(r),t.complete()}))})}function rn(r){return r<=0?function(){return ot}:V(function(e,t){var n=0;e.subscribe(z(t,function(i){++n<=r&&(t.next(i),r<=n&&t.complete())}))})}function Ca(){return V(function(r,e){r.subscribe(z(e,ve))})}function Na(r){return Nt(function(){return r})}function Pi(r,e){return e?function(t){return nn(e.pipe(rn(1),Ca()),t.pipe(Pi(r)))}:tt(function(t,n){return Y(r(t,n)).pipe(rn(1),Na(t))})}function ad(r,e){e===void 0&&(e=Ye);var t=jt(r,e);return Pi(function(){return t})}function cd(){return V(function(r,e){r.subscribe(z(e,function(t){return fa(t,e)}))})}function ud(r,e){return V(function(t,n){var i=new Set;t.subscribe(z(n,function(s){var o=r?r(s):s;i.has(o)||(i.add(o),n.next(s))})),e&&Y(e).subscribe(z(n,function(){return i.clear()},ve))})}function $a(r,e){return e===void 0&&(e=_e),r=r!=null?r:ld,V(function(t,n){var i,s=!0;t.subscribe(z(n,function(o){var a=e(o);(s||!r(i,a))&&(s=!1,i=a,n.next(o))}))})}function ld(r,e){return r===e}function fd(r,e){return $a(function(t,n){return e?e(t[r],n[r]):t[r]===n[r]})}function ur(r){return r===void 0&&(r=hd),V(function(e,t){var n=!1;e.subscribe(z(t,function(i){n=!0,t.next(i)},function(){return n?t.complete():t.error(r())}))})}function hd(){return new Ct}function dd(r,e){if(r<0)throw new Jr;var t=arguments.length>=2;return function(n){return n.pipe(It(function(i,s){return s===r}),rn(1),t?cr(e):ur(function(){return new Jr}))}}function pd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return function(t){return nn(t,ki.apply(void 0,fe([],le(r))))}}function yd(r,e){return V(function(t,n){var i=0;t.subscribe(z(n,function(s){r.call(e,s,i++,t)||(n.next(!1),n.complete())},function(){n.next(!0),n.complete()}))})}function Ii(r,e){return e?function(t){return t.pipe(Ii(function(n,i){return Y(r(n,i)).pipe(Nt(function(s,o){return e(n,s,i,o)}))}))}:V(function(t,n){var i=0,s=null,o=!1;t.subscribe(z(n,function(a){s||(s=z(n,void 0,function(){s=null,o&&n.complete()}),Y(r(a,i++)).subscribe(s))},function(){o=!0,!s&&n.complete()}))})}function ja(){return Ii(_e)}var md=ja;function gd(r,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,V(function(n,i){return Si(n,i,r,e,void 0,!0,t)})}function vd(r){return V(function(e,t){try{e.subscribe(t)}finally{t.add(r)}})}function wd(r,e){return V(Ba(r,e,"value"))}function Ba(r,e,t){var n=t==="index";return function(i,s){var o=0;i.subscribe(z(s,function(a){var c=o++;r.call(e,a,c,i)&&(s.next(n?c:a),s.complete())},function(){s.next(n?-1:void 0),s.complete()}))}}function bd(r,e){return V(Ba(r,e,"index"))}function xd(r,e){var t=arguments.length>=2;return function(n){return n.pipe(r?It(function(i,s){return r(i,s,n)}):_e,rn(1),t?cr(e):ur(function(){return new Ct}))}}function Ed(r,e,t,n){return V(function(i,s){var o;!e||typeof e=="function"?o=e:(t=e.duration,o=e.element,n=e.connector);var a=new Map,c=function(p){a.forEach(p),p(s)},u=function(p){return c(function(g){return g.error(p)})},l=0,f=!1,y=new gi(s,function(p){try{var g=r(p),S=a.get(g);if(!S){a.set(g,S=n?n():new xe);var P=d(g,S);if(s.next(P),t){var L=z(S,function(){S.complete(),L==null||L.unsubscribe()},void 0,void 0,function(){return a.delete(g)});y.add(Y(t(P)).subscribe(L))}}S.next(o?o(p):p)}catch(j){u(j)}},function(){return c(function(p){return p.complete()})},u,function(){return a.clear()},function(){return f=!0,l===0});i.subscribe(y);function d(p,g){var S=new ne(function(P){l++;var L=g.subscribe(P);return function(){L.unsubscribe(),--l===0&&f&&y.unsubscribe()}});return S.key=p,S}})}function kd(){return V(function(r,e){r.subscribe(z(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function La(r){return r<=0?function(){return ot}:V(function(e,t){var n=[];e.subscribe(z(t,function(i){n.push(i),r<n.length&&n.shift()},function(){var i,s;try{for(var o=De(n),a=o.next();!a.done;a=o.next()){var c=a.value;t.next(c)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}t.complete()},void 0,function(){n=null}))})}function Ad(r,e){var t=arguments.length>=2;return function(n){return n.pipe(r?It(function(i,s){return r(i,s,n)}):_e,La(1),t?cr(e):ur(function(){return new Ct}))}}function Sd(){return V(function(r,e){r.subscribe(z(e,function(t){e.next(Nn.createNext(t))},function(){e.next(Nn.createComplete()),e.complete()},function(t){e.next(Nn.createError(t)),e.complete()}))})}function _d(r){return dn(X(r)?function(e,t){return r(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var Td=tt;function Od(r,e,t){return t===void 0&&(t=1/0),X(e)?tt(function(){return r},e,t):(typeof e=="number"&&(t=e),tt(function(){return r},t))}function Pd(r,e,t){return t===void 0&&(t=1/0),V(function(n,i){var s=e;return Si(n,i,function(o,a){return r(s,o,a)},t,function(o){s=o},!1,void 0,function(){return s=null})})}function Id(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=ht(r),n=Qo(r,1/0);return r=Jt(r),V(function(i,s){or(n)(dt(fe([i],le(r)),t)).subscribe(s)})}function Rd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Id.apply(void 0,fe([],le(r)))}function Cd(r){return dn(X(r)?function(e,t){return r(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function Ri(r,e){var t=X(r)?r:function(){return r};return X(e)?Oi(e,{connector:t}):function(n){return new tr(n,t)}}function Nd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Jt(r);return function(n){return ka.apply(void 0,fe([n],le(t)))}}function $d(){return V(function(r,e){var t,n=!1;r.subscribe(z(e,function(i){var s=t;t=i,n&&e.next([s,i]),n=!0}))})}function jd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=r.length;if(t===0)throw new Error("list of properties cannot be empty.");return Nt(function(n){for(var i=n,s=0;s<t;s++){var o=i==null?void 0:i[r[s]];if(typeof o!="undefined")i=o;else return}return i})}function Bd(r){return r?function(e){return Oi(r)(e)}:function(e){return Ri(new xe)(e)}}function Ld(r){return function(e){var t=new Vo(r);return new tr(e,function(){return t})}}function Dd(){return function(r){var e=new wi;return new tr(r,function(){return e})}}function Ud(r,e,t,n){t&&!X(t)&&(n=t);var i=X(t)?t:void 0;return function(s){return Ri(new vi(r,e,n),i)(s)}}function Fd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r.length?V(function(t,n){Aa(fe([t],le(r)))(n)}):_e}function Md(r){var e,t=1/0,n;return r!=null&&(typeof r=="object"?(e=r.count,t=e===void 0?1/0:e,n=r.delay):t=r),t<=0?function(){return ot}:V(function(i,s){var o=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,n!=null){var l=typeof n=="number"?jt(n):Y(n(o)),f=z(s,function(){f.unsubscribe(),u()});l.subscribe(f)}else u()},u=function(){var l=!1;a=i.subscribe(z(s,void 0,function(){++o<t?a?c():l=!0:s.complete()})),l&&c()};u()})}function Kd(r){return V(function(e,t){var n,i=!1,s,o=!1,a=!1,c=function(){return a&&o&&(t.complete(),!0)},u=function(){return s||(s=new xe,Y(r(s)).subscribe(z(t,function(){n?l():i=!0},function(){o=!0,c()}))),s},l=function(){a=!1,n=e.subscribe(z(t,void 0,function(){a=!0,!c()&&u().next()})),i&&(n.unsubscribe(),n=null,i=!1,l())};l()})}function Wd(r){r===void 0&&(r=1/0);var e;r&&typeof r=="object"?e=r:e={count:r};var t=e.count,n=t===void 0?1/0:t,i=e.delay,s=e.resetOnSuccess,o=s===void 0?!1:s;return n<=0?_e:V(function(a,c){var u=0,l,f=function(){var y=!1;l=a.subscribe(z(c,function(d){o&&(u=0),c.next(d)},void 0,function(d){if(u++<n){var p=function(){l?(l.unsubscribe(),l=null,f()):y=!0};if(i!=null){var g=typeof i=="number"?jt(i):Y(i(d,u)),S=z(c,function(){S.unsubscribe(),p()},function(){c.complete()});g.subscribe(S)}else p()}else c.error(d)})),y&&(l.unsubscribe(),l=null,f())};f()})}function zd(r){return V(function(e,t){var n,i=!1,s,o=function(){n=e.subscribe(z(t,void 0,void 0,function(a){s||(s=new xe,Y(r(s)).subscribe(z(t,function(){return n?o():i=!0}))),s&&s.next(a)})),i&&(n.unsubscribe(),n=null,i=!1,o())};o()})}function Da(r){return V(function(e,t){var n=!1,i=null;e.subscribe(z(t,function(s){n=!0,i=s})),Y(r).subscribe(z(t,function(){if(n){n=!1;var s=i;i=null,t.next(s)}},ve))})}function Vd(r,e){return e===void 0&&(e=Ye),Da(xa(r,e))}function Hd(r,e){return V(Ta(r,e,arguments.length>=2,!0))}function Jd(r,e){return e===void 0&&(e=function(t,n){return t===n}),V(function(t,n){var i=Ps(),s=Ps(),o=function(c){n.next(c),n.complete()},a=function(c,u){var l=z(n,function(f){var y=u.buffer,d=u.complete;y.length===0?d?o(!1):c.buffer.push(f):!e(f,y.shift())&&o(!1)},function(){c.complete=!0;var f=u.complete,y=u.buffer;f&&o(y.length===0),l==null||l.unsubscribe()});return l};t.subscribe(a(i,s)),Y(r).subscribe(a(s,i))})}function Ps(){return{buffer:[],complete:!1}}function Ua(r){r===void 0&&(r={});var e=r.connector,t=e===void 0?function(){return new xe}:e,n=r.resetOnError,i=n===void 0?!0:n,s=r.resetOnComplete,o=s===void 0?!0:s,a=r.resetOnRefCountZero,c=a===void 0?!0:a;return function(u){var l,f,y,d=0,p=!1,g=!1,S=function(){f==null||f.unsubscribe(),f=void 0},P=function(){S(),l=y=void 0,p=g=!1},L=function(){var j=l;P(),j==null||j.unsubscribe()};return V(function(j,D){d++,!g&&!p&&S();var W=y=y!=null?y:t();D.add(function(){d--,d===0&&!g&&!p&&(f=Tr(L,c))}),W.subscribe(D),!l&&d>0&&(l=new zt({next:function(M){return W.next(M)},error:function(M){g=!0,S(),f=Tr(P,i,M),W.error(M)},complete:function(){p=!0,S(),f=Tr(P,o),W.complete()}}),Y(j).subscribe(l))})(u)}}function Tr(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];if(e===!0){r();return}if(e!==!1){var i=new zt({next:function(){i.unsubscribe(),r()}});return Y(e.apply(void 0,fe([],le(t)))).subscribe(i)}}function qd(r,e,t){var n,i,s,o,a=!1;return r&&typeof r=="object"?(n=r.bufferSize,o=n===void 0?1/0:n,i=r.windowTime,e=i===void 0?1/0:i,s=r.refCount,a=s===void 0?!1:s,t=r.scheduler):o=r!=null?r:1/0,Ua({connector:function(){return new vi(o,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function Yd(r){return V(function(e,t){var n=!1,i,s=!1,o=0;e.subscribe(z(t,function(a){s=!0,(!r||r(a,o++,e))&&(n&&t.error(new da("Too many matching values")),n=!0,i=a)},function(){n?(t.next(i),t.complete()):t.error(s?new ha("No matching values"):new Ct)}))})}function Gd(r){return It(function(e,t){return r<=t})}function Qd(r){return r<=0?_e:V(function(e,t){var n=new Array(r),i=0;return e.subscribe(z(t,function(s){var o=i++;if(o<r)n[o]=s;else{var a=o%r,c=n[a];n[a]=s,t.next(c)}})),function(){n=null}})}function Xd(r){return V(function(e,t){var n=!1,i=z(t,function(){i==null||i.unsubscribe(),n=!0},ve);Y(r).subscribe(i),e.subscribe(z(t,function(s){return n&&t.next(s)}))})}function Zd(r){return V(function(e,t){var n=!1,i=0;e.subscribe(z(t,function(s){return(n||(n=!r(s,i++)))&&t.next(s)}))})}function ep(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=ht(r);return V(function(n,i){(t?nn(r,n,t):nn(r,n)).subscribe(i)})}function sn(r,e){return V(function(t,n){var i=null,s=0,o=!1,a=function(){return o&&!i&&n.complete()};t.subscribe(z(n,function(c){i==null||i.unsubscribe();var u=0,l=s++;Y(r(c,l)).subscribe(i=z(n,function(f){return n.next(e?e(c,f,l,u++):f)},function(){i=null,a()}))},function(){o=!0,a()}))})}function tp(){return sn(_e)}function np(r,e){return X(e)?sn(function(){return r},e):sn(function(){return r})}function rp(r,e){return V(function(t,n){var i=e;return sn(function(s,o){return r(i,s,o)},function(s,o){return i=o,o})(t).subscribe(n),function(){i=null}})}function ip(r){return V(function(e,t){Y(r).subscribe(z(t,function(){return t.complete()},ve)),!t.closed&&e.subscribe(t)})}function sp(r,e){return e===void 0&&(e=!1),V(function(t,n){var i=0;t.subscribe(z(n,function(s){var o=r(s,i++);(o||e)&&n.next(s),!o&&n.complete()}))})}function op(r,e,t){var n=X(r)||e||t?{next:r,error:e,complete:t}:r;return n?V(function(i,s){var o;(o=n.subscribe)===null||o===void 0||o.call(n);var a=!0;i.subscribe(z(s,function(c){var u;(u=n.next)===null||u===void 0||u.call(n,c),s.next(c)},function(){var c;a=!1,(c=n.complete)===null||c===void 0||c.call(n),s.complete()},function(c){var u;a=!1,(u=n.error)===null||u===void 0||u.call(n,c),s.error(c)},function(){var c,u;a&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(u=n.finalize)===null||u===void 0||u.call(n)}))}):_e}function Fa(r,e){return V(function(t,n){var i=e!=null?e:{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,c=a===void 0?!1:a,u=!1,l=null,f=null,y=!1,d=function(){f==null||f.unsubscribe(),f=null,c&&(S(),y&&n.complete())},p=function(){f=null,y&&n.complete()},g=function(P){return f=Y(r(P)).subscribe(z(n,d,p))},S=function(){if(u){u=!1;var P=l;l=null,n.next(P),!y&&g(P)}};t.subscribe(z(n,function(P){u=!0,l=P,!(f&&!f.closed)&&(o?S():g(P))},function(){y=!0,!(c&&u&&f&&!f.closed)&&n.complete()}))})}function ap(r,e,t){e===void 0&&(e=Ye);var n=jt(r,e);return Fa(function(){return n},t)}function cp(r){return r===void 0&&(r=Ye),V(function(e,t){var n=r.now();e.subscribe(z(t,function(i){var s=r.now(),o=s-n;n=s,t.next(new up(i,o))}))})}var up=function(){function r(e,t){this.value=e,this.interval=t}return r}();function lp(r,e,t){var n,i,s;if(t=t!=null?t:bi,Ai(r)?n=r:typeof r=="number"&&(i=r),e)s=function(){return e};else throw new TypeError("No observable provided to switch to");if(n==null&&i==null)throw new TypeError("No timeout provided.");return ya({first:n,each:i,scheduler:t,with:s})}function fp(r){return r===void 0&&(r=nr),Nt(function(e){return{value:e,timestamp:r.now()}})}function hp(r){return V(function(e,t){var n=new xe;t.next(n.asObservable());var i=function(s){n.error(s),t.error(s)};return e.subscribe(z(t,function(s){return n==null?void 0:n.next(s)},function(){n.complete(),t.complete()},i)),Y(r).subscribe(z(t,function(){n.complete(),t.next(n=new xe)},ve,i)),function(){n==null||n.unsubscribe(),n=null}})}function dp(r,e){e===void 0&&(e=0);var t=e>0?e:r;return V(function(n,i){var s=[new xe],o=[],a=0;i.next(s[0].asObservable()),n.subscribe(z(i,function(c){var u,l;try{for(var f=De(s),y=f.next();!y.done;y=f.next()){var d=y.value;d.next(c)}}catch(S){u={error:S}}finally{try{y&&!y.done&&(l=f.return)&&l.call(f)}finally{if(u)throw u.error}}var p=a-r+1;if(p>=0&&p%t===0&&s.shift().complete(),++a%t===0){var g=new xe;s.push(g),i.next(g.asObservable())}},function(){for(;s.length>0;)s.shift().complete();i.complete()},function(c){for(;s.length>0;)s.shift().error(c);i.error(c)},function(){o=null,s=null}))})}function pp(r){for(var e,t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=(e=ht(n))!==null&&e!==void 0?e:Ye,o=(t=n[0])!==null&&t!==void 0?t:null,a=n[1]||1/0;return V(function(c,u){var l=[],f=!1,y=function(S){var P=S.window,L=S.subs;P.complete(),L.unsubscribe(),ft(l,S),f&&d()},d=function(){if(l){var S=new Fe;u.add(S);var P=new xe,L={window:P,subs:S,seen:0};l.push(L),u.next(P.asObservable()),Ue(S,s,function(){return y(L)},r)}};o!==null&&o>=0?Ue(u,s,d,o,!0):f=!0,d();var p=function(S){return l.slice().forEach(S)},g=function(S){p(function(P){var L=P.window;return S(L)}),S(u),u.unsubscribe()};return c.subscribe(z(u,function(S){p(function(P){P.window.next(S),a<=++P.seen&&y(P)})},function(){return g(function(S){return S.complete()})},function(S){return g(function(P){return P.error(S)})})),function(){l=null}})}function yp(r,e){return V(function(t,n){var i=[],s=function(o){for(;0<i.length;)i.shift().error(o);n.error(o)};Y(r).subscribe(z(n,function(o){var a=new xe;i.push(a);var c=new Fe,u=function(){ft(i,a),a.complete(),c.unsubscribe()},l;try{l=Y(e(o))}catch(f){s(f);return}n.next(a.asObservable()),c.add(l.subscribe(z(n,u,ve,s)))},ve)),t.subscribe(z(n,function(o){var a,c,u=i.slice();try{for(var l=De(u),f=l.next();!f.done;f=l.next()){var y=f.value;y.next(o)}}catch(d){a={error:d}}finally{try{f&&!f.done&&(c=l.return)&&c.call(l)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();n.complete()},s,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function mp(r){return V(function(e,t){var n,i,s=function(a){n.error(a),t.error(a)},o=function(){i==null||i.unsubscribe(),n==null||n.complete(),n=new xe,t.next(n.asObservable());var a;try{a=Y(r())}catch(c){s(c);return}a.subscribe(i=z(t,o,o,s))};o(),e.subscribe(z(t,function(a){return n.next(a)},function(){n.complete(),t.complete()},s,function(){i==null||i.unsubscribe(),n=null}))})}function gp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=hn(r);return V(function(n,i){for(var s=r.length,o=new Array(s),a=r.map(function(){return!1}),c=!1,u=function(f){Y(r[f]).subscribe(z(i,function(y){o[f]=y,!c&&!a[f]&&(a[f]=!0,(c=a.every(_e))&&(a=null))},ve))},l=0;l<s;l++)u(l);n.subscribe(z(i,function(f){if(c){var y=fe([f],le(o));i.next(t?t.apply(void 0,fe([],le(y))):y)}}))})}function vp(r){return Pa(Ti,r)}function wp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return V(function(t,n){Ti.apply(void 0,fe([t],le(r))).subscribe(n)})}function bp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return wp.apply(void 0,fe([],le(r)))}const xp=Object.freeze(Object.defineProperty({__proto__:null,Observable:ne,ConnectableObservable:tr,observable:er,animationFrames:Bf,Subject:xe,BehaviorSubject:Vo,ReplaySubject:vi,AsyncSubject:wi,asap:zf,asapScheduler:Jo,async:bi,asyncScheduler:Ye,queue:Jf,queueScheduler:qo,animationFrame:Gf,animationFrameScheduler:Yo,VirtualTimeScheduler:Qf,VirtualAction:Go,Scheduler:Vr,Subscription:Fe,Subscriber:Zn,Notification:Nn,get NotificationKind(){return Hr},pipe:mi,noop:ve,identity:_e,isObservable:fh,lastValueFrom:hh,firstValueFrom:dh,ArgumentOutOfRangeError:Jr,EmptyError:Ct,NotFoundError:ha,ObjectUnsubscribedError:zo,SequenceError:da,TimeoutError:pa,UnsubscriptionError:Rn,bindCallback:gh,bindNodeCallback:vh,combineLatest:va,concat:nn,connectable:Sh,defer:ar,empty:Xf,forkJoin:_h,from:dt,fromEvent:qr,fromEventPattern:ba,generate:Nh,iif:$h,interval:xa,merge:jh,never:Bh,of:ki,onErrorResumeNext:ka,pairs:Dh,partition:Fh,race:Mh,range:Kh,throwError:la,timer:jt,using:Wh,zip:Ti,scheduled:ua,EMPTY:ot,NEVER:Ea,config:kt,audit:Sa,auditTime:zh,buffer:Vh,bufferCount:Hh,bufferTime:Jh,bufferToggle:qh,bufferWhen:Yh,catchError:_a,combineAll:Qh,combineLatestAll:Ia,combineLatestWith:Xh,concatAll:_i,concatMap:Yr,concatMapTo:Zh,concatWith:td,connect:Oi,count:id,debounce:sd,debounceTime:od,defaultIfEmpty:cr,delay:ad,delayWhen:Pi,dematerialize:cd,distinct:ud,distinctUntilChanged:$a,distinctUntilKeyChanged:fd,elementAt:dd,endWith:pd,every:yd,exhaust:md,exhaustAll:ja,exhaustMap:Ii,expand:gd,filter:It,finalize:vd,find:wd,findIndex:bd,first:xd,groupBy:Ed,ignoreElements:Ca,isEmpty:kd,last:Ad,map:Nt,mapTo:Na,materialize:Sd,max:_d,mergeAll:or,flatMap:Td,mergeMap:tt,mergeMapTo:Od,mergeScan:Pd,mergeWith:Rd,min:Cd,multicast:Ri,observeOn:ir,onErrorResumeNextWith:Nd,pairwise:$d,pluck:jd,publish:Bd,publishBehavior:Ld,publishLast:Dd,publishReplay:Ud,raceWith:Fd,reduce:dn,repeat:Md,repeatWhen:Kd,retry:Wd,retryWhen:zd,refCount:Mo,sample:Da,sampleTime:Vd,scan:Hd,sequenceEqual:Jd,share:Ua,shareReplay:qd,single:Yd,skip:Gd,skipLast:Qd,skipUntil:Xd,skipWhile:Zd,startWith:ep,subscribeOn:sr,switchAll:tp,switchMap:sn,switchMapTo:np,switchScan:rp,take:rn,takeLast:La,takeUntil:ip,takeWhile:sp,tap:op,throttle:Fa,throttleTime:ap,throwIfEmpty:ur,timeInterval:cp,timeout:ya,timeoutWith:lp,timestamp:fp,toArray:Oa,window:hp,windowCount:dp,windowTime:pp,windowToggle:yp,windowWhen:mp,withLatestFrom:gp,zipAll:vp,zipWith:bp},Symbol.toStringTag,{value:"Module"}));export{kp as default};
//# sourceMappingURL=swyger-client-auth.min.js.map
