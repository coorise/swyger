var La=Object.defineProperty,Da=Object.defineProperties;var Ua=Object.getOwnPropertyDescriptors;var Ci=Object.getOwnPropertySymbols;var Fa=Object.prototype.hasOwnProperty,Ma=Object.prototype.propertyIsEnumerable;var sr=(r,e,t)=>e in r?La(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,U=(r,e)=>{for(var t in e||(e={}))Fa.call(e,t)&&sr(r,t,e[t]);if(Ci)for(var t of Ci(e))Ma.call(e,t)&&sr(r,t,e[t]);return r},fe=(r,e)=>Da(r,Ua(e));var $i=(r,e,t)=>(sr(r,typeof e!="symbol"?e+"":e,t),t),Bi=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var Y=(r,e,t)=>(Bi(r,e,"read from private field"),t?t.call(r):e.get(r)),et=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},Je=(r,e,t,n)=>(Bi(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var P=(r,e,t)=>new Promise((n,i)=>{var s=c=>{try{a(t.next(c))}catch(u){i(u)}},o=c=>{try{a(t.throw(c))}catch(u){i(u)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(s,o);a((t=t.apply(r,e)).next())});const rt=Object.create(null);rt.open="0";rt.close="1";rt.ping="2";rt.pong="3";rt.message="4";rt.upgrade="5";rt.noop="6";const wn=Object.create(null);Object.keys(rt).forEach(r=>{wn[rt[r]]=r});const Ka={type:"error",data:"parser error"},Va=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",qa=typeof ArrayBuffer=="function",za=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Os=({type:r,data:e},t,n)=>Va&&e instanceof Blob?t?n(e):ji(e,n):qa&&(e instanceof ArrayBuffer||za(e))?t?n(e):ji(new Blob([e]),n):n(rt[r]+(e||"")),ji=(r,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)},Li="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Yt=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let r=0;r<Li.length;r++)Yt[Li.charCodeAt(r)]=r;const Wa=r=>{let e=r.length*.75,t=r.length,n,i=0,s,o,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const u=new ArrayBuffer(e),l=new Uint8Array(u);for(n=0;n<t;n+=4)s=Yt[r.charCodeAt(n)],o=Yt[r.charCodeAt(n+1)],a=Yt[r.charCodeAt(n+2)],c=Yt[r.charCodeAt(n+3)],l[i++]=s<<2|o>>4,l[i++]=(o&15)<<4|a>>2,l[i++]=(a&3)<<6|c&63;return u},Ha=typeof ArrayBuffer=="function",Ts=(r,e)=>{if(typeof r!="string")return{type:"message",data:Ps(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:Ja(r.substring(1),e)}:wn[t]?r.length>1?{type:wn[t],data:r.substring(1)}:{type:wn[t]}:Ka},Ja=(r,e)=>{if(Ha){const t=Wa(r);return Ps(t,e)}else return{base64:!0,data:r}},Ps=(r,e)=>{switch(e){case"blob":return r instanceof ArrayBuffer?new Blob([r]):r;case"arraybuffer":default:return r}},Is=String.fromCharCode(30),Ya=(r,e)=>{const t=r.length,n=new Array(t);let i=0;r.forEach((s,o)=>{Os(s,!1,a=>{n[o]=a,++i===t&&e(n.join(Is))})})},Ga=(r,e)=>{const t=r.split(Is),n=[];for(let i=0;i<t.length;i++){const s=Ts(t[i],e);if(n.push(s),s.type==="error")break}return n},Rs=4;function ge(r){if(r)return Qa(r)}function Qa(r){for(var e in ge.prototype)r[e]=ge.prototype[e];return r}ge.prototype.on=ge.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};ge.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};ge.prototype.off=ge.prototype.removeListener=ge.prototype.removeAllListeners=ge.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+r],this};ge.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};ge.prototype.emitReserved=ge.prototype.emit;ge.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};ge.prototype.hasListeners=function(r){return!!this.listeners(r).length};const ze=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")())();function Ns(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}const Xa=ze.setTimeout,Za=ze.clearTimeout;function Fn(r,e){e.useNativeTimers?(r.setTimeoutFn=Xa.bind(ze),r.clearTimeoutFn=Za.bind(ze)):(r.setTimeoutFn=ze.setTimeout.bind(ze),r.clearTimeoutFn=ze.clearTimeout.bind(ze))}const ec=1.33;function tc(r){return typeof r=="string"?nc(r):Math.ceil((r.byteLength||r.size)*ec)}function nc(r){let e=0,t=0;for(let n=0,i=r.length;n<i;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}class rc extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Cs extends ge{constructor(e){super(),this.writable=!1,Fn(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new rc(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Ts(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const $s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ar=64,ic={};let Di=0,hn=0,Ui;function Fi(r){let e="";do e=$s[r%Ar]+e,r=Math.floor(r/Ar);while(r>0);return e}function Bs(){const r=Fi(+new Date);return r!==Ui?(Di=0,Ui=r):r+"."+Fi(Di++)}for(;hn<Ar;hn++)ic[$s[hn]]=hn;function js(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function sc(r){let e={},t=r.split("&");for(let n=0,i=t.length;n<i;n++){let s=t[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}let Ls=!1;try{Ls=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(r){}const oc=Ls;function Ds(r){const e=r.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||oc))return new XMLHttpRequest}catch(t){}if(!e)try{return new ze[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function ac(){}const cc=function(){return new Ds({xdomain:!1}).responseType!=null}();class uc extends Cs{constructor(e){if(super(e),this.polling=!1,typeof location!="undefined"){const n=location.protocol==="https:";let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==n}const t=e&&e.forceBase64;this.supportsBinary=cc&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Ga(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Ya(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Bs()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port);const i=js(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new nt(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}class nt extends ge{constructor(e,t){super(),Fn(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=Ns(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new Ds(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.opts.extraHeaders[n])}}catch(n){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{t.setRequestHeader("Accept","*/*")}catch(n){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document!="undefined"&&(this.index=nt.requestsCount++,nt.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.xhr.onreadystatechange=ac,e)try{this.xhr.abort()}catch(t){}typeof document!="undefined"&&delete nt.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}nt.requestsCount=0;nt.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",Mi);else if(typeof addEventListener=="function"){const r="onpagehide"in ze?"pagehide":"unload";addEventListener(r,Mi,!1)}}function Mi(){for(let r in nt.requests)nt.requests.hasOwnProperty(r)&&nt.requests[r].abort()}const Us=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),dn=ze.WebSocket||ze.MozWebSocket,Ki=!0,lc="arraybuffer",Vi=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class fc extends Cs{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=Vi?{}:Ns(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Ki&&!Vi?t?new dn(e,t):new dn(e):new dn(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||lc,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;Os(n,this.supportsBinary,s=>{const o={};try{Ki&&this.ws.send(s)}catch(a){}i&&Us(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Bs()),this.supportsBinary||(e.b64=1);const i=js(e),s=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}check(){return!!dn}}const hc={websocket:fc,polling:uc},dc=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,pc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function _r(r){const e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let i=dc.exec(r||""),s={},o=14;for(;o--;)s[pc[o]]=i[o]||"";return t!=-1&&n!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=yc(s,s.path),s.queryKey=mc(s,s.query),s}function yc(r,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function mc(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(t[i]=s)}),t}class mt extends ge{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=_r(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=_r(t.host).host),Fn(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=sc(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Rs,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new hc[e](n)}open(){let e;if(this.opts.rememberUpgrade&&mt.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;mt.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",f=>{if(!n)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;mt.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=t.name,this.emitReserved("upgradeError",p)}}))};function s(){n||(n=!0,l(),t.close(),t=null)}const o=f=>{const p=new Error("probe error: "+f);p.transport=t.name,s(),this.emitReserved("upgradeError",p)};function a(){o("transport closed")}function c(){o("socket closed")}function u(f){t&&f.name!==t.name&&s()}const l=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",u),t.open()}onOpen(){if(this.readyState="open",mt.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(t+=tc(i)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,i){if(typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const s={type:e,data:t,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){mt.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const i=e.length;for(;n<i;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}mt.protocol=Rs;function gc(r,e="",t){let n=r;t=t||typeof location!="undefined"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t!="undefined"?r=t.protocol+"//"+r:r="https://"+r),n=_r(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+e,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}const vc=typeof ArrayBuffer=="function",wc=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Fs=Object.prototype.toString,bc=typeof Blob=="function"||typeof Blob!="undefined"&&Fs.call(Blob)==="[object BlobConstructor]",xc=typeof File=="function"||typeof File!="undefined"&&Fs.call(File)==="[object FileConstructor]";function Wr(r){return vc&&(r instanceof ArrayBuffer||wc(r))||bc&&r instanceof Blob||xc&&r instanceof File}function bn(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(bn(r[t]))return!0;return!1}if(Wr(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return bn(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&bn(r[t]))return!0;return!1}function Ec(r){const e=[],t=r.data,n=r;return n.data=Sr(t,e),n.attachments=e.length,{packet:n,buffers:e}}function Sr(r,e){if(!r)return r;if(Wr(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=Sr(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=Sr(r[n],e));return t}return r}function kc(r,e){return r.data=Or(r.data,e),delete r.attachments,r}function Or(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=Or(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=Or(r[t],e));return r}const Ac=5;var ee;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(ee||(ee={}));class _c{constructor(e){this.replacer=e}encode(e){return(e.type===ee.EVENT||e.type===ee.ACK)&&bn(e)?this.encodeAsBinary({type:e.type===ee.EVENT?ee.BINARY_EVENT:ee.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===ee.BINARY_EVENT||e.type===ee.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Ec(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}class Hr extends ge{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===ee.BINARY_EVENT;n||t.type===ee.BINARY_ACK?(t.type=n?ee.EVENT:ee.ACK,this.reconstructor=new Sc(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Wr(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(ee[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===ee.BINARY_EVENT||n.type===ee.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(s,t)}else n.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(Hr.isPayloadValid(n.type,s))n.data=s;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case ee.CONNECT:return typeof t=="object";case ee.DISCONNECT:return t===void 0;case ee.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case ee.EVENT:case ee.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="string"||typeof t[0]=="number");case ee.ACK:case ee.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Sc{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=kc(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Oc=Object.freeze(Object.defineProperty({__proto__:null,protocol:Ac,get PacketType(){return ee},Encoder:_c,Decoder:Hr},Symbol.toStringTag,{value:"Module"}));function Ge(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const Tc=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ms extends ge{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ge(e,"open",this.onopen.bind(this)),Ge(e,"packet",this.onpacket.bind(this)),Ge(e,"error",this.onerror.bind(this)),Ge(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Tc.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:ee.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,a=t.pop();this._registerAckCallback(o,a),n.id=o}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!i||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}emitWithAck(e,...t){const n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((i,s)=>{t.push((o,a)=>n?o?s(o):i(a):i(o)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...s)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...s)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:ee.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ee.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ee.EVENT:case ee.BINARY_EVENT:this.onevent(e);break;case ee.ACK:case ee.BINARY_ACK:this.onack(e);break;case ee.DISCONNECT:this.ondisconnect();break;case ee.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:ee.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ee.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Vt(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Vt.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=(Math.floor(e*10)&1)==0?r-t:r+t}return Math.min(r,this.max)|0};Vt.prototype.reset=function(){this.attempts=0};Vt.prototype.setMin=function(r){this.ms=r};Vt.prototype.setMax=function(r){this.max=r};Vt.prototype.setJitter=function(r){this.jitter=r};class Tr extends ge{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Fn(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Vt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||Oc;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new mt(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=Ge(t,"open",function(){n.onopen(),e&&e()}),s=Ge(t,"error",o=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",o),e?e(o):n.maybeReconnectOnOpen()});if(this._timeout!==!1){const o=this._timeout;o===0&&i();const a=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(i),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ge(e,"ping",this.onping.bind(this)),Ge(e,"data",this.ondata.bind(this)),Ge(e,"error",this.onerror.bind(this)),Ge(e,"close",this.onclose.bind(this)),Ge(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Us(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Ms(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Wt={};function xn(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=gc(r,e.path||"/socket.io"),n=t.source,i=t.id,s=t.path,o=Wt[i]&&s in Wt[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new Tr(n,e):(Wt[i]||(Wt[i]=new Tr(n,e)),c=Wt[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(xn,{Manager:Tr,Socket:Ms,io:xn,connect:xn});const Pc={init:({API_KEY:r,HOST_SERVER:e,CURRENT:t,ENV:n,API_VERSION:i})=>{var a,c;let s={};const o=localStorage.getItem("accessToken");try{const u={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};return o&&(u.Authorization="Bearer "+o),s.database=xn(e.DATABASE,{extraHeaders:u}),(a=s==null?void 0:s.database)==null||a.on("connect",()=>{n==="dev"&&console.log("Swyger Database Client JS is connected with Swyger Server!!!")}),(c=s==null?void 0:s.database)==null||c.on("disconnect",l=>{n==="dev"&&console.log("The device is disconnected from Database server!")}),s}catch(u){}}};function Pr(r){this.message=r}Pr.prototype=new Error,Pr.prototype.name="InvalidCharacterError";var qi=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(r){var e=String(r).replace(/=+$/,"");if(e.length%4==1)throw new Pr("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,i=0,s=0,o="";n=e.charAt(s++);~n&&(t=i%4?64*t+n:n,i++%4)?o+=String.fromCharCode(255&t>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o};function Ic(r){var e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(qi(t).replace(/(.)/g,function(n,i){var s=i.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(e)}catch(t){return qi(e)}}function Rn(r){this.message=r}function Rc(r,e){if(typeof r!="string")throw new Rn("Invalid token specified");var t=(e=e||{}).header===!0?0:1;try{return JSON.parse(Ic(r.split(".")[t]))}catch(n){throw new Rn("Invalid token specified: "+n.message)}}Rn.prototype=new Error,Rn.prototype.name="InvalidTokenError";function Ks(r,e){return function(){return r.apply(e,arguments)}}const{toString:Nc}=Object.prototype,{getPrototypeOf:Jr}=Object,Mn=(r=>e=>{const t=Nc.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),it=r=>(r=r.toLowerCase(),e=>Mn(e)===r),Kn=r=>e=>typeof e===r,{isArray:qt}=Array,Gt=Kn("undefined");function Cc(r){return r!==null&&!Gt(r)&&r.constructor!==null&&!Gt(r.constructor)&&We(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const Vs=it("ArrayBuffer");function $c(r){let e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&Vs(r.buffer),e}const Bc=Kn("string"),We=Kn("function"),qs=Kn("number"),Vn=r=>r!==null&&typeof r=="object",jc=r=>r===!0||r===!1,En=r=>{if(Mn(r)!=="object")return!1;const e=Jr(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Lc=it("Date"),Dc=it("File"),Uc=it("Blob"),Fc=it("FileList"),Mc=r=>Vn(r)&&We(r.pipe),Kc=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||We(r.append)&&((e=Mn(r))==="formdata"||e==="object"&&We(r.toString)&&r.toString()==="[object FormData]"))},Vc=it("URLSearchParams"),qc=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function sn(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r=="undefined")return;let n,i;if(typeof r!="object"&&(r=[r]),qt(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{const s=t?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length;let a;for(n=0;n<o;n++)a=s[n],e.call(null,r[a],a,r)}}function zs(r,e){e=e.toLowerCase();const t=Object.keys(r);let n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}const Ws=(()=>typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global)(),Hs=r=>!Gt(r)&&r!==Ws;function Ir(){const{caseless:r}=Hs(this)&&this||{},e={},t=(n,i)=>{const s=r&&zs(e,i)||i;En(e[s])&&En(n)?e[s]=Ir(e[s],n):En(n)?e[s]=Ir({},n):qt(n)?e[s]=n.slice():e[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&sn(arguments[n],t);return e}const zc=(r,e,t,{allOwnKeys:n}={})=>(sn(e,(i,s)=>{t&&We(i)?r[s]=Ks(i,t):r[s]=i},{allOwnKeys:n}),r),Wc=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Hc=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},Jc=(r,e,t,n)=>{let i,s,o;const a={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!n||n(o,r,e))&&!a[o]&&(e[o]=r[o],a[o]=!0);r=t!==!1&&Jr(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},Yc=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const n=r.indexOf(e,t);return n!==-1&&n===t},Gc=r=>{if(!r)return null;if(qt(r))return r;let e=r.length;if(!qs(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},Qc=(r=>e=>r&&e instanceof r)(typeof Uint8Array!="undefined"&&Jr(Uint8Array)),Xc=(r,e)=>{const n=(r&&r[Symbol.iterator]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},Zc=(r,e)=>{let t;const n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},eu=it("HTMLFormElement"),tu=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),zi=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),nu=it("RegExp"),Js=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),n={};sn(t,(i,s)=>{e(i,s,r)!==!1&&(n[s]=i)}),Object.defineProperties(r,n)},ru=r=>{Js(r,(e,t)=>{if(We(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=r[t];if(!!We(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},iu=(r,e)=>{const t={},n=i=>{i.forEach(s=>{t[s]=!0})};return qt(r)?n(r):n(String(r).split(e)),t},su=()=>{},ou=(r,e)=>(r=+r,Number.isFinite(r)?r:e),or="abcdefghijklmnopqrstuvwxyz",Wi="0123456789",Ys={DIGIT:Wi,ALPHA:or,ALPHA_DIGIT:or+or.toUpperCase()+Wi},au=(r=16,e=Ys.ALPHA_DIGIT)=>{let t="";const{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function cu(r){return!!(r&&We(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const uu=r=>{const e=new Array(10),t=(n,i)=>{if(Vn(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;const s=qt(n)?[]:{};return sn(n,(o,a)=>{const c=t(o,i+1);!Gt(c)&&(s[a]=c)}),e[i]=void 0,s}}return n};return t(r,0)},lu=it("AsyncFunction"),fu=r=>r&&(Vn(r)||We(r))&&We(r.then)&&We(r.catch),B={isArray:qt,isArrayBuffer:Vs,isBuffer:Cc,isFormData:Kc,isArrayBufferView:$c,isString:Bc,isNumber:qs,isBoolean:jc,isObject:Vn,isPlainObject:En,isUndefined:Gt,isDate:Lc,isFile:Dc,isBlob:Uc,isRegExp:nu,isFunction:We,isStream:Mc,isURLSearchParams:Vc,isTypedArray:Qc,isFileList:Fc,forEach:sn,merge:Ir,extend:zc,trim:qc,stripBOM:Wc,inherits:Hc,toFlatObject:Jc,kindOf:Mn,kindOfTest:it,endsWith:Yc,toArray:Gc,forEachEntry:Xc,matchAll:Zc,isHTMLForm:eu,hasOwnProperty:zi,hasOwnProp:zi,reduceDescriptors:Js,freezeMethods:ru,toObjectSet:iu,toCamelCase:tu,noop:su,toFiniteNumber:ou,findKey:zs,global:Ws,isContextDefined:Hs,ALPHABET:Ys,generateString:au,isSpecCompliantForm:cu,toJSONObject:uu,isAsyncFn:lu,isThenable:fu};function ne(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i)}B.inherits(ne,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:B.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Gs=ne.prototype,Qs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{Qs[r]={value:r}});Object.defineProperties(ne,Qs);Object.defineProperty(Gs,"isAxiosError",{value:!0});ne.from=(r,e,t,n,i,s)=>{const o=Object.create(Gs);return B.toFlatObject(r,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),ne.call(o,r.message,e,t,n,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};const hu=null;function Rr(r){return B.isPlainObject(r)||B.isArray(r)}function Xs(r){return B.endsWith(r,"[]")?r.slice(0,-2):r}function Hi(r,e,t){return r?r.concat(e).map(function(i,s){return i=Xs(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function du(r){return B.isArray(r)&&!r.some(Rr)}const pu=B.toFlatObject(B,{},null,function(e){return/^is[A-Z]/.test(e)});function qn(r,e,t){if(!B.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=B.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,b){return!B.isUndefined(b[y])});const n=t.metaTokens,i=t.visitor||l,s=t.dots,o=t.indexes,c=(t.Blob||typeof Blob!="undefined"&&Blob)&&B.isSpecCompliantForm(e);if(!B.isFunction(i))throw new TypeError("visitor must be a function");function u(h){if(h===null)return"";if(B.isDate(h))return h.toISOString();if(!c&&B.isBlob(h))throw new ne("Blob is not supported. Use a Buffer instead.");return B.isArrayBuffer(h)||B.isTypedArray(h)?c&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function l(h,y,b){let _=h;if(h&&!b&&typeof h=="object"){if(B.endsWith(y,"{}"))y=n?y:y.slice(0,-2),h=JSON.stringify(h);else if(B.isArray(h)&&du(h)||(B.isFileList(h)||B.endsWith(y,"[]"))&&(_=B.toArray(h)))return y=Xs(y),_.forEach(function($,L){!(B.isUndefined($)||$===null)&&e.append(o===!0?Hi([y],L,s):o===null?y:y+"[]",u($))}),!1}return Rr(h)?!0:(e.append(Hi(b,y,s),u(h)),!1)}const f=[],p=Object.assign(pu,{defaultVisitor:l,convertValue:u,isVisitable:Rr});function d(h,y){if(!B.isUndefined(h)){if(f.indexOf(h)!==-1)throw Error("Circular reference detected in "+y.join("."));f.push(h),B.forEach(h,function(_,j){(!(B.isUndefined(_)||_===null)&&i.call(e,_,B.isString(j)?j.trim():j,y,p))===!0&&d(_,y?y.concat(j):[j])}),f.pop()}}if(!B.isObject(r))throw new TypeError("data must be an object");return d(r),e}function Ji(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Yr(r,e){this._pairs=[],r&&qn(r,this,e)}const Zs=Yr.prototype;Zs.append=function(e,t){this._pairs.push([e,t])};Zs.toString=function(e){const t=e?function(n){return e.call(this,n,Ji)}:Ji;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function yu(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function eo(r,e,t){if(!e)return r;const n=t&&t.encode||yu,i=t&&t.serialize;let s;if(i?s=i(e,t):s=B.isURLSearchParams(e)?e.toString():new Yr(e,t).toString(n),s){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class mu{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){B.forEach(this.handlers,function(n){n!==null&&e(n)})}}const Yi=mu,to={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},gu=typeof URLSearchParams!="undefined"?URLSearchParams:Yr,vu=typeof FormData!="undefined"?FormData:null,wu=typeof Blob!="undefined"?Blob:null,bu=(()=>{let r;return typeof navigator!="undefined"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"})(),xu=(()=>typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),tt={isBrowser:!0,classes:{URLSearchParams:gu,FormData:vu,Blob:wu},isStandardBrowserEnv:bu,isStandardBrowserWebWorkerEnv:xu,protocols:["http","https","file","blob","url","data"]};function Eu(r,e){return qn(r,new tt.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,s){return tt.isNode&&B.isBuffer(t)?(this.append(n,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function ku(r){return B.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Au(r){const e={},t=Object.keys(r);let n;const i=t.length;let s;for(n=0;n<i;n++)s=t[n],e[s]=r[s];return e}function no(r){function e(t,n,i,s){let o=t[s++];const a=Number.isFinite(+o),c=s>=t.length;return o=!o&&B.isArray(i)?i.length:o,c?(B.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!a):((!i[o]||!B.isObject(i[o]))&&(i[o]=[]),e(t,n,i[o],s)&&B.isArray(i[o])&&(i[o]=Au(i[o])),!a)}if(B.isFormData(r)&&B.isFunction(r.entries)){const t={};return B.forEachEntry(r,(n,i)=>{e(ku(n),i,t,0)}),t}return null}const _u={"Content-Type":void 0};function Su(r,e,t){if(B.isString(r))try{return(e||JSON.parse)(r),B.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}const zn={transitional:to,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=B.isObject(e);if(s&&B.isHTMLForm(e)&&(e=new FormData(e)),B.isFormData(e))return i&&i?JSON.stringify(no(e)):e;if(B.isArrayBuffer(e)||B.isBuffer(e)||B.isStream(e)||B.isFile(e)||B.isBlob(e))return e;if(B.isArrayBufferView(e))return e.buffer;if(B.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Eu(e,this.formSerializer).toString();if((a=B.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return qn(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),Su(e)):e}],transformResponse:[function(e){const t=this.transitional||zn.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&B.isString(e)&&(n&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?ne.from(a,ne.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:tt.classes.FormData,Blob:tt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};B.forEach(["delete","get","head"],function(e){zn.headers[e]={}});B.forEach(["post","put","patch"],function(e){zn.headers[e]=B.merge(_u)});const Gr=zn,Ou=B.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Tu=r=>{const e={};let t,n,i;return r&&r.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),n=o.substring(i+1).trim(),!(!t||e[t]&&Ou[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},Gi=Symbol("internals");function Ht(r){return r&&String(r).trim().toLowerCase()}function kn(r){return r===!1||r==null?r:B.isArray(r)?r.map(kn):String(r)}function Pu(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}const Iu=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function ar(r,e,t,n,i){if(B.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!B.isString(e)){if(B.isString(n))return e.indexOf(n)!==-1;if(B.isRegExp(n))return n.test(e)}}function Ru(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function Nu(r,e){const t=B.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,s,o){return this[n].call(this,e,i,s,o)},configurable:!0})})}class Wn{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function s(a,c,u){const l=Ht(c);if(!l)throw new Error("header name must be a non-empty string");const f=B.findKey(i,l);(!f||i[f]===void 0||u===!0||u===void 0&&i[f]!==!1)&&(i[f||c]=kn(a))}const o=(a,c)=>B.forEach(a,(u,l)=>s(u,l,c));return B.isPlainObject(e)||e instanceof this.constructor?o(e,t):B.isString(e)&&(e=e.trim())&&!Iu(e)?o(Tu(e),t):e!=null&&s(t,e,n),this}get(e,t){if(e=Ht(e),e){const n=B.findKey(this,e);if(n){const i=this[n];if(!t)return i;if(t===!0)return Pu(i);if(B.isFunction(t))return t.call(this,i,n);if(B.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ht(e),e){const n=B.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||ar(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let i=!1;function s(o){if(o=Ht(o),o){const a=B.findKey(n,o);a&&(!t||ar(n,n[a],a,t))&&(delete n[a],i=!0)}}return B.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const s=t[n];(!e||ar(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,n={};return B.forEach(this,(i,s)=>{const o=B.findKey(n,s);if(o){t[o]=kn(i),delete t[s];return}const a=e?Ru(s):String(s).trim();a!==s&&delete t[s],t[a]=kn(i),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return B.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&B.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){const n=(this[Gi]=this[Gi]={accessors:{}}).accessors,i=this.prototype;function s(o){const a=Ht(o);n[a]||(Nu(i,o),n[a]=!0)}return B.isArray(e)?e.forEach(s):s(e),this}}Wn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);B.freezeMethods(Wn.prototype);B.freezeMethods(Wn);const ct=Wn;function cr(r,e){const t=this||Gr,n=e||t,i=ct.from(n.headers);let s=n.data;return B.forEach(r,function(a){s=a.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function ro(r){return!!(r&&r.__CANCEL__)}function on(r,e,t){ne.call(this,r==null?"canceled":r,ne.ERR_CANCELED,e,t),this.name="CanceledError"}B.inherits(on,ne,{__CANCEL__:!0});function Cu(r,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new ne("Request failed with status code "+t.status,[ne.ERR_BAD_REQUEST,ne.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const $u=tt.isStandardBrowserEnv?function(){return{write:function(t,n,i,s,o,a){const c=[];c.push(t+"="+encodeURIComponent(n)),B.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),B.isString(s)&&c.push("path="+s),B.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){const n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function Bu(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function ju(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function io(r,e){return r&&!Bu(e)?ju(r,e):e}const Lu=tt.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function i(s){let o=s;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(o){const a=B.isString(o)?i(o):o;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}();function Du(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function Uu(r,e){r=r||10;const t=new Array(r),n=new Array(r);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(c){const u=Date.now(),l=n[s];o||(o=u),t[i]=c,n[i]=u;let f=s,p=0;for(;f!==i;)p+=t[f++],f=f%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),u-o<e)return;const d=l&&u-l;return d?Math.round(p*1e3/d):void 0}}function Qi(r,e){let t=0;const n=Uu(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-t,c=n(a),u=s<=o;t=s;const l={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&u?(o-s)/c:void 0,event:i};l[e?"download":"upload"]=!0,r(l)}}const Fu=typeof XMLHttpRequest!="undefined",Mu=Fu&&function(r){return new Promise(function(t,n){let i=r.data;const s=ct.from(r.headers).normalize(),o=r.responseType;let a;function c(){r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}B.isFormData(i)&&(tt.isStandardBrowserEnv||tt.isStandardBrowserWebWorkerEnv?s.setContentType(!1):s.setContentType("multipart/form-data;",!1));let u=new XMLHttpRequest;if(r.auth){const d=r.auth.username||"",h=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";s.set("Authorization","Basic "+btoa(d+":"+h))}const l=io(r.baseURL,r.url);u.open(r.method.toUpperCase(),eo(l,r.params,r.paramsSerializer),!0),u.timeout=r.timeout;function f(){if(!u)return;const d=ct.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),y={data:!o||o==="text"||o==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:d,config:r,request:u};Cu(function(_){t(_),c()},function(_){n(_),c()},y),u=null}if("onloadend"in u?u.onloadend=f:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(f)},u.onabort=function(){!u||(n(new ne("Request aborted",ne.ECONNABORTED,r,u)),u=null)},u.onerror=function(){n(new ne("Network Error",ne.ERR_NETWORK,r,u)),u=null},u.ontimeout=function(){let h=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const y=r.transitional||to;r.timeoutErrorMessage&&(h=r.timeoutErrorMessage),n(new ne(h,y.clarifyTimeoutError?ne.ETIMEDOUT:ne.ECONNABORTED,r,u)),u=null},tt.isStandardBrowserEnv){const d=(r.withCredentials||Lu(l))&&r.xsrfCookieName&&$u.read(r.xsrfCookieName);d&&s.set(r.xsrfHeaderName,d)}i===void 0&&s.setContentType(null),"setRequestHeader"in u&&B.forEach(s.toJSON(),function(h,y){u.setRequestHeader(y,h)}),B.isUndefined(r.withCredentials)||(u.withCredentials=!!r.withCredentials),o&&o!=="json"&&(u.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&u.addEventListener("progress",Qi(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",Qi(r.onUploadProgress)),(r.cancelToken||r.signal)&&(a=d=>{!u||(n(!d||d.type?new on(null,r,u):d),u.abort(),u=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const p=Du(l);if(p&&tt.protocols.indexOf(p)===-1){n(new ne("Unsupported protocol "+p+":",ne.ERR_BAD_REQUEST,r));return}u.send(i||null)})},An={http:hu,xhr:Mu};B.forEach(An,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch(t){}Object.defineProperty(r,"adapterName",{value:e})}});const Ku={getAdapter:r=>{r=B.isArray(r)?r:[r];const{length:e}=r;let t,n;for(let i=0;i<e&&(t=r[i],!(n=B.isString(t)?An[t.toLowerCase()]:t));i++);if(!n)throw n===!1?new ne(`Adapter ${t} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(B.hasOwnProp(An,t)?`Adapter '${t}' is not available in the build`:`Unknown adapter '${t}'`);if(!B.isFunction(n))throw new TypeError("adapter is not a function");return n},adapters:An};function ur(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new on(null,r)}function Xi(r){return ur(r),r.headers=ct.from(r.headers),r.data=cr.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),Ku.getAdapter(r.adapter||Gr.adapter)(r).then(function(n){return ur(r),n.data=cr.call(r,r.transformResponse,n),n.headers=ct.from(n.headers),n},function(n){return ro(n)||(ur(r),n&&n.response&&(n.response.data=cr.call(r,r.transformResponse,n.response),n.response.headers=ct.from(n.response.headers))),Promise.reject(n)})}const Zi=r=>r instanceof ct?r.toJSON():r;function Ft(r,e){e=e||{};const t={};function n(u,l,f){return B.isPlainObject(u)&&B.isPlainObject(l)?B.merge.call({caseless:f},u,l):B.isPlainObject(l)?B.merge({},l):B.isArray(l)?l.slice():l}function i(u,l,f){if(B.isUndefined(l)){if(!B.isUndefined(u))return n(void 0,u,f)}else return n(u,l,f)}function s(u,l){if(!B.isUndefined(l))return n(void 0,l)}function o(u,l){if(B.isUndefined(l)){if(!B.isUndefined(u))return n(void 0,u)}else return n(void 0,l)}function a(u,l,f){if(f in e)return n(u,l);if(f in r)return n(void 0,u)}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(u,l)=>i(Zi(u),Zi(l),!0)};return B.forEach(Object.keys(Object.assign({},r,e)),function(l){const f=c[l]||i,p=f(r[l],e[l],l);B.isUndefined(p)&&f!==a||(t[l]=p)}),t}const so="1.4.0",Qr={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{Qr[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const es={};Qr.transitional=function(e,t,n){function i(s,o){return"[Axios v"+so+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return(s,o,a)=>{if(e===!1)throw new ne(i(o," has been removed"+(t?" in "+t:"")),ne.ERR_DEPRECATED);return t&&!es[o]&&(es[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};function Vu(r,e,t){if(typeof r!="object")throw new ne("options must be an object",ne.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],o=e[s];if(o){const a=r[s],c=a===void 0||o(a,s,r);if(c!==!0)throw new ne("option "+s+" must be "+c,ne.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new ne("Unknown option "+s,ne.ERR_BAD_OPTION)}}const Nr={assertOptions:Vu,validators:Qr},ht=Nr.validators;class Nn{constructor(e){this.defaults=e,this.interceptors={request:new Yi,response:new Yi}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Ft(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;n!==void 0&&Nr.assertOptions(n,{silentJSONParsing:ht.transitional(ht.boolean),forcedJSONParsing:ht.transitional(ht.boolean),clarifyTimeoutError:ht.transitional(ht.boolean)},!1),i!=null&&(B.isFunction(i)?t.paramsSerializer={serialize:i}:Nr.assertOptions(i,{encode:ht.function,serialize:ht.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o;o=s&&B.merge(s.common,s[t.method]),o&&B.forEach(["delete","get","head","post","put","patch","common"],h=>{delete s[h]}),t.headers=ct.concat(o,s);const a=[];let c=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(t)===!1||(c=c&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});const u=[];this.interceptors.response.forEach(function(y){u.push(y.fulfilled,y.rejected)});let l,f=0,p;if(!c){const h=[Xi.bind(this),void 0];for(h.unshift.apply(h,a),h.push.apply(h,u),p=h.length,l=Promise.resolve(t);f<p;)l=l.then(h[f++],h[f++]);return l}p=a.length;let d=t;for(f=0;f<p;){const h=a[f++],y=a[f++];try{d=h(d)}catch(b){y.call(this,b);break}}try{l=Xi.call(this,d)}catch(h){return Promise.reject(h)}for(f=0,p=u.length;f<p;)l=l.then(u[f++],u[f++]);return l}getUri(e){e=Ft(this.defaults,e);const t=io(e.baseURL,e.url);return eo(t,e.params,e.paramsSerializer)}}B.forEach(["delete","get","head","options"],function(e){Nn.prototype[e]=function(t,n){return this.request(Ft(n||{},{method:e,url:t,data:(n||{}).data}))}});B.forEach(["post","put","patch"],function(e){function t(n){return function(s,o,a){return this.request(Ft(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Nn.prototype[e]=t(),Nn.prototype[e+"Form"]=t(!0)});const _n=Nn;class Xr{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{n.subscribe(a),s=a}).then(i);return o.cancel=function(){n.unsubscribe(s)},o},e(function(s,o,a){n.reason||(n.reason=new on(s,o,a),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new Xr(function(i){e=i}),cancel:e}}}const qu=Xr;function zu(r){return function(t){return r.apply(null,t)}}function Wu(r){return B.isObject(r)&&r.isAxiosError===!0}const Cr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Cr).forEach(([r,e])=>{Cr[e]=r});const Hu=Cr;function oo(r){const e=new _n(r),t=Ks(_n.prototype.request,e);return B.extend(t,_n.prototype,e,{allOwnKeys:!0}),B.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return oo(Ft(r,i))},t}const be=oo(Gr);be.Axios=_n;be.CanceledError=on;be.CancelToken=qu;be.isCancel=ro;be.VERSION=so;be.toFormData=qn;be.AxiosError=ne;be.Cancel=be.CanceledError;be.all=function(e){return Promise.all(e)};be.spread=zu;be.isAxiosError=Wu;be.mergeConfig=Ft;be.AxiosHeaders=ct;be.formToJSON=r=>no(B.isHTMLForm(r)?new FormData(r):r);be.HttpStatusCode=Hu;be.default=be;const Ju=be,ts={init:({API_KEY:r})=>(...s)=>P(void 0,[...s],function*(e="post",t="/",n={},i={}){var f,p,d,h;const o=localStorage.getItem("accessToken");let a={Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Key":r,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE, HEAD,PATCH","Access-Control-Allow-Headers":"X-PINGOTHER, Origin, X-Requested-With, Content-Type, Accept","Access-Control-Max-Age":"1728000"};o&&(a.Authorization="Bearer "+o);const c=t;i!=null&&i.headers&&(a=Object.assign(...a,...i.headers),delete i.headers);const u=Object.assign({mode:"cors",method:e,url:c,data:n,headers:a},i);let l={};try{const y=yield Ju(u);l.data=((f=y==null?void 0:y.data)==null?void 0:f.data)||(y==null?void 0:y.data),y!=null&&y.error&&(l.error=y.error),l.data||(l.data={})}catch(y){l.error=((d=(p=y.response)==null?void 0:p.data)==null?void 0:d.error)||((h=y.response)==null?void 0:h.error),l.error||(l.error={})}return l})};let pn;const Yu=new Uint8Array(16);function Gu(){if(!pn&&(pn=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!pn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return pn(Yu)}const Oe=[];for(let r=0;r<256;++r)Oe.push((r+256).toString(16).slice(1));function Qu(r,e=0){return(Oe[r[e+0]]+Oe[r[e+1]]+Oe[r[e+2]]+Oe[r[e+3]]+"-"+Oe[r[e+4]]+Oe[r[e+5]]+"-"+Oe[r[e+6]]+Oe[r[e+7]]+"-"+Oe[r[e+8]]+Oe[r[e+9]]+"-"+Oe[r[e+10]]+Oe[r[e+11]]+Oe[r[e+12]]+Oe[r[e+13]]+Oe[r[e+14]]+Oe[r[e+15]]).toLowerCase()}const Xu=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ns={randomUUID:Xu};function lr(r,e,t){if(ns.randomUUID&&!e&&!r)return ns.randomUUID();r=r||{};const n=r.random||(r.rng||Gu)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=n[i];return e}return Qu(n)}var ao={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function s(c,u,l,f,p){if(typeof l!="function")throw new TypeError("The listener must be a function");var d=new i(l,f||c,p),h=t?t+u:u;return c._events[h]?c._events[h].fn?c._events[h]=[c._events[h],d]:c._events[h].push(d):(c._events[h]=d,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],l,f;if(this._eventsCount===0)return u;for(f in l=this._events)e.call(l,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},a.prototype.listeners=function(u){var l=t?t+u:u,f=this._events[l];if(!f)return[];if(f.fn)return[f.fn];for(var p=0,d=f.length,h=new Array(d);p<d;p++)h[p]=f[p].fn;return h},a.prototype.listenerCount=function(u){var l=t?t+u:u,f=this._events[l];return f?f.fn?1:f.length:0},a.prototype.emit=function(u,l,f,p,d,h){var y=t?t+u:u;if(!this._events[y])return!1;var b=this._events[y],_=arguments.length,j,$;if(b.fn){switch(b.once&&this.removeListener(u,b.fn,void 0,!0),_){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,l),!0;case 3:return b.fn.call(b.context,l,f),!0;case 4:return b.fn.call(b.context,l,f,p),!0;case 5:return b.fn.call(b.context,l,f,p,d),!0;case 6:return b.fn.call(b.context,l,f,p,d,h),!0}for($=1,j=new Array(_-1);$<_;$++)j[$-1]=arguments[$];b.fn.apply(b.context,j)}else{var L=b.length,K;for($=0;$<L;$++)switch(b[$].once&&this.removeListener(u,b[$].fn,void 0,!0),_){case 1:b[$].fn.call(b[$].context);break;case 2:b[$].fn.call(b[$].context,l);break;case 3:b[$].fn.call(b[$].context,l,f);break;case 4:b[$].fn.call(b[$].context,l,f,p);break;default:if(!j)for(K=1,j=new Array(_-1);K<_;K++)j[K-1]=arguments[K];b[$].fn.apply(b[$].context,j)}}return!0},a.prototype.on=function(u,l,f){return s(this,u,l,f,!1)},a.prototype.once=function(u,l,f){return s(this,u,l,f,!0)},a.prototype.removeListener=function(u,l,f,p){var d=t?t+u:u;if(!this._events[d])return this;if(!l)return o(this,d),this;var h=this._events[d];if(h.fn)h.fn===l&&(!p||h.once)&&(!f||h.context===f)&&o(this,d);else{for(var y=0,b=[],_=h.length;y<_;y++)(h[y].fn!==l||p&&!h[y].once||f&&h[y].context!==f)&&b.push(h[y]);b.length?this._events[d]=b.length===1?b[0]:b:o(this,d)}return this},a.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&o(this,l)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(ao);const Zu=ao.exports;var el={exports:{}};(function(r,e){(function(t){var n=this,i=Object.prototype.hasOwnProperty,s=function(c){for(var u=new Array(c.length),l=c.length,f=l-1;l--;)u[f-l]=c[l];return u},o=function(){var c=Array.prototype.slice.call(arguments);return c.length==2?o.find.apply(this,c):o.transform.apply(this,c)};o.find=function(c,u){return o.get(u,c)},o.memoizePath=!0;var a={};o.get=function(c,u,l){if(c===t||c===null||u===t||u===null)return l;var f;for(typeof u=="string"?o.memoizePath?a[u]?f=a[u].slice(0):(f=u.split(".").reverse(),a[u]=f.slice(0)):f=u.split(".").reverse():Array.isArray(u)&&(f=s(u));f.length&&(c=c[f.pop()])!==t&&c!==null;);return c===null&&f.length&&(c=t),c===t?l:c},o.exists=function(c,u){return o.get(c,u)!==t},o.set=function(c,u,l,f){var p=Array.isArray(u)?u:u.split("."),d=c,h,y=p.length;if(typeof d!="object")throw new Error("Parent is not an object.");for(var b=0;b<y;b++)if(h=p[b],(!i.call(d,h)||d[h]===t||(typeof d[h]!="object"||d[h]===null)&&f&&f.force===!0)&&(d[h]={}),b==y-1)d[h]=l;else{if(typeof d[h]!="object"||d[h]===null)throw new Error('Target key "'+h+'" is not suitable for a nested value. (It is in use as non-object. Set `force` to `true` to override.)');d=d[h]}d[h]=l},o.default=function(c,u,l){o.get(c,u)===t&&o.set(c,u,l)},o.transform=function(u,l){if(Array.isArray(u))return u.map(function(K){return o.transform(K,l)});l=l||{},l.delimiter=l.delimiter||".";var f,p,d,h,y={},b,_=Object.keys(u),j=_.length,$;for($=0;$<j;$++)if(b=_[$],b.indexOf(l.delimiter)!==-1){f=b.split(l.delimiter),p=f.length,h=y;for(var L=0;L<p&&(d=f[L],L!=p-1&&!h.hasOwnProperty(d)&&(h[d]={}),L==p-1&&(h[d]=u[b]),h=h[d],h!==null);L++);}else y[b]=u[b];return y},o.flatten=function(c,u){typeof u=="undefined"&&(u=".");var l={},f,p;for(var d in c)if(i.call(c,d))if(f=c[d],Object.prototype.toString.call(f)==="[object Object]"){p=o.flatten(f,u);for(var h in p)l[d+u+h]=p[h]}else l[d]=f;return l},o.paths=function(c,u){var l=[],f,p;if(u=u||[],typeof c=="object")for(p in c)f=c[p],typeof f=="object"&&f!==null?l=l.concat(o.paths(f,u.concat([p]))):l.push(u.concat(p).join("."));else throw new Error("Paths was called with non-object argument.");return l},r.exports?r.exports=o:(n.Dottie=o,n.Dot=o,typeof t=="function"&&t([],function(){return o}))})()})(el);function fr(r,e){try{r(e)}catch(t){console.error("Error in subscription callback",t)}}const dt=Symbol("subscriptions"),pt=Symbol("oneTimeEvents");class Mt{constructor(){this[dt]=[],this[pt]=new Map}on(e,t){return this[pt].has(e)?fr(t,this[pt].get(e)):(this[dt].push({event:e,callback:t,once:!1}),this)}off(e,t){return this[dt]=this[dt].filter(n=>n.event!==e||t&&n.callback!==t),this}once(e,t){return new Promise(n=>{const i=s=>{n(s),t==null||t(s)};this[pt].has(e)?fr(i,this[pt].get(e)):this[dt].push({event:e,callback:i,once:!0})})}emit(e,t){if(this[pt].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);for(let n=0;n<this[dt].length;n++){const i=this[dt][n];i.event===e&&(fr(i.callback,t),i.once&&(this[dt].splice(n,1),n--))}return this}emitOnce(e,t){if(this[pt].has(e))throw new Error(`Event "${e}" was supposed to be emitted only once`);return this.emit(e,t),this[pt].set(e,t),this.off(e),this}pipe(e,t){this.on(e,n=>{t.emit(e,n)})}pipeOnce(e,t){this.once(e,n=>{t.emitOnce(e,n)})}}function yt(r){return r=r.replace(/\[/g,"/[").replace(/^\/+/,"").replace(/\/+$/,""),r.length===0?[]:r.split("/").map(t=>t.startsWith("[")?parseInt(t.slice(1,-1)):t)}class N{static get(e){return new N(e)}static getChildPath(e,t){return N.get(e).child(t).path}static getPathKeys(e){return yt(e)}constructor(e){typeof e=="string"?this.keys=yt(e):e instanceof Array&&(this.keys=e),this.path=this.keys.reduce((t,n,i)=>i===0?`${n}`:typeof n=="string"?`${t}/${n}`:`${t}[${n}]`,"")}get key(){return this.keys.length===0?null:this.keys.slice(-1)[0]}get parent(){if(this.keys.length==0)return null;const e=this.keys.slice(0,-1);return new N(e)}get parentPath(){return this.keys.length===0?null:this.parent.path}child(e){if(typeof e=="string"){if(e.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`);const t=yt(e);t.forEach(n=>{if(typeof n=="string"){if(/[\x00-\x08\x0b\x0c\x0e-\x1f/[\]\\]/.test(n))throw new Error(`Invalid child key "${n}" for path "${this.path}". Keys cannot contain control characters or any of the following characters: \\ / [ ]`);if(n.length>128)throw new Error(`child key "${n}" for path "${this.path}" is too long. Max key length is 128`);if(n.length===0)throw new Error(`child key for path "${this.path}" cannot be empty`)}}),e=t}return new N(this.keys.concat(e))}childPath(e){return this.child(e).path}get pathKeys(){return this.keys}static extractVariables(e,t){if(!e.includes("*")&&!e.includes("$"))return[];const n=yt(e),i=yt(t);let s=0;const o={get length(){return s}};return n.forEach((a,c)=>{const u=i[c];if(a==="*")o[s++]=u;else if(typeof a=="string"&&a[0]==="$"){o[s++]=u,o[a]=u;const l=a.slice(1);typeof o[l]=="undefined"&&(o[l]=u)}}),o}static fillVariables(e,t){if(e.indexOf("*")<0&&e.indexOf("$")<0)return e;const n=yt(e),i=yt(t),s=n.map((a,c)=>{if(a===i[c]||c>=i.length)return a;if(typeof a=="string"&&(a==="*"||a[0]==="$"))return i[c];throw new Error(`Path "${t}" cannot be used to fill variables of path "${e}" because they do not match`)});let o="";return s.forEach(a=>{typeof a=="number"?o+=`[${a}]`:(o.length>0&&(o+="/"),o+=a)}),o}static fillVariables2(e,t){if(typeof t!="object"||Object.keys(t).length===0)return e;const n=yt(e);let i=0;return n.reduce((o,a)=>typeof a=="string"&&(a==="*"||a.startsWith("$"))?N.getChildPath(o,t[i++]):N.getChildPath(o,a),"")}equals(e){const t=e instanceof N?e:new N(e);return this.path===t.path?!0:this.keys.length!==t.keys.length?!1:this.keys.every((n,i)=>{const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isAncestorOf(e){const t=e instanceof N?e:new N(e);return t.path===""||this.path===t.path?!1:this.path===""?!0:this.keys.length>=t.keys.length?!1:this.keys.every((n,i)=>{const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isDescendantOf(e){const t=e instanceof N?e:new N(e);return this.path===""||this.path===t.path?!1:e===""?!0:t.keys.length>=this.keys.length?!1:t.keys.every((n,i)=>{const s=this.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isOnTrailOf(e){const t=e instanceof N?e:new N(e);return this.path.length===0||t.path.length===0||this.path===t.path?!0:this.pathKeys.every((n,i)=>{if(i>=t.keys.length)return!0;const s=t.keys[i];return s===n||typeof s=="string"&&(s==="*"||s[0]==="$")||typeof n=="string"&&(n==="*"||n[0]==="$")})}isChildOf(e){const t=e instanceof N?e:new N(e);return this.path===""?!1:this.parent.equals(t)}isParentOf(e){const t=e instanceof N?e:new N(e);return t.path===""?!1:this.equals(t.parent)}}function hr(r,e,t=!1){if(!r.exists())return null;let n=t?r.previous():r.val();return typeof e=="number"?n[e]:(N.getPathKeys(e).every(i=>(n=n[i],typeof n!="undefined")),n||null)}function dr(r){if(!r.exists())return[];const e=r.val();return e instanceof Array?new Array(e.length).map((t,n)=>n):typeof e=="object"?Object.keys(e):[]}class de{exists(){return!1}constructor(e,t,n=!1,i,s){this.ref=e,this.val=()=>t,this.previous=()=>i,this.exists=()=>n?!1:t!==null&&typeof t!="undefined",this.context=()=>s||{}}static for(e,t){return new de(e,t)}child(e){const t=hr(this,e,!1),n=hr(this,e,!0);return new de(this.ref.child(e),t,!1,n)}hasChild(e){return hr(this,e)!==null}hasChildren(){return dr(this).length>0}numChildren(){return dr(this).length}forEach(e){const t=this.val(),n=this.previous();return dr(this).every(i=>{const s=new de(this.ref.child(i),t[i],!1,n[i]);return e(s)})}get key(){return this.ref.key}}class Sn extends de{constructor(e,t,n){super(e,t,!1,void 0,n),this.previous=()=>{throw new Error("Iterate values to get previous values for each mutation")},this.val=(i=!0)=>(i&&console.warn("Unless you know what you are doing, it is best not to use the value of a mutations snapshot directly. Use child methods and forEach to iterate the mutations instead"),t)}forEach(e){return this.val(!1).every(n=>{const i=n.target.reduce((o,a)=>o.child(a),this.ref),s=new de(i,n.val,!1,n.prev);return e(s)})}child(e){if(typeof e!="number")throw new Error("child index must be a number");const t=this.val(!1)[e],n=t.target.reduce((i,s)=>i.child(s),this.ref);return new de(n,t.val,!1,t.prev)}}class co{constructor(e){this.stop=e,this._internal={state:"init",activatePromises:[]}}activated(e){return e&&(this._internal.activatePromises.push({callback:e}),this._internal.state==="active"?e(!0):this._internal.state==="canceled"&&e(!1,this._internal.cancelReason)),new Promise((t,n)=>{if(this._internal.state==="active")return t();if(this._internal.state==="canceled"&&!e)return n(new Error(this._internal.cancelReason));const i=()=>{};this._internal.activatePromises.push({resolve:t,reject:e?i:n})})}_setActivationState(e,t){for(this._internal.cancelReason=t,this._internal.state=e?"active":"canceled";this._internal.activatePromises.length>0;){const n=this._internal.activatePromises.shift();e?(n.callback&&n.callback(!0),n.resolve&&n.resolve()):(n.callback&&n.callback(!1,t),n.reject&&n.reject(t))}}}class tl{constructor(e,t,n){this.publish=e,this.start=t,this.cancel=n}}class nl{constructor(e){const t=[];let n,i;const s="stopped (no more subscribers)";this.subscribe=(f,p)=>{if(typeof f!="function")throw new TypeError("callback must be a function");if(i===s)throw new Error("stream can't be used anymore because all subscribers were stopped");const d={callback:f,activationCallback:function(h,y){p==null||p(h,y),this.subscription._setActivationState(h,y)},subscription:new co(function(){return t.splice(t.indexOf(this),1),o()})};return t.push(d),typeof i!="undefined"&&(i===!0?(p==null||p(!0),d.subscription._setActivationState(!0)):typeof i=="string"&&(p==null||p(!1,i),d.subscription._setActivationState(!1,i))),d.subscription};const o=()=>{let f;return t.length===0&&(f=n==null?void 0:n(),i=s),Promise.resolve(f)};this.unsubscribe=f=>{(f?t.filter(d=>d.callback===f):t).forEach(d=>{const h=t.indexOf(d);t.splice(h,1)}),o()},this.stop=()=>{t.splice(0),o()};const a=f=>(t.forEach(p=>{try{p.callback(f)}catch(d){console.error(`Error running subscriber callback: ${d.message}`)}}),t.length===0&&o(),t.length>0),c=f=>{i=!0,n=f,t.forEach(p=>{var d;(d=p.activationCallback)==null||d.call(p,!0)})},u=f=>{i=f,t.forEach(p=>{var d;(d=p.activationCallback)==null||d.call(p,!1,f||new Error("unknown reason"))}),t.splice(0)},l=new tl(a,c,u);e(l)}}function Zr(r,e){const t="000000000"+r;return t.substr(t.length-e)}const rl=typeof window=="object"?window:self,il=Object.keys(rl).length;var _s,Ss;const sl=(Ss=(_s=navigator.mimeTypes)==null?void 0:_s.length)!=null?Ss:0,ol=Zr((sl+navigator.userAgent.length).toString(36)+il.toString(36),4);function al(){return ol}let Jt=0;const ei=4,Cn=36,uo=Math.pow(Cn,ei);function rs(){return Zr((Math.random()*uo<<0).toString(Cn),ei)}function cl(){return Jt=Jt<uo?Jt:0,Jt++,Jt-1}function ul(r=0){const e="c",t=(new Date().getTime()+r).toString(Cn),n=Zr(cl().toString(Cn),ei),i=al(),s=rs()+rs();return e+t+n+i+s}let is=0;class Ie{static set timeBias(e){typeof e=="number"&&(is=e)}static generate(){return ul(is).slice(1)}}class pe{constructor(e){this.path=e}}const qe={nextTick(r){setTimeout(r,0)}};class $n{constructor(e){if(e instanceof Array)for(let t=0;t<e.length;t++)typeof e[t]!="undefined"&&(this[t]=e[t]);else e&&Object.assign(this,e)}}function ll(r){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,r),new Array(...e)}function fl(r){if((Array.isArray(r)?r.length:r.byteLength)!==8)throw new TypeError("must be 8 bytes");const t=new Uint8Array(r);return new DataView(t.buffer).getFloat64(0)}const gt={zero:BigInt(0),one:BigInt(1),two:BigInt(2),eight:BigInt(8),ff:BigInt(255)};function hl(r){if(typeof r!="bigint")throw new Error("number must be a bigint");const e=[],t=r<gt.zero;do{const n=Number(r&gt.ff);e.push(n),r=r>>gt.eight}while(r!==(t?-gt.one:gt.zero));return e.reverse(),(t?e[0]<128:e[0]>=128)&&e.unshift(t?255:0),e}function dl(r){const e=r[0]>=128;let t=gt.zero;for(let n of r)e&&(n=~n&255),t=(t<<gt.eight)+BigInt(n);return e&&(t=-(t+gt.one)),t}function pl(r){if(typeof TextEncoder!="undefined")return new TextEncoder().encode(r);if(typeof Buffer=="function"){const e=Buffer.from(r,"utf-8");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else{const e=[];for(let t=0;t<r.length;t++){let n=r.charCodeAt(t);if(n>128){if((n&55296)===55296){const i=r.charCodeAt(t+1);if((i&56320)!==56320)throw new Error("follow-up utf-16 character does not start with 0xDC00");t++;const s=n&1023,o=i&1023;n=65536|s<<10|o}if(n<2048){const i=192|n>>6&31,s=128|n&63;e.push(i,s)}else if(n<65536){const i=224|n>>12&15,s=128|n>>6&63,o=128|n&63;e.push(i,s,o)}else if(n<2097152){const i=240|n>>18&7,s=128|n>>12&63,o=128|n>>6&63,a=128|n&63;e.push(i,s,o,a)}else throw new Error(`Cannot convert character ${r.charAt(t)} (code ${n}) to utf-8`)}else e.push(n<128?n:63)}return new Uint8Array(e)}}function lo(r){if(typeof TextDecoder!="undefined"){const e=new TextDecoder;if(r instanceof Uint8Array)return e.decode(r);const t=Uint8Array.from(r);return e.decode(t)}else if(typeof Buffer=="function"){if(r instanceof Array&&(r=Uint8Array.from(r)),!(r instanceof Buffer)&&"buffer"in r&&r.buffer instanceof ArrayBuffer){const e=r;r=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}if(!(r instanceof Buffer))throw new Error("Unsupported buffer argument");return r.toString("utf-8")}else{if(!(r instanceof Uint8Array)&&"buffer"in r&&r.buffer instanceof ArrayBuffer){const e=r;r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(r instanceof Buffer||r instanceof Array||r instanceof Uint8Array){let e="";for(let t=0;t<r.length;t++){let n=r[t];if(n>128)if((n&240)===240){const i=n,s=r[t+1],o=r[t+2],a=r[t+3];n=(i&7)<<18|(s&63)<<12|(o&63)<<6|a&63,t+=3}else if((n&224)===224){const i=n,s=r[t+1],o=r[t+2];n=(i&15)<<12|(s&63)<<6|o&63,t+=2}else if((n&192)===192){const i=n,s=r[t+1];n=(i&31)<<6|s&63,t++}else throw new Error("invalid utf-8 data");if(n>=65536){n^=65536;const i=55296|n>>10,s=56320|n&1023;e+=String.fromCharCode(i),e+=String.fromCharCode(s)}else e+=String.fromCharCode(n)}return e}else throw new Error("Unsupported buffer argument")}}function yl(r,e){const t=new r.constructor(r.length+e.length);return t.set(r),t.set(e,r.length),t}function Qe(r,e){var s;if(((s=r==null?void 0:r.constructor)==null?void 0:s.name)==="DataSnapshot")throw new TypeError(`Object to clone is a DataSnapshot (path "${r.ref.path}")`);const t=o=>(o!==null&&typeof o=="object"&&typeof o.constructor=="function"&&typeof o.constructor.name=="string"&&["Buffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","BigUint64Array","BigInt64Array"].includes(o.constructor.name)&&(o=o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)),o);if(r=t(r),typeof r!="object"||r===null||r instanceof Date||r instanceof ArrayBuffer||r instanceof pe||r instanceof RegExp)return r;const n=o=>{if(e.indexOf(o)>=0)throw new ReferenceError("object contains a circular reference");return o=t(o),o===null||o instanceof Date||o instanceof ArrayBuffer||o instanceof pe||o instanceof RegExp||typeof o=="object"&&(e.push(o),o=Qe(o,e),e.pop()),o};typeof e=="undefined"&&(e=[r]);const i=r instanceof Array?[]:r instanceof $n?new $n:{};return Object.keys(r).forEach(o=>{const a=r[o];typeof a!="function"&&(i[o]=n(a))}),i}const wt=r=>typeof r=="object"&&["ArrayBuffer","Buffer","Uint8Array","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array"].includes(r.constructor.name);function Bn(r,e){if(r===e)return!0;if(typeof r!=typeof e)return!1;if(typeof r=="object"||typeof e=="object"){if(r===null||e===null)return!1;if(r instanceof pe||e instanceof pe)return r instanceof pe&&e instanceof pe&&r.path===e.path;if(r instanceof Date||e instanceof Date)return r instanceof Date&&e instanceof Date&&r.getTime()===e.getTime();if(r instanceof Array||e instanceof Array)return r instanceof Array&&e instanceof Array&&r.length===e.length&&r.every((i,s)=>Bn(r[s],e[s]));if(wt(r)||wt(e)){if(!wt(r)||!wt(e)||r.byteLength===e.byteLength)return!1;const i=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength),s=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.every((o,a)=>s[a]===o)}const t=Object.keys(r),n=Object.keys(e);return t.length===n.length&&t.every(i=>n.includes(i))&&t.every(i=>Bn(r[i],e[i]))}return!1}class fo{constructor(e,t,n){this.added=e,this.removed=t,this.changed=n}forChild(e){if(this.added.includes(e))return"added";if(this.removed.includes(e))return"removed";const t=this.changed.find(n=>n.key===e);return t?t.change:"identical"}}function ti(r,e,t=!1){const n=[void 0,null];if(r===e)return"identical";if(n.indexOf(r)>=0&&n.indexOf(e)<0)return"added";if(n.indexOf(r)<0&&n.indexOf(e)>=0)return"removed";if(typeof r!=typeof e)return"changed";if(wt(r)||wt(e)){if(!wt(r)||!wt(e))return"changed";const i=r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength),s=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return i.byteLength===s.byteLength&&i.every((o,a)=>s[a]===o)?"identical":"changed"}else{if(r instanceof Date||e instanceof Date)return r instanceof Date&&e instanceof Date&&r.getTime()===e.getTime()?"identical":"changed";if(r instanceof pe||e instanceof pe)return r instanceof pe&&e instanceof pe&&r.path===e.path?"identical":"changed";if(typeof r=="object"){const i=r instanceof Array,s=f=>{let p=Object.keys(f).filter(d=>!n.includes(f[d]));return i&&(p=p.map(d=>parseInt(d))),p},o=s(r),a=s(e),c=o.filter(f=>!a.includes(f)),u=a.filter(f=>!o.includes(f)),l=a.reduce((f,p)=>{if(o.includes(p)){const d=r[p],h=e[p],y=ti(d,h);y!=="identical"&&f.push({key:p,change:y})}return f},[]);return u.length===0&&c.length===0&&l.length===0?"identical":new fo(u,c,t?l.sort((f,p)=>f.key<p.key?-1:1):l)}}return"changed"}function ho(r,e,t=!1){const n=(s,o,a,c)=>{switch(o){case"identical":return[];case"changed":return[{target:s,prev:a,val:c}];case"added":return[{target:s,prev:null,val:c}];case"removed":return[{target:s,prev:a,val:null}];default:{let u=[];return o.added.forEach(l=>u.push({target:s.concat(l),prev:null,val:c[l]})),o.removed.forEach(l=>u.push({target:s.concat(l),prev:a[l],val:null})),o.changed.forEach(l=>{const f=n(s.concat(l.key),l.change,a[l.key],c[l.key]);u=u.concat(f)}),u}}},i=ti(r,e,t);return n([],i,r,e)}function ml(r,e,t){return e=e===null?null:e[r],typeof e=="undefined"&&(e=null),t=t===null?null:t[r],typeof t=="undefined"&&(t=null),{oldValue:e,newValue:t}}function gl(r){qe.nextTick(r)}function po(){var r;return typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:(r=function(){return this}())!=null?r:Function("return this")()}const yo=Object.freeze(Object.defineProperty({__proto__:null,numberToBytes:ll,bytesToNumber:fl,bigintToBytes:hl,bytesToBigint:dl,encodeString:pl,decodeString:lo,concatTypedArrays:yl,cloneObject:Qe,valuesAreEqual:Bn,ObjectDifferences:fo,compareValues:ti,getMutations:ho,getChildValues:ml,defer:gl,getGlobalObject:po},Symbol.toStringTag,{value:"Module"})),vl="modulepreload",wl=function(r){return"/"+r},ss={},bl=function(e,t,n){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=wl(s),s in ss)return;ss[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!n)for(let l=i.length-1;l>=0;l--){const f=i[l];if(f.href===s&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":vl,o||(u.as="script",u.crossOrigin=""),u.href=s,document.head.appendChild(u),o)return new Promise((l,f)=>{u.addEventListener("load",l),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};let mo=!1,bt;P(void 0,null,function*(){const r=po();if(typeof r.Observable!="undefined"){bt=r.Observable;return}try{const{Observable:e}=yield bl(()=>Promise.resolve().then(()=>vp),void 0);bt=e}catch(e){bt=ri}});function ni(){if(bt===ri&&!mo&&console.warn(`Using AceBase's simple Observable implementation because rxjs is not available. Add it to your project with "npm install rxjs", add it to AceBase using db.setObservable(Observable), or call db.setObservable("shim") to suppress this warning`),bt)return bt;throw new Error("RxJS Observable could not be loaded. ")}function xl(r){r==="shim"?(bt=ri,mo=!0):bt=r}class ri{constructor(e){this._active=!1,this._subscribers=[],this._create=e}subscribe(e){if(!this._active){const s={next:o=>{this._subscribers.forEach(a=>{try{a(o)}catch(c){console.error("Error in subscriber callback:",c)}})}};this._cleanup=this._create(s),this._active=!0}return this._subscribers.push(e),{unsubscribe:()=>{this._subscribers.splice(this._subscribers.indexOf(e),1),this._subscribers.length===0&&(this._active=!1,this._cleanup())}}}}class Ue extends Array{static areEqual(e,t){return e.length===t.length&&e.every((n,i)=>t[i]===n)}static isAncestor(e,t){return e.length<t.length&&e.every((n,i)=>t[i]===n)}static isDescendant(e,t){return e.length>t.length&&t.every((n,i)=>e[i]===n)}}const kt=Symbol("isProxy");class El{static create(e,t){return P(this,null,function*(){var m;e=new Xe(e.db,e.path);let n,i=!1,s=t==null?void 0:t.cursor,o;const a=Ie.generate(),c=[],u=new Mt;u.on("cursor",g=>s=g),u.on("error",g=>{console.error(g.message,g.details)});const l=(g,w)=>{if(g.length===0)return n=w,!0;let v=n;const E=g.slice();for(;E.length>1;){const O=E.shift();if(!(O in v))return!1;v=v[O]}const T=E.shift();return w===null?v instanceof Array?v.splice(T,1):delete v[T]:v[T]=w,!0},f=()=>P(this,null,function*(){!i||(yield S())}),p=e.on("mutations",{syncFallback:f}).subscribe(g=>P(this,null,function*(){var O;if(!i)return;const w=g.context(),v=((O=w.acebase_proxy)==null?void 0:O.id)!==a;if(!v)return;g.val(!1).every(R=>{if(!l(R.target,R.val))return!1;const C=R.target.reduce((D,V)=>D.child(V),e),I=new de(C,R.val,!1,R.prev,g.context());return u.emit("mutation",{snapshot:I,isRemote:v}),!0})?(u.emit("cursor",w.acebase_cursor),Z.emit("mutations",{origin:"remote",snap:g})):(console.warn(`Cached value of live data proxy on "${e.path}" appears outdated, will be reloaded`),yield S())}));let d=Promise.resolve();const h=[],y=[],b=()=>P(this,null,function*(){const g=[];for(let w=0,v=h[0];w<h.length;w++,v=h[w])y.find(E=>Ue.areEqual(E.target,v.target)||Ue.isAncestor(E.target,v.target))||(h.splice(w,1),w--,g.push(v));g.length!==0&&(g.forEach(w=>{w.value=Qe(Me(n,w.target))}),qe.nextTick(()=>{const w={acebase_proxy:{id:a,source:"update"}};g.forEach(E=>{const T=E.target.reduce((R,C)=>R.child(C),e),O=new de(T,E.value,!1,E.previous,w);u.emit("mutation",{snapshot:O,isRemote:!1})});const v=new Sn(e,g.map(E=>({target:E.target,val:E.value,prev:E.previous})),w);Z.emit("mutations",{origin:"local",snap:v})}),d=g.reduce((w,v,E,T)=>(T.some(O=>Ue.isAncestor(O.target,v.target))||w.push(v),w),[]).reduce((w,v)=>{const E=v.target;if(E.length===0)w.push({ref:e,target:E,value:n,type:"set",previous:v.previous});else{const T=E.slice(0,-1),O=E.slice(-1)[0],R=T.reduce((V,H)=>V.child(H),e),C=w.find(V=>V.ref.path===R.path),I=Me(n,E),D=v.previous;C?(C.value[O]=I,C.previous[O]=D):w.push({ref:R,target:T,value:{[O]:I},type:"update",previous:{[O]:D}})}return w},[]).reduce((w,v)=>P(this,null,function*(){const E={acebase_proxy:{id:a,source:v.type}};yield w,yield v.ref.context(E)[v.type](v.value).catch(T=>{u.emit("error",{source:"update",message:`Error processing update of "/${e.path}"`,details:T});const O={acebase_proxy:{id:a,source:"update-rollback"}},R=[];if(v.type==="set"){pr(n,v.target,v.previous);const I=new de(v.ref,v.previous,!1,v.value,O);u.emit("mutation",{snapshot:I,isRemote:!1}),R.push({target:v.target,val:v.previous,prev:v.value})}else Object.keys(v.previous).forEach(I=>{pr(n,v.target.concat(I),v.previous[I]);const D=new de(v.ref.child(I),v.previous[I],!1,v.value[I],O);u.emit("mutation",{snapshot:D,isRemote:!1}),R.push({target:v.target.concat(I),val:v.previous[I],prev:v.value[I]})});R.forEach(I=>{const D=I.target.reduce((H,G)=>H.child(G),e),V=new de(D,I.val,!1,I.prev,O);u.emit("mutation",{snapshot:V,isRemote:!1})});const C=new Sn(v.ref,R,O);Z.emit("mutations",{origin:"local",snap:C})}),v.ref.cursor&&u.emit("cursor",v.ref.cursor)}),d),yield d)});let _=!1;const j=[],$=()=>{let g;const w=new Promise(v=>g=v);return j.push({resolve:g}),w};let L=null;const K=()=>{L||(L=setTimeout(()=>P(this,null,function*(){_=!0,L=null,yield b(),_=!1,j.splice(0).forEach(g=>g.resolve())}),0))},M=g=>{h.find(w=>Ue.areEqual(w.target,g))||h.push({target:g,previous:Qe(Me(n,g))}),K()},Z=new Mt,se=(g,w)=>{const v=O=>O!==null&&typeof O=="object",E=O=>P(this,null,function*(){var Ee;const{snap:R,origin:C}=O,I=R.context(),D=((Ee=I.acebase_proxy)==null?void 0:Ee.id)===a;if(O.origin==="remote"&&D){console.error("DEV ISSUE: mutationsHandler was called from remote event originating from our own proxy");return}const V=R.val(!1).filter(oe=>oe.target.slice(0,g.length).every((ae,ye)=>g[ye]===ae));if(V.length===0)return;let H,G;const W=V.find(oe=>oe.target.length<=g.length);if(W){const oe=g.slice(W.target.length);H=oe.reduce((ae,ye)=>!v(ae)||!(ye in ae)?null:ae[ye],W.val),G=oe.reduce((ae,ye)=>!v(ae)||!(ye in ae)?null:ae[ye],W.prev)}else{const oe=Me(n,g);H=Qe(oe),G=Qe(H),V.forEach(ae=>{const ye=ae.target.slice(g.length);for(let ie=0,Se=H,ce=G;ie<ye.length;ie++){const Re=ie+1===ye.length,ke=ye[ie];Re?(Se[ke]=ae.val,Se[ke]===null&&delete Se[ke],ce[ke]=ae.prev,ce[ke]===null&&delete ce[ke]):(Se=Se[ke]=ke in Se?Se[ke]:{},ce=ce[ke]=ke in ce?ce[ke]:{})}})}qe.nextTick(()=>{let oe=!0;try{oe=w(Object.freeze(H),Object.freeze(G),!D,I)!==!1}catch(ae){u.emit("error",{source:C==="remote"?"remote_update":"local_update",message:"Error running subscription callback",details:ae})}oe===!1&&T()})});Z.on("mutations",E);const T=()=>{Z.off("mutations",E),c.splice(c.findIndex(O=>O.stop===T),1)};return c.push({target:g,stop:T}),{stop:T}},re=(g,w,v)=>{if(g==="write")return M(w);if(g==="onChange")return se(w,v.callback);if(g==="subscribe"||g==="observe"){const E=O=>{const R=Me(n,w);O.next(R);const C=se(w,I=>{O.next(I)});return function(){C.stop()}};if(g==="subscribe")return E;const T=ni();return new T(E)}else if(g==="transaction")return y.some(T=>Ue.areEqual(w,T.target)||Ue.isAncestor(w,T.target)||Ue.isDescendant(w,T.target))?Promise.reject(new Error("Cannot start transaction because it conflicts with another transaction")):new Promise(T=>P(this,null,function*(){h.some(I=>Ue.areEqual(w,I.target)||Ue.isAncestor(w,I.target))&&(_||K(),yield $());const R={target:w,status:"started",transaction:null};y.push(R),R.transaction={get status(){return R.status},get completed(){return R.status!=="started"},get mutations(){return h.filter(I=>Ue.areEqual(R.target,I.target)||Ue.isAncestor(R.target,I.target))},get hasMutations(){return this.mutations.length>0},commit(){return P(this,null,function*(){if(this.completed)throw new Error(`Transaction has completed already (status '${R.status}')`);R.status="finished",y.splice(y.indexOf(R),1),_&&(yield $()),K(),yield $()})},rollback(){if(this.completed)throw new Error(`Transaction has completed already (status '${R.status}')`);R.status="canceled";const I=[];for(let D=0;D<h.length;D++){const V=h[D];(Ue.areEqual(R.target,V.target)||Ue.isAncestor(R.target,V.target))&&(h.splice(D,1),D--,I.push(V))}I.reverse().forEach(D=>{D.target.length===0?n=D.previous:pr(n,D.target,D.previous)}),y.splice(y.indexOf(R),1)}},T(R.transaction)}))},x=yield e.get({cache_mode:"allow",cache_cursor:t==null?void 0:t.cursor});if(x.context().acebase_origin!=="cache"&&u.emit("cursor",(m=e.cursor)!=null?m:null),i=!0,n=x.val(),n===null&&typeof(t==null?void 0:t.defaultValue)!="undefined"){n=t.defaultValue;const g={acebase_proxy:{id:a,source:"default"}};yield e.context(g).set(n)}o=go({root:{ref:e,get cache(){return n}},target:[],id:a,flag:re});const k=()=>{if(o===null)throw new Error("Proxy was destroyed")},S=()=>P(this,null,function*(){k(),h.splice(0);const g=yield e.get({allow_cache:!1}),w=n,v=g.val();n=v;const E=ho(w,v);if(E.length===0)return;const T=g.context();T.acebase_proxy={id:a,source:"reload"},E.forEach(R=>{const C=$r(e,R.target),I=new de(C,R.val,R.val===null,R.prev,T);u.emit("mutation",{snapshot:I,isRemote:!0})});const O=new Sn(e,E,T);Z.emit("mutations",{origin:"local",snap:O})});return{destroy(){return P(this,null,function*(){yield d;const g=[p.stop(),...c.map(w=>w.stop())];yield Promise.all(g),["cursor","mutation","error"].forEach(w=>u.off(w)),n=null,o=null})},stop(){this.destroy()},get value(){return k(),o},get hasValue(){return k(),n!==null},set value(g){k(),g!==null&&typeof g=="object"&&g[kt]&&(g=g.valueOf()),M([]),n=g},get ref(){return e},get cursor(){return s},reload:S,onMutation(g){k(),u.off("mutation"),u.on("mutation",({snapshot:w,isRemote:v})=>{try{g(w,v)}catch(E){u.emit("error",{source:"mutation_callback",message:"Error in dataproxy onMutation callback",details:E})}})},onError(g){k(),u.off("error"),u.on("error",w=>{try{g(w)}catch(v){console.error(`Error in dataproxy onError callback: ${v.message}`)}})},on(g,w){u.on(g,w)},off(g,w){u.off(g,w)}}})}}function Me(r,e){let t=r;for(const n of e)t=typeof t=="object"&&t!==null&&n in t?t[n]:null;return t}function pr(r,e,t){if(e.length===0)throw new Error("Cannot update root target, caller must do that itself!");const n=e.slice(0,-1).reduce((s,o)=>s[o],r),i=e.slice(-1)[0];t===null||typeof t=="undefined"?n instanceof Array?n.splice(i,1):delete n[i]:n[i]=t}function $r(r,e){const t=N.get(r.path).childPath(e);return new Xe(r.db,t)}function go(r){const e=$r(r.root.ref,r.target),t=[],n={get(s,o,a){if(s=Me(r.root.cache,r.target),typeof o=="symbol")if(o.toString()===Symbol.iterator.toString())o="values";else return o.toString()===kt.toString()?!0:Reflect.get(s,o,a);if(o==="valueOf")return function(){return s};if(s===null||typeof s!="object")throw new Error(`Cannot read property "${o}" of ${s}. Value of path "/${e.path}" is not an object (anymore)`);s instanceof Array&&typeof o=="string"&&/^[0-9]+$/.test(o)&&(o=parseInt(o));const c=s[o];if(c===null){delete s[o];return}const u=t.find(d=>d.prop===o);if(u){if(u.typeof===typeof c)return u.value;t.splice(t.indexOf(u),1)}const l=d=>{const h=s[d],y=t.find(_=>_.prop===d);if(y){if(y.typeof===typeof h)return y.value;t.splice(t.indexOf(y),1)}if(typeof h!="object")return h;const b=go({root:r.root,target:r.target.concat(d),id:r.id,flag:r.flag});return t.push({typeof:typeof h,prop:d,value:b}),b},f=d=>d!==null&&typeof d=="object"&&d[kt]?d.getTarget():d;if(["string","number","boolean"].includes(typeof c)||c instanceof Date||c instanceof pe||c instanceof ArrayBuffer||typeof c=="object"&&"buffer"in c)return c;const p=s instanceof Array;if(o==="toString")return function(){return`[LiveDataProxy for "${e.path}"]`};if(typeof c=="undefined")return o==="push"?function(h){const y=e.push();return r.flag("write",r.target.concat(y.key)),s[y.key]=h,y.key}:o==="getTarget"?function(d=!0){return d&&console.warn("Use getTarget with caution - any changes will not be synchronized!"),s}:o==="getRef"?function(){return $r(r.root.ref,r.target)}:o==="forEach"?function(h){const y=Object.keys(s);let b=!1;for(let _=0;!b&&_<y.length;_++){const j=y[_],$=l(j);b=h($,j,_)===!1}}:["values","entries","keys"].includes(o)?function*(){const h=Object.keys(s);for(const y of h)if(o==="keys")yield y;else{const b=l(y);o==="entries"?yield[y,b]:yield b}}:o==="toArray"?function(h){const y=Object.keys(s).map(b=>l(b));return h&&y.sort(h),y}:o==="onChanged"?function(h){return r.flag("onChange",r.target,{callback:h})}:o==="subscribe"?function(){return r.flag("subscribe",r.target)}:o==="getObservable"?function(){return r.flag("observe",r.target)}:o==="getOrderedCollection"?function(h,y){return new kl(this,h,y)}:o==="startTransaction"?function(){return r.flag("transaction",r.target)}:o==="remove"&&!p?function(){if(r.target.length===0)throw new Error("Can't remove proxy root value");const h=Me(r.root.cache,r.target.slice(0,-1)),y=r.target.slice(-1)[0];r.flag("write",r.target),delete h[y]}:void 0;if(typeof c=="function"){if(p){const d=y=>(r.flag("write",r.target),y()),h=y=>y.map(b=>(b=f(b),Br(b),b));if(o==="push")return function(...b){return b=h(b),d(()=>s.push(...b))};if(o==="pop")return function(){return d(()=>s.pop())};if(o==="splice")return function(b,_,...j){return j=h(j),d(()=>s.splice(b,_,...j))};if(o==="shift")return function(){return d(()=>s.shift())};if(o==="unshift")return function(...b){return b=h(b),d(()=>s.unshift(...b))};if(o==="sort")return function(b){return d(()=>s.sort(b))};if(o==="reverse")return function(){return d(()=>s.reverse())};if(["indexOf","lastIndexOf"].includes(o))return function(b,_){return b!==null&&typeof b=="object"&&b[kt]&&(b=b.getTarget(!1)),s[o](b,_)};if(["forEach","every","some","filter","map"].includes(o))return function(b){return s[o]((_,j)=>b(l(j),j,i))};if(["reduce","reduceRight"].includes(o))return function(b,_){return s[o]((j,$,L)=>b(j,l(L),L,i),_)};if(["find","findIndex"].includes(o))return function(b){let _=s[o]((j,$)=>b(l($),$,i));if(o==="find"&&_){const j=s.indexOf(_);_=l(j)}return _};if(["values","entries","keys"].includes(o))return function*(){for(let b=0;b<s.length;b++)if(o==="keys")yield b;else{const _=l(b);o==="entries"?yield[b,_]:yield _}}}return c}return l(o)},set(s,o,a,c){if(s=Me(r.root.cache,r.target),typeof o=="symbol")return Reflect.set(s,o,a,c);if(s===null||typeof s!="object")throw new Error(`Cannot set property "${o}" of ${s}. Value of path "/${e.path}" is not an object`);if(s instanceof Array&&typeof o=="string"){if(!/^[0-9]+$/.test(o))throw new Error(`Cannot set property "${o}" on array value of path "/${e.path}"`);o=parseInt(o)}return a!==null&&(typeof a=="object"&&(a[kt]&&(a=a.valueOf()),a=Qe(a)),Bn(a,s[o]))||(r.target.some(u=>typeof u=="number")?r.flag("write",r.target.slice(0,r.target.findIndex(u=>typeof u=="number"))):s instanceof Array?r.flag("write",r.target):r.flag("write",r.target.concat(o)),a===null?delete s[o]:(Br(a),s[o]=a)),!0},deleteProperty(s,o){if(s=Me(r.root.cache,r.target),s===null)throw new Error(`Cannot delete property ${o.toString()} of null`);return typeof o=="symbol"?Reflect.deleteProperty(s,o):(o in s&&(r.flag("write",r.target.concat(o)),delete s[o]),!0)},ownKeys(s){return s=Me(r.root.cache,r.target),Reflect.ownKeys(s)},has(s,o){return s=Me(r.root.cache,r.target),Reflect.has(s,o)},getOwnPropertyDescriptor(s,o){s=Me(r.root.cache,r.target);const a=Reflect.getOwnPropertyDescriptor(s,o);return a&&(a.configurable=!0),a},getPrototypeOf(s){return s=Me(r.root.cache,r.target),Reflect.getPrototypeOf(s)}},i=new Proxy({},n);return i}function Br(r){typeof r=="object"&&Object.keys(r).forEach(e=>{const t=r[e];t===null||typeof t=="undefined"?delete r[e]:typeof t=="object"&&Br(t)})}function On(r){if(typeof r!="object"||!r[kt])throw new Error("Given value is not proxied. Make sure you are referencing the value through the live data proxy.");return r}class kl{constructor(e,t="order",n=10){if(this.collection=e,this.orderProperty=t,this.orderIncrement=n,typeof e!="object"||!e[kt])throw new Error("Collection is not proxied");if(e.valueOf()instanceof Array)throw new Error("Collection is an array, not an object collection");if(!Object.keys(e).every(s=>typeof e[s]=="object"))throw new Error("Collection has non-object children");if(!Object.keys(e).every(s=>typeof e[s][t]=="number")){const s=Object.keys(e);for(let o=0;o<s.length;o++){const a=e[s[o]];a[t]=o*n}}}getObservable(){return On(this.collection).getObservable()}getArrayObservable(){const e=ni();return new e(t=>{const n=this.getObservable().subscribe(()=>{const i=this.getArray();t.next(i)});return function(){n.unsubscribe()}})}getArray(){return On(this.collection).toArray((t,n)=>t[this.orderProperty]-n[this.orderProperty])}add(e,t,n){const i=this.getArray();let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let u=0;u<i.length;u++){const l=i[u][this.orderProperty];s=Math.min(l,s),o=Math.max(l,o)}let a;if(typeof n=="number"){if(a=Object.keys(this.collection).find(u=>this.collection[u]===e),!a)throw new Error("item not found in collection");if(n===t)return{key:a,index:t};if(Math.abs(n-t)===1){const u=i[t],l=u[this.orderProperty];return u[this.orderProperty]=e[this.orderProperty],e[this.orderProperty]=l,{key:a,index:t}}else i.splice(n,1)}if(typeof t!="number"||t>=i.length)t=i.length,e[this.orderProperty]=i.length==0?0:o+this.orderIncrement;else if(t===0)e[this.orderProperty]=i.length==0?0:s-this.orderIncrement;else{const u=i.map(f=>f[this.orderProperty]),l=u[t]-u[t-1];if(l>1)e[this.orderProperty]=u[t]-Math.floor(l/2);else{i.splice(t,0,e);for(let f=0;f<i.length;f++)i[f][this.orderProperty]=f*this.orderIncrement}}return{key:typeof a=="string"?a:On(this.collection).push(e),index:t}}delete(e){const n=this.getArray()[e];if(!n)throw new Error(`Item at index ${e} not found`);const i=Object.keys(this.collection).find(s=>this.collection[s]===n);if(!i)throw new Error("Cannot find target object to delete");return this.collection[i]=null,{key:i,index:e}}move(e,t){const n=this.getArray();return this.add(n[e],t,e)}sort(e){const t=this.getArray();t.sort(e);for(let n=0;n<t.length;n++)t[n][this.orderProperty]=n*this.orderIncrement}}class vo{constructor(e){if(e||(e={}),typeof e.include!="undefined"&&!(e.include instanceof Array))throw new TypeError("options.include must be an array");if(typeof e.exclude!="undefined"&&!(e.exclude instanceof Array))throw new TypeError("options.exclude must be an array");if(typeof e.child_objects!="undefined"&&typeof e.child_objects!="boolean")throw new TypeError("options.child_objects must be a boolean");if(typeof e.cache_mode=="string"&&!["allow","bypass","force"].includes(e.cache_mode))throw new TypeError("invalid value for options.cache_mode");this.include=e.include||void 0,this.exclude=e.exclude||void 0,this.child_objects=typeof e.child_objects=="boolean"?e.child_objects:void 0,this.cache_mode=typeof e.cache_mode=="string"?e.cache_mode:typeof e.allow_cache=="boolean"?e.allow_cache?"allow":"bypass":"allow",this.cache_cursor=typeof e.cache_cursor=="string"?e.cache_cursor:void 0}}class Al extends vo{constructor(e){if(super(e),!["undefined","boolean"].includes(typeof e.snapshots))throw new TypeError("options.snapshots must be a boolean");this.snapshots=typeof e.snapshots=="boolean"?e.snapshots:!0}}const Q=Symbol("private");class Xe{constructor(e,t,n){this.db=e,t||(t=""),t=t.replace(/^\/|\/$/g,"");const s=N.get(t).key,o=[];this[Q]={get path(){return t},get key(){return s},get callbacks(){return o},vars:n||{},context:{},pushed:!1,cursor:null}}context(e,t=!1){const n=this[Q].context;if(typeof e=="object"){const i=e?t?n||{}:e:{};return e&&Object.keys(e).forEach(s=>{i[s]=e[s]}),this[Q].context=i,this}else{if(typeof e=="undefined")return console.warn("Use snap.context() instead of snap.ref.context() to get updating context in event callbacks"),n;throw new Error("Invalid context argument")}}get cursor(){return this[Q].cursor}set cursor(e){var t;this[Q].cursor=e,(t=this.onCursor)==null||t.call(this,e)}get path(){return this[Q].path}get key(){const e=this[Q].key;return typeof e=="number"?`[${e}]`:e}get index(){const e=this[Q].key;if(typeof e!="number")throw new Error(`"${e}" is not a number`);return e}get parent(){const e=N.fillVariables2(this.path,this.vars),t=N.get(e);return t.parentPath===null?null:new Xe(this.db,t.parentPath).context(this[Q].context)}get vars(){return this[Q].vars}child(e){e=typeof e=="number"?e:e.replace(/^\/|\/$/g,"");const t=N.fillVariables2(this.path,this.vars),n=N.getChildPath(t,e);return new Xe(this.db,n).context(this[Q].context)}set(e,t){return P(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot set the value of wildcard path "/${this.path}"`);if(this.parent===null)throw new Error("Cannot set the root object. Use update, or set individual child properties");if(typeof e=="undefined")throw new TypeError(`Cannot store undefined value in "/${this.path}"`);this.db.isReady||(yield this.db.ready()),e=this.db.types.serialize(this.path,e);const{cursor:n}=yield this.db.api.set(this.path,e,{context:this[Q].context});if(this.cursor=n,typeof t=="function")try{t(null,this)}catch(i){console.error("Error in onComplete callback:",i)}}catch(n){if(typeof t=="function")try{t(n,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw n}return this})}update(e,t){return P(this,null,function*(){try{if(this.isWildcardPath)throw new Error(`Cannot update the value of wildcard path "/${this.path}"`);if(this.db.isReady||(yield this.db.ready()),typeof e!="object"||e instanceof Array||e instanceof ArrayBuffer||e instanceof Date)yield this.set(e);else if(Object.keys(e).length===0)console.warn(`update called on path "/${this.path}", but there is nothing to update`);else{e=this.db.types.serialize(this.path,e);const{cursor:n}=yield this.db.api.update(this.path,e,{context:this[Q].context});this.cursor=n}if(typeof t=="function")try{t(null,this)}catch(n){console.error("Error in onComplete callback:",n)}}catch(n){if(typeof t=="function")try{t(n,this)}catch(i){console.error("Error in onComplete callback:",i)}else throw n}return this})}transaction(e){return P(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot start a transaction on wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());let t;const n=s=>{s=this.db.types.deserialize(this.path,s);const o=new de(this,s);let a;try{a=e(o)}catch(c){t=c;return}return a instanceof Promise?a.then(c=>this.db.types.serialize(this.path,c)).catch(c=>{t=c}):this.db.types.serialize(this.path,a)},{cursor:i}=yield this.db.api.transaction(this.path,n,{context:this[Q].context});if(this.cursor=i,t)throw t;return this})}on(e,t,n){this.path===""&&["value","child_changed"].includes(e)&&console.warn("WARNING: Listening for value and child_changed events on the root node is a bad practice. These events require loading of all data (value event), or potentially lots of data (child_changed event) each time they are fired");let i=null;const s=new nl(c=>{i=c}),o={event:e,stream:s,userCallback:typeof t=="function"&&t,ourCallback:(c,u,l,f,p)=>{if(c){this.db.debug.error(`Error getting data for event ${e} on path "${u}"`,c);return}const d=this.db.ref(u);d[Q].vars=N.extractVariables(this.path,u);let h;if(e.startsWith("notify_"))h=d.context(p||{});else{const y={previous:this.db.types.deserialize(u,f),current:this.db.types.deserialize(u,l)};if(e==="child_removed")h=new de(d,y.previous,!0,y.previous,p);else if(e==="mutations")h=new Sn(d,y.current,p);else{const b=e==="mutated"&&y.current===null;h=new de(d,y.current,b,y.previous,p)}}i.publish(h),p!=null&&p.acebase_cursor&&(this.cursor=p.acebase_cursor)}};this[Q].callbacks.push(o);const a=()=>{typeof t=="function"&&s.subscribe(t,(p,d)=>{p||n&&n(d)});const c=typeof t=="object"?t:{newOnly:!t};typeof c.newOnly!="boolean"&&(c.newOnly=!1),this.isWildcardPath&&(c.newOnly=!0);const u=p=>{const d=this[Q].callbacks;d.splice(d.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback),this.db.debug.error(`Subscription "${e}" on path "/${this.path}" canceled because of an error: ${p.message}`),i.cancel(p.message)},l=this.db.api.subscribe(this.path,e,o.ourCallback,{newOnly:c.newOnly,cancelCallback:u,syncFallback:c.syncFallback}),f=()=>{const p=this[Q].callbacks;return p.splice(p.indexOf(o),1),this.db.api.unsubscribe(this.path,e,o.ourCallback)};if(l instanceof Promise?l.then(()=>{i.start(f)}).catch(u):i.start(f),!c.newOnly){if(e==="value")this.get(p=>{i.publish(p)});else if(e==="child_added")this.get(p=>{const d=p.val();d===null||typeof d!="object"||Object.keys(d).forEach(h=>{const y=new de(this.child(h),d[h]);i.publish(y)})});else if(e==="notify_child_added"){let h=0;const y=()=>P(this,null,function*(){const b=yield this.db.api.reflect(this.path,"children",{limit:100,skip:h});b.list.forEach(_=>{const j=this.child(_.key);i.publish(j)}),b.more&&(h+=100,y())});y()}}};return this.db.isReady?a():this.db.ready(a),s}off(e,t){const i=this[Q].callbacks.filter(s=>(!e||s.event===e)&&(!t||s.userCallback===t));return i.length===0&&this.db.debug.warn(`Can't find event subscriptions to stop (path: "${this.path}", event: ${e||"(any)"}, callback: ${t})`),i.forEach(s=>{s.stream.stop()}),this}get(e,t){if(!this.db.isReady){const s=this.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}if(t=typeof e=="function"?e:typeof t=="function"?t:void 0,this.isWildcardPath){const s=new Error(`Cannot get value of wildcard path "/${this.path}". Use .query() instead`);if(typeof t=="function")throw s;return Promise.reject(s)}const n=new vo(typeof e=="object"?e:{cache_mode:"allow"}),i=this.db.api.get(this.path,n).then(s=>{var u;"context"in s&&"value"in s||(console.warn("AceBase api.get method returned an old response value. Update your acebase or acebase-client package"),s={value:s,context:{}});const a=this.db.types.deserialize(this.path,s.value),c=new de(this,a,void 0,void 0,s.context);return(u=s.context)!=null&&u.acebase_cursor&&(this.cursor=s.context.acebase_cursor),c});if(t){i.then(t).catch(s=>{console.error("Uncaught error:",s)});return}else return i}once(e,t){return e==="value"&&!this.isWildcardPath?this.get(t):new Promise(n=>{const i=s=>{this.off(e,i),n(s)};this.on(e,i)})}push(e,t){if(this.isWildcardPath){const s=new Error(`Cannot push to wildcard path "/${this.path}"`);if(typeof e=="undefined"||typeof t=="function")throw s;return Promise.reject(s)}const n=Ie.generate(),i=this.child(n);return i[Q].pushed=!0,typeof e!="undefined"?i.set(e,t).then(()=>i):i}remove(){return P(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot remove wildcard path "/${this.path}". Use query().remove instead`);if(this.parent===null)throw new Error("Cannot remove the root node");return this.set(null)})}exists(){return P(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot check wildcard path "/${this.path}" existence`);return this.db.isReady||(yield this.db.ready()),this.db.api.exists(this.path)})}get isWildcardPath(){return this.path.indexOf("*")>=0||this.path.indexOf("$")>=0}query(){return new wo(this)}count(){return P(this,null,function*(){return(yield this.reflect("info",{child_count:!0})).children.count})}reflect(e,t){return P(this,null,function*(){if(this.isWildcardPath)throw new Error(`Cannot reflect on wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.reflect(this.path,e,t)})}export(n){return P(this,arguments,function*(e,t={format:"json",type_safe:!0}){if(this.isWildcardPath)throw new Error(`Cannot export wildcard path "/${this.path}"`);this.db.isReady||(yield this.db.ready());const i=typeof e=="function"?e:e.write.bind(e);return this.db.api.export(this.path,i,t)})}import(n){return P(this,arguments,function*(e,t={format:"json",suppress_events:!1}){if(this.isWildcardPath)throw new Error(`Cannot import to wildcard path "/${this.path}"`);return this.db.isReady||(yield this.db.ready()),this.db.api.import(this.path,e,t)})}proxy(e){const t=typeof e=="object"&&(typeof e.cursor!="undefined"||typeof e.defaultValue!="undefined");return typeof e!="undefined"&&!t&&(this.db.debug.warn("Warning: live data proxy is being initialized with a deprecated method signature. Use ref.proxy(options) instead of ref.proxy(defaultValue)"),e={defaultValue:e}),El.create(this,e)}observe(e){if(e)throw new Error("observe does not support data retrieval options yet");if(this.isWildcardPath)throw new Error(`Cannot observe wildcard path "/${this.path}"`);const t=ni();return new t(n=>{let i,s=!1,o=this.get(e).then(c=>{s=!0,i=c.val(),n.next(i)});const a=c=>{if(!s){o=o.then(()=>a(c));return}const u=c.ref.path;if(u===this.path)return i=c.val(),n.next(i);const l=N.getPathKeys(u).slice(N.getPathKeys(this.path).length);let f=i;for(;l.length>1;){const h=l.shift();h in f||(f[h]=typeof l[0]=="number"?[]:{}),f=f[h]}const p=l.shift(),d=c.val();d===null?f instanceof Array&&typeof p=="number"?f.splice(p,1):delete f[p]:f[p]=d,n.next(i)};return this.on("mutated",a),()=>{this.off("mutated",a)}})}forEach(e,t){return P(this,null,function*(){let n;if(typeof e=="function"?t=e:n=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.reflect("children",{limit:0,skip:0}),s={canceled:!1,total:i.list.length,processed:0};for(let o=0;o<i.list.length;o++){const a=i.list[o].key,c=yield this.child(a).get(n);if(s.processed++,!c.exists())continue;if((yield t(c))===!1){s.canceled=!0;break}}return s})}getMutations(e){return P(this,null,function*(){const t=typeof e=="string"?e:void 0,n=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getMutations({path:this.path,cursor:t,timestamp:n})})}getChanges(e){return P(this,null,function*(){const t=typeof e=="string"?e:void 0,n=e===null||typeof e=="undefined"?0:e instanceof Date?e.getTime():void 0;return this.db.api.getChanges({path:this.path,cursor:t,timestamp:n})})}}class wo{constructor(e){this.ref=e,this[Q]={filters:[],skip:0,take:0,order:[],events:{}}}filter(e,t,n){if((t==="in"||t==="!in")&&(!(n instanceof Array)||n.length===0))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing at least 1 value`);if((t==="between"||t==="!between")&&(!(n instanceof Array)||n.length!==2))throw new Error(`${t} filter for ${e} must supply an Array compare argument containing 2 values`);if((t==="matches"||t==="!matches")&&!(n instanceof RegExp))throw new Error(`${t} filter for ${e} must supply a RegExp compare argument`);return this[Q].filters.push({key:e,op:t,compare:n}),this}where(e,t,n){return this.filter(e,t,n)}take(e){return this[Q].take=e,this}skip(e){return this[Q].skip=e,this}sort(e,t=!0){if(!["string","number"].includes(typeof e))throw"key must be a string or number";return this[Q].order.push({key:e,ascending:t}),this}order(e,t=!0){return this.sort(e,t)}get(e,t){if(!this.ref.db.isReady){const s=this.ref.db.ready().then(()=>this.get(e,t));return typeof e!="function"&&typeof t!="function"?s:void 0}t=typeof e=="function"?e:typeof t=="function"?t:void 0;const n=new Al(typeof e=="object"?e:{snapshots:!0,cache_mode:"allow"});n.allow_cache=n.cache_mode!=="bypass",n.eventHandler=s=>{if(!this[Q].events[s.name])return!1;const o=this[Q].events[s.name];if(typeof o!="object"||o.length===0)return!1;if(["add","change","remove"].includes(s.name)){const a={name:s.name,ref:new Xe(this.ref.db,s.path)};if(n.snapshots&&s.name!=="remove"){const c=i.types.deserialize(s.path,s.value);a.snapshot=new de(a.ref,c,!1)}s=a}o.forEach(a=>{var c,u;try{a(s)}catch(l){this.ref.db.debug.error(`Error executing "${s.name}" event handler of realtime query on path "${this.ref.path}": ${(u=(c=l==null?void 0:l.stack)!=null?c:l==null?void 0:l.message)!=null?u:l}`)}})},n.monitor={add:!1,change:!1,remove:!1},this[Q].events&&(this[Q].events.add&&this[Q].events.add.length>0&&(n.monitor.add=!0),this[Q].events.change&&this[Q].events.change.length>0&&(n.monitor.change=!0),this[Q].events.remove&&this[Q].events.remove.length>0&&(n.monitor.remove=!0)),this.stop();const i=this.ref.db;return i.api.query(this.ref.path,this[Q],n).catch(s=>{throw new Error(s)}).then(s=>{const{stop:o}=s;let{results:a,context:c}=s;if(this.stop=()=>P(this,null,function*(){yield o()}),"results"in s&&"context"in s||(console.warn("Query results missing context. Update your acebase and/or acebase-client packages"),a=s,c={}),n.snapshots){const u=a.map(l=>{const f=i.types.deserialize(l.path,l.val);return new de(i.ref(l.path),f,!1,void 0,c)});return Hn.from(u)}else{const u=a.map(l=>i.ref(l));return ii.from(u)}}).then(s=>(t&&t(s),s))}stop(){return P(this,null,function*(){})}getRefs(e){return this.get({snapshots:!1},e)}find(){return this.get({snapshots:!1})}count(){return P(this,null,function*(){return(yield this.find()).length})}exists(){return P(this,null,function*(){const e=this[Q].take,t=this.take(1).find();return this.take(e),(yield t).length!==0})}remove(e){return P(this,null,function*(){const t=yield this.find(),n=t.reduce((a,c)=>{const u=a[c.parent.path];return u?u.push(c):a[c.parent.path]=[c],a},{}),i=this.ref.db,s=Object.keys(n).map(a=>P(this,null,function*(){const c=t.reduce((l,f)=>(l[f.key]=null,l),{}),u=i.ref(a);try{return yield u.update(c),{ref:u,success:!0}}catch(l){return{ref:u,success:!1,error:l}}})),o=yield Promise.all(s);return e&&e(o),o})}on(e,t){return this[Q].events[e]||(this[Q].events[e]=[]),this[Q].events[e].push(t),this}off(e,t){if(typeof e=="undefined")return this[Q].events={},this;if(!this[Q].events[e])return this;if(typeof t=="undefined")return delete this[Q].events[e],this;const n=this[Q].events[e].indexOf(t);return~n?(this[Q].events[e].splice(n,1),this):this}forEach(e,t){return P(this,null,function*(){let n;if(typeof e=="function"?t=e:n=e,typeof t!="function")throw new TypeError("No callback function given");const i=yield this.find(),s={canceled:!1,total:i.length,processed:0};for(let o=0;o<i.length;o++){const c=yield i[o].get(n);if(s.processed++,!c.exists())continue;if((yield t(c))===!1){s.canceled=!0;break}}return s})}}class Hn extends Array{static from(e){const t=new Hn(e.length);return e.forEach((n,i)=>t[i]=n),t}getValues(){return this.map(e=>e.val())}}class ii extends Array{static from(e){const t=new ii(e.length);return e.forEach((n,i)=>t[i]=n),t}getPaths(){return this.map(e=>e.path)}}function _l(r,e){e=e.replace(/^\/|\/$/g,"");const t=N.getPathKeys(e),n=Object.keys(r).find(s=>{const o=N.getPathKeys(s);return o.length!==t.length?!1:o.every((a,c)=>a==="*"||typeof a=="string"&&a[0]==="$"?!0:a===t[c])});return r[n]}function Sl(r,e){const t=N.get(e).parentPath;if(t!==null)return _l(r,t)}function Ol(r,e){e=e.replace(/^\/|\/$/g,"");const n=N.get(e).parentPath,i=n?N.getPathKeys(n):[];return Object.keys(r).reduce((o,a)=>{const c=N.getPathKeys(a);if(c.length<i.length)return o;let u=!0;if(i.length===0&&n!==null?u=c.length===1&&(c[0]==="*"||typeof c[0]=="string"&&c[0][0]==="$"):c.every((l,f)=>f>=i.length?!1:l==="*"||typeof l=="string"&&l[0]==="$"||l===i[f]?!0:(u=!1,!1)),u){const l=r[a];o.push({path:a,type:l})}return o},[])}function os(r,e,t,n,i){if(n===null||typeof n!="object")return n;const s=N.getPathKeys(t),o=Ol(e,t),a=[];return o.sort((c,u)=>N.getPathKeys(c.path).length>N.getPathKeys(u.path).length?-1:1),o.forEach(c=>{const u=N.getPathKeys(c.path);u.push("*");const l=u.slice(s.length);if(l.length===0){const p=N.extractVariables(c.path,t),d=new Xe(r,t,p);if(i==="serialize")n=c.type.serialize(n,d);else if(i==="deserialize"){const h=new de(d,n);n=c.type.deserialize(h)}return}const f=(p,d,h)=>{if(n===null||typeof n!="object")return n;const y=h[0];let b=[];if(y==="*"||typeof y=="string"&&y[0]==="$")d instanceof Array?b=d.map((_,j)=>({key:j,val:_})):b=Object.keys(d).map(_=>({key:_,val:d[_]}));else{const _=d[y];typeof _=="object"&&b.push({key:y,val:_})}b.forEach(_=>{const j=N.getChildPath(p,_.key),$=N.extractVariables(c.path,j),L=new Xe(r,j,$);if(h.length===1){if(i==="serialize")a.push({parent:d,key:_.key,original:d[_.key]}),d[_.key]=c.type.serialize(_.val,L);else if(i==="deserialize"){const K=new de(L,_.val);d[_.key]=c.type.deserialize(K)}}else f(j,_.val,h.slice(1))})};f(t,n,l)}),i==="serialize"&&(n=Qe(n),a.length>0&&a.forEach(c=>{c.parent[c.key]=c.original})),n}const Bt=Symbol("mappings");class bo{constructor(e){this.db=e,this[Bt]={}}get mappings(){return this[Bt]}map(e){return Sl(this[Bt],e)}bind(e,t,n={}){if(typeof e!="string")throw new TypeError("path must be a string");if(typeof t!="function")throw new TypeError("constructor must be a function");if(typeof n.serializer!="undefined"){if(typeof n.serializer=="string")if(typeof t.prototype[n.serializer]=="function")n.serializer=t.prototype[n.serializer];else throw new TypeError(`${t.name}.prototype.${n.serializer} is not a function, cannot use it as serializer`);else if(typeof n.serializer!="function")throw new TypeError(`serializer for class ${t.name} must be a function, or the name of a prototype method`)}if(typeof n.creator=="undefined")typeof t.create=="function"&&(n.creator=t.create);else if(typeof n.creator=="string")if(typeof t[n.creator]=="function")n.creator=t[n.creator];else throw new TypeError(`${t.name}.${n.creator} is not a function, cannot use it as creator`);else if(typeof n.creator!="function")throw new TypeError(`creator for class ${t.name} must be a function, or the name of a static method`);e=e.replace(/^\/|\/$/g,""),this[Bt][e]={db:this.db,type:t,creator:n.creator,serializer:n.serializer,deserialize(i){let s;return this.creator?s=this.creator.call(this.type,i):s=new this.type(i),s},serialize(i,s){return this.serializer?i=this.serializer.call(i,s,i):i&&typeof i.serialize=="function"&&(i=i.serialize(s,i)),i}}}serialize(e,t){return os(this.db,this[Bt],e,t,"serialize")}deserialize(e,t){return os(this.db,this[Bt],e,t,"deserialize")}}const yn=()=>{};class xo{constructor(e="log",t=""){this.level=e,this.prefix=t,this.setLevel(e)}setLevel(e){const t=this.prefix?this.prefix+" %s":"";this.verbose=["verbose"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):yn,this.log=["verbose","log"].includes(e)?t?console.log.bind(console,t):console.log.bind(console):yn,this.warn=["verbose","log","warn"].includes(e)?t?console.warn.bind(console,t):console.warn.bind(console):yn,this.error=["verbose","log","warn","error"].includes(e)?t?console.error.bind(console,t):console.error.bind(console):yn,this.write=n=>{const i=typeof qe!="undefined"&&qe.env&&typeof{}.RUNKIT_ENDPOINT_PATH=="string";n&&i?n.split(`
`).forEach(s=>console.log(s)):console.log(n)}}}const as={bold:1,dim:2,italic:3,underline:4,inverse:7,hidden:8,strikethrough:94},cs={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90,brightRed:91},us={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgGrey:100,bgBrightRed:101},mn={all:0,color:39,background:49,bold:22,dim:22,italic:23,underline:24,inverse:27,hidden:28,strikethrough:29};var Ae;(function(r){r.reset="reset",r.bold="bold",r.dim="dim",r.italic="italic",r.underline="underline",r.inverse="inverse",r.hidden="hidden",r.strikethrough="strikethrough",r.black="black",r.red="red",r.green="green",r.yellow="yellow",r.blue="blue",r.magenta="magenta",r.cyan="cyan",r.grey="grey",r.bgBlack="bgBlack",r.bgRed="bgRed",r.bgGreen="bgGreen",r.bgYellow="bgYellow",r.bgBlue="bgBlue",r.bgMagenta="bgMagenta",r.bgCyan="bgCyan",r.bgWhite="bgWhite",r.bgGrey="bgGrey"})(Ae||(Ae={}));function Eo(){if(typeof qe=="undefined"||!qe.stdout||!qe.env||!qe.platform||qe.platform==="browser")return!1;if(qe.platform==="win32")return!0;const r=qe.env;return r.COLORTERM?!0:r.TERM==="dumb"?!1:r.CI||r.TEAMCITY_VERSION?!!r.TRAVIS:!!(["iTerm.app","HyperTerm","Hyper","MacTerm","Apple_Terminal","vscode"].includes(r.TERM_PROGRAM)||/^xterm-256|^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(r.TERM))}let ko=Eo();function Tl(r){ko=Eo()&&r}function Pl(r,e){if(!ko)return r;const t=[],n=[],i=a=>{a===Ae.reset?t.push(mn.all):a in as?(t.push(as[a]),n.push(mn[a])):a in cs?(t.push(cs[a]),n.push(mn.color)):a in us&&(t.push(us[a]),n.push(mn.background))};e instanceof Array?e.forEach(i):i(e);const s=t.map(a=>"\x1B["+a+"m").join(""),o=n.map(a=>"\x1B["+a+"m").join("");return r.split(`
`).map(a=>s+a+o).join(`
`)}String.prototype.colorize=function(r){return Pl(this,r)};class Ao{constructor(e){this.logLevel="log",this.logColors=!0,this.info="realtime database",this.sponsor=!1,typeof e!="object"&&(e={}),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.logColors=="boolean"&&(this.logColors=e.logColors),typeof e.info=="string"&&(this.info=e.info),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor)}}class Il extends Mt{constructor(e,t={}){super(),this._ready=!1,t=new Ao(t),this.name=e,this.debug=new xo(t.logLevel,`[${e}]`),Tl(t.logColors);const n=[Ae.magenta,Ae.bold],i=`     ___          ______                
    / _ \\         | ___ \\               
   / /_\\ \\ ___ ___| |_/ / __ _ ___  ___ 
   |  _  |/ __/ _ \\ ___ \\/ _\` / __|/ _ \\
   | | | | (_|  __/ |_/ / (_| \\__ \\  __/
   \\_| |_/\\___\\___\\____/ \\__,_|___/\\___|`,s=t.info?"".padStart(40-t.info.length," ")+t.info+`
`:"";t.sponsor||(this.debug.write(i.colorize(n)),s&&this.debug.write(s.colorize(Ae.magenta))),this.types=new bo(this),this.once("ready",()=>{this._ready=!0})}ready(e){return P(this,null,function*(){this._ready||(yield new Promise(t=>this.on("ready",t))),e==null||e()})}get isReady(){return this._ready}setObservable(e){xl(e)}ref(e){return new Xe(this,e)}get root(){return this.ref("")}query(e){const t=new Xe(this,e);return new wo(t)}get indexes(){return{get:()=>this.api.getIndexes(),create:(e,t,n)=>this.api.createIndex(e,t,n),delete:e=>P(this,null,function*(){return this.api.deleteIndex(e)})}}get schema(){return{get:e=>this.api.getSchema(e),set:(e,t,n=!1)=>this.api.setSchema(e,t,n),all:()=>this.api.getSchemas(),check:(e,t,n)=>this.api.validateSchema(e,t,n)}}}class me extends Error{constructor(e){super(`${e} is not implemented`)}}class Rl extends Mt{constructor(){super()}stats(e){throw new me("stats")}subscribe(e,t,n,i){throw new me("subscribe")}unsubscribe(e,t,n){throw new me("unsubscribe")}update(e,t,n){throw new me("update")}set(e,t,n){throw new me("set")}get(e,t){throw new me("get")}transaction(e,t,n){throw new me("transaction")}exists(e){throw new me("exists")}query(e,t,n){throw new me("query")}reflect(e,t,n){throw new me("reflect")}export(e,t,n){throw new me("export")}import(e,t,n){throw new me("import")}createIndex(e,t,n){throw new me("createIndex")}getIndexes(){throw new me("getIndexes")}deleteIndex(e){throw new me("deleteIndex")}setSchema(e,t,n){throw new me("setSchema")}getSchema(e){throw new me("getSchema")}getSchemas(){throw new me("getSchemas")}validateSchema(e,t,n){throw new me("validateSchema")}getMutations(e){throw new me("getMutations")}getChanges(e){throw new me("getChanges")}}function ls(r,e,t){const n=[0,0,0,0,0];for(let i=0;i<e;i+=4){let s=((r[i]*256+r[i+1])*256+r[i+2])*256+r[i+3];if(!s)t.push("z");else{for(let o=0;o<5;n[o++]=s%85+33,s=Math.floor(s/85));t.push(String.fromCharCode(n[4],n[3],n[2],n[1],n[0]))}}}function Nl(r){const e=r,t=[],n=e.length%4,i=e.length-n;if(ls(e,i,t),n){const o=new Uint8Array(4);o.set(e.slice(i),0),ls(o,4,t);let a=t.pop();a=="z"&&(a="!!!!!"),t.push(a.substr(0,n+1))}let s=t.join("");return s="<~"+s+"~>",s}const at={encode:function(r){return r instanceof ArrayBuffer&&(r=new Uint8Array(r,0,r.byteLength)),Nl(r)},decode:function(r){if(!r.startsWith("<~")||!r.endsWith("~>"))throw new Error("Invalid input string");r=r.substr(2,r.length-4);const e=r.length,t=[],n=[0,0,0,0,0];let i,s,o,a;for(let u=0;u<e;++u){if(r.charAt(u)=="z"){t.push(0,0,0,0);continue}for(let l=0;l<5;++l)n[l]=r.charCodeAt(u+l)-33;if(a=e-u,a<5){for(let l=a;l<4;n[++l]=0);n[a]=85}i=(((n[0]*85+n[1])*85+n[2])*85+n[3])*85+n[4],s=i&255,i>>>=8,o=i&255,i>>>=8,t.push(i>>>8,i&255,o,s);for(let l=a;l<5;++l,t.pop());u+=4}const c=new Uint8Array(t);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}},Cl=r=>{if(r.map===null||typeof r.map=="undefined"){if(typeof r.val=="undefined")throw new Error("serialized value must have a val property");return r.val}const e=(t,n)=>t==="date"?new Date(n):t==="binary"?at.decode(n):t==="reference"?new pe(n):t==="regexp"?new RegExp(n.pattern,n.flags):t==="array"?new $n(n):t==="bigint"?BigInt(n):n;return typeof r.map=="string"?e(r.map,r.val):(Object.keys(r.map).forEach(t=>{const n=r.map[t],i=N.getPathKeys(t);let s=r,o="val",a=r.val;i.forEach(c=>{o=c,s=a,a=a[o]}),s[o]=e(n,a)}),r.val)},_o=r=>{var i;if(r===null||typeof r!="object"||r instanceof Date||r instanceof ArrayBuffer||r instanceof pe||r instanceof RegExp){const s=_o({value:r});return{map:(i=s.map)==null?void 0:i.value,val:s.val.value}}r=Qe(r);const e=(s,o,a)=>{s instanceof $n&&(o[a]="array"),Object.keys(s).forEach(c=>{const u=s[c],l=a.length===0?c:`${a}/${c}`;typeof u=="bigint"?(s[c]=u.toString(),o[l]="bigint"):u instanceof Date?(s[c]=u.toISOString(),o[l]="date"):u instanceof ArrayBuffer?(s[c]=at.encode(u),o[l]="binary"):u instanceof pe?(s[c]=u.path,o[l]="reference"):u instanceof RegExp?(s[c]={pattern:u.source,flags:u.flags},o[l]="regexp"):typeof u=="object"&&u!==null&&e(u,o,l)})},t={};e(r,t,"");const n={val:r};return Object.keys(t).length>0&&(n.map=t),n},fs=r=>r>0?Date.now()+r*1e3:1/0;class $l{get size(){return this.cache.size}constructor(e){var n;if(this.enabled=!0,typeof e=="number"&&(e={expirySeconds:e}),e.cloneValues=e.cloneValues!==!1,typeof e.expirySeconds!="number"&&typeof e.maxEntries!="number")throw new Error("Either expirySeconds or maxEntries must be specified");this.options=e,this.cache=new Map;const t=setInterval(()=>{this.cleanUp()},60*1e3);(n=t.unref)==null||n.call(t)}has(e){return this.enabled?this.cache.has(e):!1}get(e){if(!this.enabled)return null;const t=this.cache.get(e);return t?(t.expires=fs(this.options.expirySeconds),t.accessed=Date.now(),this.options.cloneValues?Qe(t.value):t.value):null}set(e,t){if(this.options.maxEntries>0&&this.cache.size>=this.options.maxEntries&&!this.cache.has(e)){let n=null;const i=Date.now();for(const[s,o]of this.cache.entries()){if(o.expires<=i){this.cache.delete(s),n=null;break}(!n||o.accessed<n.accessed)&&(n={key:s,accessed:o.accessed})}n!==null&&this.cache.delete(n.key)}this.cache.set(e,{value:this.options.cloneValues?Qe(t):t,added:Date.now(),accessed:Date.now(),expires:fs(this.options.expirySeconds)})}remove(e){this.cache.delete(e)}cleanUp(){const e=Date.now();this.cache.forEach((t,n)=>{t.expires<=e&&this.cache.delete(n)})}}function Bl(r){let e=0;function t(){let a;for(;a=r[e],[" ","\r",`
`,"	"].includes(a);)e++}function n(a){if(r[e]!==a)throw new Error(`Unexpected character at position ${e}. Expected: '${a}', found '${r[e]}'`);e++}function i(){t();const a={name:"",optional:!1,wildcard:!1};let c;for(;c=r[e],c==="_"||c==="$"||c>="a"&&c<="z"||c>="A"&&c<="Z"||a.name.length>0&&c>="0"&&c<="9"||a.name.length===0&&c==="*";)a.name+=c,e++;if(a.name.length===0)throw new Error(`Property name expected at position ${e}, found: ${r.slice(e,e+10)}..`);return r[e]==="?"&&(a.optional=!0,e++),(a.name==="*"||a.name[0]==="$")&&(a.optional=!0,a.wildcard=!0),t(),n(":"),a}function s(){t();let a={typeOf:"any"},c,u="";for(;c=r[e],c>="a"&&c<="z"||c>="A"&&c<="Z";)u+=c,e++;if(u.length===0)if(r[e]==="*")n("*"),a.typeOf="any";else if(["'",'"',"`"].includes(r[e])){a.typeOf="string",a.value="";const l=r[e];for(n(l);c=r[e],c&&c!==l;)a.value+=c,e++;n(l)}else if(r[e]>="0"&&r[e]<="9"){a.typeOf="number";let l="";for(;c=r[e],c==="."||c==="n"||c>="0"&&c<="9";)l+=c,e++;l.endsWith("n")?a.value=BigInt(l):l.includes(".")?a.value=parseFloat(l):a.value=parseInt(l)}else if(r[e]==="{"){for(n("{"),a.typeOf="object",a.instanceOf=Object,a.children=[];;){const l=i(),f=o();if(a.children.push({name:l.name,optional:l.optional,wildcard:l.wildcard,types:f}),t(),(r[e]===";"||r[e]===",")&&(n(r[e]),t()),r[e]==="}")break}n("}")}else if(r[e]==="/"){n("/");let l="",f="";for(;c=r[e],c!=="/"||l.endsWith("\\");)l+=c,e++;for(n("/");c=r[e],["g","i","m","s","u","y","d"].includes(c);)f+=c,e++;a.typeOf="string",a.matches=new RegExp(l,f)}else throw new Error(`Expected a type definition at position ${e}, found character '${r[e]}'`);else if(["string","number","boolean","bigint","undefined","String","Number","Boolean","BigInt"].includes(u))a.typeOf=u.toLowerCase();else if(u==="Object"||u==="object")a.typeOf="object",a.instanceOf=Object;else if(u==="Date")a.typeOf="object",a.instanceOf=Date;else if(u==="Binary"||u==="binary")a.typeOf="object",a.instanceOf=ArrayBuffer;else if(u==="any")a.typeOf="any";else if(u==="null")a.typeOf="object",a.value=null;else if(u==="Array")n("<"),a.typeOf="object",a.instanceOf=Array,a.genericTypes=o(),n(">");else if(["true","false"].includes(u))a.typeOf="boolean",a.value=u==="true";else throw new Error(`Unknown type at position ${e}: "${a}"`);for(t();r[e]==="[";)n("["),n("]"),a={typeOf:"object",instanceOf:Array,genericTypes:[a]};return a}function o(){t();const a=[s()];for(;r[e]==="|";)n("|"),a.push(s()),t();return a}return s()}function jl(r,e,t,n){const i=e.find(f=>f.name==="*"||f.name[0]==="$")?[]:Object.keys(t).filter(f=>![null,void 0].includes(t[f])&&!e.find(p=>p.name===f));if(i.length>0)return{ok:!1,reason:`Object at path "${r}" cannot have propert${i.length===1?"y":"ies"} ${i.map(f=>`"${f}"`).join(", ")}`};function s(f){const p=![null,void 0].includes(t[f.name]);return!f.optional&&(n?t[f.name]===null:!p)?{ok:!1,reason:`Property at path "${r}/${f.name}" is not optional`}:p&&f.types.length===1?Qt(`${r}/${f.name}`,f.types[0],t[f.name],!1):p&&!f.types.some(d=>Qt(`${r}/${f.name}`,d,t[f.name],!1).ok)?{ok:!1,reason:`Property at path "${r}/${f.name}" does not match any of ${f.types.length} allowed types`}:{ok:!0}}const o=e.filter(f=>!f.wildcard),a=o.find(f=>!s(f).ok);if(a)return{ok:!1,reason:s(a).reason};const c=e.find(f=>f.wildcard);if(!c)return{ok:!0};const u=Object.keys(t).filter(f=>!o.find(p=>p.name===f));let l={ok:!0};for(let f=0;f<u.length&&l.ok;f++){const p=u[f];l=s({name:p,types:c.types,optional:!0,wildcard:!0})}return l}function Qt(r,e,t,n,i){const s={ok:!0};if(e.typeOf==="any")return s;if(i instanceof Array&&i.length>0){if(e.typeOf!=="object")return{ok:!1,reason:`path "${r}" must be typeof ${e.typeOf}`};if(!e.children)return s;const o=i[0];let a=e.children.find(u=>u.name===o);if(a||(a=e.children.find(u=>u.name==="*"||u.name[0]==="$")),!a)return{ok:!1,reason:`Object at path "${r}" cannot have property "${o}"`};if(a.optional&&t===null&&i.length===1)return s;let c;return a.types.some(u=>{const l=typeof o=="number"?`${r}[${o}]`:`${r}/${o}`;return c=Qt(l,u,t,n,i.slice(1)),c.ok}),c}return t===null?s:e.instanceOf===Object&&(typeof t!="object"||t instanceof Array||t instanceof Date)?{ok:!1,reason:`path "${r}" must be an object collection`}:e.instanceOf&&(typeof t!="object"||t.constructor!==e.instanceOf)?{ok:!1,reason:`path "${r}" must be an instance of ${e.instanceOf.name}`}:"value"in e&&t!==e.value?{ok:!1,reason:`path "${r}" must be value: ${e.value}`}:typeof t!==e.typeOf?{ok:!1,reason:`path "${r}" must be typeof ${e.typeOf}`}:e.instanceOf===Array&&e.genericTypes&&!t.every(o=>e.genericTypes.some(a=>Qt(r,a,o,!1).ok))?{ok:!1,reason:`every array value of path "${r}" must match one of the specified types`}:e.typeOf==="object"&&e.children?jl(r,e.children,t,n):e.matches&&!e.matches.test(t)?{ok:!1,reason:`path "${r}" must match regular expression /${e.matches.source}/${e.matches.flags}`}:s}function Ll(r){switch(r){case String:return"string";case Number:return"number";case Boolean:return"boolean";case Date:return"Date";case BigInt:return"bigint";case Array:throw new Error("Schema error: Array cannot be used without a type. Use string[] or Array<string> instead");default:throw new Error(`Schema error: unknown type used: ${r.name}`)}}class Dl{constructor(e,t={warnOnly:!1}){if(this.handling=t,this.source=e,typeof e=="object"){const n=i=>"{"+Object.keys(i).map(s=>{let o=i[s];if(o===void 0)o="undefined";else if(o instanceof RegExp)o=`/${o.source}/${o.flags}`;else if(typeof o=="object")o=n(o);else if(typeof o=="function")o=Ll(o);else if(!["string","number","boolean","bigint"].includes(typeof o))throw new Error(`Type definition for key "${s}" must be a string, number, boolean, bigint, object, regular expression, or one of these classes: String, Number, Boolean, Date, BigInt`);return`${s}:${o}`}).join(",")+"}";this.text=n(e)}else if(typeof e=="string")this.text=e;else throw new Error("Type definiton must be a string or an object");this.type=Bl(this.text)}check(e,t,n,i){const s=Qt(e,this.type,t,n,i);return!s.ok&&this.handling.warnOnly&&(s.warning=`${n?"Partial schema":"Schema"} check on path "${e}"${i?` for child "${i.join("/")}"`:""} failed: ${s.reason}`,s.ok=!0,this.handling.warnCallback(s.warning)),s}}class $e{constructor(e="browser"){throw new Error(`This feature is not supported in ${e} context`)}}class yr extends $e{}class jr extends $e{}class hs extends $e{}class Ul extends $e{}class ds extends $e{}class Fl extends $e{}const Ml={OBJECT:1,ARRAY:2,NUMBER:3,BOOLEAN:4,STRING:5,BIGINT:7,DATETIME:6,BINARY:8,REFERENCE:9},F=Ml;function Kl(r){switch(r){case F.ARRAY:return"array";case F.BINARY:return"binary";case F.BOOLEAN:return"boolean";case F.DATETIME:return"date";case F.NUMBER:return"number";case F.OBJECT:return"object";case F.REFERENCE:return"reference";case F.STRING:return"string";case F.BIGINT:return"bigint"}}class So{constructor(e){if(this.path=e.path,this.type=e.type,this.index=e.index,this.key=e.key,this.exists=e.exists,this.address=e.address,this.value=e.value,this.childCount=e.childCount,typeof this.path=="string"&&typeof this.key=="undefined"&&typeof this.index=="undefined"){const t=N.get(this.path);typeof t.key=="number"?this.index=t.key:this.key=t.key}typeof this.exists=="undefined"&&(this.exists=!0)}get valueType(){return this.type}get valueTypeName(){return Kl(this.valueType)}toString(){return this.exists?this.address?`"${this.path}" is ${this.valueTypeName} stored at ${this.address.toString()}`:`"${this.path}" is ${this.valueTypeName} with value ${this.value}`:`"${this.path}" doesn't exist`}}function Ne(r,e){if(!r)throw new Error(`Assertion failed: ${e!=null?e:"check your code"}`)}const Vl=120,Ce={PENDING:"pending",LOCKED:"locked",EXPIRED:"expired",DONE:"done"};class Oo{constructor(e,t=Vl){this._locks=[],this._lastTid=0,this.debug=e,this.timeout=t*1e3}setTimeout(e){this.timeout=e*1e3}createTid(){return Ie.generate()}_allowLock(e,t,n){const i=this._locks.find(s=>s.tid!==t&&s.state===Ce.LOCKED&&(n||s.forWriting));return{allow:!i,conflict:i}}quit(){return new Promise(e=>{if(this._locks.length===0)return e();this._quit=e})}_rejectLock(e,t){this._locks.splice(this._locks.indexOf(e),1),clearTimeout(e.timeout);try{e.reject(t)}catch(n){console.error("Unhandled promise rejection:",n)}}_processLockQueue(){if(this._quit){const t=new Error("Quitting");this._locks.filter(n=>n.state===Ce.PENDING).forEach(n=>this._rejectLock(n,t)),this._locks.length===0&&this._quit()}this._locks.filter(t=>t.state===Ce.PENDING).sort((t,n)=>t.priority&&!n.priority?-1:!t.priority&&n.priority?1:t.requested-n.requested).forEach(t=>{const n=this._allowLock(t.path,t.tid,t.forWriting);t.waitingFor=n.conflict||null,n.allow&&this.lock(t).then(t.resolve).catch(i=>this._rejectLock(t,i))})}lock(o,a){return P(this,arguments,function*(e,t,n=!0,i="",s={withPriority:!1,noTimeout:!1}){let c,u;if(e instanceof mr)c=e,u=!0;else{if(this._locks.findIndex(l=>l.tid===t&&l.state===Ce.EXPIRED)>=0)throw new Error(`lock on tid ${t} has expired, not allowed to continue`);if(this._quit&&!s.withPriority)throw new Error("Quitting");{c=new mr(this,e,t,n,s.withPriority===!0),c.comment=i,this._locks.push(c);const l=this._allowLock(e,t,n);c.waitingFor=l.conflict||null,u=l.allow}}if(u){if(c.state=Ce.LOCKED,typeof c.granted!="number"){if(c.granted=Date.now(),s.noTimeout!==!0){c.expires=Date.now()+this.timeout;let l=0;const f=()=>{if(c.state===Ce.LOCKED){if(l++,l<=3){this.debug.warn(`${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) is taking a long time to complete [${l}]`),c.timeout=setTimeout(f,this.timeout/4);return}this.debug.error(`lock :: ${c.forWriting?"write":"read"} lock on path "/${c.path}" by tid ${c.tid} (${c.comment}) took too long`),c.state=Ce.EXPIRED,this._processLockQueue()}};c.timeout=setTimeout(f,this.timeout/4)}}return c}else return Ne(c.state===Ce.PENDING),new Promise((l,f)=>{c.resolve=l,c.reject=f})})}unlock(e,t,n=!0){let i,s;if(e instanceof mr)i=e,s=this._locks.indexOf(i);else{const o=e;s=this._locks.findIndex(a=>a.id===o),i=this._locks[s]}if(s<0){const o=`lock on "/${i.path}" for tid ${i.tid} wasn't found; ${t}`;throw new Error(o)}return i.state=Ce.DONE,clearTimeout(i.timeout),this._locks.splice(s,1),n&&this._processLockQueue(),i}list(){return this._locks||[]}isAllowed(e,t,n){return this._allowLock(e,t,n).allow}}let ql=0;class mr{static get LOCK_STATE(){return Ce}constructor(e,t,n,i,s=!1){this.locker=e,this.path=t,this.tid=n,this.forWriting=i,this.priority=s,this.state=Ce.PENDING,this.requested=Date.now(),this.comment="",this.waitingFor=null,this.id=++ql,this.history=[]}release(e){return P(this,null,function*(){return this.history.push({action:"release",path:this.path,forWriting:this.forWriting,comment:e}),this.locker.unlock(this,e||this.comment)})}moveToParent(){return P(this,null,function*(){const e=N.get(this.path).parentPath;if(this.locker.isAllowed(e,this.tid,this.forWriting))return this.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent"}),this.waitingFor=null,this.path=e,this;{this.locker.unlock(this,`moveLockToParent: ${this.comment}`,!1);const n=yield this.locker.lock(e,this.tid,this.forWriting,this.comment,{withPriority:!0});return n.history=this.history,n.history.push({path:this.path,forWriting:this.forWriting,action:"moving to parent through queue (priority)"}),n}})}}class si extends Error{}class Lr extends Error{}class zl extends Error{constructor(e){super(`Exiting: ${e}`)}}class Wl extends Mt{get isMaster(){return this.masterPeerId===this.id}constructor(e,t,n=e.name){super(),this.storage=e,this.id=t,this.dbname=n,this.ipcType="ipc",this.ourSubscriptions=[],this.remoteSubscriptions=[],this.peers=[],this._exiting=!1,this._locks=[],this._requests=new Map,this._eventsEnabled=!0,this._nodeLocker=new Oo(e.debug,e.settings.lockTimeout),e.on("subscribe",i=>{if(e.debug.verbose(`database subscription being added on peer ${this.id}`),this.remoteSubscriptions.find(c=>c.callback===i.callback))return;const o=this.ourSubscriptions.some(c=>c.event===i.event&&c.path===i.path);if(this.ourSubscriptions.push(i),o)return;const a={type:"subscribe",from:this.id,data:{path:i.path,event:i.event}};this.sendMessage(a)}),e.on("unsubscribe",i=>{const s=this.remoteSubscriptions.find(o=>o.callback===i.callback);if(s){this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1);return}this.ourSubscriptions.filter(o=>o.path===i.path&&(!i.event||o.event===i.event)&&(!i.callback||o.callback===i.callback)).forEach(o=>{this.ourSubscriptions.splice(this.ourSubscriptions.indexOf(o),1);const a={type:"unsubscribe",from:this.id,data:{path:o.path,event:o.event}};this.sendMessage(a)})})}exit(e=0){return P(this,null,function*(){if(this._exiting)return this.once("exit");this._exiting=!0,this.storage.debug.warn(`Received ${this.isMaster?"master":"worker "+this.id} process exit request`),this._locks.length>0&&(this.storage.debug.warn(`Waiting for ${this.isMaster?"master":"worker"} ${this.id} locks to clear`),yield this.once("locks-cleared")),this.sayGoodbye(this.id),this.storage.debug.warn(`${this.isMaster?"Master":"Worker "+this.id} will now exit`),this.emitOnce("exit",e)})}sayGoodbye(e){const t={type:"bye",from:e,data:void 0};this.sendMessage(t)}addPeer(e,t=!0){if(this._exiting)return;if(this.peers.find(i=>i.id===e)||this.peers.push({id:e,lastSeen:Date.now()}),t){const i={type:"hello",from:this.id,to:e,data:void 0};this.sendMessage(i),this.ourSubscriptions.forEach(s=>{const o={type:"subscribe",from:this.id,to:e,data:{path:s.path,event:s.event}};this.sendMessage(o)})}}removePeer(e,t=!1){if(this._exiting)return;const n=this.peers.find(s=>s.id===e);if(!n){if(!t)throw new Error("We are supposed to know this peer!");return}this.peers.splice(this.peers.indexOf(n),1),this.remoteSubscriptions.filter(s=>s.for===e).forEach(s=>{this.remoteSubscriptions.splice(this.remoteSubscriptions.indexOf(s),1),this.storage.subscriptions.remove(s.path,s.event,s.callback)})}addRemoteSubscription(e,t){if(this._exiting||this.remoteSubscriptions.some(i=>i.for===e&&i.event===t.event&&i.path===t.path))return;const n=(i,s,o,a,c)=>{const u={type:"event",from:this.id,to:e,path:t.path,event:t.event,data:{path:s,val:o,previous:a,context:c}};this.sendMessage(u)};this.remoteSubscriptions.push({for:e,event:t.event,path:t.path,callback:n}),this.storage.subscriptions.add(t.path,t.event,n)}cancelRemoteSubscription(e,t){const n=this.remoteSubscriptions.find(i=>i.for===e&&i.event===t.event&&i.path===t.event);!n||this.storage.subscriptions.remove(t.path,t.event,n.callback)}handleMessage(e){return P(this,null,function*(){switch(e.type){case"hello":return this.addPeer(e.from,e.to!==this.id);case"bye":return this.removePeer(e.from,!0);case"subscribe":return this.addRemoteSubscription(e.from,e.data);case"unsubscribe":return this.cancelRemoteSubscription(e.from,e.data);case"event":{if(!this._eventsEnabled)break;const t=e,n=t.data.context||{};n.acebase_ipc={type:this.ipcType,origin:t.from},this.ourSubscriptions.filter(s=>s.event===t.event&&s.path===t.path).forEach(s=>{s.callback(null,t.data.path,t.data.val,t.data.previous,n)});break}case"lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive lock requests!");const t=e,n={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{const i=yield this.lock(t.data);n.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"lock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for lock requests!");const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("The request must be known to us!");t.ok?n.resolve(t.data):n.reject(new Error(t.reason));return}case"unlock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive unlock requests!");const t=e,n={type:"unlock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:{id:t.data.id}};try{yield this._locks.find(s=>{var o;return((o=s.lock)==null?void 0:o.id)===t.data.id}).lock.release()}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"unlock-result":{if(this.isMaster)throw new Error("Masters are not supposed to receive results for unlock requests!");const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("The request must be known to us!");t.ok?n.resolve(t.data):n.reject(new Error(t.reason));return}case"move-lock-request":{if(!this.isMaster)throw new Error("Workers are not supposed to receive move lock requests!");const t=e,n={type:"lock-result",id:t.id,from:this.id,to:t.from,ok:!0,data:void 0};try{let i;const s=this._locks.find(o=>{var a;return((a=o.lock)==null?void 0:a.id)===t.data.id});if(t.data.move_to==="parent")i=yield s.lock.moveToParent();else throw new Error(`Unknown lock move_to "${t.data.move_to}"`);s.lock=i,n.data={id:i.id,path:i.path,tid:i.tid,write:i.forWriting,expires:i.expires,comment:i.comment}}catch(i){n.ok=!1,n.reason=i.stack||i.message||i}return this.sendMessage(n)}case"notification":return this.emit("notification",e);case"request":return this.emit("request",e);case"result":{const t=e,n=this._requests.get(t.id);if(typeof n!="object")throw new Error("Result of unknown request received");t.ok?n.resolve(t.data):n.reject(new Error(t.reason))}}})}lock(e){return P(this,null,function*(){if(this._exiting&&!this._locks.find(i=>i.tid===e.tid&&i.granted))throw new zl("new transaction lock denied because the IPC peer is exiting");const t=n=>{this._locks.splice(this._locks.indexOf(n),1),this._locks.length===0&&this.emit("locks-cleared")};if(this.isMaster){const n={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(n);const i=yield this._nodeLocker.lock(e.path,e.tid,e.write,e.comment);n.tid=i.tid,n.granted=!0;const s=o=>({get id(){return o.id},get tid(){return o.tid},get path(){return o.path},get forWriting(){return o.forWriting},get expires(){return o.expires},get comment(){return o.comment},get state(){return o.state},release:()=>P(this,null,function*(){yield o.release(),t(n)}),moveToParent:()=>P(this,null,function*(){const a=yield o.moveToParent();return n.lock=s(a),n.lock})});return n.lock=s(i),n.lock}else{const n={tid:e.tid,granted:!1,request:e,lock:null};this._locks.push(n);const i=c=>(n.granted=!0,n.tid=c.tid,n.lock={id:c.id,tid:c.tid,path:c.path,forWriting:c.write,state:Ce.LOCKED,expires:c.expires,comment:c.comment,release:()=>P(this,null,function*(){const u={type:"unlock-request",id:Ie.generate(),from:this.id,to:this.masterPeerId,data:{id:n.lock.id}};yield this.request(u),n.lock.state=Ce.DONE,this.storage.debug.verbose(`Worker ${this.id} released lock ${n.lock.id} (tid ${n.lock.tid}, ${n.lock.comment}, "/${n.lock.path}", ${n.lock.forWriting?"write":"read"})`),t(n)}),moveToParent:()=>P(this,null,function*(){const u={type:"move-lock-request",id:Ie.generate(),from:this.id,to:this.masterPeerId,data:{id:n.lock.id,move_to:"parent"}};let l;try{l=yield this.request(u)}catch(f){throw n.lock.state=Ce.DONE,t(n),f}return n.lock=i(l),n.lock})},n.lock),s={type:"lock-request",id:Ie.generate(),from:this.id,to:this.masterPeerId,data:e};let o,a;try{o=yield this.request(s)}catch(c){a=c,o=null}if(a)throw t(n),a;return i(o)}})}request(e){return P(this,null,function*(){let t,n;const i=new Promise((s,o)=>{t=a=>{this._requests.delete(e.id),s(a)},n=a=>{this._requests.delete(e.id),o(a)}});return this._requests.set(e.id,{resolve:t,reject:n,request:e}),this.sendMessage(e),i})}sendRequest(e){const t={type:"request",from:this.id,to:this.masterPeerId,id:Ie.generate(),data:e};return this.request(t).catch(n=>{throw this.storage.debug.error(n),n})}replyRequest(e,t){const n={type:"result",id:e.id,ok:!0,from:this.id,to:e.from,data:t};this.sendMessage(n)}sendNotification(e){const t={type:"notification",from:this.id,data:e};this.sendMessage(t)}get eventsEnabled(){return this._eventsEnabled}set eventsEnabled(e){this.storage.debug.log(`ipc events ${e?"enabled":"disabled"}`),this._eventsEnabled=e}}class Hl extends Wl{constructor(e){if(super(e,Ie.generate()),this.masterPeerId=this.id,this.ipcType="browser.bcc",window.addEventListener("beforeunload",()=>{this.exit()}),typeof window.BroadcastChannel!="undefined")this.channel=new BroadcastChannel(`acebase:${e.name}`);else{const n=[null],i=()=>{throw new Error("Not implemented")};this.channel={name:`acebase:${e.name}`,postMessage:s=>{const o=Ie.generate(),a=`acebase:${e.name}:${this.id}:${o}`,c=JSON.stringify(_o(s));localStorage.setItem(a,c),setTimeout(()=>localStorage.removeItem(a),10)},set onmessage(s){n[0]=s},set onmessageerror(s){i()},close(){i()},addEventListener(s,o){s!=="message"&&i(),n.push(o)},removeEventListener(s,o){const a=n.indexOf(o);a>=1&&n.splice(a,1)},dispatchEvent(s){return n.forEach(o=>{try{o&&o(s)}catch(a){console.error(a)}}),!0}},window.addEventListener("storage",s=>{const[o,a,c,u]=s.key.split(":");if(o!=="acebase"||a!==e.name||c===this.id||s.newValue===null)return;const l=Cl(JSON.parse(s.newValue));this.channel.dispatchEvent({data:l})})}this.channel.addEventListener("message",n=>P(this,null,function*(){const i=n.data;if(!(i.to&&i.to!==this.id)){if(e.debug.verbose("[BroadcastChannel] received: ",i),i.type==="hello"&&i.from<this.masterPeerId)this.masterPeerId=i.from,e.debug.log(`[BroadcastChannel] Tab ${this.masterPeerId} is the master.`);else if(i.type==="bye"&&i.from===this.masterPeerId){e.debug.log(`[BroadcastChannel] Master tab ${this.masterPeerId} is leaving`);const s=this.peers.map(a=>a.id).concat(this.id).filter(a=>a!==this.masterPeerId);this.masterPeerId=s.sort()[0],e.debug.log(`[BroadcastChannel] ${this.masterPeerId===this.id?"We are":`tab ${this.masterPeerId} is`} the new master. Requesting ${this._locks.length} locks (${this._locks.filter(a=>!a.granted).length} pending)`);const o=this._locks.splice(0);yield Promise.all(o.filter(a=>a.granted).map(a=>P(this,null,function*(){let c,u;a.lock.release=()=>new Promise(f=>c=f),a.lock.moveToParent=()=>new Promise(f=>u=f);const l=yield this.lock({path:a.lock.path,write:a.lock.forWriting,tid:a.lock.tid,comment:a.lock.comment});if(u){const f=yield l.moveToParent();u(f)}c&&(yield l.release(),c())}))),yield Promise.all(o.filter(a=>!a.granted).map(a=>P(this,null,function*(){yield this.lock(a.request)})))}return this.handleMessage(i)}}));const t={type:"hello",from:this.id,data:void 0};this.sendMessage(t)}sendMessage(e){this.storage.debug.verbose("[BroadcastChannel] sending: ",e),this.channel.postMessage(e)}}class jt{static get hasFileSystem(){return!1}static get fs(){return null}}class oi extends $e{}class To extends $e{}class Jl extends $e{}class Yl extends $e{}function Gl(r,e,t,n){return P(this,null,function*(){if(!r.storage.indexes.supported)throw new Error("Indexes are not supported in current environment because it requires Node.js fs");const{ipc:i,debug:s,indexes:o,storage:a}=r,c=n&&n.rebuild===!0,u=n&&n.type||"normal";let l=n&&n.include||[];typeof l=="string"&&(l=[l]);const f=o.find(d=>d.path===e&&d.key===t&&d.type===u&&d.includeKeys.length===l.length&&d.includeKeys.every((h,y)=>l[y]===h));if(f&&n.config&&(f.config=n.config),f&&c!==!0)return s.log(`Index on "/${e}/*/${t}" already exists`.colorize(Ae.inverse)),f;if(!i.isMaster){const d=yield i.sendRequest({type:"index.create",path:e,key:t,options:n});if(d.ok)return a.indexes.add(d.fileName);throw new Error(d.reason)}yield jt.mkdir(`${a.settings.path}/${a.name}.acebase`).catch(d=>{if(d.code!=="EEXIST")throw d});const p=f||(()=>{const{include:d,caseSensitive:h,textLocale:y,textLocaleKey:b}=n,_={include:d,caseSensitive:h,textLocale:y,textLocaleKey:b};switch(u){case"array":return new Yl(a,e,t,U({},_));case"fulltext":return new To(a,e,t,fe(U({},_),{config:n.config}));case"geo":return new Jl(a,e,t,U({},_));default:return new oi(a,e,t,U({},_))}})();f||o.push(p);try{yield p.build()}catch(d){throw r.debug.error(`Index build on "/${e}/*/${t}" failed: ${d.message} (code: ${d.code})`.colorize(Ae.red)),f||o.splice(o.indexOf(p),1),d}return i.sendNotification({type:"index.created",fileName:p.fileName,path:e,key:t,options:n}),p})}const{compareValues:gn,getChildValues:Et,encodeString:ps,defer:Ql}=yo,Dr=["value","child_added","child_changed","child_removed","mutated","mutations"];Dr.push(...Dr.map(r=>`notify_${r}`));const Xl=()=>{};class Zl extends Error{constructor(e){super(`Schema validation failed: ${e}`),this.reason=e}}class ai{constructor(e={}){this.maxInlineValueSize=50,this.removeVoidProperties=!1,this.path=".",this.lockTimeout=120,this.type="data",this.readOnly=!1,typeof e.maxInlineValueSize=="number"&&(this.maxInlineValueSize=e.maxInlineValueSize),typeof e.removeVoidProperties=="boolean"&&(this.removeVoidProperties=e.removeVoidProperties),typeof e.path=="string"&&(this.path=e.path),this.path.endsWith("/")&&(this.path=this.path.slice(0,-1)),typeof e.lockTimeout=="number"&&(this.lockTimeout=e.lockTimeout),typeof e.type=="string"&&(this.type=e.type),typeof e.readOnly=="boolean"&&(this.readOnly=e.readOnly),["object","string"].includes(typeof e.ipc)&&(this.ipc=e.ipc)}}class ef extends Mt{createTid(){return Ie.generate()}constructor(e,t,n){super(),this.name=e,this.settings=t,this._schemas=[],this._indexes=[],this._annoucedIndexes=new Map,this.indexes={get supported(){return jt==null?void 0:jt.hasFileSystem},create:(s,o,a={rebuild:!1})=>{const c={storage:this,debug:this.debug,indexes:this._indexes,ipc:this.ipc};return Gl(c,s,o,a)},get:(s,o=null)=>{if(s.includes("$")){const a=N.getPathKeys(s).map(c=>typeof c=="string"&&c.startsWith("$")?"*":c);s=new N(a).path}return this._indexes.filter(a=>a.path===s&&(o===null||o===a.key))},getAll:(s,o={parentPaths:!0,childPaths:!0})=>{const a=N.getPathKeys(s);return this._indexes.filter(c=>{const u=N.getPathKeys(c.path+"/*");return o.parentPaths&&u.every((l,f)=>l==="*"||a[f]===l)&&[c.key].concat(...c.includeKeys).includes(a[u.length])?!0:u.length<a.length||!o.childPaths&&u.length!==a.length?!1:a.every((l,f)=>[l,"*"].includes(u[f]))})},list:()=>this._indexes.slice(),load:()=>P(this,null,function*(){if(this._indexes.splice(0),!jt.hasFileSystem)return;let s=[];try{s=yield jt.readdir(`${this.settings.path}/${this.name}.acebase`)}catch(a){a.code!=="ENOENT"&&this.debug.error(a)}const o=[];s.forEach(a=>{if(!a.endsWith(".idx"))return;const c=this.settings.type!=="data",u=/^\[[a-z]+\]-/.test(a);if(!c&&!u||c&&a.startsWith(`[${this.settings.type}]-`)){const l=this.indexes.add(a);o.push(l)}}),yield Promise.all(o)}),add:s=>P(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(o)return o;if(this._annoucedIndexes.has(s))return yield this._annoucedIndexes.get(s);try{const a=oi.readFromFile(this,s);this._annoucedIndexes.set(s,a);const c=yield a;return this._indexes.push(c),this._annoucedIndexes.delete(s),c}catch(a){return this.debug.error(a),null}}),delete:s=>P(this,null,function*(){const o=yield this.indexes.remove(s);yield o.delete(),this.ipc.sendNotification({type:"index.deleted",fileName:o.fileName,path:o.path,keys:o.key})}),remove:s=>P(this,null,function*(){const o=this._indexes.find(a=>a.fileName===s);if(!o)throw new Error(`Index ${s} not found`);return this._indexes.splice(this._indexes.indexOf(o),1),o}),close:()=>P(this,null,function*(){const s=this.indexes.list().map(o=>o.close().catch(a=>this.debug.error(a)));yield Promise.all(s)})},this._eventSubscriptions={},this.subscriptions={add:(s,o,a)=>{if(Dr.indexOf(o)<0)throw new TypeError(`Invalid event type "${o}"`);let c=this._eventSubscriptions[s];c||(c=this._eventSubscriptions[s]=[]),c.push({created:Date.now(),type:o,callback:a}),this.emit("subscribe",{path:s,event:o,callback:a})},remove:(s,o,a)=>{const c=this._eventSubscriptions[s];if(!c)return;const u=()=>c.findIndex(f=>(o?f.type===o:!0)&&(a?f.callback===a:!0));let l;for(;(l=u())>=0;)c.splice(l,1);this.emit("unsubscribe",{path:s,event:o,callback:a})},hasValueSubscribersForPath(s){return!!this.getValueSubscribersForPath(s)},getValueSubscribersForPath:s=>{const o=new N(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.equals(c)||o.isDescendantOf(c)){const u=this._eventSubscriptions[c],l=N.fillVariables(c,s);u.filter(f=>!f.type.startsWith("notify_")).forEach(f=>{let p=null;if(f.type==="value")p=l;else if(["mutated","mutations"].includes(f.type)&&o.isDescendantOf(l))p=s;else if(f.type==="child_changed"&&s!==l){const d=N.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];p=N.getChildPath(l,d)}else if(["child_added","child_removed"].includes(f.type)&&o.isChildOf(l)){const d=N.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];p=N.getChildPath(l,d)}p!==null&&!a.some(d=>d.type===f.type&&d.eventPath===l)&&a.push({type:f.type,eventPath:l,dataPath:p,subscriptionPath:c})})}}),a},getAllSubscribersForPath:s=>{const o=N.get(s),a=[];return Object.keys(this._eventSubscriptions).forEach(c=>{if(o.isOnTrailOf(c)){const u=this._eventSubscriptions[c],l=N.fillVariables(c,s);u.forEach(f=>{let p=null;if(f.type==="value"||f.type==="notify_value")p=l;else if(["child_changed","notify_child_changed"].includes(f.type)){const d=s===l||o.isAncestorOf(l)?"*":N.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];p=N.getChildPath(l,d)}else if(["mutated","mutations","notify_mutated","notify_mutations"].includes(f.type))p=s;else if(["child_added","child_removed","notify_child_added","notify_child_removed"].includes(f.type)&&(o.isChildOf(l)||s===l||o.isAncestorOf(l))){const d=s===l||o.isAncestorOf(l)?"*":N.getPathKeys(s.slice(l.length).replace(/^\//,""))[0];p=N.getChildPath(l,d)}p!==null&&!a.some(d=>d.type===f.type&&d.eventPath===l&&d.subscriptionPath===c)&&a.push({type:f.type,eventPath:l,dataPath:p,subscriptionPath:c})})}}),a},trigger:(s,o,a,c,u,l)=>{(this._eventSubscriptions[o]||[]).filter(p=>p.type===s).forEach(p=>{p.callback(null,a,u,c,l)})}},this.debug=new xo(n.logLevel,`[${e}${typeof t.type=="string"&&t.type!=="data"?`:${t.type}`:""}]`);const i=e+(typeof t.type=="string"?`_${t.type}`:"");if(t.ipc==="socket"||t.ipc instanceof $e){const s={ipcName:i,server:t.ipc instanceof $e?t.ipc:null};this.ipc=new $e(this,s)}else if(t.ipc){if(typeof t.ipc.port!="number")throw new Error("IPC port number must be a number");if(!["master","worker"].includes(t.ipc.role))throw new Error(`IPC client role must be either "master" or "worker", not "${t.ipc.role}"`);const s=Object.assign({dbname:i},t.ipc);this.ipc=new $e(this,s)}else this.ipc=new Hl(this,i);this.ipc.once("exit",s=>{this.indexes.supported&&this.indexes.close()}),this.nodeLocker={lock:(s,o,a,c)=>this.ipc.lock({path:s,tid:o,write:a,comment:c})},this._lastTid=0}close(){return P(this,null,function*(){yield this.ipc.exit()})}get path(){return`${this.settings.path}/${this.name}.acebase`}valueFitsInline(e){if(typeof e=="number"||typeof e=="boolean"||e instanceof Date)return!0;if(typeof e=="string")return e.length>this.settings.maxInlineValueSize?!1:ps(e).length<this.settings.maxInlineValueSize;if(e instanceof pe)return e.path.length>this.settings.maxInlineValueSize?!1:ps(e.path).length<this.settings.maxInlineValueSize;if(e instanceof ArrayBuffer)return e.byteLength<this.settings.maxInlineValueSize;if(e instanceof Array)return e.length===0;if(typeof e=="object")return Object.keys(e).length===0;throw new TypeError("What else is there?")}_writeNode(e,t,n){throw new Error("This method must be implemented by subclass")}getUpdateImpact(e,t){let n=e,i=!1;const s=t?[]:this.subscriptions.getAllSubscribersForPath(e),o=t?[]:this.subscriptions.getValueSubscribersForPath(e);o.length>0&&(i=!0,n=o.map(f=>({path:f.dataPath,keys:N.getPathKeys(f.dataPath)})).sort((f,p)=>f.keys.length<p.keys.length?-1:f.keys.length>p.keys.length?1:0)[0].path,o.filter(f=>f.dataPath===n).every(f=>f.type==="mutated"||f.type.startsWith("notify_"))&&(i=!1),n=N.fillVariables(n,e));const a=this.indexes.getAll(e,{childPaths:!0,parentPaths:!0}).map(u=>({index:u,keys:N.getPathKeys(u.path)})).sort((u,l)=>u.keys.length<l.keys.length?-1:u.keys.length>l.keys.length?1:0).map(u=>u.index),c=[];if(a.length>0){a.sort((f,p)=>(typeof f._pathKeys=="undefined"&&(f._pathKeys=N.getPathKeys(f.path)),typeof p._pathKeys=="undefined"&&(p._pathKeys=N.getPathKeys(p.path)),f._pathKeys.length<p._pathKeys.length?-1:f._pathKeys.length>p._pathKeys.length?1:0));const u=a[0],l=u.path===e?e:N.fillVariables(`${u.path}/*`,e);l.length<n.length&&(n=l,a.filter(f=>f.path===u.path).forEach(f=>{[f.key].concat(f.includeKeys).forEach(d=>!c.includes(d)&&c.push(d))}))}return{topEventPath:n,eventSubscriptions:s,valueSubscribers:o,hasValueSubscribers:i,indexes:a,keysFilter:c}}_writeNodeWithTracking(i,s){return P(this,arguments,function*(e,t,n={merge:!1,waitForIndexUpdates:!0,suppress_events:!1,context:null,impact:null}){if(n=n||{},!n.tid&&!n.transaction)throw new Error("_writeNodeWithTracking MUST be executed with a tid OR transaction!");n.merge=n.merge===!0;const o=this.validateSchema(e,t,{updates:n.merge});if(!o.ok)throw new Zl(o.reason);const a=n.tid,c=n.transaction;let u=null;const l=n.impact?n.impact:this.getUpdateImpact(e,n.suppress_events),{topEventPath:f,eventSubscriptions:p,hasValueSubscribers:d,indexes:h}=l;let{keysFilter:y}=l;const b=()=>{if(typeof n._customWriteFunction=="function")return n._customWriteFunction();if(u){const m=N.getPathKeys(e),A=N.getPathKeys(f),g=m.slice(A.length);let w=u;for(;g.length>0&&w!==null;){const v=g.shift();w=typeof w=="object"&&v in w?w[v]:null}n.currentValue=w}return this._writeNode(e,t,n)},_=this.settings.transactions&&this.settings.transactions.log===!0;if(p.length===0&&h.length===0&&!_)return b();if(!d&&n.merge===!0&&y.length===0&&(y=Object.keys(t),f!==e)){const m=e.slice(f.length);y=y.map(A=>`${m}/${A}`)}const j=yield this.getNodeInfo(f,{transaction:c,tid:a});let $=null;if(j.exists){const m={transaction:c,tid:a};y.length>0&&(m.include=y),f===""&&typeof m.include=="undefined"&&this.debug.warn('WARNING: One or more value event listeners on the root node are causing the entire database value to be read to facilitate change tracking. Using "value", "notify_value", "child_changed" and "notify_child_changed" events on the root node are a bad practice because of the significant performance impact. Use "mutated" or "mutations" events instead'),$=(yield this.getNode(f,m)).value}u=$;const L=(yield b())||{};let K,M;if(e===f)n.merge?u===null?K=t instanceof Array?[]:{}:(K=u instanceof Array?[]:{},Object.keys(u).forEach(m=>{K[m]=u[m]})):K=t,M=K;else{const m=e.slice(f.length).replace(/^\//,""),A=N.getPathKeys(m);for(u===null?K=typeof A[0]=="number"?[]:{}:(K=u instanceof Array?[]:{},Object.keys(u).forEach(g=>{K[g]=u[g]})),M=K;A.length>0;){const g=A.shift();if(!n.merge&&A.length===0)M[g]=t;else{const w=M[g],v=typeof g=="number"?[...w]:U({},w);M[g]=v}M=M[g]}}n.merge&&Object.keys(t).forEach(m=>{M[m]=t[m]});const Z=gn(u,K);if(Z==="identical")return L.mutations=[],L;function se(m){if(m===null||typeof m!="object")return m;Object.keys(m).forEach(A=>{const g=m[A];g===null&&(delete m[A],m instanceof Array&&m.length--),typeof g=="object"&&se(g)})}se(K);const re=[];h.map(m=>({index:m,keys:N.getPathKeys(m.path)})).sort((m,A)=>m.keys.length<A.keys.length?1:m.keys.length>A.keys.length?-1:0).forEach(({index:m})=>{const A=N.getPathKeys(f),g=N.getPathKeys(m.path+"/*"),w=g.slice(A.length),v=u,E=K;if(w.length===0){Ne(A.length===g.length,"check logic");const R=this.ipc.isMaster?m.handleRecordUpdate(f,v,E):this.ipc.sendRequest({type:"index.update",fileName:m.fileName,path:f,oldValue:v,newValue:E});re.push(R);return}const T=(R,C,I)=>{if(C===null&&I===null)return[];const D=N.getPathKeys(R),V=N.getPathKeys(m.path+"/*"),H=V.slice(D.length);if(H.length===0)return Ne(D.length===V.length,"check logic"),[{path:R,oldValue:C,newValue:I}];let G=[],W="";for(;H.length>0;){const Ee=H.shift();if(typeof Ee=="string"&&(Ee==="*"||Ee.startsWith("$"))){const oe=C===null?[]:Object.keys(C);I!==null&&Object.keys(I).forEach(ae=>{oe.indexOf(ae)<0&&oe.push(ae)}),oe.forEach(ae=>{const ye=N.getChildPath(W,ae),ie=Et(ae,C,I),Se=N.getChildPath(R,ye),ce=T(Se,ie.oldValue,ie.newValue);G=G.concat(ce)});break}else{const oe=Et(Ee,C,I);if(C=oe.oldValue,I=oe.newValue,C===null&&I===null)break;W=N.getChildPath(W,Ee)}}return G};T(f,v,E).forEach(R=>{const C=this.ipc.isMaster?m.handleRecordUpdate(R.path,R.oldValue,R.newValue):this.ipc.sendRequest({type:"index.update",fileName:m.fileName,path:R.path,oldValue:R.oldValue,newValue:R.newValue});re.push(C)})});const x=(m,A,g,w=[])=>{let v=!0,E=m.type;if(E.startsWith("notify_")&&(E=E.slice(7)),E==="mutated"||(E==="child_changed"&&(A===null||g===null)?v=!1:E==="value"||E==="child_changed"?v=gn(A,g)!=="identical":E==="child_added"?v=A===null&&g!==null:E==="child_removed"&&(v=A!==null&&g===null),!v))return;const T=N.getPathKeys(m.dataPath);w.forEach(R=>{const C=T.indexOf(R.name);Ne(C>=0,`Variable "${R.name}" not found in subscription dataPath "${m.dataPath}"`),T[C]=R.value});const O=T.reduce((R,C)=>N.getChildPath(R,C),"");this.subscriptions.trigger(m.type,m.subscriptionPath,O,A,g,n.context)},k=(m,A,g,w)=>{const v=[],E=w||gn(A,g);return E==="identical"||(typeof E=="string"?v.push({path:m,oldValue:A,newValue:g}):(E.changed.forEach(T=>{const O=N.getChildPath(m,T.key),R=Et(T.key,A,g),C=k(O,R.oldValue,R.newValue,T.change);v.push(...C)}),E.added.forEach(T=>{const O=N.getChildPath(m,T);v.push({path:O,oldValue:null,newValue:g[T]})}),A instanceof Array&&g instanceof Array&&E.removed.sort((T,O)=>T<O?1:-1),E.removed.forEach(T=>{const O=N.getChildPath(m,T);v.push({path:O,oldValue:A[T],newValue:null})}))),v};_&&this.settings.type!=="transaction"&&(L.mutations=(()=>{const m=e.slice(f.length).replace(/^\//,""),A=N.getPathKeys(m);let g=u,w=K;for(;A.length>0;){const O=A.shift();({oldValue:g,newValue:w}=Et(O,g,w))}const v=gn(g,w);return k(e,g,w,v).map(O=>({target:N.getPathKeys(O.path.slice(e.length)),prev:O.oldValue,val:O.newValue}))})());const S=()=>{p.filter(A=>!["mutated","mutations","notify_mutated","notify_mutations"].includes(A.type)).map(A=>{const g=N.getPathKeys(A.dataPath);return{sub:A,keys:g}}).sort((A,g)=>A.keys.length<g.keys.length?1:A.keys.length>g.keys.length?-1:0).forEach(({sub:A})=>{const g=(w,v,E,T=[])=>{const O=A.dataPath.slice(w.length).replace(/^\//,""),R=N.getPathKeys(O);for(;R.length>0;){const C=R.shift();if(typeof C=="string"&&(C==="*"||C[0]==="$")){const I=v===null?[]:Object.keys(v).map(D=>v instanceof Array?parseInt(D):D);E!==null&&Object.keys(E).forEach(D=>{const V=E instanceof Array?parseInt(D):D;!I.includes(V)&&I.push(D)}),I.forEach(D=>{const V=Et(D,v,E),H=T.concat({name:C,value:D});R.length===0?x(A,V.oldValue,V.newValue,H):g(N.getChildPath(w,C),V.oldValue,V.newValue,H)});return}else{w=N.getChildPath(w,C);const I=Et(C,v,E);v=I.oldValue,E=I.newValue}}x(A,v,E,T)};if(A.type.startsWith("notify_")&&N.get(A.eventPath).isAncestorOf(f)){const w=N.get(A.eventPath).isParentOf(f);(A.type==="notify_value"||A.type==="notify_child_changed"&&(!w||!["added","removed"].includes(Z))||A.type==="notify_child_removed"&&Z==="removed"&&w||A.type==="notify_child_added"&&Z==="added"&&w)&&this.subscriptions.trigger(A.type,A.subscriptionPath,A.dataPath,null,null,n.context)}else g(f,u,K)}),p.filter(A=>["mutated","mutations","notify_mutated","notify_mutations"].includes(A.type)).forEach(A=>{let g=f;const w=A.eventPath.slice(g.length).replace(/^\//,""),v=N.getPathKeys(w);let E=u,T=K;for(;v.length>0;){const C=v.shift();g=N.getChildPath(g,C);const I=Et(C,E,T);E=I.oldValue,T=I.newValue}const O=k(g,E,T);if(O.length===0)return;const R=A.type.startsWith("notify_");if(["mutated","notify_mutated"].includes(A.type))O.forEach((C,I)=>{const D=n.context,V=R?null:C.oldValue,H=R?null:C.newValue;this.subscriptions.trigger(A.type,A.subscriptionPath,C.path,V,H,D)});else if(["mutations","notify_mutations"].includes(A.type)){const C=R?null:O.map(I=>({target:N.getPathKeys(I.path.slice(A.subscriptionPath.length)),prev:I.oldValue,val:I.newValue}));this.subscriptions.trigger(A.type,A.subscriptionPath,A.subscriptionPath,null,C,n.context)}})};return n.waitForIndexUpdates===!1&&re.splice(0),yield Promise.all(re),Ql(S),L})}getChildren(e,t){throw new Error("This method must be implemented by subclass")}getNodeValue(n){return P(this,arguments,function*(e,t={}){return(yield this.getNode(e,t)).value})}getNode(e,t){throw new Error("This method must be implemented by subclass")}getNodeInfo(e,t){throw new Error("This method must be implemented by subclass")}setNode(e,t,n){throw new Error("This method must be implemented by subclass")}updateNode(e,t,n){throw new Error("This method must be implemented by subclass")}transactNode(i,s){return P(this,arguments,function*(e,t,n={no_lock:!1,suppress_events:!1,context:null}){const o=n&&n.no_lock===!0,a=this.createTid(),c=o?{tid:a,release:Xl}:yield this.nodeLocker.lock(e,a,!0,"transactNode");try{let u=!1;const l=()=>{u=!0};o&&this.subscriptions.add(e,"notify_value",l);const f=yield this.getNode(e,{tid:a}),p=f.revision;let d;try{d=t(f.value),d instanceof Promise&&(d=yield d.catch(y=>{this.debug.error(`Error in transaction callback: ${y.message}`)}))}catch(y){this.debug.error(`Error in transaction callback: ${y.message}`)}if(typeof d=="undefined")return;if(o&&this.subscriptions.remove(e,"notify_value",l),u)throw new Lr("Node changed");return yield this.setNode(e,d,{assert_revision:p,tid:c.tid,suppress_events:n.suppress_events,context:n.context})}catch(u){if(u instanceof Lr)return console.warn(`node value changed, running again. Error: ${u.message}`),this.transactNode(e,t,n);throw u}finally{c.release()}})}matchNode(e,t,n){return P(this,null,function*(){var a;const i=(a=n==null?void 0:n.tid)!=null?a:Ie.generate(),s=(c,u)=>P(this,null,function*(){if(u.length===0)return Promise.resolve(!0);const l=u.reduce((h,y)=>{let b=y.key;return typeof b=="string"&&b.includes("/")&&(b=b.slice(0,b.indexOf("/"))),h.indexOf(b)<0&&h.push(b),h},[]),f=l.slice();let p=!0;const d=[];try{return yield this.getChildren(c,{tid:i,keyFilter:l}).next(h=>{var j;const y=(j=h.key)!=null?j:h.index;f.includes(y)&&f.splice(f.indexOf(h.key),1);const b=u.filter($=>$.key===y).map($=>({op:$.op,compare:$.compare})),_=b.length>0?o(h,b):{isMatch:!0,promises:[]};if(p=_.isMatch,p){d.push(..._.promises);const $=u.filter(L=>typeof L.key=="string"&&L.key.startsWith(`${typeof y=="number"?`[${y}]`:y}/`)).map(L=>({key:L.key.slice(L.key.indexOf("/")+1),op:L.op,compare:L.compare}));if($.length>0){const L=N.getChildPath(c,h.key),K=s(L,$).then(M=>({isMatch:M}));d.push(K)}}if(!p||f.length===0)return!1}),p&&(p=(yield Promise.all(d)).every(y=>y.isMatch)),p?(p=f.every(h=>{const y=new So(fe(U(U({},typeof h=="number"&&{index:h}),typeof h=="string"&&{key:h}),{exists:!1})),b=u.filter($=>typeof $.key=="string"&&$.key.startsWith(`${typeof h=="number"?`[${h}]`:h}/`)).map($=>({op:$.op,compare:$.compare}));if(b.length>0&&!o(y,b).isMatch)return!1;const _=u.filter($=>$.key===h).map($=>({op:$.op,compare:$.compare}));return _.length===0?!0:o(y,_).isMatch}),p):!1}catch(h){throw this.debug.error(`Error matching on "${c}": `,h),h}}),o=(c,u)=>{const l=[];return{isMatch:u.every(p=>{let d=!0;if(p.op==="!exists"||p.op==="=="&&(typeof p.compare=="undefined"||p.compare===null))d=!c.exists;else if(p.op==="exists"||p.op==="!="&&(typeof p.compare=="undefined"||p.compare===null))d=c.exists;else if((p.op==="contains"||p.op==="!contains")&&p.compare instanceof Array&&p.compare.length===0)d=!0;else if(!c.exists)d=!1;else if(c.address)if(c.valueType===F.OBJECT&&["has","!has"].indexOf(p.op)>=0){const h=p.op==="has"?"exists":"!exists",y=s(c.path,[{key:p.compare,op:h}]).then(b=>({key:c.key,isMatch:b}));l.push(y),d=!0}else if(c.valueType===F.ARRAY&&["contains","!contains"].indexOf(p.op)>=0){const h=this.getNode(c.path,{tid:i}).then(({value:y})=>{const b=p.op==="contains"?p.compare instanceof Array?p.compare.every(_=>y.includes(_)):y.includes(p.compare):p.compare instanceof Array?!p.compare.some(_=>y.includes(_)):!y.includes(p.compare);return{key:c.key,isMatch:b}});l.push(h),d=!0}else if(c.valueType===F.STRING){const h=this.getNode(c.path,{tid:i}).then(y=>({key:c.key,isMatch:this.test(y.value,p.op,p.compare)}));l.push(h),d=!0}else d=!1;else if(c.type===F.OBJECT&&["has","!has"].indexOf(p.op)>=0){const h=p.compare in c.value;d=h&&p.op==="has"||!h&&p.op==="!has"}else if(c.type===F.ARRAY&&["contains","!contains"].indexOf(p.op)>=0){const h=c.value.indexOf(p.compare)>=0;d=h&&p.op==="contains"||!h&&p.op==="!contains"}else{let h=this.test(c.value,p.op,p.compare);h instanceof Promise&&(l.push(h),h=!0),d=h}return d}),promises:l}};return s(e,t)})}test(e,t,n){if(t==="<")return e<n;if(t==="<=")return e<=n;if(t==="==")return e===n;if(t==="!=")return e!==n;if(t===">")return e>n;if(t===">=")return e>=n;if(t==="in")return n.indexOf(e)>=0;if(t==="!in")return n.indexOf(e)<0;if(t==="like"||t==="!like"){const i="^"+n.replace(/[-[\]{}()+.,\\^$|#\s]/g,"\\$&").replace(/\?/g,".").replace(/\*/g,".*?")+"$",o=new RegExp(i,"i").test(e.toString());return t==="like"?o:!o}if(t==="matches")return n.test(e.toString());if(t==="!matches")return!n.test(e.toString());if(t==="between")return e>=n[0]&&e<=n[1];if(t==="!between")return e<n[0]||e>n[1];if(t==="has"||t==="!has"){const i=typeof e=="object"&&n in e;return t==="has"?i:!i}if(t==="contains"||t==="!contains"){const i=typeof e=="object"&&e instanceof Array&&e.includes(n);return t==="contains"?i:!i}return!1}exportNode(i,s){return P(this,arguments,function*(e,t,n={format:"json",type_safe:!0}){if((n==null?void 0:n.format)!=="json")throw new Error("Only json output is currently supported");const o=typeof t!="function"?t.write.bind(t):t,a=(h,y)=>{const b=_=>_.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\u0000-\u001f]/g,j=>`\\u${j.charCodeAt(0).toString(16).padStart(4,"0")}`);return h===F.DATETIME?(y=`"${y.toISOString()}"`,n.type_safe&&(y=`{".type":"date",".val":${y}}`)):h===F.STRING?y=`"${b(y)}"`:h===F.ARRAY?y="[]":h===F.OBJECT?y="{}":h===F.BINARY?(y=`"${b(at.encode(y))}"`,n.type_safe&&(y=`{".type":"binary",".val":${y}}`)):h===F.REFERENCE?(y=`"${y.path}"`,n.type_safe&&(y=`{".type":"reference",".val":${y}}`)):h===F.BIGINT&&(y=`"${y}"`,n.type_safe&&(y=`{".type":"bigint",".val":${y}}`)),y};let c="",u="";const l=yield this.getNodeInfo(e);if(l.exists)if(l.type===F.OBJECT)c="{",u="}";else if(l.type===F.ARRAY)c="[",u="]";else{const h=yield this.getNode(e),y=a(l.type,h.value);return o(y)}else return o("null");if(c){const h=o(c);h instanceof Promise&&(yield h)}let f="",p=0;const d=[];if(yield this.getChildren(e).next(h=>{h.address?d.push(h):(p++>0&&(f+=","),typeof h.key=="string"&&(f+=`"${h.key}":`),f+=a(h.type,h.value))}),f){const h=o(f);h instanceof Promise&&(yield h)}for(;d.length>0;){const h=d.shift();let y=p++>0?",":"";const b=typeof h.index=="number"?h.index:h.key;if(typeof b=="string"&&(y+=`"${b}":`),y){const _=o(y);_ instanceof Promise&&(yield _)}yield this.exportNode(N.getChildPath(e,b),o,n)}if(u){const h=o(u);h instanceof Promise&&(yield h)}})}importNode(i,s){return P(this,arguments,function*(e,t,n={format:"json",method:"set"}){const a={data:"",index:0,offset:0,queue:[],queueStartByte:0,timesFlushed:0,get processedBytes(){return this.offset+this.index}},c=(x=!1)=>P(this,null,function*(){let k=yield t(262144);if(k===null)throw a.data?new Error(`Unexpected EOF at index ${a.offset+a.data.length}`):new Error("Unable to read data from stream");typeof k=="object"&&(k=lo(k)),x?a.data+=k:(a.offset+=a.data.length,a.data=k,a.index=0)}),u=x=>P(this,null,function*(){let k="";return a.index+x>=a.data.length&&(k=a.data.slice(a.index),x-=k.length,yield c()),k+=a.data.slice(a.index,a.index+x),a.index+=x,k}),l=x=>P(this,null,function*(){if(a.index+x>a.data.length&&(yield c(!0)),a.index+x>a.data.length)throw new Error("Not enough data available from stream")}),f=x=>P(this,null,function*(){const k=yield u(x.length);if(k!==x)throw new Error(`Unexpected character "${k[0]}" at index ${a.offset+a.index}, expected "${x}"`)}),p=()=>P(this,null,function*(){const x=[" ","	","\r",`
`];for(;a.index>=a.data.length&&(yield c()),x.includes(a.data[a.index]);)a.index++}),d=x=>P(this,null,function*(){yield l(x);const k=a.index;return a.data.slice(k,k+x)}),h=()=>P(this,null,function*(){yield p();const x=yield d(1);switch(x){case'"':return"string";case"{":return"object";case"[":return"array";case"n":return"null";case"u":return"undefined";case"t":case"f":return"boolean";default:{if(x==="-"||x>="0"&&x<="9")return"number";throw new Error(`Unknown value at index ${a.offset+a.index}`)}}}),y=()=>P(this,null,function*(){yield f('"');let x="",k=a.index;for(;a.data[k]!=='"'||a.data[k-1]==="\\";)k++,k>=a.data.length&&(x+=a.data.slice(a.index),yield c(),k=0);return x+=a.data.slice(a.index,k),a.index=k+1,$(x)}),b=()=>P(this,null,function*(){throw a.data[a.index]==="t"?yield f("true"):a.data[a.index]==="f"&&(yield f("false")),new Error(`Expected true or false at index ${a.offset+a.index}`)}),_=()=>P(this,null,function*(){let x="",k=a.index;const S=["-","0","1","2","3","4","5","6","7","8","9",".","e","b","f","x","o","n"];for(;S.includes(a.data[k]);)k++,k>=a.data.length&&(x+=a.data.slice(a.index),yield c(),k=0);return x+=a.data.slice(a.index,k),a.index=k,x.endsWith("n")?BigInt(x.slice(0,-1)):x.includes(".")?parseFloat(x):parseInt(x)}),j=()=>P(this,null,function*(){yield p();const x=yield h(),k=yield(()=>{switch(x){case"string":return y();case"object":return{};case"array":return[];case"number":return _();case"null":return null;case"undefined":return;case"boolean":return b()}})();return{type:x,value:k}}),$=x=>x.replace(/\\n/g,`
`).replace(/\\"/g,'"'),L=(x,k)=>{const S=k[".type"];let m=k[".val"];switch(S){case"Date":case"date":{m=new Date(m);break}case"Buffer":case"binary":{if(m=$(m),m.startsWith("<~"))m=at.decode(m);else throw new Error(`Import error: Unexpected encoding for value for value at path "/${x}"`);break}case"PathReference":case"reference":{m=new pe(m);break}case"bigint":{m=BigInt(m);break}default:throw new Error(`Import error: Unsupported type "${S}" for value at path "/${x}"`)}return m},K={acebase_import_id:Ie.generate()},M={suppress_events:n.suppress_events,context:K},Z=x=>P(this,null,function*(){if(yield f("{"),yield p(),(yield d(1))==="}")return a.index++,this.setNode(x.path,{},M);let S=0,m={},A=!1;const g=()=>P(this,null,function*(){let E;A?Object.keys(m).length>0&&(E=this.updateNode(x.path,m,M)):(A=!0,E=this.setNode(x.path,m,M)),m={},E&&(yield E)}),w=[];for(;;){yield p();const E=yield y();yield p(),yield f(":"),yield p();const{value:T,type:O}=yield j();if(m[E]=T,S++,["object","array"].includes(O)&&(w.push(g()),O==="object"?yield Z(x.child(E)):yield se(x.child(E))),yield p(),(yield d(1))==="}"){a.index++;break}yield f(",")}if(S===2&&".type"in m&&".val"in m){const E=L(x.path,m);return this.setNode(x.path,E,M)}w.push(g()),yield Promise.all(w)}),se=x=>P(this,null,function*(){if(yield f("["),yield p(),(yield d(1))==="]")return a.index++,this.setNode(x.path,[],M);let S=!1,m=[],A={};const g=()=>P(this,null,function*(){let T;S?Object.keys(A).length>0&&(T=this.updateNode(x.path,A,M),A={}):(S=!0,T=this.setNode(x.path,m,M),m=null),T&&(yield T)}),w=(T,O)=>{S?A[O]=T:m.push(T)},v=[];let E=0;for(;;){yield p();const{value:T,type:O}=yield j();if(w(T,E),["object","array"].includes(O)&&(v.push(g()),O==="object"?yield Z(x.child(E)):yield se(x.child(E))),yield p(),(yield d(1))==="]"){a.index++;break}yield f(","),E++}v.push(g()),yield Promise.all(v)});return(()=>P(this,null,function*(){const{value:x,type:k}=yield j();if(["object","array"].includes(k)){const S=N.get(e);k==="object"?yield Z(S):yield se(S)}else yield this.setNode(e,x,M)}))()})}setSchema(e,t,n=!1){if(typeof t=="undefined")throw new TypeError("schema argument must be given");if(t===null){const o=this._schemas.findIndex(a=>a.path===e);o>=0&&this._schemas.splice(o,1);return}const i=new Dl(t,{warnOnly:n,warnCallback:o=>this.debug.warn(o)}),s=this._schemas.find(o=>o.path===e);s?s.schema=i:(this._schemas.push({path:e,schema:i}),this._schemas.sort((o,a)=>{const c=N.getPathKeys(o.path),u=N.getPathKeys(a.path);return c.length===u.length?0:c.length<u.length?-1:1}))}getSchema(e){const t=this._schemas.find(n=>n.path===e);return t?{path:e,schema:t.schema.source,text:t.schema.text}:null}getSchemas(){return this._schemas.map(e=>({path:e.path,schema:e.schema.source,text:e.schema.text}))}validateSchema(e,t,n={updates:!1}){let i={ok:!0};const s=N.get(e);return this._schemas.filter(o=>s.isOnTrailOf(o.path)).every(o=>{if(s.isDescendantOf(o.path)){const l=N.fillVariables(o.path,e),f=s.keys.slice(N.getPathKeys(o.path).length);return i=o.schema.check(l,t,n.updates,f),i.ok}const a=N.getPathKeys(o.path).slice(s.keys.length);if(n.updates===!0&&a.length>0&&!(a[0]in t))return i.ok;const c=n.updates===!0&&a.length===0,u=(l,f,p)=>{if(p.length===0)return o.schema.check(l,f,c);if(f===null)return{ok:!0};const d=p[0];if(typeof d=="string"&&(d==="*"||d[0]==="$")){if(f===null||typeof f!="object")return{ok:!0};let h;return Object.keys(f).every(y=>{const b=N.getChildPath(l,y),_=f[y];return h=u(b,_,p.slice(1)),h.ok}),h}else{const h=N.getChildPath(l,d),y=f[d];return u(h,y,p.slice(1))}};return i=u(e,t,a),i.ok}),i}}class Xt{static ChildPathsSql(e,t="path"){return e===""?`${t} <> '' AND ${t} NOT LIKE '%/%'`:`(${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%') AND ${t} NOT LIKE '${e}/%/%' AND ${t} NOT LIKE '${e}[%]/%' AND ${t} NOT LIKE '${e}[%][%'`}static ChildPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])$`)}static DescendantPathsSql(e,t="path"){return e===""?`${t} <> ''`:`${t} LIKE '${e}/%' OR ${t} LIKE '${e}[%'`}static DescendantPathsRegex(e){return new RegExp(`^${e}(?:/[^/[]+|\\[[0-9]+\\])`)}static get PathInfo(){return N}}class ys{constructor(e){this.path=e}toString(){return`"/${this.path}"`}equals(e){return this.path===e.path}}const{compareValues:tf}=yo;class ci{constructor(e){this.production=!1,this.target={get originalPath(){return e.path},path:e.path,get write(){return e.write}},this.id=Ie.generate()}getChildCount(e){return P(this,null,function*(){let t=0;return yield this.childrenOf(e,{metadata:!1,value:!1},()=>(t++,!1)),t})}getMultiple(e){return P(this,null,function*(){const t=new Map;return yield Promise.all(e.map(n=>this.get(n).then(i=>t.set(n,i)))),t})}setMultiple(e){return P(this,null,function*(){yield Promise.all(e.map(({path:t,node:n})=>this.set(t,n)))})}removeMultiple(e){return P(this,null,function*(){yield Promise.all(e.map(t=>this.remove(t)))})}commit(){return P(this,null,function*(){throw new Error("CustomStorageTransaction.rollback must be overridden by subclass")})}moveToParentPath(e){return P(this,null,function*(){const t=this._lock&&this._lock.path||this.target.path;if(t===e)return e;if(Xt.PathInfo.get(e).isParentOf(t))this._lock&&(this._lock=yield this._lock.moveToParent());else throw new Error(`Locking issue. Locked path "${this._lock.path}" is not a child/descendant of "${e}"`);return this.target.path=e,e})}}class Zt extends ai{constructor(e){if(super(e),this.locking=!0,typeof e!="object")throw new Error("settings missing");if(typeof e.ready!="function")throw new Error("ready must be a function");if(typeof e.getTransaction!="function")throw new Error("getTransaction must be a function");this.name=e.name,this.locking=e.locking!==!1,this.locking&&(this.lockTimeout=typeof e.lockTimeout=="number"?e.lockTimeout:120),this.ready=e.ready;const t=this.locking,n=t?new Oo(console,this.lockTimeout):null;this.getTransaction=o=>P(this,[o],function*({path:i,write:s}){const a=yield e.getTransaction({path:i,write:s});Ne(typeof a.id=="string","transaction id not set");const c=a.rollback,u=a.commit;return a.commit=()=>P(this,null,function*(){const l=yield u.call(a);return t&&(yield a._lock.release("commit")),l}),a.rollback=l=>P(this,null,function*(){const f=yield c.call(a,l);return t&&(yield a._lock.release("rollback")),f}),t&&(a._lock=yield n.lock(i,a.id,s,`${this.name}::getTransaction`)),a})}}class gr extends So{constructor(e){super(e),this.revision=e.revision,this.revision_nr=e.revision_nr,this.created=e.created,this.modified=e.modified}}class nf extends ef{constructor(e,t,n){super(e,t,n),this._customImplementation=t,this._init()}_init(){return P(this,null,function*(){this.debug.log(`Database "${this.name}" details:`.colorize(Ae.dim)),this.debug.log("- Type: CustomStorage".colorize(Ae.dim)),this.debug.log(`- Path: ${this.settings.path}`.colorize(Ae.dim)),this.debug.log(`- Max inline value size: ${this.settings.maxInlineValueSize}`.colorize(Ae.dim)),this.debug.log(`- Autoremove undefined props: ${this.settings.removeVoidProperties}`.colorize(Ae.dim)),yield this._customImplementation.ready();const e=yield this._customImplementation.getTransaction({path:"",write:!0});(yield this.getNodeInfo("",{transaction:e})).exists||(yield this._writeNode("",{},{transaction:e})),yield e.commit(),this.indexes.supported&&(yield this.indexes.load()),this.emit("ready")})}throwImplementationError(e){throw new Error(`CustomStorage "${this._customImplementation.name}" ${e}`)}_storeNode(e,t,n){const i=o=>{if(o===null)throw new Error("Not allowed to store null values. remove the property");if(["string","number","boolean"].includes(typeof o))return o;if(o instanceof Date)return{type:F.DATETIME,value:o.getTime()};if(o instanceof pe)return{type:F.REFERENCE,value:o.path};if(o instanceof ArrayBuffer)return{type:F.BINARY,value:at.encode(o)};if(typeof o=="object")return Ne(Object.keys(o).length===0,"child object stored in parent can only be empty"),o},s="Caller should have pre-processed the value by converting it to a string";if(t.type===F.ARRAY&&t.value instanceof Array){console.warn(`Unprocessed array. ${s}`);const o={};for(let a=0;a<t.value.length;a++)o[a]=t.value[a];t.value=o}if(t.type===F.BINARY&&typeof t.value!="string"&&(console.warn(`Unprocessed binary value. ${s}`),t.value=at.encode(t.value)),t.type===F.REFERENCE&&t.value instanceof pe&&(console.warn(`Unprocessed path reference. ${s}`),t.value=t.value.path),[F.OBJECT,F.ARRAY].includes(t.type)){const o=t.value;t.value={},Object.keys(o).forEach(a=>{t.value[a]=i(o[a])})}return n.transaction.set(e,t)}_processReadNodeValue(e){const t=n=>{if(n.type===F.BINARY)return at.decode(n.value);if(n.type===F.DATETIME)return new Date(n.value);if(n.type===F.REFERENCE)return new pe(n.value);throw new Error(`Unhandled child value type ${n.type}`)};switch(e.type){case F.ARRAY:case F.OBJECT:{const n=e.value;Object.keys(n).forEach(i=>{const s=n[i];typeof s=="object"&&"type"in s&&(n[i]=t(s))}),e.value=n;break}case F.BINARY:{e.value=at.decode(e.value);break}case F.REFERENCE:{e.value=new pe(e.value);break}case F.STRING:break;default:throw new Error("Invalid standalone record value type")}}_readNode(e,t){return P(this,null,function*(){const n=yield t.transaction.get(e);return n===null?null:(typeof n!="object"&&this.throwImplementationError("transaction.get must return an ICustomStorageNode object. Use JSON.parse if your set function stored it as a string"),this._processReadNodeValue(n),n)})}_getTypeFromStoredValue(e){let t;if(typeof e=="string")t=F.STRING;else if(typeof e=="number")t=F.NUMBER;else if(typeof e=="boolean")t=F.BOOLEAN;else if(e instanceof Array)t=F.ARRAY;else if(typeof e=="object")if("type"in e){const n=e;t=n.type,e=n.value,t===F.DATETIME?e=new Date(e):t===F.REFERENCE&&(e=new pe(e))}else t=F.OBJECT;else throw new Error("Unknown value type");return{type:t,value:e}}_writeNode(e,t,n){return P(this,null,function*(){if(!n.merge&&this.valueFitsInline(t)&&e!=="")throw new Error("invalid value to store in its own node");if(e===""&&(typeof t!="object"||t instanceof Array))throw new Error("Invalid root node value. Must be an object");if(typeof n.diff=="undefined"&&typeof n.currentValue!="undefined"){const h=tf(n.currentValue,t);n.merge&&typeof h=="object"&&(h.removed=h.removed.filter(y=>t[y]===null)),n.diff=h}if(n.diff==="identical")return;const i=n.transaction,s=n.currentValue===null?null:yield this._readNode(e,{transaction:i});if(n.merge&&s){if(s.type===F.ARRAY&&!(t instanceof Array)&&typeof t=="object"&&Object.keys(t).some(h=>isNaN(parseInt(h))))throw new Error(`Cannot merge existing array of path "${e}" with an object`);if(t instanceof Array&&s.type!==F.ARRAY)throw new Error(`Cannot merge existing object of path "${e}" with an array`)}const o=n.revision||Ie.generate(),a={type:s&&s.type===F.ARRAY?F.ARRAY:F.OBJECT,value:{}},c={};if(t instanceof Array){a.type=F.ARRAY;const h={};for(let y=0;y<t.length;y++)h[y]=t[y];t=h}else t instanceof pe?(a.type=F.REFERENCE,a.value=t.path):t instanceof ArrayBuffer?(a.type=F.BINARY,a.value=at.encode(t)):typeof t=="string"&&(a.type=F.STRING,a.value=t);const u=s?[F.OBJECT,F.ARRAY].includes(s.type):!1,l=[F.OBJECT,F.ARRAY].includes(a.type),f={current:[],new:[]};let p=null;u&&(p=s.value,f.current=Object.keys(p),l&&(a.value=p)),l&&(n.merge||Object.keys(a.value).forEach(h=>{h in t||(t[h]=null)}),Object.keys(t).forEach(h=>{const y=t[h];if(delete a.value[h],y!==null){if(typeof y=="undefined")if(this.settings.removeVoidProperties===!0){delete t[h];return}else throw new Error(`Property "${h}" has invalid value. Cannot store undefined values. Set removeVoidProperties option to true to automatically remove undefined properties`);this.valueFitsInline(y)?a.value[h]=y:c[h]=y}}));const d=a.type===F.ARRAY;if(s){if(this.debug.log(`Node "/${e}" is being ${n.merge?"updated":"overwritten"}`.colorize(Ae.cyan)),u||l){const y=N.get(e),b=[];let _=!1;const j=x=>(_=!0,!i.production&&!y.isParentOf(x)&&this.throwImplementationError(`"${x}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),!0),$=x=>{_||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const k=N.get(x).key;return b.push(k.toString()),!0};yield i.childrenOf(e,{metadata:!1,value:!1},j,$),f.current=f.current.concat(b),l&&(n&&n.merge&&(f.new=f.current.slice()),Object.keys(t).forEach(x=>{f.new.includes(x)||f.new.push(x)}));const L={insert:f.new.filter(x=>!f.current.includes(x)),update:[],delete:n&&n.merge?Object.keys(t).filter(x=>t[x]===null):f.current.filter(x=>!f.new.includes(x))};if(L.update=f.new.filter(x=>f.current.includes(x)&&!L.delete.includes(x)),d&&n.merge&&(L.insert.length>0||L.delete.length>0)&&!L.update.concat(L.insert).every((S,m,A)=>A.includes(m.toString())))throw new Error(`Elements cannot be inserted beyond, or removed before the end of an array. Rewrite the whole array at path "${e}" or change your schema to use an object collection instead`);const K=Object.keys(c).map(x=>{const k=d?parseInt(x):x,S=typeof n.diff=="object"?n.diff.forChild(k):void 0;if(S==="identical")return;const m=y.childPath(k),A=c[k],g=typeof n.currentValue=="undefined"?void 0:n.currentValue!==null&&typeof n.currentValue=="object"&&k in n.currentValue?n.currentValue[k]:null;return this._writeNode(m,A,{transaction:i,revision:o,merge:!1,currentValue:g,diff:S})}),M=l?b.filter(x=>x in a.value):[],se=L.delete.concat(M).map(x=>{const k=d?parseInt(x):x,S=y.childPath(k);return this._deleteNode(S,{transaction:i})}),re=K.concat(se);yield Promise.all(re)}const h=this._storeNode(e,{type:a.type,value:a.value,revision:s.revision,revision_nr:s.revision_nr+1,created:s.created,modified:Date.now()},{transaction:i});if(h instanceof Promise)return yield h}else{if(this.debug.log(`Node "/${e}" is being created`.colorize(Ae.cyan)),d&&!Object.keys(a.value).concat(Object.keys(c)).every((j,$,L)=>L.includes($.toString())))throw new Error("Cannot store arrays with missing entries");const h=Object.keys(c).map(b=>{const _=d?parseInt(b):b,j=N.getChildPath(e,_),$=c[_];return this._writeNode(j,$,{transaction:i,revision:o,merge:!1,currentValue:null})}),y=this._storeNode(e,{type:a.type,value:a.value,revision:o,revision_nr:1,created:Date.now(),modified:Date.now()},{transaction:i});y instanceof Promise&&h.push(y),yield Promise.all(h)}})}_deleteNode(e,t){return P(this,null,function*(){const n=N.get(e);this.debug.log(`Node "/${e}" is being deleted`.colorize(Ae.cyan));const i=[e];let s=!1;const o=u=>(s=!0,!c.production&&!n.isAncestorOf(u)&&this.throwImplementationError(`"${u}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!0),a=u=>(s||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),i.push(u),!0),c=t.transaction;return yield c.descendantsOf(e,{metadata:!1,value:!1},o,a),this.debug.log(`Nodes ${i.map(u=>`"/${u}"`).join(",")} are being deleted`.colorize(Ae.cyan)),c.removeMultiple(i)})}getChildren(e,t={}){let n;const i={next(o){return n=o,s()}},s=()=>P(this,null,function*(){const o=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{let a=!1;return yield(()=>P(this,null,function*(){const c=yield this._readNode(e,{transaction:o});if(!c)throw new si(`Node "/${e}" does not exist`);if(![F.OBJECT,F.ARRAY].includes(c.type))return;const u=c.type===F.ARRAY,l=c.value;let f=Object.keys(l).map(b=>u?parseInt(b):b);t.keyFilter&&(f=f.filter(b=>t.keyFilter.includes(b)));const p=N.get(e);if(f.length>0&&f.every(b=>{const _=this._getTypeFromStoredValue(l[b]),j=new gr({path:p.childPath(b),key:u?null:b,index:u?b:null,type:_.type,address:null,exists:!0,value:_.value,revision:c.revision,revision_nr:c.revision_nr,created:new Date(c.created),modified:new Date(c.modified)});return a=n(j)===!1,!a}),a)return;let d=!1;const h=b=>{if(d=!0,!o.production&&!p.isParentOf(b)&&this.throwImplementationError(`"${b}" is not a child of "${e}" - childrenOf must only check and return paths that are children`),t.keyFilter){const _=N.get(b).key;return t.keyFilter.includes(_)}return!0},y=(b,_)=>{d||this.throwImplementationError("childrenOf did not call checkCallback before addCallback");const j=N.get(b).key,$=new gr({path:b,type:_.type,key:u?null:j,index:u?j:null,address:new ys(b),exists:!0,value:null,revision:_.revision,revision_nr:_.revision_nr,created:new Date(_.created),modified:new Date(_.modified)});return a=n($)===!1,!a};yield o.childrenOf(e,{metadata:!0,value:!1},h,y)}))(),t.transaction||(yield o.commit()),a}catch(a){throw t.transaction||(yield o.rollback(a)),a}});return i}getNode(e,t){return P(this,null,function*(){t=t||{};const n=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const i=yield(()=>P(this,null,function*(){const s=t.include&&t.include.length>0||t.exclude&&t.exclude.length>0||t.child_objects===!1,o=N.get(e),a=yield this._readNode(e,{transaction:n});if(!a){if(e==="")return{value:null};const $=yield n.moveToParentPath(o.parentPath);Ne($===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const L=yield this._readNode(o.parentPath,{transaction:n});if(L&&[F.OBJECT,F.ARRAY].includes(L.type)&&o.key in L.value){const K=this._getTypeFromStoredValue(L.value[o.key]);return{revision:L.revision,revision_nr:L.revision_nr,created:L.created,modified:L.modified,type:K.type,value:K.value}}return{value:null}}const c=a.type===F.ARRAY,u=$=>{const L=K=>/^[0-9]+$/.test(K);return $.map(K=>N.get(c&&L(K)?`[${K}]`:K))},l=t.include?u(t.include):[],f=t.exclude?u(t.exclude):[],p=($,L)=>{if([F.OBJECT,F.ARRAY].includes(L.type)&&l.length>0){const K=N.getPathKeys($).slice(o.keys.length),M=new N(K),Z=[],se=l.filter(k=>k.isDescendantOf(M));if(se.length>0){const k=L.type===F.ARRAY;Z.push(...Object.keys(L.value).map(S=>k?+S:S));for(const S of se){const m=S.keys[K.length];if(typeof m=="string"&&(m==="*"||m.startsWith("$"))){Z.splice(0);break}const A=Z.indexOf(m);A>=0&&Z.splice(A,1)}}const re=l.some(k=>k.isChildOf(M));if(f.some(k=>k.isChildOf(M))&&!re){const k=f.filter(S=>S.isChildOf(M));for(let S=0;S<Z.length;S++)k.find(m=>m.equals(Z[S]))||(Z.splice(S,1),S--)}for(const k of Z)delete L.value[k]}};p(e,a);let d=!1;const h=($,L)=>{if(d=!0,!n.production&&!o.isAncestorOf($)&&this.throwImplementationError(`"${$}" is not a descendant of "${e}" - descendantsOf must only check and return paths that are descendants`),!s)return!0;const M=N.getPathKeys($).slice(o.keys.length),Z=new N(M);let se=(l.length>0?l.some(re=>Z.isOnTrailOf(re)):!0)&&(f.length>0?!f.some(re=>re.equals(Z)||re.isAncestorOf(Z)):!0);return se&&t.child_objects===!1&&(o.isParentOf($)&&[F.OBJECT,F.ARRAY].includes(L?L.type:-1)||N.getPathKeys($).length>o.pathKeys.length+1)&&(se=!1),se},y=[],b=($,L)=>{if(d||this.throwImplementationError("descendantsOf did not call checkCallback before addCallback"),t.child_objects===!1&&[F.OBJECT,F.ARRAY].includes(L.type))return!0;p($,L),this._processReadNodeValue(L);const K=L;return K.path=$,y.push(K),!0};yield n.descendantsOf(e,{metadata:!0,value:!0},h,b),this.debug.log(`Read node "/${e}" and ${s?"(filtered) ":""}descendants from ${y.length+1} records`.colorize(Ae.magenta));const _=a,j=$=>{const L=[];return Object.keys($).forEach(K=>{const M=parseInt(K);L[M]=$[M]}),L};if(a.type===F.ARRAY&&(_.value=j(_.value)),a.type===F.OBJECT||a.type===F.ARRAY){const $=N.getPathKeys(e),L=a.value;for(let K=0;K<y.length;K++){const M=y[K],se=N.getPathKeys(M.path).slice($.length);let re=L;for(let x=0;x<se.length;x++){Ne(typeof re=="object","parent must be an object/array to have children!!");const k=se[x],S=x===se.length-1,m=S?M.type:typeof se[x+1]=="number"?F.ARRAY:F.OBJECT;let A;S?(A=M.value,m===F.ARRAY&&(A=j(A))):A=m===F.OBJECT?{}:[],k in re?typeof re[k]==typeof A&&[F.OBJECT,F.ARRAY].includes(m)?Object.keys(A).forEach(w=>{w in re[k]&&this.throwImplementationError(`Custom storage merge error: child key "${w}" is in parent value already! Make sure the get/childrenOf/descendantsOf methods of the custom storage class return values that can be modified by AceBase without affecting the stored source`),re[k][w]=A[w]}):this.debug.error(`The value stored in node "${M.path}" cannot be merged with the parent node, value will be ignored. This error should disappear once the target node value is updated. See issue #20 for more information`,{path:e,parent:re,key:k,nodeType:m,nodeValue:A}):re[k]=A,re=re[k]}}}else y.length>0&&this.throwImplementationError("multiple records found for non-object value!");if(t.child_objects===!1&&Object.keys(_.value).forEach($=>{typeof _.value[$]=="object"&&_.value[$].constructor===Object&&(Ne(Object.keys(_.value[$]).length===0),delete _.value[$])}),t.include,t.exclude){const $=(L,K)=>{if(typeof L!="object")return;const M=K[0];M==="*"?Object.keys(L).forEach(Z=>{$(L[Z],K.slice(1))}):K.length>1?M in L&&$(L[M],K.slice(1)):delete L[M]};t.exclude.forEach(L=>{const K=N.getPathKeys(L);$(_.value,K)})}return _}))();return t.transaction||(yield n.commit()),i}catch(i){throw t.transaction||(yield n.rollback(i)),i}})}getNodeInfo(n){return P(this,arguments,function*(e,t={}){t=t||{};const i=N.get(e),s=t.transaction||(yield this._customImplementation.getTransaction({path:e,write:!1}));try{const o=yield this._readNode(e,{transaction:s}),a=new gr({path:e,key:typeof i.key=="string"?i.key:null,index:typeof i.key=="number"?i.key:null,type:o?o.type:0,exists:o!==null,address:o?new ys(e):null,created:o?new Date(o.created):null,modified:o?new Date(o.modified):null,revision:o?o.revision:null,revision_nr:o?o.revision_nr:null});if(!o&&e!==""){const c=yield s.moveToParentPath(i.parentPath);Ne(c===i.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`);const u=yield this._readNode(i.parentPath,{transaction:s});u&&[F.OBJECT,F.ARRAY].includes(u.type)&&i.key in u.value?(a.exists=!0,a.value=u.value[i.key],a.address=null,a.type=u.type,a.created=new Date(u.created),a.modified=new Date(u.modified),a.revision=u.revision,a.revision_nr=u.revision_nr):a.address=null}return t.include_child_count&&(a.childCount=0,[F.OBJECT,F.ARRAY].includes(a.valueType)&&a.address&&(a.childCount=o.value?Object.keys(o.value).length:0,a.childCount+=yield s.getChildCount(e))),t.transaction||(yield s.commit()),a}catch(o){throw t.transaction||(yield s.rollback(o)),o}})}setNode(i,s){return P(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");const o=N.get(e),a=n.transaction||(yield this._customImplementation.getTransaction({path:e,write:!0}));try{if(e===""){if(t===null||typeof t!="object"||t instanceof Array||t instanceof ArrayBuffer||"buffer"in t&&t.buffer instanceof ArrayBuffer)throw new Error(`Invalid value for root node: ${t}`);yield this._writeNodeWithTracking("",t,{merge:!1,transaction:a,suppress_events:n.suppress_events,context:n.context})}else if(typeof n.assert_revision!="undefined"){const c=yield this.getNodeInfo(e,{transaction:a});if(c.revision!==n.assert_revision)throw new Lr(`revision '${c.revision}' does not match requested revision '${n.assert_revision}'`);if(c.address&&c.address.path===e&&t!==null&&!this.valueFitsInline(t))yield this._writeNodeWithTracking(e,t,{merge:!1,transaction:a,suppress_events:n.suppress_events,context:n.context});else{const u=yield a.moveToParentPath(o.parentPath);Ne(u===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this._writeNodeWithTracking(o.parentPath,{[o.key]:t},{merge:!0,transaction:a,suppress_events:n.suppress_events,context:n.context})}}else{const c=yield a.moveToParentPath(o.parentPath);Ne(c===o.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this.updateNode(o.parentPath,{[o.key]:t},{transaction:a,suppress_events:n.suppress_events,context:n.context})}n.transaction||(yield a.commit())}catch(c){throw n.transaction||(yield a.rollback(c)),c}})}updateNode(i,s){return P(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){if(this.settings.readOnly)throw new Error("Database is opened in read-only mode");if(typeof t!="object")throw new Error("invalid updates argument");if(Object.keys(t).length===0)return;const o=n.transaction||(yield this._customImplementation.getTransaction({path:e,write:!0}));try{const a=yield this.getNodeInfo(e,{transaction:o}),c=N.get(e);if(a.exists&&a.address&&a.address.path===e)yield this._writeNodeWithTracking(e,t,{transaction:o,merge:!0,suppress_events:n.suppress_events,context:n.context});else if(a.exists){const u=N.get(e),l=yield o.moveToParentPath(u.parentPath);Ne(l===u.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this._writeNodeWithTracking(u.parentPath,{[u.key]:t},{transaction:o,merge:!0,suppress_events:n.suppress_events,context:n.context})}else{const u=yield o.moveToParentPath(c.parentPath);Ne(u===c.parentPath,`transaction.moveToParentPath() did not move to the right parent path of "${e}"`),yield this.updateNode(c.parentPath,{[c.key]:t},{transaction:o,suppress_events:n.suppress_events,context:n.context})}n.transaction||(yield o.commit())}catch(a){throw n.transaction||(yield o.rollback(a)),a}})}}class rf{constructor(e=1e3,t){this.limit=e,this.options=t,this.added=0,this.scheduled=[],this.running=0,this.results=[],this.done=!1}execute(e,t){return P(this,null,function*(){var n,i;try{this.running++;const s=yield e();if(this.results[t]=s,this.running--,this.running===0&&this.scheduled.length===0)this.done=!0,(n=this.doneCallback)==null||n.call(this,this.results);else if(this.scheduled.length>0){const o=this.scheduled.shift();this.execute(o.task,o.index)}}catch(s){this.done=!0,(i=this.errorCallback)==null||i.call(this,s)}})}add(e){var n;if(this.done)throw new Error("Cannot add to a batch that has already finished. Use wait option and start batch processing manually if you are adding tasks in an async loop");const t=this.added++;((n=this.options)==null?void 0:n.wait)!==!0&&this.running<this.limit?this.execute(e,t):this.scheduled.push({task:e,index:t})}start(){for(;this.running<this.limit;){const e=this.scheduled.shift();this.execute(e.task,e.index)}}finish(){return P(this,null,function*(){return this.running===0&&this.scheduled.length===0?this.results:(yield new Promise((e,t)=>{this.doneCallback=e,this.errorCallback=t}),this.results)})}}const sf=()=>{};function Po(i,s,o){return P(this,arguments,function*(r,e,t,n={snapshots:!1,include:void 0,exclude:void 0,child_objects:void 0,eventHandler:sf}){var Z,se,re,x,k,S;typeof n!="object"&&(n={}),typeof n.snapshots=="undefined"&&(n.snapshots=!1);const a={};(Z=r.storage.settings.transactions)!=null&&Z.log&&(a.acebase_cursor=Ie.generate());const c=t.filters.map(m=>U({},m)),u=t.order.map(m=>U({},m)),l=m=>{m.sort((A,g)=>{const w=v=>{const E=u[v],T=N.getPathKeys(typeof E.key=="number"?`[${E.key}]`:E.key),O=T.reduce((C,I)=>C!==null&&typeof C=="object"&&I in C?C[I]:null,A.val),R=T.reduce((C,I)=>C!==null&&typeof C=="object"&&I in C?C[I]:null,g.val);return O===null?R===null?0:E.ascending?-1:1:R===null?E.ascending?1:-1:O==R?v<u.length-1?w(v+1):A.path<g.path?-1:1:O<R?E.ascending?-1:1:E.ascending?1:-1};return w(0)})},f=(m,A)=>P(this,null,function*(){if(m.length===0)return[];const g=50,w=new rf(g),v=[];return m.forEach(({path:E},T)=>w.add(()=>P(this,null,function*(){const R=(yield r.storage.getNode(E,A)).value;if(R===null){r.storage.debug.warn(`Indexed result "/${E}" does not have a record!`);return}const C={path:E,val:R};M.sorted?v[T]=C:(v.push(C),!M.skipped&&v.length>t.skip+Math.abs(t.take)&&(l(v),v.pop()))}))),yield w.finish(),v}),p=N.get(e),d=p.keys.some(m=>m==="*"||m.toString().startsWith("$")),h=r.storage.indexes.get(e),y=[];let b=()=>P(this,null,function*(){});if(d){const m=p.keys.filter(w=>typeof w=="string"&&w.startsWith("$")),A=m.length>0&&m.every(w=>t.filters.some(v=>v.key===w&&["==","in"].includes(v.op))),g=typeof n.monitor=="object"&&[(se=n.monitor)==null?void 0:se.add,(re=n.monitor)==null?void 0:re.change,(x=n.monitor)==null?void 0:x.remove].some(w=>w===!0);if(A&&!g){const w=[];for(const I of m){const V=t.filters.filter(G=>G.key===I).reduce((G,W)=>{if(W.op==="=="&&G.push(W.compare),W.op==="in"){if(!(W.compare instanceof Array))throw new Error("compare argument for 'in' operator must be an Array");G.push(...W.compare)}return G},[]),H=w.splice(0);V.forEach(G=>{H.length===0?w.push({[I]:G}):w.push(...H.map(W=>fe(U({},W),{[I]:G})))})}const v=t.filters.filter(I=>!m.includes(I.key)),E=w.map(I=>N.get(N.getPathKeys(e).map(D=>{var V;return(V=I[D])!=null?V:D})).path),T=t.order.length>0,O=E.map(I=>{var D;return Po(r,I,{filters:v,take:0,skip:0,order:[]},{snapshots:T,cache_mode:n.cache_mode,include:[...(D=n.include)!=null?D:[],...t.order.map(V=>V.key)],exclude:n.exclude})});let C=(yield Promise.all(O)).reduce((I,D)=>(I.push(...D.results),I),[]);if(T&&l(C),t.skip>0&&C.splice(0,t.skip),t.take>0&&C.splice(t.take),n.snapshots&&(!T||((k=n.include)==null?void 0:k.length)>0||((S=n.exclude)==null?void 0:S.length)>0||!n.child_objects)){const{include:I,exclude:D,child_objects:V}=n;C=yield f(C,{include:I,exclude:D,child_objects:V})}return{results:C,context:null,stop:b}}else if(h.length===0){const w=new Error(`Query on wildcard path "/${e}" requires an index`);return Promise.reject(w)}if(c.length===0){const w=h.filter(v=>v.type==="normal")[0];c.push({key:w.key,op:"!=",compare:null})}}c.forEach(m=>{if(m.index)return;const A=h.filter(g=>g.key===m.key).filter(g=>g.validOperators.includes(m.op));if(A.length>=1){const g=c.filter(T=>T!==m).map(T=>T.key),w=u.map(T=>T.key).filter(T=>T!==m.key),v=A.map(T=>{const O=T.includeKeys.concat(T.key),R=O.filter(V=>g.includes(V)),C=O.filter(V=>w.includes(V)),I=R.concat(C.filter(V=>!R.includes(V))),D={filters:R.length,sorting:C.length*(t.take!==0?C.length:1),both:I.length*I.length,get total(){return this.filters+this.sorting+this.both}};return{index:T,points:D.total,filterKeys:R,sortKeys:C}});v.sort((T,O)=>T.points>O.points?-1:1);const E=v[0];m.index=E.index,E.filterKeys.forEach(T=>{c.filter(O=>O!==m&&O.key===T).forEach(O=>{!oi.validOperators.includes(O.op)||(O.indexUsage="filter",O.index=E.index)})}),E.sortKeys.forEach(T=>{u.filter(O=>O.key===T).forEach(O=>{O.index=E.index})})}m.index&&y.push({index:m.index,description:m.index.description})}),u.length>0&&t.take!==0&&c.length===0&&u.forEach(m=>{m.index||(m.index=h.filter(A=>A.key===m.key).find(A=>A.type==="normal"))});const _=y.map(m=>m.description).join(", ");y.length>0&&r.storage.debug.log(`Using indexes for query: ${_}`);const j=c.filter(m=>!m.index),$=/^[a-z]+:/i;if(j.some(m=>$.test(m.op))){const m=j.find(g=>$.test(g.op)),A=new Error(`query contains operator "${m.op}" which requires a special index that was not found on path "${e}", key "${m.key}"`);return Promise.reject(A)}const L=["<","<=","==","!=",">=",">","like","!like","in","!in","matches","!matches","between","!between","has","!has","contains","!contains","exists","!exists"];for(let m=0;m<j.length;m++){const A=j[m];if(!L.includes(A.op))return Promise.reject(new Error(`query contains unknown filter operator "${A.op}" on path "${e}", key "${A.key}"`))}if(d&&j.length>0){const m=j.reduce((g,w)=>(g.indexOf(w.key)<0&&g.push(w.key),g),[]).map(g=>`"${g}"`),A=new Error(`This wildcard path query on "/${e}" requires index(es) on key(s): ${m.join(", ")}. Create the index(es) and retry`);return Promise.reject(A)}const K=[];c.forEach(m=>{if(m.index&&m.indexUsage!=="filter"){let A=m.index.query(m.op,m.compare).then(w=>(n.eventHandler&&n.eventHandler({name:"stats",type:"index_query",source:m.index.description,stats:w.stats}),w.hints.length>0&&n.eventHandler&&n.eventHandler({name:"hints",type:"index_query",source:m.index.description,hints:w.hints}),w));const g=c.filter(w=>w.index===m.index&&w.indexUsage==="filter");g.length>0&&(A=A.then(w=>(g.forEach(v=>{const{key:E,op:T,index:O}=v;let{compare:R}=v;typeof R=="string"&&!O.caseSensitive&&(R=R.toLocaleLowerCase(O.textLocale)),w=w.filterMetadata(E,T,R)}),w))),K.push(A)}});const M={filtered:c.length===0,skipped:t.skip===0,taken:t.take===0,sorted:u.length===0,preDataLoaded:!1,dataLoaded:!1};if(c.length===0&&t.take===0&&(r.storage.debug.warn(`Filterless queries must use .take to limit the results. Defaulting to 100 for query on path "${e}"`),t.take=100),u.length>0&&u[0].index){const m=u[0].index,A=t.take<0?!u[0].ascending:u[0].ascending;if(c.length===0&&u.slice(1).every(g=>m.allMetadataKeys.includes(g.key))){r.storage.debug.log(`Using index for sorting: ${m.description}`);const g=u.slice(1).map(v=>(v.index=m,{key:v.key,ascending:v.ascending})),w=m.take(t.skip,Math.abs(t.take),{ascending:A,metadataSort:g}).then(v=>(n.eventHandler&&n.eventHandler({name:"stats",type:"sort_index_take",source:m.description,stats:v.stats}),v.hints.length>0&&n.eventHandler&&n.eventHandler({name:"hints",type:"sort_index_take",source:m.description,hints:v.hints}),v));K.push(w),M.skipped=!0,M.taken=!0,M.sorted=!0}}return Promise.all(K).then(m=>P(this,null,function*(){let A=[];if(m.length===1){const R=m[0];A=R.map(C=>{const I={key:C.key,path:C.path,val:{[R.filterKey]:C.value}};return C.metadata&&Object.assign(I.val,C.metadata),I}),M.filtered=!0}else if(m.length>1){m.sort((I,D)=>I.length<D.length?-1:1);const R=m[0],C=m.slice(1);A=R.reduce((I,D)=>{const V={key:D.key,path:D.path,val:{[R.filterKey]:D.value}};return C.every(G=>G.findIndex(W=>W.path===D.path)>=0)&&(D.metadata&&Object.assign(V.val,D.metadata),C.forEach(G=>{const W=G.find(Ee=>Ee.path===V.path);V.val[G.filterKey]=W.value,W.metadata&&Object.assign(V.val,W.metadata)}),I.push(V)),I},[]),M.filtered=!0}if(d||K.length>0&&j.length===0){if(u.length===0||u.every(R=>R.index)){if(M.preDataLoaded=!0,!M.sorted&&u.length>0&&l(A),M.sorted=!0,!M.skipped&&t.skip>0&&(A=t.take<0?A.slice(0,-t.skip):A.slice(t.skip)),!M.taken&&t.take!==0&&(A=t.take<0?A.slice(t.take):A.slice(0,t.take)),M.skipped=!0,M.taken=!0,!n.snapshots)return A;const R={include:n.include,exclude:n.exclude,child_objects:n.child_objects};return f(A,R).then(C=>(M.dataLoaded=!0,C))}if(n.snapshots||!M.sorted){const R=u.length>0,C=R?{include:u.map(I=>I.key)}:{include:n.include,exclude:n.exclude,child_objects:n.child_objects};return f(A,C).then(I=>(u.length>0&&l(I),M.sorted=!0,t.skip>0&&(I=t.take<0?I.slice(0,-t.skip):I.slice(t.skip)),t.take!==0&&(I=t.take<0?I.slice(t.take):I.slice(0,t.take)),M.skipped=!0,M.taken=!0,n.snapshots&&R?f(I,{include:n.include,exclude:n.exclude,child_objects:n.child_objects}):I))}else return A}let g;A.length>0&&(g=A.map(R=>R.key));let w=[],v=!1;const E=u.length>0,T=E?{include:u.map(R=>R.key)}:{include:n.include,exclude:n.exclude,child_objects:n.child_objects},O={promises:[],add(R){if(this.promises.push(R),this.promises.length>=1e3)return Promise.all(this.promises.splice(0)).then(C=>{})}};try{yield r.storage.getChildren(e,{keyFilter:g,async:!0}).next(R=>{if(R.type!==F.OBJECT||!R.address)return;if(v)return!1;const C=()=>P(this,null,function*(){if(!(yield r.storage.matchNode(R.address.path,j)))return;const V=R.address.path;let H;if(n.snapshots||u.length>0){const G=yield r.storage.getNode(V,T);H={path:V,val:G.value}}else H={path:V};w.push(H),t.take!==0&&w.length>Math.abs(t.take)+t.skip&&(u.length>0?l(w):t.take>0&&(v=!0),w.pop())}),I=O.add(C());if(I instanceof Promise)return I})}catch(R){return R instanceof si||r.storage.debug.warn(`Error getting child stream: ${R}`),[]}return yield Promise.all(O.promises),M.preDataLoaded=E,M.dataLoaded=!E,u.length>0&&l(w),M.sorted=!0,t.skip>0&&(w=t.take<0?w.slice(0,-t.skip):w.slice(t.skip)),M.skipped=!0,t.take!==0&&(w=t.take<0?w.slice(t.take):w.slice(0,t.take)),M.taken=!0,M.dataLoaded||(w=yield f(w,{include:n.include,exclude:n.exclude,child_objects:n.child_objects}),M.dataLoaded=!0),w})).then(m=>{if(!M.sorted&&u.length>0&&l(m),n.snapshots||(m=m.map(A=>A.path)),!M.skipped&&t.skip>0&&(m=t.take<0?m.slice(0,-t.skip):m.slice(t.skip)),!M.taken&&t.take!==0&&(m=t.take<0?m.slice(t.take):m.slice(0,t.take)),n.monitor===!0&&(n.monitor={add:!0,change:!0,remove:!0}),typeof n.monitor=="object"&&(n.monitor.add||n.monitor.change||n.monitor.remove)){const A=n.monitor,g=n.snapshots?m.map(I=>I.path):m.slice(),w=r.db.ref(e),v=I=>{const D=g.indexOf(I);D<0||g.splice(D,1)},E=I=>{g.includes(I)||g.push(I)},T=()=>{r.unsubscribe(w.path,"child_changed",O),r.unsubscribe(w.path,"child_added",R),r.unsubscribe(w.path,"notify_child_removed",C)};b=()=>P(this,null,function*(){T()});const O=(I,D,V,H)=>P(this,null,function*(){const G=g.includes(D);let W=!0;const Ee=[];c.forEach(ie=>!Ee.includes(ie.key)&&Ee.push(ie.key));const oe=[];typeof H=="object"&&Object.keys(H).forEach(ie=>!oe.includes(ie)&&oe.push(ie)),typeof V=="object"&&Object.keys(V).forEach(ie=>!oe.includes(ie)&&oe.push(ie));const ae=[];let ye=oe.every(ie=>Ee.includes(ie)?c.filter(ce=>ce.key===ie).every(ce=>{var Re;return((Re=ce.index)==null?void 0:Re.textLocaleKey)&&!oe.includes(ce.index.textLocaleKey)?(ae.push(ce.index.textLocaleKey),!0):L.includes(ce.op)?r.storage.test(V[ie],ce.op,ce.compare):ce.index.test(V,ce.op,ce.compare)}):!0);if(ye&&(ae.push(...Ee.filter(ie=>!oe.includes(ie))),!G&&ae.length>0)){const ie=c.filter(Re=>ae.includes(Re.key)),Se=ie.filter(Re=>L.includes(Re.op)),ce=ie.filter(Re=>!L.includes(Re.op));if(Se.length>0&&(ye=yield r.storage.matchNode(D,Se)),ye&&ce.length>0){const Re=ce.reduce((Ke,ot)=>(Ke.includes(ot.key)||Ke.push(ot.key),ot.index instanceof To&&ot.index.config.localeKey&&!Ke.includes(ot.index.config.localeKey)&&Ke.push(ot.index.config.localeKey),Ke),[]),ke=yield r.storage.getNode(D,{include:Re});if(ke.value===null)return!1;ye=ce.every(Ke=>Ke.index.test(ke.value,Ke.op,Ke.compare))}}if(ye){if(G||E(D),n.snapshots){const ie={include:n.include,exclude:n.exclude,child_objects:n.child_objects};V=(yield r.storage.getNode(D,ie)).value}G&&A.change?W=n.eventHandler({name:"change",path:D,value:V})!==!1:!G&&A.add&&(W=n.eventHandler({name:"add",path:D,value:V})!==!1)}else G&&(v(D),A.remove&&(W=n.eventHandler({name:"remove",path:D,value:H})!==!1));W===!1&&T()}),R=(I,D,V)=>{const H=c.every(W=>L.includes(W.op)?r.storage.test(V[W.key],W.op,W.compare):W.index.test(V,W.op,W.compare));let G=!0;H&&(E(D),A.add&&(G=n.eventHandler({name:"add",path:D,value:n.snapshots?V:null})!==!1)),G===!1&&T()},C=(I,D,V,H)=>{let G=!0;v(D),A.remove&&(G=n.eventHandler({name:"remove",path:D,value:n.snapshots?H:null})!==!1),G===!1&&T()};(n.monitor.add||n.monitor.change||n.monitor.remove)&&r.subscribe(w.path,"child_changed",O),n.monitor.remove&&r.subscribe(w.path,"notify_child_removed",C),n.monitor.add&&r.subscribe(w.path,"child_added",R)}return{results:m,context:a,stop:b}})})}class of extends Rl{constructor(e="default",t,n){super(),this.db=t.db;const i={logLevel:t.settings.logLevel};if(typeof t.settings.storage=="object")if(hs&&t.settings.storage instanceof hs)this.storage=new Ul(e,t.settings.storage,i);else if(ds&&t.settings.storage instanceof ds)this.storage=new Fl(e,t.settings.storage,i);else if(Zt&&t.settings.storage instanceof Zt)this.storage=new nf(e,t.settings.storage,i);else{const s=t.settings.storage instanceof yr?t.settings.storage:new yr(t.settings.storage);this.storage=new jr(e,s,i)}else this.storage=new jr(e,new yr,i);this.storage.on("ready",n)}stats(e){return P(this,null,function*(){return this.storage.stats})}subscribe(e,t,n){this.storage.subscriptions.add(e,t,n)}unsubscribe(e,t,n){this.storage.subscriptions.remove(e,t,n)}set(i,s){return P(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.setNode(e,t,{suppress_events:n.suppress_events,context:n.context});return U({},o&&{cursor:o})})}update(i,s){return P(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.updateNode(e,t,{suppress_events:n.suppress_events,context:n.context});return U({},o&&{cursor:o})})}get transactionLoggingEnabled(){return this.storage.settings.transactions&&this.storage.settings.transactions.log===!0}get(e,t){return P(this,null,function*(){if(t||(t={}),typeof t.include!="undefined"&&!(t.include instanceof Array))throw new TypeError("options.include must be an array of key names");if(typeof t.exclude!="undefined"&&!(t.exclude instanceof Array))throw new TypeError("options.exclude must be an array of key names");if(["undefined","boolean"].indexOf(typeof t.child_objects)<0)throw new TypeError("options.child_objects must be a boolean");const n=yield this.storage.getNode(e,t);return{value:n.value,context:{acebase_cursor:n.cursor},cursor:n.cursor}})}transaction(i,s){return P(this,arguments,function*(e,t,n={suppress_events:!1,context:null}){const o=yield this.storage.transactNode(e,t,{suppress_events:n.suppress_events,context:n.context});return U({},o&&{cursor:o})})}exists(e){return P(this,null,function*(){return(yield this.storage.getNodeInfo(e)).exists})}query(i,s){return P(this,arguments,function*(e,t,n={snapshots:!1}){return yield Po(this,e,t,n)})}createIndex(e,t,n){return this.storage.indexes.create(e,t,n)}getIndexes(){return P(this,null,function*(){return this.storage.indexes.list()})}deleteIndex(e){return P(this,null,function*(){return this.storage.indexes.delete(e)})}reflect(e,t,n){return P(this,null,function*(){n=n||{};const i=(s,o=50,a=0,c=null)=>P(this,null,function*(){typeof o=="string"&&(o=parseInt(o)),typeof a=="string"&&(a=parseInt(a)),["null","undefined"].includes(c)&&(c=null);const u=[];let l=0,f=!1,p=!1;return yield this.storage.getChildren(s).next(d=>{if(f)return p=!0,!1;l++,(c!==null?d.key>c:a===0||l>a)&&u.push(U({key:typeof d.key=="string"?d.key:d.index,type:d.valueTypeName,value:d.value},typeof d.address=="object"&&"pageNr"in d.address&&{address:{pageNr:d.address.pageNr,recordNr:d.address.recordNr}})),f=o>0&&u.length===o}).catch(d=>{if(!(d instanceof si))throw d}),{more:p,list:u}});switch(t){case"children":return yield i(e,n.limit,n.skip,n.from);case"info":{const s={key:"",exists:!1,type:"unknown",value:void 0,address:void 0,children:{count:0,more:!1,list:[]}},o=yield this.storage.getNodeInfo(e,{include_child_count:n.child_count===!0});s.key=typeof o.key!="undefined"?o.key:o.index,s.exists=o.exists,s.type=o.exists?o.valueTypeName:void 0,s.value=o.value,s.address=typeof o.address=="object"&&"pageNr"in o.address?{pageNr:o.address.pageNr,recordNr:o.address.recordNr}:void 0;const a=o.exists&&o.address&&[F.OBJECT,F.ARRAY].includes(o.type);return n.child_count===!0?s.children={count:a?o.childCount:0}:typeof n.child_limit=="number"&&n.child_limit>0&&a&&(s.children=yield i(e,n.child_limit,n.child_skip,n.child_from)),s}}})}export(e,t,n={format:"json",type_safe:!0}){return this.storage.exportNode(e,t,n)}import(e,t,n={format:"json",suppress_events:!1,method:"set"}){return this.storage.importNode(e,t,n)}setSchema(e,t,n=!1){return P(this,null,function*(){return this.storage.setSchema(e,t,n)})}getSchema(e){return P(this,null,function*(){return this.storage.getSchema(e)})}getSchemas(){return P(this,null,function*(){return this.storage.getSchemas()})}validateSchema(e,t,n){return P(this,null,function*(){return this.storage.validateSchema(e,t,{updates:n})})}getMutations(e){return P(this,null,function*(){if(typeof this.storage.getMutations!="function")throw new Error("Used storage type does not support getMutations");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getMutations(e)})}getChanges(e){return P(this,null,function*(){if(typeof this.storage.getChanges!="function")throw new Error("Used storage type does not support getChanges");if(typeof e!="object")throw new Error("No filter specified");if(typeof e.cursor!="string"&&typeof e.timestamp!="number")throw new Error("No cursor or timestamp given");return this.storage.getChanges(e)})}}class af extends ai{constructor(e){super(e),this.temp=!1,this.multipleTabs=!1,typeof e.temp=="boolean"&&(this.temp=e.temp),typeof e.provider=="object"&&(this.provider=e.provider),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase LocalStorage`)})}}class cf extends ci{constructor(e,t){super(t),this.context=e,this._storageKeysPrefix=`${this.context.dbname}.acebase::`}commit(){return P(this,null,function*(){})}rollback(e){return P(this,null,function*(){})}get(e){return P(this,null,function*(){const t=this.context.localStorage.getItem(this.getStorageKeyForPath(e));return JSON.parse(t)})}set(e,t){return P(this,null,function*(){const n=JSON.stringify(t);this.context.localStorage.setItem(this.getStorageKeyForPath(e),n)})}remove(e){return P(this,null,function*(){this.context.localStorage.removeItem(this.getStorageKeyForPath(e))})}childrenOf(e,t,n,i){return P(this,null,function*(){const s=Xt.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isParentOf(c)&&n(c)){let u;if(t.metadata||t.value){const f=this.context.localStorage.getItem(a);u=JSON.parse(f)}if(!i(c,u))break}}})}descendantsOf(e,t,n,i){return P(this,null,function*(){const s=Xt.PathInfo.get(e);for(let o=0;o<this.context.localStorage.length;o++){const a=this.context.localStorage.key(o);if(!a.startsWith(this._storageKeysPrefix))continue;const c=this.getPathFromStorageKey(a);if(s.isAncestorOf(c)&&n(c)){let u;if(t.metadata||t.value){const f=this.context.localStorage.getItem(a);u=JSON.parse(f)}if(!i(c,u))break}}})}getPathFromStorageKey(e){return e.slice(this._storageKeysPrefix.length)}getStorageKeyForPath(e){return`${this._storageKeysPrefix}${e}`}}function uf(r,e={}){const t=new af(e),n=t.provider?t.provider:t.temp?window.localStorage:window.sessionStorage,i=new Zt({name:"LocalStorage",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,ready(){return P(this,null,function*(){})},getTransaction(a){return P(this,null,function*(){const c={debug:!0,dbname:r,localStorage:n};return new cf(c,a)})}}),s=new an(r,{logLevel:t.logLevel,storage:i,sponsor:t.sponsor});return s.settings.ipcEvents=t.multipleTabs===!0,s}class lf extends ai{constructor(e){super(e),this.multipleTabs=!1,this.cacheSeconds=60,this.sponsor=!1,typeof e.logLevel=="string"&&(this.logLevel=e.logLevel),typeof e.multipleTabs=="boolean"&&(this.multipleTabs=e.multipleTabs),typeof e.cacheSeconds=="number"&&(this.cacheSeconds=e.cacheSeconds),typeof e.sponsor=="boolean"&&(this.sponsor=e.sponsor),["type","ipc","path"].forEach(t=>{t in e&&console.warn(`${t} setting is not supported for AceBase IndexedDBStorage`)})}}class Io extends Ao{constructor(e={}){super(e),e.storage&&(this.storage=e.storage,e.ipc&&(this.storage.ipc=e.ipc),e.transactions&&(this.storage.transactions=e.transactions))}}class ff extends Il{constructor(e,t={}){const n=new Io(t);super(e,n),this.recovery={repairNode:(s,o)=>P(this,null,function*(){if(yield this.ready(),this.api.storage instanceof jr)yield this.api.storage.repairNode(s,o);else if(!this.api.storage.repairNode)throw new Error("repairNode is not supported with chosen storage engine")}),repairNodeTree:s=>P(this,null,function*(){yield this.ready(),yield this.api.storage.repairNodeTree(s)})};const i={db:this,settings:n};this.api=new of(e,i,()=>{this.emit("ready")})}close(){return P(this,null,function*(){yield this.api.storage.close()})}get settings(){const e=this.api.storage.ipc,t=this.debug;return{get logLevel(){return t.level},set logLevel(n){t.setLevel(n)},get ipcEvents(){return e.eventsEnabled},set ipcEvents(n){e.eventsEnabled=n}}}static WithLocalStorage(e,t={}){return uf(e,t)}static WithIndexedDB(e,t={}){throw new Error("IndexedDB storage can only be used in browser contexts")}}function ms(r){return new Promise((e,t)=>{r.onsuccess=n=>e(r.result||null),r.onerror=t})}class hf extends ci{constructor(e,t){super(t),this.context=e,this.production=!0,this._pending=[]}_createTransaction(e=!1){return this.context.db.transaction(["nodes","content"],e?"readwrite":"readonly")}_splitMetadata(e){const t=e.value,n=U({},e);return delete n.value,{metadata:n,value:t}}commit(){return P(this,null,function*(){if(this._pending.length===0)return;const e=this._pending.splice(0);this.context.ipc.sendNotification({action:"cache.invalidate",paths:e.map(n=>n.path)});const t=this._createTransaction(!0);try{yield new Promise((n,i)=>{let s=!1,o=0;const a=u=>{s=!0,i(u)},c=()=>{++o===e.length&&n()};e.forEach((u,l)=>{if(s)return;let f,p;const d=u.path;if(u.action==="set"){const{metadata:y,value:b}=this._splitMetadata(u.node),_={path:d,metadata:y};f=t.objectStore("nodes").put(_),p=t.objectStore("content").put(b,d),this.context.cache.set(d,u.node)}else u.action==="remove"?(f=t.objectStore("content").delete(d),p=t.objectStore("nodes").delete(d),this.context.cache.set(d,null)):a(new Error(`Unknown pending operation "${u.action}" on path "${d}" `));let h=0;f.onsuccess=p.onsuccess=()=>{++h===2&&c()},f.onerror=p.onerror=a})}),t.commit&&t.commit()}catch(n){throw console.error(n),t.abort&&t.abort(),n}})}rollback(e){return P(this,null,function*(){this._pending=[]})}get(e){return P(this,null,function*(){if(this.context.cache.has(e))return this.context.cache.get(e);const t=this._createTransaction(!1),n=ms(t.objectStore("nodes").get(e)),i=ms(t.objectStore("content").get(e));try{const s=yield Promise.all([n,i]);t.commit&&t.commit();const o=s[0];if(!o)return this.context.cache.set(e,null),null;const a=o.metadata;return a.value=s[1],this.context.cache.set(e,a),a}catch(s){throw console.error("IndexedDB get error",s),t.abort&&t.abort(),s}})}set(e,t){this._pending.push({action:"set",path:e,node:t})}remove(e){this._pending.push({action:"remove",path:e})}removeMultiple(e){return P(this,null,function*(){e.forEach(t=>{this._pending.push({action:"remove",path:t})})})}childrenOf(e,t,n,i){return this._getChildrenOf(e,fe(U({},t),{descendants:!1}),n,i)}descendantsOf(e,t,n,i){return this._getChildrenOf(e,fe(U({},t),{descendants:!0}),n,i)}_getChildrenOf(e,t,n,i){return new Promise((s,o)=>{const a=Xt.PathInfo.get(e),c=this._createTransaction(!1),u=c.objectStore("nodes"),l=IDBKeyRange.lowerBound(e,!0),f=t.metadata?u.openCursor(l):u.openKeyCursor(l);f.onerror=p=>{var d;(d=c.abort)==null||d.call(c),o(p)},f.onsuccess=p=>P(this,null,function*(){var y,b,_;const d=(b=(y=f.result)==null?void 0:y.key)!=null?b:null;let h=!0;if(d===null)h=!1;else if(!a.isAncestorOf(d))h=!1;else if(t.descendants||a.isParentOf(d)){let j;if(t.metadata&&(j=f.result.value.metadata),n(d,j)){if(t.value)if(this.context.cache.has(d)){const L=this.context.cache.get(d);j.value=L.value}else{const L=c.objectStore("content").get(d);j.value=yield new Promise((K,M)=>{L.onerror=Z=>{K(null)},L.onsuccess=Z=>{K(L.result)}}),this.context.cache.set(d,j.value===null?null:j)}h=i(d,j)}}if(h)try{f.result.continue()}catch(j){h=!1}h||((_=c.commit)==null||_.call(c),s())})})}}function df(r,e={}){const t=new lf(e),i=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(`${r}.acebase`,1);i.onupgradeneeded=p=>{const d=i.result;d.createObjectStore("nodes",{keyPath:"path"}),d.createObjectStore("content")};let s;const o=new Promise((p,d)=>{i.onsuccess=h=>{s=i.result,p()},i.onerror=h=>{d(h)}}),a=new $l(typeof t.cacheSeconds=="number"?t.cacheSeconds:60),c=new Zt({name:"IndexedDB",locking:!0,removeVoidProperties:t.removeVoidProperties,maxInlineValueSize:t.maxInlineValueSize,lockTimeout:t.lockTimeout,ready(){return o},getTransaction(p){return P(this,null,function*(){yield o;const d={debug:!1,db:s,cache:a,ipc:l};return new hf(d,p)})}}),u=new an(r,{logLevel:t.logLevel,storage:c,sponsor:t.sponsor}),l=u.api.storage.ipc;return u.settings.ipcEvents=t.multipleTabs===!0,l.on("notification",p=>P(this,null,function*(){const d=p.data;if(typeof d=="object"&&d.action==="cache.invalidate")for(const h of d.paths)a.remove(h)})),u}const pf=`Using AceBase constructor in the browser to use localStorage is deprecated!
Switch to:
IndexedDB implementation (FASTER, MORE RELIABLE):
    let db = AceBase.WithIndexedDB(name, settings)
Or, new LocalStorage implementation:
    let db = AceBase.WithLocalStorage(name, settings)
Or, write your own CustomStorage adapter:
    let myCustomStorage = new CustomStorageSettings({ ... });
    let db = new AceBase(name, { storage: myCustomStorage })`;class an extends ff{constructor(e,t){if(typeof t!="object"||typeof t.storage!="object")throw new Error(pf);super(e,t),this.settings.ipcEvents=t.multipleTabs===!0}static WithIndexedDB(e,t={}){return df(e,t)}}const yf={AceBase:an,AceBaseLocalSettings:Io,DataReference:Xe,DataSnapshot:de,EventSubscription:co,PathReference:pe,TypeMappings:bo,CustomStorageSettings:Zt,CustomStorageTransaction:ci,CustomStorageHelpers:Xt,ID:Ie,proxyAccess:On,DataSnapshotsArray:Hn};window.acebase=yf;window.AceBase=an;let mf=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),vr=(()=>"/ps"+mf()+"/pe")();const Ve={req:"/custom",create:{one:"/create-one",many:"/create-many"},send:{one:"/send-one",many:"/send-many"},find:{one:"/find-one",many:"/find-many"},get:{one:"/get-one",many:"/get-many"},query:{many:"/get-many"},update:{one:"/update-one",many:"/update-many"},delete:{one:"/delete-one",many:"/delete-many"}},Fe={create:"/create",find:"/find",get:"/get",query:"/get",update:"/update",delete:"/delete",req:"/custom",upload:"/upload",send:"/send",user:{base:"/user",example:"/user/device-connected",join:"",status:"/user/status",device:{connected:"/user/device-connected",removed:"/user/device-removed",disconnected:"/user/device-disconnected"}}},wr={base:"/auth",login:"/login/get-one",verify_token_code:"/verify-token-code/get-one",verify_pass_code:"/verify-pass-code/get-one",verify_email_code:"/verify-email-code/get-one",req:"/custom",user:"/user/"+vr+"/get-one",register:"/register/get-one",forgotPassword:"/forgot-password/get-one"+vr+"/get-one",deleteAccount:"/delete-account/get-one",refreshToken:"/refresh-token"+vr+"/get-one",users:{base:"/users"}},gs={base:"/data"};var Dt,vt,_t,Ut,rn,Ye,Te,St,Pe;class gf{constructor(e={}){et(this,Dt,"/on");et(this,vt,!0);et(this,_t,void 0);et(this,Ut,void 0);et(this,rn,new Zu);et(this,Ye,void 0);et(this,Te,void 0);et(this,St,void 0);et(this,Pe,void 0);$i(this,"init",e=>{var K,M,Z,se,re;let{ENV:t,HOST_SERVER:n,API_VERSION:i}=Y(this,St),s=()=>P(this,null,function*(){var A,g,w,v,E,T,O,R,C,I,D,V;let x="/transaction",k="/database",S=yield(w=(g=(A=Y(this,Pe))==null?void 0:A.ref(x))==null?void 0:g.get())==null?void 0:w.catch(H=>{}),m=yield(T=(E=(v=Y(this,Pe))==null?void 0:v.ref(k))==null?void 0:E.get())==null?void 0:T.catch(H=>{});if(S.exists()){S=S.val();let H=Object.keys(S);if((H==null?void 0:H.length)>0){for(let G in H){let W=S[G];(W==null?void 0:W.path)&&(W==null?void 0:W.method)&&(W==null?void 0:W.value)&&(yield this.init(e).database().ref(W==null?void 0:W.path).req(W==null?void 0:W.method,W==null?void 0:W.path,W==null?void 0:W.value).val())}m.exists()&&(yield(C=(R=(O=Y(this,Pe))==null?void 0:O.ref(k))==null?void 0:R.remove())==null?void 0:C.catch(G=>{})),yield(V=(D=(I=Y(this,Pe))==null?void 0:I.ref(x))==null?void 0:D.remove())==null?void 0:V.catch(G=>{})}}});(M=(K=e==null?void 0:e.socket)==null?void 0:K.database)==null||M.on("connect",()=>{Je(this,Te,!0),s()}),(se=(Z=e==null?void 0:e.socket)==null?void 0:Z.database)==null||se.on("disconnect",()=>{Je(this,Te,!1)});const o=(x={})=>{let k={};return x&&Object.keys(x).length>0&&(k.data=x),k};let a=(x,k)=>P(this,null,function*(){var S,m,A,g,w,v,E,T;if(((S=x==null?void 0:x.error)==null?void 0:S.token)&&Y(this,vt)){if(Je(this,vt,!1),localStorage.getItem("refreshToken")){t==="dev"&&console.log("Token expired or not found: ",(m=x.error)==null?void 0:m.token," Trying to request a new refresh token");let O=yield(g=(A=this==null?void 0:this.init(e))==null?void 0:A.auth())==null?void 0:g.req(wr.refreshToken,{token:localStorage.getItem("refreshToken")}).val();if(O!=null&&O.error)return t==="dev"&&console.log("Refresh token expired or not found: ",O),Y(this,_t)&&(window.top.location.href=Y(this,_t)),O;if(O!=null&&O.data&&(t==="dev"&&console.log("We got a new refresh token ,",O==null?void 0:O.data),(w=O==null?void 0:O.data)!=null&&w.token&&localStorage.setItem("accessToken",(v=O==null?void 0:O.data)==null?void 0:v.token),(E=O==null?void 0:O.data)!=null&&E.refreshToken&&localStorage.setItem("refreshToken",(T=O==null?void 0:O.data)==null?void 0:T.refreshToken),t==="dev"&&console.log("Trying to restart your request..."),typeof k=="function"))return yield k()}}else return x});const c=(x,k,S,m=()=>{})=>{const A=Y(this,Dt);let g=k.version+A+k.base+S;g=g.replace(/\/\//g,"/"),t==="dev"&&console.log("socket listen local path: ",g),x==null||x.on(g,m)},u=(x,k=()=>{})=>{var A;const S=Y(this,Dt);let m=(i==null?void 0:i.DATABASE)+S+x;m=m.replace(/\/\//g,"/"),t==="dev"&&console.log("emitter listen local path: ",m),(A=Y(this,rn))==null||A.on(m,k)};let l=(x,k,S,m)=>(Y(this,Ut)&&(m=m+Y(this,Ut)),{req:A=>(c(x,k,m+Fe.req,g=>{var w,v,E;(!((v=(w=g==null?void 0:g.error)==null?void 0:w.error)!=null&&v.token)&&!((E=g==null?void 0:g.error)!=null&&E.token)||(g==null?void 0:g.data))&&typeof A=="function"&&A(fe(U({},S),{value:g}))}),S),create:A=>(c(x,k,m+Fe.create,g=>{var w,v,E;(!((v=(w=g==null?void 0:g.error)==null?void 0:w.error)!=null&&v.token)&&!((E=g==null?void 0:g.error)!=null&&E.token)||(g==null?void 0:g.data))&&typeof A=="function"&&A(fe(U({},S),{value:g}))}),S),find:A=>(c(x,k,m+Fe.find,g=>{var w,v,E;(!((v=(w=g==null?void 0:g.error)==null?void 0:w.error)!=null&&v.token)&&!((E=g==null?void 0:g.error)!=null&&E.token)||(g==null?void 0:g.data))&&typeof A=="function"&&A(fe(U({},S),{value:g}))}),S),get:A=>(c(x,k,m+Fe.get,g=>{var w,v,E;(!((v=(w=g==null?void 0:g.error)==null?void 0:w.error)!=null&&v.token)&&!((E=g==null?void 0:g.error)!=null&&E.token)||(g==null?void 0:g.data))&&typeof A=="function"&&A(fe(U({},S),{value:g}))}),S),query:A=>(c(x,k,m+Fe.query,g=>{var w,v,E;(!((v=(w=g==null?void 0:g.error)==null?void 0:w.error)!=null&&v.token)&&!((E=g==null?void 0:g.error)!=null&&E.token)||(g==null?void 0:g.data))&&typeof A=="function"&&A(fe(U({},S),{value:g}))}),S),update:A=>(c(x,k,m+Fe.update,g=>{var w,v,E;(!((v=(w=g==null?void 0:g.error)==null?void 0:w.error)!=null&&v.token)&&!((E=g==null?void 0:g.error)!=null&&E.token)||(g==null?void 0:g.data))&&typeof A=="function"&&A(fe(U({},S),{value:g}))}),S),delete:A=>(c(x,k,m+Fe.delete,g=>{var w,v,E;(!((v=(w=g==null?void 0:g.error)==null?void 0:w.error)!=null&&v.token)&&!((E=g==null?void 0:g.error)!=null&&E.token)||(g==null?void 0:g.data))&&typeof A=="function"&&A(fe(U({},S),{value:g}))}),S)}),f=(x,k)=>({create:S=>(u(x+Fe.create,m=>{(!(m!=null&&m.error)||(m==null?void 0:m.data))&&typeof S=="function"&&S(fe(U({},k),{value:m}))}),k),find:S=>(u(x+Fe.find,m=>{(!(m!=null&&m.error)||(m==null?void 0:m.data))&&typeof S=="function"&&S(fe(U({},k),{value:m}))}),k),get:S=>(u(x+Fe.get,m=>{(!(m!=null&&m.error)||(m==null?void 0:m.data))&&typeof S=="function"&&S(fe(U({},k),{value:m}))}),k),query:S=>(u(x+Fe.query,m=>{(!(m!=null&&m.error)||(m==null?void 0:m.data))&&typeof S=="function"&&S(fe(U({},k),{value:m}))}),k),update:S=>(u(x+Fe.update,m=>{(!(m!=null&&m.error)||(m==null?void 0:m.data))&&typeof S=="function"&&S(fe(U({},k),{value:m}))}),k),delete:S=>(u(x+Fe.delete,m=>{(!(m!=null&&m.error)||(m==null?void 0:m.data))&&typeof S=="function"&&S(fe(U({},k),{value:m}))}),k)}),p=ts.init(Y(this,St)),d=(x="",k={},S={},m={},A)=>{x=x.trim(),x.charAt(x.length-1)==="/"&&(x=x.slice(0,-1));let w=(()=>P(this,null,function*(){let v=()=>P(this,null,function*(){return yield p("post",n.AUTH+i.AUTH+wr.base+x,o(k))}),E=yield v();return Y(this,vt)&&(E=yield a(E,()=>P(this,null,function*(){return yield v()}))),typeof A=="function"&&A(fe(U({},m),{value:E})),E}))();return fe(U({},m),{val:()=>w})},h=(x,k,S,m={},A={},g)=>{let v=(()=>P(this,null,function*(){let E=()=>P(this,null,function*(){return yield p(x,k,o(S),m)}),T=yield E();return Y(this,vt)&&(T=yield a(T,()=>P(this,null,function*(){return yield E()}))),typeof g=="function"&&g(fe(U({},A),{value:T})),T}))();return fe(U({},A),{val:()=>v})},y=x=>{let k={},S,[m={},,,]=x;if(x.length===1&&typeof m=="function"&&(S=x[0],m={}),x.length===2&&(typeof x[1]=="object"?k=x[1]:typeof x[1]=="function"&&(S=x[1])),x.length>=3){let[,A,g]=x;typeof A=="object"&&(k=A),S=g}return{data:m,onRequest:k,callback:S}},b=()=>Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),_=(x,k,S={},m,A)=>{k=k.replace(/\/\//g,"/");let w=(()=>P(this,null,function*(){var I,D,V,H,G,W,Ee,oe,ae,ye,ie,Se,ce,Re,ke,Ke,ot,Oi,Ti,Pi,Ii,Ri,Ni;let v="/transaction",E,T,O={error:{message:"We could not execute the "+x+" method for path: "+k}};switch(x){case"create":yield(V=(D=(I=Y(this,Pe))==null?void 0:I.ref(k))==null?void 0:D.set(S))==null?void 0:V.catch(De=>O);break;case"update":yield(W=(G=(H=Y(this,Pe))==null?void 0:H.ref(k))==null?void 0:G.update(S))==null?void 0:W.catch(De=>O);break;case"query":let he=(Ee=Y(this,Pe))==null?void 0:Ee.query(k);Array.isArray(S==null?void 0:S.where)&&(yield Promise.all(S==null?void 0:S.where.map(De=>P(this,null,function*(){return yield new Promise($t=>{he==null||he.filter(...De),$t()})})))),S!=null&&S.take&&(he==null||he.take(S==null?void 0:S.take)),S!=null&&S.skip&&(he==null||he.take(S==null?void 0:S.skip)),S!=null&&S.order&&Array.isArray(S==null?void 0:S.order)&&(yield Promise.all(S==null?void 0:S.order.map(De=>P(this,null,function*(){return yield new Promise($t=>{he==null||he.sort(...De),$t()})})))),T=yield he==null?void 0:he.count(),E=yield(oe=he==null?void 0:he.get(U({},S==null?void 0:S.$option)))==null?void 0:oe.catch(De=>O);break;case"delete":E=yield(ie=(ye=(ae=Y(this,Pe))==null?void 0:ae.ref(k))==null?void 0:ye.get())==null?void 0:ie.catch(De=>O),yield(Re=(ce=(Se=Y(this,Pe))==null?void 0:Se.ref(k))==null?void 0:ce.remove())==null?void 0:Re.catch(De=>O);break}if(x!=="delete"&&x!=="query"&&(E=yield(ot=(Ke=(ke=Y(this,Pe))==null?void 0:ke.ref(k))==null?void 0:Ke.get(U({},S==null?void 0:S.$option)))==null?void 0:ot.catch(he=>O)),x==="query"?E.exists()?(E=E==null?void 0:E.getValues(),E={data:E,max:T,take:S==null?void 0:S.take,skip:S==null?void 0:S.skip}):E=U({},O):E.exists()?(E=E==null?void 0:E.val(),E={data:E}):E=U({},O),Y(this,Ye)&&m.auth().$currentUserId&&!Y(this,Te)&&["create","delete","update"].includes(x)&&E!=null&&E.data){let he=yield(Pi=(Ti=(Oi=Y(this,Pe))==null?void 0:Oi.ref(v))==null?void 0:Ti.get())==null?void 0:Pi.catch(ja=>O);he.exists()?he=he.val():he={};let De,$t=Object.keys(he);switch($t.length>0?De=$t.length+1:De=0,x){case"create":x="post";break;case"update":x="put";break;case"delete":x="delete";break}x!=="get"&&(yield(Ni=(Ri=(Ii=Y(this,Pe))==null?void 0:Ii.ref(v+"/"+De))==null?void 0:Ri.set({path:k,method:x,uid:De,value:E.data}))==null?void 0:Ni.catch(ja=>O))}const R=Y(this,Dt);let C=(i==null?void 0:i.DATABASE)+R+k+"/"+x;return C=C.replace(/\/\//g,"/"),Y(this,rn).emit(C,E),typeof A=="function"&&A(fe(U({},m),{value:E})),E}))();return fe(U({},m),{val:()=>w})},j=(x,k)=>{typeof x=="function"&&(k==null||k.on("connect",x))},$=(x,k)=>{var A;let S="%"+x,m=(A=this.init(e))==null?void 0:A.database();return{private:(g=b())=>m.event(x+g),child:g=>m.event(x+g),push:(g,w)=>{let v=m.event(x);return k==null||k.emit(S,g),typeof w=="function"&&(v==null||v.onValue(w)),U(U({},v),m)},onValue:g=>{let w=m.event(x);return k==null||k.on(S,v=>{typeof g=="function"&&g(fe(U(U({},w),m),{value:v}))}),U(U({},w),m)},onAnyValue:g=>(k==null||k.onAny((w,v)=>{let E=m.event(w);typeof g=="function"&&g(w,U(U({value:v},E),m))}),U({},m))}},L=(x,k,S)=>fe(U({},x),{$io:S,connected:()=>S==null?void 0:S.connected,event:m=>$(m,S),ready:m=>j(m,S),ref:(m="")=>x.ref(m,k,S)});return{$connected:Y(this,Te),activity:()=>{let x=this.init(e);return{onStart:k=>(typeof k=="function"&&document.addEventListener("DOMContentLoaded",k),U(U({},x),x.activity())),onCreate:k=>(typeof k=="function"&&(window.onload=k),U(U({},x),x.activity())),onPause:k=>(window.addEventListener("beforeunload",function(S){typeof k=="function"&&k(),S.returnValue="onbeforeunload"}),U(U({},x),x.activity())),onResume:()=>U(U({},x),x.activity()),onLeave:k=>(typeof k=="function"&&(window.onunload=k),U(U({},x),x.activity()))}},socket:{database:(re=e==null?void 0:e.socket)==null?void 0:re.database},$randomUID:()=>lr(),$randomId:()=>b(),$axios:ts,local:(x={})=>{const k=this.init(e);return delete k.local,delete k.auth().register,delete k.auth().login,{database:(S="/database")=>({ref:(m="/database")=>{let A=this.init(e);return delete A.auth().login,delete A.auth().register,m=m.trim(),m=m.replace(/\/\//g,"/"),S=S+"/"+m,S=S.replace(/\/\//g,"/"),m.charAt(m.length-1)==="/"&&(m=m.slice(0,-1)),{child:(g="")=>{var w,v;return g=g.trim(),g=g.replace(/\/\//g,"/"),g.charAt(g.length-1)==="/"&&(g=g.slice(0,-1)),g.charAt(0)!=="/"&&(g="/"+g),(v=(w=A.local())==null?void 0:w.database())==null?void 0:v.ref(m+g)},push:(...g)=>{var v,E;let w=lr();return!g.length>0?{getKey:()=>w}:(E=(v=A.local())==null?void 0:v.database())==null?void 0:E.ref(m+"/"+w).create(g)},create:(...g)=>{var T,O;let w=U(U({},(O=(T=A.local(x))==null?void 0:T.database())==null?void 0:O.ref(m)),A),{data:v,callback:E}=y(g);return _(x,"create",S,v,w)},get:(...g)=>{var T,O;let w=U(U({},(O=(T=A.local())==null?void 0:T.database())==null?void 0:O.ref(m)),A),{data:v,callback:E}=y(g);return _("get",S,v,w,E)},find:(...g)=>{var T,O;let w=U(U({},(O=(T=A.local())==null?void 0:T.database())==null?void 0:O.ref(m)),A),{data:v,callback:E}=y(g);return _("get",S,v,w,E)},query:()=>{},update:(...g)=>{var T,O;let w=U(U({},(O=(T=A.local())==null?void 0:T.database())==null?void 0:O.ref(m)),A),{data:v,callback:E}=y(g);return _("update",S,v,w,E)},delete:(...g)=>{var T,O;let w=U(U({},(O=(T=A.local())==null?void 0:T.database())==null?void 0:O.ref(m)),A),{data:v,callback:E}=y(g);return _("delete",S,v,w,E)},on:()=>{var w,v;let g=U(U({},(v=(w=A.local())==null?void 0:w.database())==null?void 0:v.ref(m)),A);return f(m,g)},onValue:g=>{var E,T,O,R,C,I,D;let w=U(U({},(T=(E=A.local())==null?void 0:E.database())==null?void 0:T.ref(m)),A),v=(R=(O=A.local())==null?void 0:O.database())==null?void 0:R.ref(m);return(C=v==null?void 0:v.on())==null||C.create(g),(I=v==null?void 0:v.on())==null||I.update(g),(D=v==null?void 0:v.on())==null||D.delete(g),w}}}}),cache:(S="/cache")=>{var A;let m=this.init(e);return delete m.auth().login,delete m.auth().register,(A=m.local())==null?void 0:A.database(S)},storage:()=>({})}},database:()=>{var k,S,m;const x=this.init(e);return delete x.database,delete x.auth().register,delete x.auth().login,(k=e==null?void 0:e.socket)==null||k.database.on("connect",()=>{Je(this,Te,!0),s()}),(S=e==null?void 0:e.socket)==null||S.database.on("disconnect",()=>{Je(this,Te,!1)}),L(x,{host:n.DATABASE,version:i.DATABASE,base:gs.base},(m=e==null?void 0:e.socket)==null?void 0:m.database)},cron:x=>{},task:x=>{},$online:navigator==null?void 0:navigator.onLine,auth:()=>({req:(x,k,S)=>{let m=this.init(e);delete m.auth().login,delete m.auth().register;let A=U(U({},m),m.auth());return d(x+wr.req,k,null,A,S)}}),syncDatabase:(x=!0)=>{const k=this.init(e);return Je(this,Ye,typeof x=="boolean"?x:!0),k.database()},ref:(x="",k={host:n.DATABASE,version:i.DATABASE,base:gs.base},S=(A=>(A=e==null?void 0:e.socket)==null?void 0:A.database)(),m=!0)=>{x=x.trim(),x=x.replace(/\/\//g,"/"),x.charAt(0)==="/"&&x.length<=1&&(x="/root"),x.charAt(x.length-1)==="/"&&(x=x.slice(0,-1));const g=k.host+k.version+k.base+x;let w=this.init(e);return delete w.auth().login,delete w.auth().register,Je(this,vt,m),{push:(...v)=>{let E=lr();return!v.length>0?{getKey:()=>E}:w.ref(x+"/"+E,k,S).create(v)},private:(v=b())=>w.ref(x+"/ps"+v+"/pe",k,S),setAuthAccess:(v=!0,E=Y(this,_t))=>(Je(this,_t,E),w.ref(x,k,S,v)),req:(...v)=>{let E=U(U({},w.ref(x,k,S)),w);if(v.length>=2){let[T="post",O={},R={},C]=v;if(typeof T=="string"&&["post","put","delete","get"].includes(T)){let I=Ve.req;return h(T,g+I,O,R,E,C)}return E}else{let T=v.filter(O=>typeof O=="function");if(T.length>0)T=T[0],typeof T=="function"&&T(E);else return E}},child:(v="")=>(v=v.trim(),v=v.replace(/\/\//g,"/"),v.charAt(v.length-1)==="/"&&(v=v.slice(0,-1)),v.charAt(0)!=="/"&&(v="/"+v),w.ref(x+v,k,S)),set:(...v)=>{var E;return(E=w.ref(x,k,S))==null?void 0:E.create(...v)},create:(...v)=>{var T,O,R;let E=U(U({},w.ref(x,k,S)),w);if(w.auth().$currentUserId&&(k==null?void 0:k.host)===(n==null?void 0:n.DATABASE)&&Y(this,Ye)&&!Y(this,Te))return(R=(O=(T=w.local())==null?void 0:T.database())==null?void 0:O.ref(x))==null?void 0:R.create(...v);{let{data:C,onRequest:I,callback:D}=y(v),V=Ve.create.one;return Array!=null&&Array.isArray(C)&&(V=Ve.create.many),h("post",g+V,C,I,E,D)}},find:(...v)=>{var E,T,O,R;if(console.log("Database connected: ",Y(this,Te)),w.auth().$currentUserId&&(k==null?void 0:k.host)===(n==null?void 0:n.DATABASE)&&Y(this,Ye)&&!Y(this,Te))return(O=(T=(E=w.local())==null?void 0:E.database())==null?void 0:T.ref(x))==null?void 0:O.find(...v);{let C=U(U({},w.ref(x,k,S)),w),{data:I,onRequest:D,callback:V}=y(v),H=Ve.find.one;return(((R=Object.keys(I))==null?void 0:R.length)<=0||I.order||I.where||I.$option||I.skip||I.take)&&(H=Ve.find.many),h("post",g+H,I,D,C,V)}},get:(...v)=>{var E,T,O,R;if(w.auth().$currentUserId&&(k==null?void 0:k.host)===(n==null?void 0:n.DATABASE)&&Y(this,Ye)&&!Y(this,Te))return(O=(T=(E=w.local())==null?void 0:E.database())==null?void 0:T.ref(x))==null?void 0:O.get(...v);{let C=U(U({},w.ref(x,k,S)),w),{data:I,onRequest:D,callback:V}=y(v),H=Ve.get.one;return(((R=Object.keys(I))==null?void 0:R.length)<=0||I.order||I.where||I.$option||I.skip||I.take)&&(H=Ve.get.many),h("get",g+H+"?query="+JSON.stringify(o(I)),null,D,C,V)}},query:(...v)=>{var E,T,O;if(w.auth().$currentUserId&&(k==null?void 0:k.host)===(n==null?void 0:n.DATABASE)&&Y(this,Ye)&&!Y(this,Te))return(O=(T=(E=w.local())==null?void 0:E.database())==null?void 0:T.ref(x))==null?void 0:O.query(...v);{let R=U(U({},w.ref(x,k,S)),w),{data:C,onRequest:I,callback:D}=y(v);return(!C||C==="")&&(C={take:15},!Y(this,Ut)&&!C.order&&(C.order={uid:"ASC"})),h("get",g+Ve.get.many+"?query="+JSON.stringify(o(C)),null,I,R,D)}},update:(...v)=>{var E,T,O;if(w.auth().$currentUserId&&(k==null?void 0:k.host)===(n==null?void 0:n.DATABASE)&&Y(this,Ye)&&!Y(this,Te))return(O=(T=(E=w.local())==null?void 0:E.database())==null?void 0:T.ref(x))==null?void 0:O.update(...v);{let R=U(U({},w.ref(x,k,S)),w),{data:C,onRequest:I,callback:D}=y(v),V=Ve.update.one;return Array.isArray(C)&&(V=Ve.find.many),h("put",g+V,C,I,R,D)}},delete:(...v)=>{var E,T,O;if(w.auth().$currentUserId&&(k==null?void 0:k.host)===(n==null?void 0:n.DATABASE)&&Y(this,Ye)&&!Y(this,Te))return(O=(T=(E=w.local())==null?void 0:E.database())==null?void 0:T.ref(x))==null?void 0:O.delete(...v);{let R=U(U({},w.ref(x,k,S)),w),{data:C,onRequest:I,callback:D}=y(v),V=Ve.delete.one;return(Array.isArray(C)||C.where)&&(V=Ve.delete.many),h("delete",g+V,C,I,R,D)}},on:()=>{let v=U(U({},w.ref(x,k,S)),w);return l(S,k,v,x)},onValue:v=>{var O,R,C;let E=U(U({},w.ref(x,k,S)),w),T=w.ref(x,k,S);return(O=T==null?void 0:T.on())==null||O.create(v),(R=T==null?void 0:T.on())==null||R.update(v),(C=T==null?void 0:T.on())==null||C.delete(v),E}}}}});Je(this,St,e);let{ENV:t,OFFLINE_DB_NAME:n}=Y(this,St);Je(this,Pe,an.WithIndexedDB((n==null?void 0:n.DATABASE)||"swyger_database"));let i=()=>P(this,null,function*(){try{let s,o=localStorage.getItem("accessToken");if((()=>{var c;try{s=JSON.parse(localStorage.getItem("userInfo")?localStorage.getItem("userInfo"):"{}");let u=Rc(o);return(Date==null?void 0:Date.parse((c=new Date((u==null?void 0:u.exp)*1e3))==null?void 0:c.toString()))<Date.now()}catch(u){return!1}})()&&s.uid)try{t==="dev"&&console.log("Token expired on inactivity, Trying to request a new refresh token")}catch(c){}}catch(s){}});"requestIdleCallback"in window&&requestIdleCallback(i)}}Dt=new WeakMap,vt=new WeakMap,_t=new WeakMap,Ut=new WeakMap,rn=new WeakMap,Ye=new WeakMap,Te=new WeakMap,St=new WeakMap,Pe=new WeakMap;const vf={init:r=>{try{return(e={})=>new gf(r).init(e)}catch(e){return{}}}};let wf={init:r=>{var e,t,n,i,s;return{OFFLINE_DB_NAME:{DATABASE:((e=r==null?void 0:r.OFFLINE_DB_NAME)==null?void 0:e.DATABASE)||"swyger_database"},ENV:(r==null?void 0:r.ENV)||"prod",HOST_SERVER:{AUTH:((t=r==null?void 0:r.HOST_SERVER)==null?void 0:t.AUTH)||"http://localhost:4100",DATABASE:((n=r==null?void 0:r.HOST_SERVER)==null?void 0:n.DATABASE)||"http://localhost:4400"},API_VERSION:{AUTH:((i=r==null?void 0:r.API_VERSION)==null?void 0:i.AUTH)||"/api/v1",DATABASE:((s=r==null?void 0:r.API_VERSION)==null?void 0:s.DATABASE)||"/api/v1"},AUTO_REFRESH_TOKEN_TIMEOUT:(r==null?void 0:r.AUTO_REFRESH_TOKEN_TIMEOUT)||15e5,API_KEY:(r==null?void 0:r.API_KEY)||"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzd3lnZXIuY29tIiwiaWF0IjoxNjUzNDQwOTkxLCJleHAiOjE2ODQ5NzY5OTEsImF1ZCI6ImRheW52ZXIuY29tIiwic3ViIjoidGVhbUBzd3lnZXIuY29tIiwiR2l2ZW5OYW1lIjoiSXZhbiBKb2VsIiwiU3VybmFtZSI6IlNvYmd1aSIsIkVtYWlsIjoidGVhbUBhZ2dsb215LmNvbSIsIlJvbGUiOlsiQWRtaW4iLCJQcm9qZWN0IEFkbWluaXN0cmF0b3IiXX0.UvlcjBahR9G8dKxIeENJ7k4I87t3_oNJQ16eyPsRcSE"}}};const bp={init:r=>{let e=wf.init(r);const t=Pc.init(e),n={socket:{database:t==null?void 0:t.database}};return vf.init(e)(n)}};var Ur=function(r,e){return Ur=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},Ur(r,e)};function we(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ur(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function bf(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(f){o(f)}}function c(l){try{u(n.throw(l))}catch(f){o(f)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(r,e||[])).next())})}function ui(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Be(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ue(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function le(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))}function Lt(r){return this instanceof Lt?(this.v=r,this):new Lt(r)}function xf(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(p){n[p]&&(i[p]=function(d){return new Promise(function(h,y){s.push([p,d,h,y])>1||a(p,d)})})}function a(p,d){try{c(n[p](d))}catch(h){f(s[0][3],h)}}function c(p){p.value instanceof Lt?Promise.resolve(p.value.v).then(u,l):f(s[0][2],p)}function u(p){a("next",p)}function l(p){a("throw",p)}function f(p,d){p(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Ef(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Be=="function"?Be(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=r[s]&&function(o){return new Promise(function(a,c){o=r[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function X(r){return typeof r=="function"}function Pt(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Tn=Pt(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function ut(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var Le=function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Be(o),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(y){e={error:y}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(X(l))try{l()}catch(y){s=y instanceof Tn?y.errors:[y]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var p=Be(f),d=p.next();!d.done;d=p.next()){var h=d.value;try{vs(h)}catch(y){s=s!=null?s:[],y instanceof Tn?s=le(le([],ue(s)),ue(y.errors)):s.push(y)}}}catch(y){n={error:y}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}if(s)throw new Tn(s)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)vs(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ut(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&ut(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=function(){var e=new r;return e.closed=!0,e}(),r}(),Ro=Le.EMPTY;function No(r){return r instanceof Le||r&&"closed"in r&&X(r.remove)&&X(r.add)&&X(r.unsubscribe)}function vs(r){X(r)?r():r.unsubscribe()}var xt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},jn={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=jn.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,le([r,e],ue(t))):setTimeout.apply(void 0,le([r,e],ue(t)))},clearTimeout:function(r){var e=jn.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(r)},delegate:void 0};function Co(r){jn.setTimeout(function(){var e=xt.onUnhandledError;if(e)e(r);else throw r})}function ve(){}var kf=function(){return li("C",void 0,void 0)}();function Af(r){return li("E",void 0,r)}function _f(r){return li("N",r,void 0)}function li(r,e,t){return{kind:r,value:e,error:t}}var At=null;function Pn(r){if(xt.useDeprecatedSynchronousErrorHandling){var e=!At;if(e&&(At={errorThrown:!1,error:null}),r(),e){var t=At,n=t.errorThrown,i=t.error;if(At=null,n)throw i}}else r()}function Sf(r){xt.useDeprecatedSynchronousErrorHandling&&At&&(At.errorThrown=!0,At.error=r)}var Jn=function(r){we(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,No(t)&&t.add(n)):n.destination=If,n}return e.create=function(t,n,i){return new Kt(t,n,i)},e.prototype.next=function(t){this.isStopped?xr(_f(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?xr(Af(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?xr(kf,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Le),Of=Function.prototype.bind;function br(r,e){return Of.call(r,e)}var Tf=function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){vn(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){vn(n)}else vn(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){vn(t)}},r}(),Kt=function(r){we(e,r);function e(t,n,i){var s=r.call(this)||this,o;if(X(t)||!t)o={next:t!=null?t:void 0,error:n!=null?n:void 0,complete:i!=null?i:void 0};else{var a;s&&xt.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&br(t.next,a),error:t.error&&br(t.error,a),complete:t.complete&&br(t.complete,a)}):o=t}return s.destination=new Tf(o),s}return e}(Jn);function vn(r){xt.useDeprecatedSynchronousErrorHandling?Sf(r):Co(r)}function Pf(r){throw r}function xr(r,e){var t=xt.onStoppedNotification;t&&jn.setTimeout(function(){return t(r,e)})}var If={closed:!0,next:ve,error:Pf,complete:ve},Yn=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function _e(r){return r}function fi(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return $o(r)}function $o(r){return r.length===0?_e:r.length===1?r[0]:function(t){return r.reduce(function(n,i){return i(n)},t)}}var te=function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var i=this,s=Nf(e)?e:new Kt(e,t,n);return Pn(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=ws(t),new t(function(i,s){var o=new Kt({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});n.subscribe(o)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[Yn]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $o(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=ws(e),new e(function(n,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},r.create=function(e){return new r(e)},r}();function ws(r){var e;return(e=r!=null?r:xt.Promise)!==null&&e!==void 0?e:Promise}function Rf(r){return r&&X(r.next)&&X(r.error)&&X(r.complete)}function Nf(r){return r&&r instanceof Jn||Rf(r)&&No(r)}function Bo(r){return X(r==null?void 0:r.lift)}function z(r){return function(e){if(Bo(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function q(r,e,t,n,i){return new hi(r,e,t,n,i)}var hi=function(r){we(e,r);function e(t,n,i,s,o,a){var c=r.call(this,t)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=n?function(u){try{n(u)}catch(l){t.error(l)}}:r.prototype._next,c._error=s?function(u){try{s(u)}catch(l){t.error(l)}finally{this.unsubscribe()}}:r.prototype._error,c._complete=i?function(){try{i()}catch(u){t.error(u)}finally{this.unsubscribe()}}:r.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;r.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(Jn);function jo(){return z(function(r,e){var t=null;r._refCount++;var n=q(e,void 0,void 0,void 0,function(){if(!r||r._refCount<=0||0<--r._refCount){t=null;return}var i=r._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});r.subscribe(n),n.closed||(t=r.connect())})}var Gn=function(r){we(e,r);function e(t,n){var i=r.call(this)||this;return i.source=t,i.subjectFactory=n,i._subject=null,i._refCount=0,i._connection=null,Bo(t)&&(i.lift=t.lift),i}return e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject},e.prototype._teardown=function(){this._refCount=0;var t=this._connection;this._subject=this._connection=null,t==null||t.unsubscribe()},e.prototype.connect=function(){var t=this,n=this._connection;if(!n){n=this._connection=new Le;var i=this.getSubject();n.add(this.source.subscribe(q(i,void 0,function(){t._teardown(),i.complete()},function(s){t._teardown(),i.error(s)},function(){return t._teardown()}))),n.closed&&(this._connection=null,n=Le.EMPTY)}return n},e.prototype.refCount=function(){return jo()(this)},e}(te),Lo={now:function(){return(Lo.delegate||performance).now()},delegate:void 0},Ot={schedule:function(r){var e=requestAnimationFrame,t=cancelAnimationFrame,n=Ot.delegate;n&&(e=n.requestAnimationFrame,t=n.cancelAnimationFrame);var i=e(function(s){t=void 0,r(s)});return new Le(function(){return t==null?void 0:t(i)})},requestAnimationFrame:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Ot.delegate;return((t==null?void 0:t.requestAnimationFrame)||requestAnimationFrame).apply(void 0,le([],ue(r)))},cancelAnimationFrame:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Ot.delegate;return((t==null?void 0:t.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,le([],ue(r)))},delegate:void 0};function Cf(r){return r?Do(r):$f}function Do(r){return new te(function(e){var t=r||Lo,n=t.now(),i=0,s=function(){e.closed||(i=Ot.requestAnimationFrame(function(o){i=0;var a=t.now();e.next({timestamp:r?a:o,elapsed:a-n}),s()}))};return s(),function(){i&&Ot.cancelAnimationFrame(i)}})}var $f=Do(),Uo=Pt(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),xe=function(r){we(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new bs(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new Uo},e.prototype.next=function(t){var n=this;Pn(function(){var i,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var o=Be(n.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(t)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var n=this;Pn(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var i=n.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;Pn(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?Ro:(this.currentObservers=null,a.push(t),new Le(function(){n.currentObservers=null,ut(a,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,s=n.thrownError,o=n.isStopped;i?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new te;return t.source=this,t},e.create=function(t,n){return new bs(t,n)},e}(te),bs=function(r){we(e,r);function e(t,n){var i=r.call(this)||this;return i.destination=t,i.source=n,i}return e.prototype.next=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,t)},e.prototype.error=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&i!==void 0?i:Ro},e}(xe),Fo=function(r){we(e,r);function e(t){var n=r.call(this)||this;return n._value=t,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var n=r.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},e.prototype.getValue=function(){var t=this,n=t.hasError,i=t.thrownError,s=t._value;if(n)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){r.prototype.next.call(this,this._value=t)},e}(xe),Qn={now:function(){return(Qn.delegate||Date).now()},delegate:void 0},di=function(r){we(e,r);function e(t,n,i){t===void 0&&(t=1/0),n===void 0&&(n=1/0),i===void 0&&(i=Qn);var s=r.call(this)||this;return s._bufferSize=t,s._windowTime=n,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,t),s._windowTime=Math.max(1,n),s}return e.prototype.next=function(t){var n=this,i=n.isStopped,s=n._buffer,o=n._infiniteTimeWindow,a=n._timestampProvider,c=n._windowTime;i||(s.push(t),!o&&s.push(a.now()+c)),this._trimBuffer(),r.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(t),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!t.closed;c+=s?1:2)t.next(a[c]);return this._checkFinalizedStatuses(t),n},e.prototype._trimBuffer=function(){var t=this,n=t._bufferSize,i=t._timestampProvider,s=t._buffer,o=t._infiniteTimeWindow,a=(o?1:2)*n;if(n<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),u=0,l=1;l<s.length&&s[l]<=c;l+=2)u=l;u&&s.splice(0,u+1)}},e}(xe),pi=function(r){we(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,s=n._hasValue,o=n._value,a=n.thrownError,c=n.isStopped,u=n._isComplete;i?t.error(a):(c||u)&&(s&&t.next(o),t.complete())},e.prototype.next=function(t){this.isStopped||(this._value=t,this._hasValue=!0)},e.prototype.complete=function(){var t=this,n=t._hasValue,i=t._value,s=t._isComplete;s||(this._isComplete=!0,n&&r.prototype.next.call(this,i),r.prototype.complete.call(this))},e}(xe),Bf=function(r){we(e,r);function e(t,n){return r.call(this)||this}return e.prototype.schedule=function(t,n){return this},e}(Le),Ln={setInterval:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=Ln.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,le([r,e],ue(t))):setInterval.apply(void 0,le([r,e],ue(t)))},clearInterval:function(r){var e=Ln.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(r)},delegate:void 0},cn=function(r){we(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.pending=!1,i}return e.prototype.schedule=function(t,n){var i;if(n===void 0&&(n=0),this.closed)return this;this.state=t;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,n)),this.pending=!0,this.delay=n,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,n),this},e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),Ln.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,n,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return n;n!=null&&Ln.clearInterval(n)},e.prototype.execute=function(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,n){var i=!1,s;try{this.work(t)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,n=t.id,i=t.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ut(s,this),n!=null&&(this.id=this.recycleAsyncId(i,n,null)),this.delay=null,r.prototype.unsubscribe.call(this)}},e}(Bf),jf=1,Er,Fr={};function xs(r){return r in Fr?(delete Fr[r],!0):!1}var Mo={setImmediate:function(r){var e=jf++;return Fr[e]=!0,Er||(Er=Promise.resolve()),Er.then(function(){return xs(e)&&r()}),e},clearImmediate:function(r){xs(r)}},Lf=Mo.setImmediate,Df=Mo.clearImmediate,Dn={setImmediate:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=Dn.delegate;return((t==null?void 0:t.setImmediate)||Lf).apply(void 0,le([],ue(r)))},clearImmediate:function(r){var e=Dn.delegate;return((e==null?void 0:e.clearImmediate)||Df)(r)},delegate:void 0},Uf=function(r){we(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!==null&&i>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=Dn.setImmediate(t.flush.bind(t,void 0))))},e.prototype.recycleAsyncId=function(t,n,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return r.prototype.recycleAsyncId.call(this,t,n,i);var o=t.actions;n!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==n&&(Dn.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))},e}(cn),Mr=function(){function r(e,t){t===void 0&&(t=r.now),this.schedulerActionCtor=e,this.now=t}return r.prototype.schedule=function(e,t,n){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},r.now=Qn.now,r}(),un=function(r){we(e,r);function e(t,n){n===void 0&&(n=Mr.now);var i=r.call(this,t,n)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(t){var n=this.actions;if(this._active){n.push(t);return}var i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=n.shift());if(this._active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}},e}(Mr),Ff=function(r){we(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var n=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw s}},e}(un),Ko=new Ff(Uf),Mf=Ko,He=new un(cn),yi=He,Kf=function(r){we(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.schedule=function(t,n){return n===void 0&&(n=0),n>0?r.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},e.prototype.execute=function(t,n){return n>0||this.closed?r.prototype.execute.call(this,t,n):this._execute(t,n)},e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!=null&&i>0||i==null&&this.delay>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.flush(this),0)},e}(cn),Vf=function(r){we(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(un),Vo=new Vf(Kf),qf=Vo,zf=function(r){we(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.scheduler=t,i.work=n,i}return e.prototype.requestAsyncId=function(t,n,i){return i===void 0&&(i=0),i!==null&&i>0?r.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=Ot.requestAnimationFrame(function(){return t.flush(void 0)})))},e.prototype.recycleAsyncId=function(t,n,i){var s;if(i===void 0&&(i=0),i!=null?i>0:this.delay>0)return r.prototype.recycleAsyncId.call(this,t,n,i);var o=t.actions;n!=null&&((s=o[o.length-1])===null||s===void 0?void 0:s.id)!==n&&(Ot.cancelAnimationFrame(n),t._scheduled=void 0)},e}(cn),Wf=function(r){we(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.flush=function(t){this._active=!0;var n=this._scheduled;this._scheduled=void 0;var i=this.actions,s;t=t||i.shift();do if(s=t.execute(t.state,t.delay))break;while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,s){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw s}},e}(un),qo=new Wf(zf),Hf=qo,Jf=function(r){we(e,r);function e(t,n){t===void 0&&(t=zo),n===void 0&&(n=1/0);var i=r.call(this,t,function(){return i.frame})||this;return i.maxFrames=n,i.frame=0,i.index=-1,i}return e.prototype.flush=function(){for(var t=this,n=t.actions,i=t.maxFrames,s,o;(o=n[0])&&o.delay<=i&&(n.shift(),this.frame=o.delay,!(s=o.execute(o.state,o.delay))););if(s){for(;o=n.shift();)o.unsubscribe();throw s}},e.frameTimeFactor=10,e}(un),zo=function(r){we(e,r);function e(t,n,i){i===void 0&&(i=t.index+=1);var s=r.call(this,t,n)||this;return s.scheduler=t,s.work=n,s.index=i,s.active=!0,s.index=t.index=i,s}return e.prototype.schedule=function(t,n){if(n===void 0&&(n=0),Number.isFinite(n)){if(!this.id)return r.prototype.schedule.call(this,t,n);this.active=!1;var i=new e(this.scheduler,this.work);return this.add(i),i.schedule(t,n)}else return Le.EMPTY},e.prototype.requestAsyncId=function(t,n,i){i===void 0&&(i=0),this.delay=t.frame+i;var s=t.actions;return s.push(this),s.sort(e.sortActions),1},e.prototype.recycleAsyncId=function(t,n,i){},e.prototype._execute=function(t,n){if(this.active===!0)return r.prototype._execute.call(this,t,n)},e.sortActions=function(t,n){return t.delay===n.delay?t.index===n.index?0:t.index>n.index?1:-1:t.delay>n.delay?1:-1},e}(cn),st=new te(function(r){return r.complete()});function Yf(r){return r?Gf(r):st}function Gf(r){return new te(function(e){return r.schedule(function(){return e.complete()})})}function Xn(r){return r&&X(r.schedule)}function mi(r){return r[r.length-1]}function ln(r){return X(mi(r))?r.pop():void 0}function lt(r){return Xn(mi(r))?r.pop():void 0}function Wo(r,e){return typeof mi(r)=="number"?r.pop():e}var gi=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function Ho(r){return X(r==null?void 0:r.then)}function Jo(r){return X(r[Yn])}function Yo(r){return Symbol.asyncIterator&&X(r==null?void 0:r[Symbol.asyncIterator])}function Go(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Qf(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Qo=Qf();function Xo(r){return X(r==null?void 0:r[Qo])}function Zo(r){return xf(this,arguments,function(){var t,n,i,s;return ui(this,function(o){switch(o.label){case 0:t=r.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Lt(t.read())];case 3:return n=o.sent(),i=n.value,s=n.done,s?[4,Lt(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Lt(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function ea(r){return X(r==null?void 0:r.getReader)}function J(r){if(r instanceof te)return r;if(r!=null){if(Jo(r))return Xf(r);if(gi(r))return Zf(r);if(Ho(r))return eh(r);if(Yo(r))return ta(r);if(Xo(r))return th(r);if(ea(r))return nh(r)}throw Go(r)}function Xf(r){return new te(function(e){var t=r[Yn]();if(X(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Zf(r){return new te(function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}function eh(r){return new te(function(e){r.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Co)})}function th(r){return new te(function(e){var t,n;try{for(var i=Be(r),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){t={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()})}function ta(r){return new te(function(e){rh(r,e).catch(function(t){return e.error(t)})})}function nh(r){return ta(Zo(r))}function rh(r,e){var t,n,i,s;return bf(this,void 0,void 0,function(){var o,a;return ui(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=Ef(r),c.label=1;case 1:return[4,t.next()];case 2:if(n=c.sent(),!!n.done)return[3,4];if(o=n.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(s=t.return)?[4,s.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function je(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var s=e.schedule(function(){t(),i?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(s),!i)return s}function Zn(r,e){return e===void 0&&(e=0),z(function(t,n){t.subscribe(q(n,function(i){return je(n,r,function(){return n.next(i)},e)},function(){return je(n,r,function(){return n.complete()},e)},function(i){return je(n,r,function(){return n.error(i)},e)}))})}function er(r,e){return e===void 0&&(e=0),z(function(t,n){n.add(r.schedule(function(){return t.subscribe(n)},e))})}function ih(r,e){return J(r).pipe(er(e),Zn(e))}function sh(r,e){return J(r).pipe(er(e),Zn(e))}function oh(r,e){return new te(function(t){var n=0;return e.schedule(function(){n===r.length?t.complete():(t.next(r[n++]),t.closed||this.schedule())})})}function na(r,e){return new te(function(t){var n;return je(t,e,function(){n=r[Qo](),je(t,e,function(){var i,s,o;try{i=n.next(),s=i.value,o=i.done}catch(a){t.error(a);return}o?t.complete():t.next(s)},0,!0)}),function(){return X(n==null?void 0:n.return)&&n.return()}})}function ra(r,e){if(!r)throw new Error("Iterable cannot be null");return new te(function(t){je(t,e,function(){var n=r[Symbol.asyncIterator]();je(t,e,function(){n.next().then(function(i){i.done?t.complete():t.next(i.value)})},0,!0)})})}function ah(r,e){return ra(Zo(r),e)}function ia(r,e){if(r!=null){if(Jo(r))return ih(r,e);if(gi(r))return oh(r,e);if(Ho(r))return sh(r,e);if(Yo(r))return ra(r,e);if(Xo(r))return na(r,e);if(ea(r))return ah(r,e)}throw Go(r)}function ft(r,e){return e?ia(r,e):J(r)}function vi(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=lt(r);return ft(r,t)}function sa(r,e){var t=X(r)?r:function(){return r},n=function(i){return i.error(t())};return new te(e?function(i){return e.schedule(n,0,i)}:n)}var Kr;(function(r){r.NEXT="N",r.ERROR="E",r.COMPLETE="C"})(Kr||(Kr={}));var In=function(){function r(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue=e==="N"}return r.prototype.observe=function(e){return oa(this,e)},r.prototype.do=function(e,t,n){var i=this,s=i.kind,o=i.value,a=i.error;return s==="N"?e==null?void 0:e(o):s==="E"?t==null?void 0:t(a):n==null?void 0:n()},r.prototype.accept=function(e,t,n){var i;return X((i=e)===null||i===void 0?void 0:i.next)?this.observe(e):this.do(e,t,n)},r.prototype.toObservable=function(){var e=this,t=e.kind,n=e.value,i=e.error,s=t==="N"?vi(n):t==="E"?sa(function(){return i}):t==="C"?st:0;if(!s)throw new TypeError("Unexpected notification kind "+t);return s},r.createNext=function(e){return new r("N",e)},r.createError=function(e){return new r("E",void 0,e)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r}();function oa(r,e){var t,n,i,s=r,o=s.kind,a=s.value,c=s.error;if(typeof o!="string")throw new TypeError('Invalid notification, missing "kind"');o==="N"?(t=e.next)===null||t===void 0||t.call(e,a):o==="E"?(n=e.error)===null||n===void 0||n.call(e,c):(i=e.complete)===null||i===void 0||i.call(e)}function ch(r){return!!r&&(r instanceof te||X(r.lift)&&X(r.subscribe))}var It=Pt(function(r){return function(){r(this),this.name="EmptyError",this.message="no elements in sequence"}});function uh(r,e){var t=typeof e=="object";return new Promise(function(n,i){var s=!1,o;r.subscribe({next:function(a){o=a,s=!0},error:i,complete:function(){s?n(o):t?n(e.defaultValue):i(new It)}})})}function lh(r,e){var t=typeof e=="object";return new Promise(function(n,i){var s=new Kt({next:function(o){n(o),s.unsubscribe()},error:i,complete:function(){t?n(e.defaultValue):i(new It)}});r.subscribe(s)})}var Vr=Pt(function(r){return function(){r(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}),aa=Pt(function(r){return function(t){r(this),this.name="NotFoundError",this.message=t}}),ca=Pt(function(r){return function(t){r(this),this.name="SequenceError",this.message=t}});function wi(r){return r instanceof Date&&!isNaN(r)}var ua=Pt(function(r){return function(t){t===void 0&&(t=null),r(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function la(r,e){var t=wi(r)?{first:r}:typeof r=="number"?{each:r}:r,n=t.first,i=t.each,s=t.with,o=s===void 0?fh:s,a=t.scheduler,c=a===void 0?e!=null?e:He:a,u=t.meta,l=u===void 0?null:u;if(n==null&&i==null)throw new TypeError("No timeout provided.");return z(function(f,p){var d,h,y=null,b=0,_=function(j){h=je(p,c,function(){try{d.unsubscribe(),J(o({meta:l,lastValue:y,seen:b})).subscribe(p)}catch($){p.error($)}},j)};d=f.subscribe(q(p,function(j){h==null||h.unsubscribe(),b++,p.next(y=j),i>0&&_(i)},void 0,void 0,function(){h!=null&&h.closed||h==null||h.unsubscribe(),y=null})),!b&&_(n!=null?typeof n=="number"?n:+n-c.now():i)})}function fh(r){throw new ua(r)}function Rt(r,e){return z(function(t,n){var i=0;t.subscribe(q(n,function(s){n.next(r.call(e,s,i++))}))})}var hh=Array.isArray;function dh(r,e){return hh(e)?r.apply(void 0,le([],ue(e))):r(e)}function Nt(r){return Rt(function(e){return dh(r,e)})}function Un(r,e,t,n){if(t)if(Xn(t))n=t;else return function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return Un(r,e,n).apply(this,i).pipe(Nt(t))};return n?function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return Un(r,e).apply(this,i).pipe(er(n),Zn(n))}:function(){for(var i=this,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=new pi,c=!0;return new te(function(u){var l=a.subscribe(u);if(c){c=!1;var f=!1,p=!1;e.apply(i,le(le([],ue(s)),[function(){for(var d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];if(r){var y=d.shift();if(y!=null){a.error(y);return}}a.next(1<d.length?d:d[0]),p=!0,f&&a.complete()}])),p&&a.complete(),f=!0}return l})}}function ph(r,e,t){return Un(!1,r,e,t)}function yh(r,e,t){return Un(!0,r,e,t)}var mh=Array.isArray,gh=Object.getPrototypeOf,vh=Object.prototype,wh=Object.keys;function fa(r){if(r.length===1){var e=r[0];if(mh(e))return{args:e,keys:null};if(bh(e)){var t=wh(e);return{args:t.map(function(n){return e[n]}),keys:t}}}return{args:r,keys:null}}function bh(r){return r&&typeof r=="object"&&gh(r)===vh}function ha(r,e){return r.reduce(function(t,n,i){return t[n]=e[i],t},{})}function da(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=lt(r),n=ln(r),i=fa(r),s=i.args,o=i.keys;if(s.length===0)return ft([],t);var a=new te(pa(s,t,o?function(c){return ha(o,c)}:_e));return n?a.pipe(Nt(n)):a}function pa(r,e,t){return t===void 0&&(t=_e),function(n){Es(e,function(){for(var i=r.length,s=new Array(i),o=i,a=i,c=function(l){Es(e,function(){var f=ft(r[l],e),p=!1;f.subscribe(q(n,function(d){s[l]=d,p||(p=!0,a--),a||n.next(t(s.slice()))},function(){--o||n.complete()}))},n)},u=0;u<i;u++)c(u)},n)}}function Es(r,e,t){r?je(t,r,e):e()}function bi(r,e,t,n,i,s,o,a){var c=[],u=0,l=0,f=!1,p=function(){f&&!c.length&&!u&&e.complete()},d=function(y){return u<n?h(y):c.push(y)},h=function(y){s&&e.next(y),u++;var b=!1;J(t(y,l++)).subscribe(q(e,function(_){i==null||i(_),s?d(_):e.next(_)},function(){b=!0},void 0,function(){if(b)try{u--;for(var _=function(){var j=c.shift();o?je(e,o,function(){return h(j)}):h(j)};c.length&&u<n;)_();p()}catch(j){e.error(j)}}))};return r.subscribe(q(e,d,function(){f=!0,p()})),function(){a==null||a()}}function Ze(r,e,t){return t===void 0&&(t=1/0),X(e)?Ze(function(n,i){return Rt(function(s,o){return e(n,s,i,o)})(J(r(n,i)))},t):(typeof e=="number"&&(t=e),z(function(n,i){return bi(n,i,r,t)}))}function tr(r){return r===void 0&&(r=1/0),Ze(_e,r)}function xi(){return tr(1)}function en(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return xi()(ft(r,lt(r)))}function nr(r){return new te(function(e){J(r()).subscribe(e)})}var xh={connector:function(){return new xe},resetOnDisconnect:!0};function Eh(r,e){e===void 0&&(e=xh);var t=null,n=e.connector,i=e.resetOnDisconnect,s=i===void 0?!0:i,o=n(),a=new te(function(c){return o.subscribe(c)});return a.connect=function(){return(!t||t.closed)&&(t=nr(function(){return r}).subscribe(o),s&&t.add(function(){return o=n()})),t},a}function kh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=ln(r),n=fa(r),i=n.args,s=n.keys,o=new te(function(a){var c=i.length;if(!c){a.complete();return}for(var u=new Array(c),l=c,f=c,p=function(h){var y=!1;J(i[h]).subscribe(q(a,function(b){y||(y=!0,f--),u[h]=b},function(){return l--},void 0,function(){(!l||!y)&&(f||a.next(s?ha(s,u):u),a.complete())}))},d=0;d<c;d++)p(d)});return t?o.pipe(Nt(t)):o}var Ah=["addListener","removeListener"],_h=["addEventListener","removeEventListener"],Sh=["on","off"];function qr(r,e,t,n){if(X(t)&&(n=t,t=void 0),n)return qr(r,e,t).pipe(Nt(n));var i=ue(Ph(r)?_h.map(function(a){return function(c){return r[a](e,c,t)}}):Oh(r)?Ah.map(ks(r,e)):Th(r)?Sh.map(ks(r,e)):[],2),s=i[0],o=i[1];if(!s&&gi(r))return Ze(function(a){return qr(a,e,t)})(J(r));if(!s)throw new TypeError("Invalid event target");return new te(function(a){var c=function(){for(var u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];return a.next(1<u.length?u:u[0])};return s(c),function(){return o(c)}})}function ks(r,e){return function(t){return function(n){return r[t](e,n)}}}function Oh(r){return X(r.addListener)&&X(r.removeListener)}function Th(r){return X(r.on)&&X(r.off)}function Ph(r){return X(r.addEventListener)&&X(r.removeEventListener)}function ya(r,e,t){return t?ya(r,e).pipe(Nt(t)):new te(function(n){var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return n.next(o.length===1?o[0]:o)},s=r(i);return X(e)?function(){return e(i,s)}:void 0})}function Ih(r,e,t,n,i){var s,o,a,c;arguments.length===1?(s=r,c=s.initialState,e=s.condition,t=s.iterate,o=s.resultSelector,a=o===void 0?_e:o,i=s.scheduler):(c=r,!n||Xn(n)?(a=_e,i=n):a=n);function u(){var l;return ui(this,function(f){switch(f.label){case 0:l=c,f.label=1;case 1:return!e||e(l)?[4,a(l)]:[3,4];case 2:f.sent(),f.label=3;case 3:return l=t(l),[3,1];case 4:return[2]}})}return nr(i?function(){return na(u(),i)}:u)}function Rh(r,e,t){return nr(function(){return r()?e:t})}function Ct(r,e,t){r===void 0&&(r=0),t===void 0&&(t=yi);var n=-1;return e!=null&&(Xn(e)?t=e:n=e),new te(function(i){var s=wi(r)?+r-t.now():r;s<0&&(s=0);var o=0;return t.schedule(function(){i.closed||(i.next(o++),0<=n?this.schedule(void 0,n):i.complete())},s)})}function ma(r,e){return r===void 0&&(r=0),e===void 0&&(e=He),r<0&&(r=0),Ct(r,r,e)}function Nh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=lt(r),n=Wo(r,1/0),i=r;return i.length?i.length===1?J(i[0]):tr(n)(ft(i,t)):st}var ga=new te(ve);function Ch(){return ga}var $h=Array.isArray;function zt(r){return r.length===1&&$h(r[0])?r[0]:r}function va(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=zt(r);return new te(function(n){var i=0,s=function(){if(i<t.length){var o=void 0;try{o=J(t[i++])}catch(c){s();return}var a=new hi(n,void 0,ve,ve);o.subscribe(a),a.add(s)}else n.complete()};s()})}function Bh(r,e){return ft(Object.entries(r),e)}function jh(r,e){return function(t,n){return!r.call(e,t,n)}}function Tt(r,e){return z(function(t,n){var i=0;t.subscribe(q(n,function(s){return r.call(e,s,i++)&&n.next(s)}))})}function Lh(r,e,t){return[Tt(e,t)(J(r)),Tt(jh(e,t))(J(r))]}function Dh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r=zt(r),r.length===1?J(r[0]):new te(wa(r))}function wa(r){return function(e){for(var t=[],n=function(s){t.push(J(r[s]).subscribe(q(e,function(o){if(t){for(var a=0;a<t.length;a++)a!==s&&t[a].unsubscribe();t=null}e.next(o)})))},i=0;t&&!e.closed&&i<r.length;i++)n(i)}}function Uh(r,e,t){if(e==null&&(e=r,r=0),e<=0)return st;var n=e+r;return new te(t?function(i){var s=r;return t.schedule(function(){s<n?(i.next(s++),this.schedule()):i.complete()})}:function(i){for(var s=r;s<n&&!i.closed;)i.next(s++);i.complete()})}function Fh(r,e){return new te(function(t){var n=r(),i=e(n),s=i?J(i):st;return s.subscribe(t),function(){n&&n.unsubscribe()}})}function Ei(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=ln(r),n=zt(r);return n.length?new te(function(i){var s=n.map(function(){return[]}),o=n.map(function(){return!1});i.add(function(){s=o=null});for(var a=function(u){J(n[u]).subscribe(q(i,function(l){if(s[u].push(l),s.every(function(p){return p.length})){var f=s.map(function(p){return p.shift()});i.next(t?t.apply(void 0,le([],ue(f))):f),s.some(function(p,d){return!p.length&&o[d]})&&i.complete()}},function(){o[u]=!0,!s[u].length&&i.complete()}))},c=0;!i.closed&&c<n.length;c++)a(c);return function(){s=o=null}}):st}function ba(r){return z(function(e,t){var n=!1,i=null,s=null,o=!1,a=function(){if(s==null||s.unsubscribe(),s=null,n){n=!1;var u=i;i=null,t.next(u)}o&&t.complete()},c=function(){s=null,o&&t.complete()};e.subscribe(q(t,function(u){n=!0,i=u,s||J(r(u)).subscribe(s=q(t,a,c))},function(){o=!0,(!n||!s||s.closed)&&t.complete()}))})}function Mh(r,e){return e===void 0&&(e=He),ba(function(){return Ct(r,e)})}function Kh(r){return z(function(e,t){var n=[];return e.subscribe(q(t,function(i){return n.push(i)},function(){t.next(n),t.complete()})),J(r).subscribe(q(t,function(){var i=n;n=[],t.next(i)},ve)),function(){n=null}})}function Vh(r,e){return e===void 0&&(e=null),e=e!=null?e:r,z(function(t,n){var i=[],s=0;t.subscribe(q(n,function(o){var a,c,u,l,f=null;s++%e===0&&i.push([]);try{for(var p=Be(i),d=p.next();!d.done;d=p.next()){var h=d.value;h.push(o),r<=h.length&&(f=f!=null?f:[],f.push(h))}}catch(_){a={error:_}}finally{try{d&&!d.done&&(c=p.return)&&c.call(p)}finally{if(a)throw a.error}}if(f)try{for(var y=Be(f),b=y.next();!b.done;b=y.next()){var h=b.value;ut(i,h),n.next(h)}}catch(_){u={error:_}}finally{try{b&&!b.done&&(l=y.return)&&l.call(y)}finally{if(u)throw u.error}}},function(){var o,a;try{for(var c=Be(i),u=c.next();!u.done;u=c.next()){var l=u.value;n.next(l)}}catch(f){o={error:f}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}n.complete()},void 0,function(){i=null}))})}function qh(r){for(var e,t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=(e=lt(n))!==null&&e!==void 0?e:He,o=(t=n[0])!==null&&t!==void 0?t:null,a=n[1]||1/0;return z(function(c,u){var l=[],f=!1,p=function(y){var b=y.buffer,_=y.subs;_.unsubscribe(),ut(l,y),u.next(b),f&&d()},d=function(){if(l){var y=new Le;u.add(y);var b=[],_={buffer:b,subs:y};l.push(_),je(y,s,function(){return p(_)},r)}};o!==null&&o>=0?je(u,s,d,o,!0):f=!0,d();var h=q(u,function(y){var b,_,j=l.slice();try{for(var $=Be(j),L=$.next();!L.done;L=$.next()){var K=L.value,M=K.buffer;M.push(y),a<=M.length&&p(K)}}catch(Z){b={error:Z}}finally{try{L&&!L.done&&(_=$.return)&&_.call($)}finally{if(b)throw b.error}}},function(){for(;l!=null&&l.length;)u.next(l.shift().buffer);h==null||h.unsubscribe(),u.complete(),u.unsubscribe()},void 0,function(){return l=null});c.subscribe(h)})}function zh(r,e){return z(function(t,n){var i=[];J(r).subscribe(q(n,function(s){var o=[];i.push(o);var a=new Le,c=function(){ut(i,o),n.next(o),a.unsubscribe()};a.add(J(e(s)).subscribe(q(n,c,ve)))},ve)),t.subscribe(q(n,function(s){var o,a;try{for(var c=Be(i),u=c.next();!u.done;u=c.next()){var l=u.value;l.push(s)}}catch(f){o={error:f}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}},function(){for(;i.length>0;)n.next(i.shift());n.complete()}))})}function Wh(r){return z(function(e,t){var n=null,i=null,s=function(){i==null||i.unsubscribe();var o=n;n=[],o&&t.next(o),J(r()).subscribe(i=q(t,s,ve))};s(),e.subscribe(q(t,function(o){return n==null?void 0:n.push(o)},function(){n&&t.next(n),t.complete()},void 0,function(){return n=i=null}))})}function xa(r){return z(function(e,t){var n=null,i=!1,s;n=e.subscribe(q(t,void 0,void 0,function(o){s=J(r(o,xa(r)(e))),n?(n.unsubscribe(),n=null,s.subscribe(t)):i=!0})),i&&(n.unsubscribe(),n=null,s.subscribe(t))})}function Ea(r,e,t,n,i){return function(s,o){var a=t,c=e,u=0;s.subscribe(q(o,function(l){var f=u++;c=a?r(c,l,f):(a=!0,l),n&&o.next(c)},i&&function(){a&&o.next(c),o.complete()}))}}function fn(r,e){return z(Ea(r,e,arguments.length>=2,!1,!0))}var Hh=function(r,e){return r.push(e),r};function ka(){return z(function(r,e){fn(Hh,[])(r).subscribe(e)})}function Aa(r,e){return fi(ka(),Ze(function(t){return r(t)}),e?Nt(e):_e)}function _a(r){return Aa(da,r)}var Jh=_a;function Sa(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=ln(r);return t?fi(Sa.apply(void 0,le([],ue(r))),Nt(t)):z(function(n,i){pa(le([n],ue(zt(r))))(i)})}function Yh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Sa.apply(void 0,le([],ue(r)))}function zr(r,e){return X(e)?Ze(r,e,1):Ze(r,1)}function Gh(r,e){return X(e)?zr(function(){return r},e):zr(function(){return r})}function Qh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=lt(r);return z(function(n,i){xi()(ft(le([n],ue(r)),t)).subscribe(i)})}function Xh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Qh.apply(void 0,le([],ue(r)))}function Zh(r){return new te(function(e){return r.subscribe(e)})}var ed={connector:function(){return new xe}};function ki(r,e){e===void 0&&(e=ed);var t=e.connector;return z(function(n,i){var s=t();J(r(Zh(s))).subscribe(i),i.add(n.subscribe(s))})}function td(r){return fn(function(e,t,n){return!r||r(t,n)?e+1:e},0)}function nd(r){return z(function(e,t){var n=!1,i=null,s=null,o=function(){if(s==null||s.unsubscribe(),s=null,n){n=!1;var a=i;i=null,t.next(a)}};e.subscribe(q(t,function(a){s==null||s.unsubscribe(),n=!0,i=a,s=q(t,o,ve),J(r(a)).subscribe(s)},function(){o(),t.complete()},void 0,function(){i=s=null}))})}function rd(r,e){return e===void 0&&(e=He),z(function(t,n){var i=null,s=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var u=s;s=null,n.next(u)}};function c(){var u=o+r,l=e.now();if(l<u){i=this.schedule(void 0,u-l),n.add(i);return}a()}t.subscribe(q(n,function(u){s=u,o=e.now(),i||(i=e.schedule(c,r),n.add(i))},function(){a(),n.complete()},void 0,function(){s=i=null}))})}function rr(r){return z(function(e,t){var n=!1;e.subscribe(q(t,function(i){n=!0,t.next(i)},function(){n||t.next(r),t.complete()}))})}function tn(r){return r<=0?function(){return st}:z(function(e,t){var n=0;e.subscribe(q(t,function(i){++n<=r&&(t.next(i),r<=n&&t.complete())}))})}function Oa(){return z(function(r,e){r.subscribe(q(e,ve))})}function Ta(r){return Rt(function(){return r})}function Ai(r,e){return e?function(t){return en(e.pipe(tn(1),Oa()),t.pipe(Ai(r)))}:Ze(function(t,n){return J(r(t,n)).pipe(tn(1),Ta(t))})}function id(r,e){e===void 0&&(e=He);var t=Ct(r,e);return Ai(function(){return t})}function sd(){return z(function(r,e){r.subscribe(q(e,function(t){return oa(t,e)}))})}function od(r,e){return z(function(t,n){var i=new Set;t.subscribe(q(n,function(s){var o=r?r(s):s;i.has(o)||(i.add(o),n.next(s))})),e&&J(e).subscribe(q(n,function(){return i.clear()},ve))})}function Pa(r,e){return e===void 0&&(e=_e),r=r!=null?r:ad,z(function(t,n){var i,s=!0;t.subscribe(q(n,function(o){var a=e(o);(s||!r(i,a))&&(s=!1,i=a,n.next(o))}))})}function ad(r,e){return r===e}function cd(r,e){return Pa(function(t,n){return e?e(t[r],n[r]):t[r]===n[r]})}function ir(r){return r===void 0&&(r=ud),z(function(e,t){var n=!1;e.subscribe(q(t,function(i){n=!0,t.next(i)},function(){return n?t.complete():t.error(r())}))})}function ud(){return new It}function ld(r,e){if(r<0)throw new Vr;var t=arguments.length>=2;return function(n){return n.pipe(Tt(function(i,s){return s===r}),tn(1),t?rr(e):ir(function(){return new Vr}))}}function fd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return function(t){return en(t,vi.apply(void 0,le([],ue(r))))}}function hd(r,e){return z(function(t,n){var i=0;t.subscribe(q(n,function(s){r.call(e,s,i++,t)||(n.next(!1),n.complete())},function(){n.next(!0),n.complete()}))})}function _i(r,e){return e?function(t){return t.pipe(_i(function(n,i){return J(r(n,i)).pipe(Rt(function(s,o){return e(n,s,i,o)}))}))}:z(function(t,n){var i=0,s=null,o=!1;t.subscribe(q(n,function(a){s||(s=q(n,void 0,function(){s=null,o&&n.complete()}),J(r(a,i++)).subscribe(s))},function(){o=!0,!s&&n.complete()}))})}function Ia(){return _i(_e)}var dd=Ia;function pd(r,e,t){return e===void 0&&(e=1/0),e=(e||0)<1?1/0:e,z(function(n,i){return bi(n,i,r,e,void 0,!0,t)})}function yd(r){return z(function(e,t){try{e.subscribe(t)}finally{t.add(r)}})}function md(r,e){return z(Ra(r,e,"value"))}function Ra(r,e,t){var n=t==="index";return function(i,s){var o=0;i.subscribe(q(s,function(a){var c=o++;r.call(e,a,c,i)&&(s.next(n?c:a),s.complete())},function(){s.next(n?-1:void 0),s.complete()}))}}function gd(r,e){return z(Ra(r,e,"index"))}function vd(r,e){var t=arguments.length>=2;return function(n){return n.pipe(r?Tt(function(i,s){return r(i,s,n)}):_e,tn(1),t?rr(e):ir(function(){return new It}))}}function wd(r,e,t,n){return z(function(i,s){var o;!e||typeof e=="function"?o=e:(t=e.duration,o=e.element,n=e.connector);var a=new Map,c=function(h){a.forEach(h),h(s)},u=function(h){return c(function(y){return y.error(h)})},l=0,f=!1,p=new hi(s,function(h){try{var y=r(h),b=a.get(y);if(!b){a.set(y,b=n?n():new xe);var _=d(y,b);if(s.next(_),t){var j=q(b,function(){b.complete(),j==null||j.unsubscribe()},void 0,void 0,function(){return a.delete(y)});p.add(J(t(_)).subscribe(j))}}b.next(o?o(h):h)}catch($){u($)}},function(){return c(function(h){return h.complete()})},u,function(){return a.clear()},function(){return f=!0,l===0});i.subscribe(p);function d(h,y){var b=new te(function(_){l++;var j=y.subscribe(_);return function(){j.unsubscribe(),--l===0&&f&&p.unsubscribe()}});return b.key=h,b}})}function bd(){return z(function(r,e){r.subscribe(q(e,function(){e.next(!1),e.complete()},function(){e.next(!0),e.complete()}))})}function Na(r){return r<=0?function(){return st}:z(function(e,t){var n=[];e.subscribe(q(t,function(i){n.push(i),r<n.length&&n.shift()},function(){var i,s;try{for(var o=Be(n),a=o.next();!a.done;a=o.next()){var c=a.value;t.next(c)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}t.complete()},void 0,function(){n=null}))})}function xd(r,e){var t=arguments.length>=2;return function(n){return n.pipe(r?Tt(function(i,s){return r(i,s,n)}):_e,Na(1),t?rr(e):ir(function(){return new It}))}}function Ed(){return z(function(r,e){r.subscribe(q(e,function(t){e.next(In.createNext(t))},function(){e.next(In.createComplete()),e.complete()},function(t){e.next(In.createError(t)),e.complete()}))})}function kd(r){return fn(X(r)?function(e,t){return r(e,t)>0?e:t}:function(e,t){return e>t?e:t})}var Ad=Ze;function _d(r,e,t){return t===void 0&&(t=1/0),X(e)?Ze(function(){return r},e,t):(typeof e=="number"&&(t=e),Ze(function(){return r},t))}function Sd(r,e,t){return t===void 0&&(t=1/0),z(function(n,i){var s=e;return bi(n,i,function(o,a){return r(s,o,a)},t,function(o){s=o},!1,void 0,function(){return s=null})})}function Od(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=lt(r),n=Wo(r,1/0);return r=zt(r),z(function(i,s){tr(n)(ft(le([i],ue(r)),t)).subscribe(s)})}function Td(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Od.apply(void 0,le([],ue(r)))}function Pd(r){return fn(X(r)?function(e,t){return r(e,t)<0?e:t}:function(e,t){return e<t?e:t})}function Si(r,e){var t=X(r)?r:function(){return r};return X(e)?ki(e,{connector:t}):function(n){return new Gn(n,t)}}function Id(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=zt(r);return function(n){return va.apply(void 0,le([n],ue(t)))}}function Rd(){return z(function(r,e){var t,n=!1;r.subscribe(q(e,function(i){var s=t;t=i,n&&e.next([s,i]),n=!0}))})}function Nd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=r.length;if(t===0)throw new Error("list of properties cannot be empty.");return Rt(function(n){for(var i=n,s=0;s<t;s++){var o=i==null?void 0:i[r[s]];if(typeof o!="undefined")i=o;else return}return i})}function Cd(r){return r?function(e){return ki(r)(e)}:function(e){return Si(new xe)(e)}}function $d(r){return function(e){var t=new Fo(r);return new Gn(e,function(){return t})}}function Bd(){return function(r){var e=new pi;return new Gn(r,function(){return e})}}function jd(r,e,t,n){t&&!X(t)&&(n=t);var i=X(t)?t:void 0;return function(s){return Si(new di(r,e,n),i)(s)}}function Ld(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r.length?z(function(t,n){wa(le([t],ue(r)))(n)}):_e}function Dd(r){var e,t=1/0,n;return r!=null&&(typeof r=="object"?(e=r.count,t=e===void 0?1/0:e,n=r.delay):t=r),t<=0?function(){return st}:z(function(i,s){var o=0,a,c=function(){if(a==null||a.unsubscribe(),a=null,n!=null){var l=typeof n=="number"?Ct(n):J(n(o)),f=q(s,function(){f.unsubscribe(),u()});l.subscribe(f)}else u()},u=function(){var l=!1;a=i.subscribe(q(s,void 0,function(){++o<t?a?c():l=!0:s.complete()})),l&&c()};u()})}function Ud(r){return z(function(e,t){var n,i=!1,s,o=!1,a=!1,c=function(){return a&&o&&(t.complete(),!0)},u=function(){return s||(s=new xe,J(r(s)).subscribe(q(t,function(){n?l():i=!0},function(){o=!0,c()}))),s},l=function(){a=!1,n=e.subscribe(q(t,void 0,function(){a=!0,!c()&&u().next()})),i&&(n.unsubscribe(),n=null,i=!1,l())};l()})}function Fd(r){r===void 0&&(r=1/0);var e;r&&typeof r=="object"?e=r:e={count:r};var t=e.count,n=t===void 0?1/0:t,i=e.delay,s=e.resetOnSuccess,o=s===void 0?!1:s;return n<=0?_e:z(function(a,c){var u=0,l,f=function(){var p=!1;l=a.subscribe(q(c,function(d){o&&(u=0),c.next(d)},void 0,function(d){if(u++<n){var h=function(){l?(l.unsubscribe(),l=null,f()):p=!0};if(i!=null){var y=typeof i=="number"?Ct(i):J(i(d,u)),b=q(c,function(){b.unsubscribe(),h()},function(){c.complete()});y.subscribe(b)}else h()}else c.error(d)})),p&&(l.unsubscribe(),l=null,f())};f()})}function Md(r){return z(function(e,t){var n,i=!1,s,o=function(){n=e.subscribe(q(t,void 0,void 0,function(a){s||(s=new xe,J(r(s)).subscribe(q(t,function(){return n?o():i=!0}))),s&&s.next(a)})),i&&(n.unsubscribe(),n=null,i=!1,o())};o()})}function Ca(r){return z(function(e,t){var n=!1,i=null;e.subscribe(q(t,function(s){n=!0,i=s})),J(r).subscribe(q(t,function(){if(n){n=!1;var s=i;i=null,t.next(s)}},ve))})}function Kd(r,e){return e===void 0&&(e=He),Ca(ma(r,e))}function Vd(r,e){return z(Ea(r,e,arguments.length>=2,!0))}function qd(r,e){return e===void 0&&(e=function(t,n){return t===n}),z(function(t,n){var i=As(),s=As(),o=function(c){n.next(c),n.complete()},a=function(c,u){var l=q(n,function(f){var p=u.buffer,d=u.complete;p.length===0?d?o(!1):c.buffer.push(f):!e(f,p.shift())&&o(!1)},function(){c.complete=!0;var f=u.complete,p=u.buffer;f&&o(p.length===0),l==null||l.unsubscribe()});return l};t.subscribe(a(i,s)),J(r).subscribe(a(s,i))})}function As(){return{buffer:[],complete:!1}}function $a(r){r===void 0&&(r={});var e=r.connector,t=e===void 0?function(){return new xe}:e,n=r.resetOnError,i=n===void 0?!0:n,s=r.resetOnComplete,o=s===void 0?!0:s,a=r.resetOnRefCountZero,c=a===void 0?!0:a;return function(u){var l,f,p,d=0,h=!1,y=!1,b=function(){f==null||f.unsubscribe(),f=void 0},_=function(){b(),l=p=void 0,h=y=!1},j=function(){var $=l;_(),$==null||$.unsubscribe()};return z(function($,L){d++,!y&&!h&&b();var K=p=p!=null?p:t();L.add(function(){d--,d===0&&!y&&!h&&(f=kr(j,c))}),K.subscribe(L),!l&&d>0&&(l=new Kt({next:function(M){return K.next(M)},error:function(M){y=!0,b(),f=kr(_,i,M),K.error(M)},complete:function(){h=!0,b(),f=kr(_,o),K.complete()}}),J($).subscribe(l))})(u)}}function kr(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];if(e===!0){r();return}if(e!==!1){var i=new Kt({next:function(){i.unsubscribe(),r()}});return J(e.apply(void 0,le([],ue(t)))).subscribe(i)}}function zd(r,e,t){var n,i,s,o,a=!1;return r&&typeof r=="object"?(n=r.bufferSize,o=n===void 0?1/0:n,i=r.windowTime,e=i===void 0?1/0:i,s=r.refCount,a=s===void 0?!1:s,t=r.scheduler):o=r!=null?r:1/0,$a({connector:function(){return new di(o,e,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function Wd(r){return z(function(e,t){var n=!1,i,s=!1,o=0;e.subscribe(q(t,function(a){s=!0,(!r||r(a,o++,e))&&(n&&t.error(new ca("Too many matching values")),n=!0,i=a)},function(){n?(t.next(i),t.complete()):t.error(s?new aa("No matching values"):new It)}))})}function Hd(r){return Tt(function(e,t){return r<=t})}function Jd(r){return r<=0?_e:z(function(e,t){var n=new Array(r),i=0;return e.subscribe(q(t,function(s){var o=i++;if(o<r)n[o]=s;else{var a=o%r,c=n[a];n[a]=s,t.next(c)}})),function(){n=null}})}function Yd(r){return z(function(e,t){var n=!1,i=q(t,function(){i==null||i.unsubscribe(),n=!0},ve);J(r).subscribe(i),e.subscribe(q(t,function(s){return n&&t.next(s)}))})}function Gd(r){return z(function(e,t){var n=!1,i=0;e.subscribe(q(t,function(s){return(n||(n=!r(s,i++)))&&t.next(s)}))})}function Qd(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=lt(r);return z(function(n,i){(t?en(r,n,t):en(r,n)).subscribe(i)})}function nn(r,e){return z(function(t,n){var i=null,s=0,o=!1,a=function(){return o&&!i&&n.complete()};t.subscribe(q(n,function(c){i==null||i.unsubscribe();var u=0,l=s++;J(r(c,l)).subscribe(i=q(n,function(f){return n.next(e?e(c,f,l,u++):f)},function(){i=null,a()}))},function(){o=!0,a()}))})}function Xd(){return nn(_e)}function Zd(r,e){return X(e)?nn(function(){return r},e):nn(function(){return r})}function ep(r,e){return z(function(t,n){var i=e;return nn(function(s,o){return r(i,s,o)},function(s,o){return i=o,o})(t).subscribe(n),function(){i=null}})}function tp(r){return z(function(e,t){J(r).subscribe(q(t,function(){return t.complete()},ve)),!t.closed&&e.subscribe(t)})}function np(r,e){return e===void 0&&(e=!1),z(function(t,n){var i=0;t.subscribe(q(n,function(s){var o=r(s,i++);(o||e)&&n.next(s),!o&&n.complete()}))})}function rp(r,e,t){var n=X(r)||e||t?{next:r,error:e,complete:t}:r;return n?z(function(i,s){var o;(o=n.subscribe)===null||o===void 0||o.call(n);var a=!0;i.subscribe(q(s,function(c){var u;(u=n.next)===null||u===void 0||u.call(n,c),s.next(c)},function(){var c;a=!1,(c=n.complete)===null||c===void 0||c.call(n),s.complete()},function(c){var u;a=!1,(u=n.error)===null||u===void 0||u.call(n,c),s.error(c)},function(){var c,u;a&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(u=n.finalize)===null||u===void 0||u.call(n)}))}):_e}function Ba(r,e){return z(function(t,n){var i=e!=null?e:{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,c=a===void 0?!1:a,u=!1,l=null,f=null,p=!1,d=function(){f==null||f.unsubscribe(),f=null,c&&(b(),p&&n.complete())},h=function(){f=null,p&&n.complete()},y=function(_){return f=J(r(_)).subscribe(q(n,d,h))},b=function(){if(u){u=!1;var _=l;l=null,n.next(_),!p&&y(_)}};t.subscribe(q(n,function(_){u=!0,l=_,!(f&&!f.closed)&&(o?b():y(_))},function(){p=!0,!(c&&u&&f&&!f.closed)&&n.complete()}))})}function ip(r,e,t){e===void 0&&(e=He);var n=Ct(r,e);return Ba(function(){return n},t)}function sp(r){return r===void 0&&(r=He),z(function(e,t){var n=r.now();e.subscribe(q(t,function(i){var s=r.now(),o=s-n;n=s,t.next(new op(i,o))}))})}var op=function(){function r(e,t){this.value=e,this.interval=t}return r}();function ap(r,e,t){var n,i,s;if(t=t!=null?t:yi,wi(r)?n=r:typeof r=="number"&&(i=r),e)s=function(){return e};else throw new TypeError("No observable provided to switch to");if(n==null&&i==null)throw new TypeError("No timeout provided.");return la({first:n,each:i,scheduler:t,with:s})}function cp(r){return r===void 0&&(r=Qn),Rt(function(e){return{value:e,timestamp:r.now()}})}function up(r){return z(function(e,t){var n=new xe;t.next(n.asObservable());var i=function(s){n.error(s),t.error(s)};return e.subscribe(q(t,function(s){return n==null?void 0:n.next(s)},function(){n.complete(),t.complete()},i)),J(r).subscribe(q(t,function(){n.complete(),t.next(n=new xe)},ve,i)),function(){n==null||n.unsubscribe(),n=null}})}function lp(r,e){e===void 0&&(e=0);var t=e>0?e:r;return z(function(n,i){var s=[new xe],o=[],a=0;i.next(s[0].asObservable()),n.subscribe(q(i,function(c){var u,l;try{for(var f=Be(s),p=f.next();!p.done;p=f.next()){var d=p.value;d.next(c)}}catch(b){u={error:b}}finally{try{p&&!p.done&&(l=f.return)&&l.call(f)}finally{if(u)throw u.error}}var h=a-r+1;if(h>=0&&h%t===0&&s.shift().complete(),++a%t===0){var y=new xe;s.push(y),i.next(y.asObservable())}},function(){for(;s.length>0;)s.shift().complete();i.complete()},function(c){for(;s.length>0;)s.shift().error(c);i.error(c)},function(){o=null,s=null}))})}function fp(r){for(var e,t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=(e=lt(n))!==null&&e!==void 0?e:He,o=(t=n[0])!==null&&t!==void 0?t:null,a=n[1]||1/0;return z(function(c,u){var l=[],f=!1,p=function(b){var _=b.window,j=b.subs;_.complete(),j.unsubscribe(),ut(l,b),f&&d()},d=function(){if(l){var b=new Le;u.add(b);var _=new xe,j={window:_,subs:b,seen:0};l.push(j),u.next(_.asObservable()),je(b,s,function(){return p(j)},r)}};o!==null&&o>=0?je(u,s,d,o,!0):f=!0,d();var h=function(b){return l.slice().forEach(b)},y=function(b){h(function(_){var j=_.window;return b(j)}),b(u),u.unsubscribe()};return c.subscribe(q(u,function(b){h(function(_){_.window.next(b),a<=++_.seen&&p(_)})},function(){return y(function(b){return b.complete()})},function(b){return y(function(_){return _.error(b)})})),function(){l=null}})}function hp(r,e){return z(function(t,n){var i=[],s=function(o){for(;0<i.length;)i.shift().error(o);n.error(o)};J(r).subscribe(q(n,function(o){var a=new xe;i.push(a);var c=new Le,u=function(){ut(i,a),a.complete(),c.unsubscribe()},l;try{l=J(e(o))}catch(f){s(f);return}n.next(a.asObservable()),c.add(l.subscribe(q(n,u,ve,s)))},ve)),t.subscribe(q(n,function(o){var a,c,u=i.slice();try{for(var l=Be(u),f=l.next();!f.done;f=l.next()){var p=f.value;p.next(o)}}catch(d){a={error:d}}finally{try{f&&!f.done&&(c=l.return)&&c.call(l)}finally{if(a)throw a.error}}},function(){for(;0<i.length;)i.shift().complete();n.complete()},s,function(){for(;0<i.length;)i.shift().unsubscribe()}))})}function dp(r){return z(function(e,t){var n,i,s=function(a){n.error(a),t.error(a)},o=function(){i==null||i.unsubscribe(),n==null||n.complete(),n=new xe,t.next(n.asObservable());var a;try{a=J(r())}catch(c){s(c);return}a.subscribe(i=q(t,o,o,s))};o(),e.subscribe(q(t,function(a){return n.next(a)},function(){n.complete(),t.complete()},s,function(){i==null||i.unsubscribe(),n=null}))})}function pp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=ln(r);return z(function(n,i){for(var s=r.length,o=new Array(s),a=r.map(function(){return!1}),c=!1,u=function(f){J(r[f]).subscribe(q(i,function(p){o[f]=p,!c&&!a[f]&&(a[f]=!0,(c=a.every(_e))&&(a=null))},ve))},l=0;l<s;l++)u(l);n.subscribe(q(i,function(f){if(c){var p=le([f],ue(o));i.next(t?t.apply(void 0,le([],ue(p))):p)}}))})}function yp(r){return Aa(Ei,r)}function mp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return z(function(t,n){Ei.apply(void 0,le([t],ue(r))).subscribe(n)})}function gp(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return mp.apply(void 0,le([],ue(r)))}const vp=Object.freeze(Object.defineProperty({__proto__:null,Observable:te,ConnectableObservable:Gn,observable:Yn,animationFrames:Cf,Subject:xe,BehaviorSubject:Fo,ReplaySubject:di,AsyncSubject:pi,asap:Mf,asapScheduler:Ko,async:yi,asyncScheduler:He,queue:qf,queueScheduler:Vo,animationFrame:Hf,animationFrameScheduler:qo,VirtualTimeScheduler:Jf,VirtualAction:zo,Scheduler:Mr,Subscription:Le,Subscriber:Jn,Notification:In,get NotificationKind(){return Kr},pipe:fi,noop:ve,identity:_e,isObservable:ch,lastValueFrom:uh,firstValueFrom:lh,ArgumentOutOfRangeError:Vr,EmptyError:It,NotFoundError:aa,ObjectUnsubscribedError:Uo,SequenceError:ca,TimeoutError:ua,UnsubscriptionError:Tn,bindCallback:ph,bindNodeCallback:yh,combineLatest:da,concat:en,connectable:Eh,defer:nr,empty:Yf,forkJoin:kh,from:ft,fromEvent:qr,fromEventPattern:ya,generate:Ih,iif:Rh,interval:ma,merge:Nh,never:Ch,of:vi,onErrorResumeNext:va,pairs:Bh,partition:Lh,race:Dh,range:Uh,throwError:sa,timer:Ct,using:Fh,zip:Ei,scheduled:ia,EMPTY:st,NEVER:ga,config:xt,audit:ba,auditTime:Mh,buffer:Kh,bufferCount:Vh,bufferTime:qh,bufferToggle:zh,bufferWhen:Wh,catchError:xa,combineAll:Jh,combineLatestAll:_a,combineLatestWith:Yh,concatAll:xi,concatMap:zr,concatMapTo:Gh,concatWith:Xh,connect:ki,count:td,debounce:nd,debounceTime:rd,defaultIfEmpty:rr,delay:id,delayWhen:Ai,dematerialize:sd,distinct:od,distinctUntilChanged:Pa,distinctUntilKeyChanged:cd,elementAt:ld,endWith:fd,every:hd,exhaust:dd,exhaustAll:Ia,exhaustMap:_i,expand:pd,filter:Tt,finalize:yd,find:md,findIndex:gd,first:vd,groupBy:wd,ignoreElements:Oa,isEmpty:bd,last:xd,map:Rt,mapTo:Ta,materialize:Ed,max:kd,mergeAll:tr,flatMap:Ad,mergeMap:Ze,mergeMapTo:_d,mergeScan:Sd,mergeWith:Td,min:Pd,multicast:Si,observeOn:Zn,onErrorResumeNextWith:Id,pairwise:Rd,pluck:Nd,publish:Cd,publishBehavior:$d,publishLast:Bd,publishReplay:jd,raceWith:Ld,reduce:fn,repeat:Dd,repeatWhen:Ud,retry:Fd,retryWhen:Md,refCount:jo,sample:Ca,sampleTime:Kd,scan:Vd,sequenceEqual:qd,share:$a,shareReplay:zd,single:Wd,skip:Hd,skipLast:Jd,skipUntil:Yd,skipWhile:Gd,startWith:Qd,subscribeOn:er,switchAll:Xd,switchMap:nn,switchMapTo:Zd,switchScan:ep,take:tn,takeLast:Na,takeUntil:tp,takeWhile:np,tap:rp,throttle:Ba,throttleTime:ip,throwIfEmpty:ir,timeInterval:sp,timeout:la,timeoutWith:ap,timestamp:cp,toArray:ka,window:up,windowCount:lp,windowTime:fp,windowToggle:hp,windowWhen:dp,withLatestFrom:pp,zipAll:yp,zipWith:gp},Symbol.toStringTag,{value:"Module"}));export{bp as default};
//# sourceMappingURL=swyger-client-database.min.js.map
